/*!
 * LMV v6.4.2
 *
 * Copyright 2019 Autodesk, Inc.
 * All rights reserved.
 *
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 *
 * Autodesk Forge Viewer Usage Limitations:
 *
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
var LMV=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=241)}([function(e,t,n){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n,i,r,o,a,s,l,c,u,h,d,f,p,m,g,v,y,_,b,x,w,A,E,T,M,S,C,P,L,R,D,I,O,N,k,V,F,B,U,z,G,H,W,j,X,q,Y,K,Q,Z={REVISION:"71"};"object"===t(e)&&(e.exports=Z),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),Z.log=function(){console.log.apply(console,arguments)},Z.warn=function(){console.warn.apply(console,arguments)},Z.error=function(){console.error.apply(console,arguments)},Z.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},Z.CullFaceNone=0,Z.CullFaceBack=1,Z.CullFaceFront=2,Z.CullFaceFrontBack=3,Z.FrontFaceDirectionCW=0,Z.FrontFaceDirectionCCW=1,Z.BasicShadowMap=0,Z.PCFShadowMap=1,Z.PCFSoftShadowMap=2,Z.FrontSide=0,Z.BackSide=1,Z.DoubleSide=2,Z.NoShading=0,Z.FlatShading=1,Z.SmoothShading=2,Z.NoColors=0,Z.FaceColors=1,Z.VertexColors=2,Z.NoBlending=0,Z.NormalBlending=1,Z.AdditiveBlending=2,Z.SubtractiveBlending=3,Z.MultiplyBlending=4,Z.CustomBlending=5,Z.AddEquation=100,Z.SubtractEquation=101,Z.ReverseSubtractEquation=102,Z.MinEquation=103,Z.MaxEquation=104,Z.ZeroFactor=200,Z.OneFactor=201,Z.SrcColorFactor=202,Z.OneMinusSrcColorFactor=203,Z.SrcAlphaFactor=204,Z.OneMinusSrcAlphaFactor=205,Z.DstAlphaFactor=206,Z.OneMinusDstAlphaFactor=207,Z.DstColorFactor=208,Z.OneMinusDstColorFactor=209,Z.SrcAlphaSaturateFactor=210,Z.MultiplyOperation=0,Z.MixOperation=1,Z.AddOperation=2,Z.UVMapping=300,Z.CubeReflectionMapping=301,Z.CubeRefractionMapping=302,Z.EquirectangularReflectionMapping=303,Z.EquirectangularRefractionMapping=304,Z.SphericalReflectionMapping=305,Z.RepeatWrapping=1e3,Z.ClampToEdgeWrapping=1001,Z.MirroredRepeatWrapping=1002,Z.NearestFilter=1003,Z.NearestMipMapNearestFilter=1004,Z.NearestMipMapLinearFilter=1005,Z.LinearFilter=1006,Z.LinearMipMapNearestFilter=1007,Z.LinearMipMapLinearFilter=1008,Z.UnsignedByteType=1009,Z.ByteType=1010,Z.ShortType=1011,Z.UnsignedShortType=1012,Z.IntType=1013,Z.UnsignedIntType=1014,Z.FloatType=1015,Z.HalfFloatType=1025,Z.UnsignedShort4444Type=1016,Z.UnsignedShort5551Type=1017,Z.UnsignedShort565Type=1018,Z.AlphaFormat=1019,Z.RGBFormat=1020,Z.RGBAFormat=1021,Z.LuminanceFormat=1022,Z.LuminanceAlphaFormat=1023,Z.RGBEFormat=Z.RGBAFormat,Z.RGB_S3TC_DXT1_Format=2001,Z.RGBA_S3TC_DXT1_Format=2002,Z.RGBA_S3TC_DXT3_Format=2003,Z.RGBA_S3TC_DXT5_Format=2004,Z.RGB_PVRTC_4BPPV1_Format=2100,Z.RGB_PVRTC_2BPPV1_Format=2101,Z.RGBA_PVRTC_4BPPV1_Format=2102,Z.RGBA_PVRTC_2BPPV1_Format=2103,Z.Projector=function(){Z.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){Z.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){Z.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){Z.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},Z.CanvasRenderer=function(){Z.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},Z.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},Z.Color.prototype={constructor:Z.Color,r:1,g:1,b:1,set:function(e){return e instanceof Z.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(0===t)this.r=this.g=this.b=n;else{var i=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e},r=n<=.5?n*(1+t):n+t-n*t,o=2*n-r;this.r=i(o,r,e+1/3),this.g=i(o,r,e),this.b=i(o,r,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(Z.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,n,i=e||{h:0,s:0,l:0},r=this.r,o=this.g,a=this.b,s=Math.max(r,o,a),l=Math.min(r,o,a),c=(l+s)/2;if(l===s)t=0,n=0;else{var u=s-l;switch(n=c<=.5?u/(s+l):u/(2-s-l),s){case r:t=(o-a)/u+(o<a?6:0);break;case o:t=(a-r)/u+2;break;case a:t=(r-o)/u+4}t/=6}return i.h=t,i.s=n,i.l=c,i},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=n,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},clone:function(){return(new Z.Color).setRGB(this.r,this.g,this.b)}},Z.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Z.Quaternion=function(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==i?i:1},Z.Quaternion.prototype={constructor:Z.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this.onChangeCallback(),this},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof Z.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n=Math.cos(e._x/2),i=Math.cos(e._y/2),r=Math.cos(e._z/2),o=Math.sin(e._x/2),a=Math.sin(e._y/2),s=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=o*i*r+n*a*s,this._y=n*a*r-o*i*s,this._z=n*i*s+o*a*r,this._w=n*i*r-o*a*s):"YXZ"===e.order?(this._x=o*i*r+n*a*s,this._y=n*a*r-o*i*s,this._z=n*i*s-o*a*r,this._w=n*i*r+o*a*s):"ZXY"===e.order?(this._x=o*i*r-n*a*s,this._y=n*a*r+o*i*s,this._z=n*i*s+o*a*r,this._w=n*i*r-o*a*s):"ZYX"===e.order?(this._x=o*i*r-n*a*s,this._y=n*a*r+o*i*s,this._z=n*i*s-o*a*r,this._w=n*i*r+o*a*s):"YZX"===e.order?(this._x=o*i*r+n*a*s,this._y=n*a*r+o*i*s,this._z=n*i*s-o*a*r,this._w=n*i*r-o*a*s):"XZY"===e.order&&(this._x=o*i*r-n*a*s,this._y=n*a*r-o*i*s,this._z=n*i*s+o*a*r,this._w=n*i*r+o*a*s),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,i=n[0],r=n[4],o=n[8],a=n[1],s=n[5],l=n[9],c=n[2],u=n[6],h=n[10],d=i+s+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(u-l)*t,this._y=(o-c)*t,this._z=(a-r)*t):i>s&&i>h?(t=2*Math.sqrt(1+i-s-h),this._w=(u-l)/t,this._x=.25*t,this._y=(r+a)/t,this._z=(o+c)/t):s>h?(t=2*Math.sqrt(1+s-i-h),this._w=(o-c)/t,this._x=(r+a)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-i-s),this._w=(a-r)/t,this._x=(o+c)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(e,t){return void 0===n&&(n=new Z.Vector3),(i=e.dot(t)+1)<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?n.set(-e.y,e.x,0):n.set(0,-e.z,e.y)):n.crossVectors(e,t),this._x=n.x,this._y=n.y,this._z=n.z,this._w=i,this.normalize(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(Z.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+o*a+i*l-r*s,this._y=i*c+o*s+r*a-n*l,this._z=r*c+o*l+n*s-i*a,this._w=o*c-n*a-i*s-r*l,this.onChangeCallback(),this},multiplyVector3:function(e){return Z.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,o=this._w,a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;var s=Math.acos(a),l=Math.sqrt(1-a*a);if(Math.abs(l)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(i+this._y),this._z=.5*(r+this._z),this;var c=Math.sin((1-t)*s)/l,u=Math.sin(t*s)/l;return this._w=o*c+this._w*u,this._x=n*c+this._x*u,this._y=i*c+this._y*u,this._z=r*c+this._z*u,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new Z.Quaternion(this._x,this._y,this._z,this._w)}},Z.Quaternion.slerp=function(e,t,n,i){return n.copy(e).slerp(t,i)},Z.Vector2=function(e,t){this.x=e||0,this.y=t||0},Z.Vector2.prototype={constructor:Z.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(Z.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},sub:function(e,t){return void 0!==t?(Z.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(e,t){return void 0===r&&(r=new Z.Vector2,o=new Z.Vector2),r.set(e,e),o.set(t,t),this.clamp(r,o)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this},clone:function(){return new Z.Vector2(this.x,this.y)}},Z.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},Z.Vector3.prototype={constructor:Z.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(Z.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(Z.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(Z.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e instanceof Z.Euler==0&&Z.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===s&&(s=new Z.Quaternion),this.applyQuaternion(s.setFromEuler(e)),this},applyAxisAngle:function(){var e;return function(t,n){return void 0===e&&(e=new Z.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,n)),this}}(),applyMatrix3:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i+r[12],this.y=r[1]*t+r[5]*n+r[9]*i+r[13],this.z=r[2]*t+r[6]*n+r[10]*i+r[14],this},applyProjection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,c=s*n+a*t-r*i,u=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=l*s+h*-r+c*-a-u*-o,this.y=c*s+h*-o+u*-r-l*-a,this.z=u*s+h*-a+l*-o-c*-r,this},project:function(e){return void 0===a&&(a=new Z.Matrix4),a.multiplyMatrices(e.projectionMatrix,a.getInverse(e.matrixWorld)),this.applyProjection(a)},unproject:function(){var e;return function(t){return void 0===e&&(e=new Z.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(n,i){return void 0===e&&(e=new Z.Vector3,t=new Z.Vector3),e.set(n,n,n),t.set(i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},cross:function(e,t){if(void 0!==t)return Z.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-n*e.z,this.z=n*e.y-i*e.x,this},crossVectors:function(e,t){var n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this},projectOnVector:function(){var e,t;return function(n){return void 0===e&&(e=new Z.Vector3),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new Z.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new Z.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(Z.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},setEulerFromRotationMatrix:function(e,t){Z.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){Z.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return Z.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return Z.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return Z.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=i,this},setFromMatrixColumn:function(e,t){var n=4*e,i=t.elements;return this.x=i[n],this.y=i[n+1],this.z=i[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this},clone:function(){return new Z.Vector3(this.x,this.y,this.z)}},Z.Vector4=function(e,t,n,i){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==i?i:1},Z.Vector4.prototype={constructor:Z.Vector4,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(Z.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(Z.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,i,r,o=e.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],d=o[2],f=o[6],p=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-f)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+f)<.1&&Math.abs(a+u+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(u+1)/2,v=(p+1)/2,y=(s+c)/4,_=(l+d)/4,b=(h+f)/4;return m>g&&m>v?m<.01?(n=0,i=.707106781,r=.707106781):(i=y/(n=Math.sqrt(m)),r=_/n):g>v?g<.01?(n=.707106781,i=0,r=.707106781):(n=y/(i=Math.sqrt(g)),r=b/i):v<.01?(n=.707106781,i=.707106781,r=0):(n=_/(r=Math.sqrt(v)),i=b/r),this.set(n,i,r,t),this}var x=Math.sqrt((f-h)*(f-h)+(l-d)*(l-d)+(c-s)*(c-s));return Math.abs(x)<.001&&(x=1),this.x=(f-h)/x,this.y=(l-d)/x,this.z=(c-s)/x,this.w=Math.acos((a+u+p-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(n,i){return void 0===e&&(e=new Z.Vector4,t=new Z.Vector4),e.set(n,n,n,n),t.set(i,i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this},clone:function(){return new Z.Vector4(this.x,this.y,this.z,this.w)}},Z.Euler=function(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._order=i||Z.Euler.DefaultOrder},Z.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Z.Euler.DefaultOrder="XYZ",Z.Euler.prototype={constructor:Z.Euler,_x:0,_y:0,_z:0,_order:Z.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var i=Z.Math.clamp,r=e.elements,o=r[0],a=r[4],s=r[8],l=r[1],c=r[5],u=r[9],h=r[2],d=r[6],f=r[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===t?(this._z=Math.asin(i(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===t?(this._z=Math.asin(-i(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-u,f),this._y=0)):Z.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,n,i){return void 0===e&&(e=new Z.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,n,i),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(l=new Z.Quaternion,function(e){l.setFromEuler(this),this.setFromQuaternion(l,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Z.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new Z.Euler(this._x,this._y,this._z,this._order)}},Z.Line3=function(e,t){this.start=void 0!==e?e:new Z.Vector3,this.end=void 0!==t?t:new Z.Vector3},Z.Line3.prototype={constructor:Z.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new Z.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new Z.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var n=t||new Z.Vector3;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(c=new Z.Vector3,u=new Z.Vector3,function(e,t){c.subVectors(e,this.start),u.subVectors(this.end,this.start);var n=u.dot(u),i=u.dot(c)/n;return t&&(i=Z.Math.clamp(i,0,1)),i}),closestPointToPoint:function(e,t,n){var i=this.closestPointToPointParameter(e,t),r=n||new Z.Vector3;return this.delta(r).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new Z.Line3).copy(this)}},Z.Box2=function(e,t){this.min=void 0!==e?e:new Z.Vector2(1/0,1/0),this.max=void 0!==t?t:new Z.Vector2(-1/0,-1/0)},Z.Box2.prototype={constructor:Z.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Z.Vector2;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new Z.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new Z.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new Z.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new Z.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Z.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new Z.Box2).copy(this)}},Z.Box3=function(e,t){this.min=void 0!==e?e:new Z.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Z.Vector3(-1/0,-1/0,-1/0)},Z.Box3.prototype={constructor:Z.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Z.Vector3;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(){var e=new Z.Vector3;return function(t){var n=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){var i=t.geometry;if(void 0!==i)if(i instanceof Z.Geometry)for(var r=i.vertices,o=0,a=r.length;o<a;o++)e.copy(r[o]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e);else if(i instanceof Z.BufferGeometry&&void 0!==i.attributes.position){var s=i.attributes.position.array;for(o=0,a=s.length;o<a;o+=3)e.set(s[o],s[o+1],s[o+2]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e)}}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new Z.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new Z.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new Z.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new Z.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Z.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new Z.Vector3;return function(t){var n=t||new Z.Sphere;return n.center=this.center(),n.radius=.5*this.size(e).length(),n}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(h=[new Z.Vector3,new Z.Vector3,new Z.Vector3,new Z.Vector3,new Z.Vector3,new Z.Vector3,new Z.Vector3,new Z.Vector3],function(e){return h[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),h[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),h[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),h[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),h[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),h[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),h[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),h[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(h),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new Z.Box3).copy(this)}},Z.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&Z.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},Z.Matrix3.prototype={constructor:Z.Matrix3,set:function(e,t,n,i,r,o,a,s,l){var c=this.elements;return c[0]=e,c[3]=t,c[6]=n,c[1]=i,c[4]=r,c[7]=o,c[2]=a,c[5]=s,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return Z.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return Z.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new Z.Vector3;return function(t,n,i){void 0===n&&(n=0),void 0===i&&(i=t.length);for(var r=0,o=n;r<i;r+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix3(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-n*r*c+n*a*s+i*r*l-i*o*s},getInverse:function(e,t){var n=e.elements,i=this.elements;i[0]=n[10]*n[5]-n[6]*n[9],i[1]=-n[10]*n[1]+n[2]*n[9],i[2]=n[6]*n[1]-n[2]*n[5],i[3]=-n[10]*n[4]+n[6]*n[8],i[4]=n[10]*n[0]-n[2]*n[8],i[5]=-n[6]*n[0]+n[2]*n[4],i[6]=n[9]*n[4]-n[5]*n[8],i[7]=-n[9]*n[0]+n[1]*n[8],i[8]=n[5]*n[0]-n[1]*n[4];var r=n[0]*i[0]+n[1]*i[3]+n[2]*i[6];if(0===r){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return Z.warn(o),this.identity(),this}return this.multiplyScalar(1/r),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new Z.Matrix3).fromArray(this.elements)}},Z.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&Z.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},Z.Matrix4.prototype={constructor:Z.Matrix4,set:function(e,t,n,i,r,o,a,s,l,c,u,h,d,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return Z.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){var i=this.elements;return e.set(i[0],i[1],i[2]),t.set(i[4],i[5],i[6]),n.set(i[8],i[9],i[10]),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new Z.Vector3;return function(t){var n=this.elements,i=t.elements,r=1/e.set(i[0],i[1],i[2]).length(),o=1/e.set(i[4],i[5],i[6]).length(),a=1/e.set(i[8],i[9],i[10]).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[4]=i[4]*o,n[5]=i[5]*o,n[6]=i[6]*o,n[8]=i[8]*a,n[9]=i[9]*a,n[10]=i[10]*a,this}}(),makeRotationFromEuler:function(e){e instanceof Z.Euler==!1&&Z.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){var h=o*c,d=o*u,f=a*c,p=a*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=d+f*l,t[5]=h-p*l,t[9]=-a*s,t[2]=p-h*l,t[6]=f+d*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m-y*a,t[4]=-o*u,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*c,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){h=o*c,d=o*u,f=a*c,p=a*u;t[0]=s*c,t[4]=f*l-d,t[8]=h*l+p,t[1]=s*u,t[5]=p*l+h,t[9]=d*l-f,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var _=o*s,b=o*l,x=a*s,w=a*l;t[0]=s*c,t[4]=w-_*u,t[8]=x*u+b,t[1]=u,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=b*u+x,t[10]=_-w*u}else if("XZY"===e.order){_=o*s,b=o*l,x=a*s,w=a*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=_*u+w,t[5]=o*c,t[9]=b*u-x,t[2]=x*u-b,t[6]=a*c,t[10]=w*u+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return Z.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z,o=e.w,a=n+n,s=i+i,l=r+r,c=n*a,u=n*s,h=n*l,d=i*s,f=i*l,p=r*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(d+p),t[4]=u-v,t[8]=h+g,t[1]=u+v,t[5]=1-(c+p),t[9]=f-m,t[2]=h-g,t[6]=f+m,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:(d=new Z.Vector3,f=new Z.Vector3,p=new Z.Vector3,function(e,t,n){var i=this.elements;return p.subVectors(e,t).normalize(),0===p.length()&&(p.z=1),d.crossVectors(n,p).normalize(),0===d.length()&&(p.x+=1e-4,d.crossVectors(n,p).normalize()),f.crossVectors(p,d),i[0]=d.x,i[4]=f.x,i[8]=p.x,i[1]=d.y,i[5]=f.y,i[9]=p.y,i[2]=d.z,i[6]=f.z,i[10]=p.z,this}),multiply:function(e,t){return void 0!==t?(Z.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],b=n[15],x=i[0],w=i[4],A=i[8],E=i[12],T=i[1],M=i[5],S=i[9],C=i[13],P=i[2],L=i[6],R=i[10],D=i[14],I=i[3],O=i[7],N=i[11],k=i[15];return r[0]=o*x+a*T+s*P+l*I,r[4]=o*w+a*M+s*L+l*O,r[8]=o*A+a*S+s*R+l*N,r[12]=o*E+a*C+s*D+l*k,r[1]=c*x+u*T+h*P+d*I,r[5]=c*w+u*M+h*L+d*O,r[9]=c*A+u*S+h*R+d*N,r[13]=c*E+u*C+h*D+d*k,r[2]=f*x+p*T+m*P+g*I,r[6]=f*w+p*M+m*L+g*O,r[10]=f*A+p*S+m*R+g*N,r[14]=f*E+p*C+m*D+g*k,r[3]=v*x+y*T+_*P+b*I,r[7]=v*w+y*M+_*L+b*O,r[11]=v*A+y*S+_*R+b*N,r[15]=v*E+y*C+_*D+b*k,this},multiplyToArray:function(e,t,n){var i=this.elements;return this.multiplyMatrices(e,t),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return Z.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return Z.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return Z.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new Z.Vector3;return function(t,n,i){void 0===n&&(n=0),void 0===i&&(i=t.length);for(var r=0,o=n;r<i;r+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix4(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),rotateAxis:function(e){Z.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return Z.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*s*u-i*l*u-r*a*h+n*l*h+i*a*d-n*s*d)+e[7]*(+t*s*d-t*l*h+r*o*h-i*o*d+i*l*c-r*s*c)+e[11]*(+t*l*u-t*a*d-r*o*u+n*o*d+r*a*c-n*l*c)+e[15]*(-i*a*c-t*s*u+t*a*h+i*o*u-n*o*h+n*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e=new Z.Vector3;return function(){Z.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,i=e.elements,r=i[0],o=i[4],a=i[8],s=i[12],l=i[1],c=i[5],u=i[9],h=i[13],d=i[2],f=i[6],p=i[10],m=i[14],g=i[3],v=i[7],y=i[11],_=i[15];n[0]=u*m*v-h*p*v+h*f*y-c*m*y-u*f*_+c*p*_,n[4]=s*p*v-a*m*v-s*f*y+o*m*y+a*f*_-o*p*_,n[8]=a*h*v-s*u*v+s*c*y-o*h*y-a*c*_+o*u*_,n[12]=s*u*f-a*h*f-s*c*p+o*h*p+a*c*m-o*u*m,n[1]=h*p*g-u*m*g-h*d*y+l*m*y+u*d*_-l*p*_,n[5]=a*m*g-s*p*g+s*d*y-r*m*y-a*d*_+r*p*_,n[9]=s*u*g-a*h*g-s*l*y+r*h*y+a*l*_-r*u*_,n[13]=a*h*d-s*u*d+s*l*p-r*h*p-a*l*m+r*u*m,n[2]=c*m*g-h*f*g+h*d*v-l*m*v-c*d*_+l*f*_,n[6]=s*f*g-o*m*g-s*d*v+r*m*v+o*d*_-r*f*_,n[10]=o*h*g-s*c*g+s*l*v-r*h*v-o*l*_+r*c*_,n[14]=s*c*d-o*h*d-s*l*f+r*h*f+o*l*m-r*c*m,n[3]=u*f*g-c*p*g-u*d*v+l*p*v+c*d*y-l*f*y,n[7]=o*p*g-a*f*g+a*d*v-r*p*v-o*d*y+r*f*y,n[11]=a*c*g-o*u*g-a*l*v+r*u*v+o*l*y-r*c*y,n[15]=o*u*d-a*c*d+a*l*f-r*u*f-o*l*p+r*c*p;var b=r*n[0]+l*n[4]+d*n[8]+g*n[12];if(0==b){var x="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(x);return Z.warn(x),this.identity(),this}return this.multiplyScalar(1/b),this},translate:function(e){Z.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){Z.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){Z.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){Z.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){Z.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(n,i)))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,c=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,c*a+n,c*s-i*o,0,l*s-i*a,c*s+i*o,r*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var e=new Z.Vector3,t=new Z.Matrix4;return function(n,i,r){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),n.x=o[12],n.y=o[13],n.z=o[14],t.elements.set(this.elements);var c=1/a,u=1/s,h=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,i.setFromRotationMatrix(t),r.x=a,r.y=s,r.z=l,this}}(),makeFrustum:function(e,t,n,i,r,o){var a=this.elements,s=2*r/(t-e),l=2*r/(i-n),c=(t+e)/(t-e),u=(i+n)/(i-n),h=-(o+r)/(o-r),d=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,n,i){var r=n*Math.tan(Z.Math.degToRad(.5*e)),o=-r,a=o*t,s=r*t;return this.makeFrustum(a,s,o,r,n,i)},makeOrthographic:function(e,t,n,i,r,o){var a=this.elements,s=t-e,l=n-i,c=o-r,u=(t+e)/s,h=(n+i)/l,d=(o+r)/c;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2/l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2/c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new Z.Matrix4).fromArray(this.elements)}},Z.Ray=function(e,t){this.origin=void 0!==e?e:new Z.Vector3,this.direction=void 0!==t?t:new Z.Vector3},Z.Ray.prototype={constructor:Z.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new Z.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new Z.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var n=t||new Z.Vector3;n.subVectors(e,this.origin);var i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(){var e=new Z.Vector3;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:(g=new Z.Vector3,v=new Z.Vector3,y=new Z.Vector3,function(e,t,n,i){g.copy(e).add(t).multiplyScalar(.5),v.copy(t).sub(e).normalize(),y.copy(this.origin).sub(g);var r,o,a,s,l=.5*e.distanceTo(t),c=-this.direction.dot(v),u=y.dot(this.direction),h=-y.dot(v),d=y.lengthSq(),f=Math.abs(1-c*c);if(f>0)if(o=c*u-h,s=l*f,(r=c*h-u)>=0)if(o>=-s)if(o<=s){var p=1/f;a=(r*=p)*(r+c*(o*=p)+2*u)+o*(c*r+o+2*h)+d}else o=l,a=-(r=Math.max(0,-(c*o+u)))*r+o*(o+2*h)+d;else o=-l,a=-(r=Math.max(0,-(c*o+u)))*r+o*(o+2*h)+d;else o<=-s?a=-(r=Math.max(0,-(-c*l+u)))*r+(o=r>0?-l:Math.min(Math.max(-l,-h),l))*(o+2*h)+d:o<=s?(r=0,a=(o=Math.min(Math.max(-l,-h),l))*(o+2*h)+d):a=-(r=Math.max(0,-(c*l+u)))*r+(o=r>0?l:Math.min(Math.max(-l,-h),l))*(o+2*h)+d;else o=c>0?-l:l,a=-(r=Math.max(0,-(c*o+u)))*r+o*(o+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(v).multiplyScalar(o).add(g),a}),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new Z.Vector3;return function(t,n){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),r=e.dot(e)-i*i,o=t.radius*t.radius;if(r>o)return null;var a=Math.sqrt(o-r),s=i-a,l=i+a;return s<0&&l<0?null:s<0?this.at(l,n):this.at(s,n)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},isIntersectionBox:(m=new Z.Vector3,function(e){return null!==this.intersectBox(e,m)}),intersectBox:function(e,t){var n,i,r,o,a,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),u>=0?(a=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||a>i?null:((a>n||n!=n)&&(n=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))},intersectTriangle:function(){var e=new Z.Vector3,t=new Z.Vector3,n=new Z.Vector3,i=new Z.Vector3;return function(r,o,a,s,l){t.subVectors(o,r),n.subVectors(a,r),i.crossVectors(t,n);var c,u=this.direction.dot(i);if(u>0){if(s)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,r);var h=c*this.direction.dot(n.crossVectors(e,n));if(h<0)return null;var d=c*this.direction.dot(t.cross(e));if(d<0)return null;if(h+d>u)return null;var f=-c*e.dot(i);return f<0?null:this.at(f/u,l)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new Z.Ray).copy(this)}},Z.Sphere=function(e,t){this.center=void 0!==e?e:new Z.Vector3,this.radius=void 0!==t?t:0},Z.Sphere.prototype={constructor:Z.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(_=new Z.Box3,function(e,t){var n=this.center;void 0!==t?n.copy(t):_.setFromPoints(e).center(n);for(var i=0,r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var n=this.center.distanceToSquared(e),i=t||new Z.Vector3;return i.copy(e),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new Z.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new Z.Sphere).copy(this)}},Z.Frustum=function(e,t,n,i,r,o){this.planes=[void 0!==e?e:new Z.Plane,void 0!==t?t:new Z.Plane,void 0!==n?n:new Z.Plane,void 0!==i?i:new Z.Plane,void 0!==r?r:new Z.Plane,void 0!==o?o:new Z.Plane]},Z.Frustum.prototype={constructor:Z.Frustum,set:function(e,t,n,i,r,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],f=n[10],p=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(a-i,u-s,p-h,y-m).normalize(),t[1].setComponents(a+i,u+s,p+h,y+m).normalize(),t[2].setComponents(a+r,u+l,p+d,y+g).normalize(),t[3].setComponents(a-r,u-l,p-d,y-g).normalize(),t[4].setComponents(a-o,u-c,p-f,y-v).normalize(),t[5].setComponents(a+o,u+c,p+f,y+v).normalize(),this},intersectsObject:(w=new Z.Sphere,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),w.copy(t.boundingSphere),w.applyMatrix4(e.matrixWorld),this.intersectsSphere(w)}),intersectsSphere:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0},intersectsBox:(b=new Z.Vector3,x=new Z.Vector3,function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];b.x=i.normal.x>0?e.min.x:e.max.x,x.x=i.normal.x>0?e.max.x:e.min.x,b.y=i.normal.y>0?e.min.y:e.max.y,x.y=i.normal.y>0?e.max.y:e.min.y,b.z=i.normal.z>0?e.min.z:e.max.z,x.z=i.normal.z>0?e.max.z:e.min.z;var r=i.distanceToPoint(b),o=i.distanceToPoint(x);if(r<0&&o<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new Z.Frustum).copy(this)}},Z.Plane=function(e,t){this.normal=void 0!==e?e:new Z.Vector3(1,0,0),this.constant=void 0!==t?t:0},Z.Plane.prototype={constructor:Z.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new Z.Vector3,t=new Z.Vector3;return function(n,i,r){var o=e.subVectors(r,i).cross(t.subVectors(n,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,n),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e);return(t||new Z.Vector3).copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectLine:function(){var e=new Z.Vector3;return function(t,n){var i=n||new Z.Vector3,r=t.delta(e),o=this.normal.dot(r);if(0==o)return 0==this.distanceToPoint(t.start)?i.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/o;return a<0||a>1?void 0:i.copy(r).multiplyScalar(a).add(t.start)}}(),coplanarPoint:function(e){return(e||new Z.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new Z.Vector3,t=new Z.Vector3,n=new Z.Matrix3;return function(i,r){var o=r||n.getNormalMatrix(i),a=e.copy(this.normal).applyMatrix3(o);a.normalize();var s=this.coplanarPoint(t);return s.applyMatrix4(i),this.setFromNormalAndCoplanarPoint(a,s),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new Z.Plane).copy(this)}},Z.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),i=0;return function(){for(var r=0;r<36;r++)8==r||13==r||18==r||23==r?n[r]="-":14==r?n[r]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,n[r]=t[19==r?3&e|8:e]);return n.join("")}}(),clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return Math.floor(this.randFloat(e,t))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:(E=Math.PI/180,function(e){return e*E}),radToDeg:(A=180/Math.PI,function(e){return e*A}),isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},Z.Spline=function(e){this.points=e;var t,n,i,r,o,a,s,l,c,u=[],h={x:0,y:0,z:0};function d(e,t,n,i,r,o,a){var s=.5*(n-e),l=.5*(i-t);return(2*(t-n)+s+l)*a+(-3*(t-n)-2*s-l)*o+s*r+t}this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return t=(this.points.length-1)*e,n=Math.floor(t),i=t-n,u[0]=0===n?n:n-1,u[1]=n,u[2]=n>this.points.length-2?this.points.length-1:n+1,u[3]=n>this.points.length-3?this.points.length-1:n+2,a=this.points[u[0]],s=this.points[u[1]],l=this.points[u[2]],c=this.points[u[3]],o=i*(r=i*i),h.x=d(a.x,s.x,l.x,c.x,i,r,o),h.y=d(a.y,s.y,l.y,c.y,i,r,o),h.z=d(a.z,s.z,l.z,c.z,i,r,o),h},this.getControlPointsArray=function(){var e,t,n=this.points.length,i=[];for(e=0;e<n;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,n,i,r,o=0,a=0,s=0,l=new Z.Vector3,c=new Z.Vector3,u=[],h=0;for(u[0]=0,e||(e=100),i=this.points.length*e,l.copy(this.points[0]),t=1;t<i;t++)n=t/i,r=this.getPoint(n),c.copy(r),h+=c.distanceTo(l),l.copy(r),o=(this.points.length-1)*n,(a=Math.floor(o))!=s&&(u[a]=h,s=a);return u[u.length]=h,{chunks:u,total:h}},this.reparametrizeByArcLength=function(e){var t,n,i,r,o,a,s,l,c=[],u=new Z.Vector3,h=this.getLength();for(c.push(u.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=h.chunks[t]-h.chunks[t-1],s=Math.ceil(e*a/h.total),r=(t-1)/(this.points.length-1),o=t/(this.points.length-1),n=1;n<s-1;n++)i=r+n*(1/s)*(o-r),l=this.getPoint(i),c.push(u.copy(l).clone());c.push(u.copy(this.points[t]).clone())}this.points=c}},Z.Triangle=function(e,t,n){this.a=void 0!==e?e:new Z.Vector3,this.b=void 0!==t?t:new Z.Vector3,this.c=void 0!==n?n:new Z.Vector3},Z.Triangle.normal=(T=new Z.Vector3,function(e,t,n,i){var r=i||new Z.Vector3;r.subVectors(n,t),T.subVectors(e,t),r.cross(T);var o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}),Z.Triangle.barycoordFromPoint=function(){var e=new Z.Vector3,t=new Z.Vector3,n=new Z.Vector3;return function(i,r,o,a,s){e.subVectors(a,r),t.subVectors(o,r),n.subVectors(i,r);var l=e.dot(e),c=e.dot(t),u=e.dot(n),h=t.dot(t),d=t.dot(n),f=l*h-c*c,p=s||new Z.Vector3;if(0==f)return p.set(-2,-1,-1);var m=1/f,g=(h*u-c*d)*m,v=(l*d-c*u)*m;return p.set(1-g-v,v,g)}}(),Z.Triangle.containsPoint=function(){var e=new Z.Vector3;return function(t,n,i,r){var o=Z.Triangle.barycoordFromPoint(t,n,i,r,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),Z.Triangle.prototype={constructor:Z.Triangle,set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new Z.Vector3,t=new Z.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new Z.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return Z.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new Z.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return Z.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Z.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new Z.Triangle).copy(this)}},Z.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},Z.Clock.prototype={constructor:Z.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},Z.EventDispatcher=function(){},Z.EventDispatcher.prototype={constructor:Z.EventDispatcher,apply:function(e){e.addEventListener=Z.EventDispatcher.prototype.addEventListener,e.hasEventListener=Z.EventDispatcher.prototype.hasEventListener,e.removeEventListener=Z.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=Z.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=[],i=t.length,r=0;r<i;r++)n[r]=t[r];for(r=0;r<i;r++)n[r].call(this,e)}}}},function(e){e.Raycaster=function(t,n,i,r){this.ray=new e.Ray(t,n),this.near=i||0,this.far=r||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var t=function(e,t){return e.distance-t.distance},n=function(e,t,i,r){if(e.raycast(t,i),!0===r)for(var o=e.children,a=0,s=o.length;a<s;a++)n(o[a],t,i,!0)};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,n){n instanceof e.PerspectiveCamera?(this.ray.origin.copy(n.position),this.ray.direction.set(t.x,t.y,.5).unproject(n).sub(n.position).normalize()):n instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld)):e.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,i){var r=[];return n(e,this,r,i),r.sort(t),r},intersectObjects:function(i,r){var o=[];if(i instanceof Array==!1)return e.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(var a=0,s=i.length;a<s;a++)n(i[a],this,o,r);return o.sort(t),o}}}(Z),Z.Object3D=function(){Object.defineProperty(this,"id",{value:Z.Object3DIdCount++}),this.uuid=Z.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=void 0,this.children=[],this.up=Z.Object3D.DefaultUp.clone();var e=new Z.Vector3,t=new Z.Euler,n=new Z.Quaternion,i=new Z.Vector3(1,1,1);t.onChange(function(){n.setFromEuler(t,!1)}),n.onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:i}}),this.rotationAutoUpdate=!0,this.matrix=new Z.Matrix4,this.matrixWorld=new Z.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},Z.Object3D.DefaultUp=new Z.Vector3(0,1,0),Z.Object3D.prototype={constructor:Z.Object3D,get eulerOrder(){return Z.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){Z.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){Z.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){Z.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(P=new Z.Quaternion,function(e,t){return P.setFromAxisAngle(e,t),this.quaternion.multiply(P),this}),rotateX:function(){var e=new Z.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new Z.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new Z.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new Z.Vector3;return function(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translate:function(e,t){return Z.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new Z.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new Z.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new Z.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(C=new Z.Matrix4,function(e){return e.applyMatrix4(C.getInverse(this.matrixWorld))}),lookAt:function(){var e=new Z.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(Z.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof Z.Object3D?(void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):Z.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var n=this.children.indexOf(e);-1!==n&&(e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(n,1))},getChildByName:function(e){return Z.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){var t=e||new Z.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(M=new Z.Vector3,S=new Z.Vector3,function(e){var t=e||new Z.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(M,t,S),t}),getWorldRotation:function(){var e=new Z.Quaternion;return function(t){var n=t||new Z.Euler;return this.getWorldQuaternion(e),n.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new Z.Vector3,t=new Z.Quaternion;return function(n){var i=n||new Z.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,i),i}}(),getWorldDirection:function(){var e=new Z.Quaternion;return function(t){var n=t||new Z.Vector3;return this.getWorldQuaternion(e),n.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverseVisible(e)}},traverseAncestors:function(e){this.parent&&(e(this.parent),this.parent.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},t={},n={},i=function(t){if(void 0===e.materials&&(e.materials=[]),void 0===n[t.uuid]){var i=t.toJSON();delete i.metadata,n[t.uuid]=i,e.materials.push(i)}return t.uuid};return e.object=function n(r){var o={};if(o.uuid=r.uuid,o.type=r.type,""!==r.name&&(o.name=r.name),"{}"!==JSON.stringify(r.userData)&&(o.userData=r.userData),!0!==r.visible&&(o.visible=r.visible),r instanceof Z.PerspectiveCamera?(o.fov=r.fov,o.aspect=r.aspect,o.near=r.near,o.far=r.far):r instanceof Z.OrthographicCamera?(o.left=r.left,o.right=r.right,o.top=r.top,o.bottom=r.bottom,o.near=r.near,o.far=r.far):r instanceof Z.AmbientLight?o.color=r.color.getHex():r instanceof Z.DirectionalLight?(o.color=r.color.getHex(),o.intensity=r.intensity):r instanceof Z.PointLight?(o.color=r.color.getHex(),o.intensity=r.intensity,o.distance=r.distance,o.decay=r.decay):r instanceof Z.SpotLight?(o.color=r.color.getHex(),o.intensity=r.intensity,o.distance=r.distance,o.angle=r.angle,o.exponent=r.exponent,o.decay=r.decay):r instanceof Z.HemisphereLight?(o.color=r.color.getHex(),o.groundColor=r.groundColor.getHex()):r instanceof Z.Mesh||r instanceof Z.Line||r instanceof Z.PointCloud?(o.geometry=function(n){if(void 0===e.geometries&&(e.geometries=[]),void 0===t[n.uuid]){var i=n.toJSON();delete i.metadata,t[n.uuid]=i,e.geometries.push(i)}return n.uuid}(r.geometry),o.material=i(r.material),r instanceof Z.Line&&(o.mode=r.mode)):r instanceof Z.Sprite&&(o.material=i(r.material)),o.matrix=r.matrix.toArray(),r.children.length>0){o.children=[];for(var a=0;a<r.children.length;a++)o.children.push(n(r.children[a]))}return o}(this),e},clone:function(e,t){if(void 0===e&&(e=new Z.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),!0===t)for(var n=0;n<this.children.length;n++){var i=this.children[n];e.add(i.clone())}return e}},Z.EventDispatcher.prototype.apply(Z.Object3D.prototype),Z.Object3DIdCount=0,Z.Face3=function(e,t,n,i,r,o){this.a=e,this.b=t,this.c=n,this.normal=i instanceof Z.Vector3?i:new Z.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=r instanceof Z.Color?r:new Z.Color,this.vertexColors=r instanceof Array?r:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0},Z.Face3.prototype={constructor:Z.Face3,clone:function(){var e=new Z.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;for(var t=0,n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},Z.Face4=function(e,t,n,i,r,o,a){return Z.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Z.Face3(e,t,n,r,o,a)},Z.BufferAttribute=function(e,t){this.array=e,this.itemSize=t,this.needsUpdate=!1},Z.BufferAttribute.prototype={constructor:Z.BufferAttribute,get length(){return this.array.length},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},setX:function(e,t){return this.array[e*this.itemSize]=t,this},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this},clone:function(){return new Z.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}},Z.Int8Attribute=function(e,t){return Z.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Z.BufferAttribute(e,t)},Z.Uint8Attribute=function(e,t){return Z.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Z.BufferAttribute(e,t)},Z.Uint8ClampedAttribute=function(e,t){return Z.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Z.BufferAttribute(e,t)},Z.Int16Attribute=function(e,t){return Z.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Z.BufferAttribute(e,t)},Z.Uint16Attribute=function(e,t){return Z.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Z.BufferAttribute(e,t)},Z.Int32Attribute=function(e,t){return Z.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Z.BufferAttribute(e,t)},Z.Uint32Attribute=function(e,t){return Z.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Z.BufferAttribute(e,t)},Z.Float32Attribute=function(e,t){return Z.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Z.BufferAttribute(e,t)},Z.Float64Attribute=function(e,t){return Z.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Z.BufferAttribute(e,t)},Z.DynamicBufferAttribute=function(e,t){Z.BufferAttribute.call(this,e,t),this.updateRange={offset:0,count:-1}},Z.DynamicBufferAttribute.prototype=Object.create(Z.BufferAttribute.prototype),Z.DynamicBufferAttribute.prototype.constructor=Z.DynamicBufferAttribute,Z.DynamicBufferAttribute.prototype.clone=function(){return new Z.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)},Z.BufferGeometry=function(){Object.defineProperty(this,"id",{value:Z.GeometryIdCount++}),this.uuid=Z.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},Z.BufferGeometry.prototype={constructor:Z.BufferGeometry,addAttribute:function(e,t){if(t instanceof Z.BufferAttribute==!1)return Z.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void(this.attributes[e]={array:arguments[1],itemSize:arguments[2]});this.attributes[e]=t,this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,n){this.drawcalls.push({start:e,count:t,index:void 0!==n?n:0})},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var n=this.attributes.normal;void 0!==n&&((new Z.Matrix3).getNormalMatrix(e).applyToVector3Array(n.array),n.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.applyMatrix((new Z.Matrix4).setPosition(e)),e},fromGeometry:function(e,t){t=t||{vertexColors:Z.NoColors};var n=e.vertices,i=e.faces,r=e.faceVertexUvs,o=t.vertexColors,a=r[0].length>0,s=3==i[0].vertexNormals.length,l=new Float32Array(3*i.length*3);this.addAttribute("position",new Z.BufferAttribute(l,3));var c=new Float32Array(3*i.length*3);if(this.addAttribute("normal",new Z.BufferAttribute(c,3)),o!==Z.NoColors){var u=new Float32Array(3*i.length*3);this.addAttribute("color",new Z.BufferAttribute(u,3))}if(!0===a){var h=new Float32Array(3*i.length*2);this.addAttribute("uv",new Z.BufferAttribute(h,2))}for(var d=0,f=0,p=0;d<i.length;d++,f+=6,p+=9){var m=i[d],g=n[m.a],v=n[m.b],y=n[m.c];if(l[p]=g.x,l[p+1]=g.y,l[p+2]=g.z,l[p+3]=v.x,l[p+4]=v.y,l[p+5]=v.z,l[p+6]=y.x,l[p+7]=y.y,l[p+8]=y.z,!0===s){var _=m.vertexNormals[0],b=m.vertexNormals[1],x=m.vertexNormals[2];c[p]=_.x,c[p+1]=_.y,c[p+2]=_.z,c[p+3]=b.x,c[p+4]=b.y,c[p+5]=b.z,c[p+6]=x.x,c[p+7]=x.y,c[p+8]=x.z}else{var w=m.normal;c[p]=w.x,c[p+1]=w.y,c[p+2]=w.z,c[p+3]=w.x,c[p+4]=w.y,c[p+5]=w.z,c[p+6]=w.x,c[p+7]=w.y,c[p+8]=w.z}if(o===Z.FaceColors){var A=m.color;u[p]=A.r,u[p+1]=A.g,u[p+2]=A.b,u[p+3]=A.r,u[p+4]=A.g,u[p+5]=A.b,u[p+6]=A.r,u[p+7]=A.g,u[p+8]=A.b}else if(o===Z.VertexColors){var E=m.vertexColors[0],T=m.vertexColors[1],M=m.vertexColors[2];u[p]=E.r,u[p+1]=E.g,u[p+2]=E.b,u[p+3]=T.r,u[p+4]=T.g,u[p+5]=T.b,u[p+6]=M.r,u[p+7]=M.g,u[p+8]=M.b}if(!0===a){var S=r[0][d][0],C=r[0][d][1],P=r[0][d][2];h[f]=S.x,h[f+1]=S.y,h[f+2]=C.x,h[f+3]=C.y,h[f+4]=P.x,h[f+5]=P.y}}return this.computeBoundingSphere(),this},computeBoundingBox:(L=new Z.Vector3,function(){null===this.boundingBox&&(this.boundingBox=new Z.Box3);var e=this.attributes.position.array;if(e){var t=this.boundingBox;t.makeEmpty();for(var n=0,i=e.length;n<i;n+=3)L.set(e[n],e[n+1],e[n+2]),t.expandByPoint(L)}void 0!==e&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Z.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}),computeBoundingSphere:function(){var e=new Z.Box3,t=new Z.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new Z.Sphere);var n=this.attributes.position.array;if(n){e.makeEmpty();for(var i=this.boundingSphere.center,r=0,o=n.length;r<o;r+=3)t.set(n[r],n[r+1],n[r+2]),e.expandByPoint(t);e.center(i);var a=0;for(r=0,o=n.length;r<o;r+=3)t.set(n[r],n[r+1],n[r+2]),a=Math.max(a,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&Z.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new Z.BufferAttribute(new Float32Array(t.length),3));else for(var n=0,i=(s=e.normal.array).length;n<i;n++)s[n]=0;var r,o,a,s=e.normal.array,l=new Z.Vector3,c=new Z.Vector3,u=new Z.Vector3,h=new Z.Vector3,d=new Z.Vector3;if(e.index)for(var f=e.index.array,p=this.offsets.length>0?this.offsets:[{start:0,count:f.length,index:0}],m=0,g=p.length;m<g;++m){var v=p[m].start,y=p[m].count,_=p[m].index;for(n=v,i=v+y;n<i;n+=3)r=3*(_+f[n]),o=3*(_+f[n+1]),a=3*(_+f[n+2]),l.fromArray(t,r),c.fromArray(t,o),u.fromArray(t,a),h.subVectors(u,c),d.subVectors(l,c),h.cross(d),s[r]+=h.x,s[r+1]+=h.y,s[r+2]+=h.z,s[o]+=h.x,s[o+1]+=h.y,s[o+2]+=h.z,s[a]+=h.x,s[a+1]+=h.y,s[a+2]+=h.z}else for(n=0,i=t.length;n<i;n+=9)l.fromArray(t,n),c.fromArray(t,n+3),u.fromArray(t,n+6),h.subVectors(u,c),d.subVectors(l,c),h.cross(d),s[n]=h.x,s[n+1]=h.y,s[n+2]=h.z,s[n+3]=h.x,s[n+4]=h.y,s[n+5]=h.z,s[n+6]=h.x,s[n+7]=h.y,s[n+8]=h.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},computeTangents:function(){if(void 0!==this.attributes.index&&void 0!==this.attributes.position&&void 0!==this.attributes.normal&&void 0!==this.attributes.uv){var e=this.attributes.index.array,t=this.attributes.position.array,n=this.attributes.normal.array,i=this.attributes.uv.array,r=t.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new Z.BufferAttribute(new Float32Array(4*r),4));for(var o=this.attributes.tangent.array,a=[],s=[],l=0;l<r;l++)a[l]=new Z.Vector3,s[l]=new Z.Vector3;var c,u,h,d,f,p,m,g,v,y,_,b,x,w,A,E,T,M,S=new Z.Vector3,C=new Z.Vector3,P=new Z.Vector3,L=new Z.Vector2,R=new Z.Vector2,D=new Z.Vector2,I=new Z.Vector3,O=new Z.Vector3;0===this.drawcalls.length&&this.addDrawCall(0,e.length,0);var N,k,V,F=this.drawcalls;for(w=0,A=F.length;w<A;++w){var B=F[w].start,U=F[w].count,z=F[w].index;for(b=B,x=B+U;b<x;b+=3)E=z+e[b],T=z+e[b+1],M=z+e[b+2],N=E,k=T,V=M,S.fromArray(t,3*N),C.fromArray(t,3*k),P.fromArray(t,3*V),L.fromArray(i,2*N),R.fromArray(i,2*k),D.fromArray(i,2*V),c=C.x-S.x,u=P.x-S.x,h=C.y-S.y,d=P.y-S.y,f=C.z-S.z,p=P.z-S.z,m=R.x-L.x,g=D.x-L.x,v=R.y-L.y,y=D.y-L.y,_=1/(m*y-g*v),I.set((y*c-v*u)*_,(y*h-v*d)*_,(y*f-v*p)*_),O.set((m*u-g*c)*_,(m*d-g*h)*_,(m*p-g*f)*_),a[N].add(I),a[k].add(I),a[V].add(I),s[N].add(O),s[k].add(O),s[V].add(O)}var G,H,W,j=new Z.Vector3,X=new Z.Vector3,q=new Z.Vector3,Y=new Z.Vector3;for(w=0,A=F.length;w<A;++w){B=F[w].start,U=F[w].count,z=F[w].index;for(b=B,x=B+U;b<x;b+=3)E=z+e[b],T=z+e[b+1],M=z+e[b+2],K(E),K(T),K(M)}}else Z.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function K(e){q.fromArray(n,3*e),Y.copy(q),H=a[e],j.copy(H),j.sub(q.multiplyScalar(q.dot(H))).normalize(),X.crossVectors(Y,H),W=X.dot(s[e]),G=W<0?-1:1,o[4*e]=j.x,o[4*e+1]=j.y,o[4*e+2]=j.z,o[4*e+3]=G}},computeOffsets:function(e){void 0===e&&(e=65535);for(var t=this.attributes.index.array,n=this.attributes.position.array,i=t.length/3,r=new Uint16Array(t.length),o=0,a=0,s=[{start:0,count:0,index:0}],l=s[0],c=0,u=new Int32Array(6),h=new Int32Array(n.length),d=new Int32Array(n.length),f=0;f<n.length;f++)h[f]=-1,d[f]=-1;for(var p=0;p<i;p++){c=0;for(var m=0;m<3;m++){-1==h[_=t[3*p+m]]?(u[2*m]=_,u[2*m+1]=-1,c++):h[_]<l.index?(u[2*m]=_,u[2*m+1]=-1,0):(u[2*m]=_,u[2*m+1]=h[_])}if(a+c>l.index+e){var g={start:o,count:0,index:a};s.push(g),l=g;for(var v=0;v<6;v+=2){(y=u[v+1])>-1&&y<l.index&&(u[v+1]=-1)}}for(v=0;v<6;v+=2){var y,_=u[v];-1===(y=u[v+1])&&(y=a++),h[_]=y,d[y]=_,r[o++]=y-l.index,l.count++}}return this.reorderBuffers(r,d,a),this.offsets=s,this.drawcalls=s,s},merge:function(e,t){if(e instanceof Z.BufferGeometry!=!1){void 0===t&&(t=0);var n=this.attributes;for(var i in n)if(void 0!==e.attributes[i])for(var r=n[i].array,o=e.attributes[i],a=o.array,s=0,l=o.itemSize*t;s<a.length;s++,l++)r[l]=a[s];return this}Z.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e,t,n,i,r=this.attributes.normal.array,o=0,a=r.length;o<a;o+=3)e=r[o],t=r[o+1],n=r[o+2],i=1/Math.sqrt(e*e+t*t+n*n),r[o]*=i,r[o+1]*=i,r[o+2]*=i},reorderBuffers:function(e,t,n){var i={};for(var r in this.attributes)if("index"!=r){var o=this.attributes[r].array;i[r]=new o.constructor(this.attributes[r].itemSize*n)}for(var a=0;a<n;a++){var s=t[a];for(var r in this.attributes)if("index"!=r)for(var l=this.attributes[r].array,c=this.attributes[r].itemSize,u=i[r],h=0;h<c;h++)u[a*c+h]=l[s*c+h]}for(var r in this.attributes.index.array=e,this.attributes)"index"!=r&&(this.attributes[r].array=i[r],this.attributes[r].numItems=this.attributes[r].itemSize*n)},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},t=this.attributes,n=this.offsets,i=this.boundingSphere;for(var r in t){var o=t[r],a=Array.prototype.slice.call(o.array);e.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:a}}return n.length>0&&(e.data.offsets=JSON.parse(JSON.stringify(n))),null!==i&&(e.data.boundingSphere={center:i.center.toArray(),radius:i.radius}),e},clone:function(){var e=new Z.BufferGeometry;for(var t in this.attributes){var n=this.attributes[t];e.addAttribute(t,n.clone())}for(var i=0,r=this.offsets.length;i<r;i++){var o=this.offsets[i];e.offsets.push({start:o.start,index:o.index,count:o.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},Z.EventDispatcher.prototype.apply(Z.BufferGeometry.prototype),Z.Geometry=function(){Object.defineProperty(this,"id",{value:Z.GeometryIdCount++}),this.uuid=Z.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},Z.Geometry.prototype={constructor:Z.Geometry,applyMatrix:function(e){for(var t=(new Z.Matrix3).getNormalMatrix(e),n=0,i=this.vertices.length;n<i;n++){this.vertices[n].applyMatrix4(e)}for(n=0,i=this.faces.length;n<i;n++){var r=this.faces[n];r.normal.applyMatrix3(t).normalize();for(var o=0,a=r.vertexNormals.length;o<a;o++)r.vertexNormals[o].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},fromBufferGeometry:function(e){for(var t=this,n=e.attributes,i=n.position.array,r=void 0!==n.index?n.index.array:void 0,o=void 0!==n.normal?n.normal.array:void 0,a=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,l=[],c=[],u=0,h=0;u<i.length;u+=3,h+=2)t.vertices.push(new Z.Vector3(i[u],i[u+1],i[u+2])),void 0!==o&&l.push(new Z.Vector3(o[u],o[u+1],o[u+2])),void 0!==a&&t.colors.push(new Z.Color(a[u],a[u+1],a[u+2])),void 0!==s&&c.push(new Z.Vector2(s[h],s[h+1]));var d=function(e,n,i){var r=void 0!==o?[l[e].clone(),l[n].clone(),l[i].clone()]:[],u=void 0!==a?[t.colors[e].clone(),t.colors[n].clone(),t.colors[i].clone()]:[];t.faces.push(new Z.Face3(e,n,i,r,u)),void 0!==s&&t.faceVertexUvs[0].push([c[e].clone(),c[n].clone(),c[i].clone()])};if(void 0!==r){var f=e.drawcalls;if(f.length>0)for(u=0;u<f.length;u++)for(var p=f[u],m=p.start,g=p.count,v=p.index,y=(h=m,m+g);h<y;h+=3)d(v+r[h],v+r[h+1],v+r[h+2]);else for(u=0;u<r.length;u+=3)d(r[u],r[u+1],r[u+2])}else for(u=0;u<i.length/3;u+=3)d(u,u+1,u+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.applyMatrix((new Z.Matrix4).setPosition(e)),e},computeFaceNormals:function(){for(var e=new Z.Vector3,t=new Z.Vector3,n=0,i=this.faces.length;n<i;n++){var r=this.faces[n],o=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){var t,n,i,r,o,a;for(a=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)a[t]=new Z.Vector3;if(e){var s,l,c,u=new Z.Vector3,h=new Z.Vector3;for(i=0,r=this.faces.length;i<r;i++)o=this.faces[i],s=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],u.subVectors(c,l),h.subVectors(s,l),u.cross(h),a[o.a].add(u),a[o.b].add(u),a[o.c].add(u)}else for(i=0,r=this.faces.length;i<r;i++)a[(o=this.faces[i]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,n=this.vertices.length;t<n;t++)a[t].normalize();for(i=0,r=this.faces.length;i<r;i++)(o=this.faces[i]).vertexNormals[0]=a[o.a].clone(),o.vertexNormals[1]=a[o.b].clone(),o.vertexNormals[2]=a[o.c].clone()},computeMorphNormals:function(){var e,t,n,i,r;for(n=0,i=this.faces.length;n<i;n++)for((r=this.faces[n]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;e<t;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var o=new Z.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(n=0,i=this.faces.length;n<i;n++)l=new Z.Vector3,c={a:new Z.Vector3,b:new Z.Vector3,c:new Z.Vector3},a.push(l),s.push(c)}var l,c,u=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,i=this.faces.length;n<i;n++)r=this.faces[n],l=u.faceNormals[n],c=u.vertexNormals[n],l.copy(r.normal),c.a.copy(r.vertexNormals[0]),c.b.copy(r.vertexNormals[1]),c.c.copy(r.vertexNormals[2])}for(n=0,i=this.faces.length;n<i;n++)(r=this.faces[n]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeTangents:function(){var e,t,n,i,r,o,a,s,l,c,u,h,d,f,p,m,g,v,y,_,b,x,w,A,E,T,M,S,C,P,L,R,D,I,O=[],N=[],k=new Z.Vector3,V=new Z.Vector3,F=new Z.Vector3,B=new Z.Vector3,U=new Z.Vector3;for(n=0,i=this.vertices.length;n<i;n++)O[n]=new Z.Vector3,N[n]=new Z.Vector3;for(e=0,t=this.faces.length;e<t;e++)a=this.faces[e],s=this.faceVertexUvs[0][e],S=this,C=a.a,P=a.b,L=a.c,R=0,D=1,I=2,l=S.vertices[C],c=S.vertices[P],u=S.vertices[L],h=s[R],d=s[D],f=s[I],p=c.x-l.x,m=u.x-l.x,g=c.y-l.y,v=u.y-l.y,y=c.z-l.z,_=u.z-l.z,b=d.x-h.x,x=f.x-h.x,w=d.y-h.y,A=f.y-h.y,E=1/(b*A-x*w),k.set((A*p-w*m)*E,(A*g-w*v)*E,(A*y-w*_)*E),V.set((b*m-x*p)*E,(b*v-x*g)*E,(b*_-x*y)*E),O[C].add(k),O[P].add(k),O[L].add(k),N[C].add(V),N[P].add(V),N[L].add(V);var z=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++)for(a=this.faces[e],r=0;r<Math.min(a.vertexNormals.length,3);r++)U.copy(a.vertexNormals[r]),o=a[z[r]],T=O[o],F.copy(T),F.sub(U.multiplyScalar(U.dot(T))).normalize(),B.crossVectors(a.vertexNormals[r],T),M=B.dot(N[o])<0?-1:1,a.vertexTangents[r]=new Z.Vector4(F.x,F.y,F.z,M);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,n=0,i=t.length;n<i;n++)n>0&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Z.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Z.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e instanceof Z.Geometry!=!1){var i,r=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0];void 0===n&&(n=0),void 0!==t&&(i=(new Z.Matrix3).getNormalMatrix(t));for(var h=0,d=a.length;h<d;h++){var f=a[h].clone();void 0!==t&&f.applyMatrix4(t),o.push(f)}for(h=0,d=l.length;h<d;h++){var p,m,g,v=l[h],y=v.vertexNormals,_=v.vertexColors;(p=new Z.Face3(v.a+r,v.b+r,v.c+r)).normal.copy(v.normal),void 0!==i&&p.normal.applyMatrix3(i).normalize();for(var b=0,x=y.length;b<x;b++)m=y[b].clone(),void 0!==i&&m.applyMatrix3(i).normalize(),p.vertexNormals.push(m);p.color.copy(v.color);for(b=0,x=_.length;b<x;b++)g=_[b],p.vertexColors.push(g.clone());p.materialIndex=v.materialIndex+n,s.push(p)}for(h=0,d=u.length;h<d;h++){var w=u[h],A=[];if(void 0!==w){for(b=0,x=w.length;b<x;b++)A.push(w[b].clone());c.push(A)}}}else Z.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e instanceof Z.Mesh!=!1?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):Z.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,i,r,o,a,s,l={},c=[],u=[],h=Math.pow(10,4);for(n=0,i=this.vertices.length;n<i;n++)e=this.vertices[n],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=n,c.push(this.vertices[n]),u[n]=c.length-1):u[n]=u[l[t]];var d=[];for(n=0,i=this.faces.length;n<i;n++){(r=this.faces[n]).a=u[r.a],r.b=u[r.b],r.c=u[r.c],o=[r.a,r.b,r.c];for(var f=0;f<3;f++)if(o[f]==o[(f+1)%3]){f,d.push(n);break}}for(n=d.length-1;n>=0;n--){var p=d[n];for(this.faces.splice(p,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(p,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var i=[],r=0;r<this.vertices.length;r++){var o=this.vertices[r];i.push(o.x,o.y,o.z)}var a=[],s=[],l={},c=[],u={},h=[],d={};for(r=0;r<this.faces.length;r++){var f=this.faces[r],p=void 0!==this.faceVertexUvs[0][r],m=f.normal.length()>0,g=f.vertexNormals.length>0,v=1!==f.color.r||1!==f.color.g||1!==f.color.b,y=f.vertexColors.length>0,_=0;if(_=A(_,0,0),_=A(_,1,!1),_=A(_,2,!1),_=A(_,3,p),_=A(_,4,m),_=A(_,5,g),_=A(_,6,v),_=A(_,7,y),a.push(_),a.push(f.a,f.b,f.c),p){var b=this.faceVertexUvs[0][r];a.push(M(b[0]),M(b[1]),M(b[2]))}if(m&&a.push(E(f.normal)),g){var x=f.vertexNormals;a.push(E(x[0]),E(x[1]),E(x[2]))}if(v&&a.push(T(f.color)),y){var w=f.vertexColors;a.push(T(w[0]),T(w[1]),T(w[2]))}}function A(e,t,n){return n?e|1<<t:e&~(1<<t)}function E(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function T(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]?u[t]:(u[t]=c.length,c.push(e.getHex()),u[t])}function M(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]?d[t]:(d[t]=h.length/2,h.push(e.x,e.y),d[t])}return e.data={},e.data.vertices=i,e.data.normals=s,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),e.data.faces=a,e},clone:function(){for(var e=new Z.Geometry,t=this.vertices,n=0,i=t.length;n<i;n++)e.vertices.push(t[n].clone());var r=this.faces;for(n=0,i=r.length;n<i;n++)e.faces.push(r[n].clone());for(n=0,i=this.faceVertexUvs.length;n<i;n++){var o=this.faceVertexUvs[n];void 0===e.faceVertexUvs[n]&&(e.faceVertexUvs[n]=[]);for(var a=0,s=o.length;a<s;a++){for(var l=o[a],c=[],u=0,h=l.length;u<h;u++){var d=l[u];c.push(d.clone())}e.faceVertexUvs[n].push(c)}}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},Z.EventDispatcher.prototype.apply(Z.Geometry.prototype),Z.GeometryIdCount=0,Z.Camera=function(){Z.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Z.Matrix4,this.projectionMatrix=new Z.Matrix4},Z.Camera.prototype=Object.create(Z.Object3D.prototype),Z.Camera.prototype.constructor=Z.Camera,Z.Camera.prototype.getWorldDirection=function(){var e=new Z.Quaternion;return function(t){var n=t||new Z.Vector3;return this.getWorldQuaternion(e),n.set(0,0,-1).applyQuaternion(e)}}(),Z.Camera.prototype.lookAt=function(){var e=new Z.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),Z.Camera.prototype.clone=function(e){return void 0===e&&(e=new Z.Camera),Z.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},Z.CubeCamera=function(e,t,n){Z.Object3D.call(this),this.type="CubeCamera";var i=new Z.PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new Z.Vector3(1,0,0)),this.add(i);var r=new Z.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new Z.Vector3(-1,0,0)),this.add(r);var o=new Z.PerspectiveCamera(90,1,e,t);o.up.set(0,0,1),o.lookAt(new Z.Vector3(0,1,0)),this.add(o);var a=new Z.PerspectiveCamera(90,1,e,t);a.up.set(0,0,-1),a.lookAt(new Z.Vector3(0,-1,0)),this.add(a);var s=new Z.PerspectiveCamera(90,1,e,t);s.up.set(0,-1,0),s.lookAt(new Z.Vector3(0,0,1)),this.add(s);var l=new Z.PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new Z.Vector3(0,0,-1)),this.add(l),this.renderTarget=new Z.WebGLRenderTargetCube(n,n,{format:Z.RGBFormat,magFilter:Z.LinearFilter,minFilter:Z.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,c=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,i,n),n.activeCubeFace=1,e.render(t,r,n),n.activeCubeFace=2,e.render(t,o,n),n.activeCubeFace=3,e.render(t,a,n),n.activeCubeFace=4,e.render(t,s,n),n.generateMipmaps=c,n.activeCubeFace=5,e.render(t,l,n)}},Z.CubeCamera.prototype=Object.create(Z.Object3D.prototype),Z.CubeCamera.prototype.constructor=Z.CubeCamera,Z.OrthographicCamera=function(e,t,n,i,r,o){Z.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},Z.OrthographicCamera.prototype=Object.create(Z.Camera.prototype),Z.OrthographicCamera.prototype.constructor=Z.OrthographicCamera,Z.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(n-e,n+e,i+t,i-t,this.near,this.far)},Z.OrthographicCamera.prototype.clone=function(){var e=new Z.OrthographicCamera;return Z.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},Z.PerspectiveCamera=function(e,t,n,i){Z.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},Z.PerspectiveCamera.prototype=Object.create(Z.Camera.prototype),Z.PerspectiveCamera.prototype.constructor=Z.PerspectiveCamera,Z.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*Z.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},Z.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,i,r,o){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=i,this.width=r,this.height=o,this.updateProjectionMatrix()},Z.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=Z.Math.radToDeg(2*Math.atan(Math.tan(.5*Z.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,n=Math.tan(Z.Math.degToRad(.5*e))*this.near,i=-n,r=t*i,o=t*n,a=Math.abs(o-r),s=Math.abs(n-i);this.projectionMatrix.makeFrustum(r+this.x*a/this.fullWidth,r+(this.x+this.width)*a/this.fullWidth,n-(this.y+this.height)*s/this.fullHeight,n-this.y*s/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},Z.PerspectiveCamera.prototype.clone=function(){var e=new Z.PerspectiveCamera;return Z.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},Z.Light=function(e){Z.Object3D.call(this),this.type="Light",this.color=new Z.Color(e)},Z.Light.prototype=Object.create(Z.Object3D.prototype),Z.Light.prototype.constructor=Z.Light,Z.Light.prototype.clone=function(e){return void 0===e&&(e=new Z.Light),Z.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},Z.AmbientLight=function(e){Z.Light.call(this,e),this.type="AmbientLight"},Z.AmbientLight.prototype=Object.create(Z.Light.prototype),Z.AmbientLight.prototype.constructor=Z.AmbientLight,Z.AmbientLight.prototype.clone=function(){var e=new Z.AmbientLight;return Z.Light.prototype.clone.call(this,e),e},Z.AreaLight=function(e,t){Z.Light.call(this,e),this.type="AreaLight",this.normal=new Z.Vector3(0,-1,0),this.right=new Z.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},Z.AreaLight.prototype=Object.create(Z.Light.prototype),Z.AreaLight.prototype.constructor=Z.AreaLight,Z.DirectionalLight=function(e,t){Z.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.target=new Z.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new Z.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},Z.DirectionalLight.prototype=Object.create(Z.Light.prototype),Z.DirectionalLight.prototype.constructor=Z.DirectionalLight,Z.DirectionalLight.prototype.clone=function(){var e=new Z.DirectionalLight;return Z.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},Z.HemisphereLight=function(e,t,n){Z.Light.call(this,e),this.type="HemisphereLight",this.position.set(0,100,0),this.groundColor=new Z.Color(t),this.intensity=void 0!==n?n:1},Z.HemisphereLight.prototype=Object.create(Z.Light.prototype),Z.HemisphereLight.prototype.constructor=Z.HemisphereLight,Z.HemisphereLight.prototype.clone=function(){var e=new Z.HemisphereLight;return Z.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},Z.PointLight=function(e,t,n,i){Z.Light.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1},Z.PointLight.prototype=Object.create(Z.Light.prototype),Z.PointLight.prototype.constructor=Z.PointLight,Z.PointLight.prototype.clone=function(){var e=new Z.PointLight;return Z.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e.decay=this.decay,e},Z.SpotLight=function(e,t,n,i,r,o){Z.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.target=new Z.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==r?r:10,this.decay=void 0!==o?o:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},Z.SpotLight.prototype=Object.create(Z.Light.prototype),Z.SpotLight.prototype.constructor=Z.SpotLight,Z.SpotLight.prototype.clone=function(){var e=new Z.SpotLight;return Z.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.decay=this.decay,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},Z.Cache={files:{},add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Z.Loader=function(e){this.showStatus=e,this.statusDomElement=e?Z.Loader.prototype.addStatusElement():null,this.imageLoader=new Z.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},Z.Loader.prototype={constructor:Z.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";e.total?t+=(100*e.loaded/e.total).toFixed(0)+"%":t+=(e.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var n=[],i=0;i<e.length;++i)n[i]=this.createMaterial(e[i],t);return n},needsTangents:function(e){for(var t=0,n=e.length;t<n;t++){if(e[t]instanceof Z.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){var n=this;function i(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function r(e,r,o,a,s,l,c){var u,h=t+o,d=Z.Loader.Handlers.get(h);if(null!==d?u=d.load(h):(u=new Z.Texture,(d=n.imageLoader).crossOrigin=n.crossOrigin,d.load(h,function(e){if(!1===Z.Math.isPowerOfTwo(e.width)||!1===Z.Math.isPowerOfTwo(e.height)){var t=i(e.width),n=i(e.height),r=document.createElement("canvas");r.width=t,r.height=n,r.getContext("2d").drawImage(e,0,0,t,n),u.image=r}else u.image=e;u.needsUpdate=!0})),u.sourceFile=o,a&&(u.repeat.set(a[0],a[1]),1!==a[0]&&(u.wrapS=Z.RepeatWrapping),1!==a[1]&&(u.wrapT=Z.RepeatWrapping)),s&&u.offset.set(s[0],s[1]),l){var f={repeat:Z.RepeatWrapping,mirror:Z.MirroredRepeatWrapping};void 0!==f[l[0]]&&(u.wrapS=f[l[0]]),void 0!==f[l[1]]&&(u.wrapT=f[l[1]])}c&&(u.anisotropy=c),e[r]=u}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var a="MeshLambertMaterial",s={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var l=e.shading.toLowerCase();"phong"===l?a="MeshPhongMaterial":"basic"===l&&(a="MeshBasicMaterial")}void 0!==e.blending&&void 0!==Z[e.blending]&&(s.blending=Z[e.blending]),void 0!==e.transparent&&(s.transparent=e.transparent),void 0!==e.opacity&&e.opacity<1&&(s.transparent=!0),void 0!==e.depthTest&&(s.depthTest=e.depthTest),void 0!==e.depthWrite&&(s.depthWrite=e.depthWrite),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.flipSided&&(s.side=Z.BackSide),void 0!==e.doubleSided&&(s.side=Z.DoubleSide),void 0!==e.wireframe&&(s.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?s.vertexColors=Z.FaceColors:e.vertexColors&&(s.vertexColors=Z.VertexColors)),e.colorDiffuse?s.color=o(e.colorDiffuse):e.DbgColor&&(s.color=e.DbgColor),e.colorSpecular&&(s.specular=o(e.colorSpecular)),e.colorEmissive&&(s.emissive=o(e.colorEmissive)),void 0!==e.transparency&&(console.warn("THREE.Loader: transparency has been renamed to opacity"),e.opacity=e.transparency),void 0!==e.opacity&&(s.opacity=e.opacity),e.specularCoef&&(s.shininess=e.specularCoef),e.mapDiffuse&&t&&r(s,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&r(s,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&r(s,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&r(s,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&r(s,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapAlpha&&t&&r(s,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy),e.mapBumpScale&&(s.bumpScale=e.mapBumpScale),e.mapNormalFactor&&(s.normalScale=new Z.Vector2(e.mapNormalFactor,e.mapNormalFactor));var c=new Z[a](s);return void 0!==e.DbgName&&(c.name=e.DbgName),c}},Z.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,n=this.handlers.length;t<n;t+=2){var i=this.handlers[t],r=this.handlers[t+1];if(i.test(e))return r}return null}},Z.XHRLoader=function(e){this.manager=void 0!==e?e:Z.DefaultLoadingManager},Z.XHRLoader.prototype={constructor:Z.XHRLoader,load:function(e,t,n,i){var r=this,o=Z.Cache.get(e);if(void 0===o){var a=new XMLHttpRequest;a.open("GET",e,!0),a.addEventListener("load",function(n){Z.Cache.add(e,this.response),t&&t(this.response),r.manager.itemEnd(e)},!1),void 0!==n&&a.addEventListener("progress",function(e){n(e)},!1),void 0!==i&&a.addEventListener("error",function(e){i(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(a.responseType=this.responseType),a.send(null),r.manager.itemStart(e)}else t&&t(o)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}},Z.ImageLoader=function(e){this.manager=void 0!==e?e:Z.DefaultLoadingManager},Z.ImageLoader.prototype={constructor:Z.ImageLoader,load:function(e,t,n,i){var r=this,o=Z.Cache.get(e);if(void 0===o){var a=document.createElement("img");return a.addEventListener("load",function(n){Z.Cache.add(e,this),t&&t(this),r.manager.itemEnd(e)},!1),void 0!==n&&a.addEventListener("progress",function(e){n(e)},!1),void 0!==i&&a.addEventListener("error",function(e){i(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),a.src=e,r.manager.itemStart(e),a}t(o)},setCrossOrigin:function(e){this.crossOrigin=e}},Z.JSONLoader=function(e){Z.Loader.call(this,e),this.withCredentials=!1},Z.JSONLoader.prototype=Object.create(Z.Loader.prototype),Z.JSONLoader.prototype.constructor=Z.JSONLoader,Z.JSONLoader.prototype.load=function(e,t,n){n=n&&"string"==typeof n?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},Z.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,i,r){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText),l=s.metadata;if(void 0!==l){if("object"===l.type)return void Z.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===l.type)return void Z.error("THREE.JSONLoader: "+t+" seems to be a Scene. Use THREE.SceneLoader instead.")}var c=e.parse(s,i);n(c.geometry,c.materials)}else Z.error("THREE.JSONLoader: "+t+" seems to be unreachable or the file is empty.");e.onLoadComplete()}else Z.error("THREE.JSONLoader: Couldn't load "+t+" ("+o.status+")");else o.readyState===o.LOADING?r&&(0===a&&(a=o.getResponseHeader("Content-Length")),r({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==r&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},Z.JSONLoader.prototype.parse=function(e,t){var n=new Z.Geometry,i=void 0!==e.scale?1/e.scale:1;if(function(t){function i(e,t){return e&1<<t}var r,o,a,s,l,c,u,h,d,f,p,m,g,v,y,_,b,x,w,A,E,T,M,S,C,P,L,R=e.faces,D=e.vertices,I=e.normals,O=e.colors,N=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&N++;for(r=0;r<N;r++)n.faceVertexUvs[r]=[]}s=0,l=D.length;for(;s<l;)(x=new Z.Vector3).x=D[s++]*t,x.y=D[s++]*t,x.z=D[s++]*t,n.vertices.push(x);s=0,l=R.length;for(;s<l;)if(f=R[s++],p=i(f,0),m=i(f,1),g=i(f,3),v=i(f,4),y=i(f,5),_=i(f,6),b=i(f,7),p){if((A=new Z.Face3).a=R[s],A.b=R[s+1],A.c=R[s+3],(E=new Z.Face3).a=R[s+1],E.b=R[s+2],E.c=R[s+3],s+=4,m&&(d=R[s++],A.materialIndex=d,E.materialIndex=d),a=n.faces.length,g)for(r=0;r<N;r++)for(S=e.uvs[r],n.faceVertexUvs[r][a]=[],n.faceVertexUvs[r][a+1]=[],o=0;o<4;o++)h=R[s++],P=S[2*h],L=S[2*h+1],C=new Z.Vector2(P,L),2!==o&&n.faceVertexUvs[r][a].push(C),0!==o&&n.faceVertexUvs[r][a+1].push(C);if(v&&(u=3*R[s++],A.normal.set(I[u++],I[u++],I[u]),E.normal.copy(A.normal)),y)for(r=0;r<4;r++)u=3*R[s++],M=new Z.Vector3(I[u++],I[u++],I[u]),2!==r&&A.vertexNormals.push(M),0!==r&&E.vertexNormals.push(M);if(_&&(c=R[s++],T=O[c],A.color.setHex(T),E.color.setHex(T)),b)for(r=0;r<4;r++)c=R[s++],T=O[c],2!==r&&A.vertexColors.push(new Z.Color(T)),0!==r&&E.vertexColors.push(new Z.Color(T));n.faces.push(A),n.faces.push(E)}else{if((w=new Z.Face3).a=R[s++],w.b=R[s++],w.c=R[s++],m&&(d=R[s++],w.materialIndex=d),a=n.faces.length,g)for(r=0;r<N;r++)for(S=e.uvs[r],n.faceVertexUvs[r][a]=[],o=0;o<3;o++)h=R[s++],P=S[2*h],L=S[2*h+1],C=new Z.Vector2(P,L),n.faceVertexUvs[r][a].push(C);if(v&&(u=3*R[s++],w.normal.set(I[u++],I[u++],I[u])),y)for(r=0;r<3;r++)u=3*R[s++],M=new Z.Vector3(I[u++],I[u++],I[u]),w.vertexNormals.push(M);if(_&&(c=R[s++],w.color.setHex(O[c])),b)for(r=0;r<3;r++)c=R[s++],w.vertexColors.push(new Z.Color(O[c]));n.faces.push(w)}}(i),function(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var i=0,r=e.skinWeights.length;i<r;i+=t){var o=e.skinWeights[i],a=t>1?e.skinWeights[i+1]:0,s=t>2?e.skinWeights[i+2]:0,l=t>3?e.skinWeights[i+3]:0;n.skinWeights.push(new Z.Vector4(o,a,s,l))}if(e.skinIndices)for(var i=0,r=e.skinIndices.length;i<r;i+=t){var c=e.skinIndices[i],u=t>1?e.skinIndices[i+1]:0,h=t>2?e.skinIndices[i+2]:0,d=t>3?e.skinIndices[i+3]:0;n.skinIndices.push(new Z.Vector4(c,u,h,d))}n.bones=e.bones,n.bones&&n.bones.length>0&&(n.skinWeights.length!==n.skinIndices.length||n.skinIndices.length!==n.vertices.length)&&Z.warn("THREE.JSONLoader: When skinning, number of vertices ("+n.vertices.length+"), skinIndices ("+n.skinIndices.length+"), and skinWeights ("+n.skinWeights.length+") should match.");n.animation=e.animation,n.animations=e.animations}(),function(t){var i,r,o,a,s,l,c,u,h,d,f;if(void 0!==e.morphTargets)for(s=0,l=e.morphTargets.length;s<l;s++)for(n.morphTargets[s]={},n.morphTargets[s].name=e.morphTargets[s].name,n.morphTargets[s].vertices=[],o=n.morphTargets[s].vertices,a=e.morphTargets[s].vertices,i=0,r=a.length;i<r;i+=3){var p=new Z.Vector3;p.x=a[i]*t,p.y=a[i+1]*t,p.z=a[i+2]*t,o.push(p)}if(void 0!==e.morphColors)for(s=0,l=e.morphColors.length;s<l;s++)for(n.morphColors[s]={},n.morphColors[s].name=e.morphColors[s].name,n.morphColors[s].colors=[],h=n.morphColors[s].colors,d=e.morphColors[s].colors,c=0,u=d.length;c<u;c+=3)(f=new Z.Color(16755200)).setRGB(d[c],d[c+1],d[c+2]),h.push(f)}(i),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:n};var r=this.initMaterials(e.materials,t);return this.needsTangents(r)&&n.computeTangents(),{geometry:n,materials:r}},Z.LoadingManager=function(e,t,n){var i=this,r=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++},this.itemEnd=function(e){r++,void 0!==i.onProgress&&i.onProgress(e,r,o),r===o&&void 0!==i.onLoad&&i.onLoad()}},Z.DefaultLoadingManager=new Z.LoadingManager,Z.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:Z.DefaultLoadingManager},Z.BufferGeometryLoader.prototype={constructor:Z.BufferGeometryLoader,load:function(e,t,n,i){var r=this,o=new Z.XHRLoader(r.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(r.parse(JSON.parse(e)))},n,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new Z.BufferGeometry,n=e.data.attributes;for(var i in n){var r=n[i],o=new self[r.type](r.array);t.addAttribute(i,new Z.BufferAttribute(o,r.itemSize))}var a=e.data.offsets;void 0!==a&&(t.offsets=JSON.parse(JSON.stringify(a)));var s=e.data.boundingSphere;if(void 0!==s){var l=new Z.Vector3;void 0!==s.center&&l.fromArray(s.center),t.boundingSphere=new Z.Sphere(l,s.radius)}return t}},Z.MaterialLoader=function(e){this.manager=void 0!==e?e:Z.DefaultLoadingManager},Z.MaterialLoader.prototype={constructor:Z.MaterialLoader,load:function(e,t,n,i){var r=this,o=new Z.XHRLoader(r.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(r.parse(JSON.parse(e)))},n,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new Z[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.materials)for(var n=0,i=e.materials.length;n<i;n++)t.materials.push(this.parse(e.materials[n]));return t}},Z.ObjectLoader=function(e){this.manager=void 0!==e?e:Z.DefaultLoadingManager,this.texturePath=""},Z.ObjectLoader.prototype={constructor:Z.ObjectLoader,load:function(e,t,n,i){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var r=this,o=new Z.XHRLoader(r.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){r.parse(JSON.parse(e),t)},n,i)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var n=this.parseGeometries(e.geometries),i=this.parseImages(e.images,function(){void 0!==t&&t(a)}),r=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,r),a=this.parseObject(e.object,n,o);return void 0!==e.images&&0!==e.images.length||void 0!==t&&t(a),a},parseGeometries:function(e){var t={};if(void 0!==e)for(var n=new Z.JSONLoader,i=new Z.BufferGeometryLoader,r=0,o=e.length;r<o;r++){var a,s=e[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Z[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"CubeGeometry":a=new Z.BoxGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":a=new Z.CircleGeometry(s.radius,s.segments);break;case"CylinderGeometry":a=new Z.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded);break;case"SphereGeometry":a=new Z.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"IcosahedronGeometry":a=new Z.IcosahedronGeometry(s.radius,s.detail);break;case"TorusGeometry":a=new Z.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":a=new Z.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":a=i.parse(s);break;case"Geometry":a=n.parse(s.data).geometry}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),t[s.uuid]=a}return t},parseMaterials:function(e,t){var n={};if(void 0!==e)for(var i=function(e){return void 0===t[e]&&Z.warn("THREE.ObjectLoader: Undefined texture",e),t[e]},r=new Z.MaterialLoader,o=0,a=e.length;o<a;o++){var s=e[o],l=r.parse(s);l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.map&&(l.map=i(s.map)),void 0!==s.bumpMap&&(l.bumpMap=i(s.bumpMap),s.bumpScale&&(l.bumpScale=new Z.Vector2(s.bumpScale,s.bumpScale))),void 0!==s.alphaMap&&(l.alphaMap=i(s.alphaMap)),void 0!==s.envMap&&(l.envMap=i(s.envMap)),void 0!==s.normalMap&&(l.normalMap=i(s.normalMap),s.normalScale&&(l.normalScale=new Z.Vector2(s.normalScale,s.normalScale))),void 0!==s.lightMap&&(l.lightMap=i(s.lightMap)),void 0!==s.specularMap&&(l.specularMap=i(s.specularMap)),n[s.uuid]=l}return n},parseImages:function(e,t){var n=this,i={};if(void 0!==e&&e.length>0){var r=new Z.LoadingManager(t),o=new Z.ImageLoader(r);o.setCrossOrigin(this.crossOrigin);for(var a=function(e){return n.manager.itemStart(e),o.load(e,function(){n.manager.itemEnd(e)})},s=0,l=e.length;s<l;s++){var c=e[s],u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:n.texturePath+c.url;i[c.uuid]=a(u)}}return i},parseTextures:function(e,t){var n={};if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var o=e[i];void 0===o.image&&Z.warn('THREE.ObjectLoader: No "image" speficied for',o.uuid),void 0===t[o.image]&&Z.warn("THREE.ObjectLoader: Undefined image",o.image);var a=new Z.Texture(t[o.image]);a.needsUpdate=!0,a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.repeat&&(a.repeat=new Z.Vector2(o.repeat[0],o.repeat[1])),void 0!==o.minFilter&&(a.minFilter=Z[o.minFilter]),void 0!==o.magFilter&&(a.magFilter=Z[o.magFilter]),void 0!==o.anisotropy&&(a.anisotropy=o.anisotropy),o.wrap instanceof Array&&(a.wrapS=Z[o.wrap[0]],a.wrapT=Z[o.wrap[1]]),n[o.uuid]=a}return n},parseObject:function(){var e=new Z.Matrix4;return function(t,n,i){var r,o=function(e){return void 0===n[e]&&Z.warn("THREE.ObjectLoader: Undefined geometry",e),n[e]},a=function(e){return void 0===i[e]&&Z.warn("THREE.ObjectLoader: Undefined material",e),i[e]};switch(t.type){case"Scene":r=new Z.Scene;break;case"PerspectiveCamera":r=new Z.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":r=new Z.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":r=new Z.AmbientLight(t.color);break;case"DirectionalLight":r=new Z.DirectionalLight(t.color,t.intensity);break;case"PointLight":r=new Z.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":r=new Z.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":r=new Z.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":r=new Z.Mesh(o(t.geometry),a(t.material));break;case"Line":r=new Z.Line(o(t.geometry),a(t.material),t.mode);break;case"PointCloud":r=new Z.PointCloud(o(t.geometry),a(t.material));break;case"Sprite":r=new Z.Sprite(a(t.material));break;case"Group":r=new Z.Group;break;default:r=new Z.Object3D}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.children)for(var s in t.children)r.add(this.parseObject(t.children[s],n,i));return r}}()},Z.TextureLoader=function(e){this.manager=void 0!==e?e:Z.DefaultLoadingManager},Z.TextureLoader.prototype={constructor:Z.TextureLoader,load:function(e,t,n,i){var r=new Z.ImageLoader(this.manager);r.setCrossOrigin(this.crossOrigin),r.load(e,function(e){var n=new Z.Texture(e);n.needsUpdate=!0,void 0!==t&&t(n)},n,i)},setCrossOrigin:function(e){this.crossOrigin=e}},Z.DataTextureLoader=Z.BinaryTextureLoader=function(){this._parser=null},Z.BinaryTextureLoader.prototype={constructor:Z.BinaryTextureLoader,load:function(e,t,n,i){var r=this,o=new Z.DataTexture,a=new Z.XHRLoader;return a.setResponseType("arraybuffer"),a.load(e,function(e){var n=r._parser(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:Z.ClampToEdgeWrapping,o.wrapT=void 0!==n.wrapT?n.wrapT:Z.ClampToEdgeWrapping,o.magFilter=void 0!==n.magFilter?n.magFilter:Z.LinearFilter,o.minFilter=void 0!==n.minFilter?n.minFilter:Z.LinearMipMapLinearFilter,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps),1===n.mipmapCount&&(o.minFilter=Z.LinearFilter),o.needsUpdate=!0,t&&t(o,n))},n,i),o}},Z.CompressedTextureLoader=function(){this._parser=null},Z.CompressedTextureLoader.prototype={constructor:Z.CompressedTextureLoader,load:function(e,t,n){var i=this,r=[],o=new Z.CompressedTexture;o.image=r;var a=new Z.XHRLoader;if(a.setResponseType("arraybuffer"),e instanceof Array)for(var s=0,l=function(n){a.load(e[n],function(e){var a=i._parser(e,!0);r[n]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps},6===(s+=1)&&(1==a.mipmapCount&&(o.minFilter=Z.LinearFilter),o.format=a.format,o.needsUpdate=!0,t&&t(o))})},c=0,u=e.length;c<u;++c)l(c);else a.load(e,function(e){var n=i._parser(e,!0);if(n.isCubemap)for(var a=n.mipmaps.length/n.mipmapCount,s=0;s<a;s++){r[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)r[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),r[s].format=n.format,r[s].width=n.width,r[s].height=n.height}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=Z.LinearFilter),o.format=n.format,o.needsUpdate=!0,t&&t(o)});return o}},Z.Material=function(){Object.defineProperty(this,"id",{value:Z.MaterialIdCount++}),this.uuid=Z.Math.generateUUID(),this.name="",this.type="Material",this.side=Z.FrontSide,this.opacity=1,this.transparent=!1,this.blending=Z.NormalBlending,this.blendSrc=Z.SrcAlphaFactor,this.blendDst=Z.OneMinusSrcAlphaFactor,this.blendEquation=Z.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},Z.Material.prototype={constructor:Z.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n){if(t in this){var i=this[t];i instanceof Z.Color?i.set(n):i instanceof Z.Vector3&&n instanceof Z.Vector3?i.copy(n):this[t]="overdraw"==t?Number(n):n}}else Z.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};return""!==this.name&&(e.name=this.name),this instanceof Z.MeshBasicMaterial?(e.color=this.color.getHex(),this.vertexColors!==Z.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==Z.NormalBlending&&(e.blending=this.blending),this.side!==Z.FrontSide&&(e.side=this.side)):this instanceof Z.MeshLambertMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),this.vertexColors!==Z.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==Z.SmoothShading&&(e.shading=this.shading),this.blending!==Z.NormalBlending&&(e.blending=this.blending),this.side!==Z.FrontSide&&(e.side=this.side)):this instanceof Z.MeshPhongMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),e.specular=this.specular.getHex(),e.shininess=this.shininess,this.vertexColors!==Z.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==Z.SmoothShading&&(e.shading=this.shading),this.blending!==Z.NormalBlending&&(e.blending=this.blending),this.side!==Z.FrontSide&&(e.side=this.side)):this instanceof Z.MeshNormalMaterial?(this.blending!==Z.NormalBlending&&(e.blending=this.blending),this.side!==Z.FrontSide&&(e.side=this.side)):this instanceof Z.MeshDepthMaterial?(this.blending!==Z.NormalBlending&&(e.blending=this.blending),this.side!==Z.FrontSide&&(e.side=this.side)):this instanceof Z.PointCloudMaterial?(e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.color=this.color.getHex(),this.vertexColors!==Z.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==Z.NormalBlending&&(e.blending=this.blending)):this instanceof Z.ShaderMaterial?(e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader):this instanceof Z.SpriteMaterial&&(e.color=this.color.getHex()),this.opacity<1&&(e.opacity=this.opacity),!1!==this.transparent&&(e.transparent=this.transparent),!1!==this.wireframe&&(e.wireframe=this.wireframe),e},clone:function(e){return void 0===e&&(e=new Z.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.blendSrcAlpha=this.blendSrcAlpha,e.blendDstAlpha=this.blendDstAlpha,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},Z.EventDispatcher.prototype.apply(Z.Material.prototype),Z.MaterialIdCount=0,Z.LineBasicMaterial=function(e){Z.Material.call(this),this.type="LineBasicMaterial",this.color=new Z.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=Z.NoColors,this.fog=!0,this.setValues(e)},Z.LineBasicMaterial.prototype=Object.create(Z.Material.prototype),Z.LineBasicMaterial.prototype.constructor=Z.LineBasicMaterial,Z.LineBasicMaterial.prototype.clone=function(){var e=new Z.LineBasicMaterial;return Z.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},Z.LineDashedMaterial=function(e){Z.Material.call(this),this.type="LineDashedMaterial",this.color=new Z.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},Z.LineDashedMaterial.prototype=Object.create(Z.Material.prototype),Z.LineDashedMaterial.prototype.constructor=Z.LineDashedMaterial,Z.LineDashedMaterial.prototype.clone=function(){var e=new Z.LineDashedMaterial;return Z.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},Z.MeshBasicMaterial=function(e){Z.Material.call(this),this.type="MeshBasicMaterial",this.color=new Z.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Z.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Z.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},Z.MeshBasicMaterial.prototype=Object.create(Z.Material.prototype),Z.MeshBasicMaterial.prototype.constructor=Z.MeshBasicMaterial,Z.MeshBasicMaterial.prototype.clone=function(){var e=new Z.MeshBasicMaterial;return Z.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},Z.MeshLambertMaterial=function(e){Z.Material.call(this),this.type="MeshLambertMaterial",this.color=new Z.Color(16777215),this.emissive=new Z.Color(0),this.wrapAround=!1,this.wrapRGB=new Z.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Z.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Z.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},Z.MeshLambertMaterial.prototype=Object.create(Z.Material.prototype),Z.MeshLambertMaterial.prototype.constructor=Z.MeshLambertMaterial,Z.MeshLambertMaterial.prototype.clone=function(){var e=new Z.MeshLambertMaterial;return Z.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},Z.MeshPhongMaterial=function(e){Z.Material.call(this),this.type="MeshPhongMaterial",this.color=new Z.Color(16777215),this.emissive=new Z.Color(0),this.specular=new Z.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new Z.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Z.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Z.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Z.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},Z.MeshPhongMaterial.prototype=Object.create(Z.Material.prototype),Z.MeshPhongMaterial.prototype.constructor=Z.MeshPhongMaterial,Z.MeshPhongMaterial.prototype.clone=function(){var e=new Z.MeshPhongMaterial;return Z.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},Z.MeshDepthMaterial=function(e){Z.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},Z.MeshDepthMaterial.prototype=Object.create(Z.Material.prototype),Z.MeshDepthMaterial.prototype.constructor=Z.MeshDepthMaterial,Z.MeshDepthMaterial.prototype.clone=function(){var e=new Z.MeshDepthMaterial;return Z.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},Z.MeshNormalMaterial=function(e){Z.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},Z.MeshNormalMaterial.prototype=Object.create(Z.Material.prototype),Z.MeshNormalMaterial.prototype.constructor=Z.MeshNormalMaterial,Z.MeshNormalMaterial.prototype.clone=function(){var e=new Z.MeshNormalMaterial;return Z.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},Z.MeshFaceMaterial=function(e){this.uuid=Z.Math.generateUUID(),this.type="MeshFaceMaterial",this.materials=e instanceof Array?e:[]},Z.MeshFaceMaterial.prototype={constructor:Z.MeshFaceMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,n=this.materials.length;t<n;t++)e.materials.push(this.materials[t].toJSON());return e},clone:function(){for(var e=new Z.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e}},Z.PointCloudMaterial=function(e){Z.Material.call(this),this.type="PointCloudMaterial",this.color=new Z.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=Z.NoColors,this.fog=!0,this.setValues(e)},Z.PointCloudMaterial.prototype=Object.create(Z.Material.prototype),Z.PointCloudMaterial.prototype.constructor=Z.PointCloudMaterial,Z.PointCloudMaterial.prototype.clone=function(){var e=new Z.PointCloudMaterial;return Z.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},Z.ParticleBasicMaterial=function(e){return Z.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new Z.PointCloudMaterial(e)},Z.ParticleSystemMaterial=function(e){return Z.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new Z.PointCloudMaterial(e)},Z.ShaderMaterial=function(e){Z.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=Z.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=Z.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(e)},Z.ShaderMaterial.prototype=Object.create(Z.Material.prototype),Z.ShaderMaterial.prototype.constructor=Z.ShaderMaterial,Z.ShaderMaterial.prototype.clone=function(){var e=new Z.ShaderMaterial;return Z.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=Z.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},Z.RawShaderMaterial=function(e){Z.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},Z.RawShaderMaterial.prototype=Object.create(Z.ShaderMaterial.prototype),Z.RawShaderMaterial.prototype.constructor=Z.RawShaderMaterial,Z.RawShaderMaterial.prototype.clone=function(){var e=new Z.RawShaderMaterial;return Z.ShaderMaterial.prototype.clone.call(this,e),e},Z.SpriteMaterial=function(e){Z.Material.call(this),this.type="SpriteMaterial",this.color=new Z.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},Z.SpriteMaterial.prototype=Object.create(Z.Material.prototype),Z.SpriteMaterial.prototype.constructor=Z.SpriteMaterial,Z.SpriteMaterial.prototype.clone=function(){var e=new Z.SpriteMaterial;return Z.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},Z.Texture=function(e,t,n,i,r,o,a,s,l){Object.defineProperty(this,"id",{value:Z.TextureIdCount++}),this.uuid=Z.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==e?e:Z.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Z.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:Z.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:Z.ClampToEdgeWrapping,this.magFilter=void 0!==r?r:Z.LinearFilter,this.minFilter=void 0!==o?o:Z.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:Z.RGBAFormat,this.type=void 0!==s?s:Z.UnsignedByteType,this.offset=new Z.Vector2(0,0),this.repeat=new Z.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},Z.Texture.DEFAULT_IMAGE=void 0,Z.Texture.DEFAULT_MAPPING=Z.UVMapping,Z.Texture.prototype={constructor:Z.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new Z.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},Z.EventDispatcher.prototype.apply(Z.Texture.prototype),Z.TextureIdCount=0,Z.CubeTexture=function(e,t,n,i,r,o,a,s,l){t=void 0!==t?t:Z.CubeReflectionMapping,Z.Texture.call(this,e,t,n,i,r,o,a,s,l),this.images=e},Z.CubeTexture.prototype=Object.create(Z.Texture.prototype),Z.CubeTexture.prototype.constructor=Z.CubeTexture,Z.CubeTexture.clone=function(e){return void 0===e&&(e=new Z.CubeTexture),Z.Texture.prototype.clone.call(this,e),e.images=this.images,e},Z.CompressedTexture=function(e,t,n,i,r,o,a,s,l,c,u){Z.Texture.call(this,null,o,a,s,l,c,i,r,u),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},Z.CompressedTexture.prototype=Object.create(Z.Texture.prototype),Z.CompressedTexture.prototype.constructor=Z.CompressedTexture,Z.CompressedTexture.prototype.clone=function(){var e=new Z.CompressedTexture;return Z.Texture.prototype.clone.call(this,e),e},Z.DataTexture=function(e,t,n,i,r,o,a,s,l,c,u){Z.Texture.call(this,null,o,a,s,l,c,i,r,u),this.image={data:e,width:t,height:n}},Z.DataTexture.prototype=Object.create(Z.Texture.prototype),Z.DataTexture.prototype.constructor=Z.DataTexture,Z.DataTexture.prototype.clone=function(){var e=new Z.DataTexture;return Z.Texture.prototype.clone.call(this,e),e},Z.VideoTexture=function(e,t,n,i,r,o,a,s,l){Z.Texture.call(this,e,t,n,i,r,o,a,s,l),this.generateMipmaps=!1;var c=this;!function t(){requestAnimationFrame(t),e.readyState===e.HAVE_ENOUGH_DATA&&(c.needsUpdate=!0)}()},Z.VideoTexture.prototype=Object.create(Z.Texture.prototype),Z.VideoTexture.prototype.constructor=Z.VideoTexture,Z.Group=function(){Z.Object3D.call(this),this.type="Group"},Z.Group.prototype=Object.create(Z.Object3D.prototype),Z.Group.prototype.constructor=Z.Group,Z.PointCloud=function(e,t){Z.Object3D.call(this),this.type="PointCloud",this.geometry=void 0!==e?e:new Z.Geometry,this.material=void 0!==t?t:new Z.PointCloudMaterial({color:16777215*Math.random()})},Z.PointCloud.prototype=Object.create(Z.Object3D.prototype),Z.PointCloud.prototype.constructor=Z.PointCloud,Z.PointCloud.prototype.raycast=(R=new Z.Matrix4,D=new Z.Ray,function(e,t){var n=this,i=n.geometry,r=e.params.PointCloud.threshold;if(R.getInverse(this.matrixWorld),D.copy(e.ray).applyMatrix4(R),null===i.boundingBox||!1!==D.isIntersectionBox(i.boundingBox)){var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=new Z.Vector3,s=function(i,r){var a=D.distanceToPoint(i);if(a<o){var s=D.closestPointToPoint(i);s.applyMatrix4(n.matrixWorld);var l=e.ray.origin.distanceTo(s);t.push({distance:l,distanceToRay:a,point:s.clone(),index:r,face:null,object:n})}};if(i instanceof Z.BufferGeometry){var l=i.attributes,c=l.position.array;if(void 0!==l.index){var u=l.index.array,h=i.offsets;0===h.length&&(h=[{start:0,count:u.length,index:0}]);for(var d=0,f=h.length;d<f;++d)for(var p=h[d].start,m=h[d].count,g=h[d].index,v=p,y=p+m;v<y;v++){var _=g+u[v];a.fromArray(c,3*_),s(a,_)}}else{var b=c.length/3;for(v=0;v<b;v++)a.set(c[3*v],c[3*v+1],c[3*v+2]),s(a,v)}}else{var x=this.geometry.vertices;for(v=0;v<x.length;v++)s(x[v],v)}}}),Z.PointCloud.prototype.clone=function(e){return void 0===e&&(e=new Z.PointCloud(this.geometry,this.material)),Z.Object3D.prototype.clone.call(this,e),e},Z.ParticleSystem=function(e,t){return Z.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new Z.PointCloud(e,t)},Z.Line=function(e,t,n){Z.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new Z.Geometry,this.material=void 0!==t?t:new Z.LineBasicMaterial({color:16777215*Math.random()}),this.mode=void 0!==n?n:Z.LineStrip},Z.LineStrip=0,Z.LinePieces=1,Z.Line.prototype=Object.create(Z.Object3D.prototype),Z.Line.prototype.constructor=Z.Line,Z.Line.prototype.raycast=function(){var e=new Z.Matrix4,t=new Z.Ray,n=new Z.Sphere;return function(i,r){var o=i.linePrecision,a=o*o,s=this.geometry;if(null===s.boundingSphere&&s.computeBoundingSphere(),n.copy(s.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==i.ray.isIntersectionSphere(n)){e.getInverse(this.matrixWorld),t.copy(i.ray).applyMatrix4(e);var l=new Z.Vector3,c=new Z.Vector3,u=new Z.Vector3,h=new Z.Vector3,d=this.mode===Z.LineStrip?1:2;if(s instanceof Z.BufferGeometry){var f=s.attributes;if(void 0!==f.index){var p=f.index.array,m=f.position.array,g=s.offsets;0===g.length&&(g=[{start:0,count:p.length,index:0}]);for(var v=0;v<g.length;v++)for(var y=g[v].start,_=g[v].count,b=g[v].index,x=y;x<y+_-1;x+=d){var w=b+p[x],A=b+p[x+1];if(l.fromArray(m,3*w),c.fromArray(m,3*A),!(t.distanceSqToSegment(l,c,h,u)>a))(M=t.origin.distanceTo(h))<i.near||M>i.far||r.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:x,offsetIndex:v,face:null,faceIndex:null,object:this})}}else for(m=f.position.array,x=0;x<m.length/3-1;x+=d){if(l.fromArray(m,3*x),c.fromArray(m,3*x+3),!(t.distanceSqToSegment(l,c,h,u)>a))(M=t.origin.distanceTo(h))<i.near||M>i.far||r.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else if(s instanceof Z.Geometry){var E=s.vertices,T=E.length;for(x=0;x<T-1;x+=d){var M;if(!(t.distanceSqToSegment(E[x],E[x+1],h,u)>a))(M=t.origin.distanceTo(h))<i.near||M>i.far||r.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}}}(),Z.Line.prototype.clone=function(e){return void 0===e&&(e=new Z.Line(this.geometry,this.material,this.mode)),Z.Object3D.prototype.clone.call(this,e),e},Z.Mesh=function(e,t){Z.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Z.Geometry,this.material=void 0!==t?t:new Z.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},Z.Mesh.prototype=Object.create(Z.Object3D.prototype),Z.Mesh.prototype.constructor=Z.Mesh,Z.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},Z.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(Z.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},Z.Mesh.prototype.raycast=function(){var e=new Z.Matrix4,t=new Z.Ray,n=new Z.Sphere,i=new Z.Vector3,r=new Z.Vector3,o=new Z.Vector3;return function(a,s){var l=this.geometry;if(null===l.boundingSphere&&l.computeBoundingSphere(),n.copy(l.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==a.ray.isIntersectionSphere(n)&&(e.getInverse(this.matrixWorld),t.copy(a.ray).applyMatrix4(e),null===l.boundingBox||!1!==t.isIntersectionBox(l.boundingBox)))if(l instanceof Z.BufferGeometry){if(void 0===(R=this.material))return;var c=l.attributes,u=a.precision;if(void 0!==c.index){var h=c.index.array,d=c.position.array,f=l.offsets;0===f.length&&(f=[{start:0,count:h.length,index:0}]);for(var p=0,m=f.length;p<m;++p)for(var g=f[p].start,v=f[p].count,y=f[p].index,_=g,b=g+v;_<b;_+=3){if(A=y+h[_],E=y+h[_+1],T=y+h[_+2],i.fromArray(d,3*A),r.fromArray(d,3*E),o.fromArray(d,3*T),R.side===Z.BackSide)var x=t.intersectTriangle(o,r,i,!0);else x=t.intersectTriangle(i,r,o,R.side!==Z.DoubleSide);if(null!==x)x.applyMatrix4(this.matrixWorld),(B=a.ray.origin.distanceTo(x))<u||B<a.near||B>a.far||s.push({distance:B,point:x,face:new Z.Face3(A,E,T,Z.Triangle.normal(i,r,o)),faceIndex:null,object:this})}}else{_=0;var w=0;for(b=(d=c.position.array).length;_<b;_+=3,w+=9){if(A=_,E=_+1,T=_+2,i.fromArray(d,w),r.fromArray(d,w+3),o.fromArray(d,w+6),R.side===Z.BackSide)x=t.intersectTriangle(o,r,i,!0);else x=t.intersectTriangle(i,r,o,R.side!==Z.DoubleSide);if(null!==x)x.applyMatrix4(this.matrixWorld),(B=a.ray.origin.distanceTo(x))<u||B<a.near||B>a.far||s.push({distance:B,point:x,face:new Z.Face3(A,E,T,Z.Triangle.normal(i,r,o)),faceIndex:null,object:this})}}}else if(l instanceof Z.Geometry)for(var A,E,T,M=this.material instanceof Z.MeshFaceMaterial,S=!0===M?this.material.materials:null,C=(u=a.precision,l.vertices),P=0,L=l.faces.length;P<L;P++){var R,D=l.faces[P];if(void 0!==(R=!0===M?S[D.materialIndex]:this.material)){if(A=C[D.a],E=C[D.b],T=C[D.c],!0===R.morphTargets){var I=l.morphTargets,O=this.morphTargetInfluences;i.set(0,0,0),r.set(0,0,0),o.set(0,0,0);for(var N=0,k=I.length;N<k;N++){var V=O[N];if(0!==V){var F=I[N].vertices;i.x+=(F[D.a].x-A.x)*V,i.y+=(F[D.a].y-A.y)*V,i.z+=(F[D.a].z-A.z)*V,r.x+=(F[D.b].x-E.x)*V,r.y+=(F[D.b].y-E.y)*V,r.z+=(F[D.b].z-E.z)*V,o.x+=(F[D.c].x-T.x)*V,o.y+=(F[D.c].y-T.y)*V,o.z+=(F[D.c].z-T.z)*V}}i.add(A),r.add(E),o.add(T),A=i,E=r,T=o}if(R.side===Z.BackSide)x=t.intersectTriangle(T,E,A,!0);else x=t.intersectTriangle(A,E,T,R.side!==Z.DoubleSide);var B;if(null!==x)x.applyMatrix4(this.matrixWorld),(B=a.ray.origin.distanceTo(x))<u||B<a.near||B>a.far||s.push({distance:B,point:x,face:D,faceIndex:P,object:this})}}}}(),Z.Mesh.prototype.clone=function(e,t){return void 0===e&&(e=new Z.Mesh(this.geometry,this.material)),Z.Object3D.prototype.clone.call(this,e,t),e},Z.Bone=function(e){Z.Object3D.call(this),this.type="Bone",this.skin=e},Z.Bone.prototype=Object.create(Z.Object3D.prototype),Z.Bone.prototype.constructor=Z.Bone,Z.Skeleton=function(e,t,n){var i;(this.useVertexTexture=void 0===n||n,this.identityMatrix=new Z.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture)?(i=this.bones.length>256?64:this.bones.length>64?32:this.bones.length>16?16:8,this.boneTextureWidth=i,this.boneTextureHeight=i,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new Z.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,Z.RGBAFormat,Z.FloatType),this.boneTexture.minFilter=Z.NearestFilter,this.boneTexture.magFilter=Z.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{Z.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var r=0,o=this.bones.length;r<o;r++)this.boneInverses.push(new Z.Matrix4)}},Z.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new Z.Matrix4;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},Z.Skeleton.prototype.pose=function(){for(var e,t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},Z.Skeleton.prototype.update=(I=new Z.Matrix4,function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e]?this.bones[e].matrixWorld:this.identityMatrix;I.multiplyMatrices(n,this.boneInverses[e]),I.flattenToArrayOffset(this.boneMatrices,16*e)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}),Z.SkinnedMesh=function(e,t,n){Z.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Z.Matrix4,this.bindMatrixInverse=new Z.Matrix4;var i=[];if(this.geometry&&void 0!==this.geometry.bones){for(var r,o,a,s,l,c=0,u=this.geometry.bones.length;c<u;++c)a=(o=this.geometry.bones[c]).pos,s=o.rotq,l=o.scl,r=new Z.Bone(this),i.push(r),r.name=o.name,r.position.set(a[0],a[1],a[2]),r.quaternion.set(s[0],s[1],s[2],s[3]),void 0!==l?r.scale.set(l[0],l[1],l[2]):r.scale.set(1,1,1);for(c=0,u=this.geometry.bones.length;c<u;++c)-1!==(o=this.geometry.bones[c]).parent?i[o.parent].add(i[c]):this.add(i[c])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new Z.Skeleton(i,void 0,n))},Z.SkinnedMesh.prototype=Object.create(Z.Mesh.prototype),Z.SkinnedMesh.prototype.constructor=Z.SkinnedMesh,Z.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},Z.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},Z.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof Z.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],n=1/t.lengthManhattan();n!==1/0?t.multiplyScalar(n):t.set(1)}},Z.SkinnedMesh.prototype.updateMatrixWorld=function(e){Z.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):Z.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},Z.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new Z.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),Z.Mesh.prototype.clone.call(this,e),e},Z.MorphAnimMesh=function(e,t){Z.Mesh.call(this,e,t),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},Z.MorphAnimMesh.prototype=Object.create(Z.Mesh.prototype),Z.MorphAnimMesh.prototype.constructor=Z.MorphAnimMesh,Z.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},Z.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},Z.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},Z.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,n=e.animations,i=/([a-z]+)_?(\d+)/,r=0,o=e.morphTargets.length;r<o;r++){var a=e.morphTargets[r].name.match(i);if(a&&a.length>1){var s=a[1];n[s]||(n[s]={start:1/0,end:-1/0});var l=n[s];r<l.start&&(l.start=r),r>l.end&&(l.end=r),t||(t=s)}}e.firstAnimation=t},Z.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},Z.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=(n.end-n.start)/t*1e3,this.time=0):Z.warn("THREE.MorphAnimMesh: animation["+e+"] undefined in .playAnimation()")},Z.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var n=this.startKeyframe+Z.Math.clamp(Math.floor(this.time/t),0,this.length-1);n!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[n]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=n);var i=this.time%t/t;this.directionBackwards&&(i=1-i),this.morphTargetInfluences[this.currentKeyframe]=i,this.morphTargetInfluences[this.lastKeyframe]=1-i},Z.MorphAnimMesh.prototype.interpolateTargets=function(e,t,n){for(var i=this.morphTargetInfluences,r=0,o=i.length;r<o;r++)i[r]=0;e>-1&&(i[e]=1-n),t>-1&&(i[t]=n)},Z.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new Z.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,Z.Mesh.prototype.clone.call(this,e),e},Z.LOD=function(){Z.Object3D.call(this),this.objects=[]},Z.LOD.prototype=Object.create(Z.Object3D.prototype),Z.LOD.prototype.constructor=Z.LOD,Z.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=0;n<this.objects.length&&!(t<this.objects[n].distance);n++);this.objects.splice(n,0,{distance:t,object:e}),this.add(e)},Z.LOD.prototype.getObjectForDistance=function(e){for(var t=1,n=this.objects.length;t<n&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},Z.LOD.prototype.raycast=(O=new Z.Vector3,function(e,t){O.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(O);this.getObjectForDistance(n).raycast(e,t)}),Z.LOD.prototype.update=function(){var e=new Z.Vector3,t=new Z.Vector3;return function(n){if(this.objects.length>1){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);this.objects[0].object.visible=!0;for(var r=1,o=this.objects.length;r<o&&i>=this.objects[r].distance;r++)this.objects[r-1].object.visible=!1,this.objects[r].object.visible=!0;for(;r<o;r++)this.objects[r].object.visible=!1}}}(),Z.LOD.prototype.clone=function(e){void 0===e&&(e=new Z.LOD),Z.Object3D.prototype.clone.call(this,e);for(var t=0,n=this.objects.length;t<n;t++){var i=this.objects[t].object.clone();i.visible=0===t,e.addLevel(i,this.objects[t].distance)}return e},Z.Sprite=(N=new Uint16Array([0,1,2,0,2,3]),k=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),V=new Float32Array([0,0,1,0,1,1,0,1]),(F=new Z.BufferGeometry).addAttribute("index",new Z.BufferAttribute(N,1)),F.addAttribute("position",new Z.BufferAttribute(k,3)),F.addAttribute("uv",new Z.BufferAttribute(V,2)),function(e){Z.Object3D.call(this),this.type="Sprite",this.geometry=F,this.material=void 0!==e?e:new Z.SpriteMaterial}),Z.Sprite.prototype=Object.create(Z.Object3D.prototype),Z.Sprite.prototype.constructor=Z.Sprite,Z.Sprite.prototype.raycast=function(){var e=new Z.Vector3;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.distanceToPoint(e);i>this.scale.x||n.push({distance:i,point:this.position,face:null,object:this})}}(),Z.Sprite.prototype.clone=function(e){return void 0===e&&(e=new Z.Sprite(this.material)),Z.Object3D.prototype.clone.call(this,e),e},Z.Particle=Z.Sprite,Z.LensFlare=function(e,t,n,i,r){Z.Object3D.call(this),this.lensFlares=[],this.positionScreen=new Z.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,n,i,r)},Z.LensFlare.prototype=Object.create(Z.Object3D.prototype),Z.LensFlare.prototype.constructor=Z.LensFlare,Z.LensFlare.prototype.add=function(e,t,n,i,r,o){void 0===t&&(t=-1),void 0===n&&(n=0),void 0===o&&(o=1),void 0===r&&(r=new Z.Color(16777215)),void 0===i&&(i=Z.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:r,blending:i})},Z.LensFlare.prototype.updateLensFlares=function(){var e,t,n=this.lensFlares.length,i=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;e<n;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},Z.Scene=function(){Z.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},Z.Scene.prototype=Object.create(Z.Object3D.prototype),Z.Scene.prototype.constructor=Z.Scene,Z.Scene.prototype.clone=function(e){return void 0===e&&(e=new Z.Scene),Z.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},Z.Fog=function(e,t,n){this.name="",this.color=new Z.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3},Z.Fog.prototype.clone=function(){return new Z.Fog(this.color.getHex(),this.near,this.far)},Z.FogExp2=function(e,t){this.name="",this.color=new Z.Color(e),this.density=void 0!==t?t:25e-5},Z.FogExp2.prototype.clone=function(){return new Z.FogExp2(this.color.getHex(),this.density)},Z.ShaderChunk={},Z.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\n\treturn point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\tif ( decayExponent > 0.0 ) {\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n\t}\n\treturn 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\n",Z.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",Z.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack += ambientLightColor;\n\n#endif\n",Z.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n",Z.ShaderChunk.default_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",Z.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif",Z.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n",Z.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",Z.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif",Z.ShaderChunk.lights_phong_fragment="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalDiffuseLight += hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\n#ifdef METAL\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n",Z.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",Z.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif",Z.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n",Z.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",Z.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",Z.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n",Z.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif",Z.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif",Z.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif",Z.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif",Z.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif",Z.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",Z.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",Z.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\tvColor.xyz = inputToLinear( color.xyz );\n\n#endif",Z.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",Z.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n",Z.ShaderChunk.linear_to_gamma_fragment="\n\toutgoingLight = linearToOutput( outgoingLight );\n",Z.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",Z.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n",Z.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",Z.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",Z.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",Z.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif",Z.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",Z.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",Z.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n\t\tfogFactor = whiteCompliment( fogFactor );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",Z.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",Z.ShaderChunk.defaultnormal_vertex="#ifdef USE_SKINNING\n\n\tvec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n\tvec3 objectNormal = morphedNormal;\n\n#else\n\n\tvec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",Z.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n",Z.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",Z.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",Z.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif",Z.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",Z.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif",Z.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif",Z.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n",Z.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n\tshadowColor = inputToLinear( shadowColor );\n\n\toutgoingLight = outgoingLight * shadowColor;\n\n#endif\n",Z.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#elif defined( USE_MORPHTARGETS )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif\n",Z.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif",Z.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",Z.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif",Z.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",Z.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",Z.UniformsUtils={merge:function(e){for(var t={},n=0;n<e.length;n++){var i=this.clone(e[n]);for(var r in i)t[r]=i[r]}return t},clone:function(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r instanceof Z.Color||r instanceof Z.Vector2||r instanceof Z.Vector3||r instanceof Z.Vector4||r instanceof Z.Matrix4||r instanceof Z.Texture?t[n][i]=r.clone():r instanceof Array?t[n][i]=r.slice():t[n][i]=r}return t}},Z.UniformsLib={common:{diffuse:{type:"c",value:new Z.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new Z.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new Z.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Z.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new Z.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new Z.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Z.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},Z.ShaderLib={basic:{uniforms:Z.UniformsUtils.merge([Z.UniformsLib.common,Z.UniformsLib.fog,Z.UniformsLib.shadowmap]),vertexShader:[Z.ShaderChunk.common,Z.ShaderChunk.map_pars_vertex,Z.ShaderChunk.lightmap_pars_vertex,Z.ShaderChunk.envmap_pars_vertex,Z.ShaderChunk.color_pars_vertex,Z.ShaderChunk.morphtarget_pars_vertex,Z.ShaderChunk.skinning_pars_vertex,Z.ShaderChunk.shadowmap_pars_vertex,Z.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Z.ShaderChunk.map_vertex,Z.ShaderChunk.lightmap_vertex,Z.ShaderChunk.color_vertex,Z.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",Z.ShaderChunk.morphnormal_vertex,Z.ShaderChunk.skinnormal_vertex,Z.ShaderChunk.defaultnormal_vertex,"\t#endif",Z.ShaderChunk.morphtarget_vertex,Z.ShaderChunk.skinning_vertex,Z.ShaderChunk.default_vertex,Z.ShaderChunk.logdepthbuf_vertex,Z.ShaderChunk.worldpos_vertex,Z.ShaderChunk.envmap_vertex,Z.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",Z.ShaderChunk.common,Z.ShaderChunk.color_pars_fragment,Z.ShaderChunk.map_pars_fragment,Z.ShaderChunk.alphamap_pars_fragment,Z.ShaderChunk.lightmap_pars_fragment,Z.ShaderChunk.envmap_pars_fragment,Z.ShaderChunk.fog_pars_fragment,Z.ShaderChunk.shadowmap_pars_fragment,Z.ShaderChunk.specularmap_pars_fragment,Z.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",Z.ShaderChunk.logdepthbuf_fragment,Z.ShaderChunk.map_fragment,Z.ShaderChunk.color_fragment,Z.ShaderChunk.alphamap_fragment,Z.ShaderChunk.alphatest_fragment,Z.ShaderChunk.specularmap_fragment,"\toutgoingLight = diffuseColor.rgb;",Z.ShaderChunk.lightmap_fragment,Z.ShaderChunk.envmap_fragment,Z.ShaderChunk.shadowmap_fragment,Z.ShaderChunk.linear_to_gamma_fragment,Z.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:Z.UniformsUtils.merge([Z.UniformsLib.common,Z.UniformsLib.fog,Z.UniformsLib.lights,Z.UniformsLib.shadowmap,{emissive:{type:"c",value:new Z.Color(0)},wrapRGB:{type:"v3",value:new Z.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",Z.ShaderChunk.common,Z.ShaderChunk.map_pars_vertex,Z.ShaderChunk.lightmap_pars_vertex,Z.ShaderChunk.envmap_pars_vertex,Z.ShaderChunk.lights_lambert_pars_vertex,Z.ShaderChunk.color_pars_vertex,Z.ShaderChunk.morphtarget_pars_vertex,Z.ShaderChunk.skinning_pars_vertex,Z.ShaderChunk.shadowmap_pars_vertex,Z.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Z.ShaderChunk.map_vertex,Z.ShaderChunk.lightmap_vertex,Z.ShaderChunk.color_vertex,Z.ShaderChunk.morphnormal_vertex,Z.ShaderChunk.skinbase_vertex,Z.ShaderChunk.skinnormal_vertex,Z.ShaderChunk.defaultnormal_vertex,Z.ShaderChunk.morphtarget_vertex,Z.ShaderChunk.skinning_vertex,Z.ShaderChunk.default_vertex,Z.ShaderChunk.logdepthbuf_vertex,Z.ShaderChunk.worldpos_vertex,Z.ShaderChunk.envmap_vertex,Z.ShaderChunk.lights_lambert_vertex,Z.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",Z.ShaderChunk.common,Z.ShaderChunk.color_pars_fragment,Z.ShaderChunk.map_pars_fragment,Z.ShaderChunk.alphamap_pars_fragment,Z.ShaderChunk.lightmap_pars_fragment,Z.ShaderChunk.envmap_pars_fragment,Z.ShaderChunk.fog_pars_fragment,Z.ShaderChunk.shadowmap_pars_fragment,Z.ShaderChunk.specularmap_pars_fragment,Z.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",Z.ShaderChunk.logdepthbuf_fragment,Z.ShaderChunk.map_fragment,Z.ShaderChunk.color_fragment,Z.ShaderChunk.alphamap_fragment,Z.ShaderChunk.alphatest_fragment,Z.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t#endif",Z.ShaderChunk.lightmap_fragment,Z.ShaderChunk.envmap_fragment,Z.ShaderChunk.shadowmap_fragment,Z.ShaderChunk.linear_to_gamma_fragment,Z.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:Z.UniformsUtils.merge([Z.UniformsLib.common,Z.UniformsLib.bump,Z.UniformsLib.normalmap,Z.UniformsLib.fog,Z.UniformsLib.lights,Z.UniformsLib.shadowmap,{emissive:{type:"c",value:new Z.Color(0)},specular:{type:"c",value:new Z.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new Z.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",Z.ShaderChunk.common,Z.ShaderChunk.map_pars_vertex,Z.ShaderChunk.lightmap_pars_vertex,Z.ShaderChunk.envmap_pars_vertex,Z.ShaderChunk.lights_phong_pars_vertex,Z.ShaderChunk.color_pars_vertex,Z.ShaderChunk.morphtarget_pars_vertex,Z.ShaderChunk.skinning_pars_vertex,Z.ShaderChunk.shadowmap_pars_vertex,Z.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Z.ShaderChunk.map_vertex,Z.ShaderChunk.lightmap_vertex,Z.ShaderChunk.color_vertex,Z.ShaderChunk.morphnormal_vertex,Z.ShaderChunk.skinbase_vertex,Z.ShaderChunk.skinnormal_vertex,Z.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",Z.ShaderChunk.morphtarget_vertex,Z.ShaderChunk.skinning_vertex,Z.ShaderChunk.default_vertex,Z.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",Z.ShaderChunk.worldpos_vertex,Z.ShaderChunk.envmap_vertex,Z.ShaderChunk.lights_phong_vertex,Z.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",Z.ShaderChunk.common,Z.ShaderChunk.color_pars_fragment,Z.ShaderChunk.map_pars_fragment,Z.ShaderChunk.alphamap_pars_fragment,Z.ShaderChunk.lightmap_pars_fragment,Z.ShaderChunk.envmap_pars_fragment,Z.ShaderChunk.fog_pars_fragment,Z.ShaderChunk.lights_phong_pars_fragment,Z.ShaderChunk.shadowmap_pars_fragment,Z.ShaderChunk.bumpmap_pars_fragment,Z.ShaderChunk.normalmap_pars_fragment,Z.ShaderChunk.specularmap_pars_fragment,Z.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",Z.ShaderChunk.logdepthbuf_fragment,Z.ShaderChunk.map_fragment,Z.ShaderChunk.color_fragment,Z.ShaderChunk.alphamap_fragment,Z.ShaderChunk.alphatest_fragment,Z.ShaderChunk.specularmap_fragment,Z.ShaderChunk.lights_phong_fragment,Z.ShaderChunk.lightmap_fragment,Z.ShaderChunk.envmap_fragment,Z.ShaderChunk.shadowmap_fragment,Z.ShaderChunk.linear_to_gamma_fragment,Z.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},particle_basic:{uniforms:Z.UniformsUtils.merge([Z.UniformsLib.particle,Z.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",Z.ShaderChunk.common,Z.ShaderChunk.color_pars_vertex,Z.ShaderChunk.shadowmap_pars_vertex,Z.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Z.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",Z.ShaderChunk.logdepthbuf_vertex,Z.ShaderChunk.worldpos_vertex,Z.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",Z.ShaderChunk.common,Z.ShaderChunk.color_pars_fragment,Z.ShaderChunk.map_particle_pars_fragment,Z.ShaderChunk.fog_pars_fragment,Z.ShaderChunk.shadowmap_pars_fragment,Z.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( psColor, opacity );",Z.ShaderChunk.logdepthbuf_fragment,Z.ShaderChunk.map_particle_fragment,Z.ShaderChunk.color_fragment,Z.ShaderChunk.alphatest_fragment,"\toutgoingLight = diffuseColor.rgb;",Z.ShaderChunk.shadowmap_fragment,Z.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:Z.UniformsUtils.merge([Z.UniformsLib.common,Z.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",Z.ShaderChunk.common,Z.ShaderChunk.color_pars_vertex,Z.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Z.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",Z.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",Z.ShaderChunk.common,Z.ShaderChunk.color_pars_fragment,Z.ShaderChunk.fog_pars_fragment,Z.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",Z.ShaderChunk.logdepthbuf_fragment,Z.ShaderChunk.color_fragment,"\toutgoingLight = diffuseColor.rgb;",Z.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[Z.ShaderChunk.common,Z.ShaderChunk.morphtarget_pars_vertex,Z.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Z.ShaderChunk.morphtarget_vertex,Z.ShaderChunk.default_vertex,Z.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",Z.ShaderChunk.common,Z.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",Z.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",Z.ShaderChunk.common,Z.ShaderChunk.morphtarget_pars_vertex,Z.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvNormal = normalize( normalMatrix * normal );",Z.ShaderChunk.morphtarget_vertex,Z.ShaderChunk.default_vertex,Z.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",Z.ShaderChunk.common,Z.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",Z.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",Z.ShaderChunk.common,Z.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",Z.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",Z.ShaderChunk.common,Z.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",Z.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",Z.ShaderChunk.common,Z.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",Z.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",Z.ShaderChunk.common,Z.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",Z.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[Z.ShaderChunk.common,Z.ShaderChunk.morphtarget_pars_vertex,Z.ShaderChunk.skinning_pars_vertex,Z.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Z.ShaderChunk.skinbase_vertex,Z.ShaderChunk.morphtarget_vertex,Z.ShaderChunk.skinning_vertex,Z.ShaderChunk.default_vertex,Z.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[Z.ShaderChunk.common,Z.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",Z.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")}},Z.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",Z.REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),n=void 0!==e.context?e.context:null,i=1,r=void 0!==e.precision?e.precision:"highp",o=void 0!==e.alpha&&e.alpha,a=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,l=void 0!==e.antialias&&e.antialias,c=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,h=void 0!==e.logarithmicDepthBuffer&&e.logarithmicDepthBuffer,d=new Z.Color(0),f=0,p=[],m={},g=[],v=[],y=[],_=[],b=[];this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapType=Z.PCFShadowMap,this.shadowMapCullFace=Z.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var x,w=this,A=[],E=null,T=null,M=-1,S="",C=null,P=0,L=0,R=0,D=t.width,I=t.height,O=0,N=0,k=new Z.Frustum,V=new Z.Matrix4,F=new Z.Vector3,B=new Z.Vector3,U=!0,z={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var G={alpha:o,depth:a,stencil:s,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:u};if(null===(x=n||t.getContext("webgl",G)||t.getContext("experimental-webgl",G)))throw null!==t.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";t.addEventListener("webglcontextlost",function(e){e.preventDefault(),q(),X(),m={}},!1)}catch(e){Z.error("THREE.WebGLRenderer: "+e)}var H=new Z.WebGLState(x,ot);void 0===x.getShaderPrecisionFormat&&(x.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var W=new Z.WebGLExtensions(x);W.get("OES_texture_float"),W.get("OES_texture_float_linear"),W.get("OES_texture_half_float"),W.get("OES_texture_half_float_linear"),W.get("OES_standard_derivatives"),h&&W.get("EXT_frag_depth");var j=function(e,t,n,i){!0===c&&(e*=i,t*=i,n*=i),x.clearColor(e,t,n,i)},X=function(){x.clearColor(0,0,0,1),x.clearDepth(1),x.clearStencil(0),x.enable(x.DEPTH_TEST),x.depthFunc(x.LEQUAL),x.frontFace(x.CCW),x.cullFace(x.BACK),x.enable(x.CULL_FACE),x.enable(x.BLEND),x.blendEquation(x.FUNC_ADD),x.blendFunc(x.SRC_ALPHA,x.ONE_MINUS_SRC_ALPHA),x.viewport(L,R,D,I),j(d.r,d.g,d.b,f)},q=function(){E=null,C=null,S="",M=-1,U=!0,H.reset()};X(),this.context=x,this.state=H;var Y,K=x.getParameter(x.MAX_TEXTURE_IMAGE_UNITS),Q=x.getParameter(x.MAX_VERTEX_TEXTURE_IMAGE_UNITS),J=x.getParameter(x.MAX_TEXTURE_SIZE),$=x.getParameter(x.MAX_CUBE_MAP_TEXTURE_SIZE),ee=Q>0,te=ee&&W.get("OES_texture_float"),ne=x.getShaderPrecisionFormat(x.VERTEX_SHADER,x.HIGH_FLOAT),ie=x.getShaderPrecisionFormat(x.VERTEX_SHADER,x.MEDIUM_FLOAT),re=x.getShaderPrecisionFormat(x.FRAGMENT_SHADER,x.HIGH_FLOAT),oe=x.getShaderPrecisionFormat(x.FRAGMENT_SHADER,x.MEDIUM_FLOAT),ae=function(){if(void 0!==Y)return Y;if(Y=[],W.get("WEBGL_compressed_texture_pvrtc")||W.get("WEBGL_compressed_texture_s3tc"))for(var e=x.getParameter(x.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)Y.push(e[t]);return Y},se=ne.precision>0&&re.precision>0,le=ie.precision>0&&oe.precision>0;"highp"!==r||se||(le?(r="mediump",Z.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(r="lowp",Z.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==r||le||(r="lowp",Z.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var ce,ue=new Z.ShadowMapPlugin(this,p,m,g),he=new Z.SpritePlugin(this,_),de=new Z.LensFlarePlugin(this,b);function fe(e){e.__webglVertexBuffer=x.createBuffer(),e.__webglNormalBuffer=x.createBuffer(),e.__webglTangentBuffer=x.createBuffer(),e.__webglColorBuffer=x.createBuffer(),e.__webglUVBuffer=x.createBuffer(),e.__webglUV2Buffer=x.createBuffer(),e.__webglSkinIndicesBuffer=x.createBuffer(),e.__webglSkinWeightsBuffer=x.createBuffer(),e.__webglFaceBuffer=x.createBuffer(),e.__webglLineBuffer=x.createBuffer();var t=e.numMorphTargets;if(t){e.__webglMorphTargetsBuffers=[];for(var n=0,i=t;n<i;n++)e.__webglMorphTargetsBuffers.push(x.createBuffer())}var r=e.numMorphNormals;if(r){e.__webglMorphNormalsBuffers=[];for(n=0,i=r;n<i;n++)e.__webglMorphNormalsBuffers.push(x.createBuffer())}w.info.memory.geometries++}this.getContext=function(){return x},this.forceContextLoss=function(){W.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return ee},this.supportsFloatTextures=function(){return W.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return W.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return W.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return W.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return W.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return W.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){if(void 0!==ce)return ce;var e=W.get("EXT_texture_filter_anisotropic");return ce=null!==e?x.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.getPrecision=function(){return r},this.getPixelRatio=function(){return i},this.setPixelRatio=function(e){i=e},this.setSize=function(e,n,r){t.width=e*i,t.height=n*i,!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n)},this.setViewport=function(e,t,n,r){L=e*i,R=t*i,D=n*i,I=r*i,x.viewport(L,R,D,I)},this.setScissor=function(e,t,n,r){x.scissor(e*i,t*i,n*i,r*i)},this.enableScissorTest=function(e){e?x.enable(x.SCISSOR_TEST):x.disable(x.SCISSOR_TEST)},this.getClearColor=function(){return d},this.setClearColor=function(e,t){d.set(e),f=void 0!==t?t:1,j(d.r,d.g,d.b,f)},this.getClearAlpha=function(){return f},this.setClearAlpha=function(e){f=e,j(d.r,d.g,d.b,f)},this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=x.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=x.DEPTH_BUFFER_BIT),(void 0===n||n)&&(i|=x.STENCIL_BUFFER_BIT),x.clear(i)},this.clearColor=function(){x.clear(x.COLOR_BUFFER_BIT)},this.clearDepth=function(){x.clear(x.DEPTH_BUFFER_BIT)},this.clearStencil=function(){x.clear(x.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,n,i){this.setRenderTarget(e),this.clear(t,n,i)},this.resetGLState=q;var pe=function e(t){t.target.traverse(function(t){t.removeEventListener("remove",e),function(e){e instanceof Z.Mesh||e instanceof Z.PointCloud||e instanceof Z.Line?delete m[e.id]:(e instanceof Z.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){for(var n=e.length-1;n>=0;n--)e[n].object===t&&e.splice(n,1)}(g,e);delete e.__webglInit,delete e._modelViewMatrix,delete e._normalMatrix,delete e.__webglActive}(t)})},me=function e(t){var n=t.target;n.removeEventListener("dispose",e),be(n)},ge=function e(t){var n=t.target;n.removeEventListener("dispose",e),xe(n),w.info.memory.textures--},ve=function e(t){var n=t.target;n.removeEventListener("dispose",e),we(n),w.info.memory.textures--},ye=function e(t){var n=t.target;n.removeEventListener("dispose",e),Ae(n)},_e=function(e){for(var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"],n=0,i=t.length;n<i;n++){void 0!==e[r=t[n]]&&(x.deleteBuffer(e[r]),delete e[r])}if(void 0!==e.__webglCustomAttributesList){for(var r in e.__webglCustomAttributesList)x.deleteBuffer(e.__webglCustomAttributesList[r].buffer);delete e.__webglCustomAttributesList}w.info.memory.geometries--},be=function(e){if(delete e.__webglInit,e instanceof Z.BufferGeometry){for(var t in e.attributes){var n=e.attributes[t];void 0!==n.buffer&&(x.deleteBuffer(n.buffer),delete n.buffer)}w.info.memory.geometries--}else{var i=ke[e.id];if(void 0!==i){for(var r=0,o=i.length;r<o;r++){var a=i[r];if(void 0!==a.numMorphTargets){for(var s=0,l=a.numMorphTargets;s<l;s++)x.deleteBuffer(a.__webglMorphTargetsBuffers[s]);delete a.__webglMorphTargetsBuffers}if(void 0!==a.numMorphNormals){for(s=0,l=a.numMorphNormals;s<l;s++)x.deleteBuffer(a.__webglMorphNormalsBuffers[s]);delete a.__webglMorphNormalsBuffers}_e(a)}delete ke[e.id]}else _e(e)}S=""},xe=function(e){if(e.image&&e.image.__webglTextureCube)x.deleteTexture(e.image.__webglTextureCube),delete e.image.__webglTextureCube;else{if(void 0===e.__webglInit)return;x.deleteTexture(e.__webglTexture),delete e.__webglTexture,delete e.__webglInit}},we=function(e){if(e&&void 0!==e.__webglTexture){if(x.deleteTexture(e.__webglTexture),delete e.__webglTexture,e instanceof Z.WebGLRenderTargetCube)for(var t=0;t<6;t++)x.deleteFramebuffer(e.__webglFramebuffer[t]),x.deleteRenderbuffer(e.__webglRenderbuffer[t]);else x.deleteFramebuffer(e.__webglFramebuffer),x.deleteRenderbuffer(e.__webglRenderbuffer);delete e.__webglFramebuffer,delete e.__webglRenderbuffer}},Ae=function(e){var t=e.program.program;if(void 0!==t){var n,i,r;e.program=void 0;var o=!1;for(n=0,i=A.length;n<i;n++)if((r=A[n]).program===t){r.usedTimes--,0===r.usedTimes&&(o=!0);break}if(!0===o){var a=[];for(n=0,i=A.length;n<i;n++)(r=A[n]).program!==t&&a.push(r);A=a,x.deleteProgram(t),w.info.memory.programs--}}};function Ee(e){var t=e.geometry,n=e.material,i=t.vertices.length;if(n.attributes)for(var r in void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]),n.attributes){var o=n.attributes[r];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(i*a),o.buffer=x.createBuffer(),o.buffer.belongsToAttribute=r,o.needsUpdate=!0}t.__webglCustomAttributesList.push(o)}}function Te(e,t){var n=t.geometry,i=e.faces3,r=3*i.length,o=1*i.length,a=3*i.length,s=Me(t,e);e.__vertexArray=new Float32Array(3*r),e.__normalArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__uvArray=new Float32Array(2*r),n.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*r)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*r)),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*r),e.__skinWeightArray=new Float32Array(4*r));var l=null!==W.get("OES_element_index_uint")&&o>21845?Uint32Array:Uint16Array;e.__typeArray=l,e.__faceArray=new l(3*o),e.__lineArray=new l(2*a);var c=e.numMorphTargets;if(c){e.__morphTargetsArrays=[];for(var u=0,h=c;u<h;u++)e.__morphTargetsArrays.push(new Float32Array(3*r))}var d=e.numMorphNormals;if(d){e.__morphNormalsArrays=[];for(u=0,h=d;u<h;u++)e.__morphNormalsArrays.push(new Float32Array(3*r))}if(e.__webglFaceCount=3*o,e.__webglLineCount=2*a,s.attributes)for(var f in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),s.attributes){var p=s.attributes[f],m={};for(var g in p)m[g]=p[g];if(!m.__webglInitialized||m.createUniqueBuffers){m.__webglInitialized=!0;var v=1;"v2"===m.type?v=2:"v3"===m.type?v=3:"v4"===m.type?v=4:"c"===m.type&&(v=3),m.size=v,m.array=new Float32Array(r*v),m.buffer=x.createBuffer(),m.buffer.belongsToAttribute=f,p.needsUpdate=!0,m.__original=p}e.__webglCustomAttributesList.push(m)}e.__inittedArrays=!0}function Me(e,t){return e.material instanceof Z.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Se(e,t,n,i,r){if(e.__inittedArrays){var o,a,s,l,c,u,h,d,f,p,m,g,v,y,_,b,w,A,E,T,M,S,C,P,L,R,D,I,O,N,k,V,F,B,U,z,G,H,W,j,X,q=function(e){return e instanceof Z.MeshPhongMaterial==0&&e.shading===Z.FlatShading}(r),Y=0,K=0,Q=0,J=0,$=0,ee=0,te=0,ne=0,ie=0,re=0,oe=0,ae=0,se=e.__vertexArray,le=e.__uvArray,ce=e.__uv2Array,ue=e.__normalArray,he=e.__tangentArray,de=e.__colorArray,fe=e.__skinIndexArray,pe=e.__skinWeightArray,me=e.__morphTargetsArrays,ge=e.__morphNormalsArrays,ve=e.__webglCustomAttributesList,ye=e.__faceArray,_e=e.__lineArray,be=t.geometry,xe=be.verticesNeedUpdate,we=be.elementsNeedUpdate,Ae=be.uvsNeedUpdate,Ee=be.normalsNeedUpdate,Te=be.tangentsNeedUpdate,Me=be.colorsNeedUpdate,Se=be.morphTargetsNeedUpdate,Ce=be.vertices,Pe=e.faces3,Le=be.faces,Re=be.faceVertexUvs[0],De=be.faceVertexUvs[1],Ie=be.skinIndices,Oe=be.skinWeights,Ne=be.morphTargets,ke=be.morphNormals;if(xe){for(o=0,a=Pe.length;o<a;o++)m=Ce[(s=Le[Pe[o]]).a],g=Ce[s.b],v=Ce[s.c],se[K]=m.x,se[K+1]=m.y,se[K+2]=m.z,se[K+3]=g.x,se[K+4]=g.y,se[K+5]=g.z,se[K+6]=v.x,se[K+7]=v.y,se[K+8]=v.z,K+=9;x.bindBuffer(x.ARRAY_BUFFER,e.__webglVertexBuffer),x.bufferData(x.ARRAY_BUFFER,se,n)}if(Se)for(B=0,U=Ne.length;B<U;B++){for(oe=0,o=0,a=Pe.length;o<a;o++)s=Le[H=Pe[o]],m=Ne[B].vertices[s.a],g=Ne[B].vertices[s.b],v=Ne[B].vertices[s.c],(z=me[B])[oe]=m.x,z[oe+1]=m.y,z[oe+2]=m.z,z[oe+3]=g.x,z[oe+4]=g.y,z[oe+5]=g.z,z[oe+6]=v.x,z[oe+7]=v.y,z[oe+8]=v.z,r.morphNormals&&(q?(A=w=ke[B].faceNormals[H],E=w):(w=(W=ke[B].vertexNormals[H]).a,A=W.b,E=W.c),(G=ge[B])[oe]=w.x,G[oe+1]=w.y,G[oe+2]=w.z,G[oe+3]=A.x,G[oe+4]=A.y,G[oe+5]=A.z,G[oe+6]=E.x,G[oe+7]=E.y,G[oe+8]=E.z),oe+=9;x.bindBuffer(x.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[B]),x.bufferData(x.ARRAY_BUFFER,me[B],n),r.morphNormals&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[B]),x.bufferData(x.ARRAY_BUFFER,ge[B],n))}if(Oe.length){for(o=0,a=Pe.length;o<a;o++)C=Oe[(s=Le[Pe[o]]).a],P=Oe[s.b],L=Oe[s.c],pe[re]=C.x,pe[re+1]=C.y,pe[re+2]=C.z,pe[re+3]=C.w,pe[re+4]=P.x,pe[re+5]=P.y,pe[re+6]=P.z,pe[re+7]=P.w,pe[re+8]=L.x,pe[re+9]=L.y,pe[re+10]=L.z,pe[re+11]=L.w,R=Ie[s.a],D=Ie[s.b],I=Ie[s.c],fe[re]=R.x,fe[re+1]=R.y,fe[re+2]=R.z,fe[re+3]=R.w,fe[re+4]=D.x,fe[re+5]=D.y,fe[re+6]=D.z,fe[re+7]=D.w,fe[re+8]=I.x,fe[re+9]=I.y,fe[re+10]=I.z,fe[re+11]=I.w,re+=12;re>0&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),x.bufferData(x.ARRAY_BUFFER,fe,n),x.bindBuffer(x.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),x.bufferData(x.ARRAY_BUFFER,pe,n))}if(Me){for(o=0,a=Pe.length;o<a;o++)u=(s=Le[Pe[o]]).vertexColors,h=s.color,3===u.length&&r.vertexColors===Z.VertexColors?(T=u[0],M=u[1],S=u[2]):(T=h,M=h,S=h),de[ie]=T.r,de[ie+1]=T.g,de[ie+2]=T.b,de[ie+3]=M.r,de[ie+4]=M.g,de[ie+5]=M.b,de[ie+6]=S.r,de[ie+7]=S.g,de[ie+8]=S.b,ie+=9;ie>0&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglColorBuffer),x.bufferData(x.ARRAY_BUFFER,de,n))}if(Te&&be.hasTangents){for(o=0,a=Pe.length;o<a;o++)y=(d=(s=Le[Pe[o]]).vertexTangents)[0],_=d[1],b=d[2],he[te]=y.x,he[te+1]=y.y,he[te+2]=y.z,he[te+3]=y.w,he[te+4]=_.x,he[te+5]=_.y,he[te+6]=_.z,he[te+7]=_.w,he[te+8]=b.x,he[te+9]=b.y,he[te+10]=b.z,he[te+11]=b.w,te+=12;x.bindBuffer(x.ARRAY_BUFFER,e.__webglTangentBuffer),x.bufferData(x.ARRAY_BUFFER,he,n)}if(Ee){for(o=0,a=Pe.length;o<a;o++)if(l=(s=Le[Pe[o]]).vertexNormals,c=s.normal,3===l.length&&!1===q)for(O=0;O<3;O++)k=l[O],ue[ee]=k.x,ue[ee+1]=k.y,ue[ee+2]=k.z,ee+=3;else for(O=0;O<3;O++)ue[ee]=c.x,ue[ee+1]=c.y,ue[ee+2]=c.z,ee+=3;x.bindBuffer(x.ARRAY_BUFFER,e.__webglNormalBuffer),x.bufferData(x.ARRAY_BUFFER,ue,n)}if(Ae&&Re){for(o=0,a=Pe.length;o<a;o++)if(void 0!==(f=Re[Pe[o]]))for(O=0;O<3;O++)V=f[O],le[Q]=V.x,le[Q+1]=V.y,Q+=2;Q>0&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglUVBuffer),x.bufferData(x.ARRAY_BUFFER,le,n))}if(Ae&&De){for(o=0,a=Pe.length;o<a;o++)if(void 0!==(p=De[Pe[o]]))for(O=0;O<3;O++)F=p[O],ce[J]=F.x,ce[J+1]=F.y,J+=2;J>0&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglUV2Buffer),x.bufferData(x.ARRAY_BUFFER,ce,n))}if(we){for(o=0,a=Pe.length;o<a;o++)ye[$]=Y,ye[$+1]=Y+1,ye[$+2]=Y+2,$+=3,_e[ne]=Y,_e[ne+1]=Y+1,_e[ne+2]=Y,_e[ne+3]=Y+2,_e[ne+4]=Y+1,_e[ne+5]=Y+2,ne+=6,Y+=3;x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,ye,n),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,_e,n)}if(ve)for(O=0,N=ve.length;O<N;O++)if((X=ve[O]).__original.needsUpdate){if(ae=0,1===X.size){if(void 0===X.boundTo||"vertices"===X.boundTo)for(o=0,a=Pe.length;o<a;o++)s=Le[Pe[o]],X.array[ae]=X.value[s.a],X.array[ae+1]=X.value[s.b],X.array[ae+2]=X.value[s.c],ae+=3;else if("faces"===X.boundTo)for(o=0,a=Pe.length;o<a;o++)j=X.value[Pe[o]],X.array[ae]=j,X.array[ae+1]=j,X.array[ae+2]=j,ae+=3}else if(2===X.size){if(void 0===X.boundTo||"vertices"===X.boundTo)for(o=0,a=Pe.length;o<a;o++)s=Le[Pe[o]],m=X.value[s.a],g=X.value[s.b],v=X.value[s.c],X.array[ae]=m.x,X.array[ae+1]=m.y,X.array[ae+2]=g.x,X.array[ae+3]=g.y,X.array[ae+4]=v.x,X.array[ae+5]=v.y,ae+=6;else if("faces"===X.boundTo)for(o=0,a=Pe.length;o<a;o++)m=j=X.value[Pe[o]],g=j,v=j,X.array[ae]=m.x,X.array[ae+1]=m.y,X.array[ae+2]=g.x,X.array[ae+3]=g.y,X.array[ae+4]=v.x,X.array[ae+5]=v.y,ae+=6}else if(3===X.size){var Ve;if(Ve="c"===X.type?["r","g","b"]:["x","y","z"],void 0===X.boundTo||"vertices"===X.boundTo)for(o=0,a=Pe.length;o<a;o++)s=Le[Pe[o]],m=X.value[s.a],g=X.value[s.b],v=X.value[s.c],X.array[ae]=m[Ve[0]],X.array[ae+1]=m[Ve[1]],X.array[ae+2]=m[Ve[2]],X.array[ae+3]=g[Ve[0]],X.array[ae+4]=g[Ve[1]],X.array[ae+5]=g[Ve[2]],X.array[ae+6]=v[Ve[0]],X.array[ae+7]=v[Ve[1]],X.array[ae+8]=v[Ve[2]],ae+=9;else if("faces"===X.boundTo)for(o=0,a=Pe.length;o<a;o++)m=j=X.value[Pe[o]],g=j,v=j,X.array[ae]=m[Ve[0]],X.array[ae+1]=m[Ve[1]],X.array[ae+2]=m[Ve[2]],X.array[ae+3]=g[Ve[0]],X.array[ae+4]=g[Ve[1]],X.array[ae+5]=g[Ve[2]],X.array[ae+6]=v[Ve[0]],X.array[ae+7]=v[Ve[1]],X.array[ae+8]=v[Ve[2]],ae+=9;else if("faceVertices"===X.boundTo)for(o=0,a=Pe.length;o<a;o++)m=(j=X.value[Pe[o]])[0],g=j[1],v=j[2],X.array[ae]=m[Ve[0]],X.array[ae+1]=m[Ve[1]],X.array[ae+2]=m[Ve[2]],X.array[ae+3]=g[Ve[0]],X.array[ae+4]=g[Ve[1]],X.array[ae+5]=g[Ve[2]],X.array[ae+6]=v[Ve[0]],X.array[ae+7]=v[Ve[1]],X.array[ae+8]=v[Ve[2]],ae+=9}else if(4===X.size)if(void 0===X.boundTo||"vertices"===X.boundTo)for(o=0,a=Pe.length;o<a;o++)s=Le[Pe[o]],m=X.value[s.a],g=X.value[s.b],v=X.value[s.c],X.array[ae]=m.x,X.array[ae+1]=m.y,X.array[ae+2]=m.z,X.array[ae+3]=m.w,X.array[ae+4]=g.x,X.array[ae+5]=g.y,X.array[ae+6]=g.z,X.array[ae+7]=g.w,X.array[ae+8]=v.x,X.array[ae+9]=v.y,X.array[ae+10]=v.z,X.array[ae+11]=v.w,ae+=12;else if("faces"===X.boundTo)for(o=0,a=Pe.length;o<a;o++)m=j=X.value[Pe[o]],g=j,v=j,X.array[ae]=m.x,X.array[ae+1]=m.y,X.array[ae+2]=m.z,X.array[ae+3]=m.w,X.array[ae+4]=g.x,X.array[ae+5]=g.y,X.array[ae+6]=g.z,X.array[ae+7]=g.w,X.array[ae+8]=v.x,X.array[ae+9]=v.y,X.array[ae+10]=v.z,X.array[ae+11]=v.w,ae+=12;else if("faceVertices"===X.boundTo)for(o=0,a=Pe.length;o<a;o++)m=(j=X.value[Pe[o]])[0],g=j[1],v=j[2],X.array[ae]=m.x,X.array[ae+1]=m.y,X.array[ae+2]=m.z,X.array[ae+3]=m.w,X.array[ae+4]=g.x,X.array[ae+5]=g.y,X.array[ae+6]=g.z,X.array[ae+7]=g.w,X.array[ae+8]=v.x,X.array[ae+9]=v.y,X.array[ae+10]=v.z,X.array[ae+11]=v.w,ae+=12;x.bindBuffer(x.ARRAY_BUFFER,X.buffer),x.bufferData(x.ARRAY_BUFFER,X.array,n)}i&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function Ce(e,t,n,i){for(var r=n.attributes,o=t.attributes,a=t.attributesKeys,s=0,l=a.length;s<l;s++){var c=a[s],u=o[c];if(u>=0){var h=r[c];if(void 0!==h){var d=h.itemSize;x.bindBuffer(x.ARRAY_BUFFER,h.buffer),H.enableAttribute(u),x.vertexAttribPointer(u,d,x.FLOAT,!1,0,i*d*4)}else void 0!==e.defaultAttributeValues&&(2===e.defaultAttributeValues[c].length?x.vertexAttrib2fv(u,e.defaultAttributeValues[c]):3===e.defaultAttributeValues[c].length&&x.vertexAttrib3fv(u,e.defaultAttributeValues[c]))}}H.disableUnusedAttributes()}function Pe(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Le(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Re(e,t){return t[0]-e[0]}function De(e,t,n,i,r){for(var o,a=0,s=e.length;a<s;a++){var l=e[a],c=l.object,u=l.buffer;if(Qe(c,t),r)o=r;else{if(!(o=l.material))continue;je(o)}w.setMaterialFaces(o),u instanceof Z.BufferGeometry?w.renderBufferDirect(t,n,i,o,u,c):w.renderBuffer(t,n,i,o,u,c)}}function Ie(e,t,n,i,r,o){for(var a,s=0,l=e.length;s<l;s++){var c=e[s],u=c.object;if(u.visible){if(o)a=o;else{if(!(a=c[t]))continue;je(a)}w.renderImmediateObject(n,i,r,a,u)}}}function Oe(e){var t=e.object.material;t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)}function Ne(e){var t=e.object,n=e.buffer,i=t.geometry,r=t.material;if(r instanceof Z.MeshFaceMaterial){var o=i instanceof Z.BufferGeometry?0:n.materialIndex;r=r.materials[o],e.material=r,r.transparent?y.push(e):v.push(e)}else r&&(e.material=r,r.transparent?y.push(e):v.push(e))}this.renderBufferImmediate=function(e,t,n){if(H.initAttributes(),e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=x.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=x.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=x.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=x.createBuffer()),e.hasPositions&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglVertexBuffer),x.bufferData(x.ARRAY_BUFFER,e.positionArray,x.DYNAMIC_DRAW),H.enableAttribute(t.attributes.position),x.vertexAttribPointer(t.attributes.position,3,x.FLOAT,!1,0,0)),e.hasNormals){if(x.bindBuffer(x.ARRAY_BUFFER,e.__webglNormalBuffer),n instanceof Z.MeshPhongMaterial==!1&&n.shading===Z.FlatShading){var i,r,o,a,s,l,c,u,h,d,f,p=3*e.count;for(f=0;f<p;f+=9)a=(d=e.normalArray)[f],l=d[f+1],u=d[f+2],s=d[f+3],c=d[f+4],h=d[f+5],i=(a+s+d[f+6])/3,r=(l+c+d[f+7])/3,o=(u+h+d[f+8])/3,d[f]=i,d[f+1]=r,d[f+2]=o,d[f+3]=i,d[f+4]=r,d[f+5]=o,d[f+6]=i,d[f+7]=r,d[f+8]=o}x.bufferData(x.ARRAY_BUFFER,e.normalArray,x.DYNAMIC_DRAW),H.enableAttribute(t.attributes.normal),x.vertexAttribPointer(t.attributes.normal,3,x.FLOAT,!1,0,0)}e.hasUvs&&n.map&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglUvBuffer),x.bufferData(x.ARRAY_BUFFER,e.uvArray,x.DYNAMIC_DRAW),H.enableAttribute(t.attributes.uv),x.vertexAttribPointer(t.attributes.uv,2,x.FLOAT,!1,0,0)),e.hasColors&&n.vertexColors!==Z.NoColors&&(x.bindBuffer(x.ARRAY_BUFFER,e.__webglColorBuffer),x.bufferData(x.ARRAY_BUFFER,e.colorArray,x.DYNAMIC_DRAW),H.enableAttribute(t.attributes.color),x.vertexAttribPointer(t.attributes.color,3,x.FLOAT,!1,0,0)),H.disableUnusedAttributes(),x.drawArrays(x.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,o,a){if(!1!==r.visible){Ue(a);var s=Xe(e,t,n,r,a),l=!1,c=r.wireframe?1:0,u="direct_"+o.id+"_"+s.id+"_"+c;if(u!==S&&(S=u,l=!0),l&&H.initAttributes(),a instanceof Z.Mesh){var h=!0===r.wireframe?x.LINES:x.TRIANGLES;if(g=o.attributes.index){if(g.array instanceof Uint32Array&&W.get("OES_element_index_uint")?(v=x.UNSIGNED_INT,y=4):(v=x.UNSIGNED_SHORT,y=2),0===(_=o.offsets).length)l&&(Ce(r,s,o,0),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,g.buffer)),x.drawElements(h,g.array.length,v,0),w.info.render.calls++,w.info.render.vertices+=g.array.length,w.info.render.faces+=g.array.length/3;else{l=!0;for(var d=0,f=_.length;d<f;d++){var p=_[d].index;l&&(Ce(r,s,o,p),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,g.buffer)),x.drawElements(h,_[d].count,v,_[d].start*y),w.info.render.calls++,w.info.render.vertices+=_[d].count,w.info.render.faces+=_[d].count/3}}}else{l&&Ce(r,s,o,0);var m=o.attributes.position;x.drawArrays(h,0,m.array.length/m.itemSize),w.info.render.calls++,w.info.render.vertices+=m.array.length/m.itemSize,w.info.render.faces+=m.array.length/(3*m.itemSize)}}else if(a instanceof Z.PointCloud){h=x.POINTS;if(g=o.attributes.index){if(g.array instanceof Uint32Array&&W.get("OES_element_index_uint")?(v=x.UNSIGNED_INT,y=4):(v=x.UNSIGNED_SHORT,y=2),0===(_=o.offsets).length)l&&(Ce(r,s,o,0),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,g.buffer)),x.drawElements(h,g.array.length,v,0),w.info.render.calls++,w.info.render.points+=g.array.length;else{_.length>1&&(l=!0);for(d=0,f=_.length;d<f;d++){p=_[d].index;l&&(Ce(r,s,o,p),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,g.buffer)),x.drawElements(h,_[d].count,v,_[d].start*y),w.info.render.calls++,w.info.render.points+=_[d].count}}}else{l&&Ce(r,s,o,0);m=o.attributes.position;if(0===(_=o.offsets).length)x.drawArrays(h,0,m.array.length/3),w.info.render.calls++,w.info.render.points+=m.array.length/3;else for(d=0,f=_.length;d<f;d++)x.drawArrays(h,_[d].index,_[d].count),w.info.render.calls++,w.info.render.points+=_[d].count}}else if(a instanceof Z.Line){var g;h=a.mode===Z.LineStrip?x.LINE_STRIP:x.LINES;if(H.setLineWidth(r.linewidth*i),g=o.attributes.index){var v,y;if(g.array instanceof Uint32Array?(v=x.UNSIGNED_INT,y=4):(v=x.UNSIGNED_SHORT,y=2),0===(_=o.offsets).length)l&&(Ce(r,s,o,0),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,g.buffer)),x.drawElements(h,g.array.length,v,0),w.info.render.calls++,w.info.render.vertices+=g.array.length;else{_.length>1&&(l=!0);for(d=0,f=_.length;d<f;d++){p=_[d].index;l&&(Ce(r,s,o,p),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,g.buffer)),x.drawElements(h,_[d].count,v,_[d].start*y),w.info.render.calls++,w.info.render.vertices+=_[d].count}}}else{l&&Ce(r,s,o,0);var _;m=o.attributes.position;if(0===(_=o.offsets).length)x.drawArrays(h,0,m.array.length/3),w.info.render.calls++,w.info.render.vertices+=m.array.length/3;else for(d=0,f=_.length;d<f;d++)x.drawArrays(h,_[d].index,_[d].count),w.info.render.calls++,w.info.render.vertices+=_[d].count}}}},this.renderBuffer=function(e,t,n,r,o,a){if(!1!==r.visible){Ue(a);var s=Xe(e,t,n,r,a),l=s.attributes,c=!1,u=r.wireframe?1:0,h=o.id+"_"+s.id+"_"+u;if(h!==S&&(S=h,c=!0),c&&H.initAttributes(),!r.morphTargets&&l.position>=0?c&&(x.bindBuffer(x.ARRAY_BUFFER,o.__webglVertexBuffer),H.enableAttribute(l.position),x.vertexAttribPointer(l.position,3,x.FLOAT,!1,0,0)):a.morphTargetBase&&function(e,t,n){var i=e.program.attributes;-1!==n.morphTargetBase&&i.position>=0?(x.bindBuffer(x.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[n.morphTargetBase]),H.enableAttribute(i.position),x.vertexAttribPointer(i.position,3,x.FLOAT,!1,0,0)):i.position>=0&&(x.bindBuffer(x.ARRAY_BUFFER,t.__webglVertexBuffer),H.enableAttribute(i.position),x.vertexAttribPointer(i.position,3,x.FLOAT,!1,0,0));if(n.morphTargetForcedOrder.length)for(var r=0,o=n.morphTargetForcedOrder,a=n.morphTargetInfluences;r<e.numSupportedMorphTargets&&r<o.length;)(s=i["morphTarget"+r])>=0&&(x.bindBuffer(x.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[r]]),H.enableAttribute(s),x.vertexAttribPointer(s,3,x.FLOAT,!1,0,0)),(s=i["morphNormal"+r])>=0&&e.morphNormals&&(x.bindBuffer(x.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[r]]),H.enableAttribute(s),x.vertexAttribPointer(s,3,x.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[r]=a[o[r]],r++;else{var s,l=[],a=n.morphTargetInfluences,c=n.geometry.morphTargets;a.length>c.length&&(console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array."),a.length=c.length);for(var u=0,h=a.length;u<h;u++){var d=a[u];l.push([d,u])}l.length>e.numSupportedMorphTargets?(l.sort(Re),l.length=e.numSupportedMorphTargets):l.length>e.numSupportedMorphNormals?l.sort(Re):0===l.length&&l.push([0,0]);for(var r=0,f=e.numSupportedMorphTargets;r<f;r++)if(l[r]){var p=l[r][1];(s=i["morphTarget"+r])>=0&&(x.bindBuffer(x.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[p]),H.enableAttribute(s),x.vertexAttribPointer(s,3,x.FLOAT,!1,0,0)),(s=i["morphNormal"+r])>=0&&e.morphNormals&&(x.bindBuffer(x.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[p]),H.enableAttribute(s),x.vertexAttribPointer(s,3,x.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[r]=a[p]}else n.__webglMorphTargetInfluences[r]=0}null!==e.program.uniforms.morphTargetInfluences&&x.uniform1fv(e.program.uniforms.morphTargetInfluences,n.__webglMorphTargetInfluences)}(r,o,a),c){if(o.__webglCustomAttributesList)for(var d=0,f=o.__webglCustomAttributesList.length;d<f;d++){var p=o.__webglCustomAttributesList[d];l[p.buffer.belongsToAttribute]>=0&&(x.bindBuffer(x.ARRAY_BUFFER,p.buffer),H.enableAttribute(l[p.buffer.belongsToAttribute]),x.vertexAttribPointer(l[p.buffer.belongsToAttribute],p.size,x.FLOAT,!1,0,0))}l.color>=0&&(a.geometry.colors.length>0||a.geometry.faces.length>0?(x.bindBuffer(x.ARRAY_BUFFER,o.__webglColorBuffer),H.enableAttribute(l.color),x.vertexAttribPointer(l.color,3,x.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&x.vertexAttrib3fv(l.color,r.defaultAttributeValues.color)),l.normal>=0&&(x.bindBuffer(x.ARRAY_BUFFER,o.__webglNormalBuffer),H.enableAttribute(l.normal),x.vertexAttribPointer(l.normal,3,x.FLOAT,!1,0,0)),l.tangent>=0&&(x.bindBuffer(x.ARRAY_BUFFER,o.__webglTangentBuffer),H.enableAttribute(l.tangent),x.vertexAttribPointer(l.tangent,4,x.FLOAT,!1,0,0)),l.uv>=0&&(a.geometry.faceVertexUvs[0]?(x.bindBuffer(x.ARRAY_BUFFER,o.__webglUVBuffer),H.enableAttribute(l.uv),x.vertexAttribPointer(l.uv,2,x.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&x.vertexAttrib2fv(l.uv,r.defaultAttributeValues.uv)),l.uv2>=0&&(a.geometry.faceVertexUvs[1]?(x.bindBuffer(x.ARRAY_BUFFER,o.__webglUV2Buffer),H.enableAttribute(l.uv2),x.vertexAttribPointer(l.uv2,2,x.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&x.vertexAttrib2fv(l.uv2,r.defaultAttributeValues.uv2)),r.skinning&&l.skinIndex>=0&&l.skinWeight>=0&&(x.bindBuffer(x.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),H.enableAttribute(l.skinIndex),x.vertexAttribPointer(l.skinIndex,4,x.FLOAT,!1,0,0),x.bindBuffer(x.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),H.enableAttribute(l.skinWeight),x.vertexAttribPointer(l.skinWeight,4,x.FLOAT,!1,0,0)),l.lineDistance>=0&&(x.bindBuffer(x.ARRAY_BUFFER,o.__webglLineDistanceBuffer),H.enableAttribute(l.lineDistance),x.vertexAttribPointer(l.lineDistance,1,x.FLOAT,!1,0,0))}if(H.disableUnusedAttributes(),a instanceof Z.Mesh){var m=o.__typeArray===Uint32Array?x.UNSIGNED_INT:x.UNSIGNED_SHORT;r.wireframe?(H.setLineWidth(r.wireframeLinewidth*i),c&&x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),x.drawElements(x.LINES,o.__webglLineCount,m,0)):(c&&x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),x.drawElements(x.TRIANGLES,o.__webglFaceCount,m,0)),w.info.render.calls++,w.info.render.vertices+=o.__webglFaceCount,w.info.render.faces+=o.__webglFaceCount/3}else if(a instanceof Z.Line){var g=a.mode===Z.LineStrip?x.LINE_STRIP:x.LINES;H.setLineWidth(r.linewidth*i),x.drawArrays(g,0,o.__webglLineCount),w.info.render.calls++}else a instanceof Z.PointCloud&&(x.drawArrays(x.POINTS,0,o.__webglParticleCount),w.info.render.calls++,w.info.render.points+=o.__webglParticleCount)}},this.render=function(e,t,n,i){if(t instanceof Z.Camera!=!1){var r=e.fog;S="",M=-1,C=null,U=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),e.traverse(function(e){e instanceof Z.SkinnedMesh&&e.skeleton.update()}),t.matrixWorldInverse.getInverse(t.matrixWorld),V.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),k.setFromMatrix(V),p.length=0,v.length=0,y.length=0,_.length=0,b.length=0,function e(t){if(!1===t.visible)return;if(t instanceof Z.Scene||t instanceof Z.Group);else if(function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new Z.Matrix4,e._normalMatrix=new Z.Matrix3,e.addEventListener("removed",pe));var t=e.geometry;void 0===t||void 0===t.__webglInit&&(t.__webglInit=!0,t.addEventListener("dispose",me),t instanceof Z.BufferGeometry?w.info.memory.geometries++:e instanceof Z.Mesh?Fe(e,t):e instanceof Z.Line?void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=x.createBuffer(),e.__webglColorBuffer=x.createBuffer(),e.__webglLineDistanceBuffer=x.createBuffer(),w.info.memory.geometries++}(t),function(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__lineDistanceArray=new Float32Array(1*n),e.__webglLineCount=n,Ee(t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0,t.lineDistancesNeedUpdate=!0):e instanceof Z.PointCloud&&void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=x.createBuffer(),e.__webglColorBuffer=x.createBuffer(),w.info.memory.geometries++}(t),function(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__webglParticleCount=n,Ee(t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0));if(void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof Z.Mesh){if(t instanceof Z.BufferGeometry)Be(m,t,e);else if(t instanceof Z.Geometry)for(var n=ke[t.id],i=0,r=n.length;i<r;i++)Be(m,n[i],e)}else e instanceof Z.Line||e instanceof Z.PointCloud?Be(m,t,e):(e instanceof Z.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}(g,e)}(t),t instanceof Z.Light)p.push(t);else if(t instanceof Z.Sprite)_.push(t);else if(t instanceof Z.LensFlare)b.push(t);else{var n=m[t.id];if(n&&(!1===t.frustumCulled||!0===k.intersectsObject(t)))for(var i=0,r=n.length;i<r;i++){var o=n[i];Ne(o),o.render=!0,!0===w.sortObjects&&(F.setFromMatrixPosition(t.matrixWorld),F.applyProjection(V),o.z=F.z)}}for(var i=0,r=t.children.length;i<r;i++)e(t.children[i])}(e),!0===w.sortObjects&&(v.sort(Pe),y.sort(Le)),ue.render(e,t),w.info.render.calls=0,w.info.render.vertices=0,w.info.render.faces=0,w.info.render.points=0,this.setRenderTarget(n),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var o=0,a=g.length;o<a;o++){var s=g[o],l=s.object;l.visible&&(Qe(l,t),Oe(s))}if(e.overrideMaterial){var c=e.overrideMaterial;je(c),De(v,t,p,r,c),De(y,t,p,r,c),Ie(g,"",t,p,r,c)}else H.setBlending(Z.NoBlending),De(v,t,p,r,null),Ie(g,"opaque",t,p,r,null),De(y,t,p,r,null),Ie(g,"transparent",t,p,r,null);he.render(e,t),de.render(e,t,O,N),n&&n.generateMipmaps&&n.minFilter!==Z.NearestFilter&&n.minFilter!==Z.LinearFilter&&function(e){e instanceof Z.WebGLRenderTargetCube?(x.bindTexture(x.TEXTURE_CUBE_MAP,e.__webglTexture),x.generateMipmap(x.TEXTURE_CUBE_MAP),x.bindTexture(x.TEXTURE_CUBE_MAP,null)):(x.bindTexture(x.TEXTURE_2D,e.__webglTexture),x.generateMipmap(x.TEXTURE_2D),x.bindTexture(x.TEXTURE_2D,null))}(n),H.setDepthTest(!0),H.setDepthWrite(!0),H.setColorWrite(!0)}else Z.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.renderImmediateObject=function(e,t,n,i,r){var o=Xe(e,t,n,i,r);S="",w.setMaterialFaces(i),r.immediateRenderCallback?r.immediateRenderCallback(o,x,k):r.render(function(e){w.renderBufferImmediate(e,o,i)})};var ke={},Ve=0;function Fe(e,t){var n=e.material,i=!1;void 0!==ke[t.id]&&!0!==t.groupsNeedUpdate||(delete m[e.id],ke[t.id]=function(e,t){for(var n,i,r=W.get("OES_element_index_uint")?4294967296:65535,o={},a=e.morphTargets.length,s=e.morphNormals.length,l={},c=[],u=0,h=e.faces.length;u<h;u++){var d=e.faces[u],f=t?d.materialIndex:0;f in o||(o[f]={hash:f,counter:0}),(n=o[f].hash+"_"+o[f].counter)in l||(i={id:Ve++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:a,numMorphNormals:s},l[n]=i,c.push(i)),l[n].vertices+3>r&&(o[f].counter+=1,(n=o[f].hash+"_"+o[f].counter)in l||(i={id:Ve++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:a,numMorphNormals:s},l[n]=i,c.push(i))),l[n].faces3.push(u),l[n].vertices+=3}return c}(t,n instanceof Z.MeshFaceMaterial),t.groupsNeedUpdate=!1);for(var r=ke[t.id],o=0,a=r.length;o<a;o++){var s=r[o];void 0===s.__webglVertexBuffer?(fe(s),Te(s,e),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0,i=!0):i=!1,(i||void 0===e.__webglActive)&&Be(m,s,e)}e.__webglActive=!0}function Be(e,t,n){var i=n.id;e[i]=e[i]||[],e[i].push({id:i,buffer:t,object:n,material:null,z:0})}function Ue(e){var t=e.geometry;if(t instanceof Z.BufferGeometry)for(var n=t.attributes,i=t.attributesKeys,r=0,o=i.length;r<o;r++){var a=i[r],s=n[a],l="index"===a?x.ELEMENT_ARRAY_BUFFER:x.ARRAY_BUFFER;void 0===s.buffer?(s.buffer=x.createBuffer(),x.bindBuffer(l,s.buffer),x.bufferData(l,s.array,s instanceof Z.DynamicBufferAttribute?x.DYNAMIC_DRAW:x.STATIC_DRAW),s.needsUpdate=!1):!0===s.needsUpdate&&(x.bindBuffer(l,s.buffer),void 0===s.updateRange||-1===s.updateRange.count?x.bufferSubData(l,0,s.array):0===s.updateRange.count?console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually."):(x.bufferSubData(l,s.updateRange.offset*s.array.BYTES_PER_ELEMENT,s.array.subarray(s.updateRange.offset,s.updateRange.offset+s.updateRange.count)),s.updateRange.count=0),s.needsUpdate=!1)}else if(e instanceof Z.Mesh){!0===t.groupsNeedUpdate&&Fe(e,t);for(var c=ke[t.id],u=(r=0,c.length);r<u;r++){var h=c[r],d=(f=Me(e,h)).attributes&&ze(f);(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||d)&&Se(h,e,x.DYNAMIC_DRAW,!t.dynamic,f)}t.verticesNeedUpdate=!1,t.morphTargetsNeedUpdate=!1,t.elementsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.tangentsNeedUpdate=!1,f.attributes&&Ge(f)}else if(e instanceof Z.Line){d=(f=Me(e,t)).attributes&&ze(f);(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||d)&&function(e,t){var n,i,r,o,a,s,l,c,u,h,d,f,p=e.vertices,m=e.colors,g=e.lineDistances,v=p.length,y=m.length,_=g.length,b=e.__vertexArray,w=e.__colorArray,A=e.__lineDistanceArray,E=e.verticesNeedUpdate,T=e.colorsNeedUpdate,M=e.lineDistancesNeedUpdate,S=e.__webglCustomAttributesList;if(E){for(n=0;n<v;n++)o=p[n],b[a=3*n]=o.x,b[a+1]=o.y,b[a+2]=o.z;x.bindBuffer(x.ARRAY_BUFFER,e.__webglVertexBuffer),x.bufferData(x.ARRAY_BUFFER,b,t)}if(T){for(i=0;i<y;i++)s=m[i],w[a=3*i]=s.r,w[a+1]=s.g,w[a+2]=s.b;x.bindBuffer(x.ARRAY_BUFFER,e.__webglColorBuffer),x.bufferData(x.ARRAY_BUFFER,w,t)}if(M){for(r=0;r<_;r++)A[r]=g[r];x.bindBuffer(x.ARRAY_BUFFER,e.__webglLineDistanceBuffer),x.bufferData(x.ARRAY_BUFFER,A,t)}if(S)for(l=0,c=S.length;l<c;l++)if((f=S[l]).needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(a=0,h=f.value.length,1===f.size)for(u=0;u<h;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;u<h;u++)d=f.value[u],f.array[a]=d.x,f.array[a+1]=d.y,a+=2;else if(3===f.size)if("c"===f.type)for(u=0;u<h;u++)d=f.value[u],f.array[a]=d.r,f.array[a+1]=d.g,f.array[a+2]=d.b,a+=3;else for(u=0;u<h;u++)d=f.value[u],f.array[a]=d.x,f.array[a+1]=d.y,f.array[a+2]=d.z,a+=3;else if(4===f.size)for(u=0;u<h;u++)d=f.value[u],f.array[a]=d.x,f.array[a+1]=d.y,f.array[a+2]=d.z,f.array[a+3]=d.w,a+=4;x.bindBuffer(x.ARRAY_BUFFER,f.buffer),x.bufferData(x.ARRAY_BUFFER,f.array,t),f.needsUpdate=!1}}(t,x.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,t.lineDistancesNeedUpdate=!1,f.attributes&&Ge(f)}else if(e instanceof Z.PointCloud){var f;d=(f=Me(e,t)).attributes&&ze(f);(t.verticesNeedUpdate||t.colorsNeedUpdate||d)&&function(e,t,n){var i,r,o,a,s,l,c,u,h,d,f,p=e.vertices,m=p.length,g=e.colors,v=g.length,y=e.__vertexArray,_=e.__colorArray,b=e.verticesNeedUpdate,w=e.colorsNeedUpdate,A=e.__webglCustomAttributesList;if(b){for(i=0;i<m;i++)o=p[i],y[a=3*i]=o.x,y[a+1]=o.y,y[a+2]=o.z;x.bindBuffer(x.ARRAY_BUFFER,e.__webglVertexBuffer),x.bufferData(x.ARRAY_BUFFER,y,t)}if(w){for(r=0;r<v;r++)s=g[r],_[a=3*r]=s.r,_[a+1]=s.g,_[a+2]=s.b;x.bindBuffer(x.ARRAY_BUFFER,e.__webglColorBuffer),x.bufferData(x.ARRAY_BUFFER,_,t)}if(A)for(l=0,c=A.length;l<c;l++){if((f=A[l]).needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo))if(h=f.value.length,a=0,1===f.size)for(u=0;u<h;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;u<h;u++)d=f.value[u],f.array[a]=d.x,f.array[a+1]=d.y,a+=2;else if(3===f.size)if("c"===f.type)for(u=0;u<h;u++)d=f.value[u],f.array[a]=d.r,f.array[a+1]=d.g,f.array[a+2]=d.b,a+=3;else for(u=0;u<h;u++)d=f.value[u],f.array[a]=d.x,f.array[a+1]=d.y,f.array[a+2]=d.z,a+=3;else if(4===f.size)for(u=0;u<h;u++)d=f.value[u],f.array[a]=d.x,f.array[a+1]=d.y,f.array[a+2]=d.z,f.array[a+3]=d.w,a+=4;x.bindBuffer(x.ARRAY_BUFFER,f.buffer),x.bufferData(x.ARRAY_BUFFER,f.array,t),f.needsUpdate=!1}}(t,x.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,f.attributes&&Ge(f)}}function ze(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function Ge(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}var He={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};function We(e,t,n,i){e.addEventListener("dispose",ye);var o=He[e.type];if(o){var a=Z.ShaderLib[o];e.__webglShader={uniforms:Z.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};var s=function(e){for(var t=0,n=0,i=0,r=0,o=0,a=e.length;o<a;o++){var s=e[o];s.onlyShadow||!1===s.visible||(s instanceof Z.DirectionalLight&&t++,s instanceof Z.PointLight&&n++,s instanceof Z.SpotLight&&i++,s instanceof Z.HemisphereLight&&r++)}return{directional:t,point:n,spot:i,hemi:r}}(t),l=function(e){for(var t=0,n=0,i=e.length;n<i;n++){var r=e[n];r.castShadow&&(r instanceof Z.SpotLight&&t++,r instanceof Z.DirectionalLight&&!r.shadowCascade&&t++)}return t}(t),c=function(e){if(te&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var t=x.getParameter(x.MAX_VERTEX_UNIFORM_VECTORS),n=Math.floor((t-20)/4),i=n;return void 0!==e&&e instanceof Z.SkinnedMesh&&(i=Math.min(e.skeleton.bones.length,i))<e.skeleton.bones.length&&Z.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)"),i}(i),u={precision:r,supportsVertexTextures:ee,map:!!e.map,envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:n,useFog:e.fog,fogExp:n instanceof Z.FogExp2,flatShading:e.shading===Z.FlatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:h,skinning:e.skinning,maxBones:c,useVertexTexture:te&&i&&i.skeleton&&i.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:w.maxMorphTargets,maxMorphNormals:w.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:l,shadowMapEnabled:w.shadowMapEnabled&&i.receiveShadow&&l>0,shadowMapType:w.shadowMapType,shadowMapDebug:w.shadowMapDebug,shadowMapCascade:w.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===Z.DoubleSide,flipSided:e.side===Z.BackSide},d=[];if(o?d.push(o):(d.push(e.fragmentShader),d.push(e.vertexShader)),void 0!==e.defines)for(var f in e.defines)d.push(f),d.push(e.defines[f]);for(var f in u)d.push(f),d.push(u[f]);for(var p,m=d.join(),g=0,v=A.length;g<v;g++){var y=A[g];if(y.code===m){(p=y).usedTimes++;break}}void 0===p&&(p=new Z.WebGLProgram(w,m,e,u),A.push(p),w.info.memory.programs=A.length),e.program=p;var _=p.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;for(var b="morphTarget",E=0;E<w.maxMorphTargets;E++)_[b+E]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;b="morphNormal";for(E=0;E<w.maxMorphNormals;E++)_[b+E]>=0&&e.numSupportedMorphNormals++}for(var T in e.uniformsList=[],e.__webglShader.uniforms){var M=e.program.uniforms[T];M&&e.uniformsList.push([e.__webglShader.uniforms[T],M])}}function je(e){!0===e.transparent?H.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):H.setBlending(Z.NoBlending),H.setDepthTest(e.depthTest),H.setDepthWrite(e.depthWrite),H.setColorWrite(e.colorWrite),H.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function Xe(e,n,i,r,o){P=0,r.needsUpdate&&(r.program&&Ae(r),We(r,n,i,o),r.needsUpdate=!1),r.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(w.maxMorphTargets)));var a=!1,s=!1,l=!1,c=r.program,u=c.uniforms,d=r.__webglShader.uniforms;if(c.id!==E&&(x.useProgram(c.program),E=c.id,a=!0,s=!0,l=!0),r.id!==M&&(-1===M&&(l=!0),M=r.id,s=!0),(a||e!==C)&&(x.uniformMatrix4fv(u.projectionMatrix,!1,e.projectionMatrix.elements),h&&x.uniform1f(u.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==C&&(C=e),(r instanceof Z.ShaderMaterial||r instanceof Z.MeshPhongMaterial||r.envMap)&&null!==u.cameraPosition&&(F.setFromMatrixPosition(e.matrixWorld),x.uniform3f(u.cameraPosition,F.x,F.y,F.z)),(r instanceof Z.MeshPhongMaterial||r instanceof Z.MeshLambertMaterial||r instanceof Z.MeshBasicMaterial||r instanceof Z.ShaderMaterial||r.skinning)&&null!==u.viewMatrix&&x.uniformMatrix4fv(u.viewMatrix,!1,e.matrixWorldInverse.elements)),r.skinning)if(o.bindMatrix&&null!==u.bindMatrix&&x.uniformMatrix4fv(u.bindMatrix,!1,o.bindMatrix.elements),o.bindMatrixInverse&&null!==u.bindMatrixInverse&&x.uniformMatrix4fv(u.bindMatrixInverse,!1,o.bindMatrixInverse.elements),te&&o.skeleton&&o.skeleton.useVertexTexture){if(null!==u.boneTexture){var f=Ke();x.uniform1i(u.boneTexture,f),w.setTexture(o.skeleton.boneTexture,f)}null!==u.boneTextureWidth&&x.uniform1i(u.boneTextureWidth,o.skeleton.boneTextureWidth),null!==u.boneTextureHeight&&x.uniform1i(u.boneTextureHeight,o.skeleton.boneTextureHeight)}else o.skeleton&&o.skeleton.boneMatrices&&null!==u.boneGlobalMatrices&&x.uniformMatrix4fv(u.boneGlobalMatrices,!1,o.skeleton.boneMatrices);return s&&(i&&r.fog&&function(e,t){e.fogColor.value=t.color,t instanceof Z.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof Z.FogExp2&&(e.fogDensity.value=t.density)}(d,i),(r instanceof Z.MeshPhongMaterial||r instanceof Z.MeshLambertMaterial||r.lights)&&(U&&(l=!0,function(e){var t,n,i,r,o,a,s,l,c=0,u=0,h=0,d=z,f=d.directional.colors,p=d.directional.positions,m=d.point.colors,g=d.point.positions,v=d.point.distances,y=d.point.decays,_=d.spot.colors,b=d.spot.positions,x=d.spot.distances,w=d.spot.directions,A=d.spot.anglesCos,E=d.spot.exponents,T=d.spot.decays,M=d.hemi.skyColors,S=d.hemi.groundColors,C=d.hemi.positions,P=0,L=0,R=0,D=0,I=0,O=0,N=0,k=0,V=0,U=0,G=0,H=0;for(t=0,n=e.length;t<n;t++)if(!(i=e[t]).onlyShadow)if(r=i.color,s=i.intensity,l=i.distance,i instanceof Z.AmbientLight){if(!i.visible)continue;c+=r.r,u+=r.g,h+=r.b}else if(i instanceof Z.DirectionalLight){if(I+=1,!i.visible)continue;B.setFromMatrixPosition(i.matrixWorld),F.setFromMatrixPosition(i.target.matrixWorld),B.sub(F),B.normalize(),p[V=3*P]=B.x,p[V+1]=B.y,p[V+2]=B.z,Ze(f,V,r,s),P+=1}else if(i instanceof Z.PointLight){if(O+=1,!i.visible)continue;Ze(m,U=3*L,r,s),F.setFromMatrixPosition(i.matrixWorld),g[U]=F.x,g[U+1]=F.y,g[U+2]=F.z,v[L]=l,y[L]=0===i.distance?0:i.decay,L+=1}else if(i instanceof Z.SpotLight){if(N+=1,!i.visible)continue;Ze(_,G=3*R,r,s),B.setFromMatrixPosition(i.matrixWorld),b[G]=B.x,b[G+1]=B.y,b[G+2]=B.z,x[R]=l,F.setFromMatrixPosition(i.target.matrixWorld),B.sub(F),B.normalize(),w[G]=B.x,w[G+1]=B.y,w[G+2]=B.z,A[R]=Math.cos(i.angle),E[R]=i.exponent,T[R]=0===i.distance?0:i.decay,R+=1}else if(i instanceof Z.HemisphereLight){if(k+=1,!i.visible)continue;B.setFromMatrixPosition(i.matrixWorld),B.normalize(),C[H=3*D]=B.x,C[H+1]=B.y,C[H+2]=B.z,o=i.color,a=i.groundColor,Ze(M,H,o,s),Ze(S,H,a,s),D+=1}for(t=3*P,n=Math.max(f.length,3*I);t<n;t++)f[t]=0;for(t=3*L,n=Math.max(m.length,3*O);t<n;t++)m[t]=0;for(t=3*R,n=Math.max(_.length,3*N);t<n;t++)_[t]=0;for(t=3*D,n=Math.max(M.length,3*k);t<n;t++)M[t]=0;for(t=3*D,n=Math.max(S.length,3*k);t<n;t++)S[t]=0;d.directional.length=P,d.point.length=L,d.spot.length=R,d.hemi.length=D,d.ambient[0]=c,d.ambient[1]=u,d.ambient[2]=h}(n),U=!1),l?(!function(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecay.value=t.point.decays,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.spotLightDecay.value=t.spot.decays,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}(d,z),Ye(d,!0)):Ye(d,!1)),(r instanceof Z.MeshBasicMaterial||r instanceof Z.MeshLambertMaterial||r instanceof Z.MeshPhongMaterial)&&function(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var n;t.map?n=t.map:t.specularMap?n=t.specularMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.alphaMap&&(n=t.alphaMap);if(void 0!==n){var i=n.offset,r=n.repeat;e.offsetRepeat.value.set(i.x,i.y,r.x,r.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof Z.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}(d,r),r instanceof Z.LineBasicMaterial?qe(d,r):r instanceof Z.LineDashedMaterial?(qe(d,r),function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(d,r)):r instanceof Z.PointCloudMaterial?function(e,n){if(e.psColor.value=n.color,e.opacity.value=n.opacity,e.size.value=n.size,e.scale.value=t.height/2,e.map.value=n.map,null!==n.map){var i=n.map.offset,r=n.map.repeat;e.offsetRepeat.value.set(i.x,i.y,r.x,r.y)}}(d,r):r instanceof Z.MeshPhongMaterial?function(e,t){e.shininess.value=t.shininess,e.emissive.value=t.emissive,e.specular.value=t.specular,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(d,r):r instanceof Z.MeshLambertMaterial?function(e,t){e.emissive.value=t.emissive,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(d,r):r instanceof Z.MeshDepthMaterial?(d.mNear.value=e.near,d.mFar.value=e.far,d.opacity.value=r.opacity):r instanceof Z.MeshNormalMaterial&&(d.opacity.value=r.opacity),o.receiveShadow&&!r._shadowPass&&function(e,t){if(e.shadowMatrix)for(var n=0,i=0,r=t.length;i<r;i++){var o=t[i];o.castShadow&&((o instanceof Z.SpotLight||o instanceof Z.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[n]=o.shadowMap,e.shadowMapSize.value[n]=o.shadowMapSize,e.shadowMatrix.value[n]=o.shadowMatrix,e.shadowDarkness.value[n]=o.shadowDarkness,e.shadowBias.value[n]=o.shadowBias,n++))}}(d,n),function(e){for(var t,n,i,r=0,o=e.length;r<o;r++){var a=e[r][0];if(!1!==a.needsUpdate){var s=a.type,l=a.value,c=e[r][1];switch(s){case"1i":x.uniform1i(c,l);break;case"1f":x.uniform1f(c,l);break;case"2f":x.uniform2f(c,l[0],l[1]);break;case"3f":x.uniform3f(c,l[0],l[1],l[2]);break;case"4f":x.uniform4f(c,l[0],l[1],l[2],l[3]);break;case"1iv":x.uniform1iv(c,l);break;case"3iv":x.uniform3iv(c,l);break;case"1fv":x.uniform1fv(c,l);break;case"2fv":x.uniform2fv(c,l);break;case"3fv":x.uniform3fv(c,l);break;case"4fv":x.uniform4fv(c,l);break;case"Matrix3fv":x.uniformMatrix3fv(c,!1,l);break;case"Matrix4fv":x.uniformMatrix4fv(c,!1,l);break;case"i":x.uniform1i(c,l);break;case"f":x.uniform1f(c,l);break;case"v2":x.uniform2f(c,l.x,l.y);break;case"v3":x.uniform3f(c,l.x,l.y,l.z);break;case"v4":x.uniform4f(c,l.x,l.y,l.z,l.w);break;case"c":x.uniform3f(c,l.r,l.g,l.b);break;case"iv1":x.uniform1iv(c,l);break;case"iv":x.uniform3iv(c,l);break;case"fv1":x.uniform1fv(c,l);break;case"fv":x.uniform3fv(c,l);break;case"v2v":void 0===a._array&&(a._array=new Float32Array(2*l.length));for(var u=0,h=l.length;u<h;u++)i=2*u,a._array[i]=l[u].x,a._array[i+1]=l[u].y;x.uniform2fv(c,a._array);break;case"v3v":void 0===a._array&&(a._array=new Float32Array(3*l.length));for(var u=0,h=l.length;u<h;u++)i=3*u,a._array[i]=l[u].x,a._array[i+1]=l[u].y,a._array[i+2]=l[u].z;x.uniform3fv(c,a._array);break;case"v4v":void 0===a._array&&(a._array=new Float32Array(4*l.length));for(var u=0,h=l.length;u<h;u++)i=4*u,a._array[i]=l[u].x,a._array[i+1]=l[u].y,a._array[i+2]=l[u].z,a._array[i+3]=l[u].w;x.uniform4fv(c,a._array);break;case"m3":x.uniformMatrix3fv(c,!1,l.elements);break;case"m3v":void 0===a._array&&(a._array=new Float32Array(9*l.length));for(var u=0,h=l.length;u<h;u++)l[u].flattenToArrayOffset(a._array,9*u);x.uniformMatrix3fv(c,!1,a._array);break;case"m4":x.uniformMatrix4fv(c,!1,l.elements);break;case"m4v":void 0===a._array&&(a._array=new Float32Array(16*l.length));for(var u=0,h=l.length;u<h;u++)l[u].flattenToArrayOffset(a._array,16*u);x.uniformMatrix4fv(c,!1,a._array);break;case"t":if(t=l,n=Ke(),x.uniform1i(c,n),!t)continue;t instanceof Z.CubeTexture||t.image instanceof Array&&6===t.image.length?et(t,n):t instanceof Z.WebGLRenderTargetCube?tt(t,n):w.setTexture(t,n);break;case"tv":void 0===a._array&&(a._array=[]);for(var u=0,h=a.value.length;u<h;u++)a._array[u]=Ke();x.uniform1iv(c,a._array);for(var u=0,h=a.value.length;u<h;u++)t=a.value[u],n=a._array[u],t&&w.setTexture(t,n);break;default:Z.warn("THREE.WebGLRenderer: Unknown uniform type: "+s)}}}}(r.uniformsList)),function(e,t){x.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&x.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}(u,o),null!==u.modelMatrix&&x.uniformMatrix4fv(u.modelMatrix,!1,o.matrixWorld.elements),c}function qe(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function Ye(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function Ke(){var e=P;return e>=K&&Z.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+K),P+=1,e}function Qe(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function Ze(e,t,n,i){e[t]=n.r*i,e[t+1]=n.g*i,e[t+2]=n.b*i}function Je(e,t,n){var i;n?(x.texParameteri(e,x.TEXTURE_WRAP_S,ot(t.wrapS)),x.texParameteri(e,x.TEXTURE_WRAP_T,ot(t.wrapT)),x.texParameteri(e,x.TEXTURE_MAG_FILTER,ot(t.magFilter)),x.texParameteri(e,x.TEXTURE_MIN_FILTER,ot(t.minFilter))):(x.texParameteri(e,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(e,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),t.wrapS===Z.ClampToEdgeWrapping&&t.wrapT===Z.ClampToEdgeWrapping||Z.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),x.texParameteri(e,x.TEXTURE_MAG_FILTER,rt(t.magFilter)),x.texParameteri(e,x.TEXTURE_MIN_FILTER,rt(t.minFilter)),t.minFilter!==Z.NearestFilter&&t.minFilter!==Z.LinearFilter&&Z.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")),(i=W.get("EXT_texture_filter_anisotropic"))&&t.type!==Z.FloatType&&t.type!==Z.HalfFloatType&&(t.anisotropy>1||t.__currentAnisotropy)&&(x.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,w.getMaxAnisotropy())),t.__currentAnisotropy=t.anisotropy)}function $e(e,t){if(e.width>t||e.height>t){var n=t/Math.max(e.width,e.height),i=document.createElement("canvas");return i.width=Math.floor(e.width*n),i.height=Math.floor(e.height*n),i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),Z.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height,e),i}return e}function et(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",ge),e.image.__webglTextureCube=x.createTexture(),w.info.memory.textures++),x.activeTexture(x.TEXTURE0+t),x.bindTexture(x.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var n=e instanceof Z.CompressedTexture,i=e.image[0]instanceof Z.DataTexture,r=[],o=0;o<6;o++)!w.autoScaleCubemaps||n||i?r[o]=i?e.image[o].image:e.image[o]:r[o]=$e(e.image[o],$);var a=r[0],s=Z.Math.isPowerOfTwo(a.width)&&Z.Math.isPowerOfTwo(a.height),l=ot(e.format),c=ot(e.type);Je(x.TEXTURE_CUBE_MAP,e,s);for(o=0;o<6;o++)if(n)for(var u,h=r[o].mipmaps,d=0,f=h.length;d<f;d++)u=h[d],e.format!==Z.RGBAFormat&&e.format!==Z.RGBFormat?ae().indexOf(l)>-1?x.compressedTexImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,u.width,u.height,0,u.data):Z.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,u.width,u.height,0,l,c,u.data);else i?x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,r[o].width,r[o].height,0,l,c,r[o].data):x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,l,c,r[o]);e.generateMipmaps&&s&&x.generateMipmap(x.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else x.activeTexture(x.TEXTURE0+t),x.bindTexture(x.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function tt(e,t){x.activeTexture(x.TEXTURE0+t),x.bindTexture(x.TEXTURE_CUBE_MAP,e.__webglTexture)}function nt(e,t,n){x.bindFramebuffer(x.FRAMEBUFFER,e),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,n,t.__webglTexture,0)}function it(e,t){x.bindRenderbuffer(x.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(x.renderbufferStorage(x.RENDERBUFFER,x.DEPTH_COMPONENT16,t.width,t.height),x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(x.renderbufferStorage(x.RENDERBUFFER,x.DEPTH_STENCIL,t.width,t.height),x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_STENCIL_ATTACHMENT,x.RENDERBUFFER,e)):x.renderbufferStorage(x.RENDERBUFFER,x.RGBA4,t.width,t.height)}function rt(e){return e===Z.NearestFilter||e===Z.NearestMipMapNearestFilter||e===Z.NearestMipMapLinearFilter?x.NEAREST:x.LINEAR}function ot(e){var t;if(e===Z.RepeatWrapping)return x.REPEAT;if(e===Z.ClampToEdgeWrapping)return x.CLAMP_TO_EDGE;if(e===Z.MirroredRepeatWrapping)return x.MIRRORED_REPEAT;if(e===Z.NearestFilter)return x.NEAREST;if(e===Z.NearestMipMapNearestFilter)return x.NEAREST_MIPMAP_NEAREST;if(e===Z.NearestMipMapLinearFilter)return x.NEAREST_MIPMAP_LINEAR;if(e===Z.LinearFilter)return x.LINEAR;if(e===Z.LinearMipMapNearestFilter)return x.LINEAR_MIPMAP_NEAREST;if(e===Z.LinearMipMapLinearFilter)return x.LINEAR_MIPMAP_LINEAR;if(e===Z.UnsignedByteType)return x.UNSIGNED_BYTE;if(e===Z.UnsignedShort4444Type)return x.UNSIGNED_SHORT_4_4_4_4;if(e===Z.UnsignedShort5551Type)return x.UNSIGNED_SHORT_5_5_5_1;if(e===Z.UnsignedShort565Type)return x.UNSIGNED_SHORT_5_6_5;if(e===Z.ByteType)return x.BYTE;if(e===Z.ShortType)return x.SHORT;if(e===Z.UnsignedShortType)return x.UNSIGNED_SHORT;if(e===Z.IntType)return x.INT;if(e===Z.UnsignedIntType)return x.UNSIGNED_INT;if(e===Z.FloatType)return x.FLOAT;if(null!==(t=W.get("OES_texture_half_float"))&&e===Z.HalfFloatType)return t.HALF_FLOAT_OES;if(e===Z.AlphaFormat)return x.ALPHA;if(e===Z.RGBFormat)return x.RGB;if(e===Z.RGBAFormat)return x.RGBA;if(e===Z.LuminanceFormat)return x.LUMINANCE;if(e===Z.LuminanceAlphaFormat)return x.LUMINANCE_ALPHA;if(e===Z.AddEquation)return x.FUNC_ADD;if(e===Z.SubtractEquation)return x.FUNC_SUBTRACT;if(e===Z.ReverseSubtractEquation)return x.FUNC_REVERSE_SUBTRACT;if(e===Z.ZeroFactor)return x.ZERO;if(e===Z.OneFactor)return x.ONE;if(e===Z.SrcColorFactor)return x.SRC_COLOR;if(e===Z.OneMinusSrcColorFactor)return x.ONE_MINUS_SRC_COLOR;if(e===Z.SrcAlphaFactor)return x.SRC_ALPHA;if(e===Z.OneMinusSrcAlphaFactor)return x.ONE_MINUS_SRC_ALPHA;if(e===Z.DstAlphaFactor)return x.DST_ALPHA;if(e===Z.OneMinusDstAlphaFactor)return x.ONE_MINUS_DST_ALPHA;if(e===Z.DstColorFactor)return x.DST_COLOR;if(e===Z.OneMinusDstColorFactor)return x.ONE_MINUS_DST_COLOR;if(e===Z.SrcAlphaSaturateFactor)return x.SRC_ALPHA_SATURATE;if(null!==(t=W.get("WEBGL_compressed_texture_s3tc"))){if(e===Z.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Z.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Z.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Z.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=W.get("WEBGL_compressed_texture_pvrtc"))){if(e===Z.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Z.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Z.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Z.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=W.get("EXT_blend_minmax"))){if(e===Z.MinEquation)return t.MIN_EXT;if(e===Z.MaxEquation)return t.MAX_EXT}return 0}this.setFaceCulling=function(e,t){e===Z.CullFaceNone?x.disable(x.CULL_FACE):(t===Z.FrontFaceDirectionCW?x.frontFace(x.CW):x.frontFace(x.CCW),e===Z.CullFaceBack?x.cullFace(x.BACK):e===Z.CullFaceFront?x.cullFace(x.FRONT):x.cullFace(x.FRONT_AND_BACK),x.enable(x.CULL_FACE))},this.setMaterialFaces=function(e){H.setDoubleSided(e.side===Z.DoubleSide),H.setFlipSided(e.side===Z.BackSide)},this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",ge),e.__webglTexture=x.createTexture(),w.info.memory.textures++),x.bindTexture(x.TEXTURE_2D,e.__webglTexture),x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,e.flipY),x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),x.pixelStorei(x.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=$e(e.image,J);var t=e.image,n=Z.Math.isPowerOfTwo(t.width)&&Z.Math.isPowerOfTwo(t.height),i=ot(e.format),r=ot(e.type);Je(x.TEXTURE_2D,e,n);var o,a=e.mipmaps;if(e instanceof Z.DataTexture)if(a.length>0&&n){for(var s=0,l=a.length;s<l;s++)o=a[s],x.texImage2D(x.TEXTURE_2D,s,i,o.width,o.height,0,i,r,o.data);e.generateMipmaps=!1}else x.texImage2D(x.TEXTURE_2D,0,i,t.width,t.height,0,i,r,t.data);else if(e instanceof Z.CompressedTexture)for(s=0,l=a.length;s<l;s++)o=a[s],e.format!==Z.RGBAFormat&&e.format!==Z.RGBFormat?ae().indexOf(i)>-1?x.compressedTexImage2D(x.TEXTURE_2D,s,i,o.width,o.height,0,o.data):Z.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):x.texImage2D(x.TEXTURE_2D,s,i,o.width,o.height,0,i,r,o.data);else if(a.length>0&&n){for(s=0,l=a.length;s<l;s++)o=a[s],x.texImage2D(x.TEXTURE_2D,s,i,i,r,o);e.generateMipmaps=!1}else x.texImage2D(x.TEXTURE_2D,0,i,i,r,e.image);e.generateMipmaps&&n&&x.generateMipmap(x.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()},this.setTexture=function(e,t){x.activeTexture(x.TEXTURE0+t),e.needsUpdate?w.uploadTexture(e):x.bindTexture(x.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t,n,i,r,o,a=e instanceof Z.WebGLRenderTargetCube;if(e&&void 0===e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",ve),e.__webglTexture=x.createTexture(),w.info.memory.textures++;var s=Z.Math.isPowerOfTwo(e.width)&&Z.Math.isPowerOfTwo(e.height),l=ot(e.format),c=ot(e.type);if(a){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],x.bindTexture(x.TEXTURE_CUBE_MAP,e.__webglTexture),Je(x.TEXTURE_CUBE_MAP,e,s);for(var u=0;u<6;u++)e.__webglFramebuffer[u]=x.createFramebuffer(),e.__webglRenderbuffer[u]=x.createRenderbuffer(),x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,l,e.width,e.height,0,l,c,null),nt(e.__webglFramebuffer[u],e,x.TEXTURE_CUBE_MAP_POSITIVE_X+u),it(e.__webglRenderbuffer[u],e);s&&x.generateMipmap(x.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=x.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=x.createRenderbuffer(),x.bindTexture(x.TEXTURE_2D,e.__webglTexture),Je(x.TEXTURE_2D,e,s),x.texImage2D(x.TEXTURE_2D,0,l,e.width,e.height,0,l,c,null),nt(e.__webglFramebuffer,e,x.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_STENCIL_ATTACHMENT,x.RENDERBUFFER,e.__webglRenderbuffer):it(e.__webglRenderbuffer,e),s&&x.generateMipmap(x.TEXTURE_2D);a?x.bindTexture(x.TEXTURE_CUBE_MAP,null):x.bindTexture(x.TEXTURE_2D,null),x.bindRenderbuffer(x.RENDERBUFFER,null),x.bindFramebuffer(x.FRAMEBUFFER,null)}e?(t=a?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,n=e.width,i=e.height,r=0,o=0):(t=null,n=D,i=I,r=L,o=R),t!==T&&(x.bindFramebuffer(x.FRAMEBUFFER,t),x.viewport(r,o,n,i),T=t),O=n,N=i},this.readRenderTargetPixels=function(e,t,n,i,r,o){if(e instanceof Z.WebGLRenderTarget){if(e.__webglFramebuffer){if(e.format!==Z.RGBAFormat)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");var a=!1;e.__webglFramebuffer!==T&&(x.bindFramebuffer(x.FRAMEBUFFER,e.__webglFramebuffer),a=!0),x.checkFramebufferStatus(x.FRAMEBUFFER)===x.FRAMEBUFFER_COMPLETE?x.readPixels(t,n,i,r,x.RGBA,x.UNSIGNED_BYTE,o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),a&&x.bindFramebuffer(x.FRAMEBUFFER,T)}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.initMaterial=function(){Z.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){Z.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){Z.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){Z.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},Z.WebGLRenderTarget=function(e,t,n){this.width=e,this.height=t,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:Z.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:Z.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:Z.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:Z.LinearMipMapLinearFilter,this.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,this.offset=new Z.Vector2(0,0),this.repeat=new Z.Vector2(1,1),this.format=void 0!==n.format?n.format:Z.RGBAFormat,this.type=void 0!==n.type?n.type:Z.UnsignedByteType,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=void 0!==n.shareDepthFrom?n.shareDepthFrom:null},Z.WebGLRenderTarget.prototype={constructor:Z.WebGLRenderTarget,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var e=new Z.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},Z.EventDispatcher.prototype.apply(Z.WebGLRenderTarget.prototype),Z.WebGLRenderTargetCube=function(e,t,n){Z.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},Z.WebGLRenderTargetCube.prototype=Object.create(Z.WebGLRenderTarget.prototype),Z.WebGLRenderTargetCube.prototype.constructor=Z.WebGLRenderTargetCube,Z.WebGLExtensions=function(e){var t={};this.get=function(n){if(void 0!==t[n])return t[n];var i;switch(n){case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return null===i&&Z.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=i,i}},Z.WebGLProgram=(B=0,function(e,t,n,i){var r=e,o=r.context,a=n.defines,s=n.__webglShader.uniforms,l=n.attributes,c=n.__webglShader.vertexShader,u=n.__webglShader.fragmentShader,h=n.index0AttributeName;void 0===h&&!0===i.morphTargets&&(h="position");var d="SHADOWMAP_TYPE_BASIC";i.shadowMapType===Z.PCFShadowMap?d="SHADOWMAP_TYPE_PCF":i.shadowMapType===Z.PCFSoftShadowMap&&(d="SHADOWMAP_TYPE_PCF_SOFT");var f="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(i.envMap){switch(n.envMap.mapping){case Z.CubeReflectionMapping:case Z.CubeRefractionMapping:f="ENVMAP_TYPE_CUBE";break;case Z.EquirectangularReflectionMapping:case Z.EquirectangularRefractionMapping:f="ENVMAP_TYPE_EQUIREC";break;case Z.SphericalReflectionMapping:f="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case Z.CubeRefractionMapping:case Z.EquirectangularRefractionMapping:p="ENVMAP_MODE_REFRACTION"}switch(n.combine){case Z.MultiplyOperation:m="ENVMAP_BLENDING_MULTIPLY";break;case Z.MixOperation:m="ENVMAP_BLENDING_MIX";break;case Z.AddOperation:m="ENVMAP_BLENDING_ADD"}}var g,v,y=e.gammaFactor>0?e.gammaFactor:1,_=function(e){var t,n,i=[];for(var r in e)!1!==(t=e[r])&&(n="#define "+r+" "+t,i.push(n));return i.join("\n")}(a),b=o.createProgram();n instanceof Z.RawShaderMaterial?(g="",v=""):(g=["precision "+i.precision+" float;","precision "+i.precision+" int;",_,i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",r.gammaInput?"#define GAMMA_INPUT":"",r.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexColors?"#define USE_COLOR":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+d:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",""].join("\n"),v=["precision "+i.precision+" float;","precision "+i.precision+" int;",i.bumpMap||i.normalMap||i.flatShading?"#extension GL_OES_standard_derivatives : enable":"",_,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",r.gammaInput?"#define GAMMA_INPUT":"",r.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+f:"",i.envMap?"#define "+p:"",i.envMap?"#define "+m:"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexColors?"#define USE_COLOR":"",i.flatShading?"#define FLAT_SHADED":"",i.metal?"#define METAL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+d:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var x=new Z.WebGLShader(o,o.VERTEX_SHADER,g+c),w=new Z.WebGLShader(o,o.FRAGMENT_SHADER,v+u);o.attachShader(b,x),o.attachShader(b,w),void 0!==h&&o.bindAttribLocation(b,0,h),o.linkProgram(b);var A=o.getProgramInfoLog(b);!1===o.getProgramParameter(b,o.LINK_STATUS)&&Z.error("THREE.WebGLProgram: shader error: "+o.getError(),"gl.VALIDATE_STATUS",o.getProgramParameter(b,o.VALIDATE_STATUS),"gl.getPRogramInfoLog",A),""!==A&&Z.warn("THREE.WebGLProgram: gl.getProgramInfoLog()"+A),o.deleteShader(x),o.deleteShader(w);var E=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];for(var T in i.useVertexTexture?(E.push("boneTexture"),E.push("boneTextureWidth"),E.push("boneTextureHeight")):E.push("boneGlobalMatrices"),i.logarithmicDepthBuffer&&E.push("logDepthBufFC"),s)E.push(T);this.uniforms=function(e,t,n){for(var i={},r=0,o=n.length;r<o;r++){var a=n[r];i[a]=e.getUniformLocation(t,a)}return i}(o,b,E),E=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var M=0;M<i.maxMorphTargets;M++)E.push("morphTarget"+M);for(M=0;M<i.maxMorphNormals;M++)E.push("morphNormal"+M);for(var S in l)E.push(S);return this.attributes=function(e,t,n){for(var i={},r=0,o=n.length;r<o;r++){var a=n[r];i[a]=e.getAttribLocation(t,a)}return i}(o,b,E),this.attributesKeys=Object.keys(this.attributes),this.id=B++,this.code=t,this.usedTimes=1,this.program=b,this.vertexShader=x,this.fragmentShader=w,this}),Z.WebGLShader=function(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),!1===e.getShaderParameter(i,e.COMPILE_STATUS)&&Z.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(i)&&Z.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e.getShaderInfoLog(i),function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(n)),i},Z.WebGLState=function(e,t){var n=new Uint8Array(16),i=new Uint8Array(16),r=null,o=null,a=null,s=null,l=null,c=null,u=null,h=null,d=null,f=null,p=null,m=null,g=null,v=null,y=null,_=null;this.initAttributes=function(){for(var e=0,t=n.length;e<t;e++)n[e]=0},this.enableAttribute=function(t){n[t]=1,0===i[t]&&(e.enableVertexAttribArray(t),i[t]=1)},this.disableUnusedAttributes=function(){for(var t=0,r=i.length;t<r;t++)i[t]!==n[t]&&(e.disableVertexAttribArray(t),i[t]=0)},this.setBlending=function(n,i,h,d,f,p,m){n!==r&&(n===Z.NoBlending?e.disable(e.BLEND):n===Z.AdditiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):n===Z.SubtractiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):n===Z.MultiplyBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):n===Z.CustomBlending?e.enable(e.BLEND):(e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),r=n),n===Z.CustomBlending?(f=f||i,p=p||h,m=m||d,i===o&&f===l||(e.blendEquationSeparate(t(i),t(f)),o=i,l=f),h===a&&d===s&&p===c&&m===u||(e.blendFuncSeparate(t(h),t(d),t(p),t(m)),a=h,s=d,c=p,u=m)):(o=null,a=null,s=null,l=null,c=null,u=null)},this.setDepthTest=function(t){h!==t&&(t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),h=t)},this.setDepthWrite=function(t){d!==t&&(e.depthMask(t),d=t)},this.setColorWrite=function(t){f!==t&&(e.colorMask(t,t,t,t),f=t)},this.setDoubleSided=function(t){p!==t&&(t?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),p=t)},this.setFlipSided=function(t){m!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),m=t)},this.setLineWidth=function(t){t!==g&&(e.lineWidth(t),g=t)},this.setPolygonOffset=function(t,n,i){v!==t&&(t?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),v=t),!t||y===n&&_===i||(e.polygonOffset(n,i),y=n,_=i)},this.reset=function(){for(var e=0;e<i.length;e++)i[e]=0;r=null,h=null,d=null,f=null,p=null,m=null}},Z.LensFlarePlugin=function(e,t){var n,i,r,o,a,s,l,c,u=e.context,h=function(){var t,h=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),d=new Uint16Array([0,1,2,0,2,3]);n=u.createBuffer(),i=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,n),u.bufferData(u.ARRAY_BUFFER,h,u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i),u.bufferData(u.ELEMENT_ARRAY_BUFFER,d,u.STATIC_DRAW),l=u.createTexture(),c=u.createTexture(),u.bindTexture(u.TEXTURE_2D,l),u.texImage2D(u.TEXTURE_2D,0,u.RGB,16,16,0,u.RGB,u.UNSIGNED_BYTE,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.bindTexture(u.TEXTURE_2D,c),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,16,16,0,u.RGBA,u.UNSIGNED_BYTE,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),t=(s=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0)?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},r=function(t){var n=u.createProgram(),i=u.createShader(u.FRAGMENT_SHADER),r=u.createShader(u.VERTEX_SHADER),o="precision "+e.getPrecision()+" float;\n";return u.shaderSource(i,o+t.fragmentShader),u.shaderSource(r,o+t.vertexShader),u.compileShader(i),u.compileShader(r),u.attachShader(n,i),u.attachShader(n,r),u.linkProgram(n),n}(t),o={vertex:u.getAttribLocation(r,"position"),uv:u.getAttribLocation(r,"uv")},a={renderType:u.getUniformLocation(r,"renderType"),map:u.getUniformLocation(r,"map"),occlusionMap:u.getUniformLocation(r,"occlusionMap"),opacity:u.getUniformLocation(r,"opacity"),color:u.getUniformLocation(r,"color"),scale:u.getUniformLocation(r,"scale"),rotation:u.getUniformLocation(r,"rotation"),screenPosition:u.getUniformLocation(r,"screenPosition")}};this.render=function(d,f,p,m){if(0!==t.length){var g=new Z.Vector3,v=m/p,y=.5*p,_=.5*m,b=16/m,x=new Z.Vector2(b*v,b),w=new Z.Vector3(1,1,0),A=new Z.Vector2(1,1);void 0===r&&h(),u.useProgram(r),u.enableVertexAttribArray(o.vertex),u.enableVertexAttribArray(o.uv),u.uniform1i(a.occlusionMap,0),u.uniform1i(a.map,1),u.bindBuffer(u.ARRAY_BUFFER,n),u.vertexAttribPointer(o.vertex,2,u.FLOAT,!1,16,0),u.vertexAttribPointer(o.uv,2,u.FLOAT,!1,16,8),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i),u.disable(u.CULL_FACE),u.depthMask(!1);for(var E=0,T=t.length;E<T;E++){b=16/m,x.set(b*v,b);var M=t[E];if(g.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),g.applyMatrix4(f.matrixWorldInverse),g.applyProjection(f.projectionMatrix),w.copy(g),A.x=w.x*y+y,A.y=w.y*_+_,s||A.x>0&&A.x<p&&A.y>0&&A.y<m){u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,l),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGB,A.x-8,A.y-8,16,16,0),u.uniform1i(a.renderType,0),u.uniform2f(a.scale,x.x,x.y),u.uniform3f(a.screenPosition,w.x,w.y,w.z),u.disable(u.BLEND),u.enable(u.DEPTH_TEST),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0),u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,A.x-8,A.y-8,16,16,0),u.uniform1i(a.renderType,1),u.disable(u.DEPTH_TEST),u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,l),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0),M.positionScreen.copy(w),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),u.uniform1i(a.renderType,2),u.enable(u.BLEND);for(var S=0,C=M.lensFlares.length;S<C;S++){var P=M.lensFlares[S];P.opacity>.001&&P.scale>.001&&(w.x=P.x,w.y=P.y,w.z=P.z,b=P.size*P.scale/m,x.x=b*v,x.y=b,u.uniform3f(a.screenPosition,w.x,w.y,w.z),u.uniform2f(a.scale,x.x,x.y),u.uniform1f(a.rotation,P.rotation),u.uniform1f(a.opacity,P.opacity),u.uniform3f(a.color,P.color.r,P.color.g,P.color.b),e.state.setBlending(P.blending,P.blendEquation,P.blendSrc,P.blendDst),e.setTexture(P.texture,1),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0))}}}u.enable(u.CULL_FACE),u.enable(u.DEPTH_TEST),u.depthMask(!0),e.resetGLState()}}},Z.ShadowMapPlugin=function(e,t,n,i){var r,o,a,s,l=e.context,c=new Z.Frustum,u=new Z.Matrix4,h=new Z.Vector3,d=new Z.Vector3,f=new Z.Vector3,p=[],m=Z.ShaderLib.depthRGBA,g=Z.UniformsUtils.clone(m.uniforms);function v(e,t,i){if(t.visible){var r=n[t.id];if(r&&t.castShadow&&(!1===t.frustumCulled||!0===c.intersectsObject(t)))for(var o=0,a=r.length;o<a;o++){var s=r[o];t._modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),p.push(s)}for(o=0,a=t.children.length;o<a;o++)v(e,t.children[o],i)}}function y(e,t){var n=new Z.DirectionalLight;n.isVirtual=!0,n.onlyShadow=!0,n.castShadow=!0,n.shadowCameraNear=e.shadowCameraNear,n.shadowCameraFar=e.shadowCameraFar,n.shadowCameraLeft=e.shadowCameraLeft,n.shadowCameraRight=e.shadowCameraRight,n.shadowCameraBottom=e.shadowCameraBottom,n.shadowCameraTop=e.shadowCameraTop,n.shadowCameraVisible=e.shadowCameraVisible,n.shadowDarkness=e.shadowDarkness,n.shadowBias=e.shadowCascadeBias[t],n.shadowMapWidth=e.shadowCascadeWidth[t],n.shadowMapHeight=e.shadowCascadeHeight[t],n.pointsWorld=[],n.pointsFrustum=[];for(var i=n.pointsWorld,r=n.pointsFrustum,o=0;o<8;o++)i[o]=new Z.Vector3,r[o]=new Z.Vector3;var a=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return r[0].set(-1,-1,a),r[1].set(1,-1,a),r[2].set(-1,1,a),r[3].set(1,1,a),r[4].set(-1,-1,s),r[5].set(1,-1,s),r[6].set(-1,1,s),r[7].set(1,1,s),n}function _(e,t){var n=e.shadowCascadeArray[t];n.position.copy(e.position),n.target.position.copy(e.target.position),n.lookAt(n.target),n.shadowCameraVisible=e.shadowCameraVisible,n.shadowDarkness=e.shadowDarkness,n.shadowBias=e.shadowCascadeBias[t];var i=e.shadowCascadeNearZ[t],r=e.shadowCascadeFarZ[t],o=n.pointsFrustum;o[0].z=i,o[1].z=i,o[2].z=i,o[3].z=i,o[4].z=r,o[5].z=r,o[6].z=r,o[7].z=r}function b(e,t){var n=t.shadowCamera,i=t.pointsFrustum,r=t.pointsWorld;h.set(1/0,1/0,1/0),d.set(-1/0,-1/0,-1/0);for(var o=0;o<8;o++){var a=r[o];a.copy(i[o]),a.unproject(e),a.applyMatrix4(n.matrixWorldInverse),a.x<h.x&&(h.x=a.x),a.x>d.x&&(d.x=a.x),a.y<h.y&&(h.y=a.y),a.y>d.y&&(d.y=a.y),a.z<h.z&&(h.z=a.z),a.z>d.z&&(d.z=a.z)}n.left=h.x,n.right=d.x,n.top=d.y,n.bottom=h.y,n.updateProjectionMatrix()}function x(e){return e.material instanceof Z.MeshFaceMaterial?e.material.materials[0]:e.material}r=new Z.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader}),o=new Z.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0}),a=new Z.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,skinning:!0}),s=new Z.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0,skinning:!0}),r._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0,s._shadowPass=!0,this.render=function(n,h){if(!1!==e.shadowMapEnabled){var d,m,g,w,A,E,T,M,S,C,P,L,R,D=[],I=0;for(l.clearColor(1,1,1,1),l.disable(l.BLEND),l.enable(l.CULL_FACE),l.frontFace(l.CCW),e.shadowMapCullFace===Z.CullFaceFront?l.cullFace(l.FRONT):l.cullFace(l.BACK),e.state.setDepthTest(!0),d=0,m=t.length;d<m;d++)if((R=t[d]).castShadow)if(R instanceof Z.DirectionalLight&&R.shadowCascade)for(A=0;A<R.shadowCascadeCount;A++){var O;if(R.shadowCascadeArray[A])O=R.shadowCascadeArray[A];else{(O=y(R,A)).originalCamera=h;var N=new Z.Gyroscope;N.position.copy(R.shadowCascadeOffset),N.add(O),N.add(O.target),h.add(N),R.shadowCascadeArray[A]=O}_(R,A),D[I]=O,I++}else D[I]=R,I++;for(d=0,m=D.length;d<m;d++){if(!(R=D[d]).shadowMap){var k=Z.LinearFilter;e.shadowMapType===Z.PCFSoftShadowMap&&(k=Z.NearestFilter);var V={minFilter:k,magFilter:k,format:Z.RGBAFormat};R.shadowMap=new Z.WebGLRenderTarget(R.shadowMapWidth,R.shadowMapHeight,V),R.shadowMapSize=new Z.Vector2(R.shadowMapWidth,R.shadowMapHeight),R.shadowMatrix=new Z.Matrix4}if(!R.shadowCamera){if(R instanceof Z.SpotLight)R.shadowCamera=new Z.PerspectiveCamera(R.shadowCameraFov,R.shadowMapWidth/R.shadowMapHeight,R.shadowCameraNear,R.shadowCameraFar);else{if(!(R instanceof Z.DirectionalLight)){Z.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",R);continue}R.shadowCamera=new Z.OrthographicCamera(R.shadowCameraLeft,R.shadowCameraRight,R.shadowCameraTop,R.shadowCameraBottom,R.shadowCameraNear,R.shadowCameraFar)}n.add(R.shadowCamera),!0===n.autoUpdate&&n.updateMatrixWorld()}var F,B,U;for(R.shadowCameraVisible&&!R.cameraHelper&&(R.cameraHelper=new Z.CameraHelper(R.shadowCamera),n.add(R.cameraHelper)),R.isVirtual&&O.originalCamera==h&&b(h,R),E=R.shadowMap,T=R.shadowMatrix,(M=R.shadowCamera).position.setFromMatrixPosition(R.matrixWorld),f.setFromMatrixPosition(R.target.matrixWorld),M.lookAt(f),M.updateMatrixWorld(),M.matrixWorldInverse.getInverse(M.matrixWorld),R.cameraHelper&&(R.cameraHelper.visible=R.shadowCameraVisible),R.shadowCameraVisible&&R.cameraHelper.update(),T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiply(M.projectionMatrix),T.multiply(M.matrixWorldInverse),u.multiplyMatrices(M.projectionMatrix,M.matrixWorldInverse),c.setFromMatrix(u),e.setRenderTarget(E),e.clear(),p.length=0,v(n,n,M),g=0,w=p.length;g<w;g++)L=(P=p[g]).object,S=P.buffer,F=x(L),B=void 0!==L.geometry.morphTargets&&L.geometry.morphTargets.length>0&&F.morphTargets,U=L instanceof Z.SkinnedMesh&&F.skinning,C=L.customDepthMaterial?L.customDepthMaterial:U?B?s:a:B?o:r,e.setMaterialFaces(F),S instanceof Z.BufferGeometry?e.renderBufferDirect(M,t,null,C,S,L):e.renderBuffer(M,t,null,C,S,L);for(g=0,w=i.length;g<w;g++)(L=(P=i[g]).object).visible&&L.castShadow&&(L._modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,L.matrixWorld),e.renderImmediateObject(M,t,null,r,L))}var z=e.getClearColor(),G=e.getClearAlpha();l.clearColor(z.r,z.g,z.b,G),l.enable(l.BLEND),e.shadowMapCullFace===Z.CullFaceFront&&l.cullFace(l.BACK),e.resetGLState()}}},Z.SpritePlugin=function(e,t){var n,i,r,o,a,s,l=e.context,c=new Z.Vector3,u=new Z.Quaternion,h=new Z.Vector3,d=function(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),c=new Uint16Array([0,1,2,0,2,3]);n=l.createBuffer(),i=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,n),l.bufferData(l.ARRAY_BUFFER,t,l.STATIC_DRAW),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),l.bufferData(l.ELEMENT_ARRAY_BUFFER,c,l.STATIC_DRAW),r=function(){var t=l.createProgram(),n=l.createShader(l.VERTEX_SHADER),i=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(n,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),l.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),l.compileShader(n),l.compileShader(i),l.attachShader(t,n),l.attachShader(t,i),l.linkProgram(t),t}(),o={position:l.getAttribLocation(r,"position"),uv:l.getAttribLocation(r,"uv")},a={uvOffset:l.getUniformLocation(r,"uvOffset"),uvScale:l.getUniformLocation(r,"uvScale"),rotation:l.getUniformLocation(r,"rotation"),scale:l.getUniformLocation(r,"scale"),color:l.getUniformLocation(r,"color"),map:l.getUniformLocation(r,"map"),opacity:l.getUniformLocation(r,"opacity"),modelViewMatrix:l.getUniformLocation(r,"modelViewMatrix"),projectionMatrix:l.getUniformLocation(r,"projectionMatrix"),fogType:l.getUniformLocation(r,"fogType"),fogDensity:l.getUniformLocation(r,"fogDensity"),fogNear:l.getUniformLocation(r,"fogNear"),fogFar:l.getUniformLocation(r,"fogFar"),fogColor:l.getUniformLocation(r,"fogColor"),alphaTest:l.getUniformLocation(r,"alphaTest")};var u=document.createElement("canvas");u.width=8,u.height=8;var h=u.getContext("2d");h.fillStyle="white",h.fillRect(0,0,8,8),(s=new Z.Texture(u)).needsUpdate=!0};function f(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}this.render=function(p,m){if(0!==t.length){void 0===r&&d(),l.useProgram(r),l.enableVertexAttribArray(o.position),l.enableVertexAttribArray(o.uv),l.disable(l.CULL_FACE),l.enable(l.BLEND),l.bindBuffer(l.ARRAY_BUFFER,n),l.vertexAttribPointer(o.position,2,l.FLOAT,!1,16,0),l.vertexAttribPointer(o.uv,2,l.FLOAT,!1,16,8),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),l.uniformMatrix4fv(a.projectionMatrix,!1,m.projectionMatrix.elements),l.activeTexture(l.TEXTURE0),l.uniform1i(a.map,0);var g=0,v=0,y=p.fog;y?(l.uniform3f(a.fogColor,y.color.r,y.color.g,y.color.b),y instanceof Z.Fog?(l.uniform1f(a.fogNear,y.near),l.uniform1f(a.fogFar,y.far),l.uniform1i(a.fogType,1),g=1,v=1):y instanceof Z.FogExp2&&(l.uniform1f(a.fogDensity,y.density),l.uniform1i(a.fogType,2),g=2,v=2)):(l.uniform1i(a.fogType,0),g=0,v=0);for(var _=0,b=t.length;_<b;_++){(w=t[_])._modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,w.matrixWorld),w.z=-w._modelViewMatrix.elements[14]}t.sort(f);var x=[];for(_=0,b=t.length;_<b;_++){var w,A=(w=t[_]).material;l.uniform1f(a.alphaTest,A.alphaTest),l.uniformMatrix4fv(a.modelViewMatrix,!1,w._modelViewMatrix.elements),w.matrixWorld.decompose(c,u,h),x[0]=h.x,x[1]=h.y;var E=0;p.fog&&A.fog&&(E=v),g!==E&&(l.uniform1i(a.fogType,E),g=E),null!==A.map?(l.uniform2f(a.uvOffset,A.map.offset.x,A.map.offset.y),l.uniform2f(a.uvScale,A.map.repeat.x,A.map.repeat.y)):(l.uniform2f(a.uvOffset,0,0),l.uniform2f(a.uvScale,1,1)),l.uniform1f(a.opacity,A.opacity),l.uniform3f(a.color,A.color.r,A.color.g,A.color.b),l.uniform1f(a.rotation,A.rotation),l.uniform2fv(a.scale,x),e.state.setBlending(A.blending,A.blendEquation,A.blendSrc,A.blendDst),e.state.setDepthTest(A.depthTest),e.state.setDepthWrite(A.depthWrite),A.map&&A.map.image&&A.map.image.width?e.setTexture(A.map,0):e.setTexture(s,0),l.drawElements(l.TRIANGLES,6,l.UNSIGNED_SHORT,0)}l.enable(l.CULL_FACE),e.resetGLState()}}},Z.GeometryUtils={merge:function(e,t,n){var i;Z.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t instanceof Z.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,n)},center:function(e){return Z.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},Z.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,n,i){var r=new Z.ImageLoader;r.crossOrigin=this.crossOrigin;var o=new Z.Texture(void 0,t);return r.load(e,function(e){o.image=e,o.needsUpdate=!0,n&&n(o)},void 0,function(e){i&&i(e)}),o.sourceFile=e,o},loadTextureCube:function(e,t,n,i){var r=new Z.ImageLoader;r.crossOrigin=this.crossOrigin;var o=new Z.CubeTexture([],t);o.flipY=!1;for(var a=0,s=function(t){r.load(e[t],function(e){o.images[t]=e,6===(a+=1)&&(o.needsUpdate=!0,n&&n(o))},void 0,i)},l=0,c=e.length;l<c;++l)s(l);return o},loadCompressedTexture:function(){Z.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){Z.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var n=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var r=e.width,o=e.height,a=document.createElement("canvas");a.width=r,a.height=o;var s=a.getContext("2d");s.drawImage(e,0,0);for(var l,c,u=s.getImageData(0,0,r,o).data,h=s.createImageData(r,o),d=h.data,f=0;f<r;f++)for(var p=0;p<o;p++){var m=p-1<0?0:p-1,g=p+1>o-1?o-1:p+1,v=f-1<0?0:f-1,y=f+1>r-1?r-1:f+1,_=[],b=[0,0,u[4*(p*r+f)]/255*t];_.push([-1,0,u[4*(p*r+v)]/255*t]),_.push([-1,-1,u[4*(m*r+v)]/255*t]),_.push([0,-1,u[4*(m*r+f)]/255*t]),_.push([1,-1,u[4*(m*r+y)]/255*t]),_.push([1,0,u[4*(p*r+y)]/255*t]),_.push([1,1,u[4*(g*r+y)]/255*t]),_.push([0,1,u[4*(g*r+f)]/255*t]),_.push([-1,1,u[4*(g*r+v)]/255*t]);for(var x=[],w=_.length,A=0;A<w;A++){var E=_[A],T=_[(A+1)%w];E=n(E,b),T=n(T,b),x.push(i((c=T,[(l=E)[1]*c[2]-l[2]*c[1],l[2]*c[0]-l[0]*c[2],l[0]*c[1]-l[1]*c[0]])))}var M=[0,0,0];for(A=0;A<x.length;A++)M[0]+=x[A][0],M[1]+=x[A][1],M[2]+=x[A][2];M[0]/=x.length,M[1]/=x.length,M[2]/=x.length;var S=4*(p*r+f);d[S]=(M[0]+1)/2*255|0,d[S+1]=(M[1]+1)/2*255|0,d[S+2]=255*M[2]|0,d[S+3]=255}return s.putImageData(h,0,0),a},generateDataTexture:function(e,t,n){for(var i=e*t,r=new Uint8Array(3*i),o=Math.floor(255*n.r),a=Math.floor(255*n.g),s=Math.floor(255*n.b),l=0;l<i;l++)r[3*l]=o,r[3*l+1]=a,r[3*l+2]=s;var c=new Z.DataTexture(r,e,t,Z.RGBFormat);return c.needsUpdate=!0,c}},Z.SceneUtils={createMultiMaterialObject:function(e,t){for(var n=new Z.Object3D,i=0,r=t.length;i<r;i++)n.add(new Z.Mesh(e,t[i]));return n},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){var i=new Z.Matrix4;i.getInverse(n.matrixWorld),e.applyMatrix(i),t.remove(e),n.add(e)}},Z.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(e){var t,n=this.getFace(),i=this.size/n.resolution,r=0,o=String(e).split(""),a=o.length,s=[];for(t=0;t<a;t++){var l=new Z.Path,c=this.extractGlyphPoints(o[t],n,i,r,l);r+=c.offset,s.push(c.path)}return{paths:s,offset:r/2}},extractGlyphPoints:function(e,t,n,i,r){var o,a,s,l,c,u,h,d,f,p,m,g,v,y,_,b,x,w,A=[],E=t.glyphs[e]||t.glyphs["?"];if(E){if(E.o)for(c=(l=E._cachedOutline||(E._cachedOutline=E.o.split(" "))).length,u=n,h=n,o=0;o<c;)switch(l[o++]){case"m":d=l[o++]*u+i,f=l[o++]*h,r.moveTo(d,f);break;case"l":d=l[o++]*u+i,f=l[o++]*h,r.lineTo(d,f);break;case"q":if(p=l[o++]*u+i,m=l[o++]*h,y=l[o++]*u+i,_=l[o++]*h,r.quadraticCurveTo(y,_,p,m),w=A[A.length-1])for(g=w.x,v=w.y,a=1,s=this.divisions;a<=s;a++){var T=a/s;Z.Shape.Utils.b2(T,g,y,p),Z.Shape.Utils.b2(T,v,_,m)}break;case"b":if(p=l[o++]*u+i,m=l[o++]*h,y=l[o++]*u+i,_=l[o++]*h,b=l[o++]*u+i,x=l[o++]*h,r.bezierCurveTo(y,_,b,x,p,m),w=A[A.length-1])for(g=w.x,v=w.y,a=1,s=this.divisions;a<=s;a++){T=a/s;Z.Shape.Utils.b3(T,g,y,b,p),Z.Shape.Utils.b3(T,v,_,x,m)}}return{offset:E.ha*n,path:r}}}},Z.FontUtils.generateShapes=function(e,t){var n=void 0!==(t=t||{}).size?t.size:100,i=void 0!==t.curveSegments?t.curveSegments:4,r=void 0!==t.font?t.font:"helvetiker",o=void 0!==t.weight?t.weight:"normal",a=void 0!==t.style?t.style:"normal";Z.FontUtils.size=n,Z.FontUtils.divisions=i,Z.FontUtils.face=r,Z.FontUtils.weight=o,Z.FontUtils.style=a;for(var s=Z.FontUtils.drawText(e).paths,l=[],c=0,u=s.length;c<u;c++)Array.prototype.push.apply(l,s[c].toShapes());return l},U=Z.FontUtils,z=function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n},G=function(e,t,n,i,r,o){var a,s,l,c,u,h,d,f,p,m,g,v,y,_,b;if(s=e[o[t]].x,l=e[o[t]].y,c=e[o[n]].x,u=e[o[n]].y,h=e[o[i]].x,1e-10>(c-s)*((d=e[o[i]].y)-l)-(u-l)*(h-s))return!1;for(m=h-c,g=d-u,v=s-h,y=l-d,_=c-s,b=u-l,a=0;a<r;a++)if(f=e[o[a]].x,p=e[o[a]].y,!(f===s&&p===l||f===c&&p===u||f===h&&p===d)&&m*(p-u)-g*(f-c)>=-1e-10&&v*(p-d)-y*(f-h)>=-1e-10&&_*(p-l)-b*(f-s)>=-1e-10)return!1;return!0},U.Triangulate=function(e,t){var n=e.length;if(n<3)return null;var i,r,o,a=[],s=[],l=[];if(z(e)>0)for(r=0;r<n;r++)s[r]=r;else for(r=0;r<n;r++)s[r]=n-1-r;var c=n,u=2*c;for(r=c-1;c>2;){if(u--<=0)return Z.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()"),t?l:a;if(c<=(i=r)&&(i=0),c<=(r=i+1)&&(r=0),c<=(o=r+1)&&(o=0),G(e,i,r,o,c,s)){var h,d,f,p,m;for(h=s[i],d=s[r],f=s[o],a.push([e[h],e[d],e[f]]),l.push([s[i],s[r],s[o]]),p=r,m=r+1;m<c;p++,m++)s[p]=s[m];u=2*--c}}return t?l:a},U.Triangulate.area=z,Z.Audio=function(e){Z.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.isPlaying=!1},Z.Audio.prototype=Object.create(Z.Object3D.prototype),Z.Audio.prototype.constructor=Z.Audio,Z.Audio.prototype.load=function(e){var t=this,n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e,t.autoplay&&t.play()})},n.send(),this},Z.Audio.prototype.play=function(){if(!0!==this.isPlaying){var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.connect(this.panner),e.start(0,this.startTime),this.isPlaying=!0,this.source=e}else Z.warn("THREE.Audio: Audio is already playing.")},Z.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},Z.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},Z.Audio.prototype.onEnded=function(){this.isPlaying=!1},Z.Audio.prototype.setLoop=function(e){this.source.loop=e},Z.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},Z.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},Z.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},Z.Audio.prototype.updateMatrixWorld=function(){var e=new Z.Vector3;return function(t){Z.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),Z.AudioListener=function(){Z.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},Z.AudioListener.prototype=Object.create(Z.Object3D.prototype),Z.AudioListener.prototype.constructor=Z.AudioListener,Z.AudioListener.prototype.updateMatrixWorld=function(){var e=new Z.Vector3,t=new Z.Quaternion,n=new Z.Vector3,i=new Z.Vector3,r=new Z.Vector3,o=new Z.Vector3;return function(a){Z.Object3D.prototype.updateMatrixWorld.call(this,a);var s=this.context.listener,l=this.up;this.matrixWorld.decompose(e,t,n),i.set(0,0,-1).applyQuaternion(t),r.subVectors(e,o),s.setPosition(e.x,e.y,e.z),s.setOrientation(i.x,i.y,i.z,l.x,l.y,l.z),s.setVelocity(r.x,r.y,r.z),o.copy(e)}}(),Z.Curve=function(){},Z.Curve.prototype.getPoint=function(e){return Z.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},Z.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},Z.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},Z.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},Z.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},Z.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,i=[],r=this.getPoint(0),o=0;for(i.push(0),n=1;n<=e;n++)o+=(t=this.getPoint(n/e)).distanceTo(r),i.push(o),r=t;return this.cacheArcLengths=i,i},Z.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},Z.Curve.prototype.getUtoTmapping=function(e,t){var n,i=this.getLengths(),r=0,o=i.length;n=t||e*i[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=i[r=Math.floor(s+(l-s)/2)]-n)<0)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(i[r=l]==n)return r/(o-1);var c=i[r];return(r+(n-c)/(i[r+1]-c))/(o-1)},Z.Curve.prototype.getTangent=function(e){var t=e-1e-4,n=e+1e-4;t<0&&(t=0),n>1&&(n=1);var i=this.getPoint(t);return this.getPoint(n).clone().sub(i).normalize()},Z.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},Z.Curve.Utils={tangentQuadraticBezier:function(e,t,n,i){return 2*(1-e)*(n-t)+2*e*(i-n)},tangentCubicBezier:function(e,t,n,i,r){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*r},tangentSpline:function(e,t,n,i,r){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,i,r){var o=.5*(n-e),a=.5*(i-t),s=r*r;return(2*t-2*n+o+a)*(r*s)+(-3*t+3*n-2*o-a)*s+o*r+t}},Z.Curve.create=function(e,t){return e.prototype=Object.create(Z.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Z.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},Z.CurvePath.prototype=Object.create(Z.Curve.prototype),Z.CurvePath.prototype.constructor=Z.CurvePath,Z.CurvePath.prototype.add=function(e){this.curves.push(e)},Z.CurvePath.prototype.checkConnection=function(){},Z.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Z.LineCurve(t,e))},Z.CurvePath.prototype.getPoint=function(e){for(var t,n=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=n){var o=1-(i[r]-n)/(t=this.curves[r]).getLength();return t.getPointAt(o)}r++}return null},Z.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},Z.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],n=0,i=this.curves.length;for(e=0;e<i;e++)n+=this.curves[e].getLength(),t.push(n);return this.cacheLengths=t,t},Z.CurvePath.prototype.getBoundingBox=function(){var e,t,n,i,r,o,a,s,l,c,u=this.getPoints();e=t=Number.NEGATIVE_INFINITY,i=r=Number.POSITIVE_INFINITY;var h=u[0]instanceof Z.Vector3;for(c=h?new Z.Vector3:new Z.Vector2,s=0,l=u.length;s<l;s++)(a=u[s]).x>e?e=a.x:a.x<i&&(i=a.x),a.y>t?t=a.y:a.y<r&&(r=a.y),h&&(a.z>n?n=a.z:a.z<o&&(o=a.z)),c.add(a);var d={minX:i,minY:r,maxX:e,maxY:t};return h&&(d.maxZ=n,d.minZ=o),d},Z.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},Z.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},Z.CurvePath.prototype.createGeometry=function(e){for(var t=new Z.Geometry,n=0;n<e.length;n++)t.vertices.push(new Z.Vector3(e[n].x,e[n].y,e[n].z||0));return t},Z.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},Z.CurvePath.prototype.getTransformedPoints=function(e,t){var n,i,r=this.getPoints(e);for(t||(t=this.bends),n=0,i=t.length;n<i;n++)r=this.getWrapPoints(r,t[n]);return r},Z.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n,i,r=this.getSpacedPoints(e);for(t||(t=this.bends),n=0,i=t.length;n<i;n++)r=this.getWrapPoints(r,t[n]);return r},Z.CurvePath.prototype.getWrapPoints=function(e,t){var n,i,r,o,a,s,l=this.getBoundingBox();for(n=0,i=e.length;n<i;n++){o=(r=e[n]).x,a=r.y,s=o/l.maxX,s=t.getUtoTmapping(s,o);var c=t.getPoint(s),u=t.getTangent(s);u.set(-u.y,u.x).multiplyScalar(a),r.x=c.x+u.x,r.y=c.y+u.y}return e},Z.Gyroscope=function(){Z.Object3D.call(this)},Z.Gyroscope.prototype=Object.create(Z.Object3D.prototype),Z.Gyroscope.prototype.constructor=Z.Gyroscope,Z.Gyroscope.prototype.updateMatrixWorld=(H=new Z.Vector3,W=new Z.Quaternion,j=new Z.Vector3,X=new Z.Vector3,q=new Z.Quaternion,Y=new Z.Vector3,function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(X,q,Y),this.matrix.decompose(H,W,j),this.matrixWorld.compose(X,W,Y)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)}),Z.Path=function(e){Z.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},Z.Path.prototype=Object.create(Z.CurvePath.prototype),Z.Path.prototype.constructor=Z.Path,Z.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},Z.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},Z.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:Z.PathActions.MOVE_TO,args:n})},Z.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,r=i[i.length-2],o=i[i.length-1],a=new Z.LineCurve(new Z.Vector2(r,o),new Z.Vector2(e,t));this.curves.push(a),this.actions.push({action:Z.PathActions.LINE_TO,args:n})},Z.Path.prototype.quadraticCurveTo=function(e,t,n,i){var r=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,a=o[o.length-2],s=o[o.length-1],l=new Z.QuadraticBezierCurve(new Z.Vector2(a,s),new Z.Vector2(e,t),new Z.Vector2(n,i));this.curves.push(l),this.actions.push({action:Z.PathActions.QUADRATIC_CURVE_TO,args:r})},Z.Path.prototype.bezierCurveTo=function(e,t,n,i,r,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,l=s[s.length-2],c=s[s.length-1],u=new Z.CubicBezierCurve(new Z.Vector2(l,c),new Z.Vector2(e,t),new Z.Vector2(n,i),new Z.Vector2(r,o));this.curves.push(u),this.actions.push({action:Z.PathActions.BEZIER_CURVE_TO,args:a})},Z.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,i=n[n.length-2],r=n[n.length-1],o=[new Z.Vector2(i,r)];Array.prototype.push.apply(o,e);var a=new Z.SplineCurve(o);this.curves.push(a),this.actions.push({action:Z.PathActions.CSPLINE_THRU,args:t})},Z.Path.prototype.arc=function(e,t,n,i,r,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],l=a[a.length-1];this.absarc(e+s,t+l,n,i,r,o)},Z.Path.prototype.absarc=function(e,t,n,i,r,o){this.absellipse(e,t,n,n,i,r,o)},Z.Path.prototype.ellipse=function(e,t,n,i,r,o,a){var s=this.actions[this.actions.length-1].args,l=s[s.length-2],c=s[s.length-1];this.absellipse(e+l,t+c,n,i,r,o,a)},Z.Path.prototype.absellipse=function(e,t,n,i,r,o,a){var s=Array.prototype.slice.call(arguments),l=new Z.EllipseCurve(e,t,n,i,r,o,a);this.curves.push(l);var c=l.getPoint(1);s.push(c.x),s.push(c.y),this.actions.push({action:Z.PathActions.ELLIPSE,args:s})},Z.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var n=[],i=0;i<e;i++)n.push(this.getPoint(i/e));return n},Z.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var n,i,r,o,a,s,l,c,u,h,d,f,p,m,g,v,y,_,b=[];for(n=0,i=this.actions.length;n<i;n++)switch(o=(r=this.actions[n]).action,a=r.args,o){case Z.PathActions.MOVE_TO:case Z.PathActions.LINE_TO:b.push(new Z.Vector2(a[0],a[1]));break;case Z.PathActions.QUADRATIC_CURVE_TO:for(s=a[2],l=a[3],h=a[0],d=a[1],b.length>0?(f=(m=b[b.length-1]).x,p=m.y):(f=(m=this.actions[n-1].args)[m.length-2],p=m[m.length-1]),g=1;g<=e;g++)v=g/e,y=Z.Shape.Utils.b2(v,f,h,s),_=Z.Shape.Utils.b2(v,p,d,l),b.push(new Z.Vector2(y,_));break;case Z.PathActions.BEZIER_CURVE_TO:for(s=a[4],l=a[5],h=a[0],d=a[1],c=a[2],u=a[3],b.length>0?(f=(m=b[b.length-1]).x,p=m.y):(f=(m=this.actions[n-1].args)[m.length-2],p=m[m.length-1]),g=1;g<=e;g++)v=g/e,y=Z.Shape.Utils.b3(v,f,h,c,s),_=Z.Shape.Utils.b3(v,p,d,u,l),b.push(new Z.Vector2(y,_));break;case Z.PathActions.CSPLINE_THRU:m=this.actions[n-1].args;var x=[new Z.Vector2(m[m.length-2],m[m.length-1])],w=e*a[0].length;x=x.concat(a[0]);var A=new Z.SplineCurve(x);for(g=1;g<=w;g++)b.push(A.getPointAt(g/w));break;case Z.PathActions.ARC:var E=a[0],T=a[1],M=a[2],S=a[3],C=a[4],P=!!a[5],L=C-S,R=2*e;for(g=1;g<=R;g++)v=g/R,P||(v=1-v),D=S+v*L,y=E+M*Math.cos(D),_=T+M*Math.sin(D),b.push(new Z.Vector2(y,_));break;case Z.PathActions.ELLIPSE:E=a[0],T=a[1];var D,I=a[2],O=a[3];S=a[4],C=a[5],P=!!a[6],L=C-S,R=2*e;for(g=1;g<=R;g++)v=g/R,P||(v=1-v),D=S+v*L,y=E+I*Math.cos(D),_=T+O*Math.sin(D),b.push(new Z.Vector2(y,_))}var N=b[b.length-1];return Math.abs(N.x-b[0].x)<1e-10&&Math.abs(N.y-b[0].y)<1e-10&&b.splice(b.length-1,1),t&&b.push(b[0]),b},Z.Path.prototype.toShapes=function(e,t){function n(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],o=new Z.Shape;o.actions=r.actions,o.curves=r.curves,t.push(o)}return t}function i(e,t){for(var n=t.length,i=!1,r=n-1,o=0;o<n;r=o++){var a=t[r],s=t[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>1e-10){if(c<0&&(a=t[o],l=-l,s=t[r],c=-c),e.y<a.y||e.y>s.y)continue;if(e.y==a.y){if(e.x==a.x)return!0}else{var u=c*(e.x-a.x)-l*(e.y-a.y);if(0==u)return!0;if(u<0)continue;i=!i}}else{if(e.y!=a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return i}var r=function(e){var t,n,i,r,o,a=[],s=new Z.Path;for(t=0,n=e.length;t<n;t++)o=(i=e[t]).args,(r=i.action)==Z.PathActions.MOVE_TO&&0!=s.actions.length&&(a.push(s),s=new Z.Path),s[r].apply(s,o);return 0!=s.actions.length&&a.push(s),a}(this.actions);if(0==r.length)return[];if(!0===t)return n(r);var o,a,s,l=[];if(1==r.length)return a=r[0],(s=new Z.Shape).actions=a.actions,s.curves=a.curves,l.push(s),l;var c=!Z.Shape.Utils.isClockWise(r[0].getPoints());c=e?!c:c;var u,h,d,f,p,m,g=[],v=[],y=[],_=0;for(v[_]=void 0,y[_]=[],h=0,d=r.length;h<d;h++)u=(a=r[h]).getPoints(),o=Z.Shape.Utils.isClockWise(u),(o=e?!o:o)?(!c&&v[_]&&_++,v[_]={s:new Z.Shape,p:u},v[_].s.actions=a.actions,v[_].s.curves=a.curves,c&&_++,y[_]=[]):y[_].push({h:a,p:u[0]});if(!v[0])return n(r);if(v.length>1){for(var b=!1,x=[],w=0,A=v.length;w<A;w++)g[w]=[];for(w=0,A=v.length;w<A;w++)for(var E=y[w],T=0;T<E.length;T++){for(var M=E[T],S=!0,C=0;C<v.length;C++)i(M.p,v[C].p)&&(w!=C&&x.push({froms:w,tos:C,hole:T}),S?(S=!1,g[C].push(M)):b=!0);S&&g[w].push(M)}x.length>0&&(b||(y=g))}for(h=0,d=v.length;h<d;h++)for(s=v[h].s,l.push(s),p=0,m=(f=y[h]).length;p<m;p++)s.holes.push(f[p].h);return l},Z.Shape=function(){Z.Path.apply(this,arguments),this.holes=[]},Z.Shape.prototype=Object.create(Z.Path.prototype),Z.Shape.prototype.constructor=Z.Shape,Z.Shape.prototype.extrude=function(e){return new Z.ExtrudeGeometry(this,e)},Z.Shape.prototype.makeGeometry=function(e){return new Z.ShapeGeometry(this,e)},Z.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,i=[];for(t=0;t<n;t++)i[t]=this.holes[t].getTransformedPoints(e,this.bends);return i},Z.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,i=[];for(t=0;t<n;t++)i[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return i},Z.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},Z.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},Z.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},Z.Shape.Utils={triangulateShape:function(e,t){function n(e,t,n){return e.x!=t.x?e.x<t.x?e.x<=n.x&&n.x<=t.x:t.x<=n.x&&n.x<=e.x:e.y<t.y?e.y<=n.y&&n.y<=t.y:t.y<=n.y&&n.y<=e.y}function i(e,t,i,r,o){var a=t.x-e.x,s=t.y-e.y,l=r.x-i.x,c=r.y-i.y,u=e.x-i.x,h=e.y-i.y,d=s*l-a*c,f=s*u-a*h;if(Math.abs(d)>1e-10){var p;if(d>0){if(f<0||f>d)return[];if((p=c*u-l*h)<0||p>d)return[]}else{if(f>0||f<d)return[];if((p=c*u-l*h)>0||p<d)return[]}if(0==p)return!o||0!=f&&f!=d?[e]:[];if(p==d)return!o||0!=f&&f!=d?[t]:[];if(0==f)return[i];if(f==d)return[r];var m=p/d;return[{x:e.x+m*a,y:e.y+m*s}]}if(0!=f||c*u!=l*h)return[];var g,v,y,_,b,x,w,A,E=0==a&&0==s,T=0==l&&0==c;return E&&T?e.x!=i.x||e.y!=i.y?[]:[e]:E?n(i,r,e)?[e]:[]:T?n(e,t,i)?[i]:[]:(0!=a?(e.x<t.x?(g=e,y=e.x,v=t,_=t.x):(g=t,y=t.x,v=e,_=e.x),i.x<r.x?(b=i,w=i.x,x=r,A=r.x):(b=r,w=r.x,x=i,A=i.x)):(e.y<t.y?(g=e,y=e.y,v=t,_=t.y):(g=t,y=t.y,v=e,_=e.y),i.y<r.y?(b=i,w=i.y,x=r,A=r.y):(b=r,w=r.y,x=i,A=i.y)),y<=w?_<w?[]:_==w?o?[]:[b]:_<=A?[b,v]:[b,x]:y>A?[]:y==A?o?[]:[g]:_<=A?[g,v]:[g,x])}function r(e,t,n,i){var r=t.x-e.x,o=t.y-e.y,a=n.x-e.x,s=n.y-e.y,l=i.x-e.x,c=i.y-e.y,u=r*s-o*a,h=r*c-o*l;if(Math.abs(u)>1e-10){var d=l*s-c*a;return u>0?h>=0&&d>=0:h>=0||d>=0}return h>0}for(var o,a,s,l,c,u,h={},d=e.concat(),f=0,p=t.length;f<p;f++)Array.prototype.push.apply(d,t[f]);for(o=0,a=d.length;o<a;o++)void 0!==h[c=d[o].x+":"+d[o].y]&&Z.warn("THREE.Shape: Duplicate point",c),h[c]=o;var m=function(e,t){var n,o=e.concat();function a(e,t){var i=o.length-1,a=e-1;a<0&&(a=i);var s=e+1;s>i&&(s=0);var l=r(o[e],o[a],o[s],n[t]);if(!l)return!1;var c=n.length-1,u=t-1;u<0&&(u=c);var h=t+1;return h>c&&(h=0),!!(l=r(n[t],n[u],n[h],o[e]))}function s(e,t){var n,r;for(n=0;n<o.length;n++)if(r=n+1,r%=o.length,i(e,t,o[n],o[r],!0).length>0)return!0;return!1}var l=[];function c(e,n){var r,o,a,s;for(r=0;r<l.length;r++)for(o=t[l[r]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,i(e,n,o[a],o[s],!0).length>0)return!0;return!1}for(var u,h,d,f,p,m,g,v,y,_,b=[],x=0,w=t.length;x<w;x++)l.push(x);for(var A=0,E=2*l.length;l.length>0;){if(--E<0){console.log("Infinite Loop! Holes left:"+l.length+", Probably Hole outside Shape!");break}for(h=A;h<o.length;h++){for(d=o[h],u=-1,x=0;x<l.length;x++)if(p=l[x],void 0===b[m=d.x+":"+d.y+":"+p]){n=t[p];for(var T=0;T<n.length;T++)if(f=n[T],a(h,T)&&!s(d,f)&&!c(d,f)){u=T,l.splice(x,1),g=o.slice(0,h+1),v=o.slice(h),y=n.slice(u),_=n.slice(0,u+1),o=g.concat(y).concat(_).concat(v),A=h;break}if(u>=0)break;b[m]=!0}if(u>=0)break}}return o}(e,t),g=Z.FontUtils.Triangulate(m,!1);for(o=0,a=g.length;o<a;o++)for(l=g[o],s=0;s<3;s++)void 0!==(u=h[c=l[s].x+":"+l[s].y])&&(l[s]=u);return g.concat()},isClockWise:function(e){return Z.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,i){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,i)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,i,r){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,i)+this.b3p3(e,r)}},Z.LineCurve=function(e,t){this.v1=e,this.v2=t},Z.LineCurve.prototype=Object.create(Z.Curve.prototype),Z.LineCurve.prototype.constructor=Z.LineCurve,Z.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},Z.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},Z.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},Z.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},Z.QuadraticBezierCurve.prototype=Object.create(Z.Curve.prototype),Z.QuadraticBezierCurve.prototype.constructor=Z.QuadraticBezierCurve,Z.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new Z.Vector2;return t.x=Z.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=Z.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t},Z.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new Z.Vector2;return t.x=Z.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),t.y=Z.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t.normalize()},Z.CubicBezierCurve=function(e,t,n,i){this.v0=e,this.v1=t,this.v2=n,this.v3=i},Z.CubicBezierCurve.prototype=Object.create(Z.Curve.prototype),Z.CubicBezierCurve.prototype.constructor=Z.CubicBezierCurve,Z.CubicBezierCurve.prototype.getPoint=function(e){var t,n;return t=Z.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=Z.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new Z.Vector2(t,n)},Z.CubicBezierCurve.prototype.getTangent=function(e){var t,n;t=Z.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=Z.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var i=new Z.Vector2(t,n);return i.normalize(),i},Z.SplineCurve=function(e){this.points=null==e?[]:e},Z.SplineCurve.prototype=Object.create(Z.Curve.prototype),Z.SplineCurve.prototype.constructor=Z.SplineCurve,Z.SplineCurve.prototype.getPoint=function(e){var t=this.points,n=(t.length-1)*e,i=Math.floor(n),r=n-i,o=t[0==i?i:i-1],a=t[i],s=t[i>t.length-2?t.length-1:i+1],l=t[i>t.length-3?t.length-1:i+2],c=new Z.Vector2;return c.x=Z.Curve.Utils.interpolate(o.x,a.x,s.x,l.x,r),c.y=Z.Curve.Utils.interpolate(o.y,a.y,s.y,l.y,r),c},Z.EllipseCurve=function(e,t,n,i,r,o,a){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a},Z.EllipseCurve.prototype=Object.create(Z.Curve.prototype),Z.EllipseCurve.prototype.constructor=Z.EllipseCurve,Z.EllipseCurve.prototype.getPoint=function(e){var t,n=this.aEndAngle-this.aStartAngle;n<0&&(n+=2*Math.PI),n>2*Math.PI&&(n-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-n):this.aStartAngle+e*n;var i=new Z.Vector2;return i.x=this.aX+this.xRadius*Math.cos(t),i.y=this.aY+this.yRadius*Math.sin(t),i},Z.ArcCurve=function(e,t,n,i,r,o){Z.EllipseCurve.call(this,e,t,n,n,i,r,o)},Z.ArcCurve.prototype=Object.create(Z.EllipseCurve.prototype),Z.ArcCurve.prototype.constructor=Z.ArcCurve,Z.LineCurve3=Z.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new Z.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),Z.QuadraticBezierCurve3=Z.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t=new Z.Vector3;return t.x=Z.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=Z.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t.z=Z.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),t}),Z.CubicBezierCurve3=Z.Curve.create(function(e,t,n,i){this.v0=e,this.v1=t,this.v2=n,this.v3=i},function(e){var t=new Z.Vector3;return t.x=Z.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t.y=Z.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t.z=Z.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),t}),Z.SplineCurve3=Z.Curve.create(function(e){this.points=null==e?[]:e},function(e){var t=this.points,n=(t.length-1)*e,i=Math.floor(n),r=n-i,o=t[0==i?i:i-1],a=t[i],s=t[i>t.length-2?t.length-1:i+1],l=t[i>t.length-3?t.length-1:i+2],c=new Z.Vector3;return c.x=Z.Curve.Utils.interpolate(o.x,a.x,s.x,l.x,r),c.y=Z.Curve.Utils.interpolate(o.y,a.y,s.y,l.y,r),c.z=Z.Curve.Utils.interpolate(o.z,a.z,s.z,l.z,r),c}),Z.ClosedSplineCurve3=Z.Curve.create(function(e){this.points=null==e?[]:e},function(e){var t=this.points,n=(t.length-0)*e,i=Math.floor(n),r=n-i,o=t[((i+=i>0?0:(Math.floor(Math.abs(i)/t.length)+1)*t.length)-1)%t.length],a=t[i%t.length],s=t[(i+1)%t.length],l=t[(i+2)%t.length],c=new Z.Vector3;return c.x=Z.Curve.Utils.interpolate(o.x,a.x,s.x,l.x,r),c.y=Z.Curve.Utils.interpolate(o.y,a.y,s.y,l.y,r),c.z=Z.Curve.Utils.interpolate(o.z,a.z,s.z,l.z,r),c}),Z.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){Z.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){Z.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){Z.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(!0===e.initialized)return e;for(var t=0;t<e.hierarchy.length;t++){for(var n=0;n<e.hierarchy[t].keys.length;n++)if(e.hierarchy[t].keys[n].time<0&&(e.hierarchy[t].keys[n].time=0),void 0!==e.hierarchy[t].keys[n].rot&&!(e.hierarchy[t].keys[n].rot instanceof Z.Quaternion)){var i=e.hierarchy[t].keys[n].rot;e.hierarchy[t].keys[n].rot=(new Z.Quaternion).fromArray(i)}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){var r={};for(n=0;n<e.hierarchy[t].keys.length;n++)for(var o=0;o<e.hierarchy[t].keys[n].morphTargets.length;o++){r[s=e.hierarchy[t].keys[n].morphTargets[o]]=-1}e.hierarchy[t].usedMorphTargets=r;for(n=0;n<e.hierarchy[t].keys.length;n++){var a={};for(var s in r){for(o=0;o<e.hierarchy[t].keys[n].morphTargets.length;o++)if(e.hierarchy[t].keys[n].morphTargets[o]===s){a[s]=e.hierarchy[t].keys[n].morphTargetsInfluences[o];break}o===e.hierarchy[t].keys[n].morphTargets.length&&(a[s]=0)}e.hierarchy[t].keys[n].morphTargetsInfluences=a}}for(n=1;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].time===e.hierarchy[t].keys[n-1].time&&(e.hierarchy[t].keys.splice(n,1),n--);for(n=0;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].index=n}return e.initialized=!0,e},parse:function(e){var t=[];if(e instanceof Z.SkinnedMesh)for(var n=0;n<e.skeleton.bones.length;n++)t.push(e.skeleton.bones[n]);else!function e(t,n){n.push(t);for(var i=0;i<t.children.length;i++)e(t.children[i],n)}(e,t);return t},play:function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},stop:function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},update:function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].resetBlendWeights();for(t=0;t<this.animations.length;t++)this.animations[t].update(e)}},Z.Animation=function(e,t){this.root=e,this.data=Z.AnimationHandler.init(t),this.hierarchy=Z.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=Z.AnimationHandler.LINEAR},Z.Animation.prototype={constructor:Z.Animation,keyTypes:["pos","rot","scl"],play:function(e,t){this.currentTime=void 0!==e?e:0,this.weight=void 0!==t?t:1,this.isPlaying=!0,this.reset(),Z.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,Z.AnimationHandler.stop(this)},reset:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e];void 0===n.animationCache&&(n.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});var i=this.data.name,r=n.animationCache.animations,o=r[i];void 0===o&&(o={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:n.matrix},r[i]=o);for(var a=0;a<3;a++){for(var s=this.keyTypes[a],l=this.data.hierarchy[e].keys[0],c=this.getNextKeyWith(s,e,1);c.time<this.currentTime&&c.index>l.index;)l=c,c=this.getNextKeyWith(s,e,c.index+1);o.prevKey[s]=l,o.nextKey[s]=c}}},resetBlendWeights:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e].animationCache;if(void 0!==n){var i=n.blending;i.positionWeight=0,i.quaternionWeight=0,i.scaleWeight=0}}},update:function(){var e=[],t=new Z.Vector3,n=new Z.Vector3,i=new Z.Quaternion,r=function(e,t){var n,i,r,a,s,l,c,u,h,d=[],f=[];return r=(n=(e.length-1)*t)-(i=Math.floor(n)),d[0]=0===i?i:i-1,d[1]=i,d[2]=i>e.length-2?i:i+1,d[3]=i>e.length-3?i:i+2,l=e[d[0]],c=e[d[1]],u=e[d[2]],h=e[d[3]],s=r*(a=r*r),f[0]=o(l[0],c[0],u[0],h[0],r,a,s),f[1]=o(l[1],c[1],u[1],h[1],r,a,s),f[2]=o(l[2],c[2],u[2],h[2],r,a,s),f},o=function(e,t,n,i,r,o,a){var s=.5*(n-e),l=.5*(i-t);return(2*(t-n)+s+l)*a+(-3*(t-n)-2*s-l)*o+s*r+t};return function(o){if(!1!==this.isPlaying&&(this.currentTime+=o*this.timeScale,0!==this.weight)){var a=this.data.length;(this.currentTime>a||this.currentTime<0)&&(this.loop?(this.currentTime%=a,this.currentTime<0&&(this.currentTime+=a),this.reset()):this.stop());for(var s=0,l=this.hierarchy.length;s<l;s++)for(var c=this.hierarchy[s],u=c.animationCache.animations[this.data.name],h=c.animationCache.blending,d=0;d<3;d++){var f=this.keyTypes[d],p=u.prevKey[f],m=u.nextKey[f];if(this.timeScale>0&&m.time<=this.currentTime||this.timeScale<0&&p.time>=this.currentTime){for(p=this.data.hierarchy[s].keys[0],m=this.getNextKeyWith(f,s,1);m.time<this.currentTime&&m.index>p.index;)p=m,m=this.getNextKeyWith(f,s,m.index+1);u.prevKey[f]=p,u.nextKey[f]=m}var g=(this.currentTime-p.time)/(m.time-p.time),v=p[f],y=m[f];if(g<0&&(g=0),g>1&&(g=1),"pos"===f){if(this.interpolationType===Z.AnimationHandler.LINEAR){n.x=v[0]+(y[0]-v[0])*g,n.y=v[1]+(y[1]-v[1])*g,n.z=v[2]+(y[2]-v[2])*g;var _=this.weight/(this.weight+h.positionWeight);c.position.lerp(n,_),h.positionWeight+=this.weight}else if(this.interpolationType===Z.AnimationHandler.CATMULLROM||this.interpolationType===Z.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",s,p.index-1).pos,e[1]=v,e[2]=y,e[3]=this.getNextKeyWith("pos",s,m.index+1).pos;var b=r(e,g=.33*g+.33);_=this.weight/(this.weight+h.positionWeight);h.positionWeight+=this.weight;var x=c.position;if(x.x=x.x+(b[0]-x.x)*_,x.y=x.y+(b[1]-x.y)*_,x.z=x.z+(b[2]-x.z)*_,this.interpolationType===Z.AnimationHandler.CATMULLROM_FORWARD){var w=r(e,1.01*g);t.set(w[0],w[1],w[2]),t.sub(x),t.y=0,t.normalize();var A=Math.atan2(t.x,t.z);c.rotation.set(0,A,0)}}}else if("rot"===f)if(Z.Quaternion.slerp(v,y,i,g),0===h.quaternionWeight)c.quaternion.copy(i),h.quaternionWeight=this.weight;else{_=this.weight/(this.weight+h.quaternionWeight);Z.Quaternion.slerp(c.quaternion,i,c.quaternion,_),h.quaternionWeight+=this.weight}else if("scl"===f){n.x=v[0]+(y[0]-v[0])*g,n.y=v[1]+(y[1]-v[1])*g,n.z=v[2]+(y[2]-v[2])*g;_=this.weight/(this.weight+h.scaleWeight);c.scale.lerp(n,_),h.scaleWeight+=this.weight}}return!0}}}(),getNextKeyWith:function(e,t,n){var i=this.data.hierarchy[t].keys;for(this.interpolationType===Z.AnimationHandler.CATMULLROM||this.interpolationType===Z.AnimationHandler.CATMULLROM_FORWARD?n=n<i.length-1?n:i.length-1:n%=i.length;n<i.length;n++)if(void 0!==i[n][e])return i[n];return this.data.hierarchy[t].keys[0]},getPrevKeyWith:function(e,t,n){var i=this.data.hierarchy[t].keys;for(n=this.interpolationType===Z.AnimationHandler.CATMULLROM||this.interpolationType===Z.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+i.length;n>=0;n--)if(void 0!==i[n][e])return i[n];return this.data.hierarchy[t].keys[i.length-1]}},Z.KeyFrameAnimation=function(e){this.root=e.node,this.data=Z.AnimationHandler.init(e),this.hierarchy=Z.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var t=0,n=this.hierarchy.length;t<n;t++){var i=this.data.hierarchy[t].keys,r=this.data.hierarchy[t].sids,o=this.hierarchy[t];if(i.length&&r){for(var a=0;a<r.length;a++){var s=r[a],l=this.getNextKeyWith(s,t,0);l&&l.apply(s)}o.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}},Z.KeyFrameAnimation.prototype={constructor:Z.KeyFrameAnimation,play:function(e){if(this.currentTime=void 0!==e?e:0,!1===this.isPlaying){this.isPlaying=!0;var t,n,i,r=this.hierarchy.length;for(t=0;t<r;t++){n=this.hierarchy[t],void 0===(i=this.data.hierarchy[t]).animationCache&&(i.animationCache={},i.animationCache.prevKey=null,i.animationCache.nextKey=null,i.animationCache.originalMatrix=n.matrix);var o=this.data.hierarchy[t].keys;o.length&&(i.animationCache.prevKey=o[0],i.animationCache.nextKey=o[1],this.startTime=Math.min(o[0].time,this.startTime),this.endTime=Math.max(o[o.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,Z.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,this.isPaused=!1,Z.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],n=this.data.hierarchy[e];if(void 0!==n.animationCache){var i=n.animationCache.originalMatrix;i.copy(t.matrix),t.matrix=i,delete n.animationCache}}},update:function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale;var t=this.data.length;!0===this.loop&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var n=0,i=this.hierarchy.length;n<i;n++){var r=this.hierarchy[n],o=this.data.hierarchy[n],a=o.keys,s=o.animationCache;if(a.length){var l=s.prevKey,c=s.nextKey;if(c.time<=this.currentTime){for(;c.time<this.currentTime&&c.index>l.index;)c=a[(l=c).index+1];s.prevKey=l,s.nextKey=c}c.time>=this.currentTime?l.interpolate(c,this.currentTime):l.interpolate(c,c.time),this.data.hierarchy[n].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(e,t,n){var i=this.data.hierarchy[t].keys;for(n%=i.length;n<i.length;n++)if(i[n].hasTarget(e))return i[n];return i[0]},getPrevKeyWith:function(e,t,n){var i=this.data.hierarchy[t].keys;for(n=n>=0?n:n+i.length;n>=0;n--)if(i[n].hasTarget(e))return i[n];return i[i.length-1]}},Z.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.lastFrame=0,this.currentFrame=0,this.isPlaying=!1},Z.MorphAnimation.prototype={constructor:Z.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(e){if(!1!==this.isPlaying){this.currentTime+=e,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames,n=Math.floor(this.currentTime/t),i=this.mesh.morphTargetInfluences;n!=this.currentFrame&&(i[this.lastFrame]=0,i[this.currentFrame]=1,i[n]=0,this.lastFrame=this.currentFrame,this.currentFrame=n),i[n]=this.currentTime%t/t,i[this.lastFrame]=1-i[n]}}},Z.BoxGeometry=function(e,t,n,i,r,o){Z.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o},this.widthSegments=i||1,this.heightSegments=r||1,this.depthSegments=o||1;var a=this,s=e/2,l=t/2,c=n/2;function u(e,t,n,i,r,o,s,l){var c,u,h,d=a.widthSegments,f=a.heightSegments,p=r/2,m=o/2,g=a.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",f=a.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",d=a.depthSegments);var v=d+1,y=f+1,_=r/d,b=o/f,x=new Z.Vector3;for(x[c]=s>0?1:-1,h=0;h<y;h++)for(u=0;u<v;u++){var w=new Z.Vector3;w[e]=(u*_-p)*n,w[t]=(h*b-m)*i,w[c]=s,a.vertices.push(w)}for(h=0;h<f;h++)for(u=0;u<d;u++){var A=u+v*h,E=u+v*(h+1),T=u+1+v*(h+1),M=u+1+v*h,S=new Z.Vector2(u/d,1-h/f),C=new Z.Vector2(u/d,1-(h+1)/f),P=new Z.Vector2((u+1)/d,1-(h+1)/f),L=new Z.Vector2((u+1)/d,1-h/f),R=new Z.Face3(A+g,E+g,M+g);R.normal.copy(x),R.vertexNormals.push(x.clone(),x.clone(),x.clone()),R.materialIndex=l,a.faces.push(R),a.faceVertexUvs[0].push([S,C,L]),(R=new Z.Face3(E+g,T+g,M+g)).normal.copy(x),R.vertexNormals.push(x.clone(),x.clone(),x.clone()),R.materialIndex=l,a.faces.push(R),a.faceVertexUvs[0].push([C.clone(),P,L.clone()])}}u("z","y",-1,-1,n,t,s,0),u("z","y",1,-1,n,t,-s,1),u("x","z",1,1,e,n,l,2),u("x","z",1,-1,e,n,-l,3),u("x","y",1,-1,e,t,c,4),u("x","y",-1,-1,e,t,-c,5),this.mergeVertices()},Z.BoxGeometry.prototype=Object.create(Z.Geometry.prototype),Z.BoxGeometry.prototype.constructor=Z.BoxGeometry,Z.CircleGeometry=function(e,t,n,i){Z.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},e=e||50,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var r,o=[],a=new Z.Vector3,s=new Z.Vector2(.5,.5);for(this.vertices.push(a),o.push(s),r=0;r<=t;r++){var l=new Z.Vector3,c=n+r/t*i;l.x=e*Math.cos(c),l.y=e*Math.sin(c),this.vertices.push(l),o.push(new Z.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var u=new Z.Vector3(0,0,1);for(r=1;r<=t;r++)this.faces.push(new Z.Face3(r,r+1,0,[u.clone(),u.clone(),u.clone()])),this.faceVertexUvs[0].push([o[r].clone(),o[r+1].clone(),s.clone()]);this.computeFaceNormals(),this.boundingSphere=new Z.Sphere(new Z.Vector3,e)},Z.CircleGeometry.prototype=Object.create(Z.Geometry.prototype),Z.CircleGeometry.prototype.constructor=Z.CircleGeometry,Z.CubeGeometry=function(e,t,n,i,r,o){return Z.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry."),new Z.BoxGeometry(e,t,n,i,r,o)},Z.CylinderGeometry=function(e,t,n,i,r,o,a,s){Z.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s},e=void 0!==e?e:20,t=void 0!==t?t:20,n=void 0!==n?n:100,i=i||8,r=r||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var l,c,u=n/2,h=[],d=[];for(c=0;c<=r;c++){var f=[],p=[],m=c/r,g=m*(t-e)+e;for(l=0;l<=i;l++){var v=l/i,y=new Z.Vector3;y.x=g*Math.sin(v*s+a),y.y=-m*n+u,y.z=g*Math.cos(v*s+a),this.vertices.push(y),f.push(this.vertices.length-1),p.push(new Z.Vector2(v,1-m))}h.push(f),d.push(p)}var _,b,x=(t-e)/n;for(l=0;l<i;l++)for(0!==e?(_=this.vertices[h[0][l]].clone(),b=this.vertices[h[0][l+1]].clone()):(_=this.vertices[h[1][l]].clone(),b=this.vertices[h[1][l+1]].clone()),_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*x).normalize(),b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*x).normalize(),c=0;c<r;c++){var w=h[c][l],A=h[c+1][l],E=h[c+1][l+1],T=h[c][l+1],M=_.clone(),S=_.clone(),C=b.clone(),P=b.clone(),L=d[c][l].clone(),R=d[c+1][l].clone(),D=d[c+1][l+1].clone(),I=d[c][l+1].clone();this.faces.push(new Z.Face3(w,A,T,[M,S,P])),this.faceVertexUvs[0].push([L,R,I]),this.faces.push(new Z.Face3(A,E,T,[S.clone(),C,P.clone()])),this.faceVertexUvs[0].push([R.clone(),D,I.clone()])}if(!1===o&&e>0)for(this.vertices.push(new Z.Vector3(0,u,0)),l=0;l<i;l++){w=h[0][l],A=h[0][l+1],E=this.vertices.length-1,M=new Z.Vector3(0,1,0),S=new Z.Vector3(0,1,0),C=new Z.Vector3(0,1,0),L=d[0][l].clone(),R=d[0][l+1].clone(),D=new Z.Vector2(R.x,0);this.faces.push(new Z.Face3(w,A,E,[M,S,C])),this.faceVertexUvs[0].push([L,R,D])}if(!1===o&&t>0)for(this.vertices.push(new Z.Vector3(0,-u,0)),l=0;l<i;l++){w=h[r][l+1],A=h[r][l],E=this.vertices.length-1,M=new Z.Vector3(0,-1,0),S=new Z.Vector3(0,-1,0),C=new Z.Vector3(0,-1,0),L=d[r][l+1].clone(),R=d[r][l].clone(),D=new Z.Vector2(R.x,1);this.faces.push(new Z.Face3(w,A,E,[M,S,C])),this.faceVertexUvs[0].push([L,R,D])}this.computeFaceNormals()},Z.CylinderGeometry.prototype=Object.create(Z.Geometry.prototype),Z.CylinderGeometry.prototype.constructor=Z.CylinderGeometry,Z.ExtrudeGeometry=function(e,t){void 0!==e?(Z.Geometry.call(this),this.type="ExtrudeGeometry",e=e instanceof Array?e:[e],this.addShapeList(e,t),this.computeFaceNormals()):e=[]},Z.ExtrudeGeometry.prototype=Object.create(Z.Geometry.prototype),Z.ExtrudeGeometry.prototype.constructor=Z.ExtrudeGeometry,Z.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var n=e.length,i=0;i<n;i++){var r=e[i];this.addShape(r,t)}},Z.ExtrudeGeometry.prototype.addShape=function(e,t){var n,i,r,o,a,s,l,c,u=void 0!==t.amount?t.amount:100,h=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:h-2,f=void 0!==t.bevelSegments?t.bevelSegments:3,p=void 0===t.bevelEnabled||t.bevelEnabled,m=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1,v=t.extrudePath,y=!1,_=t.material,b=t.extrudeMaterial,x=void 0!==t.UVGenerator?t.UVGenerator:Z.ExtrudeGeometry.WorldUVGenerator;v&&(n=v.getSpacedPoints(g),y=!0,p=!1,i=void 0!==t.frames?t.frames:new Z.TubeGeometry.FrenetFrames(v,g,!1),r=new Z.Vector3,o=new Z.Vector3,a=new Z.Vector3),p||(f=0,h=0,d=0);var w=this,A=this.vertices.length,E=e.extractPoints(m),T=E.shape,M=E.holes,S=!Z.Shape.Utils.isClockWise(T);if(S){for(T=T.reverse(),l=0,c=M.length;l<c;l++)s=M[l],Z.Shape.Utils.isClockWise(s)&&(M[l]=s.reverse());S=!1}var C=Z.Shape.Utils.triangulateShape(T,M),P=T;for(l=0,c=M.length;l<c;l++)s=M[l],T=T.concat(s);function L(e,t,n){return t||Z.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var R,D,I,O,N,k,V=T.length,F=C.length;function B(e,t,n){var i,r,o=1,a=e.x-t.x,s=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=a*a+s*s,h=a*c-s*l;if(Math.abs(h)>1e-10){var d=Math.sqrt(u),f=Math.sqrt(l*l+c*c),p=t.x-s/d,m=t.y+a/d,g=((n.x-c/f-p)*c-(n.y+l/f-m)*l)/(a*c-s*l),v=(i=p+a*g-e.x)*i+(r=m+s*g-e.y)*r;if(v<=2)return new Z.Vector2(i,r);o=Math.sqrt(v/2)}else{var y=!1;a>1e-10?l>1e-10&&(y=!0):a<-1e-10?l<-1e-10&&(y=!0):Math.sign(s)==Math.sign(c)&&(y=!0),y?(i=-s,r=a,o=Math.sqrt(u)):(i=a,r=s,o=Math.sqrt(u/2))}return new Z.Vector2(i/o,r/o)}for(var U=[],z=0,G=P.length,H=G-1,W=z+1;z<G;z++,H++,W++)H===G&&(H=0),W===G&&(W=0),U[z]=B(P[z],P[H],P[W]);var j,X,q=[],Y=U.concat();for(l=0,c=M.length;l<c;l++){for(s=M[l],j=[],z=0,H=(G=s.length)-1,W=z+1;z<G;z++,H++,W++)H===G&&(H=0),W===G&&(W=0),j[z]=B(s[z],s[H],s[W]);q.push(j),Y=Y.concat(j)}for(R=0;R<f;R++){for(O=h*(1-(I=R/f)),D=d*Math.sin(I*Math.PI/2),z=0,G=P.length;z<G;z++)Q((N=L(P[z],U[z],D)).x,N.y,-O);for(l=0,c=M.length;l<c;l++)for(s=M[l],j=q[l],z=0,G=s.length;z<G;z++)Q((N=L(s[z],j[z],D)).x,N.y,-O)}for(D=d,z=0;z<V;z++)N=p?L(T[z],Y[z],D):T[z],y?(o.copy(i.normals[0]).multiplyScalar(N.x),r.copy(i.binormals[0]).multiplyScalar(N.y),a.copy(n[0]).add(o).add(r),Q(a.x,a.y,a.z)):Q(N.x,N.y,0);for(X=1;X<=g;X++)for(z=0;z<V;z++)N=p?L(T[z],Y[z],D):T[z],y?(o.copy(i.normals[X]).multiplyScalar(N.x),r.copy(i.binormals[X]).multiplyScalar(N.y),a.copy(n[X]).add(o).add(r),Q(a.x,a.y,a.z)):Q(N.x,N.y,u/g*X);for(R=f-1;R>=0;R--){for(O=h*(1-(I=R/f)),D=d*Math.sin(I*Math.PI/2),z=0,G=P.length;z<G;z++)Q((N=L(P[z],U[z],D)).x,N.y,u+O);for(l=0,c=M.length;l<c;l++)for(s=M[l],j=q[l],z=0,G=s.length;z<G;z++)N=L(s[z],j[z],D),y?Q(N.x,N.y+n[g-1].y,n[g-1].x+O):Q(N.x,N.y,u+O)}function K(e,t){var n,i;for(z=e.length;--z>=0;){n=z,(i=z-1)<0&&(i=e.length-1);var r=0,o=g+2*f;for(r=0;r<o;r++){var a=V*r,s=V*(r+1);$(t+n+a,t+i+a,t+i+s,t+n+s,e,r,o,n,i)}}}function Q(e,t,n){w.vertices.push(new Z.Vector3(e,t,n))}function J(e,t,n){e+=A,t+=A,n+=A,w.faces.push(new Z.Face3(e,t,n,null,null,_));var i=x.generateTopUV(w,e,t,n);w.faceVertexUvs[0].push(i)}function $(e,t,n,i,r,o,a,s,l){e+=A,t+=A,n+=A,i+=A,w.faces.push(new Z.Face3(e,t,i,null,null,b)),w.faces.push(new Z.Face3(t,n,i,null,null,b));var c=x.generateSideWallUV(w,e,t,n,i);w.faceVertexUvs[0].push([c[0],c[1],c[3]]),w.faceVertexUvs[0].push([c[1],c[2],c[3]])}!function(){if(p){var e=0,t=V*e;for(z=0;z<F;z++)J((k=C[z])[2]+t,k[1]+t,k[0]+t);for(t=V*(e=g+2*f),z=0;z<F;z++)J((k=C[z])[0]+t,k[1]+t,k[2]+t)}else{for(z=0;z<F;z++)J((k=C[z])[2],k[1],k[0]);for(z=0;z<F;z++)J((k=C[z])[0]+V*g,k[1]+V*g,k[2]+V*g)}}(),function(){var e=0;for(K(P,e),e+=P.length,l=0,c=M.length;l<c;l++)K(s=M[l],e),e+=s.length}()},Z.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,i){var r=e.vertices,o=r[t],a=r[n],s=r[i];return[new Z.Vector2(o.x,o.y),new Z.Vector2(a.x,a.y),new Z.Vector2(s.x,s.y)]},generateSideWallUV:function(e,t,n,i,r){var o=e.vertices,a=o[t],s=o[n],l=o[i],c=o[r];return Math.abs(a.y-s.y)<.01?[new Z.Vector2(a.x,1-a.z),new Z.Vector2(s.x,1-s.z),new Z.Vector2(l.x,1-l.z),new Z.Vector2(c.x,1-c.z)]:[new Z.Vector2(a.y,1-a.z),new Z.Vector2(s.y,1-s.z),new Z.Vector2(l.y,1-l.z),new Z.Vector2(c.y,1-c.z)]}},Z.ShapeGeometry=function(e,t){Z.Geometry.call(this),this.type="ShapeGeometry",e instanceof Array==!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},Z.ShapeGeometry.prototype=Object.create(Z.Geometry.prototype),Z.ShapeGeometry.prototype.constructor=Z.ShapeGeometry,Z.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,i=e.length;n<i;n++)this.addShape(e[n],t);return this},Z.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var n,i,r,o=void 0!==t.curveSegments?t.curveSegments:12,a=t.material,s=void 0===t.UVGenerator?Z.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=this.vertices.length,c=e.extractPoints(o),u=c.shape,h=c.holes,d=!Z.Shape.Utils.isClockWise(u);if(d){for(u=u.reverse(),n=0,i=h.length;n<i;n++)r=h[n],Z.Shape.Utils.isClockWise(r)&&(h[n]=r.reverse());d=!1}var f=Z.Shape.Utils.triangulateShape(u,h);for(n=0,i=h.length;n<i;n++)r=h[n],u=u.concat(r);var p,m,g=u.length,v=f.length;for(n=0;n<g;n++)p=u[n],this.vertices.push(new Z.Vector3(p.x,p.y,0));for(n=0;n<v;n++){var y=(m=f[n])[0]+l,_=m[1]+l,b=m[2]+l;this.faces.push(new Z.Face3(y,_,b,null,null,a)),this.faceVertexUvs[0].push(s.generateTopUV(this,y,_,b))}},Z.LatheGeometry=function(e,t,n,i){Z.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=t||12,n=n||0,i=i||2*Math.PI;for(var r=1/(e.length-1),o=1/t,a=0,s=t;a<=s;a++)for(var l=n+a*o*i,c=Math.cos(l),u=Math.sin(l),h=0,d=e.length;h<d;h++){var f=e[h],p=new Z.Vector3;p.x=c*f.x-u*f.y,p.y=u*f.x+c*f.y,p.z=f.z,this.vertices.push(p)}var m=e.length;for(a=0,s=t;a<s;a++)for(h=0,d=e.length-1;h<d;h++){var g=h+m*a,v=g,y=g+m,_=(c=g+1+m,g+1),b=a*o,x=h*r,w=b+o,A=x+r;this.faces.push(new Z.Face3(v,y,_)),this.faceVertexUvs[0].push([new Z.Vector2(b,x),new Z.Vector2(w,x),new Z.Vector2(b,A)]),this.faces.push(new Z.Face3(y,c,_)),this.faceVertexUvs[0].push([new Z.Vector2(w,x),new Z.Vector2(w,A),new Z.Vector2(b,A)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},Z.LatheGeometry.prototype=Object.create(Z.Geometry.prototype),Z.LatheGeometry.prototype.constructor=Z.LatheGeometry,Z.PlaneGeometry=function(e,t,n,i){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint."),Z.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new Z.PlaneBufferGeometry(e,t,n,i))},Z.PlaneGeometry.prototype=Object.create(Z.Geometry.prototype),Z.PlaneGeometry.prototype.constructor=Z.PlaneGeometry,Z.PlaneBufferGeometry=function(e,t,n,i){Z.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};for(var r=e/2,o=t/2,a=n||1,s=i||1,l=a+1,c=s+1,u=e/a,h=t/s,d=new Float32Array(l*c*3),f=new Float32Array(l*c*3),p=new Float32Array(l*c*2),m=0,g=0,v=0;v<c;v++)for(var y=v*h-o,_=0;_<l;_++){var b=_*u-r;d[m]=b,d[m+1]=-y,f[m+2]=1,p[g]=_/a,p[g+1]=1-v/s,m+=3,g+=2}m=0;var x=new(d.length/3>65535?Uint32Array:Uint16Array)(a*s*6);for(v=0;v<s;v++)for(_=0;_<a;_++){var w=_+l*v,A=_+l*(v+1),E=_+1+l*(v+1),T=_+1+l*v;x[m]=w,x[m+1]=A,x[m+2]=T,x[m+3]=A,x[m+4]=E,x[m+5]=T,m+=6}this.addAttribute("index",new Z.BufferAttribute(x,1)),this.addAttribute("position",new Z.BufferAttribute(d,3)),this.addAttribute("normal",new Z.BufferAttribute(f,3)),this.addAttribute("uv",new Z.BufferAttribute(p,2))},Z.PlaneBufferGeometry.prototype=Object.create(Z.BufferGeometry.prototype),Z.PlaneBufferGeometry.prototype.constructor=Z.PlaneBufferGeometry,Z.RingGeometry=function(e,t,n,i,r,o){Z.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},e=e||0,t=t||50,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var a,s,l=[],c=e,u=(t-e)/(i=void 0!==i?Math.max(1,i):8);for(a=0;a<i+1;a++){for(s=0;s<n+1;s++){var h=new Z.Vector3,d=r+s/n*o;h.x=c*Math.cos(d),h.y=c*Math.sin(d),this.vertices.push(h),l.push(new Z.Vector2((h.x/t+1)/2,(h.y/t+1)/2))}c+=u}var f=new Z.Vector3(0,0,1);for(a=0;a<i;a++){var p=a*(n+1);for(s=0;s<n;s++){var m=d=s+p,g=d+n+1,v=d+n+2;this.faces.push(new Z.Face3(m,g,v,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()]),m=d,g=d+n+2,v=d+1,this.faces.push(new Z.Face3(m,g,v,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()])}}this.computeFaceNormals(),this.boundingSphere=new Z.Sphere(new Z.Vector3,c)},Z.RingGeometry.prototype=Object.create(Z.Geometry.prototype),Z.RingGeometry.prototype.constructor=Z.RingGeometry,Z.SphereGeometry=function(e,t,n,i,r,o,a){Z.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},e=e||50,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,l,c=[],u=[];for(l=0;l<=n;l++){var h=[],d=[];for(s=0;s<=t;s++){var f=s/t,p=l/n,m=new Z.Vector3;m.x=-e*Math.cos(i+f*r)*Math.sin(o+p*a),m.y=e*Math.cos(o+p*a),m.z=e*Math.sin(i+f*r)*Math.sin(o+p*a),this.vertices.push(m),h.push(this.vertices.length-1),d.push(new Z.Vector2(f,1-p))}c.push(h),u.push(d)}for(l=0;l<n;l++)for(s=0;s<t;s++){var g=c[l][s+1],v=c[l][s],y=c[l+1][s],_=c[l+1][s+1],b=this.vertices[g].clone().normalize(),x=this.vertices[v].clone().normalize(),w=this.vertices[y].clone().normalize(),A=this.vertices[_].clone().normalize(),E=u[l][s+1].clone(),T=u[l][s].clone(),M=u[l+1][s].clone(),S=u[l+1][s+1].clone();Math.abs(this.vertices[g].y)===e?(E.x=(E.x+T.x)/2,this.faces.push(new Z.Face3(g,y,_,[b,w,A])),this.faceVertexUvs[0].push([E,M,S])):Math.abs(this.vertices[y].y)===e?(M.x=(M.x+S.x)/2,this.faces.push(new Z.Face3(g,v,y,[b,x,w])),this.faceVertexUvs[0].push([E,T,M])):(this.faces.push(new Z.Face3(g,v,_,[b,x,A])),this.faceVertexUvs[0].push([E,T,S]),this.faces.push(new Z.Face3(v,y,_,[x.clone(),w,A.clone()])),this.faceVertexUvs[0].push([T.clone(),M,S.clone()]))}this.computeFaceNormals(),this.boundingSphere=new Z.Sphere(new Z.Vector3,e)},Z.SphereGeometry.prototype=Object.create(Z.Geometry.prototype),Z.SphereGeometry.prototype.constructor=Z.SphereGeometry,Z.TextGeometry=function(e,t){t=t||{};var n=Z.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Z.ExtrudeGeometry.call(this,n,t),this.type="TextGeometry"},Z.TextGeometry.prototype=Object.create(Z.ExtrudeGeometry.prototype),Z.TextGeometry.prototype.constructor=Z.TextGeometry,Z.TorusGeometry=function(e,t,n,i,r){Z.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},e=e||100,t=t||40,n=n||8,i=i||6,r=r||2*Math.PI;for(var o=new Z.Vector3,a=[],s=[],l=0;l<=n;l++)for(var c=0;c<=i;c++){var u=c/i*r,h=l/n*Math.PI*2;o.x=e*Math.cos(u),o.y=e*Math.sin(u);var d=new Z.Vector3;d.x=(e+t*Math.cos(h))*Math.cos(u),d.y=(e+t*Math.cos(h))*Math.sin(u),d.z=t*Math.sin(h),this.vertices.push(d),a.push(new Z.Vector2(c/i,l/n)),s.push(d.clone().sub(o).normalize())}for(l=1;l<=n;l++)for(c=1;c<=i;c++){var f=(i+1)*l+c-1,p=(i+1)*(l-1)+c-1,m=(i+1)*(l-1)+c,g=(i+1)*l+c,v=new Z.Face3(f,p,g,[s[f].clone(),s[p].clone(),s[g].clone()]);this.faces.push(v),this.faceVertexUvs[0].push([a[f].clone(),a[p].clone(),a[g].clone()]),v=new Z.Face3(p,m,g,[s[p].clone(),s[m].clone(),s[g].clone()]),this.faces.push(v),this.faceVertexUvs[0].push([a[p].clone(),a[m].clone(),a[g].clone()])}this.computeFaceNormals()},Z.TorusGeometry.prototype=Object.create(Z.Geometry.prototype),Z.TorusGeometry.prototype.constructor=Z.TorusGeometry,Z.TorusKnotGeometry=function(e,t,n,i,r,o,a){Z.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,p:r,q:o,heightScale:a},e=e||100,t=t||40,n=n||64,i=i||8,r=r||2,o=o||3,a=a||1;for(var s=new Array(n),l=new Z.Vector3,c=new Z.Vector3,u=new Z.Vector3,h=0;h<n;++h){s[h]=new Array(i);var d=h/n*2*r*Math.PI,f=L(d,o,r,e,a),p=L(d+.01,o,r,e,a);l.subVectors(p,f),c.addVectors(p,f),u.crossVectors(l,c),c.crossVectors(u,l),u.normalize(),c.normalize();for(var m=0;m<i;++m){var g=m/i*2*Math.PI,v=-t*Math.cos(g),y=t*Math.sin(g),_=new Z.Vector3;_.x=f.x+v*c.x+y*u.x,_.y=f.y+v*c.y+y*u.y,_.z=f.z+v*c.z+y*u.z,s[h][m]=this.vertices.push(_)-1}}for(h=0;h<n;++h)for(m=0;m<i;++m){var b=(h+1)%n,x=(m+1)%i,w=s[h][m],A=s[b][m],E=s[b][x],T=s[h][x],M=new Z.Vector2(h/n,m/i),S=new Z.Vector2((h+1)/n,m/i),C=new Z.Vector2((h+1)/n,(m+1)/i),P=new Z.Vector2(h/n,(m+1)/i);this.faces.push(new Z.Face3(w,A,T)),this.faceVertexUvs[0].push([M,S,P]),this.faces.push(new Z.Face3(A,E,T)),this.faceVertexUvs[0].push([S.clone(),C,P.clone()])}function L(e,t,n,i,r){var o=Math.cos(e),a=Math.sin(e),s=t/n*e,l=Math.cos(s),c=i*(2+l)*.5*o,u=i*(2+l)*a*.5,h=r*i*Math.sin(s)*.5;return new Z.Vector3(c,u,h)}this.computeFaceNormals(),this.computeVertexNormals()},Z.TorusKnotGeometry.prototype=Object.create(Z.Geometry.prototype),Z.TorusKnotGeometry.prototype.constructor=Z.TorusKnotGeometry,Z.TubeGeometry=function(e,t,n,i,r,o){Z.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:n,radialSegments:i,closed:r},t=t||64,n=n||1,i=i||8,r=r||!1,o=o||Z.TubeGeometry.NoTaper;var a,s,l,c,u,h,d,f,p,m,g,v,y,_,b,x,w,A,E,T,M,S,C,P=[],L=this,R=t+1,D=new Z.Vector3,I=new Z.TubeGeometry.FrenetFrames(e,t,r),O=I.tangents,N=I.normals,k=I.binormals;for(this.tangents=O,this.normals=N,this.binormals=k,p=0;p<R;p++)for(P[p]=[],l=p/(R-1),f=e.getPointAt(l),O[p],a=N[p],s=k[p],u=n*o(l),m=0;m<i;m++)c=m/i*2*Math.PI,h=-u*Math.cos(c),d=u*Math.sin(c),D.copy(f),D.x+=h*a.x+d*s.x,D.y+=h*a.y+d*s.y,D.z+=h*a.z+d*s.z,P[p][m]=(M=D.x,S=D.y,C=D.z,L.vertices.push(new Z.Vector3(M,S,C))-1);for(p=0;p<t;p++)for(m=0;m<i;m++)g=r?(p+1)%t:p+1,v=(m+1)%i,y=P[p][m],_=P[g][m],b=P[g][v],x=P[p][v],w=new Z.Vector2(p/t,m/i),A=new Z.Vector2((p+1)/t,m/i),E=new Z.Vector2((p+1)/t,(m+1)/i),T=new Z.Vector2(p/t,(m+1)/i),this.faces.push(new Z.Face3(y,_,x)),this.faceVertexUvs[0].push([w,A,T]),this.faces.push(new Z.Face3(_,b,x)),this.faceVertexUvs[0].push([A.clone(),E,T.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},Z.TubeGeometry.prototype=Object.create(Z.Geometry.prototype),Z.TubeGeometry.prototype.constructor=Z.TubeGeometry,Z.TubeGeometry.NoTaper=function(e){return 1},Z.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},Z.TubeGeometry.FrenetFrames=function(e,t,n){var i,r,o,a,s,l,c,u=new Z.Vector3,h=[],d=[],f=[],p=new Z.Vector3,m=new Z.Matrix4,g=t+1;for(this.tangents=h,this.normals=d,this.binormals=f,l=0;l<g;l++)c=l/(g-1),h[l]=e.getTangentAt(c),h[l].normalize();for(function(){d[0]=new Z.Vector3,f[0]=new Z.Vector3,r=Number.MAX_VALUE,o=Math.abs(h[0].x),a=Math.abs(h[0].y),s=Math.abs(h[0].z),o<=r&&(r=o,u.set(1,0,0));a<=r&&(r=a,u.set(0,1,0));s<=r&&u.set(0,0,1);p.crossVectors(h[0],u).normalize(),d[0].crossVectors(h[0],p),f[0].crossVectors(h[0],d[0])}(),l=1;l<g;l++)d[l]=d[l-1].clone(),f[l]=f[l-1].clone(),p.crossVectors(h[l-1],h[l]),p.length()>1e-4&&(p.normalize(),i=Math.acos(Z.Math.clamp(h[l-1].dot(h[l]),-1,1)),d[l].applyMatrix4(m.makeRotationAxis(p,i))),f[l].crossVectors(h[l],d[l]);if(n)for(i=Math.acos(Z.Math.clamp(d[0].dot(d[g-1]),-1,1)),i/=g-1,h[0].dot(p.crossVectors(d[0],d[g-1]))>0&&(i=-i),l=1;l<g;l++)d[l].applyMatrix4(m.makeRotationAxis(h[l],i*l)),f[l].crossVectors(h[l],d[l])},Z.PolyhedronGeometry=function(e,t,n,i){Z.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},n=n||1,i=i||0;for(var r=this,o=0,a=e.length;o<a;o+=3)b(new Z.Vector3(e[o],e[o+1],e[o+2]));var s=this.vertices,l=[],c=(o=0,0);for(a=t.length;o<a;o+=3,c++){var u=s[t[o]],h=s[t[o+1]],d=s[t[o+2]];l[c]=new Z.Face3(u.index,h.index,d.index,[u.clone(),h.clone(),d.clone()])}var f=new Z.Vector3;for(o=0,a=l.length;o<a;o++)w(l[o],i);for(o=0,a=this.faceVertexUvs[0].length;o<a;o++){var p=this.faceVertexUvs[0][o],m=p[0].x,g=p[1].x,v=p[2].x,y=Math.max(m,Math.max(g,v)),_=Math.min(m,Math.min(g,v));y>.9&&_<.1&&(m<.2&&(p[0].x+=1),g<.2&&(p[1].x+=1),v<.2&&(p[2].x+=1))}for(o=0,a=this.vertices.length;o<a;o++)this.vertices[o].multiplyScalar(n);function b(e){var t=e.normalize().clone();t.index=r.vertices.push(t)-1;var n=A(e)/2/Math.PI+.5,i=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;return t.uv=new Z.Vector2(n,1-i),t}function x(e,t,n){var i=new Z.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]);r.faces.push(i),f.copy(e).add(t).add(n).divideScalar(3);var o=A(f);r.faceVertexUvs[0].push([E(e.uv,e,o),E(t.uv,t,o),E(n.uv,n,o)])}function w(e,t){for(var n=Math.pow(2,t),i=b(r.vertices[e.a]),o=b(r.vertices[e.b]),a=b(r.vertices[e.c]),s=[],l=0;l<=n;l++){s[l]=[];for(var c=b(i.clone().lerp(a,l/n)),u=b(o.clone().lerp(a,l/n)),h=n-l,d=0;d<=h;d++)s[l][d]=0==d&&l==n?c:b(c.clone().lerp(u,d/h))}for(l=0;l<n;l++)for(d=0;d<2*(n-l)-1;d++){var f=Math.floor(d/2);d%2==0?x(s[l][f+1],s[l+1][f],s[l][f]):x(s[l][f+1],s[l+1][f+1],s[l+1][f])}}function A(e){return Math.atan2(e.z,-e.x)}function E(e,t,n){return n<0&&1===e.x&&(e=new Z.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new Z.Vector2(n/2/Math.PI+.5,e.y)),e.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new Z.Sphere(new Z.Vector3,n)},Z.PolyhedronGeometry.prototype=Object.create(Z.Geometry.prototype),Z.PolyhedronGeometry.prototype.constructor=Z.PolyhedronGeometry,Z.DodecahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i];Z.PolyhedronGeometry.call(this,r,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t)},Z.DodecahedronGeometry.prototype=Object.create(Z.Geometry.prototype),Z.DodecahedronGeometry.prototype.constructor=Z.DodecahedronGeometry,Z.IcosahedronGeometry=function(e,t){var n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];Z.PolyhedronGeometry.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},Z.IcosahedronGeometry.prototype=Object.create(Z.Geometry.prototype),Z.IcosahedronGeometry.prototype.constructor=Z.IcosahedronGeometry,Z.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};Z.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},Z.OctahedronGeometry.prototype=Object.create(Z.Geometry.prototype),Z.OctahedronGeometry.prototype.constructor=Z.OctahedronGeometry,Z.TetrahedronGeometry=function(e,t){Z.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},Z.TetrahedronGeometry.prototype=Object.create(Z.Geometry.prototype),Z.TetrahedronGeometry.prototype.constructor=Z.TetrahedronGeometry,Z.ParametricGeometry=function(e,t,n){Z.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};var i,r,o,a,s,l,c,u,h,d,f,p,m=this.vertices,g=this.faces,v=this.faceVertexUvs[0],y=t+1;for(i=0;i<=n;i++)for(a=i/n,r=0;r<=t;r++)o=e(r/t,a),m.push(o);for(i=0;i<n;i++)for(r=0;r<t;r++)s=i*y+r,l=i*y+r+1,c=(i+1)*y+r+1,u=(i+1)*y+r,h=new Z.Vector2(r/t,i/n),d=new Z.Vector2((r+1)/t,i/n),f=new Z.Vector2((r+1)/t,(i+1)/n),p=new Z.Vector2(r/t,(i+1)/n),g.push(new Z.Face3(s,l,u)),v.push([h,d,p]),g.push(new Z.Face3(l,c,u)),v.push([d.clone(),f,p.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},Z.ParametricGeometry.prototype=Object.create(Z.Geometry.prototype),Z.ParametricGeometry.prototype.constructor=Z.ParametricGeometry,Z.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),n=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),i=new Z.BufferGeometry;i.addAttribute("position",new Z.BufferAttribute(t,3)),i.addAttribute("color",new Z.BufferAttribute(n,3));var r=new Z.LineBasicMaterial({vertexColors:Z.VertexColors});Z.Line.call(this,i,r,Z.LinePieces)},Z.AxisHelper.prototype=Object.create(Z.Line.prototype),Z.AxisHelper.prototype.constructor=Z.AxisHelper,Z.ArrowHelper=function(){var e=new Z.Geometry;e.vertices.push(new Z.Vector3(0,0,0),new Z.Vector3(0,1,0));var t=new Z.CylinderGeometry(0,.5,1,5,1);return t.applyMatrix((new Z.Matrix4).makeTranslation(0,-.5,0)),function(n,i,r,o,a,s){Z.Object3D.call(this),void 0===o&&(o=16776960),void 0===r&&(r=1),void 0===a&&(a=.2*r),void 0===s&&(s=.2*a),this.position.copy(i),this.line=new Z.Line(e,new Z.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Z.Mesh(t,new Z.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(n),this.setLength(r,a,s)}}(),Z.ArrowHelper.prototype=Object.create(Z.Object3D.prototype),Z.ArrowHelper.prototype.constructor=Z.ArrowHelper,Z.ArrowHelper.prototype.setDirection=(Q=new Z.Vector3,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(Q.set(e.z,0,-e.x).normalize(),K=Math.acos(e.y),this.quaternion.setFromAxisAngle(Q,K))}),Z.ArrowHelper.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,e-t,1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},Z.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},Z.BoxHelper=function(e){var t=new Z.BufferGeometry;t.addAttribute("position",new Z.BufferAttribute(new Float32Array(72),3)),Z.Line.call(this,t,new Z.LineBasicMaterial({color:16776960}),Z.LinePieces),void 0!==e&&this.update(e)},Z.BoxHelper.prototype=Object.create(Z.Line.prototype),Z.BoxHelper.prototype.constructor=Z.BoxHelper,Z.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var n=t.boundingBox.min,i=t.boundingBox.max,r=this.geometry.attributes.position.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=n.x,r[4]=i.y,r[5]=i.z,r[6]=n.x,r[7]=i.y,r[8]=i.z,r[9]=n.x,r[10]=n.y,r[11]=i.z,r[12]=n.x,r[13]=n.y,r[14]=i.z,r[15]=i.x,r[16]=n.y,r[17]=i.z,r[18]=i.x,r[19]=n.y,r[20]=i.z,r[21]=i.x,r[22]=i.y,r[23]=i.z,r[24]=i.x,r[25]=i.y,r[26]=n.z,r[27]=n.x,r[28]=i.y,r[29]=n.z,r[30]=n.x,r[31]=i.y,r[32]=n.z,r[33]=n.x,r[34]=n.y,r[35]=n.z,r[36]=n.x,r[37]=n.y,r[38]=n.z,r[39]=i.x,r[40]=n.y,r[41]=n.z,r[42]=i.x,r[43]=n.y,r[44]=n.z,r[45]=i.x,r[46]=i.y,r[47]=n.z,r[48]=i.x,r[49]=i.y,r[50]=i.z,r[51]=i.x,r[52]=i.y,r[53]=n.z,r[54]=n.x,r[55]=i.y,r[56]=i.z,r[57]=n.x,r[58]=i.y,r[59]=n.z,r[60]=n.x,r[61]=n.y,r[62]=i.z,r[63]=n.x,r[64]=n.y,r[65]=n.z,r[66]=i.x,r[67]=n.y,r[68]=i.z,r[69]=i.x,r[70]=n.y,r[71]=n.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},Z.BoundingBoxHelper=function(e,t){var n=void 0!==t?t:8947848;this.object=e,this.box=new Z.Box3,Z.Mesh.call(this,new Z.BoxGeometry(1,1,1),new Z.MeshBasicMaterial({color:n,wireframe:!0}))},Z.BoundingBoxHelper.prototype=Object.create(Z.Mesh.prototype),Z.BoundingBoxHelper.prototype.constructor=Z.BoundingBoxHelper,Z.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},Z.CameraHelper=function(e){var t=new Z.Geometry,n=new Z.LineBasicMaterial({color:16777215,vertexColors:Z.FaceColors}),i={};function r(e,t,n){o(e,n),o(t,n)}function o(e,n){t.vertices.push(new Z.Vector3),t.colors.push(new Z.Color(n)),void 0===i[e]&&(i[e]=[]),i[e].push(t.vertices.length-1)}r("n1","n2",16755200),r("n2","n4",16755200),r("n4","n3",16755200),r("n3","n1",16755200),r("f1","f2",16755200),r("f2","f4",16755200),r("f4","f3",16755200),r("f3","f1",16755200),r("n1","f1",16755200),r("n2","f2",16755200),r("n3","f3",16755200),r("n4","f4",16755200),r("p","n1",16711680),r("p","n2",16711680),r("p","n3",16711680),r("p","n4",16711680),r("u1","u2",43775),r("u2","u3",43775),r("u3","u1",43775),r("c","t",16777215),r("p","c",3355443),r("cn1","cn2",3355443),r("cn3","cn4",3355443),r("cf1","cf2",3355443),r("cf3","cf4",3355443),Z.Line.call(this,t,n,Z.LinePieces),this.camera=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=i,this.update()},Z.CameraHelper.prototype=Object.create(Z.Line.prototype),Z.CameraHelper.prototype.constructor=Z.CameraHelper,Z.CameraHelper.prototype.update=function(){var e,t,n=new Z.Vector3,i=new Z.Camera,r=function(r,o,a,s){n.set(o,a,s).unproject(i);var l=t[r];if(void 0!==l)for(var c=0,u=l.length;c<u;c++)e.vertices[l[c]].copy(n)};return function(){e=this.geometry,t=this.pointMap;i.projectionMatrix.copy(this.camera.projectionMatrix),r("c",0,0,-1),r("t",0,0,1),r("n1",-1,-1,-1),r("n2",1,-1,-1),r("n3",-1,1,-1),r("n4",1,1,-1),r("f1",-1,-1,1),r("f2",1,-1,1),r("f3",-1,1,1),r("f4",1,1,1),r("u1",.7,1.1,-1),r("u2",-.7,1.1,-1),r("u3",0,2,-1),r("cf1",-1,0,1),r("cf2",1,0,1),r("cf3",0,-1,1),r("cf4",0,1,1),r("cn1",-1,0,-1),r("cn2",1,0,-1),r("cn3",0,-1,-1),r("cn4",0,1,-1),e.verticesNeedUpdate=!0}}(),Z.DirectionalLightHelper=function(e,t){Z.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var n=new Z.Geometry;n.vertices.push(new Z.Vector3(-t,t,0),new Z.Vector3(t,t,0),new Z.Vector3(t,-t,0),new Z.Vector3(-t,-t,0),new Z.Vector3(-t,t,0));var i=new Z.LineBasicMaterial({fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new Z.Line(n,i),this.add(this.lightPlane),(n=new Z.Geometry).vertices.push(new Z.Vector3,new Z.Vector3),(i=new Z.LineBasicMaterial({fog:!1})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new Z.Line(n,i),this.add(this.targetLine),this.update()},Z.DirectionalLightHelper.prototype=Object.create(Z.Object3D.prototype),Z.DirectionalLightHelper.prototype.constructor=Z.DirectionalLightHelper,Z.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Z.DirectionalLightHelper.prototype.update=function(){var e=new Z.Vector3,t=new Z.Vector3,n=new Z.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(n),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(n),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),Z.EdgesHelper=function(e,t,n){var i=void 0!==t?t:16777215;n=void 0!==n?n:1;var r,o=Math.cos(Z.Math.degToRad(n)),a=[0,0],s={},l=function(e,t){return e-t},c=["a","b","c"],u=new Z.BufferGeometry;e.geometry instanceof Z.BufferGeometry?(r=new Z.Geometry).fromBufferGeometry(e.geometry):r=e.geometry.clone(),r.mergeVertices(),r.computeFaceNormals();for(var h=r.vertices,d=r.faces,f=0,p=0,m=d.length;p<m;p++)for(var g=d[p],v=0;v<3;v++){a[0]=g[c[v]],a[1]=g[c[(v+1)%3]],a.sort(l),void 0===s[b=a.toString()]?(s[b]={vert1:a[0],vert2:a[1],face1:p,face2:void 0},f++):s[b].face2=p}var y=new Float32Array(2*f*3),_=0;for(var b in s){var x=s[b];if(void 0===x.face2||d[x.face1].normal.dot(d[x.face2].normal)<=o){var w=h[x.vert1];y[_++]=w.x,y[_++]=w.y,y[_++]=w.z,w=h[x.vert2],y[_++]=w.x,y[_++]=w.y,y[_++]=w.z}}u.addAttribute("position",new Z.BufferAttribute(y,3)),Z.Line.call(this,u,new Z.LineBasicMaterial({color:i}),Z.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},Z.EdgesHelper.prototype=Object.create(Z.Line.prototype),Z.EdgesHelper.prototype.constructor=Z.EdgesHelper,Z.FaceNormalsHelper=function(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;for(var r=void 0!==n?n:16776960,o=void 0!==i?i:1,a=new Z.Geometry,s=0,l=this.object.geometry.faces.length;s<l;s++)a.vertices.push(new Z.Vector3,new Z.Vector3);Z.Line.call(this,a,new Z.LineBasicMaterial({color:r,linewidth:o}),Z.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new Z.Matrix3,this.update()},Z.FaceNormalsHelper.prototype=Object.create(Z.Line.prototype),Z.FaceNormalsHelper.prototype.constructor=Z.FaceNormalsHelper,Z.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,t=this.object,n=t.geometry.vertices,i=t.geometry.faces,r=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(r);for(var o=0,a=0,s=i.length;o<s;o++,a+=2){var l=i[o];e[a].copy(n[l.a]).add(n[l.b]).add(n[l.c]).divideScalar(3).applyMatrix4(r),e[a+1].copy(l.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[a])}return this.geometry.verticesNeedUpdate=!0,this},Z.GridHelper=function(e,t){var n=new Z.Geometry,i=new Z.LineBasicMaterial({vertexColors:Z.VertexColors});this.color1=new Z.Color(4473924),this.color2=new Z.Color(8947848);for(var r=-e;r<=e;r+=t){n.vertices.push(new Z.Vector3(-e,0,r),new Z.Vector3(e,0,r),new Z.Vector3(r,0,-e),new Z.Vector3(r,0,e));var o=0===r?this.color1:this.color2;n.colors.push(o,o,o,o)}Z.Line.call(this,n,i,Z.LinePieces)},Z.GridHelper.prototype=Object.create(Z.Line.prototype),Z.GridHelper.prototype.constructor=Z.GridHelper,Z.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},Z.HemisphereLightHelper=function(e,t){Z.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new Z.Color,new Z.Color];var n=new Z.SphereGeometry(t,4,2);n.applyMatrix((new Z.Matrix4).makeRotationX(-Math.PI/2));for(var i=0;i<8;i++)n.faces[i].color=this.colors[i<4?0:1];var r=new Z.MeshBasicMaterial({vertexColors:Z.FaceColors,wireframe:!0});this.lightSphere=new Z.Mesh(n,r),this.add(this.lightSphere),this.update()},Z.HemisphereLightHelper.prototype=Object.create(Z.Object3D.prototype),Z.HemisphereLightHelper.prototype.constructor=Z.HemisphereLightHelper,Z.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},Z.HemisphereLightHelper.prototype.update=function(){var e=new Z.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),Z.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var n=new Z.SphereGeometry(t,4,2),i=new Z.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),Z.Mesh.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},Z.PointLightHelper.prototype=Object.create(Z.Mesh.prototype),Z.PointLightHelper.prototype.constructor=Z.PointLightHelper,Z.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Z.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},Z.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new Z.Geometry,n=0;n<this.bones.length;n++){this.bones[n].parent instanceof Z.Bone&&(t.vertices.push(new Z.Vector3),t.vertices.push(new Z.Vector3),t.colors.push(new Z.Color(0,0,1)),t.colors.push(new Z.Color(0,1,0)))}var i=new Z.LineBasicMaterial({vertexColors:Z.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});Z.Line.call(this,t,i,Z.LinePieces),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},Z.SkeletonHelper.prototype=Object.create(Z.Line.prototype),Z.SkeletonHelper.prototype.constructor=Z.SkeletonHelper,Z.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof Z.Bone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,this.getBoneList(e.children[n]));return t},Z.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new Z.Matrix4).getInverse(this.root.matrixWorld),n=new Z.Matrix4,i=0,r=0;r<this.bones.length;r++){var o=this.bones[r];o.parent instanceof Z.Bone&&(n.multiplyMatrices(t,o.matrixWorld),e.vertices[i].setFromMatrixPosition(n),n.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[i+1].setFromMatrixPosition(n),i+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},Z.SpotLightHelper=function(e){Z.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new Z.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new Z.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new Z.Matrix4).makeRotationX(-Math.PI/2));var n=new Z.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new Z.Mesh(t,n),this.add(this.cone),this.update()},Z.SpotLightHelper.prototype=Object.create(Z.Object3D.prototype),Z.SpotLightHelper.prototype.constructor=Z.SpotLightHelper,Z.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Z.SpotLightHelper.prototype.update=function(){var e=new Z.Vector3,t=new Z.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4,i=n*Math.tan(this.light.angle);this.cone.scale.set(i,i,n),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),Z.VertexNormalsHelper=function(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;for(var r=void 0!==n?n:16711680,o=void 0!==i?i:1,a=new Z.Geometry,s=e.geometry.faces,l=0,c=s.length;l<c;l++)for(var u=0,h=s[l].vertexNormals.length;u<h;u++)a.vertices.push(new Z.Vector3,new Z.Vector3);Z.Line.call(this,a,new Z.LineBasicMaterial({color:r,linewidth:o}),Z.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new Z.Matrix3,this.update()},Z.VertexNormalsHelper.prototype=Object.create(Z.Line.prototype),Z.VertexNormalsHelper.prototype.constructor=Z.VertexNormalsHelper,Z.VertexNormalsHelper.prototype.update=function(e){var t=new Z.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var i=this.geometry.vertices,r=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,l=0,c=o.length;l<c;l++)for(var u=o[l],h=0,d=u.vertexNormals.length;h<d;h++){var f=r[u[n[h]]],p=u.vertexNormals[h];i[s].copy(f).applyMatrix4(a),t.copy(p).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(i[s]),i[s+=1].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),Z.VertexTangentsHelper=function(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;for(var r=void 0!==n?n:255,o=void 0!==i?i:1,a=new Z.Geometry,s=e.geometry.faces,l=0,c=s.length;l<c;l++)for(var u=0,h=s[l].vertexTangents.length;u<h;u++)a.vertices.push(new Z.Vector3),a.vertices.push(new Z.Vector3);Z.Line.call(this,a,new Z.LineBasicMaterial({color:r,linewidth:o}),Z.LinePieces),this.matrixAutoUpdate=!1,this.update()},Z.VertexTangentsHelper.prototype=Object.create(Z.Line.prototype),Z.VertexTangentsHelper.prototype.constructor=Z.VertexTangentsHelper,Z.VertexTangentsHelper.prototype.update=function(e){var t=new Z.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var i=this.geometry.vertices,r=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,l=0,c=o.length;l<c;l++)for(var u=o[l],h=0,d=u.vertexTangents.length;h<d;h++){var f=r[u[n[h]]],p=u.vertexTangents[h];i[s].copy(f).applyMatrix4(a),t.copy(p).transformDirection(a).multiplyScalar(this.size),t.add(i[s]),i[s+=1].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),Z.WireframeHelper=function(e,t){var n=void 0!==t?t:16777215,i=[0,0],r={},o=function(e,t){return e-t},a=["a","b","c"],s=new Z.BufferGeometry;if(e.geometry instanceof Z.Geometry){for(var l=e.geometry.vertices,c=e.geometry.faces,u=0,h=new Uint32Array(6*c.length),d=0,f=c.length;d<f;d++)for(var p=c[d],m=0;m<3;m++){i[0]=p[a[m]],i[1]=p[a[(m+1)%3]],i.sort(o),void 0===r[M=i.toString()]&&(h[2*u]=i[0],h[2*u+1]=i[1],r[M]=!0,u++)}var g=new Float32Array(2*u*3);for(d=0,f=u;d<f;d++)for(m=0;m<2;m++){var v=l[h[2*d+m]];g[(E=6*d+3*m)+0]=v.x,g[E+1]=v.y,g[E+2]=v.z}s.addAttribute("position",new Z.BufferAttribute(g,3))}else if(e.geometry instanceof Z.BufferGeometry)if(void 0!==e.geometry.attributes.index){l=e.geometry.attributes.position.array;var y=e.geometry.attributes.index.array,_=e.geometry.drawcalls;u=0;0===_.length&&(_=[{count:y.length,index:0,start:0}]);h=new Uint32Array(2*y.length);for(var b=0,x=_.length;b<x;++b)for(var w=_[b].start,A=_[b].count,E=_[b].index,T=(d=w,w+A);d<T;d+=3)for(m=0;m<3;m++){var M;i[0]=E+y[d+m],i[1]=E+y[d+(m+1)%3],i.sort(o),void 0===r[M=i.toString()]&&(h[2*u]=i[0],h[2*u+1]=i[1],r[M]=!0,u++)}for(g=new Float32Array(2*u*3),d=0,f=u;d<f;d++)for(m=0;m<2;m++){E=6*d+3*m;var S=3*h[2*d+m];g[E+0]=l[S],g[E+1]=l[S+1],g[E+2]=l[S+2]}s.addAttribute("position",new Z.BufferAttribute(g,3))}else{var C=(u=(l=e.geometry.attributes.position.array).length/3)/3;for(g=new Float32Array(2*u*3),d=0,f=C;d<f;d++)for(m=0;m<3;m++){var P=9*d+3*m;g[(E=18*d+6*m)+0]=l[P],g[E+1]=l[P+1],g[E+2]=l[P+2];S=9*d+(m+1)%3*3;g[E+3]=l[S],g[E+4]=l[S+1],g[E+5]=l[S+2]}s.addAttribute("position",new Z.BufferAttribute(g,3))}Z.Line.call(this,s,new Z.LineBasicMaterial({color:n}),Z.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},Z.WireframeHelper.prototype=Object.create(Z.Line.prototype),Z.WireframeHelper.prototype.constructor=Z.WireframeHelper,Z.ImmediateRenderObject=function(){Z.Object3D.call(this),this.render=function(e){}},Z.ImmediateRenderObject.prototype=Object.create(Z.Object3D.prototype),Z.ImmediateRenderObject.prototype.constructor=Z.ImmediateRenderObject,Z.MorphBlendMesh=function(e,t){Z.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length,i=n-1,r=n/1;this.createAnimation("__default",0,i,r),this.setAnimationWeight("__default",1)},Z.MorphBlendMesh.prototype=Object.create(Z.Mesh.prototype),Z.MorphBlendMesh.prototype.constructor=Z.MorphBlendMesh,Z.MorphBlendMesh.prototype.createAnimation=function(e,t,n,i){var r={startFrame:t,endFrame:n,length:n-t+1,fps:i,duration:(n-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=r,this.animationsList.push(r)},Z.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,n=/([a-z]+)_?(\d+)/,i={},r=this.geometry,o=0,a=r.morphTargets.length;o<a;o++){var s=r.morphTargets[o].name.match(n);if(s&&s.length>1)i[l=s[1]]||(i[l]={start:1/0,end:-1/0}),o<(c=i[l]).start&&(c.start=o),o>c.end&&(c.end=o),t||(t=l)}for(var l in i){var c=i[l];this.createAnimation(l,c.start,c.end,e)}this.firstAnimation=t},Z.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},Z.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},Z.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},Z.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},Z.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},Z.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},Z.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,n=this.animationsMap[e];return n&&(t=n.time),t},Z.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,n=this.animationsMap[e];return n&&(t=n.duration),t},Z.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):Z.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},Z.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},Z.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var i=this.animationsList[t];if(i.active){var r=i.duration/i.length;i.time+=i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var o=i.startFrame+Z.Math.clamp(Math.floor(i.time/r),0,i.length-1),a=i.weight;o!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*a,this.morphTargetInfluences[o]=0,i.lastFrame=i.currentFrame,i.currentFrame=o);var s=i.time%r/r;i.directionBackwards&&(s=1-s),this.morphTargetInfluences[i.currentFrame]=s*a,this.morphTargetInfluences[i.lastFrame]=(1-s)*a}}}}).call(this,n(243)(e))},function(e,t,n){"use strict";n.r(t),n.d(t,"LogLevels",function(){return a}),n.d(t,"Logger",function(){return s}),n.d(t,"logger",function(){return c}),n.d(t,"setLogger",function(){return u});var i=n(3),r=n(4),o=Object(i.getGlobal)(),a={DEBUG:5,LOG:4,INFO:3,WARNING:2,ERROR:1,NONE:0};function s(){this.runtimeStats={},this.level=-1,this.setLevel(a.ERROR)}function l(){return"undefined"!=typeof window?encodeURI(window.location.href):""}s.prototype.initialize=function(e){if(e.eventCallback&&(this.callback=e.eventCallback),this.sessionId=e.sessionId,!this.sessionId){var t=Date.now()+"";this.sessionId=parseFloat((1e4*Math.random()|0)+""+t.substring(4))}var n=e.logLevel||e.loglevel;"number"==typeof n&&this.level!==n&&this.setLevel(n),this.environmentInfo={touch:Object(i.isTouchDevice)(),env:Object(r.getEnv)(),referer:l(),version:o.LMV_VIEWER_VERSION,build_type:o.LMV_BUILD_TYPE};var a={category:"viewer_start",touch:this.environmentInfo.touch,env:this.environmentInfo.env,referer:this.environmentInfo.referer,version:this.environmentInfo.version,build_type:this.environmentInfo.build_type};this.track(a);var s=this;this.interval=setInterval(function(){s.reportRuntimeStats()},6e4)},s.prototype.shutdown=function(){clearInterval(this.interval),this.interval=void 0},s.prototype.track=function(e){this.updateRuntimeStats(e),!Object(r.isOffline)()&&this.sessionId&&this.callback&&(e.timestamp=Date.now(),e.sessionId=this.sessionId,this.callback(e))},s.prototype.updateRuntimeStats=function(e){if(e.hasOwnProperty("aggregate"))switch(e.aggregate){case"count":this.runtimeStats[e.name]>0?this.runtimeStats[e.name]++:this.runtimeStats[e.name]=1,this.runtimeStats._nonempty=!0;break;case"last":this.runtimeStats[e.name]=e.value,this.runtimeStats._nonempty=!0;break;default:this.warn("unknown log aggregate type")}},s.prototype.reportRuntimeStats=function(){this.runtimeStats._nonempty&&(delete this.runtimeStats._nonempty,this.runtimeStats.category="misc_stats",this.track(this.runtimeStats),this.runtimeStats={})},s.prototype.setLevel=function(e){if(this.level!==e){this.level=e;var t=function(){},n=a,i=this;this.debug=e>=n.DEBUG?console.log.bind(console):t,this.log=e>=n.LOG?console.log.bind(console):t,this.info=e>=n.INFO?console.info.bind(console):t,this.warn=e>=n.WARNING?console.warn.bind(console):t,this.error=e>=n.ERROR?function(){if(i.callback){var e=Array.prototype.slice.call(arguments).join(" ");i.callback({category:"error",message:e})}console.error.apply(console,arguments)}:t}};var c=new s;function u(e){c=e}},function(e,t,n){"use strict";var i=e.exports;i.ESCAPE_EVENT="escape",i.PROGRESS_UPDATE_EVENT="progress",i.FULLSCREEN_MODE_EVENT="fullScreenMode",i.NAVIGATION_MODE_CHANGED_EVENT="navmode",i.VIEWER_STATE_RESTORED_EVENT="viewerStateRestored",i.VIEWER_RESIZE_EVENT="viewerResize",i.VIEWER_INITIALIZED="viewerInitialized",i.VIEWER_UNINITIALIZED="viewerUninitialized",i.MODEL_ROOT_LOADED_EVENT="svfLoaded",i.GEOMETRY_LOADED_EVENT="geometryLoaded",i.TEXTURES_LOADED_EVENT="texturesLoaded",i.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded",i.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable",i.OBJECT_TREE_LOAD_PROGRESS_EVENT="propertyDbLoadProgress",i.MODEL_UNLOADED_EVENT="modelUnloaded",i.MODEL_ADDED_EVENT="modelAdded",i.MODEL_REMOVED_EVENT="modelRemoved",i.MODEL_LAYERS_LOADED_EVENT="modelLayersLoaded",i.EXTENSION_LOADED_EVENT="extensionLoaded",i.EXTENSION_UNLOADED_EVENT="extensionUnloaded",i.SELECTION_CHANGED_EVENT="selection",i.AGGREGATE_SELECTION_CHANGED_EVENT="aggregateSelection",i.ISOLATE_EVENT="isolate",i.AGGREGATE_ISOLATION_CHANGED_EVENT="aggregateIsolation",i.HIDE_EVENT="hide",i.SHOW_EVENT="show",i.CAMERA_CHANGE_EVENT="cameraChanged",i.EXPLODE_CHANGE_EVENT="explodeChanged",i.FIT_TO_VIEW_EVENT="fitToView",i.AGGREGATE_FIT_TO_VIEW_EVENT="aggregateFitToView",i.CUTPLANES_CHANGE_EVENT="cutplanesChanged",i.TOOL_CHANGE_EVENT="toolChanged",i.RENDER_OPTION_CHANGED_EVENT="renderOptionChanged",i.FINAL_FRAME_RENDERED_CHANGED_EVENT="finalFrameRenderedChanged",i.RENDER_PRESENTED_EVENT="renderPresented",i.LAYER_VISIBILITY_CHANGED_EVENT="layerVisibility",i.RESET_EVENT="reset",i.PREF_CHANGED_EVENT="PrefChanged",i.PREF_RESET_EVENT="PrefReset",i.RESTORE_DEFAULT_SETTINGS_EVENT="restoreDefaultSettings",i.ANIMATION_READY_EVENT="animationReady",i.CAMERA_TRANSITION_COMPLETED="cameraTransitionCompleted",i.HYPERLINK_EVENT="hyperlink",i.LOAD_GEOMETRY_EVENT="load_geometry",i.LOAD_MISSING_GEOMETRY="loadMissingGeometry",i.FRAGMENTS_LOADED_EVENT="fragmentLoaded",i.GEOMETRY_DOWNLOAD_COMPLETE="geometryDownloadComplete",i.GEOMETRY_DOWNLOAD_COMPLETE_EVENT="geometryDownloadComplete",i.WEBGL_CONTEXT_LOST_EVENT="webglcontextlost",i.CANCEL_LEAFLET_SCREENSHOT="cancelLeafletScreenshot",i.SET_VIEW_EVENT="setView",i.RENDER_FIRST_PIXEL="renderFirstPixel"},function(e,t,n){"use strict";n.r(t),function(e){function i(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:e}n.d(t,"getGlobal",function(){return i}),n.d(t,"isNodeJS",function(){return r}),n.d(t,"isBrowser",function(){return o}),n.d(t,"isIE11",function(){return a}),n.d(t,"launchFullscreen",function(){return s}),n.d(t,"exitFullscreen",function(){return l}),n.d(t,"inFullscreen",function(){return c}),n.d(t,"fullscreenElement",function(){return u}),n.d(t,"isFullscreenAvailable",function(){return h}),n.d(t,"getAndroidVersion",function(){return d}),n.d(t,"isTouchDevice",function(){return f}),n.d(t,"isIOSDevice",function(){return p}),n.d(t,"isAndroidDevice",function(){return m}),n.d(t,"isMobileDevice",function(){return g}),n.d(t,"isSafari",function(){return v}),n.d(t,"isFirefox",function(){return y}),n.d(t,"isChrome",function(){return _}),n.d(t,"isMac",function(){return b}),n.d(t,"isWindows",function(){return x}),n.d(t,"ObjectAssign",function(){return w}),n.d(t,"disableDocumentTouchSafari",function(){return E}),n.d(t,"enableDocumentTouchSafari",function(){return T}),n.d(t,"touchStartToClick",function(){return M});var r=function(){return"undefined"==typeof navigator},o="undefined"!=typeof navigator,a=o&&!!navigator.userAgent.match(/Edge|Trident\/7\./);function s(e,t){e.requestFullscreen?e.requestFullscreen(t):e.mozRequestFullScreen?e.mozRequestFullScreen(t):e.webkitRequestFullscreen?e.webkitRequestFullscreen(t):e.msRequestFullscreen&&e.msRequestFullscreen(t)}function l(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function c(){return"webkitIsFullScreen"in document?!!document.webkitIsFullScreen:"fullscreenElement"in document?!!document.fullscreenElement:"mozFullScreenElement"in document?!!document.mozFullScreenElement:"msFullscreenElement"in document?!!document.msFullscreenElement:!!document.querySelector(".viewer-fill-browser")}function u(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function h(e){return e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen}function d(e){var t=(e=e||navigator.userAgent).match(/Android\s([0-9\.]*)/);return!!t&&t[1]}function f(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0)}function p(){return!!o&&/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())}function m(){return!!o&&-1!==navigator.userAgent.toLowerCase().indexOf("android")}function g(){return!!o&&(p()||m())}function v(){if(!o)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("safari")&&-1===e.indexOf("chrome")}function y(){return!!o&&-1!==navigator.userAgent.toLowerCase().indexOf("firefox")}function _(){return!!o&&-1!==navigator.userAgent.toLowerCase().indexOf("chrome")}function b(){return!!o&&-1!==navigator.userAgent.toLowerCase().indexOf("mac os")}function x(){if(!o)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("win32")||-1!==e.indexOf("windows")}function w(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function A(e){var t=window.hasOwnProperty("pageXOffset")?window.pageXOffset:document.documentElement.scrollLeft,n=window.hasOwnProperty("pageYOffset")?window.pageYOffset:document.documentElement.scrollTop,i=void 0===e.pageX?e.changedTouches[0].pageX:e.pageX,r=void 0===e.pageY?e.changedTouches[0].pageY:e.pageY,o=document.elementFromPoint(i-t,r-n);return!o||"CANVAS"!==o.nodeName||(!!o.getAttribute(!0)||(e.preventDefault(),!1))}function E(){g()&&v()&&(document.documentElement.addEventListener("touchstart",A,!0),document.documentElement.addEventListener("touchmove",A,!0),document.documentElement.addEventListener("touchcanceled",A,!0),document.documentElement.addEventListener("touchend",A,!0))}function T(){g()&&v()&&(document.documentElement.removeEventListener("touchstart",A,!0),document.documentElement.removeEventListener("touchmove",A,!0),document.documentElement.removeEventListener("touchcanceled",A,!0),document.documentElement.removeEventListener("touchend",A,!0))}function M(e){e.target.className.indexOf("fullscreen")>-1||e.target.className.indexOf("webvr")>-1||(e.preventDefault(),e.stopPropagation(),e.target.click())}"undefined"!=typeof window&&a&&function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.CustomEvent.prototype,window.CustomEvent=e}(),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){if(!t||t>this.byteLength?t=this.byteLength:t<0&&(t=this.byteLength+t)<0&&(t=0),e<0&&(e=this.byteLength+e)<0&&(e=0),t<=e)return new ArrayBuffer;for(var n=t-e,i=new Uint8Array(this,e,n),r=new Uint8Array(n),o=0;o<n;o++)r[o]=i[o];return r.buffer}),Math.log2=Math.log2||function(e){return Math.log(e)/Math.LN2},"undefined"!=typeof window&&(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder),function(){var e=i();e.performance||(e.performance=Date)}(),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},String.prototype.repeat=String.prototype.repeat||function(e){if(e<1)return"";for(var t="",n=this.valueOf();e>1;)1&e&&(t+=n),e>>=1,n+=n;return t+n},Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{enumerable:!1,value:function(e,t,n){t=void 0===t?0:t,n=void 0===n?this.length:n;for(var i=t;i<n;++i)this[i]=e}}),Int32Array.prototype.lastIndexOf=Int32Array.prototype.lastIndexOf||function(e,t){return Array.prototype.lastIndexOf.call(this,e,t)},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,value:function(e,t){for(var n=this.length,i=0;i<n;++i){var r=this[i];if(e.call(t,r,i,this))return r}}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n},writable:!0,configurable:!0}),"undefined"==typeof window||!a&&!p()||HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){var i=this;setTimeout(function(){for(var r=atob(i.toDataURL(t,n).split(",")[1]),o=r.length,a=new Uint8Array(o),s=0;s<o;s++)a[s]=r.charCodeAt(s);e(new Blob([a],{type:t||"image/png"}))})}}),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(e,t){if(t=void 0!==t?t:this.length,"[object Array]"===Object.prototype.toString.call(this))return _slice.call(this,e,t);var n,i,r=[],o=this.length,a=e||0;a=a>=0?a:Math.max(0,o+a);var s="number"==typeof t?Math.min(t,o):o;if(t<0&&(s=o+t),(i=s-a)>0)if(r=new Array(i),this.charAt)for(n=0;n<i;n++)r[n]=this.charAt(a+n);else for(n=0;n<i;n++)r[n]=this[a+n];return r})}.call(this,n(159))},function(e,t,n){"use strict";n.r(t),n.d(t,"getEnv",function(){return h}),n.d(t,"setEnv",function(){return d}),n.d(t,"isOffline",function(){return p}),n.d(t,"setOffline",function(){return m}),n.d(t,"setOfflineResourcePrefix",function(){return v}),n.d(t,"getOfflineResourcePrefix",function(){return y}),n.d(t,"endpoint",function(){return _}),n.d(t,"initLoadContext",function(){return b});var i=n(3),r={},o=null;r.ENDPOINT_API_DERIVATIVE_SERVICE_V2="derivativeV2",r.ENDPOINT_API_MODEL_DERIVATIVE_V2="modelDerivativeV2",r.ENDPOINT_API_FLUENT="fluent";var a,s={derivativeV2:{baseURL:"/derivativeservice/v2",itemURL:"/derivativeservice/v2/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn"},derivativeV2_EU:{baseURL:"/derivativeservice/v2/regions/eu",itemURL:"/derivativeservice/v2/regions/eu/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/regions/eu/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/eu/thumbnails/:urn"},modelDerivativeV2:{baseURL:"/modelderivative/v2/",itemURL:"/modelderivative/v2/designdata/:urn/manifest/:derivativeurn",manifestURL:"/modelderivative/v2/designdata/:urn/manifest",thumbnailsURL:"/modelderivative/v2/designdata/:urn/thumbnail"},fluent:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws",cdnWithCredentials:!0}},l="",c=r.ENDPOINT_API_DERIVATIVE_SERVICE_V2,u=!1;function h(){return a}function d(e){a=e}r.HTTP_REQUEST_HEADERS={},r.setEndpointAndApi=function(e,t){l=e,t&&(c=t)},r.getEndpointAndApi=function(){return l+s[c].baseURL},r.getApiEndpoint=function(){return l},r.getApiFlavor=function(){return c},r.getCdnUrl=function(){return o||(l?l+s[c].cdnURL:void 0)},r.getCdnWebSocketEndpoint=function(){return l+(s[c].cdnWS||"")},r.getCdnUsesCredentials=function(){return s[c].cdnWithCredentials},r.setCdnUrl=function(e){o=e},r.getCdnRedirectUrl=function(){var e=s[c].cdnRedirectURL;return e?l+e:null},r.getManifestApi=function(e,t,n){var i=e||l;return t=t||"",i=(i+=s[n=n||c].manifestURL).replace(":urn",t)},r.getItemApi=function(e,t,n){var i=n||c,o=(e||l)+s[i].itemURL;t=t||"";var a=decodeURIComponent(t);if(-1!==o.indexOf(":urn")){var u=a.split("/")[0]||"";u=(u=u.split(":"))[u.length-1]||"",o=o.replace(":urn",u)}return i===r.ENDPOINT_API_MODEL_DERIVATIVE_V2&&(t=encodeURIComponent(a)),o=o.replace(":derivativeurn",t)},r.getThumbnailApi=function(e,t,n){return((e||l)+s[n||c].thumbnailsURL).replace(":urn",t||"")},r.getUseCredentials=function(){return u},r.getDomainParam=function(){return this.getUseCredentials()&&!Object(i.isNodeJS)()?"domain="+encodeURIComponent(window.location.origin):""},r.setUseCredentials=function(e){u=e},r.initLoadContext=function(e){for(var t in(e=e||{}).auth=this.getUseCredentials(),e.endpoint||(e.endpoint=this.getApiEndpoint()),e.api||(e.api=this.getApiFlavor()),e.headers||(e.headers={}),this.HTTP_REQUEST_HEADERS)e.headers[t]=this.HTTP_REQUEST_HEADERS[t];var n=this.getDomainParam();return n&&(e.queryParams?e.queryParams+="&"+n:e.queryParams=n),e.otg_cdn=o||this.getCdnUrl(),e.otg_ws=this.getCdnWebSocketEndpoint(),e.otg_cdn_with_credentials=this.getCdnUsesCredentials(),e};var f=!1;function p(){return f}function m(e){f=e}var g="";function v(e){g=e}function y(){return g}var _=r,b=r.initLoadContext.bind(r)},function(e,t,n){"use strict";n.r(t),n.d(t,"MeshFlags",function(){return i});var i={MESH_VISIBLE:1,MESH_HIGHLIGHTED:2,MESH_HIDE:4,MESH_ISLINE:8,MESH_MOVED:16,MESH_RENDERFLAG:32,MESH_NOTLOADED:64,MESH_ISPOINT:128,MESH_ISWIDELINE:256,MESH_TRAVERSED:512,MESH_DRAWN:1024}},function(e,t,n){"use strict";n.r(t),n.d(t,"SnapType",function(){return i});var i={SNAP_VERTEX:0,SNAP_MIDPOINT:1,SNAP_CIRCLE_CENTER:2,SNAP_EDGE:3,SNAP_FACE:4,SNAP_CIRCULARARC:5,SNAP_CURVEDEDGE:6,SNAP_CURVEDFACE:7}},function(e,t,n){"use strict";n.r(t),n.d(t,"ErrorCodes",function(){return i}),n.d(t,"errorCodeString",function(){return r}),n.d(t,"getErrorCode",function(){return o});var i={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,BAD_DATA_MODEL_IS_EMPTY:11,RTC_ERROR:12,UNSUPORTED_FILE_EXTENSION:13,VIEWER_INTERNAL_ERROR:14,WEBGL_LOST_CONTEXT:15};function r(e){return"ErrorCode:"+e+"."}function o(e){return 403===e||401===e?i.NETWORK_ACCESS_DENIED:404===e?i.NETWORK_FILE_NOT_FOUND:e>=500?i.NETWORK_SERVER_ERROR:i.NETWORK_UNHANDLED_RESPONSE_CODE}},function(e,t,n){"use strict";n.r(t),n.d(t,"Button",function(){return s});var i,r,o=n(19),a=n(3);function s(e,t){o.Control.call(this,e,t);var n=this;this._state=s.State.INACTIVE,this.icon=document.createElement("div"),this.icon.classList.add("adsk-button-icon"),this.container.appendChild(this.icon),this.container.addEventListener("click",function(e){n.getState()!==s.State.DISABLED&&(n.dispatchEvent(s.Event.CLICK),n.onClick&&n.onClick(e)),e.stopPropagation()}),Object(a.isTouchDevice)()?this.container.addEventListener("touchstart",a.touchStartToClick):(this.container.addEventListener("mouseover",function(e){n.onMouseOver(e)}),this.container.addEventListener("mouseout",function(e){n.onMouseOut(e)})),this.addClass("adsk-button"),this.addClass(s.StateToClassMap[this._state])}s.Event={VISIBILITY_CHANGED:o.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:o.Control.Event.COLLAPSED_CHANGED,STATE_CHANGED:"Button.StateChanged",CLICK:"click"},s.State={ACTIVE:0,INACTIVE:1,DISABLED:2},s.StateToClassMap=(i=s.State,(r={})[i.ACTIVE]="active",r[i.INACTIVE]="inactive",r[i.DISABLED]="disabled",r),s.prototype=Object.create(o.Control.prototype),s.prototype.constructor=s,s.prototype.setState=function(e){if(e===this._state)return!1;this.removeClass(s.StateToClassMap[this._state]),this.addClass(s.StateToClassMap[e]),this._state=e;var t={type:s.Event.STATE_CHANGED,state:e};return this.dispatchEvent(t),!0},s.prototype.setIcon=function(e){this.iconClass&&this.icon.classList.remove(this.iconClass),this.iconClass=e,this.icon.classList.add(e)},s.prototype.getState=function(){return this._state},s.prototype.onClick=function(e){},s.prototype.onMouseOver=function(e){},s.prototype.onMouseOut=function(e){}},function(e,t,n){"use strict";n.r(t),n.d(t,"i18n",function(){return N});var i=n(11),r=n(3);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=Object(r.getGlobal)(),s=null;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var i=0;if(arguments.length>0&&((i=Number(arguments[1]))!=i?i=0:0!=i&&i!=1/0&&i!=-1/0&&(i=(i>0||-1)*Math.floor(Math.abs(i)))),i>=n)return-1;for(var r=i>=0?i:Math.max(n-Math.abs(i),0);r<n;r++)if(r in t&&t[r]===e)return r;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var i=n;arguments.length>1&&((i=Number(arguments[1]))!=i?i=0:0!=i&&i!=1/0&&i!=-1/0&&(i=(i>0||-1)*Math.floor(Math.abs(i))));for(var r=i>=0?Math.min(i,n-1):n-Math.abs(i);r>=0;r--)if(r in t&&t[r]===e)return r;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var l,c=a,u=c.jQuery||c.Zepto,h={},d=0,f=[],p=!1,m={lng:void 0,load:"current",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:["dev"],fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:!0,fallbackOnEmpty:!1,fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"res/locales/__lng__/__ns__.json",resPostPath:"res/locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:void 0,useLocalStorage:!1,localStorageExpirationTime:6048e5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:!1,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:void 0,useCookie:!0,cookieName:"i18next",cookieDomain:void 0,objectTreeKeyHandler:void 0,postProcess:void 0,parseMissingKey:void 0,shortcutFunction:"sprintf"};var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};var v={create:function(e,t,n,i){var r;if(n){var o=new Date;o.setTime(o.getTime()+60*n*1e3),r="; expires="+o.toGMTString()}else r="";i=i?"domain="+i+";":"",document.cookie=e+"="+t+r+";"+i+"path=/"},read:function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "==r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null},remove:function(e){this.create(e,"",-1)}},y={extend:u?u.extend:function(e,t){if(!t||"function"==typeof t)return e;for(var n in t)e[n]=t[n];return e},each:u?u.each:function(e,t,n){var i,r=0,o=e.length,a=void 0===o||"[object Array]"!==Object.prototype.toString.apply(e)||"function"==typeof e;if(n)if(a){for(i in e)if(!1===t.apply(e[i],n))break}else for(;r<o&&!1!==t.apply(e[r++],n););else if(a){for(i in e)if(!1===t.call(e[i],i,e[i]))break}else for(;r<o&&!1!==t.call(e[r],r,e[r++]););return e},ajax:u?u.ajax:"undefined"!=typeof document?function(e){var t=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}(e);var n,i,r,o,a,s,l,c="",u=0;do{o=(n=e.charCodeAt(u++))>>2,a=(3&n)<<4|(i=e.charCodeAt(u++))>>4,s=(15&i)<<2|(r=e.charCodeAt(u++))>>6,l=63&r,isNaN(i)?s=l=64:isNaN(r)&&(l=64),c+=t.charAt(o)+t.charAt(a)+t.charAt(s)+t.charAt(l),n=i=r="",o=a=s=l=""}while(u<e.length);return c},n=function e(t,n,i,r){"function"==typeof i&&(r=i,i={}),i.doNotCache=i.doNotCache||!1,i.data=i.data||{},i.headers=i.headers||{},i.jsonp=i.jsonp||!1,i.async=void 0===i.async||i.async;var o,a=function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}return e}({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},e.headers,i.headers);if(o="application/json"===a["content-type"]?JSON.stringify(i.data):function(e){if("string"==typeof e)return e;var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(i.data),"GET"===t){var s=[];if(o&&(s.push(o),o=null),i.doNotCache&&s.push("_="+(new Date).getTime()),i.jsonp&&(s.push("callback="+i.jsonp),s.push("jsonp="+i.jsonp)),(s=s.join("&")).length>1&&(n.indexOf("?")>-1?n+="&"+s:n+="?"+s),i.jsonp){var l=document.getElementsByTagName("head")[0],c=document.createElement("script");return c.type="text/javascript",c.src=n,void l.appendChild(c)}}!function(e){if(window.XMLHttpRequest)return e(null,new XMLHttpRequest);if(window.ActiveXObject)try{return e(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(t){return e(null,new ActiveXObject("Microsoft.XMLHTTP"))}e(new Error)}(function(e,s){if(e)return r(e);for(var l in s.open(t,n,i.async),a)a.hasOwnProperty(l)&&s.setRequestHeader(l,a[l]);s.onreadystatechange=function(){if(4===s.readyState){var e=s.responseText||"";if(!r)return;r(s.status,e)}},s.send(o)})};({authBasic:function(e,i){n.headers.Authorization="Basic "+t(e+":"+i)},connect:function(e,t,i){return n("CONNECT",e,t,i)},del:function(e,t,i){return n("DELETE",e,t,i)},get:function(e,t,i){return n("GET",e,t,i)},head:function(e,t,i){return n("HEAD",e,t,i)},headers:function(e){n.headers=e||{}},isAllowed:function(e,t,n){this.options(e,function(e,i){n(-1!==i.text().indexOf(t))})},options:function(e,t,i){return n("OPTIONS",e,t,i)},patch:function(e,t,i){return n("PATCH",e,t,i)},post:function(e,t,i){return n("POST",e,t,i)},put:function(e,t,i){return n("PUT",e,t,i)},trace:function(e,t,i){return n("TRACE",e,t,i)}})[e.type?e.type.toLowerCase():"get"](e.url,e,function(t,n){200===t?e.success(n,t,null):e.error(n,t,null)})}:function(){},cookie:"undefined"!=typeof document?v:{create:function(e,t,n,i){},read:function(e){return null},remove:function(e){}},detectLanguage:function(){var e,t=[];"undefined"!=typeof window&&(!function(){for(var e=window.location.search.substring(1),n=e.split("&"),i=0;i<n.length;i++){var r=n[i].indexOf("=");if(r>0){var o=n[i].substring(0,r),a=n[i].substring(r+1);t[o]=a}}}(),t[m.detectLngQS]&&(e=t[m.detectLngQS]));if(!e&&"undefined"!=typeof document&&m.useCookie){var n=y.cookie.read(m.cookieName);n&&(e=n)}e||"undefined"==typeof navigator||(e=navigator.language?navigator.language:navigator.userLanguage);return e},escape:function(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,function(e){return g[e]}):e},log:function(e){m.debug&&"undefined"!=typeof console&&console.log(e)},toLanguages:function(e){var t=[];if("string"==typeof e&&e.indexOf("-")>-1){var n=e.split("-");e=m.lowerCaseLng?n[0].toLowerCase()+"-"+n[1].toLowerCase():n[0].toLowerCase()+"-"+n[1].toUpperCase(),"unspecific"!==m.load&&t.push(e),"current"!==m.load&&t.push(n[0])}else t.push(e);for(var i=0;i<m.fallbackLng.length;i++)-1===t.indexOf(m.fallbackLng[i])&&m.fallbackLng[i]&&t.push(m.fallbackLng[i]);return t},regexEscape:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};function _(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},y.extend(m,e),delete m.fixLng,"string"==typeof m.ns&&(m.ns={namespaces:[m.ns],defaultNs:m.ns}),"string"==typeof m.fallbackNS&&(m.fallbackNS=[m.fallbackNS]),"string"!=typeof m.fallbackLng&&"boolean"!=typeof m.fallbackLng||(m.fallbackLng=[m.fallbackLng]),m.interpolationPrefixEscaped=y.regexEscape(m.interpolationPrefix),m.interpolationSuffixEscaped=y.regexEscape(m.interpolationSuffix),m.lng||(m.lng=y.detectLanguage()),m.lng?m.useCookie&&y.cookie.create(m.cookieName,m.lng,m.cookieExpirationTime,m.cookieDomain):(m.lng=m.fallbackLng[0],m.useCookie&&y.cookie.remove(m.cookieName)),f=y.toLanguages(m.lng),l=f[0],y.log("currentLng set to: "+l);var n=T;if(e.fixLng&&((n=function(e,t){return(t=t||{}).lng=t.lng||n.lng,T(e,t)}).lng=l),L.setCurrentLng(l),m.resStore)return y.each(m.resStore,function(e,t){y.each(t,function(t,n){b(e,t,n)})}),p=!0,void(t&&t(n));var i=y.toLanguages(m.lng);"string"==typeof m.preload&&(m.preload=[m.preload]);for(var r=0,o=m.preload.length;r<o;r++)for(var a=y.toLanguages(m.preload[r]),s=0,c=a.length;s<c;s++)i.indexOf(a[s])<0&&i.push(a[s]);Autodesk.Viewing.i18n.sync.load(i,m,function(e,i){y.each(i,function(e,t){y.each(t,function(t,n){b(e,t,n)})}),p=!0,t&&t(n)})}function b(e,t,n){"string"!=typeof t?(n=t,t=m.ns.defaultNs):m.ns.namespaces.indexOf(t)<0&&m.ns.namespaces.push(t),h[e]=h[e]||{},h[e][t]=h[e][t]||{},y.extend(h[e][t],n)}function x(e,t){var n={dynamicLoad:m.dynamicLoad,resGetPath:m.resGetPath,getAsync:m.getAsync,customLoad:m.customLoad,ns:{namespaces:e,defaultNs:""}},i=y.toLanguages(m.lng);"string"==typeof m.preload&&(m.preload=[m.preload]);for(var r=0,o=m.preload.length;r<o;r++)for(var a=y.toLanguages(m.preload[r]),s=0,l=a.length;s<l;s++)i.indexOf(a[s])<0&&i.push(a[s]);for(var c=[],u=0,d=i.length;u<d;u++){var f=!1,p=h[i[u]];if(p)for(var g=0,v=e.length;g<v;g++)p[e[g]]||(f=!0);else f=!0;f&&c.push(i[u])}c.length?P._fetch(c,n,function(n,i){var r=e.length*c.length;y.each(e,function(e,n){m.ns.namespaces.indexOf(n)<0&&m.ns.namespaces.push(n),y.each(c,function(e,o){h[o]=h[o]||{},h[o][n]=i[o][n],0===--r&&t&&(m.useLocalStorage&&P._storeLocal(h),t())})})}):t&&t()}function w(e,t,n,i){if(!e)return e;if(i=i||t,e.indexOf(i.interpolationPrefix||m.interpolationPrefix)<0)return e;var r=i.interpolationPrefix?y.regexEscape(i.interpolationPrefix):m.interpolationPrefixEscaped,a=i.interpolationSuffix?y.regexEscape(i.interpolationSuffix):m.interpolationSuffixEscaped,s="HTML"+a;return y.each(t,function(t,l){var c=n?n+m.keyseparator+t:t;e="object"===o(l)&&null!==l?w(e,l,c,i):i.escapeInterpolation||m.escapeInterpolation?(e=e.replace(new RegExp([r,c,s].join(""),"g"),l)).replace(new RegExp([r,c,a].join(""),"g"),y.escape(l)):e.replace(new RegExp([r,c,a].join(""),"g"),l)}),e}function A(e,t){var n=y.extend({},t);for(delete n.postProcess;-1!=e.indexOf(m.reusePrefix)&&!(++d>m.maxRecursion);){var i=e.lastIndexOf(m.reusePrefix),r=e.indexOf(m.reuseSuffix,i)+m.reuseSuffix.length,o=e.substring(i,r),a=o.replace(m.reusePrefix,"").replace(m.reuseSuffix,"");if(-1!=a.indexOf(",")){var s=a.indexOf(",");if(-1!=a.indexOf("{",s)&&-1!=a.indexOf("}",s)){var l=a.indexOf("{",s),c=a.indexOf("}",l)+"}".length;try{n=y.extend(n,JSON.parse(a.substring(l,c))),a=a.substring(0,s)}catch(e){}}}var u=S(a,n);e=e.replace(o,u)}return e}function E(e,t){var n=M(e,t=t||{}),i=C(e,t);return void 0!==i||i===n}function T(e,t){if(t=t||{},!p){y.log("i18next not finished initialization. you might have called t function before loading resources finished.");var n=e.indexOf(":");n<0?n=0:n++;var i=t.defaultValue||e.substr(n);return i&&(i=w(i,t)),i}return d=0,S.apply(null,arguments)}function M(e,t){return void 0!==t.defaultValue?t.defaultValue:e}function S(e,t){if(t&&"object"!==o(t)?"sprintf"===m.shortcutFunction?t=function(){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);return{postProcess:"sprintf",sprintf:e}}.apply(null,arguments):"defaultValue"===m.shortcutFunction&&(t={defaultValue:t}):t=t||{},null==e)return"";"string"==typeof e&&(e=[e]);var n=e[0];if(e.length>1)for(var i=0;i<e.length&&!E(n=e[i],t);i++);var r,a=M(n,t),l=C(n,t),c=t.lng?y.toLanguages(t.lng):f,u=t.ns||m.ns.defaultNs;n.indexOf(m.nsseparator)>-1&&(u=(r=n.split(m.nsseparator))[0],n=r[1]),void 0===l&&m.sendMissing&&(t.lng?P.postMissing(c[0],u,n,a,c):P.postMissing(m.lng,u,n,a,c));var h=t.postProcess||m.postProcess;if(void 0!==l&&h&&R[h]&&(l=R[h](l,n,t)),s&&void 0!==l)return s;var d=a;if(a.indexOf(m.nsseparator)>-1&&(d=(r=a.split(m.nsseparator))[1]),d===n&&m.parseMissingKey&&(a=m.parseMissingKey(a)),void 0===l&&(a=A(a=w(a,t),t),h&&R[h])){var p=M(n,t);l=R[h](p,n,t)}return void 0!==l?l:a}function C(e,t){var n,i,r=M(e,t=t||{}),o=f;if(!h)return r;if("cimode"===o[0].toLowerCase())return r;if(t.lng&&(o=y.toLanguages(t.lng),!h[o[0]])){var a=m.getAsync;m.getAsync=!1,P.load(o,m,function(e,t){y.extend(h,t),m.getAsync=a})}var s,l=t.ns||m.ns.defaultNs;if(e.indexOf(m.nsseparator)>-1){var c=e.split(m.nsseparator);l=c[0],e=c[1]}if(function(e){return e.context&&("string"==typeof e.context||"number"==typeof e.context)}(t)&&(delete(n=y.extend({},t)).context,n.defaultValue=m.contextNotFound,(i=T(l+m.nsseparator+e+"_"+t.context,n))!=m.contextNotFound))return w(i,{context:t.context});if(function(e){return void 0!==e.count&&"string"!=typeof e.count&&1!==e.count}(t)){delete(n=y.extend({},t)).count,n.defaultValue=m.pluralNotFound;var u=l+m.nsseparator+e+m.pluralSuffix,d=L.get(o[0],t.count);if(d>=0?u=u+"_"+d:1===d&&(u=l+m.nsseparator+e),(i=T(u,n))!=m.pluralNotFound)return w(i,{count:t.count,interpolationPrefix:t.interpolationPrefix,interpolationSuffix:t.interpolationSuffix})}for(var p=e.split(m.keyseparator),g=0,v=o.length;g<v&&void 0===s;g++){for(var _=o[g],b=0,x=h[_]&&h[_][l];p[b];)x=x&&x[p[b]],b++;if(void 0!==x){var E=Object.prototype.toString.apply(x);if("string"==typeof x)x=A(x=w(x,t),t);else if("[object Array]"!==E||m.returnObjectTrees||t.returnObjectTrees){if(null===x&&!0===m.fallbackOnNull)x=void 0;else if(null!==x)if(m.returnObjectTrees||t.returnObjectTrees){if("[object Number]"!==E&&"[object Function]"!==E&&"[object RegExp]"!==E){var R="[object Array]"===E?[]:{};y.each(x,function(n){R[n]=S(l+m.nsseparator+e+m.keyseparator+n,t)}),x=R}}else m.objectTreeKeyHandler&&"function"==typeof m.objectTreeKeyHandler?x=m.objectTreeKeyHandler(e,x,_,l,t):(x="key '"+l+":"+e+" ("+_+")' returned an object instead of string.",y.log(x))}else x=A(x=w(x=x.join("\n"),t),t);"string"==typeof x&&""===x.trim()&&!0===m.fallbackOnEmpty&&(x=void 0),s=x}}if(void 0===s&&!t.isFallbackLookup&&(!0===m.fallbackToDefaultNS||m.fallbackNS&&m.fallbackNS.length>0))if(t.isFallbackLookup=!0,m.fallbackNS.length)for(var D=0,I=m.fallbackNS.length;D<I;D++){if(s=C(m.fallbackNS[D]+m.nsseparator+e,t))if((s.indexOf(m.nsseparator)>-1?s.split(m.nsseparator)[1]:s)!==(r.indexOf(m.nsseparator)>-1?r.split(m.nsseparator)[1]:r))break}else s=C(e,t);return s}y.applyReplacement=w;var P={load:function(e,t,n){t.useLocalStorage?P._loadLocal(e,t,function(i,r){for(var o=[],a=0,s=e.length;a<s;a++)r[e[a]]||o.push(e[a]);o.length>0?P._fetch(o,t,function(e,t){y.extend(r,t),P._storeLocal(t),n(null,r)}):n(null,r)}):P._fetch(e,t,function(e,t){n(null,t)})},_loadLocal:function(e,t,n){var i={},r=(new Date).getTime();if(window.localStorage){var o=e.length;y.each(e,function(e,a){var s=window.localStorage.getItem("res_"+a);s&&(s=JSON.parse(s)).i18nStamp&&s.i18nStamp+t.localStorageExpirationTime>r&&(i[a]=s),0===--o&&n(null,i)})}},_storeLocal:function(e){if(window.localStorage)for(var t in e)e[t].i18nStamp=(new Date).getTime(),window.localStorage.setItem("res_"+t,JSON.stringify(e[t]))},_fetch:function(e,t,n){var r=t.ns,o={};if(t.dynamicLoad){var a=function(e,t){n(null,t)};if("function"==typeof t.customLoad)t.customLoad(e,r.namespaces,t,a);else{var s=w(t.resGetPath,{lng:e.join("+"),ns:r.namespaces.join("+")});s=Object(i.getResourceUrl)(s),y.ajax({url:s,success:function(e,t,n){y.log("loaded: "+s),a(0,e.json())},error:function(e,t,n){y.log("failed loading: "+s),a()},dataType:"text",async:t.getAsync})}}else{var l,c=r.namespaces.length*e.length;y.each(r.namespaces,function(i,r){y.each(e,function(e,i){var a=function(e,t){e&&(l=l||[]).push(e),o[i]=o[i]||{},o[i][r]=t,0===--c&&n(l,o)};"function"==typeof t.customLoad?t.customLoad(i,r,t,a):P._fetchOne(i,r,t,a)})})}},_fetchOne:function(e,t,n,r){var o=w(n.resGetPath,{lng:e,ns:t});o=Object(i.getResourceUrl)(o),y.ajax({url:o,success:function(e,t,n){y.log("loaded: "+o);var i=e;r(null,JSON.parse(i))},error:function(e,t,n){if(t&&200==t||e&&e.status&&200==e.status)y.log("There is a typo in: "+o);else if(t&&404==t||e&&e.status&&404==e.status)y.log("Does not exist: "+o);else{var i=t||(e&&e.status?e.status:null);y.log(i+" when loading "+o)}r(n,{})},dataType:"text",async:n.getAsync})},postMissing:function(e,t,n,i,r){var o={};o[n]=i;var a=[];if("fallback"===m.sendMissingTo&&!1!==m.fallbackLng[0])for(var s=0;s<m.fallbackLng.length;s++)a.push({lng:m.fallbackLng[s],url:w(m.resPostPath,{lng:m.fallbackLng[s],ns:t})});else if("current"===m.sendMissingTo||"fallback"===m.sendMissingTo&&!1===m.fallbackLng[0])a.push({lng:e,url:w(m.resPostPath,{lng:e,ns:t})});else if("all"===m.sendMissingTo){s=0;for(var l=r.length;s<l;s++)a.push({lng:r[s],url:w(m.resPostPath,{lng:r[s],ns:t})})}for(var c=0,u=a.length;c<u;c++){var d=a[c];y.ajax({url:d.url,type:m.sendType,data:o,success:function(e,r,o){y.log("posted missing key '"+n+"' to: "+d.url);for(var a=n.split("."),s=0,l=h[d.lng][t];a[s];)l=s===a.length-1?l[a[s]]=i:l[a[s]]=l[a[s]]||{},s++},error:function(e,t,i){y.log("failed posting missing key '"+n+"' to: "+d.url)},dataType:"json",async:m.postAsync})}}},L={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(e){return Number(e>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ak:{name:"Akan",numbers:[1,2],plurals:function(e){return Number(e>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(e){return Number(e>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(e){return Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ay:{name:"AymarÃ¡",numbers:[1],plurals:function(e){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(e){return Number(1!=e)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bo:{name:"Tibetan",numbers:[1],plurals:function(e){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(e){return Number(e>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},cgg:{name:"Chiga",numbers:[1],plurals:function(e){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},de:{name:"German",numbers:[1,2],plurals:function(e){return Number(1!=e)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(e){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(e){return Number(1!=e)}},en:{name:"English",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es:{name:"Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},et:{name:"Estonian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eu:{name:"Basque",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fa:{name:"Persian",numbers:[1],plurals:function(e){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(e){return Number(e>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fr:{name:"French",numbers:[1,2],plurals:function(e){return Number(e>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gun:{name:"Gun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(e){return Number(1!=e)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(e){return Number(1!=e)}},id:{name:"Indonesian",numbers:[1],plurals:function(e){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(e){return Number(e%10!=1||e%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ja:{name:"Japanese",numbers:[1],plurals:function(e){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(e){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(e){return Number(0!==e)}},ka:{name:"Georgian",numbers:[1],plurals:function(e){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(e){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(e){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ko:{name:"Korean",numbers:[1],plurals:function(e){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(e){return Number(1==e?0:2==e?1:3==e?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(e){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(e){return Number(e>1)}},lo:{name:"Lao",numbers:[1],plurals:function(e){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[1,2,0],plurals:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(e){return Number(e>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(e){return Number(e>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(e){return Number(e>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(e){return Number(1==e||e%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(e){return Number(1==e?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ms:{name:"Malay",numbers:[1],plurals:function(e){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(e){return Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(e){return Number(1!=e)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(e){return Number(1!=e)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(e){return Number(e>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(e){return Number(1!=e)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(e){return Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(e){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(e){return Number(1!=e)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(e){return Number(1!=e)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},son:{name:"Songhay",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(e){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(e){return Number(1!=e)}},te:{name:"Telugu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(e){return Number(e>1)}},th:{name:"Thai",numbers:[1],plurals:function(e){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(e){return Number(e>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(e){return Number(e>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(e){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(e){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(e){return Number(e>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(e){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(e){return Number(e>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(e){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(e){return Number(1!=e)}},zh:{name:"Chinese",numbers:[1],plurals:function(e){return 0}}},addRule:function(e,t){L.rules[e]=t},setCurrentLng:function(e){if(!L.currentRule||L.currentRule.lng!==e){var t=e.split("-");L.currentRule={lng:e,rule:L.rules[t[0]]}}},get:function(e,t){return function(t,n){var i;if(i=L.currentRule&&L.currentRule.lng===e?L.currentRule.rule:L.rules[t]){var r=i.plurals(n),o=i.numbers[r];return 2===i.numbers.length&&1===i.numbers[0]&&(2===o?o=-1:1===o&&(o=1)),o}return 1===n?"1":"-1"}(e.split("-")[0],t)}},R={},D=function(e,t){R[e]=t},I=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function e(){return e.cache.hasOwnProperty(arguments[0])||(e.cache[arguments[0]]=e.parse(arguments[0])),e.format.call(null,e.cache[arguments[0]],arguments)};return n.format=function(n,i){var r,o,a,s,l,c,u,h=1,d=n.length,f="",p=[];for(o=0;o<d;o++)if("string"===(f=e(n[o])))p.push(n[o]);else if("array"===f){if((s=n[o])[2])for(r=i[h],a=0;a<s[2].length;a++){if(!r.hasOwnProperty(s[2][a]))throw I('[sprintf] property "%s" does not exist',s[2][a]);r=r[s[2][a]]}else r=s[1]?i[s[1]]:i[h++];if(/[^s]/.test(s[8])&&"number"!=e(r))throw I("[sprintf] expecting number but found %s",e(r));switch(s[8]){case"b":r=r.toString(2);break;case"c":r=String.fromCharCode(r);break;case"d":r=parseInt(r,10);break;case"e":r=s[7]?r.toExponential(s[7]):r.toExponential();break;case"f":r=s[7]?parseFloat(r).toFixed(s[7]):parseFloat(r);break;case"o":r=r.toString(8);break;case"s":r=(r=String(r))&&s[7]?r.substring(0,s[7]):r;break;case"u":r=Math.abs(r);break;case"x":r=r.toString(16);break;case"X":r=r.toString(16).toUpperCase()}r=/[def]/.test(s[8])&&s[3]&&r>=0?"+"+r:r,c=s[4]?"0"==s[4]?"0":s[4].charAt(1):" ",u=s[6]-String(r).length,l=s[6]?t(c,u):"",p.push(s[5]?r+l:l+r)}return p.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],i=[],r=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))i.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))i.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(n[2]){r|=1;var o=[],a=n[2],s=[];if(null===(s=/^([a-z_][a-z_\d]*)/i.exec(a)))throw"[sprintf] huh?";for(o.push(s[1]);""!==(a=a.substring(s[0].length));)if(null!==(s=/^\.([a-z_][a-z_\d]*)/i.exec(a)))o.push(s[1]);else{if(null===(s=/^\[(\d+)\]/.exec(a)))throw"[sprintf] huh?";o.push(s[1])}n[2]=o}else r|=2;if(3===r)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";i.push(n)}t=t.substring(n[0].length)}return i},n}();D("sprintf",function(e,t,n){return n.sprintf?"[object Array]"===Object.prototype.toString.apply(n.sprintf)?(i=e,(r=n.sprintf).unshift(i),I.apply(null,r)):"object"===o(n.sprintf)?I(e,n.sprintf):e:e;var i,r});var O=function(e){var t=e||document;Array.prototype.forEach.call(t.querySelectorAll("[data-i18n]"),function(e){var t=e.getAttribute("data-i18n"),n=[null,t],i=n[0],r=n[1],o=T(r);o?i?e.setAttribute(i,o):e.placeholder?e.placeholder=o:e.textContent=o:i?e.setAttribute(i,r):e.textContent=r})},N={init:_,setLng:function(e,t,n){return"function"==typeof t?(n=t,t={}):t||(t={}),t.lng=e,_(t,n)},preload:function(e,t){"string"==typeof e&&(e=[e]);for(var n=0,i=e.length;n<i;n++)m.preload.indexOf(e[n])<0&&m.preload.push(e[n]);return _(t)},addResourceBundle:b,removeResourceBundle:function(e,t){"string"!=typeof t&&(t=m.ns.defaultNs),h[e]=h[e]||{},h[e][t]={}},loadNamespace:function(e,t){x([e],t)},loadNamespaces:x,localize:O,setDefaultNamespace:function(e){m.ns.defaultNs=e},t:T,translate:T,exists:E,detectLanguage:y.detectLanguage,pluralExtensions:L,sync:P,functions:y,lng:function(){return l},addPostProcessor:D,options:m,setDebugLocString:function(){s="aaaa",O()},clearDebugLocString:function(){s=null,O()}}},function(e,t,n){"use strict";n.r(t),n.d(t,"LmvVector3",function(){return s});var i,r,o,a,s=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0};s.prototype={constructor:s,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i+r[12],this.y=r[1]*t+r[5]*n+r[9]*i+r[13],this.z=r[2]*t+r[6]*n+r[10]*i+r[14],this},applyProjection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,c=s*n+a*t-r*i,u=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=l*s+h*-r+c*-a-u*-o,this.y=c*s+h*-o+u*-r-l*-a,this.z=u*s+h*-a+l*-o-c*-r,this},transformDirection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(e,t){return void 0===o&&(o=new s,a=new s),o.set(e,e,e),a.set(t,t,t),this.clamp(o,a)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-n*e.z,this.z=n*e.y-i*e.x,this},crossVectors:function(e,t){var n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this},projectOnVector:function(e){return void 0===i&&(i=new s),i.copy(e).normalize(),r=this.dot(i),this.copy(i).multiplyScalar(r)},projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new s),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new s),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=i,this},setFromMatrixColumn:function(e,t){var n=4*e,i=t.elements;return this.x=i[n],this.y=i[n+1],this.z=i[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}}},function(e,t,n){"use strict";n.r(t),n.d(t,"getScript",function(){return o}),n.d(t,"injectCSS",function(){return a}),n.d(t,"getHtmlTemplate",function(){return s}),n.d(t,"isExperimentalFlagEnabled",function(){return l}),n.d(t,"getResourceUrl",function(){return c}),n.d(t,"loadDependency",function(){return u}),n.d(t,"getParameterByName",function(){return h}),n.d(t,"getParameterByNameFromPath",function(){return d}),n.d(t,"stringToDOM",function(){return f});var i=n(3),r=Object(i.getGlobal)();function o(e){e=e.toLowerCase();var t=document.getElementsByTagName("SCRIPT");if(t&&t.length>0)for(var n=0;n<t.length;++n)if(t[n].src&&-1!==t[n].src.toLowerCase().indexOf(e))return t[n];return null}function a(e,t,n){for(var i=e.indexOf("://")>0?e:c(e),r=document.getElementsByTagName("link"),o=0,a=r.length;o<a;o++)if(r[o].href===i)return void(t&&t());var s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),s.setAttribute("href",i),t&&(s.onload=t),n&&(s.onerror=n),document.head.appendChild(s)}function s(e,t){var n=e.indexOf("://")>0?e:c(e),i=new XMLHttpRequest;function r(e){t(e,null)}i.onload=function(e){var n=e.currentTarget.responseText;t(null,n)},i.onerror=r,i.ontimeout=r,i.open("GET",n,!0),i.send()}function l(e,t){return!(!t||!Array.isArray(t.experimental))&&-1!==t.experimental.indexOf(e)}function c(e){return r.LMV_RESOURCE_ROOT+e}function u(e,t,n,i,r){if(void 0===window[e]){var o=document.createElement("SCRIPT");o.src=t.indexOf("://")>0?t:c(t);var a=function(){o.onerror=null,o.onload=null};o.onload=function(){a(),n&&n()},o.onerror=function(){a(),i&&i()},document.head.appendChild(o)}else n&&n()}function h(e){return"undefined"==typeof window?"":d(e,window.location.href)}function d(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function f(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}r.LOCALIZATION_REL_PATH="",r.LMV_VIEWER_VERSION="6.4.2",r.LMV_VIEWER_PATCH="",r.LMV_BUILD_TYPE="Production",r.LMV_RESOURCE_ROOT="",r.LMV_THIRD_PARTY_COOKIE=!Object(i.isNodeJS)()&&void 0,"v"===r.LMV_VIEWER_VERSION.charAt(0)&&(r.LMV_VIEWER_VERSION=r.LMV_VIEWER_VERSION.substr(1))},function(e,t,n){"use strict";n.r(t),n.d(t,"ViewingService",function(){return c}),n.d(t,"pathToURL",function(){return d}),n.d(t,"textToArrayBuffer",function(){return f});var i=n(1),r=n(7),o=n(42),a=n(4),s=n(3),l=n(107),c={},u=!1;function h(e){var t=e.split("/");if(0==t.length)return e;for(var n=[],i=0;i<t.length;++i){var r=t[i];"."!==r&&(".."===r&&n.length?n.pop():n.push(r))}return 0==n.length?"":n.join("/")}function d(e,t){if(-1!==e.indexOf("://")||0===e.indexOf("urn:"))return e;if(t)return t+e;if("undefined"==typeof window)return e;var n=window.location.pathname,i=n.lastIndexOf("/");return n=n.substr(0,i+1),window.location.protocol+"//"+window.location.host+n+e}function f(e,t){for(var n=e.length-t,i=new ArrayBuffer(n),r=new Uint8Array(i,0),o=0,a=t;o<n;o++,a++)r[o]=255&e.charCodeAt(a);return r}function p(e,t){return-1===t.indexOf("file://")&&(-1!==t.indexOf("://")||(!!e||void 0))}if(c.simplifyPath=h,c.OSS_PREFIX="urn:adsk.objects:os.object:",c.generateUrl=function(e,t,n){if(n=n||"",Object(s.isNodeJS)()&&!p(e,n))return n;var i=(n=h(n)).indexOf("urn:"),r=n.indexOf("?");if(n=-1!=i?-1!==r?n.slice(0,i)+encodeURIComponent(n.slice(i,r))+n.slice(r):n.slice(0,i)+encodeURIComponent(n.slice(i)):encodeURI(n),!t||0!==decodeURIComponent(n).indexOf("urn:"))return p(null,n)?n:e+n;switch("items"!==t&&(n=n.substr(6)),t){case"items":return a.endpoint.getItemApi(e,n);case"bubbles":return a.endpoint.getManifestApi(e,n);case"thumbnails":return a.endpoint.getThumbnailApi(e,n)}},Object(s.isNodeJS)())!function(){var e=n(91),t=n(91),o=n(91),a=n(91),s=n(91),l=new o.Agent({keepAlive:!0,keepAliveMsecs:100,maxSockets:10}),u=new a.Agent({keepAlive:!0,keepAliveMsecs:100,maxSockets:10}),h=new o.Agent({maxSockets:10});c.rawGet=function(n,d,f,m,g,v){if(v=v||{},p(n,f=c.generateUrl(n,d,f))){if(v.queryParams){var y=-1===f.indexOf("?")?"?":"&";f=f+y+v.queryParams}var _=s.parse(f),b={host:_.hostname,port:_.port,method:v.method||"GET",path:_.path,headers:{},retryCount:0,agent:"https:"===_.protocol?l:u};if(b.host.endsWith(".api.autodesk.com")&&(b.path.startsWith("/derivativeservice")||b.path.startsWith("/modelderivative"))&&(b.agent=h),v.headers)for(var x in v.headers)b.headers[x]=v.headers[x];b.headers["accept-encoding"]||(b.headers["accept-encoding"]="gzip, deflate"),v.range&&(b.headers.Range="bytes="+v.range.min+"-"+v.range.max),(v.ondata||v.onprogress)&&(v.responseType="arraybuffer");var w=("https:"===_.protocol?o:a).request(b,function(e){var n=!(e.statusCode>=200&&e.statusCode<400),o=e;n||!function(e,t){return!!("gzip"===e.headers["content-encoding"]||t.endsWith(".json.gz")||t.endsWith("FragmentList.pack")||t.endsWith("LightList.bin")||t.endsWith("CameraList.bin")||t.endsWith("CameraDefinitions.bin")||t.endsWith("LightDefinitions.bin"))}(e,_.pathname)||v.skipDecompress||(o=e.pipe(t.createGunzip())),"json"!==v.responseType&&"text"!==v.responseType&&v.responseType||o.setEncoding("utf8");var a=[],s=Buffer.allocUnsafe(65536),l=0;o.on("data",function(e){if(v.onprogress){if(e.length+l>s.length){var t=Buffer.allocUnsafe(0|Math.ceil(1.5*s.length));s.copy(t,0,0,l),s=t}return e.copy(s,l,0,e.length),l+=e.length,void(v.onprogress(s,l)&&w.abort())}a.push(e),v.ondata&&v.ondata(e)}),o.on("end",function(){if(e.statusCode>=200&&e.statusCode<400){if("json"===v.responseType){var n=JSON.parse(a.join(""));return void m(n)}if("text"===v.responseType||""===v.responseType){var o=a.join("");return void m(o)}var c=v.onprogress?s:Buffer.concat(a);if(!v.skipDecompress&&31===c[0]&&139===c[1]){i.logger.warn("An LMV resource ("+f+") was double compressed, or Content-Encoding header missing");try{c=t.gunzipSync(c),l=c.length}catch(e){g(r.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:f,exception:e.toString(),stack:e.stack})}}m(c,l)}else g&&g(e.statusCode,e.statusMessage,{url:f})})});w.on("error",function(e){g&&g(e.code,e.message,{url:f})}),v.postData&&w.write(v.postData),w.end()}else!function(n,i,r,o){function a(e){if("json"===o.responseType)try{return JSON.parse(e.toString("utf8"))}catch(e){r(e)}return e}0===n.indexOf("file://")&&(n=n.substr(7)),e.readFile(n,function(e,s){e?r(0,0,{httpStatusText:e,url:n}):31===s[0]&&139===s[1]?t.gunzip(s,null,function(e,t){e?r(0,0,{httpStatusText:e,url:n}):(t=a(t),o.ondata&&o.ondata(t),i(t))}):(s=a(s),o.ondata&&o.ondata(s),i(s))})}(f,m,g,v)}}();else{var m=new(n(165));m.max=25,c.rawGet=function(e,t,n,i,r,o){m.go(function(a){c._rawGet(e,t,n,function(){a();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i&&i.apply(i,t)},function(){a();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r&&r.apply(r,t)},o)})},c._rawGet=function(e,t,n,a,s,h){if(h=h||{},n=c.generateUrl(e,t,n),h.queryParams){var d=-1===n.indexOf("?")?"?":"&";n=n+d+h.queryParams}var p=new XMLHttpRequest;function m(e){s&&s(p.status,p.statusText,{url:n})}function g(e){if("json"===h.responseType)try{if(e instanceof Uint8Array)return Object(o.a)(e);if("string"==typeof e)return JSON.parse(e)}catch(e){}return e}function v(e){if(200===p.status||206===p.status)if(p.response&&p.response instanceof ArrayBuffer){var t=new Uint8Array(p.response);if(!h.skipDecompress&&31===t[0]&&139===t[1]){u||(u=!0,i.logger.warn("An LMV resource ("+n+") was not uncompressed by the browser. This hurts performance. Check the Content-Encoding header returned by the server and check whether you're getting double-compressed streams. The warning prints only once but it's likely the problem affects multiple resources."));try{t=l.ungzip(t)}catch(e){s(r.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:n,exception:e.toString(),stack:e.stack})}}a&&a(g(t))}else{var o=p.response;o||h.responseType&&"text"!==h.responseType||(o=p.responseText),a&&a(g(o))}else m()}try{var y=!h.hasOwnProperty("asynchronous")||h.asynchronous;if(p.open(h.method||(h.noBody?"HEAD":"GET"),n,y),h.hasOwnProperty("responseType")&&(p.responseType=h.responseType),p.withCredentials=!0,h.hasOwnProperty("withCredentials")&&(p.withCredentials=h.withCredentials),h.range&&p.setRequestHeader("Range","bytes="+h.range.min+"-"+h.range.max),h.headers)for(var _ in h.headers)p.setRequestHeader(_,h.headers[_]),"authorization"===_.toLocaleLowerCase()&&(p.withCredentials=!1);y&&(p.onload=v,p.onerror=m,p.ontimeout=m,(h.ondata||h.onprogress)&&(p.overrideMimeType("text/plain; charset=x-user-defined"),h._dlProgress={streamOffset:0},p.onreadystatechange=function(){if(p.readyState>2&&200===p.status)if(h.ondata){var e=p.responseText;if(h._dlProgress.streamOffset>=e.length)return;var t=f(e,h._dlProgress.streamOffset);h._dlProgress.streamOffset=e.length,h.ondata(t)}else if(h.onprogress){h.onprogress(p.responseText)&&p.abort()}})),p.send(h.postData),y||v()}catch(e){s(p.status,p.statusText,{url:n,exception:e})}}}function g(e,t){t.hasOwnProperty("responseType")||(t.responseType="arraybuffer"),t.hasOwnProperty("withCredentials")||(t.withCredentials=!!e.auth),t.headers=e.headers,t.queryParams=e.queryParams,t.endpoint=e.endpoint}c.defaultFailureCallback=function(e,t,n){403==e?this.raiseError(r.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:n.url,httpStatus:e,httpStatusText:t}):404==e?this.raiseError(r.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:n.url,httpStatus:e,httpStatusText:t}):e>=500&&e<600?this.raiseError(r.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:n.url,httpStatus:e,httpStatusText:t}):n.exception?this.raiseError(r.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:n.url,exception:n.exception.toString(),stack:n.exception.stack}):this.raiseError(r.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:n.url,httpStatus:e,httpStatusText:t,data:n})},c.getItem=function(e,t,n,i,r){g(e,r=r||{}),c.rawGet(e.endpoint,"items",t,n,i,r)},c.getManifest=function(e,t,n,i,r){(r=r||{}).hasOwnProperty("responseType")||(r.responseType="json"),g(e,r),c.rawGet(e.endpoint,"bubbles",t,n,i,r)},c.getThumbnail=function(e,t,n,i,r){g(e,r=r||{});var o=r.queryParams||"",a=[];if(-1===o.indexOf("guid=")&&a.push("guid="+encodeURIComponent(r.guid)),-1===o.indexOf("role=")){var s=r.role||"rendered";a.push("role="+s)}if(-1===o.indexOf("width=")){var l=r.size||400;a.push("width="+l)}if(-1===o.indexOf("height=")){l=r.size||400;a.push("height="+l)}-1===o.indexOf("acmsession=")&&r.acmsession&&a.push("acmsession="+r.acmsession);var u=a.join("&");r.queryParams?r.queryParams=r.queryParams+"&"+u:r.queryParams=u,c.rawGet(e.endpoint,"thumbnails",t,n,i,r)},c.getACMSession=function(e,t,n,i){var r,o={};for(var a in t)"oauth2AccessToken"===a?r=t[a]:-1!==a.indexOf("x-ads-acm")&&(o[a]=t[a]);o.application="autodesk";var s=new XMLHttpRequest;s.open("POST",e+"/oss-ext/v2/acmsessions",!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Authorization","Bearer "+r),s.responseType="json",s.onload=function(){if(200===s.status&&s.response){var e="string"==typeof s.response?JSON.parse(s.response):s.response;e&&e.acmsession?n(e.acmsession):i(s.status,"Can't get acm session from response.")}else i(s.status)},s.onerror=i,s.ontimeout=i,s.send(JSON.stringify(o)),delete o.application}},function(e,t,n){"use strict";n.r(t),n.d(t,"RenderFlags",function(){return i});var i={RENDER_NORMAL:0,RENDER_HIGHLIGHTED:1,RENDER_HIGHLIGHTED1:1,RENDER_HIGHLIGHTED2:2,RENDER_HIDDEN:3,RENDER_SHADOWMAP:4,RENDER_FINISHED:5}},function(e,t,n){"use strict";n.r(t),n.d(t,"memoryOptimizedLoading",function(){return r}),n.d(t,"GPU_MEMORY_LIMIT",function(){return o}),n.d(t,"GPU_OBJECT_LIMIT",function(){return a}),n.d(t,"USE_VAO",function(){return s}),n.d(t,"GEOMETRY_OVERHEAD",function(){return l}),n.d(t,"PIXEL_CULLING_THRESHOLD",function(){return c}),n.d(t,"PAGEOUT_SUCCESS",function(){return u}),n.d(t,"PAGEOUT_FAIL",function(){return h}),n.d(t,"PAGEOUT_NONE",function(){return d});var i=n(3),r=!0,o=1024*(Object(i.isMobileDevice)()?64:256)*1024,a=Object(i.isMobileDevice)()?2500:1e4,s=!Object(i.isMobileDevice)(),l=336,c=1,u=0,h=1,d=2},function(e,t,n){"use strict";n.r(t),n.d(t,"CutPlanesUniforms",function(){return de}),n.d(t,"IdUniforms",function(){return fe}),n.d(t,"ThemingUniform",function(){return pe}),n.d(t,"ShadowMapCommonUniforms",function(){return me}),n.d(t,"ShadowMapUniforms",function(){return ge}),n.d(t,"PointSizeUniforms",function(){return ve}),n.d(t,"WideLinesUniforms",function(){return ye}),n.d(t,"DepthTextureUniforms",function(){return _e}),n.d(t,"GetPrismMapSampleChunk",function(){return Ae}),n.d(t,"GetPrismMapUniformChunk",function(){return Ee}),n.d(t,"resolve",function(){return Me}),n.d(t,"PackDepthShaderChunk",function(){return Se}),n.d(t,"TonemapShaderChunk",function(){return Ce}),n.d(t,"OrderedDitheringShaderChunk",function(){return Pe}),n.d(t,"CutPlanesShaderChunk",function(){return Le}),n.d(t,"PackNormalsShaderChunk",function(){return Re}),n.d(t,"HatchPatternShaderChunk",function(){return De}),n.d(t,"EnvSamplingShaderChunk",function(){return Ie}),n.d(t,"IdVertexDeclaration",function(){return Oe}),n.d(t,"IdVertexShaderChunk",function(){return Ne}),n.d(t,"IdFragmentDeclaration",function(){return ke}),n.d(t,"IdOutputShaderChunk",function(){return Ve}),n.d(t,"FinalOutputShaderChunk",function(){return Fe}),n.d(t,"ThemingFragmentDeclaration",function(){return Be}),n.d(t,"ThemingFragmentShaderChunk",function(){return Ue}),n.d(t,"InstancingVertexDeclaration",function(){return ze}),n.d(t,"ShadowMapDeclareCommonUniforms",function(){return Ge}),n.d(t,"ShadowMapVertexDeclaration",function(){return He}),n.d(t,"ShadowMapVertexShaderChunk",function(){return We}),n.d(t,"ShadowMapFragmentDeclaration",function(){return je}),n.d(t,"PointSizeDeclaration",function(){return Xe}),n.d(t,"PointSizeShaderChunk",function(){return qe}),n.d(t,"ShaderChunks",function(){return Ye});var i=n(0),r=n(177),o=n.n(r),a=n(178),s=n.n(a),l=n(179),c=n.n(l),u=n(180),h=n.n(u),d=n(181),f=n.n(d),p=n(182),m=n.n(p),g=n(183),v=n.n(g),y=n(184),_=n.n(y),b=n(185),x=n.n(b),w=n(186),A=n.n(w),E=n(187),T=n.n(E),M=n(188),S=n.n(M),C=n(189),P=n.n(C),L=n(190),R=n.n(L),D=n(191),I=n.n(D),O=n(192),N=n.n(O),k=n(193),V=n.n(k),F=n(194),B=n.n(F),U=n(195),z=n.n(U),G=n(196),H=n.n(G),W=n(197),j=n.n(W),X=n(198),q=n.n(X),Y=n(199),K=n.n(Y),Q=n(200),Z=n.n(Q),J=n(201),$=n.n(J),ee=n(202),te=n.n(ee),ne=n(203),ie=n.n(ne),re=n(204),oe=n.n(re),ae=n(205),se=n.n(ae),le=n(206),ce=n.n(le),ue=n(207),he=n.n(ue),de={cutplanes:{type:"v4v",value:[]},hatchParams:{type:"v2",value:new i.Vector2(1,10)},hatchTintColor:{type:"c",value:new i.Color(16777215)},hatchTintIntensity:{type:"f",value:1}},fe={dbId:{type:"v3",value:new i.Vector3(0,0,0)},modelId:{type:"v3",value:new i.Vector3(0,0,0)}},pe={themingColor:{type:"v4",value:new i.Vector4(0,0,0,0)}},me={shadowESMConstant:{type:"f",value:0}},ge=i.UniformsUtils.merge([{shadowMap:{type:"t",value:null},shadowMapSize:{type:"v2",value:new i.Vector2(0,0)},shadowBias:{type:"f",value:0},shadowDarkness:{type:"f",value:0},shadowMatrix:{type:"m4",value:new i.Matrix4},shadowLightDir:{type:"v3",value:new i.Vector3}},me]),ve={point_size:{type:"f",value:1}},ye={view_size:{type:"v2",value:new i.Vector2(640,480)}},_e={tDepth:{type:"t",value:null},projInfo:{type:"v4",value:new i.Vector4},isOrtho:{type:"f",value:0},worldMatrix_mainPass:{type:"m4",value:new i.Matrix4}},be={};for(var xe in i.ShaderChunk)be[xe]=i.ShaderChunk[xe];be.pack_depth=o.a,be.depth_texture=s.a,be.tonemap=c.a,be.ordered_dither=h.a,be.cutplanes=f.a,be.pack_normals=m.a,be.hatch_pattern=v.a,be.env_sample=_.a,be.id_decl_vert=x.a,be.id_vert=A.a,be.id_decl_frag=T.a,be.id_frag=S.a,be.final_frag=P.a,be.theming_decl_frag=R.a,be.theming_frag=I.a,be.instancing_decl_vert=N.a,be.shadowmap_decl_common=V.a,be.shadowmap_decl_vert=B.a,be.shadowmap_vert=z.a,be.shadowmap_decl_frag=H.a,be.float3_average=j.a,be.line_decl_common=q.a,be.prism_wood=K.a,be.prism_glazing=Z.a,be.prism_transparency=$.a,be.normal_map=te.a,be.decl_point_size=ie.a,be.point_size=oe.a,be.wide_lines_decl=se.a,be.wide_lines_vert=ce.a,be.hsv=he.a;var we={};function Ae(e,t,n,i){var r=n?"_v3":"",o=n?"vec3 ":"",a=n?t+" = average("+t+r+");":"",s=i?t+r+" = SRGBToLinear("+t+r+");":"";return["#if defined( USE_"+e.toUpperCase()+"_MAP )","vec2 uv_"+e+"_map = ("+e+"_map_texMatrix * vec3(uv, 1.0)).xy;",e.toUpperCase()+"_CLAMP_TEST;",o+t+r+" = texture2D("+e+"_map, uv_"+e+"_map).xyz;",s,"if("+e+"_map_invert) "+t+r+" = vec3(1.0) - "+t+r+";",a,"#else",t+" = "+e+";","#endif"].join("\n")}function Ee(e){var t=e+"_texMatrix",n=e+"_invert";return["#if defined( "+("USE_"+e).toUpperCase()+" )","uniform sampler2D "+e+";","uniform mat3 "+t+";","uniform bool "+n+";","#endif"].join("\n")}we.prism_check=function(e){return["#if defined( USE_SURFACE_ALBEDO_MAP ) || defined( USE_SURFACE_ROUGHNESS_MAP ) || defined( USE_SURFACE_CUTOUT_MAP ) || defined( USE_SURFACE_ANISOTROPY_MAP ) || defined( USE_SURFACE_ROTATION_MAP ) || defined( USE_OPAQUE_ALBEDO_MAP ) || defined( USE_OPAQUE_F0_MAP ) || defined( USE_OPAQUE_LUMINANCE_MODIFIER_MAP ) || defined( USE_LAYERED_BOTTOM_F0_MAP ) || defined( USE_LAYERED_F0_MAP ) || defined( USE_LAYERED_DIFFUSE_MAP ) || defined( USE_LAYERED_FRACTION_MAP ) || defined( USE_LAYERED_ROUGHNESS_MAP ) || defined( USE_LAYERED_ANISOTROPY_MAP ) || defined( USE_LAYERED_ROTATION_MAP ) || defined( USE_METAL_F0_MAP ) || defined( USE_SURFACE_NORMAL_MAP ) || defined( USE_LAYERED_NORMAL_MAP )","#define "+e,"#endif"].join("\n")},we.prism_sample_texture=function(e,t,n,i){return Ae(e,t,"true"===n,"true"===i)},we.prism_uniforms=Ee,we.prism_bump_uniforms=function(e){var t=e+"_texMatrix",n=e+"_bumpScale",i=e+"_bumpmapType";return["#if defined( "+("USE_"+e).toUpperCase()+" )","uniform sampler2D "+e+";","uniform mat3 "+t+";","uniform vec2 "+n+";","uniform int "+i+";","#endif"].join("\n")};var Te={};for(xe in we)Te[xe]=new RegExp("#"+xe+" *<([\\w\\d., ]*)>","g");var Me=function e(t){for(var n in we){var i=Te[n];t=t.replace(i,function(e,t){var i=t.split(",").map(function(e){return e.trim()});return we[n].apply(null,i)})}return t.replace(/#include *<([\w\d.]+)>/g,function(t,n){if(!be[n])throw new Error("Cannot resolve #include<"+n+">");return e(be[n])})},Se=be.pack_depth,Ce=be.tonemap,Pe=be.ordered_dither,Le=be.cutplanes,Re=be.pack_normals,De=be.hatch_pattern,Ie=be.env_sample,Oe=be.id_decl_vert,Ne=be.id_vert,ke=be.id_decl_frag,Ve=be.id_frag,Fe=be.final_frag,Be=be.theming_decl_frag,Ue=be.theming_frag,ze=be.instancing_decl_vert,Ge=be.shadowmap_decl_common,He=be.shadowmap_decl_vert,We=be.shadowmap_vert,je=be.shadowmap_decl_frag,Xe=be.decl_point_size,qe=be.point_size,Ye={IdUniforms:fe,ThemingUniform:pe,CutPlanesUniforms:de,ShadowMapCommonUniforms:me,ShadowMapUniforms:ge,PointSizeUniforms:ve,WideLinesUniforms:ye,DepthTextureUniforms:_e,PackDepthShaderChunk:Se,TonemapShaderChunk:Ce,OrderedDitheringShaderChunk:Pe,CutPlanesShaderChunk:Le,PackNormalsShaderChunk:Re,HatchPatternShaderChunk:De,EnvSamplingShaderChunk:Ie,IdVertexDeclaration:Oe,IdVertexShaderChunk:Ne,IdFragmentDeclaration:ke,IdOutputShaderChunk:Ve,FinalOutputShaderChunk:Fe,ThemingFragmentDeclaration:Be,ThemingFragmentShaderChunk:Ue,InstancingVertexDeclaration:ze,ShadowMapDeclareCommonUniforms:Ge,ShadowMapVertexDeclaration:He,ShadowMapVertexShaderChunk:We,ShadowMapFragmentDeclaration:je,PointSizeDeclaration:Xe,PointSizeShaderChunk:qe,GetPrismMapSampleChunk:Ae,GetPrismMapUniformChunk:Ee,resolve:Me}},function(e,t,n){"use strict";n.r(t),n.d(t,"OptionSlider",function(){return s}),n.d(t,"OptionCheckbox",function(){return l}),n.d(t,"OptionLabel",function(){return c}),n.d(t,"OptionDropDown",function(){return u}),n.d(t,"ResizeFooter",function(){return h});var i=n(32),r=n(9),o=n(3),a=n(90);function s(e,t,n,i,o){var a=this;this.tbody=i;var s=o&&o.insertAtIndex?o.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(s);var l=this.sliderRow.insertCell(0);function c(e){e.target!=a.stepperElement&&(a.stepperElement.value=a.sliderElement.value),a.fireChangeEvent()}this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=r.i18n.translate(e),this.sliderElement=document.createElement("input"),this.sliderElement.type="range",this.sliderElement.id=e+"_slider",this.sliderElement.min=t,this.sliderElement.max=n,l.appendChild(this.caption),l.appendChild(this.sliderElement),l=this.sliderRow.insertCell(1),this.stepperElement=document.createElement("input"),this.stepperElement.type="number",this.stepperElement.id=e+"_stepper",this.stepperElement.min=t,this.stepperElement.max=n,this.stepperElement.step=1,this.stepperElement.style.width="64px",l.appendChild(this.stepperElement),this.blockEvent=!1,this.stepperElement.addEventListener("change",function(e){e.target!=a.sliderElement&&(a.sliderElement.value=a.stepperElement.value),a.fireChangeEvent()},!1),this.sliderElement.addEventListener("change",c,!1),this.sliderElement.addEventListener("input",c,!1)}function l(e,t,n,i,s){var l=this;this.tbody=t;var c=s&&s.insertAtIndex?s.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(c),this.sliderRow.classList.add("switch-slider-row");var u=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=r.i18n.translate(e),u.appendChild(this.caption),u=this.sliderRow.insertCell(1),i&&(this.description=document.createElement("div"),this.description.setAttribute("data-i18n",i),this.description.textContent=r.i18n.translate(i),u.appendChild(this.description),u=this.sliderRow.insertCell(2));var h=document.createElement("label");h.classList.add("switch"),this.checkElement=document.createElement("input"),this.checkElement.type="checkbox",this.checkElement.id=e+"_check",this.checkElement.checked=n,h.appendChild(this.checkElement);var d=document.createElement("div");d.classList.add("slider"),h.appendChild(d),u.appendChild(h),this.blockEvent=!1,this.checked=n,this.checkElement.addEventListener("change",function(e){l.fireChangeEvent()},!1),Object(o.isTouchDevice)()&&(this.sliderRowHammer=new a.Manager(this.sliderRow,{recognizers:[[a.Tap]],handlePointerEventMouse:!1,inputClass:o.isIE11?a.PointerEventInput:a.TouchInput}),this.sliderRowHammer.on("tap",function(e){e.preventDefault(),e.target.click()})),this.checkElement.addEventListener("click",function(e){e.stopPropagation()},!1),this.sliderRow.addEventListener("click",function(e){l.checkElement.disabled||(l.checkElement.checked=!l.checkElement.checked,l.fireChangeEvent())},!1)}function c(e,t,n){this.tbody=t;var i=n&&n.insertAtIndex?n.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(i);var o=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=r.i18n.translate(e),o.appendChild(this.caption),o.colSpan="3",this.blockEvent=!1}function u(e,t,n,i,o,a){var s=this;this.tbody=t;var l=a&&a.insertAtIndex?a.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(l),this.dropdownElement=document.createElement("select"),this.dropdownElement.id=e+"_dropdown",this.dropdownElement.classList.add("option-drop-down");for(var c=0;c<n.length;c++){var u=document.createElement("option");u.value=c,u.setAttribute("data-i18n",n[c]),u.textContent=r.i18n.translate(n[c]),this.dropdownElement.add(u)}this.selectedIndex=this.dropdownElement.selectedIndex=i;var h=this.sliderRow.insertCell(0);(this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=r.i18n.translate(e),h.appendChild(this.caption),o)?(h.colSpan="2",this.sliderRow=this.tbody.insertRow(l),(h=this.sliderRow.insertCell(0)).appendChild(this.dropdownElement),h.colSpan="2",this.dropdownElement.classList.add("tabcell")):(h=this.sliderRow.insertCell(1)).appendChild(this.dropdownElement);h.style.paddingLeft=(a&&void 0!==a.paddingLeft?a.paddingLeft:5)+"px",h.style.paddingRight=(a&&void 0!==a.paddingRight?a.paddingRight:5)+"px",this.blockEvent=!1,this.dropdownElement.addEventListener("change",function(e){s.fireChangeEvent()},!1)}function h(e,t){var n=document.createElement("div");n.classList.add("docking-panel-footer");var i=document.createElement("div");i.classList.add("docking-panel-footer-resizer"),n.appendChild(i);var r=!1,o=e.getBoundingClientRect(),a={x:0,y:0},s=document.createElement("div");s.classList.add("adsk-viewing-viewer"),s.classList.add("docking-panel-resize-overlay");var l=function(t){r=!0,o=e.getBoundingClientRect(),document.body.appendChild(s),document.addEventListener("touchmove",u),document.addEventListener("touchcancel",c),document.addEventListener("touchend",c),document.addEventListener("mousemove",u),document.addEventListener("mouseup",c),t.preventDefault(),t.stopPropagation()},c=function e(t){document.body.contains(s)&&(document.body.removeChild(s),document.removeEventListener("touchmove",u),document.removeEventListener("touchcancel",e),document.removeEventListener("touchend",e),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",e),t.preventDefault(),t.stopPropagation())},u=function(n){"touchmove"===n.type&&(n.canvasX=n.touches[0].screenX,n.canvasY=n.touches[0].screenY),r&&(r=!1,a.x=n.canvasX||n.clientX,a.y=n.canvasY||n.clientY);var i=(n.canvasX||n.clientX)-a.x,s=(n.canvasY||n.clientY)-a.y,l=parseInt(o.width+i),c=parseInt(o.height+s);e.style.width=l+"px",e.style.height=c+"px",t&&t(l,c),n.preventDefault(),n.stopPropagation()};i.addEventListener("touchstart",l),i.addEventListener("mousedown",l),e.style.resize="none",e.appendChild(n),this.footer=n,this.resizer=i}s.prototype.constructor=s,i.EventDispatcher.prototype.apply(s.prototype),s.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.value=this.sliderElement.value;var e=new CustomEvent("change",{detail:{target:this,value:this.sliderElement.value}});this.dispatchEvent(e)}},s.prototype.setValue=function(e){this.blockEvent=!0,this.value=e,this.sliderElement.value=e,this.stepperElement.value=e,this.blockEvent=!1},s.prototype.setDisabled=function(e){this.sliderElement.disabled=e,this.stepperElement.disabled=e,this.caption.disabled=e},l.prototype.constructor=l,i.EventDispatcher.prototype.apply(l.prototype),l.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.checked=this.checkElement.checked;var e=new CustomEvent("change",{detail:{target:this,value:this.checkElement.checked}});this.dispatchEvent(e)}},l.prototype.setChecked=function(e){this.checkElement.checked!=e&&(this.checkElement.checked=e,this.fireChangeEvent())},l.prototype.setValue=function(e){this.blockEvent=!0,this.checked=e,this.checkElement.checked=e,this.blockEvent=!1},l.prototype.getValue=function(){return this.checkElement.checked},l.prototype.setDisabled=function(e){this.checkElement.disabled=e,this.caption.disabled=e},l.prototype.setVisibility=function(e){this.sliderRow.style.display=e?"table-row":"none"},u.prototype.constructor=u,i.EventDispatcher.prototype.apply(u.prototype),u.prototype.setSelectedIndex=function(e){this.blockEvent=!0,this.selectedIndex=this.dropdownElement.selectedIndex=e,this.blockEvent=!1},u.prototype.setSelectedValue=function(e){this.blockEvent=!0,this.dropdownElement.selectedValue=e,this.selectedIndex=this.dropdownElement.selectedIndex,this.blockEvent=!1},u.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.selectedIndex=this.dropdownElement.selectedIndex;var e=new CustomEvent("change",{detail:{target:this,value:this.selectedIndex}});this.dispatchEvent(e)}},u.prototype.setDisabled=function(e){this.dropdownElement.disabled=e,this.caption.disabled=e}},function(e,t,n){"use strict";n.r(t),n.d(t,"LmvMatrix4",function(){return i});var i=function(e){this.elements=e?new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};i.prototype={constructor:i,set:function(e,t,n,i,r,o,a,s,l,c,u,h,d,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z,o=e.w,a=n+n,s=i+i,l=r+r,c=n*a,u=n*s,h=n*l,d=i*s,f=i*l,p=r*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(d+p),t[4]=u-v,t[8]=h+g,t[1]=u+v,t[5]=1-(c+p),t[9]=f-m,t[2]=h-g,t[6]=f+m,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},multiply:function(e){return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],b=n[15],x=i[0],w=i[4],A=i[8],E=i[12],T=i[1],M=i[5],S=i[9],C=i[13],P=i[2],L=i[6],R=i[10],D=i[14],I=i[3],O=i[7],N=i[11],k=i[15];return r[0]=o*x+a*T+s*P+l*I,r[4]=o*w+a*M+s*L+l*O,r[8]=o*A+a*S+s*R+l*N,r[12]=o*E+a*C+s*D+l*k,r[1]=c*x+u*T+h*P+d*I,r[5]=c*w+u*M+h*L+d*O,r[9]=c*A+u*S+h*R+d*N,r[13]=c*E+u*C+h*D+d*k,r[2]=f*x+p*T+m*P+g*I,r[6]=f*w+p*M+m*L+g*O,r[10]=f*A+p*S+m*R+g*N,r[14]=f*E+p*C+m*D+g*k,r[3]=v*x+y*T+_*P+b*I,r[7]=v*w+y*M+_*L+b*O,r[11]=v*A+y*S+_*R+b*N,r[15]=v*E+y*C+_*D+b*k,this},multiplyToArray:function(e,t,n){var i=this.elements;return this.multiplyMatrices(e,t),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*s*u-i*l*u-r*a*h+n*l*h+i*a*d-n*s*d)+e[7]*(+t*s*d-t*l*h+r*o*h-i*o*d+i*l*c-r*s*c)+e[11]*(+t*l*u-t*a*d-r*o*u+n*o*d+r*a*c-n*l*c)+e[15]*(-i*a*c-t*s*u+t*a*h+i*o*u-n*o*h+n*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,i=e.elements,r=i[0],o=i[4],a=i[8],s=i[12],l=i[1],c=i[5],u=i[9],h=i[13],d=i[2],f=i[6],p=i[10],m=i[14],g=i[3],v=i[7],y=i[11],_=i[15];n[0]=u*m*v-h*p*v+h*f*y-c*m*y-u*f*_+c*p*_,n[4]=s*p*v-a*m*v-s*f*y+o*m*y+a*f*_-o*p*_,n[8]=a*h*v-s*u*v+s*c*y-o*h*y-a*c*_+o*u*_,n[12]=s*u*f-a*h*f-s*c*p+o*h*p+a*c*m-o*u*m,n[1]=h*p*g-u*m*g-h*d*y+l*m*y+u*d*_-l*p*_,n[5]=a*m*g-s*p*g+s*d*y-r*m*y-a*d*_+r*p*_,n[9]=s*u*g-a*h*g-s*l*y+r*h*y+a*l*_-r*u*_,n[13]=a*h*d-s*u*d+s*l*p-r*h*p-a*l*m+r*u*m,n[2]=c*m*g-h*f*g+h*d*v-l*m*v-c*d*_+l*f*_,n[6]=s*f*g-o*m*g-s*d*v+r*m*v+o*d*_-r*f*_,n[10]=o*h*g-s*c*g+s*l*v-r*h*v-o*l*_+r*c*_,n[14]=s*c*d-o*h*d-s*l*f+r*h*f+o*l*m-r*c*m,n[3]=u*f*g-c*p*g-u*d*v+l*p*v+c*d*y-l*f*y,n[7]=o*p*g-a*f*g+a*d*v-r*p*v-o*d*y+r*f*y,n[11]=a*c*g-o*u*g-a*l*v+r*u*v+o*l*y-r*c*y,n[15]=o*u*d-a*c*d+a*l*f-r*u*f-o*l*p+r*c*p;var b=r*n[0]+l*n[4]+d*n[8]+g*n[12];if(0==b){var x="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(x);return console.warn(x),this.identity(),this}return this.multiplyScalar(1/b),this},scale:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,c=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,c*a+n,c*s-i*o,0,l*s-i*a,c*s+i*o,r*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},transformPoint:function(e){var t=e.x,n=e.y,i=e.z,r=this.elements;return e.x=r[0]*t+r[4]*n+r[8]*i+r[12],e.y=r[1]*t+r[5]*n+r[9]*i+r[13],e.z=r[2]*t+r[6]*n+r[10]*i+r[14],e},transformDirection:function(e){var t=e.x,n=e.y,i=e.z,r=this.elements;e.x=r[0]*t+r[4]*n+r[8]*i,e.y=r[1]*t+r[5]*n+r[9]*i,e.z=r[2]*t+r[6]*n+r[10]*i;var o=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);if(o>0){var a=1/o;e.x*=a,e.y*=a,e.z*=a}return e},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return new i(this.elements instanceof Float64Array).fromArray(this.elements)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"Extension",function(){return r});var i=n(68),r=(n(1),function(e,t){this.viewer=e,this.options=t||{},this.id="",this.modes=[],this.mode="",this.name="",this.activeStatus=!1});r.prototype.load=function(){return!0},r.prototype.unload=function(){return!0},r.prototype.activate=function(e){return!0},r.prototype.deactivate=function(){return!0},r.prototype.getName=function(){return this.name},r.prototype.getModes=function(){return this.modes},r.prototype.isActive=function(e){return e?this.activeStatus&&this.mode===e:this.activeStatus},r.prototype.getState=function(e){},r.prototype.restoreState=function(e,t){return!0},r.prototype.extendLocalization=function(e){return Object(i.extendLocalization)(e)},r.prototype.getCache=function(){this.viewer.extensionCache||(this.viewer.extensionCache={});var e=this.viewer.extensionCache[this.id];return e||(e=this.viewer.extensionCache[this.id]={}),e},"undefined"!=typeof Autodesk&&(Autodesk.Viewing.Extension=r)},function(e,t,n){"use strict";n.r(t),n.d(t,"Control",function(){return r});var i=n(32);function r(e,t){this._id=e,this._isCollapsible=!t||t.collapsible,this._toolTipElement=null,this._listeners={},this.container=document.createElement("div"),this.container.id=e,this.addClass("adsk-control")}r.Event={VISIBILITY_CHANGED:"Control.VisibilityChanged",COLLAPSED_CHANGED:"Control.CollapsedChanged"},i.EventDispatcher.prototype.apply(r.prototype),r.prototype.constructor=r,r.prototype.container=null,r.prototype.getId=function(){return this._id},r.prototype.setVisible=function(e){if(!this.container.classList.contains("adsk-hidden")===e)return!1;e?this.container.classList.remove("adsk-hidden"):this.container.classList.add("adsk-hidden");var t={type:r.Event.VISIBILITY_CHANGED,target:this,controlId:this._id,isVisible:e};return this.dispatchEvent(t),!0},r.prototype.isVisible=function(){return!this.container.classList.contains("adsk-hidden")},r.prototype.setToolTip=function(e){return(!this._toolTipElement||this._toolTipElement.getAttribute("tooltipText")!==e)&&(this._toolTipElement||(this._toolTipElement=document.createElement("div"),this._toolTipElement.id=this._id+"-tooltip",this._toolTipElement.classList.add("adsk-control-tooltip"),this.container.appendChild(this._toolTipElement)),this._toolTipElement.setAttribute("data-i18n",e),this._toolTipElement.setAttribute("tooltipText",e),this._toolTipElement.textContent=Autodesk.Viewing.i18n.translate(e,{defaultValue:e}),!0)},r.prototype.getToolTip=function(){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")},r.prototype.setCollapsed=function(e){if(!this._isCollapsible||this.isCollapsed()===e)return!1;e?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed");var t={type:r.Event.COLLAPSED_CHANGED,isCollapsed:e};return this.dispatchEvent(t),!0},r.prototype.isCollapsed=function(){return!!this.container.classList.contains("collapsed")},r.prototype.isCollapsible=function(){return this._isCollapsible},r.prototype.addClass=function(e){this.container.classList.add(e)},r.prototype.removeClass=function(e){this.container.classList.remove(e)},r.prototype.getPosition=function(){var e=this.container.getBoundingClientRect();return{top:e.top,left:e.left}},r.prototype.getDimensions=function(){var e=this.container.getBoundingClientRect();return{width:e.width,height:e.height}},r.prototype.setDisplay=function(e){this.container.style.display=e}},function(e,t,n){"use strict";n.r(t),n.d(t,"DefaultLightPreset",function(){return r}),n.d(t,"DefaultLightPreset2d",function(){return o}),n.d(t,"BackgroundPresets",function(){return a}),n.d(t,"LightPresets",function(){return l}),n.d(t,"copyLightPreset",function(){return u});var i=n(3),r=1,o=0,a={"Fusion Grey":[230,230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Snow:[181,186,199,181,186,199],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Dark Sky":[51,51,51,51,51,51],"Infinity Pool":[255,255,255,255,255,255],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Field:[202,226,252,202,201,190],Boardwalk:[216,230,248,230,228,220],Custom:[230,230,230,150,150,150]},s=a,l=[{name:"Simple Grey",path:null,tonemap:0,E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.2,.225,.25],lightMultiplier:1,bgColorGradient:s["Fusion Grey"],darkerFade:!1,rotation:0},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.5,-.2,-.06],bgColorGradient:s["Photo Booth"],darkerFade:!0,rotation:0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:1,lightDirection:[.1,-.55,-1],bgColorGradient:s["Dark Sky"],darkerFade:!1,rotation:0},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s["Grey Room"],darkerFade:!0,rotation:0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s["Photo Booth"],darkerFade:!0,rotation:0},{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s.Tranquility,darkerFade:!1,rotation:0},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s["Infinity Pool"],darkerFade:!1,rotation:0},{name:"Simple White",path:null,tonemap:0,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25,.25,.25],lightMultiplier:1,bgColorGradient:s.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0,rotation:0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:1,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s.Midnight,darkerFade:!1,rotation:0},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.35,-.35,-.5],bgColorGradient:s["Photo Booth"],darkerFade:!0,rotation:0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.5,0],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.6,0],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Plaza",path:"Plaza",type:"logluv",tonemap:1,E_bias:-14,directLightColor:[.9,.9,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.2,-.18,.72],bgColorGradient:s.Plaza,darkerFade:!1,rotation:0},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:1,E_bias:-10.461343,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[0,-1,0],bgColorGradient:s.Snow,darkerFade:!1,rotation:0},{name:"Field",path:"field",type:"logluv",tonemap:1,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s.Field,useIrradianceAsBackground:!0,darkerFade:!0,rotation:0},{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:1,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s.Boardwalk,useIrradianceAsBackground:!0,darkerFade:!1,rotation:0},{name:"Flat Shading",path:null,tonemap:0,E_bias:0,directLightColor:[0,0,0],ambientColor:[0,0,0],lightMultiplier:0,bgColorGradient:s["Fusion Grey"],darkerFade:!1,rotation:0}],c=[{name:"Harbor",path:"Harbor",type:"logluv",tonemap:1,E_bias:1.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],useIrradianceAsBackground:!0,saoIntensity:.5,darkerFade:!1,rotation:0},{name:"Night",path:"Night",type:"logluv",tonemap:1,E_bias:4,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s.Midnight,useIrradianceAsBackground:!1,darkerFade:!1,rotation:0},{name:"Parking",path:"Parking",type:"logluv",tonemap:1,E_bias:2.8,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],useIrradianceAsBackground:!1,saoIntensity:.5,darkerFade:!1,rotation:0},{name:"River Road",path:"RiverRoad",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Fusion Grey"],useIrradianceAsBackground:!1,saoIntensity:.7,darkerFade:!1,rotation:0},{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:1,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],useIrradianceAsBackground:!0,darkerFade:!0,rotation:0},{name:"Seaport",path:"seaport",type:"logluv",tonemap:1,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],useIrradianceAsBackground:!0,darkerFade:!1,rotation:0},{name:"Glacier",path:"glacier",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s.Midnight,darkerFade:!1,rotation:0},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["RaaS SBS"],darkerFade:!1,rotation:0},{name:"City Night",path:"CityNight",type:"logluv",tonemap:1,E_bias:1.6,directLightColor:[1,1,1],lightMultiplier:.2,bgColorGradient:s.Midnight,useIrradianceAsBackground:!1,darkerFade:!1,rotation:0}];function u(e,t){Object(i.ObjectAssign)(t,e),t.name=e.name+" (copy)"}Object(i.getGlobal)().ENABLE_DEBUG&&Array.prototype.push.apply(l,c)},function(e,t,n){"use strict";n.r(t),n.d(t,"GroundFlags",function(){return i});var i={GROUND_UNFINISHED:0,GROUND_FINISHED:1,GROUND_RENDERED:2}},function(e,t,n){"use strict";n.r(t),n.d(t,"createShaderMaterial",function(){return r}),n.d(t,"setMacro",function(){return o}),n.d(t,"removeMacro",function(){return a});var i=n(0),r=function(e){var t={vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};return e.uniforms&&(t.uniforms=i.UniformsUtils.clone(e.uniforms)),e.defines&&(t.defines=Object.assign({},e.defines)),e.extensions&&(t.extensions=Object.assign({},e.extensions)),e.attributes&&(t.attributes=e.attributes),new i.ShaderMaterial(t)},o=function(e,t,n){n=n||"",e.defines||(e.defines={}),e.defines[t]!=n&&(e.defines[t]=n,e.needsUpdate=!0)},a=function(e,t){(e.defines||e.defines[t])&&(delete e.defines[t],e.needsUpdate=!0)}},function(e,t,n){"use strict";n.r(t),n.d(t,"TOOLBAR_CREATED_EVENT",function(){return i}),n.d(t,"VIEW_CUBE_CREATED_EVENT",function(){return r}),n.d(t,"TOOLBAR",function(){return o});var i="toolbarCreated",r="viewCubeCreated",o={NAVTOOLSID:"navTools",MODELTOOLSID:"modelTools",SETTINGSTOOLSID:"settingsTools",MEASURETOOLSID:"measureTools"}},function(e,t,n){var i=n(3).isNodeJS,r=n(11).getResourceUrl;i()?function(){var t=n(244).MainWorker;function i(){return new t}e.exports={createWorker:i,initWorkerScript:function(e,t){e&&e()},createWorkerWithIntercept:function(){return i()}}}():function(){var t=Autodesk.Viewing.Private,n=t.LMV_WORKER_URL||"src/file-loaders/workers/MainWorker-web.js",i=null,o=!1,a=[];function s(){var e;return(e=t.ENABLE_INLINE_WORKER?new Worker(i):new Worker(r(n))).doOperation=e.postMessage,e}e.exports={createWorker:s,initWorkerScript:function(e,s){if(t.ENABLE_INLINE_WORKER&&!i){if(a.push({successCB:e}),!o){var l=new XMLHttpRequest,c=n,u=r(n);u&&(c=u),l.open("GET",c,!0),l.withCredentials=!1,l.onload=function(){var e;o=!1,window.URL=window.URL||window.webkitURL;try{e=new Blob([l.responseText],{type:"application/javascript"})}catch(n){var t=new BlobBuilder;t.append(l.responseText),e=t.getBlob()}i=URL.createObjectURL(e);var n=a.concat();a=[];for(var r=0;r<n.length;++r)n[r].successCB&&n[r].successCB()},o=!0,l.send()}var h={cancel:function(){var t=-1;return!!a.some(function(n,i){return n.successCB==e&&(t=i,!0)})&&(a.splice(t,1),!0)}};return h}return e&&e(),null},createWorkerWithIntercept:function(){var e=s();e.checkEvent=function(e){return!(!e.data||!e.data.assetRequest)};var t=[];return e.addEventListenerWithIntercept=function(n){var i=function(t){e.checkEvent(t)||n(t)};return t||(t=[]),t.push({arg:n,callback:i}),e.addEventListener("message",i,!1),i},e.removeEventListenerWithIntercept=function(n){var i=function(e){if(!t)return null;for(var n=0;n<t.length;++n)if(t[n].arg===e){var i=t[n].callback;return t.splice(n,1),0===t.length&&(t=null),i}return null}(n);i&&e.removeEventListener("message",i,!1)},e.clearAllEventListenerWithIntercept=function(){if(t)for(var n=t.concat(),i=0;i<n.length;++i)e.removeEventListenerWithIntercept(n[i].arg)},e},clearWorkerDataURL:function(){i=null}}}()},function(e,t,n){"use strict";n.r(t),n.d(t,"Animation",function(){return r}),n.d(t,"interpolateCatmullRom",function(){return o});var i=n(41);function r(e,t,n){this.root=e,this.handler=n.animationHandler,this.data=this.handler.init(t),this.hierarchy=this.handler.parse(e),this.viewer=n.viewer,this.animator=n,this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!1,this.delta=.5,this.interpolationType=i.a.LINEAR,this.setStartAndEndKeyTime()}function o(e,t){function n(e,t,n,i,r,o,a){var s=.5*(n-e),l=.5*(i-t);return(2*(t-n)+s+l)*a+(-3*(t-n)-2*s-l)*o+s*r+t}var i,r,o,a,s,l,c,u,h,d=[],f=[];return o=(i=(e.length-1)*t)-(r=Math.floor(i)),d[0]=0===r?r:r-1,d[1]=r,d[2]=r>e.length-2?r:r+1,d[3]=r>e.length-3?r:r+2,l=e[d[0]],c=e[d[1]],u=e[d[2]],h=e[d[3]],s=o*(a=o*o),f[0]=n(l[0],c[0],u[0],h[0],o,a,s),f[1]=n(l[1],c[1],u[1],h[1],o,a,s),f[2]=n(l[2],c[2],u[2],h[2],o,a,s),f}r.prototype.setStartAndEndKeyTime=function(){if(this.data.hierarchy.length>0){var e=this.data.hierarchy[0].keys;this.startKeyTime=e[0].time,this.endKeyTime=e[e.length-1].time}else this.startKeyTime=this.endKeyTime=0},r.prototype.keyTypes=[],r.prototype.defaultKey={},r.prototype.play=function(e){this.currentTime=void 0!==e?e:0,this.isPlaying=!0,this.isPaused=!1,this.reset(),this.handler.play(this)},r.prototype.pause=function(){!0===this.isPaused?this.handler.play(this):this.handler.stop(this),this.isPaused=!this.isPaused},r.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,this.handler.stop(this)},r.prototype.goto=function(e){this.isPlaying||this.play(),this.isPaused||this.pause();var t=e-this.currentTime;this.update(t)},r.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e];void 0===n.animationCache&&(n.animationCache={}),void 0===n.animationCache[this.data.name]&&(n.animationCache[this.data.name]={prevKey:this.defaultKey,nextKey:this.defaultKey,originalMatrix:n.matrix});for(var i=n.animationCache[this.data.name],r=0;r<this.keyTypes.length;r++){for(var o=this.keyTypes[r],a=this.data.hierarchy[e].keys[0],s=this.getNextKeyWith(o,e,1);s.time<this.currentTime&&s.index>a.index;)a=s,s=this.getNextKeyWith(o,e,s.index+1);i.prevKey[o]=a,i.nextKey[o]=s}}this.setStartAndEndKeyTime()},r.prototype.getNextKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;for(this.interpolationType===i.a.CATMULLROM||this.interpolationType===i.a.CATMULLROM_FORWARD?n=n<r.length-1?n:r.length-1:n%=r.length;n<r.length;n++)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[0]},r.prototype.getPrevKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;for(n=this.interpolationType===i.a.CATMULLROM||this.interpolationType===i.a.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+r.length;n>=0;n--)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[r.length-1]},r.prototype.isPlayingOutOfRange=function(){return!1===this.isPaused&&(this.currentTime<this.startKeyTime-this.delta||this.currentTime>this.endKeyTime+this.delta)},r.prototype.resetIfLooped=function(){!0===this.loop&&this.currentTime>this.endKeyTime&&(this.currentTime%=this.endKeyTime,this.reset())}},function(e,t,n){"use strict";n.r(t),n.d(t,"BubbleNode",function(){return r});var i=1;var r=function e(t,n){if(this.parent=n,this.id=i++,this.data=t,this.isLeaf="geometry"===t.type&&("3d"===t.role||"2d"===t.role||"lod"===t.role),this.extractRevitMetadata(),Array.isArray(t.children)||Array.isArray(t.derivatives)){this.children=[];for(var r=t.children||t.derivatives,o=r.length,a=0;a<o;a++)this.children[a]=new e(r[a],this);for(a=0;a<o;a++){var s="application/autodesk-db"==(l=r[a]).mime&&l.urn?0===l.urn.indexOf("urn:adsk.objects:os.object")?l.urn.substr(0,l.urn.lastIndexOf("%2F")+3):l.urn.substr(0,l.urn.lastIndexOf("/")+1):null;s&&(this.sharedPropertyDbPath=s),"lod"===r[a].role&&(this.lodNode=this.children[a])}}var l};r.prototype.constructor=r,r.prototype.setDocument=function(e){this.lmvDocument=e},r.prototype.getDocument=function(){return this.lmvDocument},r.prototype.isOtg=function(){return!!this._getOtgManifest()},r.prototype._getOtgManifest=function(){if("undefined"!=typeof DISABLE_OTG&&DISABLE_OTG)return null;var e=this.findViewableParent();return e?e.data.otg_manifest:null},r.prototype.getOtgGraphicsNode=function(){if(this.isViewPreset())return this.findParentGeom2Dor3D().getOtgGraphicsNode();var e=this._getOtgManifest();return e&&e.views&&e.views[this.guid()]},r.prototype.getPropertyDbManifest=function(){var e,t=this._getOtgManifest();if(t&&t.pdb_manifest){var n=t.pdb_manifest;e={};for(var i=0;i<n.assets.length;i++){var r=n.assets[i];o=r.isShared?t.paths.shared_root+n.pdb_shared_rel_path:t.paths.version_root+n.pdb_version_rel_path,e[r.tag]=[o+r.uri]}}else{var o;null===(o=this.findPropertyDbPath())&&(console.warn("Missing property database entry in manifest."),o=""),0===o.indexOf("$file$")&&(console.warn("Bubble local path given for shared property DB files. Assuming that sharedPropertyDbPath is specified correctly by loadDocumentNode()."),o=""),e={attrs:[o+"objects_attrs.json.gz"],values:[o+"objects_vals.json.gz"],avs:[o+"objects_avs.json.gz"],offsets:[o+"objects_offs.json.gz"],ids:[o+"objects_ids.json.gz"]}}return e},r.prototype.getRootNode=function(){return this.parent?this.parent.getRootNode():this},r.prototype.isForgeManifest=function(){return"manifest"===this.getRootNode().data.type},r.prototype.findPropertyDbPath=function(){var e=this._getOtgManifest(),t=e&&e.views&&e.views[this.guid()];return t&&!t.error?e.paths.version_root:this.sharedPropertyDbPath?this.sharedPropertyDbPath:this.parent?this.parent.findPropertyDbPath():null},r.prototype._raw=function(){return this.data},r.prototype.name=function(){return this.data.name||""},r.prototype.guid=function(){return this.data.guid},r.prototype.type=function(){return this.data.type},r.prototype.extensions=function(){if(this.data.extensions)return Array.isArray(this.data.extensions)?this.data.extensions:[this.data.extensions]},r.prototype.urn=function(e){var t=this.data.urn;if(!e)return t;for(var n=this.parent;!t&&n;)t=n.data.urn,n=n.parent;return t},r.prototype.isGeomLeaf=function(){return this.isLeaf},r.prototype.isViewable=function(){return"viewable"===this.data.role||"svf"===this.data.outputType},r.prototype.getLodNode=function(){return this.lodNode},r.prototype.isGeometry=function(){return"geometry"===this.data.type},r.prototype.isViewPreset=function(){return"view"===this.data.type},r.prototype.is2D=function(){return"2d"===this.data.role},r.prototype.is3D=function(){return"3d"===this.data.role},r.prototype.is2DGeom=function(){return this.isGeometry()&&this.is2D()},r.prototype.is3DGeom=function(){return this.isGeometry()&&this.is3D()},r.prototype.useAsDefault=function(){return!0===this.data.useAsDefault},r.prototype.getPlacementTransform=function(){if(!this.is2DGeom())return this.findViewableParent().getTag("placement");var e=this.findViewableParent().data.sheet_extras;if(e&&e.placements){var t=e.placements[this.data.viewableID];if(t)return t}},r.prototype.getHash=function(){var e=this.findViewableParent().data.sheet_extras;return e&&e.hashes_v1?e.hashes_v1[this.data.viewableID]:null},r.prototype.getViewBox=function(){return this.data.viewbox},r.prototype.isMetadata=function(){if(this.data.role){if(-1!==this.data.role.indexOf("Autodesk.CloudPlatform.DesignDescription"))return!0;if("Autodesk.CloudPlatform.PropertyDatabase"===this.data.role)return!0}return!1},r.prototype.findViewableParent=function(){for(var e=null,t=this;t;)t.isViewable()&&(e=t),t=t.parent;if(!e&&!this.parent&&this.children)for(var n=0;n<this.children.length;n++){var i=this.children[n];if(i.isViewable()){e=i;break}}return e},r.prototype.findParentGeom2Dor3D=function(e){for(var t=this;t&&!t.is2DGeom()&&!t.is3DGeom();)t=t.parent;!t&&this.isViewPreset()&&(t=this.findGeometryFromSiblings()[0],e&&e.fallbackParent&&(t=e.fallbackParent));return t},r.prototype.findGeometryFromSiblings=function(){var e=this.parent;if(!e)return[];for(var t=[],n=0,i=e.children.length;n<i;++n){var r,o=e.children[n];if(o!==this)o.traverse(function(e){if(e.isGeometry()&&(e.is2D()||e.is3D()))return r=e,!0}),r&&t.push(r)}return t},r.prototype.findAllViewables=function(){var e=[];this.isForgeManifest()&&(e=this.search({outputType:"svf"}));var t=this.search({role:"viewable"});return e.concat(t)},r.prototype.getViewableRootPath=function(e){if(!this.isGeomLeaf())return null;var t=this.getOtgGraphicsNode();if(t&&!t.error)return this._getOtgManifest().paths.version_root+t.urn;if(!e&&this.is2D()){var n=this.search({role:"leaflet"});if(n&&n.length)return n[0].urn()}var i=this.is2D()?"application/autodesk-f2d":"application/autodesk-svf",r=this.search({mime:i});return r&&r.length?r[0].urn():null},r.prototype.getNamedViews=function(){var e=this.search({type:"view"});return e=e.filter(function(e){return!!e.data.name&&!!Array.isArray(e.data.camera)})},r.prototype.findByGuid=function(e){var t=null;return this.traverse(function(n){if(n.data.guid===e)return t=n,!0}),t},r.prototype.search=function(e){var t=[];return this.traverse(function(n){var i=!0;for(var r in e)if(!n.data.hasOwnProperty(r)||n.data[r]!==e[r]){i=!1;break}i&&t.push(n)}),t},r.prototype.traverse=function(e){if(e(this))return!0;if(this.children)for(var t=0;t<this.children.length;t++)if(this.children[t].traverse(e))return!0;return!1},r.prototype.getShallowCopySource=function(e){if(!this.isViewable())return console.error("getShallowCopySource must be called with a viewable node."),null;e||(e=this.parent.urn());var t=this.urn();return t!==e&&(t?(console.log("Redirecting shallow copied URN ".concat(e," to ").concat(t)),e=t):console.warn("Unexpected: manifest viewable node does not have a urn property.\n".concat(JSON.stringify(this._raw())))),e},r.prototype.getTag=function(e){return(this.data.tags?this.data.tags:this.data)[e]},r.prototype.setTag=function(e,t){this.data.tags?this.data.tags[e]=t:this.data[e]=t},r.prototype.getAecModelData=function(){var e=this.findViewableParent();return e?e.data.aec_model_data:null},r.prototype.extractRefPointTransform=function(){var e=this.getAecModelData();return e&&e.refPointTransformation&&r.readMatrixFromArray12(e.refPointTransformation)},r.prototype.searchByTag=function(e){var t=[];return this.traverse(function(n){var i=!0;for(var r in e)if(n.getTag(r)!==e[r]){i=!1;break}i&&t.push(n)}),t.length?t:null},r.prototype.extractRevitMetadata=function(){var e=this.data;if(e.hasOwnProperty("levelNumber")){var t=e.levelNumber,n=e.levelName||t,i=this.findViewableParent();i&&(i.levelNumToName=i.levelNumToName||{},i.levelNameToNum=i.levelNameToNum||{},i.levelNumToName[t]=n,i.levelNameToNum[n]=t)}if(e.placement&&"2d"===e.role){for(var r=!0,o=0;o<11;o++)if(0!==e.placement[o]&&1!==e.placement[o]){r=!1;break}r&&(e.placement[12]*=-1,e.placement[13]*=-1,e.placement[14]*=-1)}},r.prototype.extractCamera=function(){if(this.data.camera)return r.readCameraFromArray(this.data.camera);var e=this.isGeometry()&&this.search({type:"view"})[0];return e?e.extractCamera():null},r.prototype.getLevel=function(){var e=this.data.levelNumber;return Array.isArray(e)?e[0]:e},r.prototype.getLevelName=function(){return this.data.levelName||this.getLevel()},r.readCameraFromArray=function(e,t){if(!Array.isArray(e))return null;var n=t||{x:0,y:0,z:0},i={position:new THREE.Vector3(e[0]-n.x,e[1]-n.y,e[2]-n.z),target:new THREE.Vector3(e[3]-n.x,e[4]-n.y,e[5]-n.z),up:new THREE.Vector3(e[6],e[7],e[8]),aspect:e[9],fov:THREE.Math.radToDeg(e[10]),orthoScale:e[11],isPerspective:!e[12]};return 0===e[10]&&1===e[11]&&1===e[12]&&(i.orthoScale=i.position.distanceTo(i.target)),i},r.readMatrixFromArray12=function(e){return(new THREE.Matrix4).fromArray([e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,e[9],e[10],e[11],1])},r.MODEL_NODE={role:"3d",type:"geometry"},r.GEOMETRY_SVF_NODE={role:"graphics",mime:"application/autodesk-svf"},r.SHEET_NODE={role:"2d",type:"geometry"},r.LEAFLET_NODE={role:"leaflet"},r.PDF_PAGE_NODE={role:"pdf-page"},r.IMAGE_NODE={role:"image"},r.GEOMETRY_F2D_NODE={role:"graphics",mime:"application/autodesk-f2d"},r.VIEWABLE_NODE={role:"viewable"},r.AEC_MODEL_DATA={role:"Autodesk.AEC.ModelData"}},function(e,t,n){"use strict";n.r(t),n.d(t,"FrustumIntersector",function(){return o}),n.d(t,"OUTSIDE",function(){return l}),n.d(t,"INTERSECTS",function(){return c}),n.d(t,"CONTAINS",function(){return u}),n.d(t,"CONTAINMENT_UNKNOWN",function(){return h});var i=n(0),r=[[1,5,4,7,3,2,6],[0,3,2,1,5,4,6],[0,3,2,6,5,4,6],[0,4,7,3,2,1,6],[0,3,2,1,-1,-1,4],[0,3,2,6,5,1,6],[0,4,7,6,2,1,6],[0,3,7,6,2,1,6],[0,3,7,6,5,1,6],[0,1,5,4,7,3,6],[0,1,5,4,-1,-1,4],[0,1,2,6,5,4,6],[0,4,7,3,-1,-1,4],[-1,-1,-1,-1,-1,-1,0],[1,2,6,5,-1,-1,4],[0,4,7,6,2,3,6],[2,3,7,6,-1,-1,4],[1,2,3,7,6,5,6],[0,1,5,6,7,3,6],[0,1,5,6,7,4,6],[0,1,2,6,7,4,6],[0,4,5,6,7,3,6],[4,5,6,7,-1,-1,4],[1,2,6,7,4,5,6],[0,4,5,6,2,3,6],[2,3,7,4,5,6,6],[1,2,3,7,4,5,6]];function o(){this.frustum=new i.Frustum,this.viewProj=new i.Matrix4,this.viewDir=[0,0,1],this.ar=1,this.viewport=new i.Vector3(1,1,1),this.areaConv=1,this.areaCullThreshold=1,this.eye=new i.Vector3,this.perspective=!1}var a,s,l=0,c=1,u=2,h=-1;function d(e,t,n){return n.x=1&t?e.max.x:e.min.x,n.y=2&t?e.max.y:e.min.y,n.z=4&t?e.max.z:e.min.z,n}o.OUTSIDE=l,o.INTERSECTS=c,o.CONTAINS=u,o.CONTAINMENT_UNKNOWN=h,o.prototype.reset=function(e,t){this.viewProj.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.perspective=e.isPerspective,this.frustum.setFromMatrix(this.viewProj);var n=e.matrixWorldInverse.elements;this.ar=e.aspect,this.viewDir[0]=-n[2],this.viewDir[1]=-n[6],this.viewDir[2]=-n[10],this.eye.x=e.position.x,this.eye.y=e.position.y,this.eye.z=e.position.z,this.areaConv=e.clientWidth*e.clientHeight/4,this.cutPlanes=t},o.prototype.projectedArea=function(){var e=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3],t=new i.Box2;function n(e,t){var n=e.x,i=e.y,r=e.z,o=t.elements,a=o[3]*n+o[7]*i+o[11]*r+o[15];a<0&&(a=-a);var s=1/a;e.x=(o[0]*n+o[4]*i+o[8]*r+o[12])*s,e.y=(o[1]*n+o[5]*i+o[9]*r+o[13])*s}return function(i){if(i.empty())return 0;var r=this.viewProj;e[0].set(i.min.x,i.min.y,i.min.z),e[1].set(i.min.x,i.min.y,i.max.z),e[2].set(i.min.x,i.max.y,i.min.z),e[3].set(i.min.x,i.max.y,i.max.z),e[4].set(i.max.x,i.min.y,i.min.z),e[5].set(i.max.x,i.min.y,i.max.z),e[6].set(i.max.x,i.max.y,i.min.z),e[7].set(i.max.x,i.max.y,i.max.z);for(var o=0;o<8;o++)n(e[o],r);return t.makeEmpty(),t.setFromPoints(e),t.min.x<-1&&(t.min.x=-1),t.min.x>1&&(t.min.x=1),t.min.y<-1&&(t.min.y=-1),t.min.y>1&&(t.min.y=1),t.max.x>1&&(t.max.x=1),t.max.x<-1&&(t.max.x=-1),t.max.y>1&&(t.max.y=1),t.max.y<-1&&(t.max.y=-1),(t.max.x-t.min.x)*(t.max.y-t.min.y)}}(),o.prototype.projectedBoxArea=function(){for(var e,t=[],n=[],o=0;o<10;o++)t.push(new i.Vector3),n.push(new i.Vector3);function a(e,t){var n=e.x,i=e.y,r=e.z,o=t.elements,a=o[3]*n+o[7]*i+o[11]*r+o[15];a<0&&(a=-a);var s=1/a;e.x=(o[0]*n+o[4]*i+o[8]*r+o[12])*s,e.y=(o[1]*n+o[5]*i+o[9]*r+o[13])*s}return function(i,o){if(i.empty())return 0;var s,l=this.viewProj;if(this.perspective?(s=this.eye.x>=i.min.x?this.eye.x>i.max.x?2:1:0,this.eye.y>=i.min.y&&(s+=this.eye.y>i.max.y?6:3),this.eye.z>=i.min.z&&(s+=this.eye.z>i.max.z?18:9)):(s=this.viewDir[0]<=0?this.viewDir[0]<0?2:1:0,this.viewDir[1]<=0&&(s+=this.viewDir[1]<0?6:3),this.viewDir[2]<=0&&(s+=this.viewDir[2]<0?18:9)),13===s)return 4;var c,u=r[s][6];for(c=0;c<u;c++){var h=r[s][c];t[c].set((h+1)%4<2?i.min.x:i.max.x,h%4<2?i.min.y:i.max.y,h<4?i.min.z:i.max.z),a(t[c],l)}var d=0;if(o)for(d=(t[u-1].x-t[0].x)*(t[u-1].y+t[0].y),c=0;c<u-1;c++)d+=(t[c].x-t[c+1].x)*(t[c].y+t[c+1].y);else{var f=function(t,i){var r,o,a,s,l,c,u,h,d=t,f=n,p=function(e){switch(u){case 0:return e.x>=-1;case 1:return e.x<=1;case 2:return e.y>=-1;case 3:return e.y<=1}},m=function(e){f[h].x=e.x,f[h++].y=e.y},g=function(){var e,t;switch(u){case 0:e=-1,t=o.y+(a.y-o.y)*(e-o.x)/(a.x-o.x);break;case 1:e=1,t=o.y+(a.y-o.y)*(e-o.x)/(a.x-o.x);break;case 2:t=-1,e=o.x+(a.x-o.x)*(t-o.y)/(a.y-o.y);break;case 3:t=1,e=o.x+(a.x-o.x)*(t-o.y)/(a.y-o.y)}f[h].x=e,f[h++].y=t};for(u=0;u<4&&i>2;u++){for(h=0,s=p(o=d[i-1]),c=0;c<i;c++)l=p(a=d[c]),s?l?m(a):g():l&&(g(),m(a)),o=a,s=l;i=h,r=d,d=f,f=r}return e=i,d}(t,u);if(e>=3)for(d=(f[e-1].x-f[0].x)*(f[e-1].y+f[0].y),c=0;c<e-1;c++)d+=(f[c].x-f[c+1].x)*(f[c].y+f[c+1].y)}return Math.abs(.5*d)}}(),o.prototype.estimateDepth=function(e){var t=this.viewProj.elements,n=(e.min.x+e.max.x)/2,i=(e.min.y+e.max.y)/2,r=(e.min.z+e.max.z)/2,o=1/(t[3]*n+t[7]*i+t[11]*r+t[15]);return(t[2]*n+t[6]*i+t[10]*r+t[14])*o},o.prototype.intersectsBox=(a=new i.Vector3,s=new i.Vector3,function(e){for(var t=this.frustum.planes,n=0,i=0;i<6;i++){var r=t[i];a.x=r.normal.x>0?e.min.x:e.max.x,s.x=r.normal.x>0?e.max.x:e.min.x,a.y=r.normal.y>0?e.min.y:e.max.y,s.y=r.normal.y>0?e.max.y:e.min.y,a.z=r.normal.z>0?e.min.z:e.max.z,s.z=r.normal.z>0?e.max.z:e.min.z;var l=r.distanceToPoint(a),c=r.distanceToPoint(s);if(l<0&&c<0)return o.OUTSIDE;l>0&&c>0&&n++}return 6==n?o.CONTAINS:o.INTERSECTS});var f,p=function(e,t){f||(f=new i.Vector3);for(var n=0;n<8;n++){var r=d(e,n,f);if(a=t,!((o=r).x*a.x+o.y*a.y+o.z*a.z+a.w>1e-6))return!1}var o,a;return!0};o.prototype.boxOutsideCutPlanes=function(e){if(!this.cutPlanes)return!1;for(var t=0;t<this.cutPlanes.length;t++){var n=this.cutPlanes[t];if(p(e,n))return!0}return!1}},function(e,t,n){"use strict";n.r(t),n.d(t,"DockingPanel",function(){return o});var i=n(9),r=n(16);function o(e,t,n,i){this.kMinWdth=100,this.kMinHeight=100,this.visibilityCallbacks=[],this.movedSinceLastClick=!1,this.movedSinceCreate=!1,this.parentContainer=e,this.container=document.createElement("div"),this.container.id=t,this.container.lastWidth="",this.container.dockRight=!1,this.container.dockBottom=!1,this.titleLabel=n,(i=i||{}).hasOwnProperty("localizeTitle")||(i.localizeTitle=!0),i.hasOwnProperty("addFooter")||(i.addFooter=!0),this.options=i,this.container.classList.add("docking-panel"),e.appendChild(this.container),this.listeners=[],this.initialize(),this.setVisible(!1)}o.prototype.initialize=function(){this.title=this.createTitleBar(this.titleLabel||this.container.id),this.container.appendChild(this.title),this.initializeMoveHandlers(this.title),this.setTitle(this.titleLabel||this.container.id,this.options),this.closer=this.createCloseButton(),this.container.appendChild(this.closer),this.options.addFooter&&(this.footer=this.createFooter(),this.container.appendChild(this.footer))},o.prototype.uninitialize=function(){for(var e=0;e<this.listeners.length;++e){var t=this.listeners[e];t.target.removeEventListener(t.eventId,t.callback)}this.listeners=[],this.visibilityCallbacks=[],this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.title=null,this.closer=null},o.prototype.addVisibilityListener=function(e){this.visibilityCallbacks.push(e)},o.prototype.setVisible=function(e){if(e){var t=this.getContainerBoundingRect();if(this.container.dockRight){var n=t.width,i=300,r=this.container.lastWidth||this.container.style.width;r||(r=this.container.getBoundingClientRect().width),r&&(i=parseInt(r)),this.container.style.left=n-i+"px"}if(this.container.dockBottom){var o=t.height,a=300,s=this.container.lastHeight||this.container.style.height;s||(s=this.container.getBoundingClientRect().height),s&&(a=parseInt(s));var l=o-a;this.container.style.top=l>0?l+"px":0}this.container.style.maxHeight=t.height+"px",this.container.style.maxWidth=t.width+"px",this.container.style.display="block"}else this.container.lastWidth=this.container.style.width,this.container.lastHeight=this.container.style.height,this.container.style.display="none";for(var c=0;c<this.visibilityCallbacks.length;c++)this.visibilityCallbacks[c](e)},o.prototype.isVisible=function(){return"block"===this.container.style.display},o.prototype.visibilityChanged=function(){},o.prototype.initializeMoveHandlers=function(e){var t,n,i,r,o,a,s,l,c=this.container,u=this;function h(e){var h=c.style.minWidth?parseInt(c.style.minWidth):u.kMinWdth,d=c.style.minHeight?parseInt(c.style.minHeight):u.kMinHeight,f=u.getContainerBoundingRect();c.style.maxWidth&&parseInt(c.style.width)>parseInt(c.style.maxWidth)&&(c.style.width=c.style.maxWidth),c.style.maxHeight&&parseInt(c.style.height)>parseInt(c.style.maxHeight)&&(c.style.height=c.style.maxHeight),parseInt(c.style.width)<h&&(c.style.width=h+"px"),parseInt(c.style.height)<d&&(c.style.height=d+"px"),"touchmove"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),s+=e.screenX-i,l+=e.screenY-r,t=o+s,n=a+l;var p=parseInt(c.style.width),m=parseInt(c.style.height);isNaN(p)&&(p=u.container.getBoundingClientRect().width),isNaN(m)&&(m=u.container.getBoundingClientRect().height),t<5&&(t=0),n<5&&(n=0),c.dockRight=!1,c.dockBottom=!1,f.width-5<t+p&&(t=f.width-p,c.dockRight=!0),f.height-5<n+m&&(n=f.height-m,c.dockBottom=!0),c.style.left=t+"px",c.style.top=n+"px",c.style.maxWidth=f.width-t+"px",c.style.maxHeight=f.height-n+"px",i=e.screenX,r=e.screenY,u.onMove(e,t,n)}function d(e){window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",d),window.removeEventListener("touchmove",h),window.removeEventListener("touchend",d),u.onEndMove(e,t,n)}function f(e){"touchstart"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),i=e.screenX,r=e.screenY,s=0,l=0,o=u.container.offsetLeft,a=u.container.offsetTop,window.addEventListener("mousemove",h,!1),window.addEventListener("mouseup",d,!1),window.addEventListener("touchmove",h,!1),window.addEventListener("touchend",d,!1),e.preventDefault(),u.onStartMove(e,o,a)}u.addEventListener(e,"mousedown",f),u.addEventListener(e,"touchstart",f)},o.prototype.initializeCloseHandler=function(e){var t=this;t.addEventListener(e,"click",function(e){t.setVisible(!1)},!1)},o.prototype.createScrollContainer=function(e){var t=document.createElement("div"),n=t.classList;return n.add("docking-panel-scroll"),n.add("docking-panel-container-solid-color-a"),n.add(e&&e.left?"left":"right"),e&&e.heightAdjustment&&(t.style.height="calc(100% - "+e.heightAdjustment+"px)"),e&&e.marginTop&&(t.style.marginTop=e.marginTop+"px"),t.id=this.container.id+"-scroll-container",this.container.appendChild(t),this.scrollContainer=t,this.scrollEaseCurve=e&&e.scrollEaseCurve||[0,0,.29,1],this.scrollEaseSpeed=e&&e.scrollEaseSpeed||.003,t},o.prototype.createTitleBar=function(e){var t=document.createElement("div");t.classList.add("docking-panel-title"),t.textContent=e;var n=this;return n.addEventListener(t,"click",function(e){n.movedSinceLastClick||n.onTitleClick(e),n.movedSinceLastClick=!1}),n.addEventListener(t,"dblclick",function(e){n.onTitleDoubleClick(e)}),t},o.prototype.createFooter=function(){var e=new r.ResizeFooter(this.container);return this.container.style.resize="none",e.footer},o.prototype.setTitle=function(e,t){t&&t.localizeTitle?(this.title.setAttribute("data-i18n",e),e=i.i18n.translate(e)):this.title.removeAttribute("data-i18n"),this.title.textContent=e},o.prototype.createCloseButton=function(){var e=document.createElement("div");return e.className="docking-panel-close",this.initializeCloseHandler(e),e},o.prototype.onStartMove=function(e,t,n){},o.prototype.onEndMove=function(e,t,n){},o.prototype.onMove=function(e,t,n){this.movedSinceLastClick=!0,this.movedSinceCreate=!0},o.prototype.onTitleClick=function(e){},o.prototype.onTitleDoubleClick=function(e){},o.prototype.addEventListener=function(e,t,n){e.addEventListener(t,n),this.listeners.push({target:e,eventId:t,callback:n})},o.prototype.removeEventListener=function(e,t,n){for(var i=0;i<this.listeners.length;++i){var r=this.listeners[i];if(r.target===e&&r.eventId===t&&r.callback===n)return e.removeEventListener(t,n),this.listeners.splice(i,1),!0}return!1},o.prototype.getContentSize=function(){return{height:this.container.clientHeight,width:this.container.clientWidth}},o.prototype.resizeToContent=function(e){if(this.isVisible()){var t=this.getContentSize().height,n=this.container.getBoundingClientRect(),i=this.getContainerBoundingRect(),r=this.container.querySelector(".docking-panel-footer");r&&(t+=r.getBoundingClientRect().height);var o=i.height;o-=n.top-i.top+75,e&&void 0!==e.maxHeight&&(o=Math.min(o,e.maxHeight)),t>o&&(t=o),this.container.style.maxHeight=o.toString()+"px",this.container.style.height=t.toString()+"px"}},o.prototype.getContainerBoundingRect=function(){return this.parentContainer.getBoundingClientRect()},o.prototype.animateScroll=function(e,t,n){var i=this.scrollEaseCurve,r=this.scrollEaseSpeed,o=this.scrollContainer;var a=performance.now();requestAnimationFrame(function s(l){var c=(l-a)*r;c=Math.min(c,1);var u=function(e,t){var n=3*e[1],i=3*(e[3]-e[1])-n;return(((1-n-i)*t+i)*t+n)*t}(i,c),h=e+(t-e)*u;o.scrollTop=h,n&&n(h),c<1&&requestAnimationFrame(s)})},o.prototype.onViewerResize=function(e,t,n,i,r,o){var a=this.container,s=a.getBoundingClientRect(),l=s.width,c=s.height;if(!l||!c)return!1;var u=s.top,h=s.bottom,d=s.left,f=s.right;return r<l&&(l=Math.round(r),a.style.width=l+"px"),o<c&&(c=Math.round(o),a.style.height=c+"px"),(i<f||a.dockRight)&&(d=Math.round(i-l-n),a.style.left=d+"px"),(t<h||a.dockBottom)&&((u=Math.round(t-c-e))<0&&(u=0),a.style.top=u+"px"),a.style.maxWidth=Math.round(r)+"px",a.style.maxHeight=Math.round(o)+"px",!0}},function(e,t,n){"use strict";n.r(t),n.d(t,"RenderBatch",function(){return u});var i=n(70),r=n(27),o=n(5),a=n(13),s=n(1),l=new(n(37).LmvBox3),c=null;function u(e,t,n,i){this.frags=e,this.indices=t,this.start=n,this.count=i,this.lastItem=n,this.overrideMaterial=null,this.sortDone=!1,this.numAdded=0,this.avgFrameTime=void 0,this.nodeIndex=void 0,this.bboxes=new Array(12),this.bboxes[0]=this.bboxes[1]=this.bboxes[2]=1/0,this.bboxes[3]=this.bboxes[4]=this.bboxes[5]=-1/0,this.bboxes[6]=this.bboxes[7]=this.bboxes[8]=1/0,this.bboxes[9]=this.bboxes[10]=this.bboxes[11]=-1/0,this.sortObjects=!1,this.sortDone=!1,this.sortByShaderDone=!1,this.frustumCulled=!0,this.forceVisible=!1,this.renderImmediate=!e.useThreeMesh,this.renderImportance=0}function h(e,t,n,i,r){var s,l=t[n]&~o.MeshFlags.MESH_RENDERFLAG;switch(e){case a.RenderFlags.RENDER_HIDDEN:s=!(l&o.MeshFlags.MESH_VISIBLE);break;case a.RenderFlags.RENDER_HIGHLIGHTED1:case a.RenderFlags.RENDER_HIGHLIGHTED2:s=l&o.MeshFlags.MESH_HIGHLIGHTED;break;default:s=1==(l&(o.MeshFlags.MESH_VISIBLE|o.MeshFlags.MESH_HIGHLIGHTED|o.MeshFlags.MESH_HIDE))}if(i){var c=l&(o.MeshFlags.MESH_ISLINE|o.MeshFlags.MESH_ISWIDELINE);s=s&&!c}if(r){var u=l&o.MeshFlags.MESH_ISPOINT;s=s&&!u}return t[n]=l|(s?o.MeshFlags.MESH_RENDERFLAG:0),s}function d(e,t,n,i){var r=!1;return n.getWorldBounds(i,l),e&&!t.intersectsBox(l)&&(r=!0),!r&&t.boxOutsideCutPlanes(l)&&(r=!0),r}u.prototype.getIndices=function(){return Array.isArray(this.indices)?this.indices[0]:this.indices},u.prototype.sortByMaterial=function(){if(!(this.numAdded<this.count)){var e=this.frags,t=this.getIndices();if(t){var n=t.subarray(this.start,this.start+this.count);Array.prototype.sort.call(n,function(t,n){var i=e.getMaterialId(t),r=e.getMaterialId(n);return void 0===i?r?1:0:void 0===r?-1:i-r}),this.numAdded=0,this.sortDone=!0}else s.logger.warn("Only indexed RenderSubsets can be sorted.")}},u.prototype.sortByShader=function(){if(this.sortDone&&!this.sortByShaderDone){var e=this.frags,t=this.getIndices().subarray(this.start,this.start+this.count);Array.prototype.sort.call(t,function(t,n){var i=e.getMaterial(t),r=e.getMaterial(n),o=i.program.id-r.program.id;return o||i.id-r.id}),this.numAdded=0,this.sortByShaderDone=!0}},u.prototype.sortByDepth=function(){var e,t,n,i,r,o;function a(t,o){e.getGeometry(t)?(e.getWorldBounds(t,i),r[o]=n.estimateDepth(i)):r[o]=-1/0}return function(u){if(e=this.frags,t=this.getIndices(),n=u,i=l,t){var h,d;(!c||c.length<this.count)&&(c=new Float32Array(this.count)),r=c,o=this.start,this.forEachNoMesh(a);for(var f=1;f<this.count;f++)for(var p=f;p>0&&r[p-1]<r[p];)h=r[p-1],r[p-1]=r[p],r[p]=h,d=t[o+p-1],t[o+p-1]=t[o+p],t[o+p]=d,p--}else s.logger.warn("Only indexed RenderSubsets can be sorted.")}}(),u.prototype.addToBox=function(e,t){var n=t?6:0,i=this.bboxes;i[0+n]=Math.min(i[0+n],e.min.x),i[1+n]=Math.min(i[1+n],e.min.y),i[2+n]=Math.min(i[2+n],e.min.z),i[3+n]=Math.max(i[3+n],e.max.x),i[4+n]=Math.max(i[4+n],e.max.y),i[5+n]=Math.max(i[5+n],e.max.z)},u.prototype.getBoundingBox=function(e){e=e||l;var t=this.bboxes;return e.min.x=t[0],e.min.y=t[1],e.min.z=t[2],e.max.x=t[3],e.max.y=t[4],e.max.z=t[5],e},u.prototype.getBoundingBoxHidden=function(e){e=e||l;var t=this.bboxes;return e.min.x=t[6],e.min.y=t[7],e.min.z=t[8],e.max.x=t[9],e.max.y=t[10],e.max.z=t[11],e},u.prototype.onFragmentAdded=function(e){this.frags.getWorldBounds(e,l),this.addToBox(l,!1),this.sortDone=!1,this.lastItem<=e&&(this.lastItem=e+1,void 0!==this.visibleStats&&(this.visibleStats=0),this.numAdded++)},u.prototype.forEach=function(e,t,n){var i,r,a,s=this.getIndices(),l=this.frags,c=!this.sortByShaderDone;if(t||n||c)for(i=t===o.MeshFlags.MESH_RENDERFLAG&&this.hasOwnProperty("drawStart")?this.drawStart:this.start,r=this.lastItem;i<r;i++){a=s?s[i]:i;u=l.getVizmesh(a,this.renderImportance);!c||u&&u.material&&u.material.program&&!u.geometry_proxy||(c=!1),!(n||u&&u.geometry)||t&&!l.isFlagSet(a,t)||e(u,a)}else for(i=this.start,r=this.lastItem;i<r;i++){var u;a=s?s[i]:i,(u=l.getVizmesh(a,this.renderImportance))&&u.geometry&&e(u,a)}c&&this.sortByShader()},u.prototype.forEachNoMesh=function(e,t,n){for(var i=this.getIndices(),r=this.frags,o=this.start,a=this.lastItem;o<a;o++){var s,l=i?i[o]:o;if(r.useThreeMesh){var c=r.getVizmesh(l);c&&(s=c.geometry)}else s=r.getGeometry(l);!n&&!s||t&&!r.isFlagSet(l,t)||e(l,o-this.start)}},u.prototype.raycast=function(e,t,n){if(!1!==e.ray.isIntersectionBox(this.getBoundingBox())){var r=this,a=l;this.forEach(function(s,l){if(!r.frags.isFlagSet(l,o.MeshFlags.MESH_HIDE)){if(n&&n.length){var c=0|r.frags.getDbIds(l);if(-1===n.indexOf(c))return}r.frags.getWorldBounds(l,a),a.expandByScalar(.5),e.ray.isIntersectionBox(a)&&i.VBIntersector.rayCast(s,e,t)}},o.MeshFlags.MESH_VISIBLE)}},u.prototype.calculateBounds=function(){var e,t,n,i;function r(r){t.getWorldBounds(r,n);var o=e[r];i.addToBox(n,!(1&o))}return function(){this.bboxes[0]=this.bboxes[1]=this.bboxes[2]=1/0,this.bboxes[3]=this.bboxes[4]=this.bboxes[5]=-1/0,this.bboxes[6]=this.bboxes[7]=this.bboxes[8]=1/0,this.bboxes[9]=this.bboxes[10]=this.bboxes[11]=-1/0,e=this.frags.vizflags,t=this.frags,n=l,i=this,this.forEachNoMesh(r,0,!0)}}(),u.prototype.applyVisibility=function(){var e,t,n,i,l,c;function u(r,a){if((r||!e.useThreeMesh)&&r.geometry){if(d(l,n,e,a))return r?r.visible=!1:s.logger.warn("Unexpected null mesh"),void(t[a]=t[a]&~o.MeshFlags.MESH_RENDERFLAG);var u=h(i,t,a,e.linesHidden,e.pointsHidden);r&&(r.visible=!!u),c=c&&!u}}function f(r){if(e.getGeometryId(r))if(d(l,n,e,r))t[r]=t[r]&~o.MeshFlags.MESH_RENDERFLAG;else{var a=h(i,t,r,e.linesHidden,e.pointsHidden);c=c&&!a}}return function(o,s){c=!0,n=s;var h=(i=o)===a.RenderFlags.RENDER_HIDDEN?this.getBoundingBoxHidden():this.getBoundingBox(),d=n.intersectsBox(h);return d===r.FrustumIntersector.OUTSIDE?c:s.boxOutsideCutPlanes(h)?c:(t=this.frags.vizflags,e=this.frags,l=d!==r.FrustumIntersector.CONTAINS,e.useThreeMesh?this.forEach(u,null):this.forEachNoMesh(f,0,!1),c)}}()},function(e,t,n){"use strict";n.r(t),n.d(t,"KeyCode",function(){return i});var i={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,SEMICOLONMOZ:59,EQUALSMOZ:61,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,LCOMMAND:91,RCOMMAND:93,PLUS:107,PLUSMOZ:171,DASHMOZ:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DASHMOZNEW:173,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,LBRACKET:219,RBRACKET:221,SINGLEQUOTE:222,COMMANDMOZ:224}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(22),r=n(0),o=function(e,t){this.textureID=void 0!==t?t:"tDiffuse",this.material=Object(i.createShaderMaterial)(e),this.uniforms=this.material.uniforms,this.renderToScreen=!1,this.enabled=!0,this.clear=!1,this.camera=new r.OrthographicCamera(-1,1,1,-1,0,1);var n=new r.BufferGeometry,o=new Float32Array(9);o[0]=-1,o[1]=-1,o[2]=0,o[3]=3,o[4]=-1,o[5]=0,o[6]=-1,o[7]=3,o[8]=0;var a=new Float32Array(6);a[0]=0,a[1]=0,a[2]=2,a[3]=0,a[4]=0,a[5]=2;var s=new Float32Array(9);s[0]=0,s[1]=0,s[2]=1,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=1,n.addAttribute("position",new r.BufferAttribute(o,3)),n.addAttribute("normal",new r.BufferAttribute(s,3)),n.addAttribute("uv",new r.BufferAttribute(a,2)),this.quad=new r.Mesh(n,this.material),this.scene=new r.Scene,this.scene.add(this.quad)};o.prototype={render:function(e,t,n,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture||n),this.renderToScreen||!t?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"EventDispatcher",function(){return i});var i=function(){};i.prototype={constructor:i,apply:function(e){e.addEventListener=i.prototype.addEventListener,e.hasEventListener=i.prototype.hasEventListener,e.removeEventListener=i.prototype.removeEventListener,e.clearListeners=i.prototype.clearListeners,e.fireEvent=i.prototype.fireEvent,e.dispatchEvent=i.prototype.fireEvent,e.debugEvents=i.prototype.debugEvents},addEventListener:function(e,t,n){e&&(void 0===this.listeners&&(this.listeners={}),void 0===this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].push({callbackFn:t,once:!!n&&!!n.once}))},hasEventListener:function(e,t){if(!e)return!1;if(void 0===this.listeners)return!1;var n=this.listeners[e];if(!n||0===n.length)return!1;for(var i=0,r=n.length;i<r;++i)if(n[i].callbackFn===t)return!0;return!1},removeEventListener:function(e,t){if(e)if(void 0!==this.listeners){var n=this.listeners[e];if(n)for(var i=0,r=n.length;i<r;++i)if(n[i].callbackFn===t){n.splice(i,1);break}}else this.listeners={}},clearListeners:function(){this.listeners=null},dispatchEvent:function(e){if(void 0!==this.listeners){if("string"==typeof e&&(e={type:e}),!e.target)try{e.target=this}catch(e){}if(!e.type)throw new Error("event type unknown.");if(this._doDebug&&console.log("Event: "+e.type),Array.isArray(this.listeners[e.type])){for(var t=this.listeners[e.type].slice(),n=[],i=0,r=t.length;i<r;++i)t[i].callbackFn.call(this,e),t[i].once&&n.push(t[i].callbackFn);for(var o=0;o<n.length;++o)this.removeEventListener(e.type,n[o])}}else this.listeners={}},debugEvents:function(e){this._doDebug=e}},i.prototype.fireEvent=i.prototype.dispatchEvent,"undefined"!=typeof Autodesk&&(Autodesk.Viewing.EventDispatcher=i)},function(e,t,n){"use strict";n.r(t),n.d(t,"TextureLoader",function(){return A});var i=n(12),r=n(3),o=n(7),a=n(45),s=n(94),l=n(1),c=n(0),u=n(86),h=n(4),d=new(n(165));d.max=Object(r.isMobileDevice)()?4:6;var f=0,p=Object(r.isMobileDevice)()?32:1/0;p*=1048576;var m=0,g=1/0;function v(e){var t;!0===e.image.wasNPOT&&((t=e).format===c.AlphaFormat||t.format===c.RGBAFormat)&&function(e){return e.clampS||e.clampT}(e)&&function(e){return e.minFilter!==c.NearestFilter&&e.minFilter!==c.LinearFilter}(e)&&Object(r.isChrome)()&&Object(r.isWindows)()&&(e.minFilter=c.LinearFilter,e.generateMipmaps=!1,e.needsUpdate=!0)}function y(e,t,n,a,s,p,m){var y=!t&&h.endpoint.getUseCredentials()||h.endpoint.getCdnUsesCredentials();y?c.ImageUtils.crossOrigin="use-credentials":h.endpoint.getUseCredentials()?c.ImageUtils.crossOrigin="anonymous":c.ImageUtils.crossOrigin="";var _="";y&&s&&(_="acmsession="+s),m&&m.queryParams&&(_=_?_+"&":"",_+=m.queryParams);var b=h.endpoint.initLoadContext({queryParams:_});f++,d.go(function(s){var h=function(e){f--,a(e),s()},d=p?h:function(e){f--,e&&e.image&&(e.image=function(e){var t,n,i=e.width,r=e.height;if(0==(i&i-1)&&0==(r&r-1)){if(i*r<=g)return e;t=i,n=r}else{for(t=1;1.5*t<i;)t*=2;for(n=1;1.5*n<r;)n*=2}for(;t*n>g;)t=Math.max(t/2,1),n=Math.max(n/2,1);var o=document.createElement("canvas"),a=o.getContext("2d");return o.width=t,o.height=n,o.wasNPOT=!0,a.drawImage(e,0,0,t,n),o}(e.image)),a(e),s()},_=function(e){f--,l.logger.error("Texture load error",e),a(null),s()};if(Object(r.isNodeJS)())!function(e,t,n,r,a){var s=new c.DataTexture(void 0,n);i.ViewingService.getItem(t,e,function(e){a&&a.extractImage&&(e=a.extractImage(e)),s.image={data:e,width:void 0,height:void 0},s.needsUpdate=!0,r&&r(s)},function(e,t){var n="Error: "+e+" ("+t+")";l.logger.error(n,Object(o.errorCodeString)(o.ErrorCodes.NETWORK_SERVER_ERROR)),r&&r(null)})}(e,b,n,h,m);else if(".dds"===e.slice(e.length-4).toLocaleLowerCase())if(Object(r.isIOSDevice)()){var x=e.slice(0,e.length-4)+".pvr";(new PVRLoader).load(x+"?"+b.queryParams,h,_)}else(new u.DDSLoader).load(e+"?"+b.queryParams,h,_);else y&&!t||m&&(m.rawData||m.extractImage)?function(e,t,n,r,a){var s=new c.Texture(void 0,n);function u(e){a&&a.extractImage&&(e=a.extractImage(e));var t,n,i=new Image;s.image=i,v(s),i.onload=function(){s.needsUpdate=!0,r&&r(s),window.URL.revokeObjectURL(i.src)},i.onerror=function(e){l.logger.error(e,Object(o.errorCodeString)(o.ErrorCodes.UNKNOWN_FAILURE)),r&&r(null)},i.src=(t=new Uint8Array(e),n=new Blob([t],{type:"image/jpeg"}),(window.URL||window.webkitURL).createObjectURL(n))}a&&a.rawData?u(a.rawData):i.ViewingService.getItem(t,e,u,function(e,t){var n="Error: "+e+" ("+t+")";l.logger.error(n,Object(o.errorCodeString)(o.ErrorCodes.NETWORK_SERVER_ERROR)),r&&r(null)})}(e,b,n,d,m):c.ImageUtils.loadTexture(b.queryParams?e+"?"+b.queryParams:e,n,d,_)})}function _(e,t,n){var r=t.getData();var o=t.isOTG()?function(e){var t=h.endpoint.initLoadContext({});return{path:r.makeSharedResourcePath(t.otg_cdn,"textures",e),isShared:!!t.otg_cdn}}(e):function(e){for(var t=null,n=0;n<r.manifest.assets.length;++n){var o=r.manifest.assets[n];if(o.id.toLowerCase()==e.toLowerCase()){t=Object(i.pathToURL)(r.basePath+o.URI);break}}return t||(t=Object(i.pathToURL)(r.basePath+e)),{path:t,isShared:!1}}(e);return y(o.path,o.isShared,c.UVMapping,n,r.acmSessionId)}function b(e,t,n){if(t.textureMaps&&!t.texturesLoaded){t.texturesLoaded=!0;var i=e.getData(),r=t.textureMaps;for(var o in r){var s=r[o];if(!n.matman().loadTextureFromCache(e,t,s,o))_(s.uri,e,function(t){return function(r){if(r){var o=i.materials.scene.SceneUnit,s=n.renderer()?n.renderer().getMaxAnisotropy():0;a.MaterialConverter.convertTexture(t,r,o,s)}var l=n.matman();l&&(l.setTextureInCache(e,t,r),i.loadOptions.onTextureReceived&&i.loadOptions.onTextureReceived(l,t,r,!x()),!x()&&n&&i.loadDone&&!i.texLoadDone&&(i.texLoadDone=!0,n.onTextureLoadComplete(e)))}}(s))}}}function x(){return f}function w(e){e>=0&&(m=e,g=Math.max(16384,p/(4*m)))}var A={loadTextureWithSecurity:y,loadMaterialTextures:b,loadModelTextures:function(e,t){var n=t.matman(),i=n._getModelHash(e),r=0;if(e.isOTG())r=e.getData().metadata.stats.num_textures||0;else for(var o in n._materials)-1!==o.indexOf(i)&&(a=n._materials[o]).textureMaps&&(r+=Object.keys(a.textureMaps).length);for(var o in w(r),n._materials){var a;-1!==o.indexOf(i)&&b(e,a=n._materials[o],t)}var s=e.getData();!x()&&t&&s.loadDone&&!s.texLoadDone&&(s.texLoadDone=!0,t.onTextureLoadComplete(e))},loadCubeMap:function(e,t,n){var i,r=function(i){i?(i.mapping=c.CubeReflectionMapping,i.LogLuv=-1!==e.indexOf("logluv"),i.RGBM=-1!==e.indexOf("rgbm"),Object(s.DecodeEnvMap)(i,t,!1,n)):n&&n(i)};return c.ImageUtils.crossOrigin="",Array.isArray(e)?(i=c.ImageUtils.loadTextureCube(e,c.CubeReflectionMapping,r)).format=c.RGBFormat:"string"==typeof e?-1!==e.toLowerCase().indexOf(".dds")?i=(new u.DDSLoader).load(e,r):(i=c.ImageUtils.loadTexture(e,c.SphericalReflectionMapping,n)).format=c.RGBFormat:e?n&&n(e):n&&n(null),i},requestsInProgress:x,calculateTextureSize:function(e){var t=4;switch(e.format){case c.AlphaFormat:t=1;break;case c.RGBFormat:t=3;break;case c.LuminanceFormat:t=1;break;case c.LuminanceAlphaFormat:t=2}switch(e.type){case c.ShortType:case c.UnsignedShortType:case c.HalfFloatType:t*=2;break;case c.IntType:case c.UnsignedIntType:case c.FloatType:t*=4;break;case c.UnsignedShort4444Type:case c.UnsignedShort5551Type:case c.UnsignedShort565Type:t=2}var n=t*e.image.width;return n+=e.unpackAlignment-1,n-=n%e.unpackAlignment,e.image.height*n},imageToCanvas:function(e){var t=e.width,n=e.height,i=document.createElement("canvas"),r=i.getContext("2d");return r.globalCompositeOperation="copy",i.width=t,i.height=n,r.drawImage(e,0,0,t,n),i}}},function(e,t,n){"use strict";n.r(t),n.d(t,"ProgressState",function(){return i});var i={ROOT_LOADED:0,LOADING:1,RENDERING:2}},function(e,t,n){"use strict";n.r(t),n.d(t,"ControlGroup",function(){return r});var i=n(19);function r(e,t){i.Control.call(this,e,t);var n=this;this._controls=[],this.addClass("adsk-control-group"),this.handleChildSizeChanged=function(e){var t={type:r.Event.SIZE_CHANGED,childEvent:e};n.dispatchEvent(t)}}r.Event={VISIBILITY_CHANGED:i.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:i.Control.Event.COLLAPSED_CHANGED,SIZE_CHANGED:"ControlGroup.SizeChanged",CONTROL_ADDED:"ControlGroup.ControlAdded",CONTROL_REMOVED:"ControlGroup.ControlRemoved"},r.prototype=Object.create(i.Control.prototype),r.prototype.constructor=r,r.prototype.addControl=function(e,t){var n=t&&void 0!==t.index?t.index:this._controls.length;if(null!==this.getControl(e.getId()))return!1;var o={type:r.Event.CONTROL_ADDED,control:e,index:n};return n<this._controls.length?(this.container.insertBefore(e.container,this._controls[n].container),this._controls.splice(n,0,e)):(this.container.appendChild(e.container),this._controls.push(e)),e.addEventListener(i.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),e.addEventListener(i.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),e instanceof r&&e.addEventListener(r.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.dispatchEvent(o),this.dispatchEvent(r.Event.SIZE_CHANGED),!0},r.prototype.indexOf=function(e){for(var t=0;t<this._controls.length;t++){var n=this._controls[t];if(n===e||"string"==typeof e&&e===n.getId())return t}return-1},r.prototype.removeControl=function(e){var t="string"==typeof e?this.getControl(e):e;if(!t)return!1;var n=this._controls.indexOf(t);if(-1===n)return!1;this._controls.splice(n,1),this.container.removeChild(t.container);var o={type:r.Event.CONTROL_REMOVED,control:t,index:n};return t.removeEventListener(i.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),t.removeEventListener(i.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),t instanceof r&&t.removeEventListener(r.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.dispatchEvent(o),this.dispatchEvent(r.Event.SIZE_CHANGED),!0},r.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e===this._controls[t].getId())return this._controls[t];return null},r.prototype.getControlId=function(e){return e<0||e>=this._controls.length?null:this._controls[e].getId()},r.prototype.getNumberOfControls=function(){return this._controls.length},r.prototype.setCollapsed=function(e){if(!this._isCollapsible)return!1;var t=!1;return this._controls.forEach(function(n){n.isCollapsible()&&n.setCollapsed(e)&&(t=!0)}),t&&(e?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this.dispatchEvent({type:r.Event.COLLAPSED_CHANGED,isCollapsed:e})),t}},function(e,t){e.exports="varying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},function(e,t,n){"use strict";n.r(t),n.d(t,"LmvBox3",function(){return a});var i,r,o=n(10),a=function(e,t){this.min=void 0!==e?e:new o.LmvVector3(1/0,1/0,1/0),this.max=void 0!==t?t:new o.LmvVector3(-1/0,-1/0,-1/0)};a.prototype={constructor:a,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromArray:function(e,t){return this.min.x=e[t],this.min.y=e[t+1],this.min.z=e[t+2],this.max.x=e[t+3],this.max.y=e[t+4],this.max.z=e[t+5],this},copyToArray:function(e,t){e[t]=this.min.x,e[t+1]=this.min.y,e[t+2]=this.min.z,e[t+3]=this.max.x,e[t+4]=this.max.y,e[t+5]=this.max.z},setFromCenterAndSize:(r=new o.LmvVector3,function(e,t){var n=r.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new o.LmvVector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new o.LmvVector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new o.LmvVector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new o.LmvVector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o.LmvVector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(i=[new o.LmvVector3,new o.LmvVector3,new o.LmvVector3,new o.LmvVector3,new o.LmvVector3,new o.LmvVector3,new o.LmvVector3,new o.LmvVector3],function(e){return i[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),i[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),i[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),i[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),i[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),i[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),i[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),i[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(i),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"EPSILON",function(){return s}),n.d(t,"getSnapResultPosition",function(){return l}),n.d(t,"correctPerpendicularPicks",function(){return c}),n.d(t,"calculateDistance",function(){return u}),n.d(t,"computeResult",function(){return f}),n.d(t,"getFaceArea",function(){return p}),n.d(t,"getCircularArcRadius",function(){return m}),n.d(t,"project",function(){return g}),n.d(t,"inverseProject",function(){return v}),n.d(t,"nearestPointInPointToLine",function(){return y}),n.d(t,"nearestPointInPointToSegment",function(){return _}),n.d(t,"isEqualVectors",function(){return b}),n.d(t,"isInverseVectors",function(){return x}),n.d(t,"getEndPointsInEdge",function(){return w}),n.d(t,"angleVectorToVector",function(){return A}),n.d(t,"nearestPointsInSegmentToSegment",function(){return E}),n.d(t,"isParallel",function(){return M}),n.d(t,"isPerpendicular",function(){return S}),n.d(t,"forAll",function(){return P}),n.d(t,"createCommonOverlay",function(){return L}),n.d(t,"safeToggle",function(){return R}),n.d(t,"getCentroidOfPolygon",function(){return D}),n.d(t,"isPolygonSimple",function(){return O}),n.d(t,"getPolygonVisualCenter",function(){return N});var i=n(0),r=n(6),o=n(46),a=n(83),s=1e-4;function l(e,t){if(!e)return null;if(e.isPerpendicular)return e.intersectPoint;switch(e.geomType){case r.SnapType.SNAP_VERTEX:case r.SnapType.SNAP_MIDPOINT:case r.SnapType.SNAP_CIRCLE_CENTER:return e.getGeometry();case r.SnapType.SNAP_EDGE:var n=w(e.getGeometry()),i=n[0].clone(),o=n[1].clone();return y(e.intersectPoint,i,o);case r.SnapType.SNAP_FACE:return T(e.intersectPoint,e.getGeometry().vertices[0],e.faceNormal);case r.SnapType.SNAP_CIRCULARARC:if(t&&t.model&&t.model.is2d()){var a=C(e.intersectPoint,e.getGeometry());return e.geomType=r.SnapType.SNAP_VERTEX,e.geomVertex=a,a}return e.circularArcCenter;case r.SnapType.SNAP_CURVEDEDGE:return C(e.intersectPoint,e.getGeometry());case r.SnapType.SNAP_CURVEDFACE:return e.intersectPoint;default:return null}}function c(e,t,n,o){if(!(e&&t&&e.getGeometry()&&t.getGeometry()))return!1;var a=l(e,n);if(o&&n)if(t.geomType===r.SnapType.SNAP_EDGE){var s=new i.Vector3,c=new i.Vector3,u=t.getGeometry();if(s.subVectors(t.intersectPoint,a).normalize(),c.subVectors(u.vertices[0],u.vertices[1]).normalize(),S(s,c,.05))if(f=_(a,u.vertices[0],u.vertices[1],!0))return o.onMouseMove(g(f,n))&&o.setPerpendicular(!0),t.geomVertex=f,t.intersectPoint=f,!0}else if(t.geomType===r.SnapType.SNAP_FACE){var h=new i.Vector3,d=t.getGeometry();if(h.subVectors(t.intersectPoint,a).normalize(),M(t.faceNormal,h,.05)){var f=T(a,d.vertices[0],t.faceNormal);return o.onMouseMove(g(f,n))&&o.setPerpendicular(!0),t.geomVertex=f,t.intersectPoint=f,!0}}}function u(e,t,n,i){if(!(e&&t&&e.getGeometry()&&t.getGeometry()))return null;var r,a,c=l(e,i),u=l(t,i);if(!c||!u)return null;if(b(c,u,s))return null;if(i.model.is2d()&&(c=c.clone(),u=u.clone(),i.model.pageToModel(c,u,e.viewportIndex2d)),n){var h=Math.log(2*n)/Math.log(10),d=Math.floor(h);1<2*n/Math.pow(10,d)&&d++,n=Math.pow(10,d);var f=c.distanceTo(u),p=f/n;return r=Math.floor(p+.5)*n,p=(f=Math.abs(c.x-u.x))/n,a=Math.floor(p+.5)*n,p=(f=Math.abs(c.y-u.y))/n,{distanceXYZ:r,distanceX:a,distanceY:Math.floor(p+.5)*n,distanceZ:0,type:o.MeasurementTypes.MEASUREMENT_DISTANCE}}return{distanceXYZ:r=c.distanceTo(u),distanceX:a=Math.abs(c.x-u.x),distanceY:Math.abs(c.y-u.y),distanceZ:Math.abs(c.z-u.z),type:o.MeasurementTypes.MEASUREMENT_DISTANCE}}function h(e,t){var n=[];for(var r in e)if(e.hasOwnProperty(r)){var o=l(e[r],t);o&&n.push(o)}if(3!==n.length||function(e){for(var t=0;t<e.length;t++)for(var n=0;n<e.length;n++)if(t!==n&&b(e[t],e[n],s))return!0;return!1}(n))return null;var a=new i.Vector3,c=new i.Vector3;return a.subVectors(n[0],n[1]),c.subVectors(n[2],n[1]),A(a,c)}function d(e,t){var n=[];for(var i in e)if(e.hasOwnProperty(i)){var r=l(e[i],t);r&&n.push(r.clone())}var o=l(e[1],t);o&&n.push(o.clone());for(var a=0;a<n.length;a+=2)t.model.pageToModel(n[a],n[a+1],e[1].viewportIndex2d);var s=0,c=0;for(a=0;a<n.length-1;a++)s+=n[a].x*n[a+1].y,c+=n[a].y*n[a+1].x;return Math.abs((s-c)/2)}function f(e,t,n){switch(t){case o.MeasurementTypes.MEASUREMENT_DISTANCE:var r=e[1];return u(r,e[2],function(e,t){if(e.is3d())return 0;var n=e.getMetadata("page_dimensions","page_width",null),r=e.getMetadata("page_dimensions","logical_width",null),o=e.getMetadata("page_dimensions","page_height",null),a=e.getMetadata("page_dimensions","logical_height",null);if(!(n&&r&&o&&a))return 0;var s=n/r,l=o/a,c=new i.Vector3(0,0,0),u=new i.Vector3(s,l,0);return e.pageToModel(c,u,t),c.distanceTo(u)}(n.model,r.viewportIndex2d),n);case o.MeasurementTypes.MEASUREMENT_ANGLE:var a=h(e,n);return a?{angle:a,type:t}:null;case o.MeasurementTypes.MEASUREMENT_AREA:return{area:d(e,n),type:t};default:return null}}function p(e,t,n,r,o,s){for(var l=0,c=n.vertices,u=new i.Vector3,h=new i.Vector3,d=0;d<c.length;d+=3)u.subVectors(c[d+1],c[d]),h.subVectors(c[d+2],c[d]),l+=u.length()*h.length()*Math.sin(u.angleTo(h))/2;return l=Object(a.convertUnits)(e.model.getUnitString(),r,s,l,"square"),r?Object(a.formatValueWithUnits)(l,r+"^2",3,o):Object(a.formatValueWithUnits)(l,null,3,o)}function m(e,t,n,i,r,o){var s=n.radius;if(s){if(e.model.is2d()){var l=n.center.clone(),c=n.vertices[0].clone();e.model.pageToModel(l,c,t.getPick(1).viewportIndex2d),s=l.distanceTo(c)}return s=Object(a.convertUnits)(e.model.getUnitString(),i,o,s),Object(a.formatValueWithUnits)(s,i,3,r)}}function g(e,t,n){var r=t.navigation.getCamera(),o=t.navigation.getScreenViewport(),a=new i.Vector3(e.x,e.y,e.z);return a=a.project(r),n=n||0,new i.Vector2(Math.round((a.x+1)/2*o.width)+n,Math.round((1-a.y)/2*o.height)+n)}function v(e,t){var n=t.navigation.getCamera(),r=t.navigation.getScreenViewport(),o=new i.Vector3;return o.x=e.x/r.width*2-1,o.y=-(e.y/r.height*2-1),o.z=0,o=o.unproject(n)}function y(e,t,n){var r,o=new i.Vector3,a=new i.Vector3;return o.subVectors(t,e),a.subVectors(n,t),r=o.dot(a),o.subVectors(n,t),r=-r/o.dot(o),o.subVectors(n,t),o.multiplyScalar(r),o.add(t)}function _(e,t,n,r){var o,a,s=new i.Vector3,l=new i.Vector3;return s.subVectors(t,e),l.subVectors(n,t),a=s.dot(l),s.subVectors(n,t),(a=-a/s.dot(s))<0?o=r?null:t:a>1?o=r?null:n:(s.subVectors(n,t),s.multiplyScalar(a),o=s.add(t)),o}function b(e,t,n){return!(!e||!t)&&(Math.abs(e.x-t.x)<=n&&Math.abs(e.y-t.y)<=n&&Math.abs(e.z-t.z)<=n)}function x(e,t,n){return Math.abs(e.x+t.x)<=n&&Math.abs(e.y+t.y)<=n&&Math.abs(e.z+t.z)<=n}function w(e){for(var t=e.vertices,n=[],i=0;i<t.length;++i){for(var r=!1,o=0;o<t.length;++o)if(o!==i&&t[o].equals(t[i])){r=!0;break}r||n.push(t[i])}return n}function A(e,t){return 180*e.angleTo(t)/Math.PI}function E(e,t,n,r){var o=new i.Vector3,a=new i.Vector3,l=new i.Vector3;o.subVectors(t,e),a.subVectors(r,n),l.subVectors(e,n);var c,u,h,d,f=o.dot(o),p=o.dot(a),m=a.dot(a),g=o.dot(l),v=a.dot(l),y=f*m-p*p,_=y,b=y;return y<s?(u=0,_=1,d=v,b=m):(d=f*v-p*g,(u=p*v-m*g)<0?(u=0,d=v,b=m):u>_&&(u=_,d=v+p,b=m)),d<0?(d=0,-g<0?u=0:-g>f?u=_:(u=-g,_=f)):d>b&&(d=b,-g+p<0?u=0:-g+p>f?u=_:(u=-g+p,_=f)),c=Math.abs(u)<s?0:u/_,h=Math.abs(d)<s?0:d/b,o.multiplyScalar(c),a.multiplyScalar(h),l.add(o),l.sub(a),o.add(e),a.add(n),[o,a]}function T(e,t,n){var r=new i.Vector3,o=n.clone(),a=new i.Vector3;a.subVectors(e,t);var s=-o.dot(a)/o.dot(o);return r.addVectors(e,o.multiplyScalar(s)),r}function M(e,t,n){return n=n||s,1-Math.abs(e.dot(t))<n}function S(e,t,n){return n=n||s,Math.abs(e.dot(t))<n}function C(e,t){for(var n,i=Number.MAX_VALUE,r=0;r<t.vertices.length;r++){var o=e.distanceTo(t.vertices[r]);i>o&&(n=t.vertices[r],i=o)}return n}function P(e,t){if(e)for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];i&&t(i)}}function L(e,t){e.impl.overlayScenes[t]||e.impl.createOverlayScene(t)}function R(e,t,n){(e.classList.contains(t)&&!n||!e.classList.contains(t)&&n)&&e.classList.toggle(t,n)}function D(e){for(var t=new i.Vector3,n=e.length,r=0;r<n;r++)t.add(e[r]);return t.multiplyScalar(1/n),t}function I(e,t,n,r){var o=new i.Vector3,a=new i.Vector3,l=new i.Vector3,c=new i.Vector3;if(o.subVectors(t,e),a.subVectors(r,n),l.crossVectors(o,a),Math.abs(l.z)<s)return!1;var u=c.subVectors(n,e).cross(a).z/l.z,h=c.subVectors(n,e).cross(o).z/l.z;return!(Math.abs(l.z)<s)&&0<=u&&u<=1&&0<=h&&h<=1}function O(e){var t=e.length;if(3===t)return!0;for(var n=0;n<t;n++)for(var i=e[n],r=e[(n+1)%t],o=n+2;o<t;o++){var a=e[o%t],s=e[(o+1)%t];if(s===i)break;if(I(i,r,a,s))return!1}return!0}function N(e){function t(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=function(e,t,i){for(var r=!1,o=1/0,a=0;a<i.length;a++)for(var s=i[a],l=0,c=s.length,u=c-1;l<c;u=l++){var h=s[l],d=s[u];h.y>t!=d.y>t&&e<(d.x-h.x)*(t-h.y)/(d.y-h.y)+h.x&&(r=!r),o=Math.min(o,n(e,t,h,d))}return(r?1:-1)*Math.sqrt(o)}(e,t,r),this.max=this.d+this.h*Math.SQRT2}function n(e,t,n,i){var r=n.x,o=n.y,a=i.x-r,s=i.y-o;if(0!==a||0!==s){var l=((e-r)*a+(t-o)*s)/(a*a+s*s);l>1?(r=i.x,o=i.y):l>0&&(r+=a*l,o+=s*l)}return(a=e-r)*a+(s=t-o)*s}function i(e,t){if(!(this instanceof i))return new i(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||function(e,t){return e<t?-1:e>t?1:0},this.length>0)for(var n=this.length>>1;n>=0;n--)this._down(n)}if(i.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,n=this.compare,i=t[e];e>0;){var r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i},_down:function(e){for(var t=this.data,n=this.compare,i=this.length>>1,r=t[e];e<i;){var o=1+(e<<1),a=o+1,s=t[o];if(a<this.length&&n(t[a],s)<0&&(o=a,s=t[a]),n(s,r)>=0)break;t[e]=s,e=o}t[e]=r}},3===e.length)return D(e);var r,o,a,s;e=[e];for(var l=0;l<e[0].length;l++){var c=e[0][l];(!l||c.x<r)&&(r=c.x),(!l||c.y<o)&&(o=c.y),(!l||c.x>a)&&(a=c.x),(!l||c.y>s)&&(s=c.y)}var u=a-r,h=s-o,d=Math.min(u,h),f=d/2,p=new i(null,function(e,t){return t.max-e.max});if(0===d)return[r,o];for(var m=r;m<a;m+=d)for(var g=o;g<s;g+=d)p.push(new t(m+f,g+f,f,e));var v=function(e){for(var n=0,i=0,r=0,o=e[0],a=0,s=o.length,l=s-1;a<s;l=a++){var c=o[a],u=o[l],h=c.x*u.y-u.x*c.y;i+=(c.x+u.x)*h,r+=(c.y+u.y)*h,n+=3*h}return 0===n?new t(o[0].x,o[0].y,0,e):new t(i/n,r/n,0,e)}(e),y=new t(r+u/2,o+h/2,0,e);for(y.d>v.d&&(v=y);p.length;){var _=p.pop();_.d>v.d&&(v=_),_.max-v.d<=.01||(f=_.h/2,p.push(new t(_.x-f,_.y-f,f,e)),p.push(new t(_.x+f,_.y-f,f,e)),p.push(new t(_.x-f,_.y+f,f,e)),p.push(new t(_.x+f,_.y+f,f,e)))}return{x:v.x,y:v.y}}},function(e,t,n){"use strict";n.r(t),n.d(t,"theExtensionManager",function(){return a}),n.d(t,"ExtensionMixin",function(){return s});var i=n(1),r=n(11),o=n(2),a=new function(){var e={},t={};return{registerExtension:function(t,n){return!e[t]&&(e[t]=n,!0)},getExtension:function(t){return e.hasOwnProperty(t)?e[t]:null},unregisterExtension:function(t){return!!e.hasOwnProperty(t)&&(delete e[t],!0)},registerExternalExtension:function(e,n){return!t[e]&&(t[e]=n,!0)},getExternalPath:function(e){return t.hasOwnProperty(e)?t[e]:null},unregisterExternalExtension:function(e){return!!t.hasOwnProperty(e)&&(delete t[e],!0)},getRegisteredExtensions:function(){var n,i=[];for(n in e)e.hasOwnProperty(n)&&i.push({id:n,inMemory:!0,isAsync:n in t});for(n in t)!t.hasOwnProperty(n)||n in e||i.push({id:n,inMemory:!1,isAsync:!0});return i},popuplateOptions:function(t){for(var n in e)e.hasOwnProperty(n)&&e[n].hasOwnProperty("populateDefaultOptions")&&e[n].populateDefaultOptions(t)}}},s=function(){};s.prototype={loadExtension:function(e,t){this.loadedExtensions||(this.loadedExtensions={});var n=this.getExtension(e);if(n)return Promise.resolve(n);if(!a.getExtension(e)){var i=a.getExternalPath(e);return i?this.loadExtensionAsync(e,i,t):Promise.reject("Extension not found: "+e+". Has it been registered(1)?")}return this.loadExtensionLocal(e,t)},getExtension:function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e]:null},unloadExtension:function(e){var t=!1,n=this.getExtension(e);return n?(t=n.unload(),i.logger.info("Extension unloaded: "+e),delete this.loadedExtensions[e],this.dispatchEvent({type:o.EXTENSION_UNLOADED_EVENT,extensionId:e})):i.logger.warn("Extension not found: "+e),t},loadExtensionLocal:function(e,t){var n=a.getExtension(e);if(!n)return Promise.reject("Extension not found: "+e+". Has it been registered(2)?");var r=new n(this,t);return r.id=e,r.load()?(this.loadedExtensions[e]=r,i.logger.info("Extension loaded: "+e),this.dispatchEvent({type:o.EXTENSION_LOADED_EVENT,extensionId:e}),Promise.resolve(r)):Promise.reject("Extension failed to .load() : "+e)},loadExtensionAsync:function(e,t,n){var i=this;return new Promise(function(o,a){Object(r.loadDependency)(e,t,function(){i.loadExtension(e,n);var t=i.getExtension(e);t?o(t):a("Failed to getExtension("+e+")")},function(){a("Failed to loadExtensionAsync: ("+e+") from: ("+t+")")})})},apply:function(e){var t=s.prototype;e.loadExtension=t.loadExtension,e.getExtension=t.getExtension,e.unloadExtension=t.unloadExtension,e.loadExtensionLocal=t.loadExtensionLocal,e.loadExtensionAsync=t.loadExtensionAsync}}},function(e,t,n){"use strict";n.r(t),n.d(t,"getVertexCount",function(){return f}),n.d(t,"enumMeshVertices",function(){return p}),n.d(t,"enumMeshTriangles",function(){return m}),n.d(t,"enumMeshLines",function(){return g}),n.d(t,"enumMeshEdges",function(){return v}),n.d(t,"VertexEnumerator",function(){return y});var i,r,o,a,s,l,c,u,h,d=n(10);function f(e){return e.vb?e.vb.length/e.vbstride:e.attributes.positions?e.attributes.positions.count:0}function p(e,t,n){var r,o=e.attributes,a=e.vb||o.position.array,s=e.vb?e.vbstride:3;if(e.vblayout){if(!e.vblayout.position)return;r=e.vblayout.position.offset}else{if(!o.position)return;r=o.position.itemOffset||0}var l=a.length/s;i||(i=new d.LmvVector3);for(var c=r,u=0;u<l;u++,c+=s)i.set(a[c],a[c+1],a[c+2]),n&&i.applyMatrix4(n),t(i,u)}function m(e,t){var n,i,u,h=e.attributes;r||(r=new d.LmvVector3,o=new d.LmvVector3,a=new d.LmvVector3,s=new d.LmvVector3,l=new d.LmvVector3,c=new d.LmvVector3);var f,p=e.vb||h.position.array,m=e.vb||h.normal&&h.normal.array,g=e.vb?e.vbstride:3;if(e.vblayout){if(!e.vblayout.position)return;f=e.vblayout.position.offset}else{if(!h.position)return;f=h.position.itemOffset||0}var v=0,y=e.vblayout?e.vblayout.normal:h.normal||null;y?v=y.offset||y.itemOffset||0:m=null,!y||3===y.itemSize&&4===y.bytesPerItem||(m=null);var _=e.ib||e.indices||(h.index?h.index.array:null);if(_){var b=e.offsets;b&&0!==b.length||(b=[{start:0,count:_.length,index:0}]);for(var x=0,w=b.length;x<w;++x)for(var A=b[x].start,E=b[x].count,T=b[x].index,M=A,S=A+E;M<S;M+=3){var C=(n=T+_[M])*g+f,P=(i=T+_[M+1])*g+f,L=(u=T+_[M+2])*g+f;if(r.x=p[C],r.y=p[C+1],r.z=p[C+2],o.x=p[P],o.y=p[P+1],o.z=p[P+2],a.x=p[L],a.y=p[L+1],a.z=p[L+2],m){var R=n*g+v,D=i*g+v,I=u*g+v;s.x=m[R],s.y=m[R+1],s.z=m[R+2],l.x=m[D],l.y=m[D+1],l.z=m[D+2],c.x=m[I],c.y=m[I+1],c.z=m[I+2],t(r,o,a,n,i,u,s,l,c)}else t(r,o,a,n,i,u)}}else{var O=e.vb?e.vb.length/e.vbstride:p.length/3;for(M=0;M<O;M++){C=(n=3*M)*g+f,P=(i=3*M+1)*g+f,L=(u=3*M+2)*g+f;if(r.x=p[C],r.y=p[C+1],r.z=p[C+2],o.x=p[P],o.y=p[P+1],o.z=p[P+2],a.x=p[L],a.y=p[L+1],a.z=p[L+2],m){R=n*g+v,D=i*g+v,I=u*g+v;s.x=m[R],s.y=m[R+1],s.z=m[R+2],l.x=m[D],l.y=m[D+1],l.z=m[D+2],c.x=m[I],c.y=m[I+1],c.z=m[I+2],t(r,o,a,n,i,u,s,l,c)}else t(r,o,a,n,i,u)}}}function g(e,t){var n,i,r=e.attributes;u||(u=new d.LmvVector3,h=new d.LmvVector3);var o=2;e.lineWidth&&(o=6);var a=e.ib||e.indices||(r.index?r.index.array:null);if(a){var s=e.vb?e.vb:r.position.array,l=e.vb?e.vbstride:3,c=e.offsets;c&&0!==c.length||(c=[{start:0,count:a.length,index:0}]);for(var f=0,p=c.length;f<p;++f)for(var m=c[f].start,g=c[f].count,v=c[f].index,y=m,_=m+g;y<_;y+=o)n=v+a[y],i=v+a[y+1],u.x=s[n*l],u.y=s[n*l+1],u.z=s[n*l+2],h.x=s[i*l],h.y=s[i*l+1],h.z=s[i*l+2],t(u,h,n,i)}else for(s=e.vb?e.vb:r.position.array,l=e.vb?e.vbstride:3,y=0,_=s.length;y<_;y+=o)n=y,i=y+1,u.x=s[n*l],u.y=s[n*l+1],u.z=s[n*l+2],h.x=s[i*l],h.y=s[i*l+1],h.z=s[i*l+2],t(u,h,n,i)}function v(e,t){var n,i,r=e.attributes;u||(u=new d.LmvVector3,h=new d.LmvVector3);var o=e.iblines;if(o){var a=e.vb?e.vb:r.position.array,s=e.vb?e.vbstride:3,l=e.offsets;l&&0!==l.length||(l=[{start:0,count:o.length,index:0}]);for(var c=0,f=l.length;c<f;++c)for(var p=l[c].start,m=l[c].count,g=l[c].index,v=p,y=p+m;v<y;v+=2)n=g+o[v],i=g+o[v+1],u.x=a[n*s],u.y=a[n*s+1],u.z=a[n*s+2],h.x=a[i*s],h.y=a[i*s+1],h.z=a[i*s+2],t(u,h,n,i)}}var y={getVertexCount:f,enumMeshVertices:p,enumMeshTriangles:m,enumMeshLines:g,enumMeshEdges:v}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2}},function(e,t,n){"use strict";function i(e,t,n){var i,r,o,a,s,l;for(i="",o=n,r=0;r<o;)switch((a=e[t+r++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i+=String.fromCharCode(a);break;case 12:case 13:s=e[t+r++],i+=String.fromCharCode((31&a)<<6|63&s);break;case 14:s=e[t+r++],l=e[t+r++],i+=String.fromCharCode((15&a)<<12|(63&s)<<6|(63&l)<<0)}return i}function r(e,t,n){var i,r,o,a=n||0;if(r=e.length,t)for(i=0;i<r;i++)(o=e.charCodeAt(i))>=1&&o<=127?t[a++]=o:o>2047?(t[a++]=224|o>>12&15,t[a++]=128|o>>6&63,t[a++]=128|o>>0&63):(t[a++]=192|o>>6&31,t[a++]=128|o>>0&63);else for(i=0;i<r;i++)(o=e.charCodeAt(i))>=1&&o<=127?a++:a+=o>2047?3:2;return a-(n||0)}n.d(t,"f",function(){return i}),n.d(t,"d",function(){return r}),n.d(t,"e",function(){return s}),n.d(t,"a",function(){return l}),n.d(t,"b",function(){return p}),n.d(t,"c",function(){return m});var o=!0,a=1048576;function s(e,t,n){if(void 0===t&&(t=0),void 0===n&&(n=e.length),o)return n>a?function(e,t,n){var i,r,o,a,s,l,c,u;for(i="",s=[],o=n,l=0,r=0;r<o;){switch((a=e[t+r++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s.push(String.fromCharCode(a));break;case 12:case 13:c=e[t+r++],s.push(String.fromCharCode((31&a)<<6|63&c));break;case 14:c=e[t+r++],u=e[t+r++],s.push(String.fromCharCode((15&a)<<12|(63&c)<<6|(63&u)<<0))}(++l>=32768||r>=o)&&(i+=s.join(""),s.length=0,l=0)}return i}(e,t,n):i(e,t,n);for(var r="",s=t,l=t+n;s<l;s++)r+=String.fromCharCode(e[s]);return decodeURIComponent(escape(r))}function l(e){var t=s(e,0,e.length);return JSON.parse(t)}for(var c=new Array(256),u=0;u<256;u++){var h=u.toString(16);1===h.length&&(h="0"+h),c[u]=h}var d=new Array(20);var f=new Array(10);function p(e,t,n){for(var i=20===n?f:[],r=0;r<n;r+=2){var o=e[t+r],a=e[t+r+1];i[r/2]=a<<8|o}return String.fromCharCode.apply(null,i)}function m(e){for(var t=10===e.length?d:[],n=0;n<e.length;n++){var i=e.charCodeAt(n);t[2*n]=c[255&i],t[2*n+1]=c[i>>8&255]}return t.join("")}},function(e,t,n){"use strict";n.r(t),n.d(t,"ShadowMapShader",function(){return y}),n.d(t,"GroundShadowShader",function(){return _}),n.d(t,"ShadowMapOverrideMaterials",function(){return b}),n.d(t,"ShadowConfig",function(){return x}),n.d(t,"SHADOWMAP_NEEDS_UPDATE",function(){return w}),n.d(t,"SHADOWMAP_INCOMPLETE",function(){return A}),n.d(t,"SHADOWMAP_VALID",function(){return E}),n.d(t,"ShadowMaps",function(){return S}),n.d(t,"ShadowRender",function(){return C});var i=n(15),r=n(22),o=n(69),a=n(73),s=n(84),l=n(109),c=n(0),u=n(215),h=n.n(u),d=n(216),f=n.n(d),p=n(217),m=n.n(p),g=n(218),v=n.n(g),y={uniforms:c.UniformsUtils.merge([i.ShaderChunks.ShadowMapCommonUniforms,{shadowMapRangeMin:{type:"f",value:0},shadowMapRangeSize:{type:"f",value:0},shadowMinOpacity:{type:"f",value:0},map:{type:"t",value:null},alphaMap:{type:"t",value:null},texMatrix:{type:"m3",value:new c.Matrix3},texMatrixAlpha:{type:"m3",value:new c.Matrix3}},Object(o.GetPrismMapUniforms)("surface_cutout_map")]),vertexShader:h.a,fragmentShader:f.a},_={uniforms:i.ShaderChunks.ShadowMapUniforms,vertexShader:m.a,fragmentShader:v.a};function b(){var e=[],t=Object(r.createShaderMaterial)(y),n=new c.Material;n.visible=!1;var i=[];var o=new function(){this.init=function(){this.isPrism=!1,this.alphaMap=!1,this.alphaClampS=!1,this.alphaClampT=!1,this.alphaInvert=!1,this.rgbaMap=!1,this.rgbaClampS=!1,this.rgbaClampT=!1,this.rgbaInvert=!1,this.instanced=!1,this.decalIndex=-1},this.init(),this.getMaterialIndex=function(){return(this.isPrism?1:0)|(this.alphaMap?2:0)|(this.alphaClampS?4:0)|(this.alphaClampT?8:0)|(this.alphaInvert?16:0)|(this.rgbaMap?32:0)|(this.rgbaClampS?64:0)|(this.rgbaClampT?128:0)|(this.rgbaInvert?256:0)|(this.instanced?512:0)|1024*(this.decalIndex+1)}};function s(i,s){if((l=i)instanceof c.MeshPhongMaterial?l.opacity<x.ShadowMinOpacity:l.isPrismMaterial?"PrismTransparent"===l.prismType||"PrismGlazing"===l.prismType:!l.visible)return n;var l,u=i instanceof c.MeshPhongMaterial,h=i.isPrismMaterial;if(!u&&!h)return null;var d=u?i.alphaMap:i.surface_cutout_map,f=u&&i.alphaTest?i.map:null;if(!d&&!f&&!i.useInstancing)return null;var p=o;p.init(),p.isPrism=h,p.alphaMap=!!d,p.rgbaMap=!!f,p.instanced=i.useInstancing,p.decalIndex=void 0===s?-1:s,d&&(p.alphaClampS=d.clampS,p.alphaClampT=d.clampT,p.alphaInvert=d.invert),f&&(p.rgbaClampS=f.clampS,p.rgbaClampT=f.clampT,p.rgbaInvert=f.invert);var m=function(n,i){var o=n.getMaterialIndex();if(!e[o]){var s=t.clone();n.isPrism&&n.alphaMap&&(Object(r.setMacro)(s,"USE_SURFACE_CUTOUT_MAP"),s.fragmentShader=Object(a.GetPrismMapChunk)("surface_cutout",n.alphaClampS,n.alphaClampT)+"\n"+s.fragmentShader),n.instanced&&(s.useInstancing=!0),e[o]=s}return e[o]}(p);return d&&(u?(m.uniforms.alphaMap.value=d,m.uniforms.texMatrixAlpha.value=d.matrix,m.alphaMap=d,m.side=i.side):(m.uniforms.surface_cutout_map.value=d,m.uniforms.surface_cutout_map_texMatrix.value.copy(d.matrix),m.uniforms.surface_cutout_map_invert.value=d.invert,m.side=c.DoubleSide)),f&&(m.uniforms.map.value=f,m.uniforms.texMatrix.value=f.matrix,m.map=f),m}this.forEachMaterial=function(n){for(var i=0;i<e.length;i++){var r=e[i];r&&n(r)}n(t)},this.getCustomOverrideMaterial=function(e){var t=s(e);if(!t)return null;if(!e.decals)return t.decals=null,t;if(e.decals){i.length=0;for(var n=0;n<e.decals.length;n++){var r=e.decals[n],o=s(r.material,n);if(!o)return null;i.push({uv:r.uv,material:o})}}return t.decals=i,t},this.dispose=function(){this.forEachMaterial(function(e){e.dispose()})}}var x={ShadowMapSize:1024,ShadowESMConstant:80,ShadowBias:.001,ShadowDarkness:.7,ShadowMapBlurRadius:4,ShadowMinOpacity:.9,UseHardShadows:!1,BlurShadowMap:!0},w=0,A=1,E=2;function T(){this.shadowMap=void 0,this.shadowMapSize=void 0,this.shadowMatrix=void 0,this.shadowLightDir=void 0,this.init=function(e){this.shadowMap=e,this.shadowMapSize=new c.Vector2(e.width,e.height),this.shadowMatrix=new c.Matrix4,this.shadowLightDir=new c.Vector3},this.apply=function(e){e.shadowMap=this.shadowMap,e.shadowMatrix=this.shadowMatrix,e.shadowLightDir=this.shadowLightDir,this.shadowMap?(Object(r.setMacro)(e,"USE_SHADOWMAP"),x.UseHardShadows&&Object(r.setMacro)(e,"USE_HARD_SHADOWS")):(Object(r.removeMacro)(e,"USE_SHADOWMAP"),Object(r.removeMacro)(e,"USE_HARD_SHADOWS"))}}var M=new T;function S(e){var t=null,n=null,i=new c.OrthographicCamera,o=Math.exp(x.ShadowESMConstant),a=x.UseHardShadows?new c.Color(1,1,1):new c.Color(o,1,1),u=e,h=null,d=null,f=null,p=Object(r.createShaderMaterial)(y),m=new b;p.getCustomOverrideMaterial=m.getCustomOverrideMaterial;var g=null;function v(e,t){e.forEach(function(e){t.apply(e)})}function S(e){var t=new c.WebGLRenderTarget(e,e,{minFilter:c.LinearFilter,magFilter:c.LinearFilter,format:c.RGBAFormat,type:c.FloatType,stencilBuffer:!1,generateMipmaps:!1});return t.generateMipmaps=!1,t}function C(e){u.setRenderTarget(e),u.setClearColor(a,1),u.clear()}var P,L,R,D,I,O,N,k,V,F,B,U=(P=new c.Matrix4,L=new c.Matrix4,R=new c.Vector3(0,0,0),D=new c.Box3,I=new c.Vector3,O=new c.Vector3,function(e,t,n){e.position.copy(n),e.lookAt(R),P.makeRotationFromQuaternion(e.quaternion),L.getInverse(P),D.copy(t).applyMatrix4(L),O=D.center(O),I.set(O.x,O.y,D.max.z),I.applyMatrix4(P),e.position.copy(I),O=D.size(O),e.left=-.5*O.x,e.right=.5*O.x,e.bottom=-.5*O.y,e.top=.5*O.y,e.near=0,e.far=O.z,e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld),e.updateProjectionMatrix()});function z(e){e.uniforms.shadowMapRangeMin.value=i.near,e.uniforms.shadowMapRangeSize.value=i.far-i.near,e.uniforms.shadowESMConstant.value=x.ShadowESMConstant,e.uniforms.shadowMinOpacity.value=x.ShadowMinOpacity}this.init=function(){(t=new T).init(S(x.ShadowMapSize)),n=x.BlurShadowMap?new l.a(x.ShadowMapSize,x.ShadowMapSize,x.ShadowMapBlurRadius,1,{type:t.shadowMap.type,format:t.shadowMap.format}):void 0,(h=Object(r.createShaderMaterial)(_)).depthWrite=!1,h.transparent=!0,d=Object(s.createGroundShape)(h),(f=new c.Scene).add(d),this.groundShapeBox=new c.Box3,C(g=S(1))},this.init(),this.state=w,this.startUpdate=function(e,t,n,r,o){var a=e.getVisibleBounds(!0);return this.beginShadowMapUpdate(n,a,r),e.reset(i,3,!0),this.state=A,t=this.continueUpdate(e,t,o)},this.continueUpdate=function(e,n,i){return n=e.renderSome(this.renderSceneIntoShadowMap,n),e.isDone()?(this.state=E,this.finishShadowMapUpdate(i)):function(e){var n=t.shadowMap;t.shadowMap=g,v(e,t),t.apply(h),t.shadowMap=n}(i),n},this.beginShadowMapUpdate=function(e,n,o){U(i,n,o),z(p),m.forEachMaterial(z),x.UseHardShadows&&(Object(r.setMacro)(p,"USE_HARD_SHADOWS"),m.forEachMaterial(function(e){Object(r.setMacro)(e,"USE_HARD_SHADOWS")})),C(t.shadowMap),this.renderSceneIntoShadowMap(f)},this.renderSceneIntoShadowMap=function(e){e.overrideMaterial=p,u.render(e,i,t.shadowMap),e.overrideMaterial=null},this.finishShadowMapUpdate=function(e){n&&!x.UseHardShadows&&n.render(u,t.shadowMap,t.shadowMap),t.shadowMatrix.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),t.shadowMapRangeMin=i.near,t.shadowMapRangeSize=i.far-i.near,t.shadowLightDir.copy(i.position).normalize(),v(e,t),t.apply(h),this.isValid=!0},this.cleanup=function(e){n&&n.cleanup(),t.shadowMap&&t.shadowMap.dispose(),v(e,M),p.dispose(),m.dispose(),h.dispose(),d.geometry.dispose()},this.setGroundShadowTransform=function(e,t,n,i){Object(s.setGroundShapeTransform)(d,e,t,n,i),this.groundShapeBox.setFromObject(d)},this.renderGroundShadow=function(e,t){u.render(f,e,t,!1)},this.expandByGroundShadow=(N=new c.Plane,k=new c.Ray,V=new c.Vector3,F=new c.Vector3,B=new c.Box3,function(e,t){N.normal.set(0,1,0),N.constant=-e.min.y,k.direction.copy(t).negate().normalize();var n,i,r,o=e.center(V),a=100*o.distanceToSquared(e.min)*100;B.makeEmpty();for(var s=0;s<8;s++){k.origin=(n=e,i=s,r=void 0,(r=new c.Vector3).x=1&i?n.max.x:n.min.x,r.y=2&i?n.max.y:n.min.y,r.z=4&i?n.max.z:n.min.z,r);var l=k.intersectPlane(N,F);l&&(l.distanceToSquared(o)>=a||B.expandByPoint(l))}e.union(B)}),this.getShadowParams=function(){return t},this.getShadowCamera=function(){return i}}var C=function(){};C.RefreshUniformsShadow=function(e,t){e.shadowMap&&(e.shadowMap.value=t.shadowMap),e.shadowMatrix&&(e.shadowMatrix.value=t.shadowMatrix),e.shadowLightDir&&(e.shadowLightDir.value=t.shadowLightDir),e.shadowESMConstant&&(e.shadowESMConstant.value=x.ShadowESMConstant),e.shadowBias&&(e.shadowBias.value=x.ShadowBias),e.shadowMapSize&&(e.shadowMapSize.value=x.ShadowMapSize),e.shadowDarkness&&(e.shadowDarkness.value=x.ShadowDarkness)}},function(e,t,n){"use strict";n.r(t),n.d(t,"ResetFlags",function(){return i});var i={RESET_NORMAL:0,RESET_REDRAW:1,RESET_RELOAD:2}},function(e,t,n){"use strict";n.r(t);var i=n(69),r=n(0),o=-1e240;function a(){this.distance=o,this.dot=1}function s(e,t){return e.x*t.y-e.y*t.x}function l(e,t,n){t=t,n=n;var i=e.length();return 0===i?t?new r.Vector2(0,n?0:1):new r.Vector2(0,-(n?0:1)):t?new r.Vector2(-e.y/i,e.x/i):new r.Vector2(e.y/i,-e.x/i)}a.prototype={constructor:a,set:function(e,t){return this.distance=e,this.dot=t,this},copy:function(e){this.distance=e.distance,this.dot=e.dot},lessThan:function(e){return Math.abs(this.distance)<Math.abs(e.distance)||Math.abs(this.distance)===Math.abs(e.distance)&&this.dot<e.dot},greaterThan:function(e){return Math.abs(this.distance)>Math.abs(e.distance)||Math.abs(this.distance)===Math.abs(e.distance)&&this.dot>e.dot},lessThanOrEquals:function(e){return Math.abs(this.distance)<Math.abs(e.distance)||Math.abs(this.distance)==Math.abs(e.distance)&&this.dot<=e.dot},greaterThanOrEquals:function(e){return Math.abs(this.distance)>Math.abs(e.distance)||Math.abs(this.distance)==Math.abs(e.distance)&&this.dot>=e.dot}};var c=0,u=1,h=2,d=3,f=4,p=5,m=6,g=7;function v(e,t,n){this.p=[],this.p[0]=e.clone(),this.p[1]=t.clone(),this.color=n}function y(e,t){return(t.x-e.x)*(e.y+t.y)}function _(){this.edges=[]}function b(e,t,n){return e.dot(t)<=0||Math.abs(s(e,t))>n}function x(e,t){return w(e,t,c)}function w(e,t,n){var i=e&n;if(i==u||i==h||i==f)return[e=i^g,t];if(e==c||e==g)return[e=[m,p,d][t%3],t=Math.floor(t/3)];var r=e<<1+(1&t);return[e=(r|r>>3)&g,t>>=1]}function A(){this.minDistance=new a,this.nearEdge=null,this.nearParam=0}function E(e,t,n){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),n))}function T(e,t){var n=t.point(0),i=t.point(1),r=e,o=e.clone().sub(n),a=i.clone().sub(n),s=o.dot(a)/a.dot(a);return s<0?o.length():s>1?r.clone().sub(i).length():Math.abs(l(a,!1,!1).dot(o))}function M(){this.contours=[],this.windings=[],this.inverseYAxis=!1}function S(e,t,n){if(!e||!e.colors)return new r.Color(1,0,0);var i=e.colors[t];if(!i)return new r.Color(0,0,0);var o=i.values;if(!o||!o.length)return new r.Color(1,0,0);var a=o[0];return new r.Color(a.r,a.g,a.b)}function C(e,t,n){if(!e||!e.scalars)return n;var i=e.scalars[t];return i?i.values[0]:n}function P(e,t,n){if(!e||!e.booleans)return n;var i=e.booleans[t];return void 0===i?n:i}function L(e,t,n,i){if(!e||!e[t])return i;var r=e[t][n];return r?r.values[0]:i}function R(e,t,n,i){if(!e||!e.scalars)return i;var o=e.scalars[t];return o?function(e,t,n){var i=V[n];i||(i=1,r.warn("Unsupported units: "+n));var o=V[t];o||(o=1,r.warn("Unsupported units: "+t));return e*i/o}(o.values[0],o.units,n):i}function D(e,t,n,i){if(!e||!e[t])return i;var r=e[t][n];return r&&r.connections?r.connections[0]:i}function I(e){var t=e;return t<=.04045?t/=12.92:t=Math.pow((t+.055)/1.055,2.4),t}function O(e){var t,n,i;return t=I(e.r),n=I(e.g),i=I(e.b),new r.Color(t,n,i)}v.prototype={constructor:v,set:function(e){return this.color=e,this},clone:function(){return new this.constructor(this.p[0],this.p[1],this.color)},point:function(e){return this.p[0].clone().lerp(this.p[1],e)},direction:function(){return this.p[1].clone().sub(this.p[0])},signedDistance:function(e){var t=e.clone().sub(this.p[0]),n=this.direction(),i=t.dot(n)/n.dot(n),r=this.p[i>.5?1:0].clone().sub(e),o=r.length();if(i>0&&i<1){var c=l(n,!1,!1).dot(t);if(Math.abs(c)<o){var u=new a;return u.set(c,0),[u,i]}}var h=2*(s(t,n)>0?1:0)-1,d=new a;return d.set(h*o,Math.abs(n.normalize().dot(r.normalize(r)))),[d,i]},distanceToPseudoDistance:function(e,t,n){var i,r;if(n<0){r=this.direction().normalize();var o=t.clone().sub(this.p[0]);o.dot(r)<0&&(i=s(o,r),Math.abs(i)<=Math.abs(e.distance)&&(e.distance=i,e.dot=0))}else if(n>1){r=this.direction().normalize();var a=t.clone().sub(this.p[1]);a.dot(r)>0&&(i=s(a,r),Math.abs(i)<=Math.abs(e.distance)&&(e.distance=i,e.dot=0))}},moveStartPoint:function(e){this.p[0].copy(e)},moveEndPoint:function(e){this.p[1].copy(e)},splitInThirds:function(e,t,n){var i=this.point(1/3),r=this.point(2/3);new v(this.p[0],i,this.color),new v(i,r,this.color),new v(r,this.p[1],this.color)}},_.prototype={constructor:_,addEdge:function(e){this.edges.push(e)},winding:function(){if(0===this.edges.length)return 0;var e,t,n,i,o,a=0;if(1==this.edges.length)e=new r.Vector2,t=new r.Vector2,n=new r.Vector2,e.copy(this.edges[0].point(0)),t.copy(this.edges[0].point(1/3)),n.copy(this.edges[0].point(2/3)),a+=y(e,t),a+=y(t,n),a+=y(n,e);else if(2==this.edges.length)e=new r.Vector2,t=new r.Vector2,n=new r.Vector2,i=new r.Vector2,e.copy(this.edges[0].point(0)),t.copy(this.edges[0].point(.5)),n.copy(this.edges[1].point(0)),i.copy(this.edges[1].point(.5)),a+=y(e,t),a+=y(t,n),a+=y(n,i),a+=y(i,e);else{var s=new r.Vector2,l=new r.Vector2;s=this.edges[this.edges.length-1].point(0);for(var c=0;c<this.edges.length;c++)a+=y(s,l=this.edges[c].point(0)),s=l}return(o=a)>0?1:o<0?-1:0}},A.prototype={constructor:A,clear:function(){this.nearEdge=null,this.nearParam=0},copy:function(e){this.minDistance.copy(e.minDistance),this.nearEdge=e.nearEdge,this.nearParam=e.nearParam}},M.prototype={constructor:M,addContour:function(e){this.contours.push(e)},addBlankContour:function(){var e=new _;return this.contours.push(e),e},initialize:function(){this.contours.length;for(var e=0;e<this.contours.length;++e){var t=this.contours[e];this.windings.push(t.winding())}},edgeColoringSimple:function(e,t){for(var n=Math.sin(e),i=0;i<this.contours.length;++i){var r=this.contours[i],o=[];if(r.edges.length>0)for(var a=r.edges[r.edges.length-1].direction(1),s=0;s<r.edges.length;++s){var l=r.edges[s];b(a.normalize(),l.direction(0).normalize(),n)&&o.push(s),a=l.direction(1)}if(0===o.length)for(var c=0;c<r.edges.length;++c)r.edges[c].color=g;else if(1==o.length){var u=[g,g],h=x(u[0],t);u[0]=h[0],t=h[1],u[2]=u[0],h=x(u[0],t),u[0]=h[0],t=h[1];var d=o[0];if(r.edges.length>=3)for(var f=r.edges.length,p=0;p<f;++p)r.edges[(d+p)%f].color=u[Math.floor(2.875*p/(f-1)+.0625)];else if(r.edges.length>=1){var m=[];r.edges[0].splitInThirds(m[0+3*d],m[1+3*d],m[2+3*d]),r.edges.length>=2?(r.edges[1].splitInThirds(m[3-3*d],m[4-3*d],m[5-3*d]),m[0].color=m[1].color=u[0],m[2].color=m[3].color=u[1],m[4].color=m[5].color=u[2]):(m[0].color=u[0],m[1].color=u[1],m[2].color=u[2]),r.edges.clear();for(var v=0;v<m.length;++v)r.edges.push(m[v])}}else{var y=o.length,_=0,A=o[0],E=r.edges.length,T=g,M=x(T,t);T=M[0],t=M[1];for(var S=T,C=0;C<E;++C){var P=(A+C)%E;_+1<y&&o[_+1]==P&&(T=(M=w(T,t,(++_===y-1?1:0)*S))[0],t=M[1]),r.edges[P].color=T}}}},calculateMSDFValue:function(e){for(var t=this.contours.length,n=[],i=new A,a=new A,s=new A,l=Math.abs(o),c=-o,d=o,p=0,m=new A,g=new A,v=new A,y=0;y<this.contours.length;++y){n[y]={r:o,g:o,b:o,med:o};var _=this.contours[y];m.clear(),g.clear(),v.clear();for(var b=0;b<_.edges.length;++b){var x=_.edges[b],w=x.signedDistance(e),T=w[0],M=w[1];(x.color&u)>0&&T.lessThan(m.minDistance)&&(m.minDistance.copy(T),m.nearEdge=x,m.nearParam=M),(x.color&h)>0&&T.lessThan(g.minDistance)&&(g.minDistance.copy(T),g.nearEdge=x,g.nearParam=M),(x.color&f)>0&&T.lessThan(v.minDistance)&&(v.minDistance.copy(T),v.nearEdge=x,v.nearParam=M)}m.minDistance.lessThan(i.minDistance)&&i.copy(m),g.minDistance.lessThan(a.minDistance)&&a.copy(g),v.minDistance.lessThan(s.minDistance)&&s.copy(v);var S=Math.abs(E(m.minDistance.distance,g.minDistance.distance,v.minDistance.distance));S<l&&(l=S,p=-this.windings[y]),m.nearEdge&&m.nearEdge.distanceToPseudoDistance(m.minDistance,e,m.nearParam),g.nearEdge&&g.nearEdge.distanceToPseudoDistance(g.minDistance,e,g.nearParam),v.nearEdge&&v.nearEdge.distanceToPseudoDistance(v.minDistance,e,v.nearParam),S=E(m.minDistance.distance,g.minDistance.distance,v.minDistance.distance),n[y].r=m.minDistance.distance,n[y].g=g.minDistance.distance,n[y].b=v.minDistance.distance,n[y].med=S,this.windings[y]>0&&S>=0&&Math.abs(S)<Math.abs(d)&&(d=S),this.windings[y]<0&&S<=0&&Math.abs(S)<Math.abs(c)&&(c=S)}i.nearEdge&&i.nearEdge.distanceToPseudoDistance(i.minDistance,e,i.nearParam),a.nearEdge&&a.nearEdge.distanceToPseudoDistance(a.minDistance,e,a.nearParam),s.nearEdge&&s.nearEdge.distanceToPseudoDistance(s.minDistance,e,s.nearParam);var C={r:o,g:o,b:o,med:o};if(d>=0&&Math.abs(d)<=Math.abs(c)){C.med=o,p=1;for(var P=0;P<t;++P)this.windings[P]>0&&n[P].med>C.med&&Math.abs(n[P].med)<Math.abs(c)&&(C=n[P])}else if(c<=0&&Math.abs(c)<=Math.abs(d)){C.med=-o,p=-1;for(var L=0;L<t;++L)this.windings[L]<0&&n[L].med<C.med&&Math.abs(n[L].med)<Math.abs(d)&&(C=n[L])}for(var R=0;R<t;++R)this.windings[R]!=p&&Math.abs(n[R].med)<Math.abs(C.med)&&(C=n[R]);return E(i.minDistance.distance,a.minDistance.distance,s.minDistance.distance)==C.med&&(C.r=i.minDistance.distance,C.g=a.minDistance.distance,C.b=s.minDistance.distance),new r.Vector3(C.r,C.g,C.b)},minSameColoredEdgeDistance:function(){for(var e=[1e10,1e10,1e10],t=0;t<this.contours.length;++t)for(var n=this.contours[t],i=0;i<n.edges.length;++i)for(var r=n.edges[i],o=0;o+1<i;++o){var a=n.edges[o];if(r.color==a.color){var s=Math.min(Math.min(T(r.point(0),a),T(r.point(1),a)),Math.min(T(a.point(0),r),T(a.point(1),r))),l=r.color-p;e[l]=Math.min(e[l],s)}}return Math.min(Math.min(e[0],e[1]),e[2])}},n.d(t,"MaterialConverter",function(){return ie});var N,k,V={MilliMeter:1e3,mm:1e3,8206:1e3,DeciMeter:10,dm:10,8204:10,CentiMeter:100,cm:100,8205:100,Meter:1,m:1,8193:1,KiloMeter:.001,km:.001,8201:.001,Inch:39.37008,in:39.37008,8214:39.37008,Foot:3.28084,ft:3.28084,8215:3.28084,Mile:62137e-8,mi:62137e-8,8225:62137e-8,Yard:1.09361,yard:1.09361,8221:1.09361};function F(e,t){var n=R(e,"texture_RealWorldOffsetX",t,0),i=R(e,"texture_RealWorldOffsetY",t,0),r=L(e,"scalars","texture_UOffset",0),o=L(e,"scalars","texture_VOffset",0),a=1,s=1;null!=L(e,"scalars","texture_RealWorldScale")?a=s=R(e,"texture_RealWorldScale",t,1):(a=R(e,"texture_RealWorldScaleX",t,1),s=R(e,"texture_RealWorldScaleY",t,1)),a=0===a?1:a,s=0===s?1:s;var l=L(e,"scalars","texture_UScale",1),c=L(e,"scalars","texture_VScale",1),u=L(e,"scalars","texture_WAngle",1);u*=Math.PI/180;var h=Math.cos(u),d=Math.sin(u),f=l/a,p=c/s;return{elements:[h*f,d*f,0,-d*p,h*p,0,-h*f*n+d*p*i+r,-d*f*n-h*p*i+o,1]}}function B(e,t,n){e[n+"_enable"]=L(t,"booleans",n+"_enable",0);var i=function(e,t,n){var i={bands:0,weights:new r.Vector4(1,1,1,1),frequencies:new r.Vector4(1,1,1,1)};if(!e||!e[t])return i;var o=e[t][n];if(!(o&&o.values&&o.values instanceof Array))return i;var a=o.values;i.bands=a.length/2;for(var s=0;s<i.bands;++s)i.frequencies.setComponent(s,1/a[2*s]),i.weights.setComponent(s,a[2*s+1]);return i}(t,"scalars",n+"_prof");e[n+"_bands"]=i.bands,e[n+"_weights"]=i.weights,e[n+"_frequencies"]=i.frequencies}function U(e,t){if(0!==t.randomOffsetMode){e.tilingRandomAxisS=new r.Vector2,e.tilingRandomAxisT=new r.Vector2,e.tilingRandomAlignmentOffset=new r.Vector2;var n=e.tilingRandomAxisS;n.set(1,0);var i=e.tilingRandomAxisT;i.set(0,1);var o=e.tilingRandomAlignmentOffset;o.set(0,0);var a=new r.Matrix4,s=new r.Matrix4,l=function(e){var t=["opaque_albedo_map","opaque_f0_map","layered_diffuse_map","layered_bottom_f0_map","surface_roughness_map","surface_normal_map","surface_albedo_map","surface_anisotropy_map","surface_cutout_map"];if(void 0!==e.textureMaps)for(var n=0;n<t.length;++n)if(void 0!==e.textureMaps[t[n]]&&void 0!==e.textureMaps[t[n]].textureObj&&void 0!==e.textureMaps[t[n]].textureObj.matrix){var i=e.textureMaps[t[n]].textureObj.matrix.elements,o=new r.Matrix4;return o.set(i[0],i[1],0,i[2],i[3],i[4],0,i[5],0,0,1,0,i[6],i[7],0,i[8]),o}return new r.Matrix4}(e),c=function(e,t){var n=new r.Matrix4;n.makeScale(t.x,t.y,1);var i=new r.Matrix4;return i.makeTranslation(-e.x,-e.y,0),n.multiply(i),n}(new r.Vector2(0,1),new r.Vector2(1,-1));c.multiply(l),l.copy(c),a.multiplyMatrices(l,e.tilingUVTransform),s.getInverse(a);var u=new r.Vector4(1,0,0,0).applyMatrix4(s);n.set(u.x,u.y),u=new r.Vector4(0,1,0,0).applyMatrix4(s),i.set(u.x,u.y);for(var h=new r.Vector2,d=new r.Box2,f=t.alignedVertices,p=0;p<f.length;p++)u.set(f[p].x,f[p].y,0,1),u.applyMatrix4(a),h.set(u.x,u.y),d.expandByPoint(h);u.set(-d.min.x,-d.min.y,0,0),u.applyMatrix4(s),o.set(u.x,u.y);var m=d.size(),g=1===t.randomOffsetMode?new r.Vector2(m.x,m.y):new r.Vector2(0,0);n.multiplyScalar(1-g.x),i.multiplyScalar(1-g.y)}}function z(e,t,n){var i=new r.Vector2(n.x,n.y).sub(t),o=new r.Vector2(e.x,e.y).sub(t),a=i.dot(o);if(a<=0)return o.length();var s=i.dot(i);return a>=s?new r.Vector2(e).sub(n).length():Math.sqrt(Math.max(o.dot(o)-a*a/s,0))}function G(e,t){for(var n=1e11,i=n,r=-1,o=0;o<e.vertices.length;o++){var a=o==e.vertices.length-1?0:o+1;(i=z(t,e.vertices[o],e.vertices[a]))<n&&(n=i,r=o)}return[n,r]}function H(e,t,n){for(var i=e.length,r=i-1,o=!1,a=0;a<i;++a)(e[a].y<n&&e[r].y>=n||e[r].y<n&&e[a].y>=n)&&e[a].x+(n-e[a].y)/(e[r].y-e[a].y)*(e[r].x-e[a].x)<t&&(o=!o),r=a;return o}function W(e,t){var n=t.bbox.size(),i=2*e.cornerRoundingSize*.7071/3,o=Q(Math.ceil(n.x/i)+2,128,1024),a=Q(Math.ceil(n.y/i)+2,128,1024);o-=2,a-=2,n.x<n.y?a=Math.floor(o*n.y/n.x):o=Math.floor(a*n.x/n.y),o+=2,a+=2,function(e,t){e.normalToEdges=[];for(var n=e.vertices.length,i=Math.cos(t),o=Math.sin(t),a=0;a<n;++a){var s=a,l=a==n-1?0:a+1,c=new r.Vector2(e.vertices[l].x,e.vertices[l].y);c.sub(e.vertices[s]),c.normalize();var u=new r.Vector3(c.y*o,-c.x*o,i);e.normalToEdges.push(u)}e.cornerRoundingAngle=t}(t,e.cornerRoundingAngle);for(var s=new Uint8Array(o*a*4),l=new r.Vector2(n.x/(o-2),n.y/(a-2)),c=new r.Vector2,u=new r.Vector3,h=new r.Vector3(0,0,1),d=0,f=0;f<a;f++){c.y=(a-f-1.5)*l.y+t.bbox.min.y;for(var p=0;p<o;p++){c.x=(p-.5)*l.x+t.bbox.min.x;var m=G(t,c),g=m[0],v=m[1];g<e.cornerRoundingSize+e.insetSize?(H(t.vertices,c.x,c.y)||(g=-g),u.copy(t.normalToEdges[v]),u.lerp(h,(g-e.insetSize)/e.cornerRoundingSize),u.normalize(),s[d++]=255*Q(.5*(u.x+1),0,1),s[d++]=255*Q(.5*(u.y+1),0,1),s[d++]=255*Q(.5*(u.z+1),0,1),s[d++]=255):(s[d++]=127,s[d++]=127,s[d++]=255,s[d++]=255)}}t.material.TilingNormalMap=new r.DataTexture(s,o,a,r.RGBAFormat,r.UnsignedByteType,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.LinearFilter,r.LinearFilter),t.material.TilingNormalMap.needsUpdate=!0;var y=new r.Vector2(-t.bbox.min.x,-t.bbox.min.y);t.material.TilingNormalMap_texMatrix=new r.Matrix3,t.material.TilingNormalMap_texMatrix.set(1/n.x*(o-2)/o,0,0,0,1/n.y*(a-2)/a,0,y.x/n.x*(o-2)/o+1/o,y.y/n.y*(a-2)/a+1/a,1),t.material.TilingNormalMap_texMatrix.transpose()}function j(e,t){return e<<t|e>>>32-t}function X(e,t){var n,i,r;return n=i=r=3735928567+t,i+=e.y,function(e,t,n){var i=4294967296;return n=((n^=t)-j(t,14)+i)%i,n=((n^=t=((t^=e=((e^=n)-j(n,11)+i)%i)-j(e,25)+i)%i)-j(t,16)+i)%i,n=((n^=t=((t^=e=((e^=n)-j(n,4)+i)%i)-j(e,14)+i)%i)-j(t,24)+i)%i}(n+=e.x,i,r)}function q(e,t){for(var n,i,o=new Uint8Array(1048576),a=new r.Vector2,s=new r.Vector2(107021*t,t),l=new r.Vector2,c=new r.Vector2,u=0,h=0;h<512;h++){a.y=Math.floor(-(h+1-256));for(var d=0;d<512;d++)a.x=Math.floor(d-256),l.copy(a),l.add(s),n=c,i=void 0,i=X(l,33),n.x=(65535&i)>>>8,n.y=i>>>16>>>8,o[u++]=0,o[u++]=0,o[u++]=c.x,o[u++]=c.y}e.material.TilingRandomMap=new r.DataTexture(o,512,512,r.RGBAFormat,r.UnsignedByteType,r.UVMapping,r.RepeatWrapping,r.RepeatWrapping,r.NearestFilter,r.NearestFilter),e.material.TilingRandomMap.needsUpdate=!0;new r.Vector2(-e.bbox.min.x,-e.bbox.min.y);e.material.TilingRandomMap_texMatrix=new r.Matrix3,e.material.TilingRandomMap_texMatrix.set(1/512,0,0,0,1/512,0,.5,.5,1),e.material.TilingRandomMap_texMatrix.transpose()}function Y(e,t,n){var i=[];i[0]=new r.Vector2(e.offsetVectorA.x,e.offsetVectorB.x),i[1]=new r.Vector2(e.offsetVectorA.y,e.offsetVectorB.y);for(var o=K(i),a=new r.Box2,s=new r.Vector2,l=0;l<t.vertices.length;++l)s.x=t.vertices[l].dot(o[0]),s.y=t.vertices[l].dot(o[1]),a.expandByPoint(s);n[0]=Math.floor(a.min.x-1),n[2]=Math.ceil(a.max.x),n[1]=Math.floor(a.min.y-1),n[3]=Math.ceil(a.max.y)}function K(e){var t=e[0].x*e[1].y-e[0].y*e[1].x,n=[];return n[0]=new r.Vector2(e[1].y/t,-e[0].y/t),n[1]=new r.Vector2(-e[1].x/t,e[0].x/t),n}function Q(e,t,n){return e>n?n:e<t?t:e}function Z(e,t){var n=new M;!function(e,t){for(var n=e.addBlankContour(),i=new r.Vector2,o=new r.Vector2,a=0;a<t.vertices.length;++a){var s=a,l=(a+1)%t.vertices.length;i=t.vertices[s],o=t.vertices[l],n.addEdge(new v(i,o,g))}e.initialize(),e.edgeColoringSimple(3,0)}(n,t);for(var i=t.bbox.size(),o=.7071*n.minSameColoredEdgeDistance()*.5,a=Q(Math.ceil(i.x/o)+2,16,512),s=Q(Math.ceil(i.y/o)+2,16,512),l=new Uint8Array(a*s*4),c=new r.Vector2(i.x/(a-2),i.y/(s-2)),u=(new r.Vector2(c.x*a,c.y*s),.5/(c.x+c.y)),h=new r.Vector2,d=new r.Vector3,f=0,p=0;p<s;p++){h.y=(s-p-1.5)*c.y+t.bbox.min.y;for(var m=0;m<a;m++)h.x=(m-.5)*c.x+t.bbox.min.x,d=(d=n.calculateMSDFValue(h)).add(new r.Vector3(e.insetSize,e.insetSize,e.insetSize)),l[f++]=255*Q(d.x*u+.5,0,1),l[f++]=255*Q(d.y*u+.5,0,1),l[f++]=255*Q(d.z*u+.5,0,1),l[f++]=0}t.material.TilingMap=new r.DataTexture(l,a,s,r.RGBAFormat,r.UnsignedByteType,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.LinearFilter,r.LinearFilter),t.material.TilingMap.needsUpdate=!0;var y=new r.Vector2(-t.bbox.min.x,-t.bbox.min.y);t.material.TilingMap_texMatrix=new r.Matrix3,t.material.TilingMap_texMatrix.set(1/i.x*(a-2)/a,0,0,0,1/i.y*(s-2)/s,0,y.x/i.x*(a-2)/a+1/a,y.y/i.y*(s-2)/s+1/s,1),t.material.TilingMap_texMatrix.transpose()}function J(e,t,n){var i=e.properties;t.clampS=!L(i,"booleans","texture_URepeat",!1),t.clampT=!L(i,"booleans","texture_VRepeat",!1),t.wrapS=t.clampS?r.ClampToEdgeWrapping:r.RepeatWrapping,t.wrapT=t.clampT?r.ClampToEdgeWrapping:r.RepeatWrapping,t.matrix=e.matrix||(e.matrix=F(i,n)),"UnifiedBitmap"==e.definition&&(t.invert=L(i,"booleans","unifiedbitmap_Invert",!1)),"BumpMap"==e.definition&&(t.bumpmapType=L(i,"choicelists","bumpmap_Type",0),t.bumpScale=function(e,t,n){if(0===t){var i=R(e,"bumpmap_Depth",n,0),o=1,a=1;return null!=L(e,"scalars","texture_RealWorldScale")?o=a=R(e,"texture_RealWorldScale",n,1):(o=R(e,"texture_RealWorldScaleX",n,1),a=R(e,"texture_RealWorldScaleY",n,1)),o=0===o?1:1/o,a=0===a?1:1/a,new r.Vector2(o*i,a*i)}var s=L(e,"scalars","bumpmap_NormalScale",1);return new r.Vector2(s,s)}(i,t.bumpmapType,n))}function $(e){var t=C(e,"texture_UScale",1),n=C(e,"texture_VScale",1),i=C(e,"texture_UOffset",0),r=C(e,"texture_VOffset",0),o=C(e,"texture_WAngle",0);return{elements:[Math.cos(o)*t,Math.sin(o)*n,0,-Math.sin(o)*t,Math.cos(o)*n,0,i,r,1]}}function ee(e,t,n){return e.matrix||(e.matrix=t?F(e.properties,n):$(e.properties)),e.matrix}function te(e){var t=e.materials,n=t[e.userassets[0]];if(n){var i=n.definition;if("TilingPattern"===i)(n=t[n.properties.references.grout_material.connections[0]])&&(i=n.definition);return"PrismLayered"==i||"PrismMetal"==i||"PrismOpaque"==i||"PrismTransparent"==i||"PrismGlazing"==i||"PrismWood"==i}return!1}function ne(e){return.299*e.r+.587*e.g+.114*e.b}var ie={convertMaterial:function(e,t,n,o){o=o||e.userassets;var a=e.materials,s=a[o];s&&"TilingPattern"===s.definition&&(s=a[s.properties.references.grout_material.connections[0]]);var l,c,u=s.properties,h=te(e);if(n){if(!(h?n.isPrismMaterial:n instanceof r.MeshPhongMaterial))return null;n.needsUpdate=!0}else n=h?Object(i.createPrismMaterial)():new r.MeshPhongMaterial;if(n.proteinMat=e,n.proteinCategories=s.categories,n.packedNormals=!0,s&&h){n.tag=s.tag,n.prismType=s.definition,void 0===n.prismType&&(n.prismType=""),void 0!==e.IsSingleSided&&!1===e.IsSingleSided&&(n.side=r.DoubleSide);var d=n.mapList;switch(n.transparent=!1,n.envExponentMin=1,n.envExponentMax=512,n.envExponentCount=10,n.surface_albedo=O(S(u,"surface_albedo",new r.Color(1,0,0))),d.surface_albedo_map=D(u,"colors","surface_albedo",null),n.surface_anisotropy=L(u,"scalars","surface_anisotropy",0),d.surface_anisotropy_map=D(u,"scalars","surface_anisotropy",null),n.surface_rotation=L(u,"scalars","surface_rotation",0),d.surface_rotation_map=D(u,"scalars","surface_rotation",null),n.surface_roughness=L(u,"scalars","surface_roughness",0),d.surface_roughness_map=D(u,"scalars","surface_roughness",null),d.surface_cutout_map=D(u,"textures","surface_cutout",null),d.surface_normal_map=D(u,"textures","surface_normal",null),null!=d.surface_cutout_map&&(n.side=r.DoubleSide,n.transparent=!0),n.prismType){case"PrismOpaque":n.opaque_albedo=O(S(u,"opaque_albedo",new r.Color(1,0,0))),d.opaque_albedo_map=D(u,"colors","opaque_albedo",null),n.opaque_luminance_modifier=O(S(u,"opaque_luminance_modifier",new r.Color(0,0,0))),d.opaque_luminance_modifier_map=D(u,"colors","opaque_luminance_modifier",null),n.opaque_f0=L(u,"scalars","opaque_f0",0),d.opaque_f0_map=D(u,"scalars","opaque_f0",null),n.opaque_luminance=L(u,"scalars","opaque_luminance",0);break;case"PrismMetal":n.metal_f0=O(S(u,"metal_f0",new r.Color(1,0,0))),d.metal_f0_map=D(u,"colors","metal_f0",null);break;case"PrismLayered":n.layered_bottom_f0=O(S(u,"layered_bottom_f0",new r.Color(1,1,1))),d.layered_bottom_f0_map=D(u,"colors","layered_bottom_f0",null),n.layered_diffuse=O(S(u,"layered_diffuse",new r.Color(1,0,0))),d.layered_diffuse_map=D(u,"colors","layered_diffuse",null),n.layered_anisotropy=L(u,"scalars","layered_anisotropy",0),d.layered_anisotropy_map=D(u,"scalars","layered_anisotropy",null),n.layered_f0=L(u,"scalars","layered_f0",0),d.layered_f0_map=D(u,"scalars","layered_f0",null),n.layered_fraction=L(u,"scalars","layered_fraction",0),d.layered_fraction_map=D(u,"scalars","layered_fraction",null),n.layered_rotation=L(u,"scalars","layered_rotation",0),d.layered_rotation_map=D(u,"scalars","layered_rotation",null),n.layered_roughness=L(u,"scalars","layered_roughness",0),d.layered_roughness_map=D(u,"scalars","layered_roughness",null),d.layered_normal_map=D(u,"textures","layered_normal",null);break;case"PrismTransparent":n.transparent_color=O(S(u,"transparent_color",new r.Color(1,0,0))),n.transparent_distance=L(u,"scalars","transparent_distance",0),n.transparent_ior=L(u,"scalars","transparent_ior",0),n.transparent=!0;break;case"PrismGlazing":n.glazing_f0=O(S(u,"glazing_f0",new r.Color(1,1,1))),d.glazing_f0_map=D(u,"colors","glazing_f0",null),n.glazing_transmission_color=O(S(u,"glazing_transmission_color",new r.Color(1,1,1))),d.glazing_transmission_color_map=D(u,"colors","glazing_transmission_color",null),n.glazing_transmission_roughness=C(u,"glazing_transmission_roughness",0),d.glazing_transmission_roughness_map=D(u,"scalars","glazing_transmission_roughness",null),n.side=L(u,"booleans","glazing_backface_culling",!1)?r.FrontSide:r.DoubleSide,n.transparent=!0;break;case"PrismWood":B(n,u,"wood_fiber_cosine"),B(n,u,"wood_fiber_perlin"),n.wood_fiber_perlin_scale_z=L(u,"scalars","wood_fiber_perlin_scale_z",0),B(n,u,"wood_growth_perlin"),n.wood_latewood_ratio=L(u,"scalars","wood_latewood_ratio",0),n.wood_earlywood_sharpness=L(u,"scalars","wood_earlywood_sharpness",0),n.wood_latewood_sharpness=L(u,"scalars","wood_latewood_sharpness",0),n.wood_ring_thickness=L(u,"scalars","wood_ring_thickness",0),B(n,u,"wood_earlycolor_perlin"),n.wood_early_color=O(S(u,"wood_early_color",new r.Color(1,0,0))),n.wood_use_manual_late_color=L(u,"booleans","wood_use_manual_late_color",0),n.wood_manual_late_color=O(S(u,"wood_manual_late_color",new r.Color(1,0,0))),B(n,u,"wood_latecolor_perlin"),n.wood_late_color_power=L(u,"scalars","wood_late_color_power",0),B(n,u,"wood_diffuse_perlin"),n.wood_diffuse_perlin_scale_z=L(u,"scalars","wood_diffuse_perlin_scale_z",0),n.wood_use_pores=L(u,"booleans","wood_use_pores",0),n.wood_pore_type=L(u,"choicelists","wood_pore_type",0),n.wood_pore_radius=L(u,"scalars","wood_pore_radius",0),n.wood_pore_cell_dim=L(u,"scalars","wood_pore_cell_dim",0),n.wood_pore_color_power=L(u,"scalars","wood_pore_color_power",0),n.wood_pore_depth=L(u,"scalars","wood_pore_depth",0),n.wood_use_rays=L(u,"booleans","wood_use_rays",0),n.wood_ray_color_power=L(u,"scalars","wood_ray_color_power",0),n.wood_ray_seg_length_z=L(u,"scalars","wood_ray_seg_length_z",0),n.wood_ray_num_slices=L(u,"integers","wood_ray_num_slices",0),n.wood_ray_ellipse_z2x=L(u,"scalars","wood_ray_ellipse_z2x",0),n.wood_ray_ellipse_radius_x=L(u,"scalars","wood_ray_ellipse_radius_x",0),n.wood_use_latewood_bump=L(u,"booleans","wood_use_latewood_bump",0),n.wood_latewood_bump_depth=L(u,"scalars","wood_latewood_bump_depth",0),n.wood_use_groove_roughness=L(u,"booleans","wood_use_groove_roughness",0),n.wood_groove_roughness=L(u,"scalars","wood_groove_roughness",0),n.wood_diffuse_lobe_weight=L(u,"scalars","wood_diffuse_lobe_weight",0),n.wood_curly_distortion_enable=L(u,"booleans","wood_curly_distortion_enable",0),n.wood_curly_distortion_scale=L(u,"scalars","wood_curly_distortion_scale",0),d.wood_curly_distortion_map=D(u,"scalars","wood_curly_distortion_map",null),k||function(){var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=new Uint8Array(e),n=new r.DataTexture(t,256,1,r.LuminanceFormat,r.UnsignedByteType,r.UVMapping,r.RepeatWrapping,r.RepeatWrapping,r.NearestFilter,r.NearestFilter,0);n.generateMipmaps=!1,n.flipY=!1,n.needsUpdate=!0;var i=new Uint8Array([225,39,122,231,29,173,15,159,75,88,233,19,179,79,72,94,54,73,151,161,171,113,221,144,127,83,168,19,88,122,62,225,109,128,246,247,172,101,61,139,211,168,64,210,224,82,87,97,119,250,201,44,242,239,154,99,126,13,44,70,246,170,100,52,135,28,187,22,207,119,199,1,235,187,55,131,190,124,222,249,236,53,225,231,71,30,173,185,153,47,79,133,225,10,140,62,17,99,100,29,137,95,142,244,76,5,83,124,38,216,253,195,44,210,148,185,188,39,78,195,132,30,60,73,92,223,133,80,230,56,118,207,79,15,251,211,111,21,79,23,240,146,150,207,3,61,103,27,148,6,31,127,235,58,173,244,116,81,34,120,192,213,188,226,97,23,16,161,106,80,242,148,35,37,91,117,51,216,97,193,126,222,39,38,133,217,215,23,237,57,205,42,222,165,126,133,33,8,227,154,27,18,56,11,192,120,80,92,236,38,210,207,128,31,135,39,123,5,49,127,107,200,34,14,153,239,134,19,248,162,58,201,159,198,243,158,72,5,138,184,222,200,34,141,233,40,195,238,191,122,171,32,66,254,229,197]),o=new r.DataTexture(i,256,1,r.LuminanceFormat,r.UnsignedByteType,r.UVMapping,r.RepeatWrapping,r.RepeatWrapping,r.NearestFilter,r.NearestFilter,0);o.generateMipmaps=!1,o.flipY=!1,o.needsUpdate=!0;for(var a,s,l,c,u,h,d,f,p=function(t){return e[t%256]},m=new Array(262144),g=0;g<256;++g)for(f=0;f<256;++f)a=p(f)+g,s=p(a),l=p(a+1),c=p(f+1)+g,u=p(c),h=p(c+1),m[d=4*(256*g+f)]=s,m[d+1]=l,m[d+2]=u,m[d+3]=h;var v=new Uint8Array(m),y=new r.DataTexture(v,256,256,r.RGBAFormat,r.UnsignedByteType,r.UVMapping,r.RepeatWrapping,r.RepeatWrapping,r.NearestFilter,r.NearestFilter,0);y.generateMipmaps=!1,y.flipY=!1,y.needsUpdate=!0;var _=[1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1,1,1,0,0,-1,1,-1,1,0,0,-1,-1],b=new Array(1024);for(f=0;f<256;++f){var x=e[f]%16;b[4*f]=127*_[3*x]+128,b[4*f+1]=127*_[3*x+1]+128,b[4*f+2]=127*_[3*x+2]+128,b[4*f+3]=0}var w=new Uint8Array(b),A=new r.DataTexture(w,256,1,r.RGBAFormat,r.UnsignedByteType,r.UVMapping,r.RepeatWrapping,r.RepeatWrapping,r.NearestFilter,r.NearestFilter,0);A.generateMipmaps=!1,A.flipY=!1,A.needsUpdate=!0,k={permutation:n,gradient:o,perm2D:y,permGrad:A}}(),n.uniforms.permutationMap.value=k.permutation,n.uniforms.gradientMap.value=k.gradient,n.uniforms.perm2DMap.value=k.perm2D,n.uniforms.permGradMap.value=k.permGrad;break;default:r.warn("Unknown prism type: "+n.prismType)}for(var f in n.enableImportantSampling&&(n.surface_anisotropy||n.surface_rotation||n.layered_anisotropy||n.layered_rotation)&&(N||function(){var e=new Uint8Array([0,128,64,191,32,160,96,223,16,143,80,207,48,175,112,239,8,135,72,199,40,167,103,231,25,151,88,215,56,183,120,250]),t=new r.DataTexture(e,32,1,r.LuminanceFormat,r.UnsignedByteType,r.UVMapping,r.RepeatWrapping,r.RepeatWrapping,r.NearestFilter,r.NearestFilter,0);t.generateMipmaps=!1,t.flipY=!1,t.needsUpdate=!0;for(var n,i,o=function(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))},a=new Uint8Array(16384),s=0;s<128;++s)for(var l=0;l<128;++l){n=s/128*2-1,i=l/128*2-1;var c=(n=Math.min(Math.max(1/128-1,n),1-1/128))-1/128,u=n+1/128,h=(i=Math.min(Math.max(1/128-1,i),1-1/128))-1/128,d=i+1/128,f=o(u,d)-o(c,d)-o(u,h)+o(c,h);a[128*s+l]=1e6*f}var p=new r.DataTexture(a,128,128,r.LuminanceFormat,r.UnsignedByteType,r.UVMapping,r.RepeatWrapping,r.RepeatWrapping,r.NearestFilter,r.NearestFilter,0);p.generateMipmaps=!1,p.flipY=!1,p.needsUpdate=!0,N={randomNum:t,solidAngle:p}}(),n.uniforms.importantSamplingRandomMap.value=N.randomNum,n.uniforms.importantSamplingSolidAngleMap.value=N.solidAngle),n.defines={},n.textureMaps={},d)if(d[f]){var p=a[d[f]];c=p.properties,p.matrix=ee(p,!0,t);var m="BumpMap"==p.definition?"bumpmap_Bitmap":"unifiedbitmap_Bitmap",g=c.uris[m].values,v=g[0];v&&(l={mapName:f,uri:v,uriPointer:g,textureObj:p,isPrism:!0},n.textureMaps[l.mapName]=l,n.defines["USE_"+f.toUpperCase()]="")}n.defines[n.prismType.toUpperCase()]="","PrismWood"==n.prismType&&n.enable3DWoodBump&&(n.defines.PRISMWOODBUMP=""),n.enableImportantSampling&&(n.defines.ENABLEIMPORTANTSAMPLING="")}else if(s&&!h&&"SimplePhong"==s.definition){n.tag=s.tag,n.proteinType=s.proteinType,void 0===n.proteinType&&(n.proteinType=null);var y=P(u,"generic_baked_lighting",!1);n.disableEnvMap=y;var _=n.ambient=S(u,"generic_ambient"),b=n.color=S(u,"generic_diffuse"),x=n.specular=S(u,"generic_specular"),w=n.emissive=S(u,"generic_emissive");n.shininess=C(u,"generic_glossiness",30),n.opacity=1-C(u,"generic_transparency",0),n.reflectivity=C(u,"generic_reflectivity_at_0deg",0);var A=P(u,"generic_bump_is_normal"),E=C(u,"generic_bump_amount",0);null==E&&(E=1),A?(E>1&&(E=1),n.normalScale=new r.Vector2(E,E)):(E>=1&&(E=.03),n.bumpScale=E);var T=P(u,"generic_is_metal");void 0!==T&&(n.metal=T);var M=P(u,"generic_backface_cull");void 0===M||M||(n.side=r.DoubleSide),n.transparent=s.transparent,n.textureMaps={};var R=s.textures;for(var I in R)if((l={}).textureObj=a[R[I].connections[0]],c=l.textureObj.properties,l.textureObj.matrix=ee(l.textureObj,!1,t),l.uriPointer=c.uris.unifiedbitmap_Bitmap.values,l.uri=l.uriPointer[0],l.uri){if("generic_diffuse"==I)l.mapName="map",(!n.color||0===n.color.r&&0===n.color.g&&0===n.color.b)&&n.color.setRGB(1,1,1);else if("generic_bump"==I)l.mapName=A?"normalMap":"bumpMap";else if("generic_specular"==I)l.mapName="specularMap";else{if("generic_alpha"!=I)continue;l.mapName="alphaMap",n.side=r.DoubleSide,n.transparent=!0}n.textureMaps[l.mapName]=l}0===b.r&&0===b.g&&0===b.b&&0===x.r&&0===x.g&&0===x.b&&0===_.r&&0===_.g&&0===_.b&&0===w.r&&0===w.g&&0===w.b&&(b.r=b.g=b.b=.4),n.extraDepthOffset=C(u,"generic_depth_offset"),n.extraDepthOffset&&(n.polygonOffset=!0,n.polygonOffsetFactor=n.extraDepthOffset,n.polygonOffsetUnits=0)}else n.ambient=new r.Color(197379),n.color=new r.Color(7829367),n.specular=new r.Color(3355443),n.shininess=30,n.shading=r.SmoothShading;return e.transparent=n.transparent,n},materialTilingPattern:function(e,t,n,i,o){var a,s,l=t.properties,c={overallTransform:new r.Matrix4,insetSize:0,hasRoundCorner:!1,cornerRoundingAngle:0,cornerRoundingSize:0,offsetVectorA:new r.Vector2,offsetVectorB:new r.Vector2},u=new r.Vector2(R(l,"scale_factor_x",o,1),R(l,"scale_factor_y",o,1)),h=R(l,"overall_offset_vector_x",o,1),d=R(l,"overall_offset_vector_y",o,1),f=C(l,"overall_rotation_angle",0)*Math.PI/180;!function(e,t,n,i){e.scale(i);var o=new r.Vector3(Math.sin(n.x),Math.sin(n.y),Math.sin(n.z)),a=new r.Vector3(Math.cos(n.x),Math.cos(n.y),Math.cos(n.z)),s=o.y*o.x,l=o.y*a.x,c=new r.Matrix4;c.set(a.z*a.y,o.z*a.y,-o.y,0,a.z*s-o.z*a.x,o.z*s+a.z*a.x,a.y*o.x,0,a.z*l+o.z*o.x,o.z*l-a.z*o.x,a.y*a.x,0,0,0,0,1),c.multiply(e),e.makeTranslation(t.x,t.y,t.z),e.multiply(c)}(c.overallTransform,new r.Vector3(-h,-d,0),new r.Vector3(0,0,-f),new r.Vector3(1,1,1)),c.insetSize=R(l,"inset_size",o,1),c.cornerRoundingAngle=C(l,"overall_corner_rounding_angle",0)*Math.PI/180,c.cornerRoundingSize=R(l,"overall_corner_rounding_size",o,1),c.offsetVectorA.x=C(l,"offset_vector_a_x",0)*u.x,c.offsetVectorA.y=C(l,"offset_vector_a_y",0)*u.y,c.offsetVectorB.x=C(l,"offset_vector_b_x",0)*u.x,c.offsetVectorB.y=C(l,"offset_vector_b_y",0)*u.y,c.hasRoundCorner=c.cornerRoundingAngle>0&&c.cornerRoundingSize>0;var p=[];for(a=0,s=n.length;a<s;a++){var m=n[a].properties,g={material:i[a].material,randomOffsetMode:0,rotation:0,vertices:[]};p[a]=g,g.randomOffsetMode=L(m,"choicelists","random_offset_mode",0),g.rotation=C(m,"rotation_angle",0)*Math.PI/180;for(var v=m.scalars.vertices.values,y=0;y<v.length;y+=2)g.vertices[y/2]=new r.Vector2(v[y],v[y+1]);for(var _=0;_<g.vertices.length;_++)g.vertices[_].multiply(u);g.material.useRandomOffset=0!=g.randomOffsetMode}!function(e,t){var n=new r.Box2;n.expandByPoint(new r.Vector2(0,0)),n.expandByPoint(e.offsetVectorA),n.expandByPoint(e.offsetVectorB);var i,o,a=new r.Vector2(e.offsetVectorA.x,e.offsetVectorA.y);for(a.add(e.offsetVectorB),n.expandByPoint(a),i=0,o=t.length;i<o;i++){var s=t[i];s.material.tilingRepeatRange=[],Y(e,s,s.material.tilingRepeatRange),s.bbox=new r.Box2;for(var l=0;l<s.vertices.length;++l)s.bbox.expandByPoint(s.vertices[l]);Z(e,s),e.hasRoundCorner&&W(e,s),s.material.useRandomOffset&&q(s,i),s.alignedVertices=[];for(var c=0;c<s.vertices.length;++c){var u=new r.Vector2(s.vertices[c].x,s.vertices[c].y);u.sub(s.bbox.min),s.alignedVertices.push(u)}s.material.tileAlignOffset=new r.Vector2(-s.bbox.min.x,-s.bbox.min.y)}}(c,p);var b,x,w,A,E=K([c.offsetVectorA.clone(),c.offsetVectorB.clone()]);for(a=0,s=p.length;a<s;a++){var T=p[a],M=T.material;M.tilingOverallTransform=c.overallTransform,M.hasRoundCorner=c.hasRoundCorner,M.tilingUVTransform=(b=T.rotation,x=void 0,w=void 0,A=void 0,x=Math.sin(b),w=Math.cos(b),(A=new r.Matrix4).set(w,-x,0,0,x,w,0,0,0,0,1,0,0,0,0,1),A),M.useRandomOffset&&U(M,T),M.tile2uv=new r.Vector4(c.offsetVectorA.x,c.offsetVectorA.y,c.offsetVectorB.x,c.offsetVectorB.y),M.uv2tile=new r.Vector4(E[0].x,E[0].y,E[1].x,E[1].y)}},convertTexture:function(e,t,n,i){"bumpMap"==e.mapName||"normalMap"==e.mapName?t.anisotropy=0:t.anisotropy=i||0,t.flipY=void 0===e.flipY||e.flipY,t.invert=!1,t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.isPrism?J(e.textureObj,t,n):function(e,t){if(e){var n=e.properties;t.invert=P(n,"unifiedbitmap_Invert"),t.clampS=!P(n,"texture_URepeat",!0),t.clampT=!P(n,"texture_VRepeat",!0),t.wrapS=t.clampS?r.ClampToEdgeWrapping:r.RepeatWrapping,t.wrapT=t.clampT?r.ClampToEdgeWrapping:r.RepeatWrapping,t.matrix=e.matrix||(e.matrix=$(n))}}(e.textureObj,t)},get2DMapTransform:ee,isPrismMaterial:te,hasTiling:function(e){var t=e.materials[e.userassets[0]];return!(!t||"TilingPattern"!==t.definition)},convertMaterialGltf:function(e,t){var n=new r.MeshPhongMaterial;n.packedNormals=!0,n.textureMaps={};var i=e.values,o=i.diffuse;if(o)if(Array.isArray(o))n.color=new r.Color(o[0],o[1],o[2]);else if("string"==typeof o){n.color=new r.Color(1,1,1);var a={mapName:"map"},s=t.gltf.textures[o];a.uri=s.source,a.flipY=!1,n.textureMaps[a.mapName]=a}var l=i.specular;return l&&(n.specular=new r.Color(l[0],l[1],l[2])),i.shininess&&(n.shininess=i.shininess),n.reflectivity=0,n.transparent=!1,n},applyAppearanceHeuristics:function(e,t,n){var i=e.proteinMat?e.proteinMat:null,o=e.prismType&&-1!==e.prismType.indexOf("Prism");o&&e.transparent&&(e.side===r.FrontSide&&"PrismGlazing"!=e.prismType&&(e.side=r.DoubleSide),e.side===r.DoubleSide&&e.depthTest&&(e.twoPassTransparency=!0));var a=e.textureMaps||{};if(!t){var s=e.proteinType&&-1!==e.proteinType.indexOf("Prism");if(e.metal)e.reflectivity||(e.reflectivity=ne(e.specular)),i&&(1===e.reflectivity&&(e.reflectivity=ne(e.specular)),0===e.color.r&&0===e.color.g&&0===e.color.b||(e.color.r*=.1,e.color.g*=.1,e.color.b*=.1));else if(s){var l=!1;if("PrismLayered"===e.proteinType){e.clearcoat=!0,e.reflectivity=.06;var c=e.proteinCategories;c&&c.length&&-1!=c[0].indexOf("Metal")&&(l=!0)}e.reflectivity=Math.sqrt(e.reflectivity),l?e.specular.copy(e.color):(e.specular.r=e.reflectivity,e.specular.g=e.reflectivity,e.specular.b=e.reflectivity)}else e.reflectivity?e.reflectivity>.3?(e.metal=!0,e.specular.r=e.color.r,e.specular.g=e.color.g,e.specular.b=e.color.b,e.color.r*=.1,e.color.g*=.1,e.color.b*=.1):(e.specular.r*=e.reflectivity,e.specular.g*=e.reflectivity,e.specular.b*=e.reflectivity):1!==e.color.r||1!==e.color.g||1!==e.color.b||1!==e.specular.r||1!==e.specular.g||1!==e.specular.b||a.map||a.specularMap?(e.reflectivity=.01+.06*ne(e.specular),e.specular.r*=e.reflectivity,e.specular.g*=e.reflectivity,e.specular.b*=e.reflectivity):(e.metal=!0,e.reflectivity=.7,e.color.r*=.1,e.color.g*=.1,e.color.b*=.1),e.opacity<1&&(e.reflectivity=1);(e.transparent||a.map&&-1!==a.map.uri.toLowerCase().indexOf(".png")||a.alphaMap)&&(e.alphaTest=.01)}if(a.normalMap){var u=e.bumpScale;(void 0===u||u>=1)&&(u=1),e.normalScale=new r.Vector2(u,u)}else void 0===e.bumpScale&&(a.map||a.bumpMap)?e.bumpScale=.03:e.bumpScale>=1&&(e.bumpScale=.03);t&&!o||!e.transparent||(o?(e.lmv_depthWriteTransparent=!0,e.depthWrite=!!n):e.opacity>=1?a.alphaMap||(e.transparency=!1):(e.lmv_depthWriteTransparent=!0,e.depthWrite=!!n)),void 0!==e.shininess&&(e.shininess*=.25)},applyGeometryFlagsToMaterial:function(e,t){if(t.attributes.color&&(e.vertexColors=r.VertexColors,e.needsUpdate=!0),!e.proteinType&&t.attributes.uv&&t.attributes.uv.isPattern){var n=!1;e.map&&!e.bumpMap&&(e.bumpMap=e.map,e.needsUpdate=!0,n=!0),e.textureMaps&&e.textureMaps.map&&!e.textureMaps.bumpMap&&(e.textureMaps.bumpMap=e.textureMaps.map,e.needsUpdate=!0,n=!0),n&&void 0===e.bumpScale&&(e.bumpScale=.03)}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"MeasurementTypes",function(){return i});var i={MEASUREMENT_DISTANCE:1,MEASUREMENT_ANGLE:2,MEASUREMENT_AREA:3,CALIBRATION:4}},function(e,t,n){"use strict";n.r(t),n.d(t,"FileLoaderManager",function(){return r});var i={};var r={registerFileLoader:function(e,t,n){return!i[e]&&(i[e]={loader:n,extensions:t},!0)},getFileLoader:function(e){return i[e]?i[e].loader:null},getFileLoaderForExtension:function(e){for(var t in e=e?e.toLowerCase():"",i){var n=i[t];if(n)for(var r=0;r<n.extensions.length;r++)if(n.extensions[r].toLowerCase()===e)return n.loader}return null},unregisterFileLoader:function(e){return!!i[e]&&(delete i[e],!0)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"token",function(){return f}),n.d(t,"getWebGLHelpLink",function(){return m}),n.d(t,"EnvironmentConfigurations",function(){return x}),n.d(t,"initializeEnvironmentVariable",function(){return w}),n.d(t,"initializeServiceEndPoints",function(){return A}),n.d(t,"refreshCookie",function(){return E}),n.d(t,"refreshRequestHeader",function(){return T}),n.d(t,"refreshToken",function(){return M}),n.d(t,"initializeAuth",function(){return S}),n.d(t,"initializeLogger",function(){return C}),n.d(t,"processMemoryOptions",function(){return L}),n.d(t,"initializeUserInfo",function(){return R}),n.d(t,"Initializer",function(){return D});var i=n(11),r=n(1),o=n(4),a=n(3),s=n(24),l=n(12),c=n(92),u=n(68),h=Object(a.getGlobal)(),d={accessToken:null,getAccessToken:null,tokenRefreshInterval:null},f=d,p=null;function m(){return p}var g={local:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},dev:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},stg:{RTC:["https://rtc-stg.api.autodesk.com:443","https://lmv.autodesk.com:443"]},prod:{RTC:["https://rtc.api.autodesk.com:443","https://lmv.autodesk.com:443"]}},v={local:"",dev:"https://developer-dev.api.autodesk.com",stg:"https://developer-stg.api.autodesk.com",prod:"https://developer.api.autodesk.com"},y="https://otg-dev.autodesk.com",_="https://otg-stg.autodesk.com",b="https://otg.autodesk.com",x={Local:{ROOT:"",LMV:g.local},Development:{ROOT:v.dev,LMV:g.dev,bubbleManifest:!0},Staging:{ROOT:v.stg,LMV:g.stg,bubbleManifest:!0},Production:{ROOT:v.prod,LMV:g.prod,bubbleManifest:!0},AutodeskDevelopment:{ROOT:v.dev,LMV:g.dev},AutodeskStaging:{ROOT:v.stg,LMV:g.stg},AutodeskProduction:{ROOT:v.prod,LMV:g.prod},FluentDev:{ROOT:y,LMV:g.dev},FluentStaging:{ROOT:_,LMV:g.stg},FluentProduction:{ROOT:b,LMV:g.prod}};function w(e){var t;if(e&&e.env&&(t=e.env),t||(t=Object(i.getParameterByName)("env")),e&&e.offlineResourcePrefix&&Object(o.setOfflineResourcePrefix)(e.offlineResourcePrefix),e&&e.offline&&"true"===e.offline&&Object(o.setOffline)(!0),!t)switch(window.location.hostname){case"developer-dev.api.autodesk.com":t="AutodeskDevelopment";break;case"developer-stg.api.autodesk.com":t="AutodeskStaging";break;case"developer.api.autodesk.com":t="AutodeskProduction";break;case"localhost.autodesk.com":case"":case"127.0.0.1":t="Local";break;default:t="AutodeskProduction"}Object(o.setEnv)(t),"undefined"!=typeof window&&r.logger.info("Host name : "+window.location.hostname),r.logger.info("Environment initialized as : "+t)}function A(e){var t=e.endpoint;t||(t=x[Object(o.getEnv)()].ROOT);var n=e.api||t.ENDPOINT_API_DERIVATIVE_SERVICE_V2;if(o.endpoint.setEndpointAndApi(t,n),!Object(a.isNodeJS)()){var r,s,l=["viewer3D.js","viewer3D.min.js"];e&&e.hasOwnProperty("libraryName")&&l.push(e.libraryName);for(var c=!1,u=0;u<l.length;u++){var d=Object(i.getScript)(l[u]),f=(s=d?d.src:"").indexOf(l[u]);if(f>=0){r=s.substr(0,f),(s.indexOf("&v=",f)>0||s.indexOf("?v=",f)>0)&&(c=!0);break}}if(h.LMV_RESOURCE_ROOT=r||h.LMV_RESOURCE_ROOT,c){var p=!1,m=["dev","stg","prod"];for(u=0;u<m.length;++u){var g=v[m[u]];if(-1!==h.LMV_RESOURCE_ROOT.indexOf(g)){p=!0;break}}p&&(h.LMV_RESOURCE_ROOT+=h.LMV_VIEWER_VERSION+"/")}}}function E(e,t,n){t=t||function(){},l.ViewingService.rawGet(o.endpoint.getApiEndpoint(),null,"/auth/settoken",t,n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0,postData:"access-token="+e})}function T(e){o.endpoint.HTTP_REQUEST_HEADERS.Authorization="Bearer "+e}function M(e,t,n){if(d.accessToken=e,d.useCookie){E(e,t,function(t){r.logger.warn("Failed to set token in cookie. Will use header instead."),d.useCookie=!1,T(e),n&&n(t)})}else T(e),t&&t()}function S(e,t){var n,a=t?t.shouldInitializeAuth:void 0;void 0===a&&(a="false"!==Object(i.getParameterByName)("auth").toLowerCase());if("Local"==Object(o.getEnv)()||!a)return setTimeout(e,0),o.endpoint.setUseCredentials(void 0!==t.useCredentials&&t.useCredentials),o.endpoint.getUseCredentials();return o.endpoint.setUseCredentials(void 0===t.useCredentials||t.useCredentials),d.useCookie=t.useCookie,d.tokenRefreshInterval&&(clearTimeout(d.tokenRefreshInterval),d.tokenRefreshInterval=null),t&&t.getAccessToken?(d.getAccessToken=t.getAccessToken,"string"==typeof(n=t.getAccessToken(function i(r,o){n=r,d.tokenRefreshInterval?M(n):M(n,e,e),"number"!=typeof o&&(o=3599);var a=o-5;a<=0&&(a=o),d.tokenRefreshInterval=setTimeout(function(){t.getAccessToken(i)},1e3*a)}))&&n&&M(n,e)):t&&t.accessToken?M(n=t.accessToken,e):((n=Object(i.getParameterByName)("accessToken"))||r.logger.error("No access token is provided, but authorization requested. This is a problem."),M(n,e)),o.endpoint.getUseCredentials()}function C(e){r.logger.initialize(e);var t=Object(i.getParameterByName)("logLevel");t&&r.logger.setLevel(parseInt(t))}function P(e){e&&"Local"===e.env||o.endpoint.getCdnRedirectUrl()&&l.ViewingService.rawGet(o.endpoint.getCdnRedirectUrl(),null,null,function(e){e&&e.length&&(o.endpoint.setCdnUrl(e),r.logger.info("CDN_ROOT is: "+e))},function(){},{withCredentials:!1,responseType:"text"})}function L(e){if(e){var t;if(e.memory)t=0|parseInt(e.memory.limit),(e.memory.debug&&e.memory.debug.force||!1)&&t<=0&&(e.memory.force=!1,r.logger.warn("config.memory.limit value is invalid: ("+e.memory.limit+")"));var n=Object(i.getParameterByName)("viewermemory");if((t=parseInt(n))>=0){var o=(t|=0)>0&&"f"===n.charAt(n.length-1).toLowerCase();e.memory={limit:t,debug:{force:o}},o?r.logger.info("Forcing memory limit to URL param: ("+t+" MegaBytes)."):r.logger.info("Setting memory limit to URL param: ("+t+" MegaBytes).")}else""!==n&&r.logger.warn("Invalid viewermemory URL param value: ("+n+")")}}function R(e){e&&e.userInfo&&Object(c.setUserName)(e.userInfo.name)}function D(e,t){Object(a.isNodeJS)()?(w(e),A(e),C(e),P(e),S(t,e)):(e.webGLHelpLink&&(p=e.webGLHelpLink),w(e),A(e),C(e),P(e),Object(a.disableDocumentTouchSafari)(),Object(i.loadDependency)("Promise","es6-promise.min.js",function(){Object(s.initWorkerScript)(),S(t,e),Object(u.initializeLocalization)(e),R(e)},null,"es6-promise-polyfill"))}},function(e,t,n){"use strict";n.r(t),n.d(t,"PropertyPanel",function(){return a});var i=n(28),r=n(62),o=n(101);function a(e,t,n,a){i.DockingPanel.call(this,e,t,n,a),this.title.classList.add("docking-panel-delimiter-shadow"),this.container.classList.add("property-panel"),this.container.dockRight=!0,this.createScrollContainer({left:!1,heightAdjustment:70,marginTop:0}),this.highlightableElements={};var s=this;var l=function(){var e=new r.TreeDelegate;function t(e){return"category"===e.type}return e.getTreeNodeId=function(e){return e.name+(e.hasOwnProperty("value")?e.value:"")+(e.hasOwnProperty("category")?e.category:"")},e.getTreeNodeClass=function(e){return t(e)?s.getCategoryClass(e):s.getPropertyClass(e)},e.isTreeNodeGroup=function(e){return t(e)},e.onTreeNodeClick=function(e,n,i){t(n)?s.onCategoryClick(n,i):s.onPropertyClick(n,i)},e.onTreeNodeRightClick=function(e,n,i){t(n)?s.onCategoryRightClick(n,i):s.onPropertyRightClick(n,i)},e.onTreeNodeDoubleClick=function(e,n,i){t(n)?s.onCategoryDoubleClick(n,i):s.onPropertyDoubleClick(n,i)},e.onTreeNodeIconClick=function(e,n,i){t(n)?s.onCategoryIconClick(n,i):s.onPropertyIconClick(n,i)},e.createTreeNode=function(e,n,i){var r=null;(r=t(e)?s.displayCategory(e,n,i):s.displayProperty(e,n,i))&&(s.highlightableElements[this.getTreeNodeId(e)]=r)},e}();this.tree=new o.Tree(l,null,this.scrollContainer,{})}a.prototype=Object.create(i.DockingPanel.prototype),a.prototype.constructor=a,a.prototype.setProperties=function(e,t){this.removeAllProperties();for(var n=[],i=[],r=0;r<e.length;r++){if(!(c=e[r]).hidden){var o=e[r].displayCategory;o&&"string"==typeof o&&""!==o?n.push(c):i.push(c)}}if(n.length+i.length!==0){for(r=0;r<n.length;r++){var a=(c=n[r]).precision||Autodesk.Viewing.Private.calculatePrecision(c.displayValue),s=Autodesk.Viewing.Private.formatValueWithUnits(c.displayValue,c.units,c.type,a);this.addProperty(c.displayName,s,c.displayCategory)}var l=n.length>0;for(r=0;r<i.length;r++){var c;a=(c=i[r]).precision||Autodesk.Viewing.Private.calculatePrecision(c.displayValue),s=Autodesk.Viewing.Private.formatValueWithUnits(c.displayValue,c.units,c.type,a);this.addProperty(c.displayName,s,l?"Other":"",l?{localizeCategory:!0}:{})}}else this.showNoProperties()},a.prototype.showNoProperties=function(){this.removeAllProperties();var e=this.tree.myRootContainer,t=document.createElement("div");t.className="no-properties";var n="No properties to display";t.setAttribute("data-i18n",n),t.textContent=Autodesk.Viewing.i18n.translate(n),e.appendChild(t)},a.prototype.showDefaultProperties=function(){this.showNoProperties(),this.resizeToContent()},a.prototype.areDefaultPropertiesShown=function(){return!this.hasProperties()},a.prototype.addProperty=function(e,t,n,i){if(this.tree.getElementForNode({name:e,value:t,category:n}))return!1;var r=null,o={name:e,value:t,type:"property"};return n?((r=this.tree.getElementForNode({name:n}))||(r=this.tree.createElement_({name:n,type:"category"},this.tree.myRootContainer,i&&i.localizeCategory?{localize:!0}:null)),o.category=n):r=this.tree.myRootContainer,this.tree.createElement_(o,r,i&&i.localizeProperty?{localize:!0}:null),!0},a.prototype.hasProperties=function(){for(var e in this.highlightableElements)return!0;return!1},a.prototype.removeProperty=function(e,t,n,i){var r={name:e,value:t,category:n},o=this.tree.getElementForNode(r);return!!o&&(delete this.highlightableElements[this.tree.delegate().getTreeNodeId(r)],o.parentNode.removeChild(o),!0)},a.prototype.removeAllProperties=function(){this.highlightableElements={},this.tree.clear()},a.prototype.setCategoryCollapsed=function(e,t){var n=this.tree.delegate().getTreeNodeId(e);this.tree.setCollapsed(n,t)},a.prototype.isCategoryCollapsed=function(e){var t=this.tree.delegate().getTreeNodeId(e);return this.tree.isCollapsed(t)},a.prototype.getContentSize=function(){var e=this.tree.myRootContainer;return{height:e.clientHeight+55,width:e.clientWidth}},a.prototype.highlight=function(e,t){function n(t){var n=t.innerHTML,i=n.replace(/(<highlight>|<\/highlight>)/gim,"");if(n!==i&&(t.innerHTML=i),e&&""!==e){var r=new RegExp("(\\b"+e+"\\b)","gim"),o=i.replace(r,"<highlight>$1</highlight>");t.innerHTML=o}}for(var i in this.highlightableElements)for(var r=this.highlightableElements[i],o=0;o<r.length;++o)n(r[o])},a.prototype.displayCategory=function(e,t,n){var i=document.createElement("div"),r=e.name;return n&&n.localize&&(i.setAttribute("data-i18n",r),r=Autodesk.Viewing.i18n.translate(r)),i.textContent=r,i.title=r,i.className="category-name",t.appendChild(i),[i]},a.prototype.displayProperty=function(e,t,n){var i=document.createElement("div"),r=e.name;n&&n.localize&&(i.setAttribute("data-i18n",r),r=Autodesk.Viewing.i18n.translate(r)),i.textContent=r,i.title=r,i.className="property-name";var o=document.createElement("div");o.className="separator";var a=document.createElement("div");a.textContent=e.value;var s=e.value;return a.title=s,s=function(e){e=String(e);var t=' target="blank" class="propertyLink" ';return[{pattern:/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,value:"<a"+t+'href="$&">$&</a>'},{pattern:/(^|[^\/])(www\.[\S]+(\b|$))/gim,value:"$1<a"+t+'href="http://$2">$2</a>'}].reduce(function(e,t){return e.replace(t.pattern,t.value)},e)}(s),a.innerHTML=s,a.className="property-value",t.appendChild(i),t.appendChild(o),t.appendChild(a),[i,a]},a.prototype.getCategoryClass=function(e){return"category"},a.prototype.getPropertyClass=function(e){return"property"},a.prototype.onCategoryClick=function(e,t){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},a.prototype.onPropertyClick=function(e,t){},a.prototype.onCategoryIconClick=function(e,t){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},a.prototype.onPropertyIconClick=function(e,t){},a.prototype.onCategoryDoubleClick=function(e,t){},a.prototype.onPropertyDoubleClick=function(e,t){},a.prototype.onCategoryRightClick=function(e,t){},a.prototype.onPropertyRightClick=function(e,t){}},function(e,t,n){"use strict";function i(e,t,n){this.level=e,this.x=t,this.y=n}function r(e){var t=((1<<2*e.level)-1)/3,n=1<<e.level;return t+e.y*n+e.x}function o(e){for(var t=new i(0,0,0);r(t)<=e;)t.level++;t.level--;var n=e-r(t),o=1<<t.level;return t.y=Math.floor(n/o),t.x=n%o,t}n.r(t),n.d(t,"TileCoords",function(){return i}),n.d(t,"tile2Index",function(){return r}),n.d(t,"index2Tile",function(){return o}),i.prototype={constructor:i,copy:function(){return new i(this.level,this.x,this.y)},isValid:function(){return Number.isInteger(this.level)&&this.level>=0&&Number.isInteger(this.x)&&Number.isInteger(this.y)},getChild:function(e){var t=1&e?1:0,n=2&e?1:0;return new i(this.level+1,2*this.x+t,2*this.y+n)},getParent:function(){return 0==this.level?null:new i(this.level-1,Math.floor(this.x/2),Math.floor(this.y/2))},getParentAtLevel:function(e){if(e<0||e>this.level)return null;var t=this.level-e;return new i(e,Math.floor(this.x>>t),Math.floor(this.y>>t))},toString:function(){return"("+this.level+", "+this.x+", "+this.y+")"},equals:function(e,t,n){return e instanceof i?this.equals(e.level,e.x,e.y):this.level===e&&this.x===t&&this.y===n}}},function(e,t,n){"use strict";n.r(t),n.d(t,"createBufferGeometry",function(){return p}),n.d(t,"meshToGeometry",function(){return m}),n.d(t,"BufferGeometryUtils",function(){return g});var i=n(14),r=n(3),o=n(0),a=n(1),s={};function l(e,t,n){var i;if(t.array)i=new o.BufferAttribute(t.array,t.itemSize);else{var r=e+"|"+t.bytesPerItem+"|"+t.normalize+"|"+t.isPattern+"|"+t.divisor+"|"+t.offset;if(i=s[r])return i;i=new o.BufferAttribute(void 0,t.itemSize),s[r]=i}return i.bytesPerItem=t.bytesPerItem,i.normalize=t.normalize,i.isPattern=t.isPattern,n&&(i.divisor=t.divisor),t.array||(t.hasOwnProperty("offset")?i.itemOffset=t.offset:a.logger.warn("VB attribute is neither interleaved nor separate. Something is wrong with the buffer specificaiton.")),i}var c,u,h,d={};var f=1;function p(){return h||((c=new o.BufferAttribute(void 0,1)).bytesPerItem=2,(u=new o.BufferAttribute(void 0,1)).bytesPerItem=4,(h=function(){this.id=f++,this.attributes={},this.__webglInit=void 0}).prototype=Object.create(o.BufferGeometry.prototype),h.prototype.constructor=h),new h}function m(e){var t=e.mesh,n=p();for(var a in Object(r.isNodeJS)()&&(n.packId=e.packId,n.meshIndex=e.meshIndex),n.byteSize=0,n.vb=t.vb,n.vbbuffer=void 0,n.vbNeedsUpdate=!0,n.byteSize+=t.vb.byteLength,n.hash=e.hash,n.vbstride=t.vbstride,t.isLines&&(n.isLines=t.isLines),t.isWideLines&&(n.isWideLines=!0,n.lineWidth=t.lineWidth),t.isPoints&&(n.isPoints=t.isPoints,n.pointSize=t.pointSize),e.is2d&&(n.is2d=!0),n.numInstances=t.numInstances,t.vblayout){var s=t.vblayout[a];n.attributes[a]=l(a,s,n.numInstances)}if(i.memoryOptimizedLoading)n.attributes.index=t.indices instanceof Uint32Array?u:c,n.ib=t.indices,n.ibbuffer=void 0,t.iblines&&(n.attributes.indexlines=t.iblines instanceof Uint32Array?u:c,n.iblines=t.iblines,n.iblinesbuffer=void 0);else{var h=new o.BufferAttribute(t.indices,1);h.bytesPerItem=t.indices instanceof Uint32Array?4:2,n.addAttribute("index",h)}n.attributesKeys=function(e){var t="";for(var n in e.attributes)t+=n+"|";var i=d[t];return i||(i=Object.keys(e.attributes),d[t]=i,i)}(n),n.byteSize+=t.indices.byteLength,n.boundingBox=(new o.Box3).copy(t.boundingBox),n.boundingSphere=(new o.Sphere).copy(t.boundingSphere),e.geometry=n,e.mesh=null}var g={meshToGeometry:m,createBufferGeometry:p}},function(e,t,n){"use strict";n.r(t),n.d(t,"ModelUnits",function(){return l}),n.d(t,"Model",function(){return c});var i=n(108),r=(n(166),n(32)),o=n(12),a=(n(1),n(17)),s=n(3),l={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in",POINT:"pt"};function c(e){i.RenderModel.call(this,e),this.myData=e,this.topology=null,this.topologyPromise=null,this.svfUUID=null,this.defaultCameraHash=null,this.getInstanceTree=function(){return this.myData?this.myData.instanceTree:null},this.getFragmentMap=function(){return this.myData?this.myData.instanceTree||this.myData.fragmentMap:null},this.getBoundingBox=function(){return this.myData?this.myData.bbox:null},this.is2d=function(){return!(!this.myData||!this.myData.is2d)},this.is3d=function(){return!this.is2d()},this.isOTG=function(){return this.myData&&!!this.myData.isOTG}}r.EventDispatcher.prototype.apply(c.prototype),c.prototype.constructor=c,c.prototype.getData=function(){return this.myData},c.prototype.setUUID=function(e){this.svfUUID=btoa(Object(o.pathToURL)(e))},c.prototype.getDocumentNode=function(){var e=this.getData();return e.loadOptions&&e.loadOptions.bubbleNode||null},c.prototype.getRoot=function(){var e=this.getData();return e&&e.instanceTree?e.instanceTree.root:null},c.prototype.getRootId=function(){var e=this.getData();if(e){if(e.instanceTree)return e.instanceTree.getRootId();if(e.fragmentMap)return e.fragmentMap.getRootId()}return 0},c.prototype.getUnitData=function(e){var t={unitString:null,unitScale:1};switch(e){case"meter":case"meters":case"m":return t.unitString=l.METER,t.unitScale=1,t;case"foot":case"feet":case"ft":return t.unitString=l.FOOT,t.unitScale=.3048,t;case"feet and inches":case"inch":case"inches":case"in":return t.unitString=l.INCH,t.unitScale=.0254,t;case"centimeter":case"centimeters":case"cm":return t.unitString=l.CENTIMETER,t.unitScale=.01,t;case"millimeter":case"millimeters":case"mm":return t.unitString=l.MILLIMETER,t.unitScale=.001,t;case"point":case"points":case"pt":return t.unitString=l.POINT,t.unitScale=.0254/72,t;default:return t}},c.prototype.getUnitScale=function(){var e;if(this.is2d())e=this.getMetadata("page_dimensions","page_units",null);else{var t=this.getData();e=t&&t.overriddenUnits?t.overriddenUnits:t&&t.scalingUnit?t.scalingUnit:this.getMetadata("distance units","value",null)}return e&&(e=e.toLowerCase()),this.getUnitData(e).unitScale},c.prototype.getUnitString=function(){var e;if(this.is2d())e=this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null);else{var t=this.getData();e=t&&t.overriddenUnits?t.overriddenUnits:t&&t.scalingUnit?t.scalingUnit:this.getMetadata("distance units","value",null)}return e&&(e=e.toLowerCase()),this.getUnitData(e).unitString},c.prototype.getDisplayUnit=function(){var e;if(this.is2d())e=this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null);else{var t=this.getData();e=t&&t.scalingUnit?t.scalingUnit:this.getMetadata("distance units","value",null)}return e&&(e=e.toLowerCase()),this.getUnitData(e).unitString},c.prototype.getMetadata=function(e,t,n){var i=this.getData();if(i){var r=i.metadata;if(r){var o=r[e];if(void 0!==o){if(!t)return o;var a=o[t];if(void 0!==a)return a}}}return n},c.prototype.getDefaultCamera=function(){var e=this.getData();if(!e)return null;var t=null,n=e.cameras?e.cameras.length:0;if(0<n){var i=this.getMetadata("default camera","index",null);if(null!==i&&e.cameras[i])t=e.cameras[i];else{for(var r=0;r<n;r++){var o=e.cameras[r];if(o.isPerspective){t=o;break}}t||(t=e.cameras[0])}}return t},c.prototype.isAEC=function(){return!!this.getData().loadOptions.isAEC},c.prototype.getUpVector=function(){return this.getMetadata("world up vector","XYZ",null)},c.prototype.geomPolyCount=function(){var e=this.getGeometryList();return e?e.geomPolyCount:null},c.prototype.instancePolyCount=function(){var e=this.getGeometryList();return e?e.instancePolyCount:null},c.prototype.isLoadDone=function(){var e=this.getData();return!(!e||!e.loadDone)},c.prototype.isObjectTreeCreated=function(){return!!this.getData().instanceTree},c.prototype.getPropertyDb=function(){var e=this.getData();return e&&e.propDbLoader},c.prototype.getProperties=function(e,t,n){var i=this.getPropertyDb();!i||e<=0?n&&n():i.getProperties(e,t,n)},c.prototype.getBulkProperties=function(e,t,n,i){Array.isArray(t)&&(t={propFilter:t});var r=(t=t||{}).propFilter||null,o=t.ignoreHidden||!1,a=this.getPropertyDb();a?a.getBulkProperties(e,r,n,i,o):i&&i()},c.prototype.getExternalIdMapping=function(e,t){var n=this.getPropertyDb();n?n.getExternalIdMapping(e,t):t&&t()},c.prototype.getLayerToNodeIdMapping=function(e,t){var n=this.getPropertyDb();n?n.getLayerToNodeIdMapping(e,t):t&&t()},c.prototype.getObjectTree=function(e,t){var n=this.getPropertyDb();n?n.getObjectTree(e,t):t&&t()},c.prototype.isObjectTreeLoaded=function(){var e=this.getPropertyDb();return!!e&&e.isObjectTreeLoaded()},c.prototype.search=function(e,t,n,i){var r=this.getPropertyDb();r?r.searchProperties(e,i,t,n):n&&n()},c.prototype.findProperty=function(e){var t=this.getPropertyDb();return t?t.findProperty(e):Promise.reject("Model doesn't have any properties.")};var u=function(e,t,n,i){var r,o,a,s,l,c,u=!1;a=i[n[n.length-1]].x,r=(s=i[n[n.length-1]].y)>=t;for(var h=0,d=n.length;h<d;++h)l=i[n[h]].x,r!=(o=(c=i[n[h]].y)>=t)&&(c-t)*(a-l)>=(l-e)*(s-c)==o&&(u=!u),r=o,a=l,s=c;return u};c.prototype.pointInPolygon=function(e,t,n,i){for(var r=!1,o=0;o<n.length;o++)u(e,t,n[o],i)&&(r=!r);return r},c.prototype.getPageToModelTransform=function(e){var t=this.getData();if(t.pageToModelTransform)return t.pageToModelTransform;var n=t,i=n.metadata.page_dimensions,r=n.viewports[e];if(!r)return new THREE.Matrix4;n.viewportTransforms||(n.viewportTransforms=new Array(n.viewports.length));var o=n.viewportTransforms[e];if(o)return o;var s=new a.LmvMatrix4(!0).set(i.logical_width/i.page_width,0,0,i.logical_offset_x,0,i.logical_height/i.page_height,0,i.logical_offset_y,0,0,1,0,0,0,0,1),l=r.transform.slice();!function(e){var t=e;if(Math.abs(t[0])<.001)if(Math.abs(t[4])>.001)for(var n=0;n<4;n++){var i=t[n];t[n]=t[n+4],t[n+4]=i}else for(n=0;n<4;n++)i=t[n],t[n]=t[n+8],t[n+8]=i;if(Math.abs(t[5])<.001)for(n=4;n<8;n++)i=t[n],t[n]=t[n+4],t[n+4]=i}(l);var c=new a.LmvMatrix4(!0);c.elements.set(l);var u=new a.LmvMatrix4(!0);return u.getInverse(c),u.multiply(s),n.viewportTransforms[e]=u,u},c.prototype.pageToModel=function(e,t,n){var i=this.getPageToModelTransform(n);function r(e){if(e){var t=(new THREE.Vector3).set(e.x,e.y,0).applyMatrix4(i);e.x=t.x,e.y=t.y}}r(e),r(t)},c.prototype.pointInClip=function(e,t){for(var n=this.getData().clips,i=[],r=1;r<n.length;r++)if(r!==t){for(var o=[],a=[],s=n[r].contourCounts,l=n[r].points,c=0,u=[],h=0;h<s.length;h++){for(var d=0;d<s[h];d++)o.push(c),c++;a.push(o),o=[]}for(h=0;h<l.length;h+=2){var f={x:l[h],y:l[h+1]};u.push(f)}this.pointInPolygon(e.x,e.y,a,u)&&i.push(r)}return i},c.prototype.getClip=function(e){for(var t=this.getData().clips,n=[],i=[],r=t[e].contourCounts,o=t[e].points,a=0,s=[],l=0;l<r.length;l++){for(var c=0;c<r[l];c++)n.push(a),a++;i.push(n),n=[]}for(l=0;l<o.length;l+=2){var u={x:o[l],y:o[l+1]};s.push(u)}return{contours:i,points:s}},c.prototype.getTopoIndex=function(e){var t=this.getData();if(t&&t.fragments){var n=t.fragments.topoIndexes;if(n)return n[e]}},c.prototype.getTopology=function(e){return this.topology?this.topology[e]:null},c.prototype.hasTopology=function(){return!!this.topology},c.prototype.fetchTopology=function(e){if(this.topology)return Promise.resolve(this.topology);var t=this.getData();if(!t.topologyPath)return Promise.reject({error:"no-topology"});var n=e||(Object(s.isMobileDevice)()?20:100);if(t.topologySizeMB>n)return Promise.reject({error:"topology-too-big",limitMB:n,topologyMB:t.topologySizeMB});if(!this.topologyPromise){var i=this;this.topologyPromise=new Promise(function(e,t){i.loader.fetchTopologyFile(i.getData().topologyPath,function(n){n&&n.topology?(i.topology=n.topology,e(n.topology)):t(n)})})}return this.topologyPromise},c.prototype.hasGeometry=function(){var e=this.getData();return!!e&&(!!e.isLeaflet||e.fragments.length>0)}},function(e,t,n){"use strict";n.r(t),n.d(t,"ScreenMode",function(){return c}),n.d(t,"ScreenModeDelegate",function(){return u}),n.d(t,"AppScreenModeDelegate",function(){return h}),n.d(t,"ApplicationScreenModeDelegate",function(){return d}),n.d(t,"NullScreenModeDelegate",function(){return f}),n.d(t,"ScreenModeMixin",function(){return p});var i=n(3),r=n(2),o=n(1),a=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"];function s(e){for(var t=0;t<a.length;++t)document.addEventListener(a[t],e,!1)}function l(e){for(var t=0;t<a.length;++t)document.removeEventListener(a[t],e,!1)}var c={kNormal:0,kFullBrowser:1,kFullScreen:2};function u(e){this.viewer=e,this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this),this.getMode()===c.kFullScreen&&s(this.bindFullscreenEventListener)}function h(e){u.call(this,e)}u.prototype.uninitialize=function(){l(this.bindFullscreenEventListener),this.viewer=null},u.prototype.isModeSupported=function(e){return!0},u.prototype.setMode=function(e){var t=this.getMode();return!(e===t||!this.isModeSupported(e))&&(this.doScreenModeChange(t,e),this.onScreenModeChanged(t,e),!0)},u.prototype.getMode=function(){throw"Implement getMode() in derived class"},u.prototype.getNextMode=function(){var e,t=this.getMode(),n=c;return t===n.kNormal&&this.isModeSupported(n.kFullBrowser)?e=n.kFullBrowser:t===n.kNormal&&this.isModeSupported(n.kFullScreen)?e=n.kFullScreen:t===n.kFullBrowser&&this.isModeSupported(n.kFullScreen)?e=n.kFullScreen:t===n.kFullBrowser&&this.isModeSupported(n.kNormal)?e=n.kNormal:t===n.kFullScreen&&this.isModeSupported(n.kNormal)?e=n.kNormal:t===n.kFullScreen&&this.isModeSupported(n.kFullBrowser)&&(e=n.kFullBrowser),e},u.prototype.getEscapeMode=function(){return this.getMode()!==c.kNormal?c.kNormal:void 0},u.prototype.fullscreenEventListener=function(){Object(i.inFullscreen)()?this.viewer.resize():(this.doScreenModeChange(c.kFullScreen,c.kNormal),this.onScreenModeChanged(c.kFullScreen,c.kNormal))},u.prototype.doScreenModeChange=function(e,t){throw"Implement doScreenModeChange() in derived class"},u.prototype.onScreenModeChanged=function(e,t){e===c.kFullScreen?l(this.bindFullscreenEventListener):t===c.kFullScreen&&s(this.bindFullscreenEventListener),this.viewer.resize(),this.viewer.dispatchEvent({type:r.FULLSCREEN_MODE_EVENT,mode:t})},h.prototype=Object.create(u.prototype),h.prototype.constructor=h,h.prototype.isModeSupported=function(e){return e!==c.kFullBrowser},h.prototype.getMode=function(){return Object(i.inFullscreen)()?c.kFullScreen:c.kNormal},h.prototype.doScreenModeChange=function(e,t){var n=this.viewer.container;t===c.kNormal?(n.classList.remove("viewer-fill-browser"),Object(i.exitFullscreen)()):t===c.kFullScreen&&(n.classList.add("viewer-fill-browser"),Object(i.launchFullscreen)(n))};var d=h;function f(e){u.call(this,e)}function p(){}f.prototype=Object.create(u.prototype),f.prototype.constructor=u,f.prototype.isModeSupported=function(e){return!1},f.prototype.getMode=function(){return c.kNormal},p.prototype={setScreenModeDelegate:function(e){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.screenModeDelegateClass=e||(null===e?f:h)},getScreenModeDelegate:function(){return this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this)),this.screenModeDelegate},isScreenModeSupported:function(e){return this.getScreenModeDelegate().isModeSupported(e)},canChangeScreenMode:function(){return this.isScreenModeSupported(Autodesk.Viewing.ScreenMode.kNormal)},setScreenMode:function(e){var t={category:"screen_mode",value:e};return o.logger.track(t),this.getScreenModeDelegate().setMode(e)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var e=this.getScreenModeDelegate().getNextMode();return void 0!==e&&this.setScreenMode(e)},escapeScreenMode:function(){var e=this.getScreenModeDelegate().getEscapeMode();return void 0!==e&&this.setScreenMode(e)},apply:function(e){var t=p.prototype;e.setScreenModeDelegate=t.setScreenModeDelegate,e.getScreenModeDelegate=t.getScreenModeDelegate,e.isScreenModeSupported=t.isScreenModeSupported,e.canChangeScreenMode=t.canChangeScreenMode,e.setScreenMode=t.setScreenMode,e.getScreenMode=t.getScreenMode,e.nextScreenMode=t.nextScreenMode,e.escapeScreenMode=t.escapeScreenMode}}},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(40),o=n(51),a=n(96),s=n(24),l=n(17),c=n(10);function u(e,t,n,i){var o=function(e){for(var t=new Uint16Array(e.length+1),n=0,i=0;i<e.length;i++)t[i]=n,n+=Object(r.getVertexCount)(e[i]);return t[i]=n,t}(e),s=new a.GeomMergeTask;return s.vb=t.vb,s.vbstride=t.vbstride,s.posOffset=t.attributes.position.itemOffset,s.normalOffset=t.attributes.normal?t.attributes.normal.itemOffset:-1,s.matrices=n,s.ranges=o,s.dbIds=i,s}function h(e,t){t.vb=e.vb,t.attributes.id.array=e.vertexIds,t.needsUpdate=!0}function d(e){var t=0,n={},i=[],r=e,o=new Array(2);function a(e){for(var i=e.data,a=0;a<i.length;a++){var s=i[a],l=s.taskId;h(s,n[l]),delete n[l]}if(0===--t)for(r.inProgress=!1,a=0;a<o.length;a++)o[a].clearAllEventListenerWithIntercept(),o[a].terminate(),o[a]=null}this.addMergeTask=function(e,t,r,o){var a=u(e,t,r,o);i.push(a),n[a.id]=t},this.runTasks=function(){for(var e=0;e<2;e++)o[e]=d.createWorker(),o[e].addEventListenerWithIntercept(a);for(var n=i.length,s=Math.floor(n/2),l=0;l<2;l++){var c=l*s,u=1===l?n:c+s,h=[],f=new Array(4*(u-c)),p=0;for(e=c;e<u;e++){var m=i[e];f[p++]=m.vb.buffer,f[p++]=m.matrices.buffer,f[p++]=m.ranges.buffer,f[p++]=m.dbIds.buffer,h.push(m)}var g={operation:"MERGE_GEOMETRY",tasks:h};o[l].doOperation(g,f),t++}r.inProgress=!0}}d.createWorker=s.createWorkerWithIntercept;var f=n(1),p=n(72);n.d(t,"copyVertexFormat",function(){return _}),n.d(t,"copyPrimitiveProps",function(){return b}),n.d(t,"mergeGeometries",function(){return x}),n.d(t,"Consolidation",function(){return A}),n.d(t,"ConsolidationBuilder",function(){return E});var m={UNKNOWN:0,TRIANGLES:1,LINES:2,WIDE_LINES:3,POINTS:4};function g(e){return e.isLines?m.LINES:e.isPoints?m.POINTS:e.isWideLines?m.WIDE_LINES:m.TRIANGLES}function v(e,t){switch(!0===e.isLines&&(e.isLines=void 0),!0===e.isWideLines&&(e.isWideLines=void 0),!0===e.isPoints&&(e.isPoints=void 0),t){case m.LINES:e.isLines=!0;break;case m.WIDE_LINES:e.isWideLines=!0;break;case m.POINTS:e.isPoints=!0}}function y(e){this.geoms=[],this.matrices=[],this.vertexCount=0,this.material=e,this.fragIds=[],this.worldBox=new i.Box3}function _(e,t){for(var n in e.vb&&e.vbstride||f.logger.warn("copyVertexFormat() supports only interleaved buffers"),e.attributes)t.attributes[n]=e.attributes[n];t.attributesKeys=e.attributesKeys.slice(0),t.vbstride=e.vbstride}function b(e,t){v(t,g(e)),t.lineWidth=e.lineWidth,t.pointSize=e.pointSize}function x(e,t,n,a,s){var d=function(e){for(var t=e[0].vbstride,n=0,a=0,s=0,l=0;l<e.length;l++){var c=e[l];n+=e[l].ib.length,a+=Object(r.getVertexCount)(c),e[l].iblines&&(s+=e[l].iblines.length)}var u=Object(o.createBufferGeometry)();u.vb=new Float32Array(a*t),u.ib=new Uint16Array(n),s&&(u.iblines=new Uint16Array(s)),u.byteSize=u.vb.byteLength+u.ib.byteLength,u.iblines&&(u.byteSize+=u.iblines.byteLength),b(e[0],u),_(e[0],u);var h=new i.BufferAttribute(null,3);h.normalize=!0,h.bytesPerItem=1,u.addAttribute("id",h);var d=e[0];return v(u,g(d)),d.isPoints&&(u=d.pointSize),d.isWideLines&&(u=d.lineWidth),u}(e);return d.boundingBox=a.clone(),function(e,t){for(var n=0,i=0,o=0,a=0,s=0;s<e.length;s++){for(var l=e[s],c=Object(r.getVertexCount)(l),u=0;u<l.ib.length;u++)t.ib[o+u]=l.ib[u]+i;if(l.iblines){for(u=0;u<l.iblines.length;u++)t.iblines[a+u]=l.iblines[u]+i;a+=l.iblines.length}t.vb.set(l.vb,n),n+=l.vb.length,i+=c,o+=l.ib.length}}(e,d),s?s.addMergeTask(e,d,t,n):function(e,t,n,i){var r=u(e,t,n,i),o=new c.LmvVector3,a=new l.LmvMatrix4;h(r.run(a,o),t)}(e,d,t,n),d}function w(e,t){if(e.vbstride!=t.vbstride)return!1;if(g(e)!==g(t))return!1;if(e.isPoints&&e.pointSize!==t.pointSize)return!1;if(e.isWideLines&&e.lineWidth!==t.lineWidth)return!1;if(e.attributesKeys.length!=t.attributesKeys.length)return!1;for(var n=0,i=e.attributesKeys.length;n<i;n++){var r=e.attributesKeys[n],o=e.attributes[r],a=t.attributes[r];if(!a)return!1;if(o!==a&&(o.itemOffset!==a.itemOffset||o.normalize!==a.normalize||o.itemSize!==a.itemSize||o.bytesPerItem!==a.bytesPerItem||o.isPattern!==a.isPattern))return!1}return!0}function A(e){this.meshes=[],this.fragId2MeshIndex=new Int32Array(e);for(var t=0;t<this.fragId2MeshIndex.length;t++)this.fragId2MeshIndex[t]=-1;this.byteSize=0,this.consolidationMap=null}function E(){this.buckets={},this.bucketCount=0,this.costs=0}function T(e,t){this.fragOrder=new Uint32Array(e),this.ranges=new Uint32Array(t),this.boxes=new Array(t),this.numConsolidated=-1}y.prototype={constructor:y,addGeom:function(e,t,n){this.geoms.push(e),this.fragIds.push(n),this.worldBox.union(t),this.vertexCount+=Object(r.getVertexCount)(e);var i=this.geoms.length;return 1==i?0:(void 0===e.byteSize&&f.logger.warn("Error in consolidation: Geometry must contain byteSize."),e.byteSize+(2==i?this.geoms[0].byteSize:0))}},A.prototype={constructor:A,addContainerMesh:function(e,t,n,r,o){var a=new i.Mesh(e,t);this.meshes.push(a),this.byteSize+=e.byteSize;var s=r||0,l=s+(o||n.length);a.frustumCulled=!1;for(var c=this.meshes.length-1,u=s;u<l;u++){var h=n[u];this.fragId2MeshIndex[h]=c}},addSingleMesh:function(e,t,n,r,o){var a=new i.Mesh(e,t);a.matrix.copy(r),a.matrixAutoUpdate=!1,a.dbId=o,a.fragId=n,this.meshes.push(a),a.frustumCulled=!1,this.fragId2MeshIndex[n]=this.meshes.length-1},addSingleFragment:function(e,t){var n=e.getVizmesh(t);this.addSingleMesh(n.geometry,n.material,t,n.matrixWorld,n.dbId)}},E.prototype={addGeom:function(e,t,n,i){var o=null,a=this.buckets[t.id];if(a)for(var s=0;s<a.length;s++){var l=a[s];if(w(l.geoms[0],e))if(!(Object(r.getVertexCount)(e)+l.vertexCount>65535)){o=l;break}}o||(o=new y(t),this.bucketCount++,this.buckets[t.id]?this.buckets[t.id].push(o):this.buckets[t.id]=[o]),this.costs+=o.addGeom(e,n,i)},createConsolidationMap:function(e,t){var n=new T(e.length,this.bucketCount),i=0,r=0;for(var o in this.buckets)for(var a=this.buckets[o],s=0;s<a.length;s++){var l=a[s];n.ranges[r]=i,n.boxes[r]=l.worldBox,n.fragOrder.set(l.fragIds,i),i+=l.fragIds.length,r++}n.numConsolidated=t;for(var c=t;c<e.length;c++)n.fragOrder[c]=e[c];return n}},T.prototype={buildConsolidation:function(e,t,n){var r=this.fragOrder,o=e.getCount(),a=this.ranges.length,s=new A(o),l=null;d.createWorker&&(l=new d(s));for(var c=[],u=new i.Matrix4,h=0;h<a;h++){var f=this.ranges[h],m=(h===a-1?this.numConsolidated:this.ranges[h+1])-f;if(1===m){var g=r[f];s.addSingleFragment(e,g,s)}c.length=m;for(var v=new Float32Array(16*m),y=new Uint32Array(m),_=0;_<m;_++)g=r[f+_],c[_]=e.getGeometry(g),e.getOriginalWorldMatrix(g,u),v.set(u.elements,16*_),y[_]=e.getDbIds(g);var b=this.boxes[h],w=r[f],E=e.getMaterial(w),T=x(c,v,y,b,l),M=t.getMaterialVariant(E,p.MATERIAL_VARIANT.VERTEX_IDS,n);s.addContainerMesh(T,M,r,f,m)}return l&&l.runTasks(),s.consolidationMap=this,s}},A.applyBVHDefaults=function(e){e.frags_per_leaf_node=512,e.max_polys_per_node=1e5},A.getDefaultBVHOptions=function(){var e={};return A.applyBVHDefaults(e),e}},function(e,t,n){"use strict";n.r(t),n.d(t,"RadioButtonGroup",function(){return a});var i=n(35),r=n(8),o=n(19);function a(e,t){i.ControlGroup.call(this,e,t);var n=this;this._activeButton=null,this._handleButtonStateChange=function(e){var t=r.Button.State;e.state===t.ACTIVE?(n._activeButton=e.target,n.dispatchEvent({type:a.Event.ACTIVE_BUTTON_CHANGED,button:e.target,isActiveButton:!0}),n._controls.forEach(function(n){n!==e.target&&n.getState()!==t.DISABLED&&n.setState(t.INACTIVE)})):e.target===n._activeButton&&(n._activeButton=null,n.dispatchEvent({type:a.Event.ACTIVE_BUTTON_CHANGED,button:e.target,isActiveButton:!1}))}}a.Event={ACTIVE_BUTTON_CHANGED:"RadioButtonGroup.ActiveButtonChanged",VISIBILITY_CHANGED:o.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:o.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:i.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:i.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:i.ControlGroup.Event.SIZE_CHANGED},a.prototype=Object.create(i.ControlGroup.prototype),a.prototype.constructor=a,a.prototype.addControl=function(e,t){return e instanceof r.Button&&(!!i.ControlGroup.prototype.addControl.call(this,e,t)&&(e.addEventListener(r.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0))},a.prototype.removeControl=function(e){var t="string"==typeof e?this.getControl(e):e;return!(null===t||!i.ControlGroup.prototype.removeControl.call(this,t))&&(t.removeEventListener(r.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0)},a.prototype.getActiveButton=function(){return this._activeButton}},function(e,t,n){"use strict";n.r(t),n.d(t,"SettingsPanel",function(){return l});var i=n(28),r=n(9),o=n(3),a=n(16);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t,n,r){i.DockingPanel.call(this,e,t,n,r),this.panelTabs=[],this.tabIdToIndex={},this.controls={},this.controlIdCount=0,this.shown=!1;var o=this,a=r&&void 0!==r.width?r.width:340;this.container.style.maxWidth="800px",this.container.style.minWidth=a+"px",this.container.style.top="10px",this.container.style.left=e.offsetWidth/2-170+"px",this.container.style.position="absolute",this.tabContainer=document.createElement("div"),this.tabContainer.classList.add("docking-panel-container-solid-color-b"),this.tabContainer.classList.add("settings-tabs"),this.tabContainer.classList.add("docking-panel-delimiter-shadow"),this.container.appendChild(this.tabContainer),this.tabs=document.createElement("ul"),this.tabContainer.appendChild(this.tabs),this.heightAdjustment=r&&r.heightAdjustment?r.heightAdjustment:179,this.createScrollContainer({left:!1,heightAdjustment:this.heightAdjustment,marginTop:0}),this.tablesContainer=document.createElement("div"),this.tablesContainer.classList.add("settings-tabs-tables-container"),this.scrollContainer.appendChild(this.tablesContainer),this.mouseOver=!1,this.addEventListener(this.container,"mouseover",function(e){var t=e.toElement||e.relatedTarget;if(o.mouseOver)return!0;for(var n=0;t&&t.parentNode&&t.parentNode!=window;){if(t.parentNode==this||t==this){t.preventDefault&&t.preventDefault(),o.mouseOver=!0;for(n=0;n<o.panelTabs.length;n++)o.panelTabs[n].classList.remove("selectedmouseout");return!0}t=t.parentNode}}),this.addEventListener(this.container,"mouseout",function(e){var t=e.toElement||e.relatedTarget;if(o.mouseOver){for(;t&&t.parentNode&&t.parentNode!=window;){if(t.parentNode==this||t==this)return t.preventDefault&&t.preventDefault(),!1;t=t.parentNode}o.mouseOver=!1;for(var n=0;n<o.panelTabs.length;n++)o.panelTabs[n].classList.contains("tabselected")&&o.panelTabs[n].classList.add("selectedmouseout")}}),this.expandID=function(e){return t+"-"+e}}l.prototype=Object.create(i.DockingPanel.prototype),l.prototype.constructor=l,l.prototype.setVisible=function(e){e&&(this.container.style.display="block",this.shown||this.resizeToContent(),this.shown=!0),i.DockingPanel.prototype.setVisible.call(this,e)},l.prototype.addTab=function(e,t,n){var i=this;if(void 0!==this.tabIdToIndex[e])return!1;var a=n&&void 0!==n.className?n.className:null,s=n&&void 0!==n.width?n.width:200,l=n&&void 0!==n.index?n.index:this.panelTabs.length;var c=document.createElement("li");c._id=e,c.id=this.expandID(c._id),c.classList.add(a);var u=document.createElement("a"),h=document.createElement("span");h.setAttribute("data-i18n",t),h.textContent=r.i18n.translate(t),u.appendChild(h),c.appendChild(u),this.tabs.appendChild(c);var d=document.createElement("table");d._id=e+"-table",d.id=this.expandID(d._id),d.classList.add("settings-table"),d.classList.add("adsk-lmv-tftable"),d.classList.add(a);var f=document.createElement("tbody");return d.appendChild(f),this.tablesContainer.appendChild(d),this.addEventListener(c,"touchstart",o.touchStartToClick),this.addEventListener(c,"click",function(t){i.selectTab(e)}),this.panelTabs.push(c),this.tabIdToIndex[e]=l,s>(this.container.style.minWidth?parseInt(this.container.style.minWidth):0)&&(this.container.style.minWidth=s+"px"),!0},l.prototype.removeTab=function(e){var t=this.tabIdToIndex[e];if(!t)return!1;this.panelTabs.splice(t,1);var n=document.getElementById(this.expandID(e));this.tabs.removeChild(n),this.tabIdToIndex={};for(var i=this.panelTabs.length,r=0;r<i;r++){var o=this.panelTabs[r];this.tabIdToIndex[o._id]=r}return!0},l.prototype.resizeTabs=function(){for(var e=this.tabs.getElementsByTagName("li"),t=100/e.length,n=0;n<e.length;n++)e[n].style.width=t+"%"},l.prototype.hasTab=function(e){var t=this.tabIdToIndex[e];return void 0!==this.panelTabs[t]},l.prototype.selectTab=function(e){if(this.isTabSelected(e))return!1;for(var t=this.panelTabs.length,n=0;n<t;n++){var i=this.panelTabs[n],r=document.getElementById(this.expandID(i._id+"-table"));e===i._id?(i.classList.add("tabselected"),r.classList.add("settings-selected-table"),this.mouseOver||i.classList.add("selectedmouseout")):(i.classList.remove("tabselected"),r.classList.remove("settings-selected-table"),this.mouseOver||this.panelTabs[n].classList.remove("selectedmouseout"))}return this.scrollContainer.scrollTop=0,!0},l.prototype.isTabSelected=function(e){var t=this.tabIdToIndex[e],n=this.panelTabs[t];return n&&n.classList.contains("tabselected")},l.prototype.addCheckbox=function(e,t,n,i,r,o){if(void 0===this.tabIdToIndex[e])return null;var s=document.getElementById(this.expandID(e+"-table")),l=new a.OptionCheckbox(t,s.tBodies[0],n,r,o);return l.changeListener=function(e){var t=e.detail.target.checked;i(t)},this.addEventListener(l,"change",l.changeListener),this.addControl(e,l)},l.prototype.addSlider=function(e,t,n,i,r,o,s){if(void 0===this.tabIdToIndex[e])return null;var l=document.getElementById(this.expandID(e+"-table")),c=new a.OptionSlider(t,n,i,l.tBodies[0],s);return c.setValue(r),c.sliderElement.step=c.stepperElement.step=1,this.addEventListener(c,"change",function(e){o(e)}),this.addControl(e,c)},l.prototype.addDropDownMenu=function(e,t,n,i,r,o){if(void 0===this.tabIdToIndex[e])return null;var s=document.getElementById(this.expandID(e+"-table")),l=new a.OptionDropDown(t,s.tBodies[0],n,i,o);return this.addEventListener(l,"change",function(e){r(e)}),this.addControl(e,l)},l.prototype.addControl=function(e,t,n){if(void 0===this.tabIdToIndex[e])return null;if(!t.hasOwnProperty("sliderRow")){var i=n&&n.insertAtIndex?n.insertAtIndex:-1,o=n&&n.caption?n.caption:null,a=document.getElementById(this.expandID(e+"-table"));i>a.length&&(i=-1);var s=a.tBodies[0].insertRow(i),l=s.insertCell(0);if(o){var c=document.createElement("div");c.setAttribute("data-i18n",o),c.textContent=r.i18n.translate(o),l.appendChild(c),l=s.insertCell(1)}else l.colSpan=3;l.appendChild(t),t.sliderRow=s,t.tbody=a.tBodies[0]}var u=this.expandID("adsk_settings_control_id_"+this.controlIdCount.toString());return this.controlIdCount=this.controlIdCount+1,this.controls[u]=t,u},l.prototype.removeCheckbox=function(e){return this.removeControl(e)},l.prototype.removeSlider=function(e){return this.removeControl(e)},l.prototype.removeDropdownMenu=function(e){return this.removeControl(e)},l.prototype.removeControl=function(e){var t;if("object"===s(e)&&e.tbody){for(var n in t=e,this.controls)if(this.controls[n]===t){e=n;break}}else t=this.controls[e];if(void 0===t)return!1;var i=t.tbody,r=t.sliderRow.rowIndex;return i.deleteRow(r),delete this.controls[e],!0},l.prototype.getControl=function(e){return this.controls[e]||null},l.prototype.getContentSize=function(){for(var e=this.heightAdjustment,t=0,n=0;n<this.panelTabs.length;n++){var i=this.panelTabs[n],r=document.getElementById(this.expandID(i._id+"-table")),o=r?r.clientHeight:0;t=Math.max(t,o)}return{height:e+t,width:this.container.clientWidth}}},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(3),o=n(20),a=n(1),s=n(130),l=n(11),c=n(7),u=n(32),h=n(53),d=n(39),f=n(131),p=n(60),m=n(132),g=n(133),v=n(134),y=n(61),_=n(9),b=n(4),x=n(2),w=n(47),A=n(58),E=n(99),T=n(48),M=n(127),S=n(135),C=n(136),P=n(138),L=n(139),R=n(26),D=n(54),I=n(143),O=n(30);function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var k=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.domElement=null}var t,n,i;return t=e,(n=[{key:"createDom",value:function(e){var t=document.createElement("div");t.className="spinner",e&&e.appendChild(t);for(var n=1;n<=3;n++){var i=document.createElement("div");i.className="bounce"+n,t.appendChild(i)}return this.domElement=t,this.hide(),t}},{key:"show",value:function(){this.domElement&&(this.domElement.style.display="block")}},{key:"hide",value:function(){this.domElement&&(this.domElement.style.display="None")}},{key:"destroy",value:function(){this.domElement=null}}])&&N(t.prototype,n),i&&N(t,i),e}();n(34);n.d(t,"DefaultSettings",function(){return F}),n.d(t,"isMiddleClick",function(){return U}),n.d(t,"isRightClick",function(){return G}),n.d(t,"Viewer3D",function(){return H}),n.d(t,"waitForCompleteLoad",function(){return W});var V=0,F={ambientShadows:!0,antialiasing:!Object(r.isMobileDevice)(),groundShadow:!0,groundReflection:!1,progressiveRendering:!0,swapBlackAndWhite:!1,openPropertiesOnSelect:!1,ghosting:!0,viewCube:!Object(r.isMobileDevice)(),lineRendering:!0,pointRendering:!0,edgeRendering:!1,grayscale:!1,lightPreset:o.DefaultLightPreset,backgroundColorPreset:null,reverseMouseZoomDir:!1,reverseHorizontalLookDirection:!1,reverseVerticalLookDirection:!1,alwaysUsePivot:!1,zoomTowardsPivot:!1,orbitPastWorldPoles:!0,leftHandedMouseSetup:!1,clickToSetCOI:!1,optimizeNavigation:Object(r.isMobileDevice)(),fusionOrbit:!0,fusionOrbitConstrained:!0,envMapBackground:!1,firstPersonToolPopup:!0,bimWalkToolPopup:!0,wheelSetsPivot:!1},B=["markups-svg","pushpin-container"];function U(e){return e instanceof MouseEvent&&1===e.button}var z=!1;function G(e,t){if(!(e instanceof MouseEvent))return!1;var n=e.button;return"buttons"in e&&(!z||1&e.buttons?2===n&&1&e.buttons&&(n=0,z=!0):(z=!1,n=0)),n===(!!t&&t.getUseLeftHandedInput()?0:2)}function H(e,t){if(e){if(this.clientContainer=e,this.container=document.createElement("div"),this.container.classList.add("adsk-viewing-viewer"),this.container.style.height="100%",this.container.style.width="100%",this.container.style.overflow="hidden",this.container.classList.add(Object(r.isTouchDevice)()?"touch":"notouch"),this.clientContainer.appendChild(this.container),this.config=t||Object(I.createViewerConfig)(),this.contextMenu=null,this.contextMenuCallbacks={},this.started=!1,this.theme=this.config.theme||"dark-theme",this.container.classList.add(this.theme),this.containerLayerOrder=this.config.containerLayerOrder||B,Object(r.isChrome)()&&this.container.classList.add("quality-text"),"CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]";this.canvasWrap=document.createElement("div"),this.canvasWrap.classList.add("canvas-wrap"),this.canvas=document.createElement("canvas"),this.canvas.tabIndex=0,this.canvas.setAttribute("data-viewer-canvas","true"),this.canvasWrap.appendChild(this.canvas),this.container.appendChild(this.canvasWrap),this.canvas.viewer=this}var n={prefix:"Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.",localStorage:!Object(r.isNodeJS)()};this.prefs=new s.Preferences(this,n),this._hotkeyManager=new f.HotkeyManager,this.extensionCache=null,this.running=!1,this._pushedTool="",this._defaultNavigationTool="",this.id=V++,this.impl=new L.Viewer3DImpl(this.canvas,this),this._loadingSpinner=new k,this.viewCubeUi=new C.ViewCubeUi(this),this.trackADPTimer=[]}function W(e,t){return new Promise(function(n,i){var r=0;function o(t){2===r&&n({viewer:e,model:t})}e.addEventListener(x.GEOMETRY_LOADED_EVENT,function n(a){a.model.getData().loadOptions.bubbleNode===t.bubbleNode&&(e.removeEventListener(x.GEOMETRY_LOADED_EVENT,n),r++,t.skipPropertyDb?o(a.model):a.model.getProperties(1,function(e){return o(a.model)},function(e){return i(e)}))}),e.addEventListener(x.TEXTURES_LOADED_EVENT,function n(i){i.model.getData().loadOptions.bubbleNode===t.bubbleNode&&(e.removeEventListener(x.TEXTURES_LOADED_EVENT,n),r++,o(i.model))})})}u.EventDispatcher.prototype.apply(H.prototype),h.ScreenModeMixin.prototype.apply(H.prototype),d.ExtensionMixin.prototype.apply(H.prototype),H.prototype.constructor=H,Object.defineProperty(H.prototype,"model",{get:function(){return this.impl.model},set:function(){throw"Do not set viewer.model"}}),H.ScreenMode=h.ScreenMode,H.ViewerCount=0,H.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"]},clickShift:{onObject:["selectToggle"]},disableSpinner:!1,disableMouseWheel:!1,disableTwoFingerSwipe:!1},H.createHeadlessViewer=function(){var e=new H;return e.impl.initialize(),e.impl.setLightPreset(0),e},H.prototype.start=function(e,t,n,i){if(this.started)return 0;this.started=!0;var r=this,o=r.initialize();return 0!==o?(i&&setTimeout(function(){i(o)},1),o):(setTimeout(function(){r.setUp(r.config)},1),e&&this.loadModel(e,t,n,i),0)},H.prototype.startWithDocumentNode=function(e,t,n){var i=this;return new Promise(function(r,o){if(i.started)return 0;i.started=!0;var a=i.initialize();0===a?(setTimeout(function(){i.setUp(i.config)},1),i.loadDocumentNode(e,t,n).then(r).catch(o)):setTimeout(function(){o(a)},1)})},H.prototype.registerUniversalHotkeys=function(){var e,t,n,i=this;e=function(){return i.navigation.setRequestFitToView(!0),!0},i._hotkeyManager.pushHotkeys("Autodesk.FitToView",[{keycodes:[O.KeyCode.f],onPress:e}]),e=function(){return i.navigation.setRequestHomeView(!0),!0},i._hotkeyManager.pushHotkeys("Autodesk.Home",[{keycodes:[O.KeyCode.h],onPress:e},{keycodes:[O.KeyCode.HOME],onPress:e}]),t=function(){return!(!i.objectContextMenu||!i.objectContextMenu.hide())||(i.dispatchEvent({type:x.ESCAPE_EVENT}),!0)},i._hotkeyManager.pushHotkeys("Autodesk.Escape",[{keycodes:[O.KeyCode.ESCAPE],onRelease:t}]),e=function(){return n=i.getActiveNavigationTool(),i.setActiveNavigationTool("pan")},t=function(){return i.setActiveNavigationTool(n)};var r=[{keycodes:[O.KeyCode.SHIFT],onPress:e,onRelease:t},{keycodes:[O.KeyCode.SPACE],onPress:e,onRelease:t}];i._hotkeyManager.pushHotkeys("Autodesk.Pan",r,{tryUntilSuccess:!0})},H.prototype.createControls=function(){var e=this.impl;return this.navigation=new p.Navigation(e.camera),this.__initAutoCam(e),this.utilities=new g.ViewingUtilities(e,this.autocam,this.navigation),this.clickHandler=new v.DefaultHandler(e,this.navigation,this.utilities),this.toolController=new m.ToolController(e,this,this.autocam,this.utilities,this.clickHandler),this.toolController.registerTool(new y.GestureHandler(this)),this.toolController.registerTool(this._hotkeyManager),this.toolController.activateTool(this._hotkeyManager.getName()),this.registerUniversalHotkeys(),this.toolController.registerTool(new S.OrbitDollyPanTool(e,this)),this.toolController},H.prototype.initialize=function(){this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0);var e=this.getDimensions();if(this.canvas.width=e.width,this.canvas.height=e.height,Object(r.isIOSDevice)()&&window.devicePixelRatio&&(this.canvas.width/=window.devicePixelRatio,this.canvas.height/=window.devicePixelRatio),this.impl.initialize(),!this.impl.glrenderer()){var t=function(){if(window.WebGLRenderingContext){for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=!1,i=0;i<4;i++)try{if((n=e.getContext(t[i]))&&"function"==typeof n.getParameter)return 1}catch(e){}return 0}return-1}();if(t<=0)return-1===t?c.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED:c.ErrorCodes.BROWSER_WEBGL_DISABLED}var n,i=this;Object(r.isIOSDevice)()?this.onResizeCallback=function(e){clearTimeout(n),n=setTimeout(i.resize.bind(i),500)}:this.onResizeCallback=function(e){var t=i.impl.camera.clientWidth,n=i.impl.camera.clientHeight,r=i.container.clientWidth,o=i.container.clientHeight;t===r&&n===o||i.resize()};window.addEventListener("resize",this.onResizeCallback,!1),this.onScrollCallback=function(e){i.impl.canvasBoundingclientRectDirty=!0},window.addEventListener("scroll",this.onScrollCallback),this.initContextMenu(),this.localize(),this.impl.controls=this.createControls(),this.setDefaultNavigationTool("orbit"),this.impl.controls&&this.impl.controls.setAutocam(this.autocam);var o=this.config&&this.config.canvasConfig?this.config.canvasConfig:H.kDefaultCanvasConfig;return this.setCanvasClickBehavior(o),o.disableSpinner||(this.loadSpinner=this._loadingSpinner.createDom(this.container)),this.initSettings(),this.viewerState=new E.ViewerState(this),this.config&&this.config.hasOwnProperty("startOnInitialize")&&!this.config.startOnInitialize||this.run(),window.NOP_VIEWER=this,this.addEventListener(x.MODEL_ADDED_EVENT,function(e){i.onModelAdded(e.model,e.preserveTools)}),this.dispatchEvent(x.VIEWER_INITIALIZED),this.trackADPSettingsOptions(),this.trackADPExtensionsLoaded(),H.ViewerCount++,0},H.prototype.setUp=function(e){if(this.config=e,this.config&&this.config.hasOwnProperty("extensions"))for(var t=this.config.extensions,n=0;n<t.length;++n)this.loadExtension(t[n],this.config);"true"===Object(l.getParameterByName)("lmv_viewer_debug")&&this.loadExtension("Autodesk.Debug",this.config);var i=this.config&&this.config.canvasConfig?this.config.canvasConfig:H.kDefaultCanvasConfig;this.setCanvasClickBehavior(i)},H.prototype.tearDown=function(){if(this.clearSelection(),this.loadedExtensions){for(var e in this.loadedExtensions)try{this.unloadExtension(e)}catch(t){a.logger.error("Failed to unload extension: "+e,t,Object(c.errorCodeString)(c.ErrorCodes.VIEWER_INTERNAL_ERROR)),a.logger.track({category:"error_unload_extension",extensionId:e,error_message:t.message,call_stack:t.stack})}this.loadedExtensions=null}for(this.toolController&&(this.toolController.enableMouseButtons(!1),this.toolController.deactivateTool("gestures")),a.logger.reportRuntimeStats(!0),this._loadingSpinner.show(),this.liveReviewClient&&(this.liveReviewClient.destroy(),this.liveReviewClient=null);this.trackADPTimer.length>0;)clearTimeout(this.trackADPTimer.pop());this.impl.unloadCurrentModel(),this.impl.setCutPlaneSet("__set_view",void 0)},H.prototype.run=function(){this.running||(this.resize(),this.running=!0,this.impl.run())},H.prototype.localize=function(){_.i18n.localize(),this.viewCubeUi.localize()},H.prototype.__initAutoCam=function(e){var t=this,n=e.camera;n.pivot||(n.pivot=new i.Vector3(0,0,0)),n.target||(n.target=new i.Vector3(0,0,0)),n.worldup||(n.worldup=n.up.clone()),t.autocamCamera=n.clone(),t.autocamCamera.target=n.target.clone(),t.autocamCamera.pivot=n.pivot.clone(),t.autocamCamera.worldup=n.worldup.clone(),t.autocam=new P.Autocam(t.autocamCamera,t.navigation,t.canvas),t.autocam.registerCallbackCameraChanged(function(e){t.autocamCamera.isPerspective!==n.isPerspective&&(t.autocamCamera.isPerspective?t.navigation.toPerspective():t.navigation.toOrthographic()),t.navigation.setVerticalFov(t.autocamCamera.fov,!1),t.navigation.setView(t.autocamCamera.position,t.autocamCamera.target),t.navigation.setPivotPoint(t.autocamCamera.pivot),t.navigation.setCameraUpVector(t.autocamCamera.up),e&&t.navigation.setWorldUpVector(t.autocamCamera.worldup),t.impl.syncCamera(e)}),t.autocam.registerCallbackPivotDisplay(function(e){t.utilities?t.utilities.pivotActive(e,!1):t.impl.controls.pivotActive(e,!1)}),t.autocam.registerCallbackTransitionCompleted(function(){t.fireEvent({type:x.CAMERA_TRANSITION_COMPLETED})}),t.addEventListener("cameraChanged",function(e){var n=e.camera;t.autocam.sync(n)}),t.autocam.sync(n)},H.prototype.uninitialize=function(){window.removeEventListener("resize",this.onResizeCallback,!1),this.onResizeCallback=null,window.removeEventListener("scroll",this.onScrollCallback),this.onScrollCallback=null,this.canvas.parentNode.removeChild(this.canvas),this.canvas.viewer=null,this.canvas=null,this.canvasWrap=null,this.viewerState=null,a.logger.reportRuntimeStats(),a.logger.track({category:"viewer_destroy"},!0),this.toolController&&(this.toolController.uninitialize(),this.toolController=null,this.clickHandler=null,this.utilities=null),this.navigation&&(this.navigation.uninitialize(),this.navigation=null),this.impl&&(this.impl.dtor(),this.impl=null),this.loadSpinner=null,this._loadingSpinner.destroy(),this.prefs=null,this.autocam.dtor(),this.autocam=null,this.autocamCamera=null,this._hotkeyManager.popHotkeys("Autodesk.FitToView"),this._hotkeyManager.popHotkeys("Autodesk.Home"),this._hotkeyManager.popHotkeys("Autodesk.Escape"),this._hotkeyManager.popHotkeys("Autodesk.Pan"),this._hotkeyManager.popHotkeys("Autodesk.Orbit"),H.ViewerCount--,0===H.ViewerCount&&Object(A.clearPropertyWorkerCache)(),this.onDefaultContextMenu&&(this.container.removeEventListener("contextmenu",this.onDefaultContextMenu,!1),this.onDefaultContextMenu=null),this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.extensionCache=null,this.clientContainer=null,this.config=null,this.listeners={},this.contextMenu=null,this.contextMenuCallbacks=null,this.viewCubeUi&&(this.viewCubeUi.uninitialize(),this.viewCubeUi=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.dispatchEvent(x.VIEWER_UNINITIALIZED),this.listeners={},a.logger.log("viewer destroy")},H.prototype.finish=function(){this.tearDown(),this.uninitialize()},H.prototype.load=function(e,t,n,i,r,o){a.logger.warn("viewer.load() is deprecated. Please use viewer.loadModel() instead.");var s={ids:null,sharedPropertyDbPath:t,acmSessionId:r,loadOptions:o};return this.loadModel(e,s,n,i)},H.prototype.setLoadHeuristics=function(e){var t=e.bubbleNode;if(t){var n=t.findViewableParent();if(n){var i=n.name();e.fileExt=i.slice(i.length-3).toLowerCase();void 0===e.isAEC&&-1!==["rvt","nwd","nwc","ifc"].indexOf(e.fileExt)&&(e.isAEC=!0)}}e.isAEC&&(void 0===e.useConsolidation&&(e.useConsolidation=!Object(r.isMobileDevice)()&&!Object(r.isNodeJS)()),void 0===e.createWireframe&&(e.createWireframe=!Object(r.isMobileDevice)()),e.disablePrecomputedNodeBoxes=!0),e.useConsolidation&&!e.bvhOptions&&(e.bvhOptions={},D.Consolidation.applyBVHDefaults(e.bvhOptions))},H.prototype.trackADPSettingsOptions=function(){var e=this;this.trackADPTimer.push(setTimeout(function(){if(e.prefs){var t={category:"settingOptionsStatus",switchSheetColorWhiteToBlack:e.prefs.swapBlackAndWhite,leftHandedMouseSetup:e.prefs.leftHandedMouseSetup,openPropertiesOnSelect:e.prefs.openPropertiesOnSelect,orbitPastWorldPoles:e.prefs.orbitPastWorldPoles,reverseMouseZoomDirection:e.prefs.reverseMouseZoomDir,fusionStyleOrbit:e.prefs.fusionOrbit,setPivotWithLeftMouseButton:e.prefs.clickToSetCOI,zoomTowardPivot:e.prefs.zoomTowardsPivot,viewCubeActsOnPivot:e.prefs.alwaysUsePivot,showViewCube:e.prefs.viewCube,environmentImageVisible:e.prefs.envMapBackground,displayEdges:e.prefs.edgeRendering,displayPoints:e.prefs.pointRendering,displayLines:e.prefs.lineRendering,ghostHiddenObjects:e.prefs.ghosting,groundReflection:e.prefs.groundReflection,groundShadow:e.prefs.groundShadow,ambientShadows:e.prefs.ambientShadows,antiAliasing:e.prefs.antialiasing,progressiveModelDisplay:e.prefs.progressiveRendering,smoothNavigation:e.prefs.optimizeNavigation};a.logger.track(t)}},3e4))},H.prototype.trackADPExtensionsLoaded=function(){var e=this,t={category:"loaded_extensions"};this.trackADPTimer.push(setTimeout(function(){if(e.loadedExtensions)for(var n in e.loadedExtensions)t[n]=n;a.logger.track(t)},3e4))},H.prototype.activateDefaultNavigationTools=function(e){if(!Object(r.isNodeJS)()){var t=e?"pan":"orbit";this.setActiveNavigationTool(t),this.setDefaultNavigationTool(t),this.toolController&&(this.toolController.enableMouseButtons(!0),this.toolController.activateTool("gestures"))}},H.prototype.registerDimensionSpecificHotkeys=function(e){if(this._hotkeyManager)if(e)this._hotkeyManager.popHotkeys("Autodesk.Orbit");else{var t,n=this,i=[{keycodes:[O.KeyCode.ALT],onPress:function(){return t=n.getActiveNavigationTool(),n.setActiveNavigationTool("orbit")},onRelease:function(){return n.setActiveNavigationTool(t)}}];this._hotkeyManager.pushHotkeys("Autodesk.Orbit",i,{tryUntilSuccess:!0})}},H.prototype.onModelAdded=function(e,t){var n=1===this.impl.modelQueue().getModels().length;if(n){e.is2d()&&this.activateLayerState("Initial"),n&&!e.getData().loadOptions.preserveView&&(this.setActiveNavigationTool(),this.impl.setViewFromFile(e,!0),this.toolController.recordHomeView()),this.registerDimensionSpecificHotkeys(e.is2d()),t||this.activateDefaultNavigationTools(e.is2d()),this.navigation.setIs2D(this.impl.modelQueue().areAll2D());var i=e.getData();i.isLeaflet?this.navigation.setConstraints2D(i.bbox,i.maxPixelPerUnit):this.navigation.setConstraints2D()}},H.prototype.loadModel=function(e,t,n,i,o){var s,l=this;function u(e,t,n){l._loadingSpinner.hide(),i&&i(e,t,n)}t=t||{};var h,d=e.toLowerCase().match(/\.([a-z0-9]+)(\?|$)/),f=d?d[1]:null;if(!(h=t&&t.fileLoader?t.fileLoader:w.FileLoaderManager.getFileLoaderForExtension(f)))return a.logger.error("File extension not supported:"+f,Object(c.errorCodeString)(c.ErrorCodes.UNSUPORTED_FILE_EXTENSION)),u(c.ErrorCodes.UNSUPORTED_FILE_EXTENSION,"File extension not supported",0),!1;this.setLoadHeuristics(t),this.impl.hasModels()||this._loadingSpinner.show(),Object(T.processMemoryOptions)(this.config);var p=(s=new h(this.impl,this.config)).loadFile(e,t,function(e,i){l.impl._removeLoadingFile(s),e?u(e.code,e.msg,e.args):(t.loadAsHidden?l.impl.modelQueue().addHiddenModel(i):l.impl.addModel(i),i.loader&&i.loader.notifiesFirstPixel?l.addEventListener(x.RENDER_FIRST_PIXEL,function(){l._loadingSpinner.hide()},{once:!0}):l._loadingSpinner.hide(),n&&n(i))},o);return!Object(r.isNodeJS)()&&t.isAEC&&s.is3d()&&this.impl.setLightPresetForAec(),this.impl.setRenderingPrefsFor2D(!s.is3d()),p},H.prototype.loadDocumentNode=function(e,t,n){var i=this,r=t instanceof R.BubbleNode?t:e.getRoot().findByGuid(t.guid),o={},a=e.getViewableUrn(r,o),s=r.findPropertyDbPath();if(0===a.indexOf("$file$")||Object(b.isOffline)())a=e.getFullPath(a),s=e.getFullPath(s);else{var l=r.getOtgGraphicsNode();l&&!l.error?(a=b.endpoint.getItemApi(null,a),s=b.endpoint.getItemApi(null,s)):b.endpoint.getApiFlavor()===b.endpoint.ENDPOINT_API_FLUENT?(a=b.endpoint.getItemApi(b.endpoint.getApiEndpoint(),a,"derivativeV2"),s=b.endpoint.getItemApi(b.endpoint.getApiEndpoint(),s,"derivativeV2")):o.isPdf&&(a=b.endpoint.getItemApi(b.endpoint.getApiEndpoint(),a,"derivativeV2"))}var c={sharedPropertyDbPath:s,acmSessionId:e.acmSessionId,bubbleNode:r,applyRefPoint:!1,loadOptions:o,page:o.page||1};for(var u in n=n||{},c)n.hasOwnProperty(u)||(n[u]=c[u]);n.keepCurrentModels||(this.impl.unloadCurrentModel(),this.impl.model=null);var h=r.findParentGeom2Dor3D().extensions();Array.isArray(h)&&h.forEach(function(e){i.loadExtension(e,i.config)});var d=this;return(o.isPdf?this.loadExtension("Autodesk.PDF"):Promise.resolve()).then(function(){return new Promise(function(e,t){d.loadModel(a,n,function(t){"view"===r.type()&&d.setView(r,{skipTransition:!0}),e(t)},function(e){t(e)})})})},H.prototype.getDimensions=function(){if(this.container){var e={};return this.getScreenMode()===h.ScreenMode.kFullScreen?(e.width=screen.width,e.height=screen.height):e=this.container.getBoundingClientRect(),{width:e.width,height:e.height}}return null},H.prototype.resize=function(){this.container.clientWidth>0&&this.container.clientHeight>0&&this.impl.resize(this.container.clientWidth,this.container.clientHeight)},H.prototype.getHotkeyManager=function(){return this._hotkeyManager},H.prototype.getCamera=function(){return this.impl.camera},H.prototype.getState=function(e){return this.viewerState.getState(e)},H.prototype.restoreState=function(e,t,n){var i=this.viewerState.restoreState(e,t,n);return i&&this.dispatchEvent({type:x.VIEWER_STATE_RESTORED_EVENT,value:i}),i},H.prototype.setView=function(e,t){if(!this.model)return!1;if(!(e&&e instanceof R.BubbleNode))return!1;var n=!!t&&t.skipTransition,r=!t||t.useExactCamera;if(e.getViewBox())return this.setViewFromViewBox(e.getViewBox(),e.name(),n),this.dispatchEvent({type:x.SET_VIEW_EVENT,view:e}),!0;var o=this.getCameraFromViewArray(e.data.camera);if(!o)return!1;this.impl.setViewFromCamera(o,n,r);var a=e.data.sectionPlane,s=e.data.sectionBox,l=e.data.sectionBoxTransform,c=this.model.getData().globalOffset;if(a){for(var u=[],h=0;h<a.length;h+=4){var d=new i.Vector4(a[h+0],a[h+1],a[h+2],a[h+3]);c&&(d.w+=i.Vector3.prototype.dot.call(c,new i.Vector3(a[h+0],a[h+1],a[h+2]))),u.push(d)}this.impl.setCutPlaneSet("__set_view",u)}else if(s&&l){var f=(new i.Matrix4).fromArray([l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[9],l[10],l[11],l[12],l[13],l[14],l[15]]);if(c){var p=(new i.Matrix4).makeTranslation(-c.x,-c.y,-c.z);f.multiply(p)}var m=new i.Vector3(s[0],s[1],s[2]),g=new i.Vector3(s[3],s[4],s[5]),v=new i.Box3(m,g);v.applyMatrix4(f);var y=this.impl.box2CutPlanes(v);this.impl.setCutPlaneSet("__set_view",y)}else this.impl.setCutPlaneSet("__set_view",void 0);return this.dispatchEvent({type:x.SET_VIEW_EVENT,view:e}),!0},H.prototype.setViewFromArray=function(e){var t=this.getCameraFromViewArray(e);this.impl.setViewFromCamera(t,!1,!0)},H.prototype.getCameraFromViewArray=function(e){var t=this.model?this.model.getData().globalOffset:void 0;return R.BubbleNode.readCameraFromArray(e,t)},H.prototype.getViewArrayFromCamera=function(){var e=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0};return this.impl.getViewArrayFromCamera(e)},H.prototype.setViewFromViewBox=function(e,t,n){var i=this.model;if(!i||i.is2d()){if(t&&t.length){var r,o=i.getData().metadata.views;for(r=0;r<o.length&&o[r].name!=t;r++);if(r<o.length){var s=o[r].layer_state;s&&this.activateLayerState(s)}}this.impl.setViewFromViewBox(this.model,e,t,n)}else a.logger.warn("Viewer3D.setViewFromViewBox is not applicable to 3D")},H.prototype.activateLayerState=function(e){this.impl.layers.activateLayerState(e),this.dispatchEvent({type:x.LAYER_VISIBILITY_CHANGED_EVENT})},H.prototype.getLayerStates=function(){return this.impl.layers.getLayerStates()},H.prototype.setViewFromFile=function(e){this.setActiveNavigationTool(),this.impl.setViewFromFile(e||this.model)},H.prototype.getProperties=function(e,t,n){this.model?this.model.getProperties(e,t,n):n&&n(c.ErrorCodes.BAD_DATA,"Properties failed to load since model does not exist")},H.prototype.getObjectTree=function(e,t){this.model?this.model.getObjectTree(e,t):t&&t(c.ErrorCodes.BAD_DATA,"ObjectTree failed to load since model does not exist")},H.prototype.setCanvasClickBehavior=function(e){if(this.impl.controls.hasOwnProperty("setClickBehavior")&&this.impl.controls.setClickBehavior(e),this.clickHandler&&this.clickHandler.setClickBehavior(e),e&&e.disableMouseWheel&&this.toolController.setMouseWheelInputEnabled(!1),e&&e.disableTwoFingerSwipe){var t=this.toolController.getTool("gestures");t&&t.disableTwoFingerSwipe()}},H.prototype.search=function(e,t,n,i){this.searchText=e,this.model?this.model.search(e,t,n,i):n&&n(c.ErrorCodes.BAD_DATA,"Search failed since model does not exist")},H.prototype.getHiddenNodes=function(){return this.impl.visibilityManager.getHiddenNodes()},H.prototype.getIsolatedNodes=function(){return this.model&&this.model.is2d()?(a.logger.warn("Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes()},H.prototype.isolate=function(e,t){if(t=t||this.model){t.getData();this.impl.visibilityManager.isolate(e,t)}},H.prototype.isolateById=function(e){return a.logger.warn("isolateById() is deprecated. Use isolate() instead."),this.isolate(e)},H.prototype.setBackgroundColor=function(e,t,n,i,r,o){this.impl.setClearColors(e,t,n,i,r,o)},H.prototype.toggleSelect=function(e,t){(t=t||this.model)&&t.is2d()?a.logger.warn("Viewer3D.toggleSelect is not yet implemented for 2D"):this.impl.selector.toggleSelection(e,t)},H.prototype.select=function(e,t){"number"==typeof e&&(e=[e]),t=t||this.model,this.impl.selector.setSelection(e,t)},H.prototype.clearSelection=function(){this.impl.selector.clearSelection()},H.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()},H.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()},H.prototype.setSelectionMode=function(e){this.impl.selector.setSelectionMode(e)},H.prototype.getSelection=function(){return this.impl.selector.getSelection()},H.prototype.getAggregateSelection=function(e){var t=this.impl.selector.getAggregateSelection();if(e)for(var n=0;n<t.length;n++)for(var i=0;i<t[n].selection.length;i++)e(t[n].model,t[n].selection[i]);return t},H.prototype.getAggregateIsolation=function(){return this.impl.visibilityManager.getAggregateIsolatedNodes()},H.prototype.getAggregateHiddenNodes=function(){return this.impl.visibilityManager.getAggregateHiddenNodes()},H.prototype.hide=function(e,t){t=t||this.model,this.impl.visibilityManager.hide(e,t)},H.prototype.show=function(e,t){t=t||this.model,this.impl.visibilityManager.show(e,t)},H.prototype.showAll=function(){this.impl.visibilityManager.aggregateIsolate([]),this.impl.layers.showAllLayers()},H.prototype.toggleVisibility=function(e,t){this.impl.visibilityManager.toggleVisibility(e,t)},H.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)},H.prototype.isNodeVisible=function(e,t){return t=t||this.model,this.impl.isNodeVisible(e,t)},H.prototype.explode=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.explode is not applicable to 2D"):(a.logger.track({name:"explode_count",aggregate:"count"}),this.impl.explode(e))},H.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(a.logger.warn("Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()},H.prototype.setQualityLevel=function(e,t){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setQualityLevel is not applicable to 2D"):(this.prefs.set("ambientShadows",e),this.prefs.set("antialiasing",t),this.impl.togglePostProcess(e,t))},H.prototype.setGhosting=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setGhosting is not applicable to 2D"):(this.prefs.set("ghosting",e),this.impl.toggleGhosting(e))},H.prototype.setGroundShadow=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setGroundShadow is not applicable to 2D"):this.getMemoryInfo()?a.logger.warn("Viewer3D.setGroundShadow is not available when memory is limited"):(this.prefs.set("groundShadow",e),this.impl.toggleGroundShadow(e))},H.prototype.setGroundReflection=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setGroundReflection is not applicable to 2D"):this.getMemoryInfo()?a.logger.warn("Viewer3D.setGroundReflection is not available when memory is limited"):(this.prefs.set("groundReflection",e),this.impl.toggleGroundReflection(e))},H.prototype.setEnvMapBackground=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setEnvMapBackground is not applicable to 2D"):(this.prefs.set("envMapBackground",e),this.impl.toggleEnvMapBackground(e))},H.prototype.setFirstPersonToolPopup=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setFirstPersonToolPopup is not applicable to 2D"):this.prefs.set("firstPersonToolPopup",e)},H.prototype.getFirstPersonToolPopup=function(){if(!this.model||!this.model.is2d())return this.prefs.firstPersonToolPopup;a.logger.warn("Viewer3D.getFirstPersonToolPopup is not applicable to 2D")},H.prototype.setBimWalkToolPopup=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setBimWalkToolPopup is not applicable to 2D"):this.prefs.set("bimWalkToolPopup",e)},H.prototype.getBimWalkToolPopup=function(){if(!this.model||!this.model.is2d())return this.prefs.bimWalkToolPopup;a.logger.warn("Viewer3D.getBimWalkToolPopup is not applicable to 2D")},H.prototype.setProgressiveRendering=function(e){this.prefs.set("progressiveRendering",e),this.impl.toggleProgressive(e)},H.prototype.setGrayscale=function(e){this.prefs.set("grayscale",e),this.impl.toggleGrayscale(e)},H.prototype.setSwapBlackAndWhite=function(e){this.prefs.set("swapBlackAndWhite",e),this.impl.toggleSwapBlackAndWhite(e)},H.prototype.setOptimizeNavigation=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setOptimizeNaviation is not applicable to 2D"):(this.prefs.set("optimizeNavigation",e),this.impl.setOptimizeNavigation(e))},H.prototype.setNavigationLock=function(e){this.navigation.getIsLocked()!==e&&(this.navigation.setIsLocked(e),this.dispatchEvent({type:x.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()}))},H.prototype.getNavigationLock=function(){return this.navigation.getIsLocked()},H.prototype.setNavigationLockSettings=function(e){this.navigation.setLockSettings(e),this.dispatchEvent({type:x.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()})},H.prototype.getNavigationLockSettings=function(){return this.navigation.getLockSettings()},H.prototype.setActiveNavigationTool=function(e){if(e===this._pushedTool||!e&&!this._pushedTool)return!0;if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1;this.impl.controls.setToolActiveName(this.getDefaultNavigationToolName()),this._pushedTool=null}return(!e||e===this.getDefaultNavigationToolName())&&null===this._pushedTool?(this.dispatchEvent({type:x.NAVIGATION_MODE_CHANGED_EVENT,id:this.getDefaultNavigationToolName()}),!0):!!this.impl.controls.activateTool(e)&&(this._pushedTool=e,this.dispatchEvent({type:x.NAVIGATION_MODE_CHANGED_EVENT,id:this._pushedTool}),!0)},H.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool},H.prototype.setDefaultNavigationTool=function(e){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool),this._pushedTool&&this.impl.controls.deactivateTool(this._pushedTool),this.impl.controls.activateTool(e),this._defaultNavigationTool=e,this._pushedTool&&this.impl.controls.activateTool(this._pushedTool)},H.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool},H.prototype.getFOV=function(){return this.navigation.getVerticalFov()},H.prototype.setFOV=function(e){this.navigation.setVerticalFov(e,!0)},H.prototype.getFocalLength=function(){return this.navigation.getFocalLength()},H.prototype.setFocalLength=function(e){this.navigation.setFocalLength(e,!0)},H.prototype.hideLines=function(e){this.prefs.set("lineRendering",!e);this.impl.hideLines(e)},H.prototype.hidePoints=function(e){this.prefs.set("pointRendering",!e);this.impl.hidePoints(e)},H.prototype.setDisplayEdges=function(e){this.prefs.set("edgeRendering",e),this.impl.setDisplayEdges(e)},H.prototype.applyCamera=function(e,t){this.impl.setViewFromCamera(e,!0),t&&this.fitToView()},H.prototype.fitToView=function(e,t,n){var i=[];e&&(e.length>0&&e[0].model?i=e:e.length>0&&i.push({model:t||this.model,selection:e})),this.impl.fitToView(i,n)},H.prototype.setClickConfig=function(e,t,n){var i=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in i){var r=i[e];if(t in r)return r[t]=n,!0}return!1},H.prototype.getClickConfig=function(e,t){var n=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in n){var i=n[e];if(t in i)return i[t]}return null},H.prototype.setClickToSetCOI=function(e,t){!1!==t&&this.prefs.set("clickToSetCOI",e);var n=this.getClickConfig("click","onObject");e?-1===n.indexOf("setCOI")&&this.setClickConfig("click","onObject",["setCOI"]):n.indexOf("setCOI")>=0&&this.setClickConfig("click","onObject",["selectOnly"])},H.prototype.initSettings=function(){this.prefs.load(F),this.prefs.tag("3d"),this.prefs.tag("2d"),this.prefs.untag("2d",["viewCube","alwaysUsePivot","zoomTowardsPivot","reverseHorizontalLookDirection","reverseVerticalLookDirection","orbitPastWorldPoles","clickToSetCOI","ghosting","optimizeNavigation","ambientShadows","antialiasing","groundShadow","groundReflection","lineRendering","edgeRendering","lightPreset","envMapBackground","firstPersonToolPopup","bimWalkToolPopup"]),this.prefs.untag("3d",["grayscale","swapBlackAndWhite"]),this.setQualityLevel(this.prefs.ambientShadows,this.prefs.antialiasing),this.setGroundShadow(this.prefs.groundShadow),this.setGroundReflection(this.prefs.groundReflection),this.setGhosting(this.prefs.ghosting),this.setProgressiveRendering(this.prefs.progressiveRendering),this.setGrayscale(this.prefs.grayscale),this.setSwapBlackAndWhite(this.prefs.swapBlackAndWhite),this.setClickToSetCOI(this.prefs.clickToSetCOI),this.setOptimizeNavigation(this.prefs.optimizeNavigation),this.hideLines(!this.prefs.lineRendering),this.hidePoints(!this.prefs.pointRendering),this.setDisplayEdges(this.prefs.edgeRendering),this.setEnvMapBackground(this.prefs.envMapBackground),this.setFirstPersonToolPopup(this.prefs.firstPersonToolPopup),this.setBimWalkToolPopup(this.prefs.bimWalkToolPopup),this.navigation.setUsePivotAlways(this.prefs.alwaysUsePivot),this.navigation.setReverseZoomDirection(this.prefs.reverseMouseZoomDir),this.navigation.setReverseHorizontalLookDirection(this.prefs.reverseHorizontalLookDirection),this.navigation.setReverseVerticalLookDirection(this.prefs.reverseVerticalLookDirection),this.navigation.setZoomTowardsPivot(this.prefs.zoomTowardsPivot),this.navigation.setOrbitPastWorldPoles(this.prefs.orbitPastWorldPoles),this.navigation.setUseLeftHandedInput(this.prefs.leftHandedMouseSetup),this.navigation.setWheelSetsPivot(this.prefs.wheelSetsPivot);var e=this.prefs.backgroundColorPreset;if(e)try{var t=JSON.parse(e);this.impl.setClearColors(t[0],t[1],t[2],t[3],t[4],t[5])}catch(e){this.prefs.set("backgroundColorPreset",null)}var n=this.prefs.lightPreset;this.impl.setLightPreset(n),this.impl.saveLightPreset()},H.prototype.setLightPreset=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setLightPreset is not applicable to 2D"):(this.prefs.set("lightPreset",e),this.impl.setLightPreset(e))},H.prototype.setUsePivotAlways=function(e){this.prefs.set("alwaysUsePivot",e),this.navigation.setUsePivotAlways(e)},H.prototype.setReverseZoomDirection=function(e){this.prefs.set("reverseMouseZoomDir",e),this.navigation.setReverseZoomDirection(e)},H.prototype.setReverseHorizontalLookDirection=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D"):(this.prefs.set("reverseHorizontalLookDirection",e),this.navigation.setReverseHorizontalLookDirection(e))},H.prototype.setReverseVerticalLookDirection=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setReverseVerticalLookDirection is not applicable to 2D"):(this.prefs.set("reverseVerticalLookDirection",e),this.navigation.setReverseVerticalLookDirection(e))},H.prototype.setZoomTowardsPivot=function(e){this.prefs.set("zoomTowardsPivot",e),this.navigation.setZoomTowardsPivot(e)},H.prototype.setOrbitPastWorldPoles=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setOrbitPastWorldPoles is not applicable to 2D"):(this.prefs.set("orbitPastWorldPoles",e),this.navigation.setOrbitPastWorldPoles(e))},H.prototype.setUseLeftHandedInput=function(e){this.prefs.set("leftHandedMouseSetup",e),this.navigation.setUseLeftHandedInput(e)},H.prototype.setLayerVisible=function(e,t,n){var i=this.impl.layers;null===e?t?i.showAllLayers():i.hideAllLayers():(Array.isArray(e)||(e=[e]),n&&i.hideAllLayers(),this.impl.setLayerVisible(e,t)),this.dispatchEvent({type:x.LAYER_VISIBILITY_CHANGED_EVENT})},H.prototype.isLayerVisible=function(e){return!!(e&&e.isLayer&&this.impl.isLayerVisible(e))},H.prototype.anyLayerHidden=function(){for(var e=this.impl.getLayersRoot(),t=e&&e.children,n=t?t.length:0,i=0;i<n;++i)if(!this.impl.layers.isLayerVisible(t[i]))return!0;return!1},H.prototype.allLayersHidden=function(){for(var e=this.impl.getLayersRoot(),t=e&&e.children,n=t?t.length:0,i=0;i<n;++i)if(this.impl.layers.isLayerVisible(t[i]))return!1;return!0},H.prototype.setGroundShadowColor=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setGroundShadowColor is not applicable to 2D"):this.impl.setGroundShadowColor(e)},H.prototype.setGroundShadowAlpha=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setGroundShadowAlpha is not applicable to 2D"):this.impl.setGroundShadowAlpha(e)},H.prototype.setGroundReflectionColor=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setGroundReflectionColor is not applicable to 2D"):this.impl.setGroundReflectionColor(e)},H.prototype.setGroundReflectionAlpha=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.setGroundReflectionAlpha is not applicable to 2D"):this.impl.setGroundReflectionAlpha(e)},H.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(a.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()},H.prototype.setCutPlanes=function(e){this.model&&this.model.is2d()?a.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"):this.impl.setCutPlanes(e)},H.prototype.getScreenShot=function(e,t,n,i){return this.impl.getScreenShot(e,t,n,i)},H.prototype.setContextMenu=function(e){this.contextMenu&&this.contextMenu.hide(),this.contextMenu=e||null},H.prototype.setDefaultContextMenu=function(){var e=Autodesk.Viewing.Extensions;return!(!e||!e.ViewerObjectContextMenu)&&(this.setContextMenu(new e.ViewerObjectContextMenu(this)),!0)},H.prototype.triggerContextMenu=function(e){return this.config&&this.config.onTriggerContextMenuCallback&&this.config.onTriggerContextMenuCallback(e),!!this.contextMenu&&(this.contextMenu.show(e),!0)},H.prototype.triggerSelectionChanged=function(e){this.config&&this.config.onTriggerSelectionChangedCallback&&this.config.onTriggerSelectionChangedCallback(e)},H.prototype.triggerDoubleTapCallback=function(e){this.config&&this.config.onTriggerDoubleTapCallback&&this.config.onTriggerDoubleTapCallback(e)},H.prototype.triggerSingleTapCallback=function(e){this.config&&this.config.onTriggerSingleTapCallback&&this.config.onTriggerSingleTapCallback(e)},H.prototype.initContextMenu=function(){(!this.config||!this.config.hasOwnProperty("disableBrowserContextMenu")||this.config.disableBrowserContextMenu)&&(this.onDefaultContextMenu=function(e){e.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1));var e=this,t=this.canvas||this.container;t.addEventListener("mousedown",function(t){G(t,e.navigation)&&(e.startX=t.clientX,e.startY=t.clientY)}),t.addEventListener("mouseup",function(t){return G(t,e.navigation)&&t.clientX===e.startX&&t.clientY===e.startY&&e.triggerContextMenu(t),!0},!1)},H.prototype.registerContextMenuCallback=function(e,t){this.contextMenuCallbacks[e]=t},H.prototype.unregisterContextMenuCallback=function(e){return e in this.contextMenuCallbacks&&(delete this.contextMenuCallbacks[e],!0)},H.prototype.runContextMenuCallbacks=function(e,t){for(var n in this.contextMenuCallbacks)this.contextMenuCallbacks.hasOwnProperty(n)&&this.contextMenuCallbacks[n](e,t)},H.prototype.playAnimation=function(e){var t=this.impl.keyFrameAnimator;t&&t.play(0,e)},H.prototype.joinLiveReview=function(e){this.liveReviewClient||(this.liveReviewClient=new M.LiveReviewClient(this));var t=this.liveReviewClient;Object(l.loadDependency)("lmv_io","socket.io-1.3.5.js",function(){t.joinLiveReviewSession(e)})},H.prototype.leaveLiveReview=function(){this.liveReviewClient&&this.liveReviewClient.leaveLiveReviewSession()},H.prototype.setModelUnits=function(e){this.model&&(this.model.getData().overriddenUnits=e)},H.prototype.worldToClient=function(e){return this.impl.worldToClient(e)},H.prototype.clientToWorld=function(e,t,n){return this.impl.clientToWorld(e,t,n)},H.prototype.modelHasTopology=function(){return!(!this.model||!this.model.hasTopology())},H.prototype.setSelectionColor=function(e,t){this.impl.setSelectionColor(e,t)},H.prototype.set2dSelectionColor=function(e){this.impl.matman().set2dSelectionColor(e)},H.prototype.createViewCube=function(){this.viewCubeUi.create()},H.prototype.displayViewCube=function(e){this.viewCubeUi.displayViewCube(e,!1)},H.prototype.displayViewCubeUI=function(e){this.viewCubeUi.setVisible(e)},H.prototype.setViewCube=function(e){this.viewCubeUi.cube&&this.viewCubeUi.cube.cubeRotateTo(e)},H.prototype.setTheme=function(e){for(var t=this.container.classList,n=0;n<t.length;++n){-1!==t[n].indexOf("-theme")&&t.remove(t[n--])}t.add(e)},H.prototype.setThemingColor=function(e,t,n){(n=n||this.model).setThemingColor(e,t),this.impl.invalidate(!0)},H.prototype.clearThemingColors=function(e){(e=e||this.model).clearThemingColors(),this.impl.invalidate(!0)},H.prototype.transferModel=function(e,t){var n=this.impl.findModel(e);if(n){var i=[];this.getAggregateSelection(function(t,n){t.id==e&&i.push(n)});var r=this.impl.visibilityManager.getIsolatedNodes(n),o=this.impl.visibilityManager.getHiddenNodes(n),a=this.impl.matman().exportModelMaterials(n),s=n.loader;n.loader=null,this.impl.unloadModel(n),n.loader=s,n.isAEC()&&n.is3d()&&t.impl.setLightPresetForAec(),t.impl.setRenderingPrefsFor2D(n.is2d()),t.impl.addModel(n),t.impl.matman().importModelMaterials(a),t._loadingSpinner.hide(),n.loader&&n.loader.viewer3DImpl===this.impl&&(n.loader.viewer3DImpl=t.impl),n.getData().loadDone&&t.impl.onLoadComplete(n),t.impl.selector.setSelection(i,n),0!=r.length?t.impl.visibilityManager.isolate(r,n):0!=o.length&&t.impl.visibilityManager.hide(o,n)}},H.prototype.hideModel=function(e){var t=this.impl.modelQueue(),n=t.findModel(e);return!!n&&(this.impl.removeModel(n),t.addHiddenModel(n),!0)},H.prototype.showModel=function(e,t){var n=this.impl.modelQueue(),i=n.findHiddenModel(e);return!!i&&(n.removeHiddenModel(i),this.impl.addModel(i,t),!0)},H.prototype.getVisibleModels=function(){return this.impl.modelQueue().getModels().slice()},H.prototype.getHiddenModels=function(){return this.impl.modelQueue().getHiddenModels().slice()},H.prototype.getMemoryInfo=function(){var e=this.impl.modelQueue();return e?e.getMemoryInfo():null},H.prototype.restoreDefaultSettings=function(){var e=this.model,t=e.is2d()?"2d":"3d";this.prefs.reset(t),this.impl.setupLighting(e),e.isAEC()&&e.is3d()&&this.impl.setLightPresetForAec(),this.impl.setRenderingPrefsFor2D(!e.is3d()),this.fireEvent({type:x.RESTORE_DEFAULT_SETTINGS_EVENT})},H.prototype.disableHighlight=function(e){this.impl.disableHighlight(e)},H.prototype.disableSelection=function(e){e&&this.clearSelection(),this.impl.disableSelection(e)},H.prototype.isHighlightDisabled=function(){return this.impl.selector.highlightDisabled},H.prototype.isHighlightPaused=function(){return this.impl.selector.highlightPaused},H.prototype.isHighlightActive=function(){return!(this.impl.selector.highlightDisabled||this.impl.selector.highlightPaused)},H.prototype.isSelectionDisabled=function(){return this.impl.selector.selectionDisabled},H.prototype.activateExtension=function(e,t){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].activate(t):(a.logger.warn("Extension is not loaded or doesn't exist"),!1)},H.prototype.deactivateExtension=function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].deactivate():(a.logger.warn("Extension is not loaded or doesn't exist"),!1)},H.prototype.isExtensionActive=function(e,t){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].isActive(t):(a.logger.warn("Extension is not loaded or doesn't exist"),!1)},H.prototype.isExtensionLoaded=function(e){return this.loadedExtensions&&e in this.loadedExtensions},H.prototype.getLoadedExtensions=function(){return this.loadedExtensions||[]},H.prototype.getExtensionModes=function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].getModes():(console.warn("Extension is not loaded or doesn't exist"),[])},H.prototype.reorderElements=function(e){var t=e.getAttribute("layer-order-id"),n=this.containerLayerOrder.indexOf(t),i=null;if(-1!==n)for(var r=n+1;r<this.containerLayerOrder.length&&!i;r++)i=this.container.querySelector('[layer-order-id="'+this.containerLayerOrder[r]+'"]');i?this.container.insertBefore(e,i):this.container.appendChild(e)},H.prototype.appendOrderedElementToViewer=function(e){var t=this.container.querySelector('[layer-order-id="'+e+'"]');if(t)return t;var n=document.createElement("div");return n.setAttribute("layer-order-id",e),this.reorderElements(n),n}},function(e,t,n){"use strict";n.r(t),n.d(t,"getPropWorker",function(){return y}),n.d(t,"clearPropertyWorkerCache",function(){return _}),n.d(t,"PropDbLoader",function(){return b});var i,r=n(1),o=n(12),a=n(7),s=n(2),l=n(4),c=n(98),u=n(87),h=n(24),d=n(32),f="UNLOAD_PROPERTYDB",p=1,m={};function g(e){var t=e.data;if(t&&t.debug)r.logger.debug(t.message);else if(t&&t.progress&&t.cbId)(n=m[t.cbId])[2]&&n[2](t.progress);else if(t.cbId){var n=m[t.cbId];t&&t.error?n[1]&&n[1](t.error):n[0]&&n[0](t.result),delete m[t.cbId]}}function v(e,t,n){var i=p++;return m[i]=[e,t,n],i}function y(){return i}function _(){i&&i.doOperation({operation:f,clearCaches:!0})}var b=function(e,t,n){this.eventTarget=n||new d.EventDispatcher,this.model=t,this.svf=t&&t.getData(),this.dbPath="",this.sharedDbPath=!1;var i=this.svf&&this.svf.is2d&&this.svf.loadOptions.bubbleNode&&this.svf.loadOptions.bubbleNode.findViewableParent()._getOtgManifest();if(this.svf&&!i&&this.svf.propertydb&&this.svf.propertydb.avs.length){for(var a in this.dbFiles=this.svf.propertydb,this.dbFiles)this.dbFiles[a][0]&&(this.dbFiles[a][0]=this.dbFiles[a][0].replace(/\\/g,"/"));var s=Object(o.pathToURL)(this.svf.basePath);if(e){var l=o.ViewingService.simplifyPath(s+this.svf.propertydb.avs[0]);if((l=l.slice(0,l.lastIndexOf("/")+1))===e){var c={};for(var a in this.dbFiles){var u=this.dbFiles[a][0];0===(u=o.ViewingService.simplifyPath(s+u)).indexOf(e)&&(u=u.slice(e.length)),c[a]=[u]}this.dbFiles=c,this.dbPath=e,this.sharedDbPath=!0}else this.dbPath=s,this.sharedDbPath=!1}else this.dbPath=s,this.sharedDbPath=!1}else this.sharedDbPath=!0,this.svf&&this.svf.loadOptions.bubbleNode?(this.dbPath=e,this.dbFiles=this.svf.loadOptions.bubbleNode.getPropertyDbManifest()):(r.logger.warn("Deprecated shared property database initialization without bubbleNode in Model load options."),this.dbPath=e,this.dbFiles={attrs:[],avs:[],ids:[],values:[],offsets:[]}),r.logger.log("Using shared db path "+e);this.queryParams="",this.svf&&this.svf.acmSessionId&&(this.queryParams="acmsession="+this.svf.acmSessionId),this.loadProgress=0};b.prototype.dtor=function(){this.asyncPropertyOperation({operation:f},function(){},function(){}),this.model=null,this.svf=null},b.prototype.processLoadResult=function(e){if(e.instanceTreeStorage){var t=new u.InstanceTreeAccess(e.instanceTreeStorage,e.rootId,e.instanceBoxes);this.instanceTree=new c.InstanceTree(t,e.objectCount,e.maxTreeDepth),this.svf&&(this.svf.instanceTree=this.instanceTree,this.instanceTree.setFragmentList(this.model.getFragmentList()))}else e.instanceTree?(r.logger.warn("glTF instance tree not supported"),this.hasObjectProperties=e.objectCount):e.objectCount&&(this.hasObjectProperties=e.objectCount,this.svf&&(this.svf.hasObjectProperties=e.objectCount));e.dbidOldToNew&&this.model.setDbIdRemap(e.dbidOldToNew),this.eventTarget.dispatchEvent({type:s.OBJECT_TREE_CREATED_EVENT,svf:this.svf,model:this.model,target:this})},b.prototype.processLoadError=function(e){this.propertyDbError=e,this.eventTarget.dispatchEvent({type:s.OBJECT_TREE_UNAVAILABLE_EVENT,svf:this.svf,model:this.model,target:this})},b.prototype.load=function(){var e=this;if(this.svf&&this.svf.instanceTree&&this.svf.instanceBoxes)setTimeout(function(){e.processLoadResult(e.svf)},0);else{i||(i=Object(h.createWorkerWithIntercept)()).addEventListenerWithIntercept(g);var t=v(function(t){e.processLoadResult(t),e.onLoadProgress(100)},function(t){e.processLoadError(t),e.onLoadProgress(100)},function(t){e.onLoadProgress(t.percent)}),n=this.svf&&this.svf.loadOptions,r=!(n&&n.disablePrecomputedNodeBoxes),o={operation:"LOAD_PROPERTYDB",dbPath:this.dbPath,sharedDbPath:this.sharedDbPath,propertydb:this.dbFiles,fragToDbId:this.svf&&this.svf.fragments.fragId2dbId,fragBoxes:r&&this.svf&&this.svf.fragments.boxes,needsDbIdRemap:this.svf&&this.svf.is2d,cbId:t,queryParams:this.queryParams};i.doOperation(Object(l.initLoadContext)(o))}},b.prototype.asyncPropertyOperation=function(e,t,n,r){var o=this;if(e.dbPath=this.dbPath,o.instanceTree||o.hasObjectProperties)e.cbId=v(t,n,r),i.doOperation(e);else if(o.propertyDbError)n&&n(o.propertyDbError);else{var l=function i(l){o.eventTarget.removeEventListener(s.OBJECT_TREE_CREATED_EVENT,i),o.eventTarget.removeEventListener(s.OBJECT_TREE_UNAVAILABLE_EVENT,i),o.instanceTree||o.hasObjectProperties||o.propertyDbError?o.asyncPropertyOperation(e,t,n,r):n&&n({code:a.ErrorCodes.UNKNOWN_FAILURE,msg:"Failed to load properties"})};o.eventTarget.addEventListener(s.OBJECT_TREE_CREATED_EVENT,l),o.eventTarget.addEventListener(s.OBJECT_TREE_UNAVAILABLE_EVENT,l)}},b.prototype.getProperties=function(e,t,n){this.asyncPropertyOperation({operation:"GET_PROPERTIES",dbId:e},t,n)},b.prototype.getBulkProperties=function(e,t,n,i,r){this.asyncPropertyOperation({operation:"GET_PROPERTIES",dbIds:e,propFilter:t,ignoreHidden:r},n,i)},b.prototype.searchProperties=function(e,t,n,i){this.asyncPropertyOperation({operation:"SEARCH_PROPERTIES",searchText:e,attributeNames:t},n,i)},b.prototype.findProperty=function(e){var t=this;return new Promise(function(n,i){t.asyncPropertyOperation({operation:"FIND_PROPERTY",propertyName:e},n,i)})},b.prototype.diffProperties=function(e,t,n,i,r){this.asyncPropertyOperation({operation:"DIFF_PROPERTIES",dbPath2:e,diffOptions:i},t,n,r)},b.prototype.findLayers=function(){var e=this;return new Promise(function(t,n){e.asyncPropertyOperation({operation:"FIND_LAYERS"},t,n)})},b.prototype.getExternalIdMapping=function(e,t,n){this.asyncPropertyOperation({operation:"BUILD_EXTERNAL_ID_MAPPING",extIdFilter:n},e,t)},b.prototype.getLayerToNodeIdMapping=function(e,t){this.asyncPropertyOperation({operation:"BUILD_LAYER_TO_NODE_ID_MAPPING"},e,t)},b.prototype.isObjectTreeLoaded=function(){return!!this.instanceTree},b.prototype.getObjectTree=function(e,t){var n=this;if(n.instanceTree)e(n.instanceTree);else if(n.propertyDbError)t&&t(n.propertyDbError);else if("hasObjectProperties"in n)t&&t("F2D files do not have an InstanceTree.");else{var i=function i(){n.eventTarget.removeEventListener(s.OBJECT_TREE_CREATED_EVENT,i),n.eventTarget.removeEventListener(s.OBJECT_TREE_UNAVAILABLE_EVENT,i),n.getObjectTree(e,t)};n.eventTarget.addEventListener(s.OBJECT_TREE_CREATED_EVENT,i),n.eventTarget.addEventListener(s.OBJECT_TREE_UNAVAILABLE_EVENT,i)}},b.prototype.onLoadProgress=function(e){this.eventTarget.dispatchEvent({type:s.OBJECT_TREE_LOAD_PROGRESS_EVENT,percent:e,svf:this.svf,model:this.model,target:this}),this.loadProgress=e},b.prototype.getLoadProgress=function(){return this.loadProgress}},function(e,t,n){"use strict";function i(){this.getContainerBoundingRect=function(){var e=this.parentContainer.getBoundingClientRect(),t={height:0,width:0,left:0,bottom:0,right:0,top:0},n=document.getElementsByClassName("toolbar-menu");return n&&n.length>0&&(t=n[0].getBoundingClientRect()),{height:e.height-t.height,width:e.width,left:e.left,bottom:e.bottom-t.height,right:e.right,top:e.top}}}n.r(t),n.d(t,"ViewerPanelMixin",function(){return i})},function(e,t,n){"use strict";n.r(t),n.d(t,"Navigation",function(){return o});var i=n(0),r=n(1);function o(e){this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1},this.__lockSettings={orbit:!1,pan:!1,zoom:!1,roll:!1,fov:!1,gotoview:!1,walk:!1},this.FIT_TO_VIEW_VERTICAL_MARGIN=.05,this.FIT_TO_VIEW_VERTICAL_OFFSET=0,this.FIT_TO_VIEW_HORIZONTAL_MARGIN=.05,this.FIT_TO_VIEW_HORIZONTAL_OFFSET=0,this.__pivotIsSetFlag=!1,this.__fitToViewRequested=!1,this.__homeViewRequested=!1,this.__transitionActive=!1,this.__destinationView=null,this.__is2D=!1,this.__isTouchDevice=!1,this.__kEpsilon=1e-6,this.__minDistance=1e-5;var t=void 0,n=void 0,r=2,o=200,a=null,s={left:0,top:0,width:1,height:1};this.uninitialize=function(){this.setCamera(null)},this.setCamera=function(e){e!==a&&(a=e,e&&(e.hasOwnProperty("target")||(e.target=new i.Vector3(0,0,0)),e.hasOwnProperty("pivot")||(e.pivot=new i.Vector3(0,0,0)),e.worldup=e.up.clone(),e.dirty=!0))},this.getCamera=function(){return a},this.setScreenViewport=function(e){s=e},this.getScreenViewport=function(){return s},this.__setUp=function(e){if(e&&a&&0!==e.clone().normalize().sub(a.worldup).lengthSq())return a.worldup.copy(e).normalize(),a.dirty=!0,!0;return!1},this.__getUp=function(){return a?a.worldup:new i.Vector3(0,1,0)},this.setView=function(e,t){a&&e&&t&&(a.position.copy(e),a.target.copy(t),a.dirty=!0)},this.orientCameraUp=function(){a&&this.isActionEnabled("roll")&&(a.up.copy(this.getAlignedUpVector()),a.dirty=!0)},this.getPivotPoint=function(){return a?a.pivot.clone():new i.Vector3(0,0,0)},this.setPivotPoint=function(e){a&&e&&(a.pivot.copy(e),a.dirty=!0)},this.getPosition=function(){return a?a.position.clone():new i.Vector3(0,0,1)},this.setPosition=function(e){a&&e&&(a.position.copy(e),a.dirty=!0)},this.setTarget=function(e){a&&e&&(a.target.copy(e),a.dirty=!0)},this.getTarget=function(){return a?a.target.clone():new i.Vector3(0,0,0)},this.getEyeVector=function(){return a?a.target.clone().sub(a.position):new i.Vector3(0,0,-1)},this.getEyeToCenterOfBoundsVec=function(e){return a?e.center().sub(a.position):new i.Vector3(0,0,-1)},this.getFovMin=function(){return 6.88},this.getFovMax=function(){return 100},this.setZoomInLimitFactor=function(e){o=e},this.getZoomInLimitFactor=function(){return o},this.setZoomOutLimitFactor=function(e){r=e},this.getZoomOutLimitFactor=function(){return r},this.isPointVisible=function(e){return(new i.Frustum).setFromMatrix(a.projectionMatrix.clone().multiply(a.matrixWorldInverse)).containsPoint(e)},this.setVerticalFov=function(e,t){if((!a||a.isPerspective)&&(e<6.88?e=6.88:e>100&&(e=100),a&&this.isActionEnabled("fov"))){if(Math.abs(a.fov-e)<=1e-6)return;if(t){var n=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),r=this.getPosition(),o=this.getEyeVector(),s=i.Math.degToRad(a.fov),l=i.Math.degToRad(e),c=n?this.getPivotPlaneDistance():o.length(),u=c*Math.tan(.5*s)/Math.tan(.5*l),h=o.normalize().multiplyScalar(c-u);this.setPosition(r.add(h)),n&&this.setTarget(this.getTarget().add(h))}a.setFov(e),a.dirty=!0}},this.computeFit=function(t,n,r,o,a){if(!o||o.empty())return{position:t,target:n};a=void 0===a?1:a;for(var s=o.center(),l=o.size(),c=t.clone().sub(n).normalize(),u=Math.tan(i.Math.degToRad(.5*r)),h=0,d=this.computeOrthogonalUp(t,n),f=c.clone().cross(d).normalize(),p=new i.Vector3,m=0===l.z?4:8,g=0;g<m;g++){p.set(0==(1&g)?-.5*l.x:.5*l.x,0==(2&g)?-.5*l.y:.5*l.y,0==(4&g)?-.5*l.z:.5*l.z);var v=0;e.isPerspective&&(v=p.dot(c));var y=Math.abs(p.dot(d)),_=Math.abs(p.dot(f)),b=v+(1+2*this.FIT_TO_VIEW_VERTICAL_MARGIN/(1-2*this.FIT_TO_VIEW_VERTICAL_MARGIN))*y/u;h<b&&(h=b),h<(b=v+(1+2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN/(1-2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN))*_/(a*u))&&(h=b)}return s.add(d.multiplyScalar(-h*this.FIT_TO_VIEW_VERTICAL_OFFSET)),s.add(f.multiplyScalar(h*this.FIT_TO_VIEW_HORIZONTAL_OFFSET)),c.multiplyScalar(h),{position:s.clone().add(c),target:s}},this.computeOrthogonalUp=function(e,t){var n=this.__getUp(),i=t.clone().sub(e);if(0===i.lengthSq())return i.copy(n);var r=i.clone().cross(n);return 0===r.lengthSq()&&(n.z>n.y?i.y-=1e-4:i.z-=1e-4,r.crossVectors(i,n)),r.cross(i).normalize()},this.fitBounds=function(e,t,n){var i=this.getTarget(),r=this.getPosition();if(!this.isActionEnabled("gotoview")||!t||t.empty())return{position:r,target:i};var o=this.getVerticalFov(),s=this.computeFit(r,i,o,t,a.aspect),l=n?this.computeOrthogonalUp(r,i):a.up;return e?(a.up.copy(l),this.setView(s.position,s.target)):this.setRequestTransitionWithUp(!0,s.position,s.target,o,l),this.setPivotPoint(s.target),this.setPivotSetFlag(!0),s},this.computeOverviewDistance=function(e){if(this.__is2D){var t=e.size(),n=a.aspect,r=t.x/n,o=t.y;return Math.max(r,o)}var s=this.getVerticalFov(),l=(t=e.size()).length();return 0===l&&(l=2),a.isPerspective?.5*l/Math.tan(i.Math.degToRad(.5*s)):l},this.applyDollyConstraint=function(e,i){if(!(t||n||r))return e;var s=e;if((t||r&&i)&&e>1){var l,c=a.isPerspective?this.getEyeToCenterOfBoundsVec(i):this.getEyeVector();l=t?r*this.computeOverviewDistance(t):r*this.computeOverviewDistance(i);var u=Math.abs(l/c.length());u=Math.max(u,1),s=Math.min(s,u)}if((n||o&&i)&&this.__is2D){var h=(n?a.clientHeight/n:this.computeOverviewDistance(i)/o)/-(c=this.getEyeVector()).z;h=Math.min(h,1),s=Math.max(s,h)}return s},this.applyPanningConstraint2D=function(e){if(this.__is2D&&t){var n=a.position.x+e.x,r=a.position.y+e.y;n=i.Math.clamp(n,t.min.x,t.max.x),r=i.Math.clamp(r,t.min.y,t.max.y);var o=n-a.position.x,s=r-a.position.y,l=Math.min(e.x,0),c=Math.min(e.y,0),u=Math.max(e.x,0),h=Math.max(e.y,0);o=i.Math.clamp(o,l,u),s=i.Math.clamp(s,c,h),e.x=o,e.y=s}},this.updateCamera=function(){a&&(a.updateProjectionMatrix(),this.orient(a,a.target,a.position,a.up),a.dirty=!1)},this.setCamera(e),this.setConstraints2D=function(e,i){t=e,n=i}}o.prototype.constructor=o,o.prototype.setIs2D=function(e){this.__is2D=!!e},o.prototype.getIs2D=function(){return this.__is2D},o.prototype.setIsTouchDevice=function(e){this.__isTouchDevice=!!e},o.prototype.getIsTouchDevice=function(){return this.__isTouchDevice},o.prototype.orient=function(){var e,t,n,r;return function(o,a,s,l){e||(e=new i.Matrix4,t=new i.Vector3,n=new i.Vector3,r=new i.Vector3);var c=e.elements;r.subVectors(s,a).normalize(),0===r.lengthSq()&&(r.z=1),t.crossVectors(l,r).normalize(),0===t.lengthSq()&&(l.z>l.y?r.y-=1e-4:r.z+=1e-4,t.crossVectors(l,r).normalize()),n.crossVectors(r,t),c[0]=t.x,c[4]=n.x,c[8]=r.x,c[1]=t.y,c[5]=n.y,c[9]=r.y,c[2]=t.z,c[6]=n.z,c[10]=r.z,o.setRotationFromMatrix(e)}}(),o.prototype.fov2fl=function(e){var t=i.Math.degToRad(e);return t<=0&&(t=1e-4),Math.round(12/Math.tan(.5*t))},o.prototype.fl2fov=function(e){e<=0&&(e=1e-4);var t=2*Math.atan(12/e);return i.Math.radToDeg(t)},o.prototype.setCameraUpVector=function(e){if(this.isActionEnabled("roll")){var t=this.getCamera();t.up.copy(e),t.dirty=!0}},o.prototype.getCameraUpVector=function(){var e=this.getCameraRightVector(!1),t=this.getEyeVector();return e.cross(t).normalize()},o.prototype.getAlignedUpVector=function(){var e=this.getCameraRightVector(!0),t=this.getEyeVector();return e.cross(t).normalize()},o.prototype.getCameraRightVector=function(e){var t=new i.Vector3,n=e?this.getWorldUpVector():this.getCamera().up,r=this.getEyeVector();return t.crossVectors(r,n),0===t.lengthSq()&&(Math.abs(r.z)>=Math.abs(r.y)?n.set(0,1,0):n.set(0,0,1),t.crossVectors(r,n)),t.normalize()},o.prototype.setWorldUpVector=function(e,t){this.isActionEnabled("roll")&&(this.__setUp(e),t&&this.orientCameraUp())},o.prototype.getWorldUpVector=function(){return this.__getUp().clone()},o.prototype.getWorldRightVector=function(){var e=new i.Vector3;return e.copy(this.__getUp()),Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},o.prototype.getVerticalFov=function(){return this.getCamera().fov},o.prototype.getHorizontalFov=function(){var e=this.getScreenViewport();return this.getCamera().fov*(e.width/e.height)},o.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())},o.prototype.setFocalLength=function(e,t){this.setVerticalFov(this.fl2fov(e),t)},o.prototype.setReverseZoomDirection=function(e){this.__options.reverseDolly=!!e},o.prototype.setReverseHorizontalLookDirection=function(e){this.getIs2D()?r.logger.warn("Autodesk.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D"):this.__options.reverseHorizontalLookDirection=!!e},o.prototype.setReverseVerticalLookDirection=function(e){this.getIs2D()?r.logger.warn("Autodesk.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D"):this.__options.reverseVerticalLookDirection=!!e},o.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly},o.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(r.logger.warn("Autodesk.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection},o.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(r.logger.warn("Autodesk.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection},o.prototype.setZoomTowardsPivot=function(e){this.__options.dollyToPivot=!!e},o.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot},o.prototype.setOrbitPastWorldPoles=function(e){this.getIs2D()?r.logger.warn("Autodesk.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D"):this.__options.orbitPastPoles=!!e},o.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(r.logger.warn("Autodesk.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles},o.prototype.setUsePivotAlways=function(e){this.__options.usePivotAlways=!!e},o.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways},o.prototype.setUseLeftHandedInput=function(e){this.__options.useLeftHandedInput=!!e},o.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput},o.prototype.setWheelSetsPivot=function(e){this.__options.wheelSetsPivot=!!e},o.prototype.getWheelSetsPivot=function(){return this.__options.wheelSetsPivot},o.prototype.setIsLocked=function(e){this.__options.lockNavigation=!!e},o.prototype.getIsLocked=function(){return this.__options.lockNavigation},o.prototype.setLockSettings=function(e){for(var t in this.__lockSettings)e.hasOwnProperty(t)&&(this.__lockSettings[t]=e[t])},o.prototype.getLockSettings=function(){var e={};for(var t in this.__lockSettings)e[t]=this.__lockSettings[t];return e},o.prototype.isActionEnabled=function(e){return!this.__options.lockNavigation||!0===this.__lockSettings[e]},o.prototype.setPivotSetFlag=function(e){this.__pivotIsSetFlag=!!e},o.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag},o.prototype.setRequestFitToView=function(e){this.isActionEnabled("gotoview")&&(this.__fitToViewRequested=!!e)},o.prototype.getRequestFitToView=function(){return this.__fitToViewRequested},o.prototype.setRequestHomeView=function(e){this.isActionEnabled("gotoview")&&(this.__homeViewRequested=!!e)},o.prototype.getRequestHomeView=function(){return this.__homeViewRequested},o.prototype.setRequestTransition=function(e,t,n,i,r,o){this.__destinationView=e?{position:t.clone(),coi:n.clone(),fov:i,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:r,pivot:o?o.clone():n.clone()}:null},o.prototype.setRequestTransitionWithUp=function(e,t,n,i,r,o,a){this.__destinationView=e?{position:t.clone(),coi:n.clone(),fov:i,up:r.clone(),worldUp:o||this.getWorldUpVector(),reorient:!1,pivot:a?a.clone():n.clone()}:null},o.prototype.getRequestTransition=function(){return this.__destinationView},o.prototype.setTransitionActive=function(e){this.__transitionActive=!!e},o.prototype.getTransitionActive=function(){return this.__transitionActive},o.prototype.getWorldSize=function(e){var t=this.getCamera(),n=t.aspect,r=2*e*Math.tan(i.Math.degToRad(.5*t.fov)),o=r*n;return new i.Vector2(o,r)},o.prototype.screenToViewport=function(e,t){return e=2*e-1,t=2*(t=1-t)-1,new i.Vector3(e,t,1)},o.prototype.viewportToScreen=function(e,t){return e=(e+1)/2,t=1-(t=(t+1)/2),new i.Vector2(e,t)},o.prototype.getWorldPoint=function(e,t){var n=this.screenToViewport(e,t);e=n.x,t=n.y;var r,o=this.getCamera();o.isPerspective&&(r=(r=new i.Vector3(e,t,1)).unproject(o));var a,s,l=this.getEyeVector(),c=this.getPosition();if(!o.isPerspective||isNaN(r.x)){var u=this.getWorldSize(l.length()),h=this.getCameraRightVector(!1).multiplyScalar(.5*e*u.x),d=this.getCameraUpVector().multiplyScalar(.5*t*u.y);a=l.clone().add(h).add(d).normalize()}else a=r.sub(c).normalize();var f=this.getPivotPoint(),p=a.dot(l);return s=this.__pivotIsSetFlag&&(this.getIs2D()||o.isPerspective&&p>0)?0!==p?Math.abs(f.sub(c).dot(l))/p:f.sub(c).length():o.isPerspective?.5*(o.near+o.far):o.orthoScale,a.multiplyScalar(s).add(c)},o.prototype.getPivotPlaneDistance=function(){var e=this.getPivotPoint(),t=this.getEyeVector(),n=this.getPosition();return e.sub(n).dot(t.normalize())},o.prototype.panRelative=function(e,t,n){if(this.isActionEnabled("pan")){var i=this.getScreenViewport(),r=this.getCamera(),o=this.getWorldSize(n),a=e*o.x*i.width/r.clientWidth,s=t*o.y*i.height/r.clientHeight,l=this.getCameraRightVector(!1).multiplyScalar(a),c=this.getCameraUpVector().multiplyScalar(s),u=l.add(c);this.applyPanningConstraint2D(u),this.setView(this.getPosition().add(u),this.getTarget().add(u))}},o.prototype.dollyFromPoint=function(e,t,n){if(this.isActionEnabled("zoom")&&!(Math.abs(e)<=this.__kEpsilon)){var i=this.getPosition(),r=this.getEyeVector();if(!this.getCamera().isPerspective){var o=r.lengthSq(),a=r.dot(this.getTarget().sub(t));t=r.clone().multiplyScalar(a/o).add(t)}var s=t.clone().sub(i),l=s.length(),c=l+e;c<this.__minDistance&&(c=this.__minDistance);var u=c/l;if(u=this.applyDollyConstraint(u,n),Math.abs(u-1)>this.__kEpsilon){s.multiplyScalar(u),s.set(-s.x,-s.y,-s.z);var h=s.add(t);r=this.getEyeVector();this.getCamera().isPerspective||r.multiplyScalar(u),this.setView(h,r.add(h))}}},o.prototype.toPerspective=function(){if(this.getIs2D())r.logger.warn("Autodesk.Viewing.Navigation.toPerspective is not applicable to 2D");else{var e=this.getCamera();e.isPerspective||(e.toPerspective(),e.dirty=!0)}},o.prototype.toOrthographic=function(){var e=this.getCamera();e.isPerspective&&(e.toOrthographic(),e.dirty=!0)},o.snapToAxis=function(e){var t=new i.Vector3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));return t.x>t.y&&t.x>t.z?e.set(e.x>0?1:-1,0,0):t.y>t.x&&t.y>t.z?e.set(0,e.y>0?1:-1,0):e.set(0,0,e.z>0?1:-1),e}},function(e,t,n){"use strict";n.r(t),n.d(t,"GestureRecognizers",function(){return o}),n.d(t,"GestureHandler",function(){return a});var i,r=n(3);Object(r.isNodeJS)()||(i=n(90));var o={};function a(e){var t=e.navigation,n=["gestures"],a=this,s=!0,l=!0,c=null,u=!1,h=Object(r.isTouchDevice)();t.setIsTouchDevice(h),h&&((c=new i.Manager(e.canvasWrap,{recognizers:[o.drag,o.doubletap,o.doubletap2,o.singletap,o.singletap2,o.press,o.drag3,o.pan,o.pinch,o.rotate],handlePointerEventMouse:!1,inputClass:r.isIE11?i.PointerEventInput:i.TouchInput})).get("pinch").recognizeWith([c.get("drag")]),e.canvasWrap.addEventListener("touchstart",this.onTouchStart,!1)),this.onTouchStart=function(e){e.preventDefault()},this.getNames=function(){return n},this.getName=function(){return n[0]},this.isActive=function(){return u},this.__clientToCanvasCoords=function(t){var n,i,r=e.impl.getCanvasBoundingClientRect(),o=r.width,a=r.height;t.hasOwnProperty("center")?(n=t.center.x-r.left,i=t.center.y-r.top):(n=t.pointers[0].clientX-r.left,i=t.pointers[0].clientY-r.top),t.canvasX=n,t.canvasY=i,t.normalizedX=n/o*2-1,t.normalizedY=(a-i)/a*2-1},this.distributeGesture=function(e){a.__clientToCanvasCoords(e),a.controller.distributeEvent("handleGesture",e)&&e.preventDefault()},this.onSingleTap=function(e){a.__clientToCanvasCoords(e),a.controller.distributeEvent("handleSingleTap",e)&&e.preventDefault()},this.onDoubleTap=function(e){a.__clientToCanvasCoords(e),a.controller.distributeEvent("handleDoubleTap",e)&&e.preventDefault()},this.onPressHold=function(e){a.__clientToCanvasCoords(e),a.controller.distributeEvent("handlePressHold",e)&&e.preventDefault()},this.onHammerInput=function(e){a.setMouseDisabledWhenTouching(e)},this.setMouseDisabledWhenTouching=function(e){e.isFirst?s=a.controller.enableMouseButtons(!1):e.isFinal&&setTimeout(function(){a.controller.enableMouseButtons(s)},10)},this.activate=function(e){c&&!u&&(c.on("dragstart dragmove dragend",this.distributeGesture),c.on("singletap",this.onSingleTap),c.on("singletap2",this.onSingleTap),c.on("doubletap",this.onDoubleTap),c.on("doubletap2",this.onDoubleTap),c.on("press pressup",this.onPressHold),c.on("drag3start drag3move drag3end",this.distributeGesture),l&&(c.on("panstart panmove panend",this.distributeGesture),c.on("pinchstart pinchmove pinchend",this.distributeGesture),c.on("rotatestart rotatemove rotateend",this.distributeGesture)),c.on("hammer.input",this.onHammerInput),c.get("doubletap2").recognizeWith("doubletap"),c.get("singletap2").recognizeWith("singletap"),c.get("singletap").requireFailure("doubletap")),u=!0},this.deactivate=function(e){c&&u&&(c.off("dragstart dragmove dragend",this.distributeGesture),c.off("singletap",this.onSingleTap),c.off("singletap2",this.onSingleTap),c.off("doubletap",this.onDoubleTap),c.off("doubletap2",this.onDoubleTap),c.off("press pressup",this.onPressHold),c.off("drag3start drag3move drag3end",this.distributeGesture),l&&(c.off("panstart panmove panend",this.distributeGesture),c.off("pinchstart pinchmove pinchend",this.distributeGesture),c.off("rotatestart rotatemove rotateend",this.distributeGesture)),c.off("hammer.input",this.onHammerInput)),u=!1},this.update=function(){return!1},this.handleBlur=function(e){return!1},this.disableTwoFingerSwipe=function(){l=!1,c&&(c.remove(i.Pan),c.remove(i.Pinch),c.remove(i.Rotate),c.off("panstart panmove panend",this.distributeGesture),c.off("pinchstart pinchmove pinchend",this.distributeGesture),c.off("rotatestart rotatemove rotateend",this.distributeGesture))}}i&&function(){if(!o.singletap){var e=o;e.singletap=[i.Tap,{event:"singletap",threshold:7,time:400}],e.singletap2=[i.Tap,{event:"singletap2",pointers:2,threshold:7,time:400}],e.press=[i.Press,{event:"press",time:500,threshold:50}],e.doubletap=[i.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],e.doubletap2=[i.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],e.drag=[i.Pan,{event:"drag",pointers:1}],e.drag3=[i.Pan,{event:"drag3",pointers:3,threshold:15}],e.pan=[i.Pan,{event:"pan",pointers:2,threshold:20}],e.pinch=[i.Pinch,{event:"pinch",pointers:2,enable:!0,threshold:.05}],e.rotate=[i.Rotate,{event:"rotate",pointers:2,enable:!0,threshold:7}]}}()},function(e,t,n){"use strict";n.r(t),n.d(t,"TreeDelegate",function(){return r});var i=n(9);function r(){}r.prototype.constructor=r,r.prototype.isTreeNodeGroup=function(e){throw"isTreeNodeGroup is not implemented."},r.prototype.getTreeNodeId=function(e){throw"getTreeNodeId is not implemented."},r.prototype.getTreeNodeIndex=function(e){throw"getTreeNodeIndex is not implemented."},r.prototype.getTreeNodeParentId=function(e){throw"getTreeNodeParentId is not implemented."},r.prototype.getTreeNodeLabel=function(e){return e.name},r.prototype.getTreeNodeCount=function(){throw"getTreeNodeCount is not implemented."},r.prototype.shouldCreateTreeNode=function(e){return!0},r.prototype.forEachChild=function(e,t){for(var n=e.children?e.children.length:0,i=0;i<n;++i){t(e.children[i])}},r.prototype.createTreeNode=function(e,t,n,r,o){var a=document.createElement("label");t.appendChild(a);var s=this.getTreeNodeLabel(e);return n&&n.localize&&(a.setAttribute("data-i18n",s),s=i.i18n.translate(s)),a.textContent=s,a},r.prototype.onTreeNodeClick=function(e,t,n){},r.prototype.onTreeNodeIconClick=function(e,t,n){e.delegate().isTreeNodeGroup(t)&&e.setCollapsed(t,!e.isCollapsed(t))},r.prototype.onTreeNodeDoubleClick=function(e,t,n){},r.prototype.onTreeNodeRightClick=function(e,t,n){},r.prototype.onTreeNodeReized=function(e){},r.prototype.getTreeNodeClass=function(e){return""},r.prototype.getTreeNodeParentMaxSize=function(e){return{width:0,height:0}},r.prototype.getTreeNodeClientHeight=function(e){return 0},r.prototype.getTreeNodeDepthOffset=function(e,t){return 0},r.prototype.onTreeNodeHover=function(e,t,n){}},function(e,t,n){"use strict";n.r(t),n.d(t,"AlertBox",function(){return r});var i=n(9);function r(){}r.instances=[],r.displayError=function(e,t,n,o,a){var s=document.createElement("div");s.className="alert-box error",e.appendChild(s);var l=o;l||(l="img-item-not-found");var c=document.createElement("div");c.className="alert-box-image "+l,s.appendChild(c);var u=document.createElement("div");u.className="alert-box-msg",s.appendChild(u);var h=n;h||(h=i.i18n.translate("Error Occurred",{defaultValue:"Error Occurred"}));var d=document.createElement("div");d.className="alert-box-title",d.textContent=h,d.setAttribute("data-i18n",h),u.appendChild(d);var f=document.createElement("div");if(f.className="alert-box-text",f.textContent=t,f.setAttribute("data-i18n",t),u.appendChild(f),a){var p=document.createElement("div");p.className="alert-box-content",u.appendChild(p);var m=document.createElement("ul");m.className="alert-box-content";for(var g=0;g<a.length;g++){var v=a[g];if(v){var y=document.createElement("li"),_=this.extractList(v);if(_.list.length){var b=this.generateListElement(list);m.appendChild(b)}y.innerHTML=_.msg,y.setAttribute("data-i18n",_.msg),m.appendChild(y)}}p.appendChild(m)}var x=document.createElement("div");x.className="alert-box-ok",x.textContent=i.i18n.translate("OK",{defaultValue:"OK"});var w={alertBox:s,container:e};x.addEventListener("click",function(t){s.style.visibility="hidden",e.removeChild(s),r.instances.splice(r.instances.indexOf(w),1)}),s.appendChild(x),s.style.visibility="visible",r.instances.push(w)},r.displayErrors=function(e,t,n){var o=document.createElement("div");o.className="alert-box errors",e.appendChild(o);var a=t;a||(a="img-item-not-found");var s=document.createElement("div");s.className="alert-box-image "+a,o.appendChild(s);var l=document.createElement("div");l.className="alert-box-msg errors",o.appendChild(l);for(var c=0;c<n.length;c++){var u=n[c].header;u||(u=i.i18n.translate("Error",{defaultValue:"Error"}));var h=document.createElement("div");h.className="alert-box-title errors",h.textContent=u,l.appendChild(h);var d=document.createElement("div");d.className="alert-box-text errors";var f=n[c].msg;if((b=this.extractList(f)).list.length){var p=document.createElement("div"),m=this.generateListElement(b.list);p.appendChild(m),d.textContent=b.msg,d.appendChild(p)}else d.textContent=f;if(l.appendChild(d),n[c].hints){var g=document.createElement("ul");g.className="alert-box-content";for(var v=n[c].hints,y=0;y<v.length;y++){var _=v[y];if(_){var b,x=document.createElement("li");if(g.appendChild(x),(b=this.extractList(_)).list.length){m=this.generateListElement(b.list);g.appendChild(m)}x.innerHTML=b.msg}}l.appendChild(g)}}var w=document.createElement("div");w.className="alert-box-ok",w.textContent=i.i18n.translate("OK",{defaultValue:"OK"});var A={alertBox:o,container:e};w.addEventListener("click",function(t){o.style.visibility="hidden",e.removeChild(o),r.instances.splice(r.instances.indexOf(A),1)}),o.appendChild(w),o.style.visibility="visible",r.instances.push(A)},r.extractList=function(e){var t={msg:e,list:[]};if(e&&-1!=e.indexOf("<ul>")){var n=e.split("<ul>");t.msg=n[0],n=n[1].split("</ul>"),t.list=n[0].split(", "),1===t.list.length&&(t.list=n[0].split(","))}return t},r.generateListElement=function(e){for(var t=document.createElement("ul"),n=0;n<e.length;n++){var i=document.createElement("li");i.textContent=e[n],i.setAttribute("data-i18n",e[n]),t.appendChild(i)}return t},r.dismiss=function(){if(r.instances.length>0){var e=r.instances.pop();return e.alertBox.style.visibility="hidden",e.container.removeChild(e.alertBox),!0}return!1}},function(e,t,n){"use strict";n.r(t);var i=n(28),r=n(149),o=n(62),a=n(1),s=n(11),l=n(9);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var u=1,h=-1;function d(e,t){o.TreeDelegate.call(this),this.panel=e,this.model=t,this.modelDiv=document.createElement("div"),this.modelDiv.classList.add("model-div"),this.modelDiv.setAttribute("lmv-modelId",t.id),this.instanceTree=null,this.rootId=h,this.state=u}function f(e){var t=e.getData();if(!t)return"";var n=t.urn;try{n=atob(t.urn)}catch(e){}var i=n.lastIndexOf("/");return-1===i?n:(-1!==(i=(n=n.substr(i+1)).indexOf("?"))&&(n=n.substr(0,i)),n)}function p(e){var t=e.getData();return t&&t.loadOptions&&t.loadOptions.modelNameOverride?t.loadOptions.modelNameOverride:""}function m(e,t,n,r){i.DockingPanel.call(this,e,t,n,r),this.container.classList.add("model-structure-panel"),(r=r||{}).heightAdjustment||(r.heightAdjustment=40),r.marginTop||(r.marginTop=0),r.left=!0,this.createScrollContainer(r),this.onScroll=this.onScroll.bind(this),this.scrollContainer.addEventListener("scroll",this.onScroll),this.scrollContainer.style["overflow-x"]="hidden",this.options=r,this.tree=null,this._pendingModels=[],this.uiCreated=!1;var o=this;this.addVisibilityListener(function(e){e&&(o.uiCreated||o.createUI(),o.resizeToContent())})}d.prototype=Object.create(o.TreeDelegate.prototype),d.prototype.constructor=d,d.prototype.isLoading=function(){return this.state===u},d.prototype.isAvailable=function(){return 2===this.state},d.prototype.isNotAvailable=function(){return 3===this.state},d.prototype.isControlId=function(e){return e===h||-2===e},d.prototype.getControlIdCss=function(e){return null},d.prototype.getRootId=function(){return this.rootId},d.prototype.getTreeNodeId=function(e){return"object"==c(e)?(a.logger.warn("Object used instead of dbId. Fix it."),e.dbId):e},d.prototype.getTreeNodeIndex=function(e){return this.instanceTree.nodeAccess.dbIdToIndex[e]},d.prototype.getTreeNodeLabel=function(e){var t;if(e===h)return(t=p(this.model))||(t=f(this.model)),l.i18n.translate("Loading model",{name:t});if(-2===e)return(t=p(this.model))||(t=f(this.model)),t;if(e===this.getRootId()&&(t=p(this.model)))return t;return-1e10==e?"Object 0":this.instanceTree.getNodeName(e)||"Object "+e},d.prototype.getTreeNodeClass=function(e){return e===h||-2===e?"message-unexpected":""},d.prototype.getTreeNodeParentId=function(e){return this.instanceTree.nodeAccess.getParentId(e)},d.prototype.getTreeNodeCount=function(){return this.instanceTree.nodeAccess.getNumNodes()},d.prototype.getTreeNodeClientHeight=function(e){return 36},d.prototype.getTreeNodeDepthOffset=function(e,t){return 13+25*t},d.prototype.isTreeNodeGroup=function(e){return!this.isControlId(e)&&this.instanceTree.getChildCount(e)>0},d.prototype.shouldCreateTreeNode=function(e){return!0},d.prototype.createTreeNode=function(e,t){if(t.addEventListener("mousedown",function(){var e=function(){this.classList.remove("highlight"),document.removeEventListener("mouseup",e)}.bind(t);t.classList.add("highlight"),document.addEventListener("mouseup",e)}),!this.isControlId(e)){var n=document.createElement("div");n.dbId=e,n.classList.add("visibility"),n.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation()}),n.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();var t=parseInt(e.target.dbId);this.panel.onEyeIcon(t,this.model)}.bind(this)),t.appendChild(n)}if(e===h){var i=document.createElement("img");i.src=Object(s.getResourceUrl)("res/ui/spinner.png"),i.style.animation="lmv-spinner-perpetual-motion 1s infinite linear",i.style.float="right",i.style.marginRight="5px",i.style.width="20px",t.appendChild(i)}var r={localize:e===h||-2===e};o.TreeDelegate.prototype.createTreeNode.call(this,e,t,r)},d.prototype.onTreeNodeRightClick=function(e,t,n){this.isControlId(t)||this.panel.onTreeNodeRightClick(e,t,this.model,n)},d.prototype.onTreeNodeClick=function(e,t,n){this.isControlId(t)||this.panel.onTreeNodeClick(e,t,this.model,n)},d.prototype.onTreeNodeDoubleClick=function(e,t,n){},d.prototype.onTreeNodeIconClick=function(e,t,n){if(this.isTreeNodeGroup(t)){var i=e.isCollapsed(this,t);e.setCollapsed(this,t,!i)}},d.prototype.onTreeNodeReized=function(e){},d.prototype.forEachChild=function(e,t,n){this.isControlId(e)||this.instanceTree.enumNodeChildren(e,t,n)},d.prototype.setInstanceTree=function(e){this.instanceTree=e,this.state=e?2:3,this.rootId=e?e.getRootId():-2,function(e){var t=e.instanceTree;if(!t)return;var n,i=e.rootId,r=t.getNodeName(i),o=0,a=0;t.enumNodeChildren(i,function(e){a||(n=t.getNodeName(e),o=e),a++}),e.hasDoubleRoot=1===a&&r===n,e.rootId=e.hasDoubleRoot?o:i}(this)},d.prototype.clean=function(){for(var e,t=this.modelDiv;e=t.lastChild;)t.removeChild(e)},n.d(t,"ModelStructurePanel",function(){return m}),m.prototype=Object.create(i.DockingPanel.prototype),m.prototype.constructor=m,m.prototype.uninitialize=function(e){this.scrollContainer.addEventListener("scroll",this.onScroll),this.scrollContainer.parentNode.removeChild(this.scrollContainer),i.DockingPanel.prototype.uninitialize.call(this)},m.prototype.addModel=function(e){e&&(this.uiCreated?this.createTreeUI(e):this._pendingModels.push(e))},m.prototype.unloadModel=function(e){if(e)if(this.uiCreated)this.removeTreeUI(e);else{var t=this._pendingModels.indexOf(e);if(-1===t)return;this._pendingModels.splice(t,1)}},m.prototype.createUI=function(){if(!this.uiCreated){var e="",t=!0;if(this.options&&this.options.defaultTitle?(e=this.options.defaultTitle,t=!!this.options.localizeTitle):(e=this.modelTitle,t=!1),e||(e="Browser"),this.setTitle(e,{localizeTitle:t}),this.uiCreated=!0,this.tree=new r.TreeOnDemand(this.scrollContainer,this.options),0!==this._pendingModels.length){for(var n=0;n<this._pendingModels.length;++n)this.createTreeUI(this._pendingModels[n]);this._pendingModels=[]}}},m.prototype.createTreeUI=function(e){var t=new d(this,e);this.tree.pushDelegate(t);var n=this;e.getObjectTree(function(e){n.setInstanceTree(t,e)},function(){n.setInstanceTree(t,null)})},m.prototype.setInstanceTree=function(e,t){this.tree.setInstanceTree(e,t)},m.prototype.removeTreeUI=function(e){this.tree.removeDelegate(e.id),this.scrollContainer.scrollTop=0,this.onScroll()},m.prototype.onScroll=function(e){this.tree.setScroll(this.scrollContainer.scrollTop)},m.prototype.getNodeLabel=function(e){return this.myDelegate.getNodeLabel(e)},m.prototype.onTreeNodeClick=function(e,t,n,i){throw new Error("Method must be overriden.")},m.prototype.onTreeNodeRightClick=function(e,t,n,i){throw new Error("Method must be overriden.")},m.prototype.onTitleClick=function(e){},m.prototype.onTitleDoubleClick=function(e){}},function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){var t,n,i,r,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,r),r+=o.length;return a}},a={arraySet:function(e,t,n,i,r){for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,o)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(i)},function(e,t,n){"use strict";n.r(t),n.d(t,"MESH_RECEIVE_EVENT",function(){return f}),n.d(t,"MESH_FAILED_EVENT",function(){return p}),n.d(t,"OtgGeomCache",function(){return E});var i=n(27),r=n(3),o=n(51),a=n(24),s=n(4),l=n(32),c=n(2),u=n(10),h=n(37),d=n(11),f="meshReceived",p="meshFailed";var m=Object(d.getParameterByName)("disableIndexedDb")||Object(r.getGlobal)().DISABLE_INDEXED_DB,g=Object(d.getParameterByName)("disableWebSocket")||Object(r.getGlobal)().DISABLE_WEBSOCKET;function v(e){var t=Object(s.initLoadContext)(e);return t.disableIndexedDb=m,t.disableWebSocket=g,t}var y,_=(y=null,function(e,t,n){return y||(y=new u.LmvVector3),y.copy(e),y.max(t),y.min(n),y.distanceToSquared(e)});function b(e,t){return e.importance-t.importance}function x(e,t){return t.importance-e.importance}var w,A=(w=null,function(e,t,n){w||(w=new h.LmvBox3);var r=function(e,t,n){var i=6*t;return n.min.y=e[i+1],n.min.z=e[i+2],n.min.x=e[i+0],n.max.x=e[i+3],n.max.y=e[i+4],n.max.z=e[i+5],n}(t,e,w),o=n.intersectsBox(r);if(o===i.OUTSIDE)return 0;var a=o===i.CONTAINS,s=n.projectedBoxArea(r,a),l=_(n.eye,r.min,r.max);return s/(l=Math.max(l,.01))});function E(e){for(var t,n=new Map,i={},s=Object(r.isMobileDevice)()?2:8,l=[],d=0;d<s;d++)l.push(Object(a.createWorkerWithIntercept)());this.byteSize=0;var m,g,y=0,_=100,w=void 0,E=[],T={},M=0,S=!1,C=this,P=0,L=e,R=!1,D=new u.LmvVector3,I=new u.LmvVector3,O=[];function N(){R=!1}function k(e){if(e.data){if(e.data.error){var t=e.data.error;(l=t.args?t.args.hash:void 0)&&(n.set(l,t),C.fireEvent({type:p,error:t}),console.warn("Error loading mesh",l)),delete i[t.hash],y--}else for(var r=e.data,a=0;a<r.length;a++){var s=r[a];if(s.hash&&s.mesh){o.BufferGeometryUtils.meshToGeometry(s);var l=s.hash,c=s.geometry;n.set(l,c),C.byteSize+=c.byteSize,C.cleanup(),C.fireEvent({type:f,geom:c}),delete i[s.hash]}y--}E.length&&!w&&(w=setTimeout(F,0))}}L.addEventListener(c.MODEL_UNLOADED_EVENT,N),this.dtor=function(){L.removeEventListener(c.MODEL_UNLOADED_EVENT,N),L=null};for(d=0;d<s;d++)l[d].addEventListenerWithIntercept(k);function V(e){if(!t||!t.length||!e)return 0|Math.random()*s;var n,i=0,r=t.length-1;do{var o=0|(i+r)/2;if((n=t[o]).geomStart>e)r=o-1;else{if(!(n.geomEnd<=e))break;i=o+1}}while(i<=r);return n.geomStart<=e&&n.geomEnd>e?n.workerId:(console.error("Range not found",e),-1)}function F(){var e=_*s-y;if(0!==e){C.updateRequestPriorities()||(e=Math.min(e,10*s));for(var t=[],n=0,i=0;i<E.length&&n<e;){var r=E[i++],o=V(r.geomIdx);(c=t[o])?(c.urls.push(r.url),c.hashes.push(r.hash),c.geomIds.push(r.geomIdx),c.sampleWorldMatrices.push(r.sampleWorldMatrix)):(c={operation:"LOAD_GEOMETRY_OTG",urls:[r.url],isCDN:r.isCDN,hashes:[r.hash],geomIds:[r.geomIdx],sampleWorldMatrices:[r.sampleWorldMatrix],queryParams:r.queryParams},t[o]=c),n++}E.splice(0,i);for(var a=0;a<t.length;a++){var c;(c=t[a])&&(l[a].doOperation(v(c)),y+=c.urls.length)}w=void 0}else w=setTimeout(F,30)}function B(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n}function U(){var e,t,n=L.impl.camera,i=n.position,r=n.target,o=(t=r,!(B(D,e=i,.01)&&B(I,t,.01)||(D.copy(e),I.copy(t),0))),a=function(){var e=L.impl.modelQueue().getModels(),t=!1;e.length!=O.length&&(O.length=e.length,t=!0);for(var n=0;n<e.length;n++){var i=O[n],r=e[n].id;i!==r&&(O[n]=r,t=!0)}return t}();if(o||a)for(var s=0;s<E.length;s++)E[s].importanceNeedsUpdate=!0}this.initWorker=function(e){for(var t=0;t<s;t++){var n={operation:"INIT_WORKER_OTG",workerId:t,authorizeUrns:[e]};l[t].doOperation(v(n))}},this.updateMruTimestamps=function(){for(var e=0;e<s;e++){var t={operation:"UPDATE_MRU_TIMESTAMPS_OTG",workerId:e};l[e].doOperation(v(t))}},this.requestGeometry=function(e,t,r,o,a,s){var l=n.get(r);if(l&&l.args)this.fireEvent({type:p,error:l,repeated:!0});else if(l)this.fireEvent({type:f,geom:l});else{var c=i[r];if(c&&c.refcount)return c.importanceNeedsUpdate=!0,void c.refcount++;var u=null;s&&(u=Array.from(s.elements));var h={operation:"LOAD_GEOMETRY_OTG",url:e,isCDN:t,hash:r,geomIdx:o,queryParams:a,importance:0,sampleWorldMatrix:u,importanceNeedsUpdate:!0,refcount:1};E.push(h),i[r]=h,w||(w=setTimeout(F,0))}},this.cancelRequests=function(e){for(var t in e){var n=i[t];n&&n.refcount--}for(var r=[],o=0;o<E.length;o++){var a=E[o];i[a.hash].refcount?r.push(a):delete i[a.hash]}E=r},this.updateGeomImportance=(m=new h.LmvBox3,function(e,t){var n=e.getFragmentList(),i=n.getGeometry(t);if(n.getWorldBounds(t,m),i){var r,o,a,s,l=i.importance||0,c=(o=(r=m).max.x-r.min.x,a=r.max.y-r.min.y,s=r.max.z-r.min.z,2*(o*a+a*s+s*o));i.importance=Math.max(l,c)}}),this.cleanup=(g=[],function(){if(!(this.byteSize<104857600)){var e=L.impl.modelQueue().getModels().concat(L.getHiddenModels());if(!R){P++;for(var t=0;t<e.length;t++){var i=e[t],r=i.getData();if(i.isOTG()){var o=r.geomMetadata.hashes;if(o)for(var a=o.length/r.geomMetadata.byteStride,s=1;s<a;s++){var l=r.getGeometryHash(s);(c=n.get(l))&&(c.timeStamp=P)}}}for(var l in g.length>0&&console.warn("OtgGeomCache.cleanup(): array must be empty"),n)(c=n.get(l)).timeStamp!==P&&g.push(c);for(g.sort(b),t=0;t<g.length&&this.byteSize>=52428800;t++){var c=g[t];n.delete(c.hash),this.byteSize-=c.byteSize,c.dispose()}t===g.length&&(R=!0),g.length=0}}}),this.updateRequestPriorities=function(){var e=performance.now();U();var t=L.impl.modelQueue(),n=t.frustum(),i=t.getModels();n.reset(L.impl.camera);var r=!1,o=0===M||E.length-M>3e3||!S;S=!o,M=E.length;for(var a=0;a<E.length;a++){var s=E[a];if(s.importanceNeedsUpdate)if(T[s.hash])s.importance=1/0;else{if(a%10==0)if(performance.now()-e>10){r=!0;break}s.importanceNeedsUpdate=!1,s.importance=0;for(var l=0,c=s.hash,u=0;u<i.length;u++){var h=i[u];if(h.isOTG()){var d=h.myData,f=d.fragments,p=f.boxes,m=d.geomMetadata.hashToIndex[c];if(m&&f.mesh2frag){var g=f.mesh2frag[m];if("number"==typeof g)l+=A(g,p,n);else if(Array.isArray(g))for(var v=0;v<g.length;v++){var y=g[v];l+=A(y,p,n)}}}}if(s.importance=l,!o){for(u=a;u>0&&l>E[u-1].importance;)E[u]=E[u-1],u--;E[u]=s}}}return o&&!r&&(E.sort(x),S=!0),!r},this.waitForGeometry=function(e,t){var i=0,r=0;for(var o in e)!0===e[o]&&(T[o]=!0,r++);if(0===r&&e)t(e);else{for(var a=0;a<E.length;a++){var s=E[a];T[s.hash]&&(s.importance=1/0)}for(o in E.sort(x),F(),this.addEventListener(f,u),this.addEventListener(p,h),e){var l=n.get(o);l&&c(o,l)}}function c(n,o){delete T[n],!0!=!e[n]&&(e[n]=o,++i<r||(C.removeEventListener(f,u),C.removeEventListener(p,h),t(e)))}function u(e){c(e.geom.hash,e.geom)}function h(e){c(e.error.args.hash,void 0)}},this.getGeometry=function(e){return n.get(e)}}l.EventDispatcher.prototype.apply(E.prototype)},function(e,t,n){"use strict";n.r(t),n.d(t,"ErrorHandler",function(){return c});var i=n(63),r=n(1),o=n(9),a=n(48);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var l={1:{img:"img-reload","globalized-msg":"Viewer-UnknownFailure","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint>Try loading the item again. </hint><hint>Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},2:{img:"img-unsupported","globalized-msg":"Viewer-BadData","default-msg":"<title> Sorry </title><message>The item you are trying to view was not processed completely. </message><hint>Try loading the item again.</hint><hint>Please upload the file again to see if that fixes the issue.</hint>"},3:{img:"img-reload","globalized-msg":"Viewer-NetworkError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},4:{img:"img-unloack","globalized-msg":"Viewer-AccessDenied","default-msg":"<title> No access </title><message>Sorry. You donâ€™t have the required privileges to access this item.</message><hint> Please contact the author</hint>"},5:{img:"img-item-not-found","globalized-msg":"Viewer-FileNotFound","default-msg":'<title> Sorry </title><message>We canâ€™t display the item you are looking for. It may not have been processed yet. It may have been moved, deleted, or you may be using a corrupt file or unsupported file format.</message><hint> Try loading the item again.</hint><hint> Please upload the file again to see if that fixes the issue.</hint><hint> <a href="http://help.autodesk.com/view/ADSK360/ENU/?guid=GUID-488804D0-B0B0-4413-8741-4F5EE0FACC4A" target="_blank">See a list of supported formats.</a></hint>'},6:{img:"img-reload","globalized-msg":"Viewer-ServerError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},7:{img:"img-reload","globalized-msg":"Viewer-UnhandledResponseCode","default-msg":"<title> Network problem </title><message>Sorry. We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},8:{img:"img-unsupported","globalized-msg":"Viewer-WebGlNotSupported","default-msg":'<title>Sorry</title><message>We can\'t show this item because this browser doesn\'t support WebGL.</message><hint>Try Google Chrome, Mozilla Firefox, or another browser that supports WebGL 3D graphics.</hint><hint>For more information, see the <a href="WEBGL_HELP" target="_blank">A360 browser reqirements.</a></hint>'},9:{img:"img-item-not-found","globalized-msg":"Viewer-NoViewable","default-msg":"<title> No viewable content </title><message>Thereâ€™s nothing to display for this item. It may not have been processed or it may not have content we can display.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},10:{img:"img-unsupported","globalized-msg":"Viewer-WebGlDisabled","default-msg":'<title>Sorry</title><message>We can\'t show this item because WebGL is disabled on this device.</message><hint> For more information see the <a href="WEBGL_HELP" target="_blank">A360 Help.</a></hint>'},11:{img:"img-item-not-found","globalized-msg":"Viewer-ModeIsEmpty","default-msg":"<title>Model is empty</title><message>Model is empty, there is no geometry for the viewer to show.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},12:{img:"img-unsupported","globalized-msg":"Viewer-RTCError","default-msg":"<title> Sorry </title><message>We couldnâ€™t connect to the Collaboration server.</message><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},13:{img:"img-unsupported","globalized-msg":"Viewer-FileExtNotSupported","default-msg":{title:"Sorry",message:"The file extension loaded into the Viewer is not supported",hints:["Try a different file"]}},15:{img:"img-unsupported","globalized-msg":"Viewer-WebGlContextLost","default-msg":{title:"WebGL context lost",message:"Unable to recover from software mode.  Please restart your browser and reload the Viewer",hints:["If you continue to encounter this issue when viewing this model, we recommend switching to a different browser."]}}};function c(){}c.prototype.constructor=c,c.reportError=function(e,t,n,s,u,h){if(c.currentError=null,c.currentErrors=null,t){var d={category:"error",code:t,message:n,httpStatusCode:s,httpStatusText:u};r.logger.track(d,!0),c.currentError=[e,t,n,h];var f=l[t];if(f){(_={defaultValue:""}).defaultValue=f["default-msg"];var p=f.img,m=f["globalized-msg"],g=this.parseErrorString(m,_);if(t===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_DISABLED||t===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)for(var v=Object(a.getWebGLHelpLink)()||"http://www.autodesk.com/a360-browsers",y=0;y<g.hints.length;y++){-1!==g.hints[y].indexOf('href="WEBGL_HELP"')&&(g.hints[y]=g.hints[y].replace('href="WEBGL_HELP"','href="'+v+'"'))}i.AlertBox.displayError(e,g.msg,g.header,p,g.hints)}else{p="img-unsupported";var _={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"};this.parseArguments(n,_),(g=this.parseErrorString(t,_)).header||(g.header="warning"===h?o.i18n.translate("header-warning"):""),i.AlertBox.displayError(e,g.msg,g.header,p,g.hints)}}},c.reportErrors=function(e,t){if(c.currentError=null,c.currentErrors=null,t){c.currentErrors=[e,t];for(var n={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},a=[],s=0;s<t.length;s++)if(t[s].code){this.parseArguments(t[s].message,n);var l=this.parseErrorString(t[s].code,n);l.header||(l.header="warning"===t[0].type?o.i18n.translate("header-warning",{defaultValue:"Warning"}):""),a.push(l);var u={category:"error",code:t[s].code,message:t[s].message};r.logger.track(u,!0)}if(a.length){i.AlertBox.displayErrors(e,"img-unsupported",a)}}},c.parseArguments=function(e,t){if(e)if("string"==typeof e)t.defaultValue=e;else{t.defaultValue=e[0];for(var n=1;n<e.length;n++){t[(n-1).toString()]=e[n]}}},c.parseErrorString=function(e,t){var n={msg:null,msgList:null,header:null,hints:null};if(!e)return n;if("object"===s(t.defaultValue)){var i=t.defaultValue;return n.header=i.title,n.msg=i.message,n.hints=i.hints.concat(),n}var r=o.i18n.translate(e,t);if(!r)return n;if(-1!=r.indexOf("<title>")){var a=r.split("<title>")[1].split("</title>");n.header=a[0],r=a[1]}if(r&&-1!=r.indexOf("<message>")){a=r.split("<message>")[1].split("</message>");n.msg=a[0],r=a[1]}else n.msg=r;if(r&&-1!=r.indexOf("<hint>")){n.hints=[];for(var l=r.split("<hint>"),c=0;c<l.length;c++){var u=l[c].split("</hint")[0];n.hints.push(u)}}return n},c.localize=function(){if(i.AlertBox.instances.length>0)if(i.AlertBox.dismiss(),c.currentError){var e=c.currentError.shift(),t=c.currentError;c.reportError(e,t[0],t[1],t[2])}else{e=c.currentErrors.shift();var n=c.currentErrors[0];c.reportErrors(e,n)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"extendLocalization",function(){return s}),n.d(t,"setLanguage",function(){return l}),n.d(t,"initializeLocalization",function(){return c});var i=n(3),r=n(9),o=n(93);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var s=function(e){return null!==e&&"object"===a(e)&&(Object.keys(e).forEach(function(t){r.i18n.addResourceBundle(t,"allstrings",e[t],!0,!0)}),!0)},l=function(e,t){var n={lng:e,resGetPath:"res/locales/__lng__/__ns__.json",ns:{namespaces:["allstrings"],defaultNs:"allstrings"},fallbackLng:"en",debug:!1};Object(i.getGlobal)().LOCALIZATION_REL_PATH="res/locales/"+e+"/",r.i18n.init(n,function(e){r.i18n.clearDebugLocString(),t&&t()})},c=function(e){var t=e&&e.language||navigator.language,n=o.Lang.getSupported(t);l(n)}},function(e,t,n){"use strict";n.r(t),n.d(t,"GetPrismMapUniforms",function(){return u}),n.d(t,"PrismShader",function(){return d}),n.d(t,"createPrismMaterial",function(){return f}),n.d(t,"clonePrismMaterial",function(){return p});var i=n(0),r=n(15),o=n(22),a=n(213),s=n.n(a),l=n(214),c=n.n(l);function u(e){var t=e+"_texMatrix",n=e+"_invert",r={};return r[e]={type:"t",value:null},r[t]={type:"m3",value:new i.Matrix3},r[n]={type:"i",value:0},r}function h(e){var t=e+"_texMatrix",n=e+"_bumpScale",r=e+"_bumpmapType",o={};return o[e]={type:"t",value:null},o[t]={type:"m3",value:new i.Matrix3},o[n]={type:"v2",value:new i.Vector2(1,1)},o[r]={type:"i",value:0},o}var d={uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.lights,i.UniformsLib.fog,r.ShaderChunks.CutPlanesUniforms,r.ShaderChunks.IdUniforms,r.ShaderChunks.ThemingUniform,r.ShaderChunks.ShadowMapUniforms,u("surface_albedo_map"),u("surface_roughness_map"),u("surface_cutout_map"),u("surface_anisotropy_map"),u("surface_rotation_map"),u("opaque_albedo_map"),u("opaque_f0_map"),u("opaque_luminance_modifier_map"),u("layered_bottom_f0_map"),u("layered_f0_map"),u("layered_diffuse_map"),u("layered_fraction_map"),u("layered_roughness_map"),u("layered_anisotropy_map"),u("layered_rotation_map"),u("metal_f0_map"),u("wood_curly_distortion_map"),u("glazing_f0_map"),u("glazing_transmission_color_map"),u("glazing_transmission_roughness_map"),h("surface_normal_map"),h("layered_normal_map"),u("TilingMap"),u("TilingNormalMap"),u("TilingRandomMap"),{surface_albedo:{type:"c",value:new i.Color(1118481)},surface_roughness:{type:"f",value:1},surface_anisotropy:{type:"f",value:1},surface_rotation:{type:"f",value:1},opaque_albedo:{type:"c",value:new i.Color(1118481)},opaque_f0:{type:"f",value:1},opaque_luminance_modifier:{type:"c",value:new i.Color(1118481)},opaque_luminance:{type:"f",value:1},metal_f0:{type:"c",value:new i.Color(1118481)},layered_f0:{type:"f",value:1},layered_diffuse:{type:"c",value:new i.Color(0)},layered_fraction:{type:"f",value:1},layered_bottom_f0:{type:"c",value:new i.Color(1118481)},layered_roughness:{type:"f",value:1},layered_anisotropy:{type:"f",value:1},layered_rotation:{type:"f",value:1},transparent_ior:{type:"f",value:2},transparent_color:{type:"c",value:new i.Color(1118481)},transparent_distance:{type:"f",value:1},glazing_f0:{type:"c",value:new i.Color(16777215)},glazing_transmission_roughness:{type:"f",value:0},glazing_transmission_color:{type:"c",value:new i.Color(16777215)},wood_fiber_cosine_enable:{type:"i",value:1},wood_fiber_cosine_bands:{type:"i",value:2},wood_fiber_cosine_weights:{type:"v4",value:new i.Vector4(2.5,.5,1,1)},wood_fiber_cosine_frequencies:{type:"v4",value:new i.Vector4(15,4,1,1)},wood_fiber_perlin_enable:{type:"i",value:1},wood_fiber_perlin_bands:{type:"i",value:3},wood_fiber_perlin_weights:{type:"v4",value:new i.Vector4(3,1,.2,1)},wood_fiber_perlin_frequencies:{type:"v4",value:new i.Vector4(40,20,3.5,1)},wood_fiber_perlin_scale_z:{type:"f",value:.3},wood_growth_perlin_enable:{type:"i",value:1},wood_growth_perlin_bands:{type:"i",value:3},wood_growth_perlin_weights:{type:"v4",value:new i.Vector4(1,2,1,1)},wood_growth_perlin_frequencies:{type:"v4",value:new i.Vector4(1,5,13,1)},wood_latewood_ratio:{type:"f",value:.238},wood_earlywood_sharpness:{type:"f",value:.395},wood_latewood_sharpness:{type:"f",value:.109},wood_ring_thickness:{type:"f",value:.75},wood_earlycolor_perlin_enable:{type:"i",value:1},wood_earlycolor_perlin_bands:{type:"i",value:2},wood_earlycolor_perlin_weights:{type:"v4",value:new i.Vector4(.3,.5,.15,1)},wood_earlycolor_perlin_frequencies:{type:"v4",value:new i.Vector4(8,3,.35,1)},wood_early_color:{type:"c",value:new i.Color(.286,.157,.076)},wood_use_manual_late_color:{type:"i",value:0},wood_manual_late_color:{type:"c",value:new i.Color(.62,.35,.127)},wood_latecolor_perlin_enable:{type:"i",value:1},wood_latecolor_perlin_bands:{type:"i",value:1},wood_latecolor_perlin_weights:{type:"v4",value:new i.Vector4(.75,.55,1,1)},wood_latecolor_perlin_frequencies:{type:"v4",value:new i.Vector4(4.5,.05,1,1)},wood_late_color_power:{type:"f",value:1.25},wood_diffuse_perlin_enable:{type:"i",value:1},wood_diffuse_perlin_bands:{type:"i",value:3},wood_diffuse_perlin_weights:{type:"v4",value:new i.Vector4(.15,.2,.05,1)},wood_diffuse_perlin_frequencies:{type:"v4",value:new i.Vector4(.05,.1,3,1)},wood_diffuse_perlin_scale_z:{type:"f",value:.2},wood_use_pores:{type:"i",value:1},wood_pore_type:{type:"i",value:0},wood_pore_radius:{type:"f",value:.04},wood_pore_cell_dim:{type:"f",value:.15},wood_pore_color_power:{type:"f",value:1.45},wood_pore_depth:{type:"f",value:.02},wood_use_rays:{type:"i",value:1},wood_ray_color_power:{type:"f",value:1.1},wood_ray_seg_length_z:{type:"f",value:5},wood_ray_num_slices:{type:"f",value:160},wood_ray_ellipse_z2x:{type:"f",value:10},wood_ray_ellipse_radius_x:{type:"f",value:.2},wood_use_latewood_bump:{type:"i",value:1},wood_latewood_bump_depth:{type:"f",value:.01},wood_use_groove_roughness:{type:"i",value:1},wood_groove_roughness:{type:"f",value:.85},wood_diffuse_lobe_weight:{type:"f",value:.9},wood_curly_distortion_enable:{type:"i",value:0},wood_curly_distortion_scale:{type:"f",value:.25},wood_ring_fraction:{type:"v4",value:new i.Vector4(0,0,0,0)},wood_fall_rise:{type:"v2",value:new i.Vector2(0,0)},permutationMap:{type:"t",value:null},gradientMap:{type:"t",value:null},perm2DMap:{type:"t",value:null},permGradMap:{type:"t",value:null},importantSamplingRandomMap:{type:"t",value:null},importantSamplingSolidAngleMap:{type:"t",value:null},irradianceMap:{type:"t",value:null},envMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1},envExponentMin:{type:"f",value:1},envExponentMax:{type:"f",value:512},envExponentCount:{type:"f",value:10},tilingOverallTransform:{type:"m4",value:new i.Matrix4},uv2tile:{type:"v4",value:new i.Vector4(1,0,0,1)},tile2uv:{type:"v4",value:new i.Vector4(1,0,0,1)},tileAlignOffset:{type:"v2",value:new i.Vector2(0,0)},tilingUVTransform:{type:"m4",value:new i.Matrix4},tilingRandomAxisS:{type:"v2",value:new i.Vector2(0,0)},tilingRandomAxisT:{type:"v2",value:new i.Vector2(0,0)},tilingRandomAlignmentOffset:{type:"v2",value:new i.Vector2(0,0)}}]),vertexShader:s.a,fragmentShader:c.a};i.ShaderLib.prism=d;var f=function(){var e=Object(o.createShaderMaterial)(d);return e.defaultAttributeValues.uvw=[0,0,0],e.enable3DWoodBump=!1,e.enableImportantSampling=!1,e.mapList={},e.isPrismMaterial=!0,e},p=function(e){var t=f();switch(t.name=e.name,t.side=e.side,t.opacity=e.opacity,t.transparent=e.transparent,t.blending=e.blending,t.blendSrc=e.blendSrc,t.blendDst=e.blendDst,t.blendEquation=e.blendEquation,t.blendSrcAlpha=e.blendSrcAlpha,t.blendDstAlpha=e.blendDstAlpha,t.blendEquationAlpha=e.blendEquationAlpha,t.depthTest=e.depthTest,t.depthWrite=e.depthWrite,t.polygonOffset=e.polygonOffset,t.polygonOffsetFactor=e.polygonOffsetFactor,t.polygonOffsetUnits=e.polygonOffsetUnits,t.alphaTest=e.alphaTest,t.overdraw=e.overdraw,t.visible=e.visible,t.mapList=e.mapList,t.prismType=e.prismType,t.surface_albedo=e.surface_albedo,void 0!==e.surface_albedo_map&&(t.surface_albedo_map=e.surface_albedo_map),t.surface_roughness=e.surface_roughness,void 0!==e.surface_roughness_map&&(t.surface_roughness_map=e.surface_roughness_map),t.surface_anisotropy=e.surface_anisotropy,void 0!==e.surface_anisotropy_map&&(t.surface_anisotropy_map=e.surface_anisotropy_map),t.surface_rotation=e.surface_rotation,void 0!==e.surface_rotation_map&&(t.surface_rotation_map=e.surface_rotation_map),void 0!==e.surface_cutout_map&&(t.surface_cutout_map=e.surface_cutout_map),void 0!==e.surface_normal_map&&(t.surface_normal_map=e.surface_normal_map),t.uniforms.importantSamplingRandomMap.value=e.uniforms.importantSamplingRandomMap.value,t.uniforms.importantSamplingSolidAngleMap.value=e.uniforms.importantSamplingSolidAngleMap.value,t.prismType){case"PrismOpaque":t.opaque_albedo=(new i.Color).copy(e.opaque_albedo),t.opaque_luminance_modifier=(new i.Color).copy(e.opaque_luminance_modifier),t.opaque_f0=e.opaque_f0,t.opaque_luminance=e.opaque_luminance,void 0!==e.opaque_albedo_map&&(t.opaque_albedo_map=e.opaque_albedo_map),void 0!==e.opaque_luminance_modifier_map&&(t.opaque_luminance_modifier_map=e.opaque_luminance_modifier_map),void 0!==e.opaque_f0_map&&(t.opaque_f0_map=e.opaque_f0_map);break;case"PrismMetal":t.metal_f0=(new i.Color).copy(e.metal_f0),void 0!==e.metal_f0_map&&(t.metal_f0_map=e.metal_f0_map);break;case"PrismLayered":t.layered_f0=e.layered_f0,t.layered_diffuse=(new i.Color).copy(e.layered_diffuse),t.layered_fraction=e.layered_fraction,t.layered_bottom_f0=(new i.Color).copy(e.layered_bottom_f0),t.layered_roughness=e.layered_roughness,t.layered_anisotropy=e.layered_anisotropy,t.layered_rotation=e.layered_rotation,void 0!==e.layered_bottom_f0_map&&(t.layered_bottom_f0_map=e.layered_bottom_f0_map),void 0!==e.layered_f0_map&&(t.layered_f0_map=e.layered_f0_map),void 0!==e.layered_diffuse_map&&(t.layered_diffuse_map=e.layered_diffuse_map),void 0!==e.layered_fraction_map&&(t.layered_fraction_map=e.layered_fraction_map),void 0!==e.layered_rotationlayered_roughness_map&&(t.layered_rotationlayered_roughness_map=e.layered_rotationlayered_roughness_map),void 0!==e.layered_anisotropy_map&&(t.layered_anisotropy_map=e.layered_anisotropy_map),void 0!==e.layered_rotation_map&&(t.layered_rotation_map=e.layered_rotation_map),void 0!==e.layered_normal_map&&(t.layered_normal_map=e.layered_normal_map);break;case"PrismTransparent":t.transparent_color=(new i.Color).copy(e.transparent_color),t.transparent_distance=e.transparent_distance,t.transparent_ior=e.transparent_ior,t.transparent=e.transparent,t.twoPassTransparency=e.twoPassTransparency;break;case"PrismGlazing":t.glazing_f0=(new i.Color).copy(e.glazing_f0),t.glazing_transmission_color=(new i.Color).copy(e.glazing_transmission_color),t.glazing_transmission_roughness=e.glazing_transmission_roughness,void 0!==e.glazing_f0_map&&(t.glazing_f0_map=e.glazing_f0_map),void 0!==e.glazing_transmission_color_map&&(t.glazing_transmission_color_map=e.glazing_transmission_color_map),void 0!==e.glazing_transmission_roughness_map&&(t.glazing_transmission_roughness_map=e.glazing_transmission_roughness_map);break;case"PrismWood":t.wood_fiber_cosine_enable=e.wood_fiber_cosine_enable,t.wood_fiber_cosine_bands=e.wood_fiber_cosine_bands,t.wood_fiber_cosine_weights=(new i.Vector4).copy(e.wood_fiber_cosine_weights),t.wood_fiber_cosine_frequencies=(new i.Vector4).copy(e.wood_fiber_cosine_frequencies),t.wood_fiber_perlin_enable=e.wood_fiber_perlin_enable,t.wood_fiber_perlin_bands=e.wood_fiber_perlin_bands,t.wood_fiber_perlin_weights=(new i.Vector4).copy(e.wood_fiber_perlin_weights),t.wood_fiber_perlin_frequencies=(new i.Vector4).copy(e.wood_fiber_perlin_frequencies),t.wood_fiber_perlin_scale_z=e.wood_fiber_perlin_scale_z,t.wood_growth_perlin_enable=e.wood_growth_perlin_enable,t.wood_growth_perlin_bands=e.wood_growth_perlin_bands,t.wood_growth_perlin_weights=(new i.Vector4).copy(e.wood_growth_perlin_weights),t.wood_growth_perlin_frequencies=(new i.Vector4).copy(e.wood_growth_perlin_frequencies),t.wood_latewood_ratio=e.wood_latewood_ratio,t.wood_earlywood_sharpness=e.wood_earlywood_sharpness,t.wood_latewood_sharpness=e.wood_latewood_sharpness,t.wood_ring_thickness=e.wood_ring_thickness,t.wood_earlycolor_perlin_enable=e.wood_earlycolor_perlin_enable,t.wood_earlycolor_perlin_bands=e.wood_earlycolor_perlin_bands,t.wood_earlycolor_perlin_weights=(new i.Vector4).copy(e.wood_earlycolor_perlin_weights),t.wood_earlycolor_perlin_frequencies=(new i.Vector4).copy(e.wood_earlycolor_perlin_frequencies),t.wood_early_color=(new i.Color).copy(e.wood_early_color),t.wood_use_manual_late_color=e.wood_use_manual_late_color,t.wood_manual_late_color=(new i.Color).copy(e.wood_manual_late_color),t.wood_latecolor_perlin_enable=e.wood_latecolor_perlin_enable,t.wood_latecolor_perlin_bands=e.wood_latecolor_perlin_bands,t.wood_latecolor_perlin_weights=(new i.Vector4).copy(e.wood_latecolor_perlin_weights),t.wood_latecolor_perlin_frequencies=(new i.Vector4).copy(e.wood_latecolor_perlin_frequencies),t.wood_late_color_power=e.wood_late_color_power,t.wood_diffuse_perlin_enable=e.wood_diffuse_perlin_enable,t.wood_diffuse_perlin_bands=e.wood_diffuse_perlin_bands,t.wood_diffuse_perlin_weights=(new i.Vector4).copy(e.wood_diffuse_perlin_weights),t.wood_diffuse_perlin_frequencies=(new i.Vector4).copy(e.wood_diffuse_perlin_frequencies),t.wood_diffuse_perlin_scale_z=e.wood_diffuse_perlin_scale_z,t.wood_use_pores=e.wood_use_pores,t.wood_pore_type=e.wood_pore_type,t.wood_pore_radius=e.wood_pore_radius,t.wood_pore_cell_dim=e.wood_pore_cell_dim,t.wood_pore_color_power=e.wood_pore_color_power,t.wood_pore_depth=e.wood_pore_depth,t.wood_use_rays=e.wood_use_rays,t.wood_ray_color_power=e.wood_ray_color_power,t.wood_ray_seg_length_z=e.wood_ray_seg_length_z,t.wood_ray_num_slices=e.wood_ray_num_slices,t.wood_ray_ellipse_z2x=e.wood_ray_ellipse_z2x,t.wood_ray_ellipse_radius_x=e.wood_ray_ellipse_radius_x,t.wood_use_latewood_bump=e.wood_use_latewood_bump,t.wood_latewood_bump_depth=e.wood_latewood_bump_depth,t.wood_use_groove_roughness=e.wood_use_groove_roughness,t.wood_groove_roughness=e.wood_groove_roughness,t.wood_diffuse_lobe_weight=e.wood_diffuse_lobe_weight,t.uniforms.permutationMap.value=e.uniforms.permutationMap.value,t.uniforms.gradientMap.value=e.uniforms.gradientMap.value,t.uniforms.perm2DMap.value=e.uniforms.perm2DMap.value,t.uniforms.permGradMap.value=e.uniforms.permGradMap.value,void 0!==e.wood_curly_distortion_map&&(t.wood_curly_distortion_map=e.wood_curly_distortion_map,t.wood_curly_distortion_enable=e.wood_curly_distortion_enable,t.wood_curly_distortion_scale=e.wood_curly_distortion_scale),t.wood_ring_fraction=e.wood_ring_fraction,t.wood_fall_rise=e.wood_fall_rise;break;default:i.warn("Unknown prism type: "+e.prismType)}return t.envExponentMin=e.envExponentMin,t.envExponentMax=e.envExponentMax,t.envExponentCount=e.envExponentCount,t.envMap=e.envMap,e.useTiling&&(t.useTiling=e.useTiling,t.tilingOverallTransform=(new i.Matrix4).copy(e.tilingOverallTransform),t.TilingMap=e.TilingMap,t.TilingMap_texMatrix=(new i.Matrix3).copy(e.TilingMap_texMatrix),t.hasRoundCorner=e.hasRoundCorner,t.hasRoundCorner&&(t.TilingNormalMap=e.TilingNormalMap,t.TilingNormalMap_texMatrix=(new i.Matrix3).copy(e.TilingNormalMap_texMatrix)),t.useRandomOffset=e.useRandomOffset,t.useRandomOffset&&(t.TilingRandomMap=e.TilingRandomMap,t.TilingRandomMap_texMatrix=(new i.Matrix3).copy(e.TilingRandomMap_texMatrix),t.tilingRandomAxisS=(new i.Vector2).copy(e.tilingRandomAxisS),t.tilingRandomAxisT=(new i.Vector2).copy(e.tilingRandomAxisT),t.tilingRandomAlignmentOffset=(new i.Vector2).copy(e.tilingRandomAlignmentOffset)),t.uv2tile=e.uv2tile,t.tile2uv=e.tile2uv,t.tilingRepeatRange=[e.tilingRepeatRange[0],e.tilingRepeatRange[1],e.tilingRepeatRange[2],e.tilingRepeatRange[3]],t.tileAlignOffset=(new i.Vector2).copy(e.tileAlignOffset),t.tilingUVTransform=(new i.Matrix4).copy(e.tilingUVTransform)),t.defines=e.defines,t}},function(e,t,n){"use strict";n.r(t),n.d(t,"VBIntersector",function(){return d});var i,r,o=n(40),a=n(0);function s(){i||(i=new a.Matrix4,r=new a.Ray,new a.Vector3,new a.Vector3,new a.Vector3)}function l(e,t,n){s();var l=e.geometry;if(l){var c=e.material,u=c?c.side:a.FrontSide;i.getInverse(e.matrixWorld),r.copy(t.ray).applyMatrix4(i);var h,d,f=t.precision;Object(o.enumMeshTriangles)(l,function(i,o,s,l,c,p){null!==(h=u===a.BackSide?r.intersectTriangle(s,o,i,!0):r.intersectTriangle(i,o,s,u!==a.DoubleSide))&&(h.applyMatrix4(e.matrixWorld),(d=t.ray.origin.distanceTo(h))<f||d<t.near||d>t.far||n.push({distance:d,point:h,face:new a.Face3(l,c,p,a.Triangle.normal(i,o,s)),faceIndex:null,fragId:e.fragId,dbId:e.dbId}))})}}function c(e,t,n){s();var l=e.geometry;if(l){var c=t.linePrecision;e.isWideLine&&(e.material.linewidth?c=e.material.linewidth:e.geometry.lineWidth&&(c=e.geometry.lineWidth));var u=c*c;i.getInverse(e.matrixWorld),r.copy(t.ray).applyMatrix4(i);var h=new a.Vector3,d=new a.Vector3;l instanceof a.BufferGeometry&&Object(o.enumMeshLines)(l,function(i,o){var a;r.distanceSqToSegment(i,o,d,h),h.applyMatrix4(e.matrixWorld),d.applyMatrix4(e.matrixWorld),h.distanceToSquared(d)>u||(a=t.ray.origin.distanceTo(h))<t.near||a>t.far||n.push({distance:a,point:h,face:null,faceIndex:null,fragId:e.fragId,dbId:e.dbId})})}}function u(e,t,n){e.isLine||e.isWideLine?c(e,t,n):e.isPoint?function(e,t,n){s();var l=e.geometry;if(l){i.getInverse(e.matrixWorld),r.copy(t.ray).applyMatrix4(i);var c=t.precision,u=t.params.PointCloud.threshold;u||(u=1),u*=Math.max(3,l.pointSize),u/=4,l instanceof a.BufferGeometry&&Object(o.enumMeshVertices)(l,function(i){if(!(r.distanceToPoint(i)>u)){var o=r.closestPointToPoint(i);if(null!==o){o.applyMatrix4(e.matrixWorld);var a=t.ray.origin.distanceTo(o);a<c||a<t.near||a>t.far||n.push({distance:a,point:i,face:null,faceIndex:null,fragId:e.fragId,dbId:e.dbId})}}})}}(e,t,n):l(e,t,n)}var h=function(e,t){return e.distance-t.distance};var d={meshRayCast:l,lineRayCast:c,rayCast:u,intersectObject:function(e,t,n,i){!function e(t,n,i,r){if(t instanceof a.Mesh?u(t,n,i):t.raycast(n,i),!0===r)for(var o=t.children,s=0,l=o.length;s<l;s++)e(o[s],n,i,!0)}(e,t,n,i),n.sort(h)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"TexQuadConfig",function(){return p}),n.d(t,"ModelIteratorTexQuad",function(){return m});var i=n(3),r=n(50),o=n(123),a=n(17),s=n(82),l=n(0),c=n(1),u=0,h=1,d=2,f=function(e,t){this.timeStamps=e,this.mesh=t,this.state=u};function p(){this.urlPattern=null,this.tileSize=null,this.maxLevel=null,this.skippedLevels=[],this.textureLoader=null,this.texWidth=0,this.texHeight=0,this.maxActiveTiles=Object(i.isMobileDevice)()?0:400,this.cacheSize=Object(i.isMobileDevice)()?0:150,this.onRootLoaded=null,this.levelOffset=0,this.pixelRatio=1,this.getRootTileSize=function(){return 1*(this.tileSize<<this.maxLevel)},this.getQuadWidth=function(){return 1*this.texWidth/this.getRootTileSize()},this.getQuadHeight=function(){return 1*this.texHeight/this.getRootTileSize()},this.getPageToModelTransform=function(e,t){var n=e/this.getQuadWidth(),i=t/this.getQuadHeight();return new a.LmvMatrix4(!0).set(n,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1)},this.getBBox=function(){var e=this.getQuadWidth(),t=1-this.getQuadHeight();return new l.Box3(new l.Vector3(0,t,0),new l.Vector3(e,1,0))},this.valid=function(){return"string"==typeof this.urlPattern&&this.urlPattern.length>0&&"number"==typeof this.tileSize&&this.tileSize>0&&"number"==typeof this.maxLevel&&this.maxLevel>0&&"number"==typeof this.texWidth&&this.texWidth>0&&"number"==typeof this.texHeight&&this.texHeight>0},this.initForSimpleImage=function(e,t){this.urlPattern=decodeURIComponent(e),this.maxLevel=0,this.levelOffset=0,this.tileSize=-1,this.texWidth=-1,this.texHeight=-1,this.onRootLoaded=t,this.isSimpleImage=!0},this.isLevelPresent=function(e){return!this.skippedLevels[e]},this.initFromLoadOptions=function(e,t,n){var i,r,o,a,s;this.urlPattern=decodeURIComponent(e),this.textureLoader=n,t&&(this.tileSize=t.tileSize,this.maxLevel=(i=t.texWidth,r=t.texHeight,o=t.tileSize,a=Math.ceil(Math.log2(i)),s=Math.ceil(Math.log2(r)),Math.max(a,s)-Math.log2(o)),this.texWidth=t.texWidth,this.texHeight=t.texHeight,this.levelOffset=t.levelOffset,this.zips=t.zips,this.skippedLevels=function(e){var t=[];if(e.zips){n=(n=(n=(n=e.urlPattern.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")).replace(/\\{x\\}/,"[0-9]+")).replace(/\\{y\\}/,"[0-9]+")).replace(/\\{z\\}/,"([0-9]+)");var n=new RegExp("^"+n+"$");t.length=e.maxLevel+1,t.fill(!0);var i=0;e.zips.forEach(function(r){Object.keys(r.fileTable).forEach(function(r){var o=n.exec(r);if(o&&o[1]){var a=parseInt(o[1])-e.levelOffset;a>=0&&a<=e.maxLevel&&(t[a]=!1,++i)}})}),0===i&&(t.length=0,c.logger.info("No leaflet levels found - assume all are present"))}return t}(this),"number"==typeof t.maxLevel&&function(e,t,n){for(;n>0&&e.skippedLevels[n];)--n;var i=t-n;i>0&&(e.texWidth>>=i,e.texHeight>>=i,e.maxLevel=n)}(this,this.maxLevel,t.maxLevel),this.maxActiveTiles=t.maxActiveTiles||this.maxActiveTiles,this.cacheSize=t.cacheSize||this.cacheSize)}}function m(e,t){var n=e,i=1,a=e.getBBox(),c=[],p=t,m=[],g=[],v=[];this.registerView=function(){var e=c.indexOf(void 0);return-1===e&&(e=c.length),c[e]=new l.Scene,v[e]=0,m[e]=!0,e},this.registerView();var y=0,_=5,b=0,x=!1,w=[],A=null,E=!1,T=new s.a;function M(e){var t=n.maxLevel-e;return n.texWidth>>t}function S(e){var t=n.maxLevel-e;return n.texHeight>>t}function C(e){var t=M(e.level),i=S(e.level),r=e.x*n.tileSize,o=e.y*n.tileSize;return r>=t||o>=i}function P(e){var t=M(e.level),i=S(e.level),r=e.x*n.tileSize,o=e.y*n.tileSize,a=Math.max(0,Math.min(n.tileSize,t-r)),s=Math.max(0,Math.min(n.tileSize,i-o)),c=1*n.tileSize;return new l.Vector2(a/c,s/c)}function L(e){return 1/(1<<e)}function R(e,t){return L(e.level)*e.x*t}function D(e,t){var n=L(e.level);return 1-(e.y+1)*n*t}function I(e){return g[Object(r.tile2Index)(e)]}function O(e){var t=I(e);return t instanceof f&&t.state==d}function N(e,t,n,i){var r;if(t)A||(A=T.createQuadGeom()),r=A;else{var o=function(e,t){for(var n=e.getParent();n;){var i=I(n),r=i&&i.state==d;if(r&&t&&i.mesh.material.map.needsUpdate&&n.level>0&&(r=!1),r)break;n=n.getParent()}return n}(e);t=B(o).material;var a=function(e,t){var n=1<<e.level-t.level,i=1/n,r=i,o=P(t);i/=o.x,r/=o.y;var a=t.x*n,l=t.y*n,c=e.x-a,u=e.y-l,h=P(e);c*=i,u=1-(u*=r)-r*h.y;var d=new s.b;return d.offsetX=c,d.offsetY=u,d.scaleX=i*h.x,d.scaleY=r*h.y,d}(e,o);r=T.acquireQuadGeom(a)}var c=new l.Mesh(r,t);c.tile=e;var u=L(e.level),h=P(e),f=(1-h.y)*u*i,p=R(e,i),m=D(e,i);return c.position.set(p,m+f,0),c.scale.set(u*h.x*i,u*h.y*i,1),c}this.setAggressivePrefetching=function(e){E=e},this.getScene=function(e){return c[e=e||0]},this.nextBatch=function(e){return m[e=e||0]?null:(m[e]=!0,c[0])},this.getSceneCount=function(){return 1},this.done=function(e){return m[e||0]},this.rayCast=function(e,t){return null},this.getVisibleBounds=function(e,t){e&&e.copy(a),t&&t.copy(a)};var k=function(e){for(var t=e.image,n=1;(n*=2)<t.width;);for(var i=1;(i*=2)<t.height;);if(n!==t.width||i!==t.height){var r=document.createElement("canvas");r.width=n,r.height=i;var o=r.getContext("2d");o.drawImage(t,0,0);var a,s,l=o.getImageData(0,0,n,i),c=new Uint32Array(l.data.buffer,0,n*i);if(t.height<i){var u=t.height*n;for(a=t.height;a<i;++a,u+=n)for(s=0;s<t.width;++s)c[u+s]=c[u+s-n]}if(t.width<n){var h=0;for(a=0;a<i;++a,h+=n)for(s=t.width;s<n;++s)c[h+s]=c[h+s-1]}o.putImageData(l,0,0),e.image=r,e.flipY&&e.offset.set(0,1-t.height/i),e.repeat.set(t.width/n,t.height/i)}},V=this;function F(t){var o=Object(r.tile2Index)(t),s=g[o];if(!s||s.state==u){s||(s=new f(v.slice()),g[o]=s),s.state=h;var c=function(e){var t=n.levelOffset?n.levelOffset:0;return n.urlPattern.replace("{x}",e.x).replace("{y}",e.y).replace("{z}",e.level+t)}(t);b++,n.textureLoader(c,function(r){!function(r){if(V&&r){0==n.maxLevel&&(-1==n.texWidth&&(n.texWidth=r.image.width),-1==n.texHeight&&(n.texHeight=r.image.height),-1==n.tileSize&&(n.tileSize=Math.max(r.image.width,r.image.height)),a=e.getBBox()),k(r),r.minFilter=l.LinearMipMapLinearFilter,r.magFilter=l.LinearFilter;var o=new l.MeshBasicMaterial({color:4294967295});o.map=r,o.name=c,o.tile=t,o.disableEnvMap=!0,-1!==c.toLowerCase().indexOf(".png")&&(o.transparent=!0,o.alphaTest=.01),p.addMaterial(o.name,o,!0);var u=N(t,o,0,i);s.mesh=u,s.state=d,b--,x=!0;var h=r&&r.image?r.image.src:null;h&&l.Cache&&l.Cache.get(h)&&l.Cache.remove(h),0==t.level&&n.onRootLoaded&&n.onRootLoaded()}}(r)},function(e){console.error(e)})}}function B(e){var t=Object(r.tile2Index)(e),n=g[t];return n&&n.state==d?n.mesh:null}function U(e,t,n){var i=R(e,n),r=D(e,n);t.set(i,r,0)}function z(e,t,n){var i=L(e.level),r=R(e,n)+i,o=D(e,n)+i;t.set(r,o,0)}F(new r.TileCoords(0,0,0));var G,H,W,j=(G=new l.Vector3,H=new l.Vector3,W=new l.Box3,function(e,t,n){return U(e,G,n),z(e,H,n),W.set(G,H),t.intersectsBox(W)>0}),X=function(){var e=new l.Vector3,t=new l.Vector3;return function(n,i,r,o){var a=L(n.level);U(n,e,o),z(n,t,o);var s,l,c,u,h=(l=e,c=t,(u=(s=r).clone()).max(l),u.min(c),u.distanceToSquared(s));return(j(n,i,o)?100:1)*(a*a)/(h=Math.max(h,1e-4))}}(),q=function(){var e=new l.Vector3,t=new l.Vector3;return function(n,i,r,o,a,s){U(n,e,s),z(n,t,s);var c=function(e,t,n,i){var r=e.clone();return r.max(n),r.min(i),r.sub(e).dot(t)}(i,r,e,t);return.5*((t.x-e.x)/(Math.tan(l.Math.degToRad(o/2))*c))*a}}();function Y(e,t){this.tile=e,this.prio=t}function K(e,t){return e.prio>t.prio}function Q(e,t){var n=g[Object(r.tile2Index)(e)];n&&n.timeStamps[t]!==v[t]&&(n.timeStamps[t]=v[t],y++)}function Z(e,t,n){e.sort(function(e,i){var r=X(e,t,n);return X(i,t,n)-r});for(var i=0,r=0;r<e.length;r++){var o=I(e[r]);if(!o||o.state!=h){if(b>=_)break;F(e[r]),i++}}return i}function J(e){if(e&&e.mesh&&e.mesh.material){var t=e.mesh.material;p.removeMaterial(t.name),t.map.dispose(),t.map.needsUpdate=!0;t.dispatchEvent({type:"dispose"}),t.needsUpdate=!0}}function $(e){for(var t=0;t<v.length;t++){if(!!c[t]&&e.timeStamps[t]===v[t])return!0}return!1}this.dispose=function(){var e;for(e in g)J(g[e]);A&&(A.dispose(),A.needsUpdate=!0),T.dispose()},this.dtor=function(){this.dispose(),V=null,p=null},this.reset=function(e,t,a){var s,l,u=(a=a||0)>0,h=c[a];for(s=0;s<h.children.length;s++){h.children[s].dispatchEvent({type:"removed"})}if(h.children.length=0,v[a]++,y=0,T.reset(),!O(new r.TileCoords(0,0,0)))return m[a]=!0,!1;var f=new o.SortedList(K),p=new r.TileCoords(0,0,0),_=X(p,e,t.position);f.add(new Y(p,_));for(var A=t.getWorldDirection(),M=0|t.clientHeight*n.pixelRatio,S=[],P=[],L=[];f.size()>0;){if(l=f.get(0).tile,f.removeAt(0),!C(l)){var R=!0;l.level==n.maxLevel&&(R=!1),q(l,t.position,A,t.fov,M,i)<n.tileSize&&n.isLevelPresent(l.level)&&(R=!1);var D=j(l,e,i);if(D&&(!O(l)&&n.isLevelPresent(l.level)&&L.push(l),Q(l,a)),!D&&S.length+P.length>n.maxActiveTiles&&(R=!1),R)for(var I=0;I<4;I++){var k=l.getChild(I);_=X(k,e,t.position,i),f.add(new Y(k,_))}else D?S.push(l):P.push(l)}}var V=0;x=!1;var F=!0;for(s=0;s<S.length;++s){var U=B(l=S[s]);U&&U.material.map.needsUpdate&&!E&&(V<5||u?V++:(U=N(l,null,0,i),x=!0,F=!1)),U||(U=N(l,null,0,i),F=!1),h.add(U)}m[a]=!1;var z=Z(L,e,t.position);y+=b;var G=[];for(s=0;s<P.length&&!(y>=n.maxActiveTiles);s++)if(O(l=P[s]))for(var H=0;H<=l.level;H++){if(Q(l.getParentAtLevel(H),a),y>n.maxActiveTiles)break}else G.push(l),y++;if(z+=Z(G,e,t.position),E){for(G=[],s=0;s<S.length;++s)if((l=S[s]).level!=n.maxLevel&&n.isLevelPresent(l.level+1))for(I=0;I<4;I++){!C(k=l.getChild(I))&&j(k,e,i)&&(O(k)||(G.push(k),y++))}z+=Z(G,e,t.position)}if(u||function(e,t,i){var o=Object.keys(g),a=o.length,s=e-(n.cacheSize-a);if(!(s<=0)){o.sort(function(e,n){var o=g[e].timeStamps[0],a=g[n].timeStamps[0];if(o!=a)return o-a;var s=Object(r.index2Tile)(e),l=Object(r.index2Tile)(n);return X(s,t,i)-X(l,t,i)});for(var l=Math.min(s,o.length),c=0;c<l;c++){var u=o[c];if(0!==Object(r.index2Tile)(u).level){var h=g[u];if(h.state==d){if($(h))break;J(h),delete g[u]}}}}}(z,e,t.position),F&&w.length>0){var W=w.splice(0,w.length);setTimeout(function(){for(var e=0;e<W.length;e++)W[e](a)},1)}return F},this.callWhenRefined=function(e){w.push(e)},this.update=function(){return x},this.setDpiScale=function(e){i=e},this.getDpiScale=function(){return i},this.unregisterView=function(e){c[e]=void 0,v[e]=void 0,m[e]=void 0;for(var t=c.length;t>0&&!c[t-1];)t--;c.length=t,v.length=t,m.length=t}}},function(e,t,n){"use strict";n.r(t);var i=n(118),r=n(69),o=n(1),a=n(45),s=(n(108),n(33)),l=n(0),c=n(22),u=n(219),h=n.n(u),d=n(220),f=n.n(d),p=n(15),m={uniforms:l.UniformsUtils.merge([p.ShaderChunks.CutPlanesUniforms,{pixelsPerUnit:{type:"f",value:1},aaRange:{type:"f",value:.5},tLayerMask:{type:"t",value:null},tLineStyle:{type:"t",value:null},vLineStyleTexSize:{type:"v2",value:new l.Vector2(13,70)},tRaster:{type:"t",value:null},tSelectionTexture:{type:"t",value:null},vSelTexSize:{type:"v2",value:new l.Vector2(4096,1)},displayPixelRatio:{type:"f",value:1},opacity:{type:"f",value:1},selectionColor:{type:"v4",value:new l.Vector4(0,0,1,1)},modelId:{type:"v3",value:new l.Vector3(0,0,0)},viewportId:{type:"f",value:0},swap:{type:"f",value:0},grayscale:{type:"f",value:0},unpackXform:{type:"v4",value:new l.Vector4(1,1,0,0),perObject:!0},tIdColor:{type:"t",value:null,perObject:!0},vIdColorTexSize:{type:"v2",value:new l.Vector2(256,1),perObject:!0}}]),attributes:{fields1:0,fields2:0,color4b:0,dbId4b:0,flags4b:0,layerVp4b:0,extraParams:0,instFlags4b:0,uvIdColor:0},defines:{},vertexShader:h.a,fragmentShader:f.a},g=n(221),v=n.n(g),y=n(222),_=n.n(y),b={uniforms:l.UniformsUtils.merge([p.ShaderChunks.CutPlanesUniforms,{pixelsPerUnit:{type:"f",value:1},aaRange:{type:"f",value:1},tLayerMask:{type:"t",value:null},tLineStyle:{type:"t",value:null},vLineStyleTexSize:{type:"v2",value:new l.Vector2(13,70)},tRaster:{type:"t",value:null},tSelectionTexture:{type:"t",value:null},vSelTexSize:{type:"v2",value:new l.Vector2(4096,1)},displayPixelRatio:{type:"f",value:1},size:{type:"v2",value:new l.Vector2(1024,768)},opacity:{type:"f",value:1},selectionColor:{type:"v4",value:new l.Vector4(0,0,1,1)},modelId:{type:"v3",value:new l.Vector3(0,0,0)},viewportId:{type:"f",value:0},swap:{type:"f",value:0},grayscale:{type:"f",value:0},unpackXform:{type:"v4",value:new l.Vector4(1,1,0,0),perObject:!0},tIdColor:{type:"t",value:null,perObject:!0},vIdColorTexSize:{type:"v2",value:new l.Vector2(256,1),perObject:!0}}]),attributes:{fields1:0,fields2:0,color4b:0,dbId4b:0,flags4b:0,layerVp4b:0,extraParams:0,instFlags4b:0,uvIdColor:0},defines:{},vertexShader:v.a,fragmentShader:_.a};function x(e,t){e.x=t.r,e.y=t.g,e.z=t.b,e.w=1}n.d(t,"MATERIAL_VARIANT",function(){return A}),n.d(t,"MaterialManager",function(){return E});var w=new l.Color("#0000FF"),A={INSTANCED:0,VERTEX_IDS:1};function E(e){this._renderer=e,this._textures={},this._texturesToUpdate=[],this._materials={},this._materialsNonHDR={},this._exposureBias=0,this._tonemapMethod=0,this._envMapExposure=1,this._envRotationSin=0,this._envRotationCos=1,this._reflectionMap=null,this._irradianceMap=null,this._cutplanes=[],this._mrtNormals=!1,this._mrtIdBuffer=void 0,this._polygonOffsetOn=!1,this._pixelsPerUnit=1,this._layerMaskTex=null,this._layersMap=null,this._lineStyleTex=null,this._selectionTextures={},this._swapBlackAndWhite=0,this._grayscaleLines=0,this._depthWriteTransparent=!0,this._needsTwoSided=!1,this._hasTransparentMaterial=!1,this.hasPrism=!1,this.defaultMaterial=new l.MeshPhongMaterial({ambient:197379,color:7829367,specular:3355443,shininess:30,shading:l.SmoothShading,reflectivity:0}),this.addMaterial("__defaultMaterial__",this.defaultMaterial)}E.prototype.dtor=function(){this.cleanup(),l.Cache.clear()},E.prototype._getModelHash=function(e){return"model:"+(e?e.id:"")+"|"},E.prototype._getMaterialHash=function(e,t){return e&&e.isOTG()?t:this._getModelHash(e)+"mat:"+t},E.prototype._getTextureHash=function(e,t,n){return this._getModelHash(e)+"tex:"+t+"|map:"+n},E.prototype.addNonHDRMaterial=function(e,t){t.doNotCut||(t.cutplanes=this._cutplanes),this._materialsNonHDR[e]=t},E.prototype.removeNonHDRMaterial=function(e){delete this._materialsNonHDR[e]},E.prototype.addMaterialNonHDR=function(e,t){this.addNonHDRMaterial(e,t)},E.prototype.addHDRMaterial=function(e,t){this._reflectionMap&&!t.disableEnvMap&&(t.envMap=this._reflectionMap),this._irradianceMap&&(t.irradianceMap=this._irradianceMap),t.exposureBias=Math.pow(2,this._exposureBias),t.tonemapOutput=this._tonemapMethod,t.envMapExposure=this._envMapExposure,t.envRotationSin=this._envRotationSin,t.envRotationCos=this._envRotationCos,t.doNotCut||(t.cutplanes=this._cutplanes),this._applyMRTFlags(t),this._applyPolygonOffset(t,this._polygonOffsetOn),this._materials[e]=t},E.prototype.addMaterial=function(e,t,n){var i=t.prismType&&-1!==t.prismType.indexOf("Prism");this.hasPrism=i||this.hasPrism,a.MaterialConverter.applyAppearanceHeuristics(t,i||n,this.isDepthWriteTransparentEnabled()),this.addHDRMaterial(e,t)},E.prototype.addLineMaterial=function(e,t){this._layerMaskTex&&(t.defines.HAS_LAYERS=1,t.uniforms.tLayerMask.value=this._layerMaskTex),this._lineStyleTex&&(t.defines.HAS_LINESTYLES=1,t.defines.MAX_LINESTYLE_LENGTH=this._lineStyleTex.image.width,t.uniforms.tLineStyle.value=this._lineStyleTex,t.uniforms.vLineStyleTexSize.value.set(this._lineStyleTex.image.width,this._lineStyleTex.image.height)),t.uniforms.swap.value=this._swapBlackAndWhite,t.uniforms.grayscale.value=this._grayscaleLines,this._updatePixelScaleForMaterial(t),this._materials[e]=t},E.prototype.addOverrideMaterial=function(e,t){if(this.addNonHDRMaterial(e,t),t.variants)for(var n=0;n<t.variants.length;n++){var i=t.variants[n];if(i){var r=e+"_variant_"+n;this.addNonHDRMaterial(r,i)}}},E.prototype.getMaterialVariant=function(e,t,n){var i=!!e.hash,r=(i?e.hash:this._getModelHash(n)+e.id)+"|"+t,o=this._materials[r];return o||(o=this.cloneMaterial(e,n),t===A.INSTANCED?(o.useInstancing=!0,o.vertexIds=!0):t===A.VERTEX_IDS&&(o.vertexIds=!0),this.addHDRMaterial(r,o)),i&&this._addMaterialRef(o,n.id),o},E.prototype.addInstancingSupport=function(e){var t=e.clone();t.useInstancing=!0;var n=e.clone();n.wideLines=!0,e.variants=[t,n],e.getCustomOverrideMaterial=function(e){return e.useInstancing?this.variants[0]:e.wideLines?(this.variants[1].linewidth=e.linewidth,this.variants[1]):null}},E.prototype.removeMaterial=function(e){delete this._materials[e]},E.prototype.findMaterial=function(e,t){var n=this._getMaterialHash(e,t);return this._materials[n]},E.prototype.convertSharedMaterial=function(e,t,n){var i=this.findMaterial(e,n);return i||((i=this.convertOneMaterial(e,t,n)).hash=n),this._addMaterialRef(i,e.id),i},E.prototype.convertOneMaterial=function(e,t,n){var i=e.getData(),r=i&&i.materials?i.materials.scene.SceneUnit:"inch",o=a.MaterialConverter.convertMaterial(t,r);if(i.doubleSided&&(o.side=l.DoubleSide),this.addMaterial(n,o),this._hasTransparentMaterial=this._hasTransparentMaterial||o.transparent,a.MaterialConverter.hasTiling(t)){o.decals=[];for(var s=t.materials,c=s[t.userassets[0]],u=c.properties.references.base_materials.connections,h=c.properties.references.tiles.connections,d=[],f=0;f<h.length;f++){var p=s[h[f]];d.push(p),(y=a.MaterialConverter.convertMaterial(t,r,null,u[f])).useTiling=!0,y.transparent=!0,o.decals.push({uv:0,material:y}),this.addMaterial(n+"|tile|"+f,y)}a.MaterialConverter.materialTilingPattern(t,c,d,o.decals,r)}if(t.decals){o.decals||(o.decals=[]);for(var m=0,g=t.decals.length;m<g;m++){var v=t.decals[m],y=a.MaterialConverter.convertMaterial(v.material,r);o.decals.push({uv:v.uv||0,material:y}),this.addMaterial(n+"|decal|"+m,y)}}return o},E.prototype.forEach=function(e,t){var n=this._materials;for(var i in n){var r=n[i];t&&r.is2d||e(r)}};var T={needsClear:!1,needsRender:!1,overlayDirty:!1};function M(e,t,n){var i=e.slots[n];i?-1==i.indexOf(t)&&i.push(t):e.slots[n]=[t]}E.prototype.updateMaterials=function(){for(T.needsClear=!1;this._texturesToUpdate.length;){var e=this._texturesToUpdate.pop();for(var t in e.slots)for(var n=e.slots[t],i=0;i<n.length;i++)n[i][t]=e.tex,n[i].needsUpdate=!0,T.needsClear=!0}return T},E.prototype.setTextureInCache=function(e,t,n){var i=this._getTextureHash(e,t.uri,t.mapName),r=this._textures[i];if(r){for(var o in r.tex||(r.tex=n),r.slots)for(var a=r.slots[o],s=0;s<a.length;s++)a[s][o]=n;this._texturesToUpdate.push(r)}},E.prototype.loadTextureFromCache=function(e,t,n,i){var r=this._getTextureHash(e,n.uri,n.mapName),o=this._textures[r];if(o)o.tex?(t[i]=o.tex,t.needsUpdate=!0):(o.slots[i]||(o.slots[i]=[]),o.slots[i].push(t));else{var a={};a[i]=[t],this._textures[r]={slots:a,tex:null}}return!!o},E.prototype.enumTextures=function(e,t){var n=e?this._getModelHash(e):"";for(var i in this._textures)0===i.indexOf(n)&&t(this._textures[i].tex)},E.prototype.exportModelMaterials=function(e,t){var n=this._getModelHash(e),i={};for(var r in this._materials)if(-1!==r.indexOf(n)){var o=this._materials[r];o.defines&&o.defines.hasOwnProperty("SELECTION_RENDERER")||(i[r]=o)}var a={};for(var r in this._materialsNonHDR)-1!==r.indexOf(n)&&(a[r]=this._materialsNonHDR[r]);var s={};for(var l in this._textures)-1!==l.indexOf(n)&&(s[l]=this._textures[l]);return this.cleanup(e),{mats:i,matsNonHDR:a,textures:s}},E.prototype.importModelMaterials=function(e){for(var t in e.mats){var n=e.mats[t];n.is2d?this.addLineMaterial(t,n):this.addHDRMaterial(t,n)}for(var t in e.matsNonHDR)this.addMaterialNonHDR(t,e.matsNonHDR[t]);for(var i in e.textures)this._textures[i]=e.textures[i]},E.prototype.cloneMaterial=function(e,t){var n=e.isPrismMaterial?Object(r.clonePrismMaterial)(e):e.clone();if(e.defines&&(n.defines=Object.assign({},e.defines)),(n instanceof l.MeshPhongMaterial||n.isPrismMaterial)&&(n.packedNormals=e.packedNormals,n.exposureBias=e.exposureBias,n.irradianceMap=e.irradianceMap,n.envMapExposure=e.envMapExposure,n.envRotationSin=e.envRotationSin,n.envRotationCos=e.envRotationCos,n.proteinType=e.proteinType,n.proteinMat=e.proteinMat,n.proteinCategories=e.proteinCategories,n.tonemapOutput=e.tonemapOutput,n.cutplanes=e.cutplanes,n.textureMaps=e.textureMaps,n.texturesLoaded=e.texturesLoaded),e.doNotCut&&(n.doNotCut=!0),e.is2d&&(n.is2d=!0),e.disableEnvMap&&(n.disableEnvMap=!0),e.textureMaps)for(var i in e.textureMaps)if(e[i])n[i]=e[i];else if(t){var a=n.textureMaps[i],s=a.uri,c=a.mapName,u=this._getTextureHash(t,s,c),h=this._textures[u];h?M(h,n,i):o.logger.error("Missing texture receiver",u)}else o.logger.error("Cannot connect pending texture maps because cloneMaterial was called without a model");return this._applyMRTFlags(n),n},E.prototype.setupMaterial=function(e,t,n){var i=e.getData(),r=this.findMaterial(e,n);if(!r){r=this.cloneMaterial(this.defaultMaterial,e);var s=this._getMaterialHash(e,n);this._materials[s]=r,o.logger.warn("Material ("+n+") missing, using default material instead.")}if(t.isLines||t.isWideLines||t.isPoints){var c=!!t.attributes.color,u=r;if(u||(u=this.defaultMaterial.clone()),t.isPoints)r=new l.PointCloudMaterial({vertexColors:c,size:t.pointSize});else{var h=c?"cachedLineMaterialVC":"cachedLineMaterial";r=u[h],t.isWideLines?(r||((r=u[h]=new l.MeshBasicMaterial({vertexColors:c})).wideLines=!0,t.isLines=!1),r.polygonOffset=u.polygonOffset,r.polygonOffsetFactor=u.polygonOffsetFactor,r.polygonOffsetUnits=u.polygonOffsetUnits,r.linewidth=u.linewidth):r||(r=u[h]=new l.LineBasicMaterial({vertexColors:c}))}c||(r.color=u.color),r.svfMatId=n,this.addMaterialNonHDR(i.basePath+n+"_line_"+r.id,r),i.hasLines=!0}else r.svfMatId=n,a.MaterialConverter.applyGeometryFlagsToMaterial(r,t);return r},E.prototype._addMaterialRef=function(e,t){e._sharedBy||(e._sharedBy=[]);var n=e._sharedBy;-1===n.indexOf(t)&&n.push(t)},E.prototype._removeMaterialRef=function(e,t){var n=e._sharedBy,i=n?n.indexOf(t):-1;-1!==i&&n.splice(i,1)},E.prototype.cleanup=function(e){var t=this,n=this._getModelHash(e),i={};for(var r in this._textures){var o=this._textures[r];-1===r.indexOf(n)?i[r]=o:o.tex&&(o.tex.dispose(),o.tex.needsUpdate=!0)}this._textures=i;var a={},s={type:"dispose"};for(var c in this._materials){var u=this._materials[c],h=!e||-1!==c.indexOf(n);if(u._sharedBy&&(h?u._sharedBy.length=0:(this._removeMaterialRef(u,e.id),0===u._sharedBy.length&&(h=!0))),h){if((u=this._materials[c]).dispatchEvent(s),u.needsUpdate=!0,u.envMap=null,u.is2d){u.uniforms.tLayerMask.value=null,u.uniforms.tLineStyle.value=null;var d=u.uniforms.tRaster;d&&d.value instanceof l.Texture&&(d.value.dispose(),d.value.needsUpdate=!0)}}else a[c]=this._materials[c]}this._materials=a;var f={};for(var c in this._materialsNonHDR){if(e&&-1===c.indexOf(n))f[c]=this._materialsNonHDR[c];else(u=this._materialsNonHDR[c]).dispatchEvent(s),u.needsUpdate=!0}this._materialsNonHDR=f;var p=function(e,n){var i=t._selectionTextures[e];i&&(i.dispose(),i.needsUpdate=!0,n&&delete t._selectionTextures[e])};if(e)p(e.id,!0);else{for(var m in this._selectionTextures)this._selectionTextures.hasOwnProperty(m)&&p(m,!1);this._selectionTextures={}}},E.prototype.toggleDepthWriteTransparent=function(e){this._depthWriteTransparent!=e&&(this._depthWriteTransparent=e,this.forEach(function(t){t.lmv_depthWriteTransparent&&(t.depthWrite=e)}))},E.prototype.isDepthWriteTransparentEnabled=function(){return this._depthWriteTransparent},E.prototype.hasTwoSidedMaterials=function(){return this._needsTwoSided},E.prototype.hasTransparentMaterial=function(){return this._hasTransparentMaterial},E.prototype.texturesLoaded=function(){return 0===this._texturesToUpdate.length},E.prototype.renderer=function(){return this._renderer},E.prototype.setTonemapExposureBias=function(e){this._exposureBias=e;var t=Math.pow(2,e);this.forEach(function(e){e.exposureBias=t,e.needsUpdate=!0},!0)},E.prototype.setTonemapMethod=function(e){this._tonemapMethod=e,this.forEach(function(t){t.tonemapOutput=e,t.needsUpdate=!0},!0)},E.prototype.setEnvExposure=function(e){var t=Math.pow(2,e);this._envMapExposure=t,this.forEach(function(e){e.envMapExposure=t,e.needsUpdate=!0},!0)},E.prototype.setEnvRotation=function(e){var t=this._envRotationSin=Math.sin(e),n=this._envRotationCos=Math.cos(e);this.forEach(function(e){e.envRotationSin=t,e.envRotationCos=n,e.needsUpdate=!0},!0)},E.prototype.setReflectionMap=function(e){this._reflectionMap=e,this.forEach(function(t){t.disableEnvMap||(t.envMap=e,t.needsUpdate=!0)},!0)},E.prototype.setIrradianceMap=function(e){this._irradianceMap=e,this.forEach(function(t){t.irradianceMap=e,t.needsUpdate=!0},!0)},E.prototype.setCutPlanes=function(e){if(this._cutplanes.length!==(e&&e.length||0))for(var t in this.forEach(function(t){t.doNotCut||(t.needsUpdate=!0,e&&e.length>0&&(t.side=l.DoubleSide))}),this._materialsNonHDR)this._materialsNonHDR[t].doNotCut||(this._materialsNonHDR[t].needsUpdate=!0);for(;this._cutplanes.length>0;)this._cutplanes.pop();if(e)for(var n=0;n<e.length;n++)this._cutplanes.push(e[n].clone())},E.prototype.getCutPlanes=function(){return this._cutplanes.slice()},E.prototype.getCutPlanesRaw=function(){return this._cutplanes},E.prototype._applyPolygonOffset=function(e){(e instanceof l.MeshPhongMaterial||e.isPrismMaterial)&&(e.polygonOffset=this._polygonOffsetOn,e.polygonOffsetFactor=this._polygonOffsetFactor,e.polygonOffsetUnits=this._polygonOffsetUnits,e.extraDepthOffset&&(e.polygonOffsetFactor+=e.extraDepthOffset),e.needsUpdate=!0)},E.prototype.getPolygonOffsetOn=function(){return this._polygonOffsetOn},E.prototype.getPolygonOffsetFactor=function(){return this._polygonOffsetFactor},E.prototype.getPolygonOffsetUnits=function(){return this._polygonOffsetUnits},E.prototype.togglePolygonOffset=function(e,t,n){this._polygonOffsetOn=e,this._polygonOffsetFactor=e?t||1:0,this._polygonOffsetUnits=e?n||.1:0;var i=this;this.forEach(function(e){i._applyPolygonOffset(e)})},E.prototype._applyMRTFlags=function(e){var t=e.supportsMrtNormals||e instanceof l.MeshPhongMaterial||e.isPrismMaterial,n=e.mrtNormals,i=e.mrtIdBuffer,r=this._renderer&&this._renderer.supportsMRT();e.mrtNormals=t&&r&&this._mrtNormals,e.mrtIdBuffer=r?this._mrtIdBuffer:void 0,e.mrtNormals===n&&e.mrtIdBuffer===i||(e.needsUpdate=!0)},E.prototype.toggleMRTSetting=function(e){this._mrtNormals=e.mrtNormals,this._mrtIdBuffer=e.mrtIdBuffer;var t=this;this.forEach(function(e){e.is2d||t._applyMRTFlags(e)})},E.prototype.initLineStyleTexture=function(){this._lineStyleTex=Object(i.createLinePatternTexture)()},E.prototype.initLayersTexture=function(e,t){for(var n=this._layerMaskTex?this._layerMaskTex.image.data:new Uint8Array(65536),i=0,r=e;i<r;i++)n[i]=255;var o=this._layerMaskTex||new l.DataTexture(n,256,256,l.LuminanceFormat,l.UnsignedByteType,l.UVMapping,l.ClampToEdgeWrapping,l.ClampToEdgeWrapping,l.NearestFilter,l.NearestFilter,0);o.generateMipmaps=!1,o.flipY=!1,o.needsUpdate=!0,this._layerMaskTex=o,this._layersMap=t},E.prototype.setLayerVisible=function(e,t){for(var n=this._layerMaskTex,i=n.image.data,r=this._layersMap,o=t?255:0,a=0;a<e.length;++a){i[r[e[a]]]=o}n.needsUpdate=!0,this.forEach(function(e){e.is2d&&(e.needsUpdate=!0)})},E.prototype.isLayerVisible=function(e){return!!this._layerMaskTex.image.data[this._layersMap[e]]},E.prototype.initSelectionTexture=function(e,t){for(var n=e||1,i=0|Math.ceil(n/4096),r=1;r<i;)r*=2;i=r;for(var o=new Uint8Array(4096*i),a=0;a<n;a++)o[a]=0;var s=new l.DataTexture(o,4096,i,l.LuminanceFormat,l.UnsignedByteType,l.UVMapping,l.ClampToEdgeWrapping,l.ClampToEdgeWrapping,l.NearestFilter,l.NearestFilter,0);return s.generateMipmaps=!1,s.flipY=!1,s.needsUpdate=!0,this._selectionTextures[t]=s,s},E.prototype.highlightObject2D=function(e,t,n){var i=this._selectionTextures[n];i&&(i.image.data[e]=t?255:0,i.needsUpdate=!0)},E.prototype._updatePixelScaleForMaterial=function(e){e.is2d&&(e.isScreenSpace?(e.uniforms.size.value.set(this._deviceWidth,this._deviceHeight),e.uniforms.aaRange.value=.5):e.uniforms.aaRange.value=.5/(this._pixelsPerUnit*e.modelScale),e.uniforms.pixelsPerUnit.value=this._pixelsPerUnit*e.modelScale)},E.prototype.updatePixelScale=function(e,t,n){var i=this;this._pixelsPerUnit=e,this._deviceWidth=t,this._deviceHeight=n,this.forEach(function(e){return i._updatePixelScaleForMaterial(e)})},E.prototype.updateSwapBlackAndWhite=function(e){var t=this._swapBlackAndWhite=e?1:0;this.forEach(function(e){e.is2d&&(e.uniforms.swap.value=t)})},E.prototype.setGrayscale=function(e){var t=this._grayscaleLines=e?1:0;this.forEach(function(e){e.is2d&&(e.uniforms.grayscale.value=t)})},E.prototype.updateViewportId=function(e){this.forEach(function(t){t.is2d&&(t.uniforms.viewportId.value=e,t.needsUpdate=!0)})},E.prototype.create2DMaterial=function(e,t,n,i,r){var o=e?e.getData():null,a="__lineMaterial__";t.image&&(a+="|image:"+t.image.name),t.clip&&(a+="|clip:"+JSON.stringify(t.clip)),n&&(a+="|id"),i&&(a+="|selection"),t.skipEllipticals&&(a+="|skipEllipticals"),t.skipCircles&&(a+="|skipCircles"),t.skipTriangleGeoms&&(a+="|skipTriangleGeoms"),t.useInstancing&&(a+="|useInstancing"),t.isScreenSpace&&(a+="|isScreenSpace"),t.unpackPositions&&(a+="|unpackPositions");var u=this._getMaterialHash(e,a);if(!this._materials.hasOwnProperty(u)){var h;if(t.isScreenSpace?(h=Object(c.createShaderMaterial)(b)).isScreenSpace=!0:h=Object(c.createShaderMaterial)(m),h.is2d=!0,h.transparent=!0,h.depthWrite=!1,h.depthTest=!1,h.side=l.DoubleSide,h.blending=l.NormalBlending,n?(h.defines.ID_COLOR=1,h.blending=l.NoBlending):i?(h.uniforms.tSelectionTexture.value=i,h.uniforms.vSelTexSize.value.set(i.image.width,i.image.height),h.defines.SELECTION_RENDERER=1,h.uniforms.selectionColor.value=new l.Vector4(0,0,1,1)):(this.get2dSelectionColor(h.uniforms.selectionColor),this.renderer()&&this.renderer().supportsMRT()&&(h.mrtIdBuffer=this._mrtIdBuffer)),t.skipEllipticals||(h.defines.HAS_ELLIPTICALS=1),t.skipCircles||(h.defines.HAS_CIRCLES=1),t.skipTriangleGeoms||(h.defines.HAS_TRIANGLE_GEOMS=1),t.useInstancing&&(h.defines.USE_INSTANCING=1),t.unpackPositions&&(h.defines.UNPACK_POSITIONS=1),t.image){var d=function(n,i){n?(n.wrapS=l.ClampToEdgeWrapping,n.wrapT=l.ClampToEdgeWrapping,n.minFilter=i?l.LinearFilter:l.LinearMipMapLinearFilter,n.magFilter=l.LinearFilter,n.anisotropy=1,n.flipY=!0,n.generateMipmaps=!0,n.needsUpdate=!0,h.defines.HAS_RASTER_QUADS=1,h.uniforms.tRaster.value=n,"number"==typeof t.opacity&&(h.uniforms.opacity.value=t.opacity),h.needsUpdate=!0,r&&r(n,e)):r&&r(n,e,t)};if("undefined"!=typeof HTMLCanvasElement&&t.image instanceof HTMLCanvasElement||"undefined"!=typeof HTMLImageElement&&t.image instanceof HTMLImageElement)d(new l.Texture(s.TextureLoader.imageToCanvas(t.image),l.UVMapping),!0);else s.TextureLoader.loadTextureWithSecurity(t.image.dataURI,!1,l.UVMapping,d,o.acmSessionId)}h.modelScale=t.modelScale||1,h.textureMaps={},this.addLineMaterial(u,h)}return a},E.prototype.set2dSelectionColor=function(e){w=new l.Color(e),this.forEach(function(e){if(e.is2d&&e.uniforms){var t=e.uniforms.selectionColor;t&&(x(t.value,w),e.needsUpdate=!0)}})},E.prototype.get2dSelectionColor=function(e){return e&&x(e.value,w),w}},function(e,t,n){"use strict";n.r(t),n.d(t,"PrismMaps",function(){return c}),n.d(t,"GetPrismMapChunk",function(){return u}),n.d(t,"WebGLProgram",function(){return h});var i,r,o=n(111),a=n(15),s=n(0),l=n(3),c=["opaque_luminance_modifier","surface_albedo","surface_roughness","surface_anisotropy","surface_rotation","opaque_f0","opaque_albedo","metal_f0","layered_f0","layered_diffuse","layered_roughness","layered_anisotropy","layered_rotation","layered_bottom_f0","layered_fraction","surface_cutout","glazing_transmission_color","glazing_f0","glazing_transmission_roughness","wood_curly_distortion"],u=function(e,t,n){var i="uv_"+e+"_map",r="";return t&&n?r="if ("+i+".x < 0.0 || "+i+".x > 1.0 || "+i+".y < 0.0 || "+i+".y > 1.0) { discard; }":t?r="if ("+i+".x < 0.0 || "+i+".x > 1.0) { discard; }":n&&(r="if ("+i+".y < 0.0 || "+i+".y > 1.0) { discard; }"),"#define "+e.toUpperCase()+"_CLAMP_TEST "+r},h=(i=0,r=function(e,t,n,i,r){var o=i?"1.0-":"",a="texture2D("+e+", (UV))",s="";return r=r||"vec4(0.0)",t&&n?s="((UV).x < 0.0 || (UV).x > 1.0 || (UV).y < 0.0 || (UV).y > 1.0) ? "+r+" : ":t?s="((UV).x < 0.0 || (UV).x > 1.0) ? "+r+" : ":n&&(s="((UV).y < 0.0 || (UV).y > 1.0) ? "+r+" : "),"#define GET_"+e.toUpperCase()+"(UV) ("+s+o+a+")"},function(e,t,n,h){var d=e,f=d.context,p=n.defines,m=n.__webglShader.uniforms,g=n.attributes,v=Object(a.resolve)(n.__webglShader.vertexShader),y=Object(a.resolve)(n.__webglShader.fragmentShader),_=n.index0AttributeName;void 0===_&&!0===h.morphTargets&&(_="position"),h.envMap;var b,x,w=e.gammaFactor>0?e.gammaFactor:1,A=function(e){var t,n,i=[];for(var r in e)!1!==(t=e[r])&&(n="#define "+r+" "+t,i.push(n));return i.join("\n")}(p),E=f.createProgram();n instanceof s.RawShaderMaterial?(b="",x=""):(b=["precision "+h.precision+" float;","precision "+h.precision+" int;",A,h.vertexPrefix,h.supportsVertexTextures?"#define VERTEX_TEXTURES":"",d.gammaInput?"#define GAMMA_INPUT":"",d.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+w,h.mrtNormals?"#define MRT_NORMALS":"",h.mrtIdBuffer?"#define MRT_ID_BUFFER":"","#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_BONES "+h.maxBones,"#define NUM_CUTPLANES "+h.numCutplanes,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define ENVMAP_MODE_REFLECTION":"",h.irradianceMap?"#define USE_IRRADIANCEMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.vertexIds?"#define USE_VERTEX_ID":"",h.useTiling?"#define USE_TILING":"",h.useInstancing?"#define USE_INSTANCING":"",h.wideLines?"#define WIDE_LINES":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals?"#define USE_MORPHNORMALS":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",h.useFragDepthExt?"#define USE_LOGDEPTHBUF_EXT":"",h.packedNormals?"#define UNPACK_NORMALS":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","#ifdef UNPACK_NORMALS","attribute vec2 normal;","#else","attribute vec3 normal;","#endif","attribute vec2 uv;","attribute vec2 uv2;","#ifdef PRISMWOOD","attribute vec3 uvw;","#endif","#ifdef USE_COLOR","   attribute vec3 color;","#endif",""].join("\n"),x=[h.bumpMap||h.normalMap?"#extension GL_OES_standard_derivatives : enable":"",!h.mrtIdBuffer&&!h.mrtNormals||l.isIE11?"":"#extension GL_EXT_draw_buffers : enable",h.mrtIdBuffer?"#define gl_FragColor gl_FragData[0]":"",h.haveTextureLod?"#define HAVE_TEXTURE_LOD":"",A,h.fragmentPrefix,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define NUM_CUTPLANES "+h.numCutplanes,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",d.gammaInput?"#define GAMMA_INPUT":"",d.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+w,h.mrtNormals?"#define MRT_NORMALS":"",h.mrtIdBuffer?"#define MRT_ID_BUFFER":"",h.mrtIdBuffer>1?"#define MODEL_COLOR":"","#define TONEMAP_OUTPUT "+(h.tonemapOutput||0),h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define ENVMAP_TYPE_CUBE":"",h.envMap?"#define ENVMAP_MODE_REFLECTION":"",h.envMap?"#define ENVMAP_BLENDING_MULTIPLY":"",h.irradianceMap?"#define USE_IRRADIANCEMAP":"",h.envGammaEncoded?"#define ENV_GAMMA":"",h.irrGammaEncoded?"#define IRR_GAMMA":"",h.envRGBM?"#define ENV_RGBM":"",h.irrRGBM?"#define IRR_RGBM":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.vertexIds?"#define USE_VERTEX_ID":"",h.metal?"#define METAL":"",h.clearcoat?"#define CLEARCOAT":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",h.hatchPattern?"#define HATCH_PATTERN":"",h.mapInvert?"#define MAP_INVERT":"",h.useTiling?"#define USE_TILING":"",h.useTiling?"#define TILE_RANGE_X_MIN "+h.tilingRepeatRange[0]:"",h.useTiling?"#define TILE_RANGE_Y_MIN "+h.tilingRepeatRange[1]:"",h.useTiling?"#define TILE_RANGE_X_MAX "+h.tilingRepeatRange[2]:"",h.useTiling?"#define TILE_RANGE_Y_MAX "+h.tilingRepeatRange[3]:"",h.hasRoundCorner?"#define USE_TILING_NORMAL":"",h.useRandomOffset?"#define USE_TILING_RANDOM":"",r("map",h.mapClampS,h.mapClampT),r("bumpMap",h.bumpMapClampS,h.bumpMapClampT),r("normalMap",h.normalMapClampS,h.normalMapClampT),r("specularMap",h.specularMapClampS,h.specularMapClampT),r("alphaMap",h.alphaMapClampS,h.alphaMapClampT,h.alphaMapInvert),"#ifdef USE_ENVMAP","#ifdef HAVE_TEXTURE_LOD","#extension GL_EXT_shader_texture_lod : enable","#endif","#endif","#extension GL_OES_standard_derivatives : enable","precision "+h.precisionFragment+" float;","precision "+h.precisionFragment+" int;","uniform highp mat4 viewMatrix;","uniform highp mat4 projectionMatrix;","uniform highp vec3 cameraPosition;","#if defined(USE_ENVMAP) || defined(USE_IRRADIANCEMAP)","uniform mat4 viewMatrixInverse;","#endif",""].join("\n"),h.isPrism&&(x+=function(e){for(var t="\n",n=0;n<c.length;n++){var i=e[c[n]];i&&(t+=u(c[n],i.S,i.T)+"\n")}return t}(h)));var T=new o.WebGLShader(f,f.VERTEX_SHADER,b+v),M=new o.WebGLShader(f,f.FRAGMENT_SHADER,x+y);f.attachShader(E,T),f.attachShader(E,M),void 0!==_&&f.bindAttribLocation(E,0,_),f.linkProgram(E),"undefined"!=typeof DEBUG_SHADERS&&DEBUG_SHADERS&&(!1===f.getProgramParameter(E,f.LINK_STATUS)&&(s.error("THREE.WebGLProgram: Could not initialise shader."),s.error("gl.VALIDATE_STATUS",f.getProgramParameter(E,f.VALIDATE_STATUS)),s.error("gl.getError()",f.getError())),""!==f.getProgramInfoLog(E)&&s.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",f.getProgramInfoLog(E))),f.deleteShader(T),f.deleteShader(M);var S=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","viewMatrixInverse","mvpMatrix","dbId"];for(var C in h.logarithmicDepthBuffer&&S.push("logDepthBufFC"),m)S.push(C);for(var P in this.uniforms=function(e,t,n){for(var i={},r=0,o=n.length;r<o;r++){var a=n[r];i[a]=e.getUniformLocation(t,a)}return i}(f,E,S),S=["position","normal","uv","uv2","tangent","color","lineDistance","uvw","id","instOffset","instScaling","instRotation","prev","next","side"],g)S.push(P);return this.attributes=function(e,t,n){for(var i={},r=0,o=n.length;r<o;r++){var a=n[r];i[a]=e.getAttribLocation(t,a)}return i}(f,E,S),this.attributesKeys=Object.keys(this.attributes),this.id=i++,this.code=t,this.usedTimes=1,this.program=E,this.vertexShader=T,this.fragmentShader=M,this})},function(e,t,n){"use strict";n.r(t),n.d(t,"VertexBufferReader",function(){return o}),n.d(t,"BoundsCallback",function(){return a});var i=n(0),r=2*Math.PI;function o(e,t){this.vb=e.vb.buffer,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.ib=e.ib,this.stride=e.vbstride,this.vcount=this.vbf.length/this.stride,this.useInstancing=!!t}function a(e){this.bounds=e,this.point=new i.Vector4,this.point.z=0,this.point.w=1}o.prototype.getDbIdAt=function(e){return this.vbi[e*this.stride+7]},o.prototype.getVertexFlagsAt=function(e){return this.vbi[e*this.stride+8]},o.prototype.getLayerIndexAt=function(e){return 65535&this.vbi[e*this.stride+9]},o.prototype.getViewportIndexAt=function(e){return this.vbi[e*this.stride+9]>>16&65535},o.prototype.decodeLineAt=function(e,t,n,i){if(i.onLineSegment){var o=this.stride*e,a=this.vbf[o],s=this.vbf[o+1],l=this.vbf[o+2]*r-Math.PI,c=this.vbf[o+3],u=2*this.vbf[o+4],h=a+c*Math.cos(l),d=s+c*Math.sin(l);i.onLineSegment(a,s,h,d,n,u)}},o.prototype.decodeCircularArcAt=function(e,t,n,i){if(i.onCircularArc){var o=this.stride*e,a=this.vbf[o],s=this.vbf[o+1],l=this.vbf[o+2]*r,c=this.vbf[o+3]*r,u=this.vbf[o+5];i.onCircularArc(a,s,l,c,u,n)}},o.prototype.decodeEllipticalArcAt=function(e,t,n,i){if(i.onEllipticalArc){var o=this.stride*e,a=this.vbf[o],s=this.vbf[o+1],l=this.vbf[o+2]*r,c=this.vbf[o+3]*r,u=this.vbf[o+5],h=this.vbf[o+10],d=this.vbf[o+11];i.onEllipticalArc(a,s,l,c,u,h,d,n)}},o.prototype.decodeTexQuadAt=function(e,t,n,i){if(i.onTexQuad){var o=this.stride*e,a=this.vbf[o],s=this.vbf[o+1],l=this.vbf[o+2]*r,c=this.vbf[o+3],u=this.vbf[o+4];i.onTexQuad(a,s,c,u,l,n)}},o.prototype.decodeOneTriangleAt=function(e,t,n,i){if(i.onOneTriangle){var r=this.stride*e,o=this.vbf[r],a=this.vbf[r+1],s=this.vbf[r+2],l=this.vbf[r+3],c=this.vbf[r+4],u=this.vbf[r+5];i.onOneTriangle(o,a,s,l,c,u,n)}},o.prototype.decodeTriangleIndexed=function(e,t,n,i,r,o){if(o.onOneTriangle){var a=this.stride*e,s=this.vbf[a],l=this.vbf[a+1];a=this.stride*t;var c=this.vbf[a],u=this.vbf[a+1];a=this.stride*n;var h=this.vbf[a],d=this.vbf[a+1];o.onOneTriangle(s,l,c,u,h,d,r)}},o.prototype.enumGeomsForObject=function(e,t){if(this.useInstancing)for(var n=0;n<this.vcount;){var i=this.getVertexFlagsAt(n)>>8&255,r=this.getLayerIndexAt(n),o=this.getViewportIndexAt(n);if(s=this.getDbIdAt(n)===e)switch(i){case 1:this.decodeLineAt(n,r,o,t);break;case 2:this.decodeCircularArcAt(n,r,o,t);break;case 3:this.decodeEllipticalArcAt(n,r,o,t);break;case 4:this.decodeTexQuadAt(n,r,o,t);break;case 5:this.decodeOneTriangleAt(n,r,o,t)}n+=1}else for(n=0;n<this.ib.length;){var a=this.ib[n],s=(i=this.getVertexFlagsAt(a)>>8&255,r=this.getLayerIndexAt(a),o=this.getViewportIndexAt(a),this.getDbIdAt(a)===e);if(0===i)s&&this.decodeTriangleIndexed(this.ib[n],this.ib[n+1],this.ib[n+2],r,o,t),n+=3;else{if(s)switch(i){case 1:this.decodeLineAt(a,r,o,t);break;case 2:this.decodeCircularArcAt(a,r,o,t);break;case 3:this.decodeEllipticalArcAt(a,r,o,t);break;case 4:this.decodeTexQuadAt(a,r,o,t);break;case 5:this.decodeOneTriangleAt(a,r,o,t)}n+=6}}},o.prototype.enumGeomsForVisibleLayer=function(e,t){if(this.useInstancing)for(var n=0;n<this.vcount;){var i=this.getVertexFlagsAt(n)>>8&255,r=this.getLayerIndexAt(n),o=this.getViewportIndexAt(n);if(s=!e||0!==r&&-1!==e.indexOf(r))switch(i){case 1:this.decodeLineAt(n,r,o,t);break;case 2:this.decodeCircularArcAt(n,r,o,t);break;case 3:this.decodeEllipticalArcAt(n,r,o,t);break;case 4:this.decodeTexQuadAt(n,r,o,t);break;case 5:this.decodeOneTriangleAt(n,r,o,t)}n+=1}else for(n=0;n<this.ib.length;){var a=this.ib[n],s=(i=this.getVertexFlagsAt(a)>>8&255,r=this.getLayerIndexAt(a),o=this.getViewportIndexAt(a),!e||0!==r&&-1!==e.indexOf(r));if(0===i)s&&this.decodeTriangleIndexed(this.ib[n],this.ib[n+1],this.ib[n+2],r,o,t),n+=3;else{if(s)switch(i){case 1:this.decodeLineAt(a,r,o,t);break;case 2:this.decodeCircularArcAt(a,r,o,t);break;case 3:this.decodeEllipticalArcAt(a,r,o,t);break;case 4:this.decodeTexQuadAt(a,r,o,t);break;case 5:this.decodeOneTriangleAt(a,r,o,t)}n+=6}}},a.prototype.onVertex=function(e,t,n){this.point.x=e,this.point.y=t,this.bounds.expandByPoint(this.point)},a.prototype.onLineSegment=function(e,t,n,i,r){this.onVertex(e,t),this.onVertex(n,i)},a.prototype.onCircularArc=function(e,t,n,i,r,o){this.onEllipticalArc(e,t,n,i,r,r,0,o)},a.prototype.onEllipticalArc=function(e,t,n,i,r,o,a,s){0==a?n<=0&&i>=2*Math.PI-1e-5?this.onTexQuad(e,t,2*r,2*o,a,s):(this.point.x=e+Math.cos(n)*r,this.point.y=t+Math.sin(n)*o,this.bounds.expandByPoint(this.point),this.point.x=e+Math.cos(i)*r,this.point.y=t+Math.sin(i)*o,this.bounds.expandByPoint(this.point),n>i&&(this.point.x=e+r,this.point.y=t,this.bounds.expandByPoint(this.point),n-=2*Math.PI),n<.5*Math.PI&&i>.5*Math.PI&&(this.point.x=e,this.point.y=t+o,this.bounds.expandByPoint(this.point)),n<Math.PI&&i>Math.PI&&(this.point.x=e-r,this.point.y=t,this.bounds.expandByPoint(this.point)),n<1.5*Math.PI&&i>1.5*Math.PI&&(this.point.x=e,this.point.y=t-o,this.bounds.expandByPoint(this.point))):this.onTexQuad(e,t,2*r,2*o,a,s)},a.prototype.onTexQuad=function(e,t,n,r,o,a){var s=.5*n,l=.5*n;if(0==o)this.onVertex(e-s,t-l),this.onVertex(e+s,t+l);else{var c=new i.Matrix4,u=new i.Matrix4;c.makeRotationZ(o),u.makeTranslation(e,t,0),u.multiply(c);for(var h=0;h<4;h++)this.point.x=h%2==1?s:-s,this.point.y=h>=2?l:-l,this.point.applyMatrix4(u),this.bounds.expandByPoint(this.point)}},a.prototype.onOneTriangle=function(e,t,n,i,r,o,a){this.onVertex(e,t),this.onVertex(n,i),this.onVertex(r,o)}},function(e,t,n){"use strict";n.r(t),n.d(t,"SelectionMode",function(){return i});var i={LEAF_OBJECT:0,FIRST_OBJECT:1,LAST_OBJECT:2}},function(e,t,n){"use strict";function i(e,t){var n,i;this.bytes_per_node=t?32:36,e instanceof ArrayBuffer?(n=e.byteLength/this.bytes_per_node,i=e,this.nodeCount=n):(n=0|e,i=new ArrayBuffer(this.bytes_per_node*n),this.nodeCount=0),this.nodeCapacity=n,this.nodesRaw=i,this.is_lean_node=t,this.node_stride=this.bytes_per_node/4,this.node_stride_short=this.bytes_per_node/2,this.nodesF=new Float32Array(this.nodesRaw),this.nodesI=new Int32Array(this.nodesRaw),this.nodesS=new Uint16Array(this.nodesRaw)}n.r(t),n.d(t,"NodeArray",function(){return i}),n.d(t,"BVHBuilder",function(){return h}),i.prototype.setLeftChild=function(e,t){this.nodesI[e*this.node_stride+6]=t},i.prototype.getLeftChild=function(e){return this.nodesI[e*this.node_stride+6]},i.prototype.setPrimStart=function(e,t){this.is_lean_node?this.nodesI[e*this.node_stride+6]=t:this.nodesI[e*this.node_stride+8]=t},i.prototype.getPrimStart=function(e){return this.is_lean_node?this.nodesI[e*this.node_stride+6]:this.nodesI[e*this.node_stride+8]},i.prototype.setPrimCount=function(e,t){this.nodesS[e*this.node_stride_short+14]=t},i.prototype.getPrimCount=function(e){return this.nodesS[e*this.node_stride_short+14]},i.prototype.setFlags=function(e,t,n,i){this.nodesS[e*this.node_stride_short+15]=i<<3|n<<2|3&t},i.prototype.getFlags=function(e){return this.nodesS[e*this.node_stride_short+15]},i.prototype.setBox0=function(e,t){var n=e*this.node_stride,i=this.nodesF;i[n]=t[0],i[n+1]=t[1],i[n+2]=t[2],i[n+3]=t[3],i[n+4]=t[4],i[n+5]=t[5]},i.prototype.getBoxThree=function(e,t){var n=e*this.node_stride,i=this.nodesF;t.min.x=i[n],t.min.y=i[n+1],t.min.z=i[n+2],t.max.x=i[n+3],t.max.y=i[n+4],t.max.z=i[n+5]},i.prototype.getBoxArray=function(e,t,n){var i=e*this.node_stride,r=this.nodesF;t[0+(n=n||0)]=r[i],t[1+n]=r[i+1],t[2+n]=r[i+2],t[3+n]=r[i+3],t[4+n]=r[i+4],t[5+n]=r[i+5]},i.prototype.setBoxThree=function(e,t){var n=e*this.node_stride,i=this.nodesF;i[n]=t.min.x,i[n+1]=t.min.y,i[n+2]=t.min.z,i[n+3]=t.max.x,i[n+4]=t.max.y,i[n+5]=t.max.z},i.prototype.makeEmpty=function(e){var t=e*this.node_stride,n=this.nodesI;n[t+6]=-1,n[t+7]=0,this.is_lean_node||(n[t+8]=-1)},i.prototype.realloc=function(e){if(this.nodeCount+e>this.nodeCapacity){var t=0|3*this.nodeCapacity/2;t<this.nodeCount+e&&(t=this.nodeCount+e);var n=new ArrayBuffer(t*this.bytes_per_node),i=new Int32Array(n);i.set(this.nodesI),this.nodeCapacity=t,this.nodesRaw=n,this.nodesF=new Float32Array(n),this.nodesI=i,this.nodesS=new Uint16Array(n)}},i.prototype.nextNodes=function(e){this.realloc(e);var t=this.nodeCount;this.nodeCount+=e;for(var n=0;n<e;n++)this.makeEmpty(t+n);return t},i.prototype.getRawData=function(){return this.nodesRaw.slice(0,this.nodeCount*this.bytes_per_node)};var r=3,o=1e-5,a=1e-5,s=15,l=16,c=function(){function e(e,t,n){e[0]>t[n]&&(e[0]=t[n]),e[3]<t[n]&&(e[3]=t[n]),e[1]>t[n+1]&&(e[1]=t[n+1]),e[4]<t[n+1]&&(e[4]=t[n+1]),e[2]>t[n+2]&&(e[2]=t[n+2]),e[5]<t[n+2]&&(e[5]=t[n+2])}function t(e,t,n){e[0]>t[n]&&(e[0]=t[n]),e[1]>t[n+1]&&(e[1]=t[n+1]),e[2]>t[n+2]&&(e[2]=t[n+2]),e[3]<t[n+3]&&(e[3]=t[n+3]),e[4]<t[n+4]&&(e[4]=t[n+4]),e[5]<t[n+5]&&(e[5]=t[n+5])}function n(e,t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5])}function i(e,t,n,i){for(var r=0;r<3;r++)e[t+r]=n[i+3+r]-n[i+r]}function r(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]}var c=1/0;function u(e){e[0]=c,e[1]=c,e[2]=c,e[3]=-c,e[4]=-c,e[5]=-c}function h(e){var t=e[3]-e[0],n=e[4]-e[1],i=e[5]-e[2];return t<0||n<0||i<0?0:2*(t*n+n*i+i*t)}function d(){this.vb_left=new Float32Array(6),this.vb_right=new Float32Array(6),this.cb_left=new Float32Array(6),this.cb_right=new Float32Array(6),this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1}function f(){this.box_bbox=new Float32Array(6),this.box_centroid=new Float32Array(6),this.num_prims=0}function p(){this.BL=new Float32Array(6),this.CL=new Float32Array(6),this.NL=0,this.AL=0}d.prototype.reset=function(){this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1},f.prototype.reset=function(){this.num_prims=0,u(this.box_bbox),u(this.box_centroid)},p.prototype.reset=function(){this.NL=0,this.AL=0,u(this.BL),u(this.CL)};var m,g=[];for(m=0;m<l;m++)g.push(new f);var v=[];for(m=0;m<l-1;m++)v.push(new p);var y=new Float32Array(6),_=new Float32Array(6);function b(i,o,s,c,u,d,f){if(d[c]<i.scene_epsilon)f.best_cost=1/0;else{var p,m,b=l;for(b>s-o+1&&(b=s-o+1),p=0;p<b;p++)g[p].reset();for(p=0;p<b-1;p++)v[p].reset();for(f.num_bins=b,function(n,i,r,o,s,l,c){for(var u=n.centroids,h=n.primitives,d=n.finfo.boxes,f=n.finfo.boxStride,p=c*(1-a)/l[o],m=s[o],v=n.sort_prims,y=i;y<=r;y++){var _=0|h[y],b=0|p*(u[3*_+o]-m);b<0?b=0:b>=c&&(b=c-1),v[y]=b,g[b].num_prims++,t(g[b].box_bbox,d,_*f),e(g[b].box_centroid,u,3*_)}}(i,o,s,c,u,d,b),r(v[0].BL,g[0].box_bbox),r(v[0].CL,g[0].box_centroid),v[0].AL=h(v[0].BL),v[0].NL=g[0].num_prims,p=1;p<b-1;p++){m=g[p];var x=v[p];r(x.BL,v[p-1].BL),n(x.BL,m.box_bbox),x.AL=h(x.BL),r(x.CL,v[p-1].CL),n(x.CL,m.box_centroid),x.NL=v[p-1].NL+m.num_prims}r(y,g[p=b-1].box_bbox),r(_,g[p].box_centroid);var w=h(y),A=g[p].num_prims,E=p,T=w*A+v[p-1].AL*v[p-1].NL;for(r(f.vb_right,y),r(f.cb_right,g[p].box_centroid),r(f.vb_left,v[p-1].BL),r(f.cb_left,v[p-1].CL),f.num_left=v[p-1].NL,p-=1;p>=1;p--){m=g[p],n(y,m.box_bbox),n(_,m.box_centroid);var M=(w=h(y))*(A+=m.num_prims)+v[p-1].AL*v[p-1].NL;M<=T&&(T=M,E=p,r(f.vb_right,y),r(f.cb_right,_),r(f.vb_left,v[p-1].BL),r(f.cb_left,v[p-1].CL),f.num_left=v[p-1].NL)}f.best_split=E,f.best_cost=T}}var x=new Float32Array(3);return{bvh_subdivide:function(t,n,r,o,a,l,c,h){i(x,0,l,0);var f=t.nodes,p=c?t.frags_per_leaf_node_transparent:t.frags_per_leaf_node,m=c?t.frags_per_inner_node_transparent:t.frags_per_inner_node,g=t.max_polys_per_node,v=0;x[1]>x[0]&&(v=1),x[2]>x[v]&&(v=2),f.setBox0(n,a);var y=0,_=0,w=o-r+1;if(t.finfo.hasPolygonCounts&&t.frags_per_inner_node)for(var A=w<=t.frags_per_inner_node?o:r+t.frags_per_inner_node-1,E=r;E<=A&&(_++,!((y+=t.finfo.getPolygonCount(t.primitives[E]))>g));E++);if(w<=p&&y<g||1===w||h>s||x[v]<t.scene_epsilon)return f.setLeftChild(n,-1),f.setPrimStart(n,r),f.setPrimCount(n,o-r+1),void f.setFlags(n,0,0,c?1:0);m&&(v=function(t,n,r,o,a,s,l,c){var h=t.primitives,d=t.centroids,f=a-o+1;f>t.frags_per_inner_node&&(f=t.frags_per_inner_node),f>c&&(f=c),n.setPrimStart(r,o),n.setPrimCount(r,f),o+=f,u(s);for(var p=o;p<=a;p++)e(s,d,3*h[p]);i(l,0,s,0);var m=0;return l[1]>l[0]&&(m=1),l[2]>l[m]&&(m=2),m}(t,f,n,r,o,l,x,_),r+=f.getPrimCount(n));var T=new d;if(b(t,r,o,v,l,x,T),T.num_bins<0)f.setPrimCount(n,f.getPrimCount(n)+o-r+1);else{!function(e,t,n,i,r,o,a){var s,l,c=e.primitives,u=e.sort_prims,h=0,d=0|t,f=0|a.best_split;for(s=t;s<=n;s++){var p=0|c[s];u[s]<f?c[d++]=p:u[h++]=p}for(l=0;l<h;l++)c[d+l]=u[l]}(t,r,o,0,0,0,T);var M=f.nextNodes(2),S=.5*(T.vb_left[3+v]+T.vb_left[v]),C=.5*(T.vb_right[3+v]+T.vb_right[v]);f.setFlags(n,v,S<C?0:1,c?1:0),f.setLeftChild(n,M),t.recursion_stack.push([t,M+1,r+T.num_left,o,T.vb_right,T.cb_right,c,h+1]),t.recursion_stack.push([t,M,r,r+T.num_left-1,T.vb_left,T.cb_left,c,h+1])}},compute_boxes:function(n){var r=n.boxv_o,a=n.boxc_o,s=n.boxv_t,l=n.boxc_t;u(r),u(a),u(s),u(l);for(var c,h,d,f,p=n.centroids,m=n.finfo.boxes,g=n.finfo.boxStride,v=0,y=n.prim_count;v<y;v++){var _=n.primitives[v];d=m,f=g*_,(c=p)[h=3*_]=.5*(d[f]+d[f+3]),c[h+1]=.5*(d[f+1]+d[f+4]),c[h+2]=.5*(d[f+2]+d[f+5]),v>=n.first_transparent?(e(l,p,3*_),t(s,m,g*_)):(e(a,p,3*_),t(r,m,g*_))}i(x,0,n.boxv_o,0);var b=Math.max(x[0],x[1],x[2]);n.scene_epsilon=o*b},box_area:function(e,t){var n=e[t+3]-e[t],i=e[t+4]-e[t+1],r=e[t+5]-e[t+2];return n<0||i<0||r<0?0:2*(n*i+i*r+r*n)}}}();function u(e,t){this.boxes=e.boxes,this.polygonCounts=e.polygonCounts,this.hasPolygonCounts=!!this.polygonCounts,this.materials=e.materials,this.materialDefs=t,this.count=e.length,this.boxStride=6,this.wantSort=!0}function h(e,t,n){this.finfo=n||new u(e,t),this.prim_count=this.finfo.getCount(),this.frags_per_leaf_node=-1,this.frags_per_inner_node=-1,this.nodes=null,this.work_buf=new ArrayBuffer(4*this.prim_count),this.sort_prims=new Int32Array(this.work_buf),this.primitives=new Int32Array(this.prim_count),this.centroids=new Float32Array(r*this.prim_count),this.boxv_o=new Float32Array(6),this.boxc_o=new Float32Array(6),this.boxv_t=new Float32Array(6),this.boxc_t=new Float32Array(6),this.recursion_stack=[]}u.prototype.getCount=function(){return this.count},u.prototype.isTransparent=function(e){return!(!this.materialDefs||!this.materialDefs[this.materials[e]])&&this.materialDefs[this.materials[e]].transparent},u.prototype.getPolygonCount=function(e){return this.polygonCounts[e]},h.prototype.sortPrimitives=function(e){var t,n,i=new Float32Array(this.work_buf),r=this.primitives,o=0,a=e;for(t=0,n=this.prim_count;t<n;t++){r[t]=t;var s=this.finfo.isTransparent(t);s&&o++,a?(i[t]=c.box_area(this.finfo.boxes,this.finfo.boxStride*t),s&&(i[t]=-i[t])):i[t]=s?-1:1}if(a)Array.prototype.sort.call(this.primitives,function(e,t){return i[t]-i[e]});else if(o&&o<this.prim_count){var l=new Int32Array(o),u=0,h=0;for(t=0,n=this.prim_count;t<n;t++)i[t]>=0?r[u++]=r[t]:l[h++]=r[t];r.set(l,this.prim_count-o)}this.first_transparent=this.prim_count-o},h.prototype.build=function(e){var t=e&&!!e.useSlimNodes,n=this;function r(t,i){e.hasOwnProperty(t)?n[t]=e[t]:n[t]=i}if(t)r("frags_per_leaf_node",1),r("frags_per_inner_node",0),r("frags_per_leaf_node_transparent",1),r("frags_per_inner_node_transparent",0),r("max_polys_per_node",1/0);else{var o=e.isWeakDevice?.5:1;r("frags_per_leaf_node",0|256*o),r("frags_per_inner_node",0|this.frags_per_leaf_node),r("frags_per_leaf_node_transparent",this.frags_per_leaf_node),r("frags_per_inner_node_transparent",0),r("max_polys_per_node",0|2e4*o)}if(this.nodes&&this.nodes.is_lean_node==t)this.nodes.nodeCount=0;else{for(var a=this.prim_count/this.frags_per_leaf_node,s=1;s<a;)s*=2;this.nodes=new i(s,!!e&&e.useSlimNodes)}this.sortPrimitives(this.finfo.wantSort),c.compute_boxes(this);var l,u=this.nodes.nextNodes(2);for(c.bvh_subdivide(this,u,0,this.first_transparent-1,this.boxv_o,this.boxc_o,!1,0);this.recursion_stack.length;)l=this.recursion_stack.pop(),c.bvh_subdivide(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7]);for(c.bvh_subdivide(this,u+1,this.first_transparent,this.prim_count-1,this.boxv_t,this.boxc_t,!0,0);this.recursion_stack.length;)l=this.recursion_stack.pop(),c.bvh_subdivide(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7])}},function(e,t,n){"use strict";n.r(t),n.d(t,"Document",function(){return p});var i=n(26),r=n(7),o=n(4),a=n(12),s=n(3),l=n(129),c=n(1),u=n(48),h=n(11);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var f=Object(s.getGlobal)();function p(e,t,n){this.myPath=t,this.myData=e,e&&(this.docRoot=new i.BubbleNode(e),this.docRoot.setDocument(this)),this.myNumViews={},this.myPropertyDb=null,this.acmSessionId=n;var r=this;this.docRoot.traverse(function(e){if(!r.myPropertyDb&&e.isGeometry()){var t=e.findPropertyDbPath();r.myPropertyDb=t}if(e.isViewPreset()){var n=e.findParentGeom2Dor3D(),i=r.myNumViews[n.guid()]||0;r.myNumViews[n.guid()]=i+1}}),0===this.docRoot.findAllViewables().length&&c.logger.error("Document contains no viewables.")}p.load=function(e,t,n,i){var s,l,c=p.getDocumentPath(e),h=o.endpoint.getApiFlavor()===o.endpoint.ENDPOINT_API_FLUENT;function d(e){h&&(s=s?e.urn+","+s:e.urn);var i=new p(e,c,s);if(i.getRoot().search({type:"geometry"}).length>0)l=i.getGlobalMessages(),t&&t(i,l);else if(n){l=i.getGlobalMessages();var o=r.ErrorCodes.BAD_DATA_NO_VIEWABLE_CONTENT;n(o,"No viewable content",l)}}function m(e,t,i){if(401===e&&void 0===f.LMV_THIRD_PARTY_COOKIE)f.LMV_THIRD_PARTY_COOKIE=!1,Object(u.refreshRequestHeader)(u.token.accessToken),g();else if(n){var o="Error: "+e+" ("+t+")",a=Object(r.getErrorCode)(e);n(a,o,e,t,i)}}function g(){var e=!i||h&&!i["x-ads-acm-scopes"];s||e?a.ViewingService.getManifest(o.endpoint.initLoadContext(),c,d,m):(i.oauth2AccessToken||(i.oauth2AccessToken=u.token.accessToken),a.ViewingService.getACMSession(o.endpoint.getApiEndpoint(),i,function(e){var t={queryParams:(s=e)?"acmsession="+s:""};a.ViewingService.getManifest(o.endpoint.initLoadContext(t),c,d,m)},n))}g()},p.getDocumentPath=function(e){if(-1===e.indexOf("urn:")){if(-1!==e.indexOf("://"))return e;var t=e;return"undefined"!=typeof window?(0!==t.indexOf("/")&&(t="/"+t),window.location.protocol+"//"+window.location.host+t):t}return e},p.requestThumbnailWithSecurity=function(e,t){var n={responseType:"blob",skipAssetCallback:!0,size:e.width,guid:e.guid},i="urn:"+e.urn;a.ViewingService.getThumbnail(o.endpoint.initLoadContext(),i,function(e){t(null,e)},function(){t("error",null)},n)},p.prototype.getFullPath=function(e){if(!e)return e;var t=e;return Object(o.isOffline)()?-1==t.indexOf(Object(o.getOfflineResourcePrefix)())&&(t=decodeURIComponent(Object(o.getOfflineResourcePrefix)())+t.substr(t.indexOf("/"))):0===e.indexOf("urn")?t=o.endpoint.getItemApi(null,e):0===e.indexOf("$file$")&&(t=this.myPath.replace("/bubble.json","")+e.replace("$file$","")),t},p.prototype.getThumbnailOptions=function(e,t,n){var i=t||200,r=n||200;return{urn:this.myData.urn,width:i,height:r,guid:e.guid,acmsession:this.acmSessionId}},p.prototype.getThumbnailPath=function(e,t,n){var i=this.getThumbnailOptions(e,t,n),r=o.endpoint.getThumbnailApi(null,i.urn)+"?guid="+i.guid+"&width="+i.width+"&height="+i.height;return i.acmsession&&(r+="&acmsession="+i.acmsession),r},p.prototype.getLeafletZipParams=function(e,t){for(var n,i,r=t.search({role:"leaflet-zip"},!1),a=0;a<r.length;a++){i={};var s=(n=r[a]._raw()).urn;s&&(s=o.endpoint.getApiFlavor()===o.endpoint.ENDPOINT_API_FLUENT?o.endpoint.getItemApi(o.endpoint.getApiEndpoint(),s,"derivativeV2"):this.getFullPath(s)),i.urnZip=this.getFullPath(s),i.centralDirOffset=n.central_dir_offset,i.centralDirLength=n.central_dir_length,i.centralDirEntries=n.central_dir_entries,i.zipMaxLevel=n.max_level-e.levelOffset,i.loadFromZip=!!(i.urnZip&&i.centralDirOffset&&i.centralDirLength&&i.centralDirEntries),i.fileTable=[],e.zips||(e.zips=[]),e.zips.push(i)}e.zips.sort(function(e,t){return e.zipMaxLevel-t.zipMaxLevel})},p.prototype.getLeafletParams=function(e,t,n){e.tileSize=n.tileSize?n.tileSize:512,e.texWidth=n.resolution[0],e.texHeight=n.resolution[1],e.paperWidth=n.paperWidth,e.paperHeight=n.paperHeight,e.paperUnits=n.paperUnits,e.urlPattern=n.urn,e.mime=n.mime,e.isLeaflet=!0,e.levelOffset=l.LeafletLoader.computeLevelOffset(e.tileSize),this.getLeafletZipParams(e,t),e.loadFromZip=e.zips&&e.zips[0].loadFromZip,e.zips&&Object(o.isOffline)()&&Object(s.isMobileDevice)()&&(e.zips=e.zips.slice(0,1),e.maxLevel=e.zips[0].zipMaxLevel)},p.prototype.derivePdfUrnHack=function(e,t){var n=e.parent.children.slice();n.sort(function(e,t){return e._raw().order-t._raw().order});var r=(n.length<=75?n[n.length-1]:n[74]).search(i.BubbleNode.GEOMETRY_F2D_NODE)[0];if(r){var o=r.urn().indexOf("/"),a=r.urn().slice(0,o),s=e._raw().order,l=0|s%75,c=1+(0|s/75),u=a+"/output/".concat(l,"/").concat(l,".pdf");return t.page=c,t.isPdf=!0,console.log("pdf path",u),u}return null},p.prototype.getViewableUrn=function(e,t){var n;if(e instanceof i.BubbleNode)n=e;else{var r=this.docRoot.search(e);n=r.length>0?r[0]:new i.BubbleNode(e)}if(n.isGeometry()){if(n.is3D())return n.getViewableRootPath();if(n.is2D()){var o="true"===Object(h.getParameterByName)("vectorPdf")||Object(s.getGlobal)().LMV_VECTOR_PDF,a=o||!1,l=n.search(i.BubbleNode.PDF_PAGE_NODE);if(a&&l.length)return t.isPdf=!0,t.page=1,l[0].urn();var c=n.search(i.BubbleNode.LEAFLET_NODE);if(c.length>0&&t){if(o){var u=this.derivePdfUrnHack(n,t);if(u)return u}return this.getLeafletParams(t,n,c[0]._raw()),c[0].urn()}var d=n.search(i.BubbleNode.IMAGE_NODE);if(d.length)return d[0].urn();var f=n.search(i.BubbleNode.GEOMETRY_F2D_NODE);if(f.length)return f[0].urn()}}else if(n.isViewPreset()){var p=this.getViewGeometry(n,!0);if(p)return this.getViewableUrn(p,t)}return""},p.prototype.getViewablePath=function(e,t){var n=this.getViewableUrn(e,t);return n?this.getFullPath(n):""},p.prototype.downloadAecModelData=function(e){var t=this.docRoot.search({role:"Autodesk.AEC.ModelData"})[0];if(t){var n=t.findViewableParent(),i=function(t){n.data.aec_model_data=t,e&&e(t)},r={};this.acmSessionId&&(r.queryParams="acmsession="+this.acmSessionId);var s=t.urn(),l=o.endpoint.getItemApi(o.endpoint.getApiEndpoint(),s,"derivativeV2");a.ViewingService.getItem(o.endpoint.initLoadContext(r),l,function(e){return i(e)},function(){return i()},{responseType:"json"})}else e&&e()},p.prototype.getPropertyDbPath=function(){return this.getFullPath(this.myPropertyDb)},p.prototype.getRootItem=function(){return this.myData},p.prototype.getRoot=function(){return this.docRoot},p.prototype.getPath=function(){return this.myPath},p.prototype.getItemById=function(e){return function t(n){if(!n)return null;for(var i in n){var r=n[i];if("guid"===i&&r===e)return n;if(null!==r&&"object"===d(r)&&"parent"!==i){var o=t(r);if(o)return o}}return null}(this.myData)},p.getSubItemsWithProperties=function(e,t,n){var i=[];if(!e)return[];function r(e,t){for(var n in t)if(!(n in e)||t[n]!==e[n])return!1;return!0}for(var o=e.children||e.derivatives,a=o?o.length:0,s=0;s<a;s++){var l=o[s];r(l,t)&&i.push(l),n&&i.push.apply(i,p.getSubItemsWithProperties(l,t,n))}return i},p.getViewableItems=function(e,t){return t?e.getRoot().findAllViewables():(console.warn("Deprecated use of Document.getViewableItems(). Adjust call too pass 'true' as second argument and use BubbleNode result."),p.getSubItemsWithProperties(e.getRootItem(),{type:"folder",role:"viewable"},!0).concat(p.getSubItemsWithProperties(e.getRootItem(),{outputType:"svf"},!0)))},p.prototype.getViewGeometry=function(e,t){var n=e.findParentGeom2Dor3D();return t?n:n._raw()},p.prototype.getNumViews=function(e){return e instanceof i.BubbleNode||(console.warn("Deprecated use of Document.getNumViews(). Pass in instance of BubbleNode instead of raw JSON."),e=new i.BubbleNode(e)),this.myNumViews[e.guid()]||0},p.prototype.getParentId=function(e){var t=this.getItemById(e);if(!t)return null;var n=t.parent;return n?n.guid:null},p.prototype.getMessages=function(e,t){var n=[];if(!e)return n;if(e instanceof i.BubbleNode)for(var r=e;r&&(!t||r.parent);)r._raw().messages&&(n=n.concat(r._raw().messages)),r=r.parent;else{console.warn("deprecated call to getMessages. Call with BubbleNode instead of raw manifest JSON");var o=null;t&&(o=this.getRootItem());for(r=e;r&&(!t||parent!==o);)r.messages&&(n=n.concat(r.messages)),r=r.parent}return n},p.prototype.getGlobalMessages=function(){var e=[],t=0,n=0;this.getRoot().traverse(function(i){var r=i._raw().messages||[];r.filter(function(e){return"error"===e.type}).length>0&&(t+=1),"inprogress"===i._raw().status&&(n+=1),e=e.concat(r)});var i="translated";i=t>0?"failed":i,i=n>0?"processing":i;for(var r=e.length;r--;e[r].$translation=i);return e}},function(e,t,n){"use strict";n.r(t),n.d(t,"LayersPanel",function(){return c});var i=n(2),r=n(9),o=n(28),a=n(62),s=n(152),l=n(101);function c(e,t,n,r){this.viewer=e,this.tree=null,this.layersRoot=null,this.visibilityImages={},this.isMac=-1!==navigator.userAgent.search("Mac OS");e.config.viewableName;o.DockingPanel.call(this,e.container,n,"Layers",r),this.container.classList.add("layers-panel"),this.container.style.top="10px",this.container.style.left="10px";var a=this;e.model?a.build():a.addEventListener(e,i.GEOMETRY_LOADED_EVENT,function(){a.build()});var s=!1;this.addVisibilityListener(function(){s||(s=!0,a.resizeToContent())})}c.prototype=Object.create(o.DockingPanel.prototype),c.prototype.constructor=c,c.prototype.uninitialize=function(){o.DockingPanel.prototype.uninitialize.call(this),this.viewer=null,this.tree=null,this.layersRoot=null,this.scrollContainer=null},c.prototype.build=function(){var e=this;var t=document.createElement("div");t.classList.add("visibility"),t.title=r.i18n.translate("Show/hide all layers"),t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),this.viewer.setLayerVisible(null,this.viewer.allLayersHidden())}.bind(this)),this.container.appendChild(t),this.toogleAllVisibleButton=t;var n=null,o="",c=e.viewer;function u(){o?f&&0<f.childCount&&(e.lockoutClearFilter=!0,c.setLayerVisible(function e(t){var n=[];if(-1!==t.name.toLowerCase().indexOf(o))n.push(t);else if(!t.isLayer)for(var i=t.children,r=0;r<i.length;++r)n=n.concat(e(i[r]));return n}(f),!0,!0),e.lockoutClearFilter=!1):c.setLayerVisible(null,!0),n=null}this.filterbox=new s.Filterbox(this.viewer.container.id+"LayersPanel-Filterbox",{filterFunction:function(e){n&&clearTimeout(n),o=e?e.toLowerCase():e,n=setTimeout(u,500)}}),this.container.appendChild(this.filterbox.container),this.createScrollContainer({heightAdjustment:104,marginTop:0});var h=document.createElement("div");h.classList.add("docking-panel-container-gradient"),h.style.width="100%",h.style.height="100%",this.scrollContainer.appendChild(h);var d=function(){var t=new a.TreeDelegate;return t.getTreeNodeId=function(e){return e.id},t.getTreeNodeLabel=function(t){return e.getNodeLabel(t)},t.getTreeNodeClass=function(t){return e.getNodeClass(t)},t.isTreeNodeGroup=function(t){return e.isGroupNode(t)},t.shouldCreateTreeNode=function(t){return e.shouldInclude(t)},t.onTreeNodeClick=function(t,n,i){e.onClick(n,i)},t.onTreeNodeRightClick=function(t,n,i){e.onRightClick(n,i)},t.onTreeNodeDoubleClick=function(t,n,i){e.onDoubleClick(n,i)},t.onTreeNodeIconClick=function(t,n,i){e.onIconClick(n,i)},t.createTreeNode=function(t,n){e.createNode(t,n)},t}(),f=e.layersRoot=e.viewer.impl.getLayersRoot();f&&(e.tree=new l.Tree(d,f,h,{excludeRoot:!0}),e.update(),e.addEventListener(e.viewer,i.LAYER_VISIBILITY_CHANGED_EVENT,function(){e.update()}))},c.prototype.update=function(){var e=this;this.layersRoot&&0<this.layersRoot.childCount&&function t(n){var i;n.id;if(n.isLayer){var r=e.viewer.isLayerVisible(n)?1:0;i=n,0===r?e.tree.addClass(i.id,"dim"):e.tree.removeClass(i.id,"dim")}else for(var o=n.children,a=0;a<o.length;++a)t(o[a])}(e.layersRoot),this.viewer.allLayersHidden()?this.toogleAllVisibleButton.classList.add("dim"):this.toogleAllVisibleButton.classList.remove("dim")},c.prototype.setLayerVisible=function(e,t){var n=t;null===e||t||(n=!this.viewer.impl.layers.isLayerVisible(e)),this.viewer.setLayerVisible(e,n,t),this.viewer.clearSelection()},c.prototype.getNodeLabel=function(e){return e.isLayer||0===e.childCount?e.name:e.name+" ("+e.childCount+")"},c.prototype.getNodeClass=function(e){return""},c.prototype.isGroupNode=function(e){return!e.isLayer},c.prototype.shouldInclude=function(e){return!0},c.prototype.onIconClick=function(e,t){this.setGroupCollapsed(e,!this.isGroupCollapsed(e))},c.prototype.setGroupCollapsed=function(e,t){var n=this.tree.delegate();if(n.isTreeNodeGroup(e)){var i=n.getTreeNodeId(e);this.tree.setCollapsed(i,t)}},c.prototype.isGroupCollapsed=function(e){var t=this.tree.delegate();if(t.isTreeNodeGroup(e)){var n=t.getTreeNodeId(e);return this.tree.isCollapsed(n)}return!1},c.prototype.onClick=function(e,t){},c.prototype.onDoubleClick=function(e,t){},c.prototype.onRightClick=function(e,t){},c.prototype.onImageClick=function(e,t){},c.prototype.getContentSize=function(){var e={width:0,height:this.options.heightAdjustment||0},t=this.filterbox.container;e.width+=t.clientWidth,e.height+=t.clientHeight;var n=this.container.querySelectorAll("leaf");return n.length>0&&(e.height+=n[0].clientHeight*n.length),e},c.prototype.createNode=function(e,t){var n=document.createElement("div");n.dbId=e,n.classList.add("visibility"),n.title=r.i18n.translate("Show/hide this layer"),n.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation()}.bind(this)),n.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),this.onImageClick(e,t)}.bind(this)),t.appendChild(n);var i=document.createElement("label");i.textContent=this.getNodeLabel(e),t.appendChild(i)}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i="search-selected"},function(e,t,n){"use strict";n.r(t),n.d(t,"ViewerLayersPanel",function(){return a});var i=n(59),r=n(78),o=n(2);function a(e){var t=e.container;r.LayersPanel.call(this,e,t,t.id+"ViewerLayersPanel",{heightAdjustment:55}),this.onRestoreStateBinded=this.onRestoreState.bind(this),this.viewer.addEventListener(o.VIEWER_STATE_RESTORED_EVENT,this.onRestoreStateBinded)}a.prototype=Object.create(r.LayersPanel.prototype),a.prototype.constructor=a,i.ViewerPanelMixin.call(a.prototype),a.prototype.uninitialize=function(){this.onRestoreStateBinded&&(this.viewer.removeEventListener(o.VIEWER_STATE_RESTORED_EVENT,this.onRestoreStateBinded),this.onRestoreStateBinded=null),r.LayersPanel.prototype.uninitialize.call(this)},a.prototype.onRestoreState=function(){this.update()},a.prototype.onClick=function(e,t){if(!this.isMac||!t.ctrlKey){var n=!(t.shiftKey||t.metaKey||t.ctrlKey);this.setLayerVisible(e,n)}},a.prototype.onRightClick=function(e,t){var n=!(t.shiftKey||t.metaKey||t.ctrlKey);this.setLayerVisible(e,n)},a.prototype.onImageClick=function(e,t){this.isMac&&t.ctrlKey||this.setLayerVisible(e)},a.prototype.onTitleClick=function(e){this.viewer.setLayerVisible(null,!0)},a.prototype.onTitleDoubleClick=function(e){this.viewer.fitToView()}},function(e,t,n){"use strict";function i(e,t){return t<=255?new Uint8Array(e):t<=65535?new Uint16Array(e):new Uint32Array(e)}function r(e,t){if(t<=255)return e;if(t<=65535&&e instanceof Uint8Array){var n=new Uint16Array(e.length);return n.set(e),n}if(!e instanceof Uint32Array){var i=new Uint32Array(e.length);return i.set(e),i}return e}n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r})},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return o});var i=n(0);function r(){this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1}function o(){var e=[],t=0,n=new r;function o(e,t){var r=t||n,o=[];o.push(new i.Vector2(r.offsetX,r.offsetY)),o.push(new i.Vector2(r.offsetX+r.scaleX,r.offsetY)),o.push(new i.Vector2(r.offsetX+r.scaleX,r.offsetY+r.scaleY)),o.push(new i.Vector2(r.offsetX,r.offsetY+r.scaleY)),e.faceVertexUvs[0].length=0,e.faceVertexUvs[0].push([o[0],o[1],o[2]]),e.faceVertexUvs[0].push([o[0],o[2],o[3]]),e.uvTransform=r,e.uvsNeedUpdate=!0}this.acquireQuadGeom=function(n){var i=e[t];return i?o(i,n):(i=this.createQuadGeom(n),e[t]=i),t++,i},this.createQuadGeom=function(e){var t=new i.Geometry;return t.vertices.push(new i.Vector3(0,0,0),new i.Vector3(1,0,0),new i.Vector3(1,1,0),new i.Vector3(0,1,0)),t.faces.push(new i.Face3(0,1,2)),t.faces.push(new i.Face3(0,2,3)),o(t,e),t.computeFaceNormals(),t},this.reset=function(){t=0},this.dispose=function(){for(var t=0;t<e.length;t++){var n=e[t];n&&(n.dispose(),n.needsUpdate=!0)}}}r.prototype.toVec4=function(){return new i.Vector4(this.offsetX,this.offsetY,this.scaleX,this.scaleY)},r.prototype.copyTo=function(e){e.offsetX=this.offsetX,e.offsetY=this.offsetY,e.scaleX=this.scaleX,e.scaleY=this.scaleY}},function(e,t,n){"use strict";n.r(t),n.d(t,"formatValueWithUnits",function(){return r}),n.d(t,"convertUnits",function(){return o}),n.d(t,"calculatePrecision",function(){return a});var i=n(9);function r(e,t,n,o){function a(e){var t=0<=e?Math.floor(e):Math.ceil(e);return{intPart:t,fracPart:e-t}}function s(e,t,n){var i="";return n&&0===e&&(i+="-"),i+=0<t?e.toFixed(t):e.toFixed(0)}function l(e,t,n){for(var i,r,o="",l=1,c=e<0,u=0;u<t;++u)l*=2;e>0?e+=.5/l:e-=.5/l,n?r=e:(o+=s(i=a(e/12).intPart,0,c)+"' ",(r=e-12*i)<0&&(r=-r));var h=a(r).intPart,d=a((r-h)*l).intPart;if(0!==d&&0===h||(o+=s(h,0)),0!==d){for(h<0&&d<0&&(d=-d);d%2==0;)d/=2,l/=2;0!==h&&(o+="-"),o+=s(d,0)+"/"+s(l,0)}return o+='"'}function c(e,t){var n="";e<0&&(n="-",e=Math.abs(e));var i=a(e),r=i.intPart,o=100*i.fracPart;return n+s(r,0)+" m "+s(o,t)+" cm"}function u(e,t){var n="";e<0&&(n="-",e=Math.abs(e));var i=a(e),r=i.intPart,o=12*i.fracPart;return n+s(r,0)+"' "+s(o,t)+'"'}var h;null==o&&(o=3);try{if(1===n)h=i.i18n.translate(e?"Yes":"No");else if(24===n){var d=e.split(" ");h=[];for(var f=0;f<d.length;++f)h.push(r(parseFloat(d[f]),t,3,o));h=h.join(", ")}else 2!==n&&3!==n||!isNaN(e)?"ft-and-fractional-in"===t?h=l(12*e,o):"ft-and-fractional-in^2"===t?h=l(12*e,o)+" "+String.fromCharCode(178):"ft-and-decimal-in"===t?h=u(e,o):"ft-and-decimal-in^2"===t?h=u(e,o)+" "+String.fromCharCode(178):"decimal-in"===t||"in"===t||"inch"===t?h=s(e,o)+'"':"decimal-in^2"===t||"in^2"===t||"inch^2"===t?h=s(e,o)+'" '+String.fromCharCode(178):"decimal-ft"===t||"ft"===t||"feet"===t||"foot"===t?h=s(e,o)+"'":"decimal-ft^2"===t||"ft^2"===t||"feet^2"===t||"foot^2"===t?h=s(e,o)+"' "+String.fromCharCode(178):"fractional-in"===t?h=l(e,o,!0):"fractional-in^2"===t?h=l(e,o,!0)+" "+String.fromCharCode(178):"m-and-cm"===t?h=c(e,o):"m-and-cm^2"===t?h=c(e,o)+" "+String.fromCharCode(178):3===n&&t?(t=(t=t.replace("^2",String.fromCharCode(178))).replace("^3",String.fromCharCode(179)),h=s(e,o)+" "+t):h=t?e+" "+t:3===n?s(e,o):e:h="NaN"}catch(n){h=t?e+" "+t:e}return h}function o(e,t,n,i,r){if(n=n||1,e===t&&1==n)return i;var o=1;switch(t){case"mm":o=1e3;break;case"cm":o=100;break;case"m":o=1;break;case"in":o=39.37007874;break;case"ft":case"ft-and-fractional-in":case"ft-and-decimal-in":o=3.280839895;break;case"decimal-in":o=39.37007874;break;case"decimal-ft":o=3.280839895;break;case"fractional-in":o=39.37007874;break;case"m-and-cm":o=1}var a=1;switch(e){case"mm":a=.001;break;case"cm":a=.01;break;case"m":a=1;break;case"in":a=.0254;break;case"ft":case"ft-and-fractional-in":case"ft-and-decimal-in":a=.3048;break;case"decimal-in":a=.0254;break;case"decimal-ft":a=.3048;break;case"fractional-in":a=.0254;break;case"m-and-cm":a=1}return"square"===r?i*Math.pow(o*a*n,2):i*o*a*n}function a(e){if(!e)return 0;var t=e.toString().split(".")[1];if(!t){var n=e.toString().split("/")[1],i=n&&n.match(/\d+/);if(i){var r=parseFloat(i);if(r&&!isNaN(r))return Math.floor(Math.log2(r))}return 0}return(t=t.match(/\d+/))&&t[0]&&t[0].length||0}},function(e,t,n){"use strict";n.r(t),n.d(t,"createGroundShape",function(){return M}),n.d(t,"setGroundShapeTransform",function(){return S}),n.d(t,"GroundShadow",function(){return C});var i,r,o,a=n(22),s=n(31),l=n(172),c=n.n(l),u=n(173),h=n.n(u),d=n(36),f=n.n(d),p=n(174),m=n.n(p),g=n(175),v=n.n(g),y=n(176),_=n.n(y),b=n(21),x=n(0),w={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:c.a,fragmentShader:h.a},A={uniforms:{tDepth:{type:"t",value:null},worldSize:{type:"v3",value:new x.Vector3(1,1,1)}},defines:{},vertexShader:f.a,fragmentShader:m.a},E={uniforms:{tDepth:{type:"t",value:null}},defines:{},vertexShader:f.a,fragmentShader:v.a},T={uniforms:{tDepth:{type:"t",value:null},uShadowColor:{type:"v4",value:new x.Vector4(0,0,0,1)}},vertexShader:f.a,fragmentShader:_.a};function M(e){var t=new x.PlaneBufferGeometry(1,1);if(t.attributes.index.array.reverse)t.attributes.index.array.reverse();else for(var n,i=t.attributes.index.array,r=Math.floor(i.length/2),o=0,a=i.length;o<r;++o)n=i[o],i[o]=i[a-1-o],i[a-1-o]=n;return new x.Mesh(t,e)}function S(e,t,n,a,s){i||(i=new x.Matrix4),r||(r=new x.Vector3),o||(o=new x.Vector3),r.subVectors(t,a),i.lookAt(r,t,s),o.copy(a).multiplyScalar(-.5*n.y).add(t),e.position.copy(o),e.rotation.setFromRotationMatrix(i),e.scale.set(n.z,n.x,n.y)}function C(e,t){var n,i,r,o,l,c,u,h,d,f,p,m,g,v,y,_,C,P,L,R=e,D=!1,I=!0,O=b.GroundFlags.GROUND_FINISHED,N={texSize:64,pixScale:1,blurRadius:7,debug:!1};if(this.setTransform=(m=new x.Vector3(0,0,0),g=new x.Vector3(0,0,0),v=new x.Vector3(0,0,0),y=new x.Vector3(0,0,0),function(e,t,i,o){e.equals(m)&&t.equals(g)&&i.equals(v)&&o.equals(y)||(m.copy(e),g.copy(t),v.copy(i),y.copy(o),this.setDirty(),n.left=-t.z/2,n.right=t.z/2,n.top=t.x/2,n.bottom=-t.x/2,n.near=1,n.far=t.y+n.near,n.updateProjectionMatrix(),S(r,e,t,i,o),n.position.addVectors(e,i.clone().multiplyScalar(-t.y/2-n.near)),o&&n.up.set(o.x,o.y,o.z),n.lookAt(e),N.debug&&(p.position.set(e.x,e.y,e.z),p.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z),p.scale.set(t.z,t.x,t.y)),f.uniforms.worldSize.value.copy(t))}),this.renderIntoShadow=function(e){if(!e.overrideMaterial||!e.overrideMaterial.transparent){var t=e.overrideMaterial;e.overrideMaterial=c,R.render(e,n,o,!1),e.overrideMaterial=t}},this.prepareGroundShadow=(C=0,P=0,L=0,function(e,t,n,i){if(!this.enabled||e.isEmpty())return O=b.GroundFlags.GROUND_FINISHED,n;if(_!=e.getGeomScenes()&&(I=!0),I)this.clear(),I=!1,_=e.getGeomScenes(),C=_.length,P=0,L=t?Math.max(Math.ceil(C/100),t):C;else{if(O===b.GroundFlags.GROUND_RENDERED||O===b.GroundFlags.GROUND_FINISHED)return O=b.GroundFlags.GROUND_FINISHED,n;0===t&&(L=C)}var r,o,a;n&&(r=performance.now(),o=(i=void 0===i?1:i)*n);for(var s=0;s<L&&P<C;){var l=_[P++];if(l&&(s++,l.forceVisible=!0,this.renderIntoShadow(l),l.forceVisible=!1,n)){var c=performance.now()-r;if(o<c){O=b.GroundFlags.GROUND_UNFINISHED,a=n-c;break}}}return P<C&&(O=b.GroundFlags.GROUND_UNFINISHED,a=n?n-performance.now()+r:1),void 0!==a?a:(this.postprocess(),O=b.GroundFlags.GROUND_RENDERED,n?n-performance.now()+r:1)}),this.renderShadow=function(e,t){D&&(t?R.render(i,e,t,!1):R.render(i,e))},this.postprocess=function(){d.render(R,l,o),h.render(R,o,l),D=!0},this.clear=function(){var e=R.getClearColor().getHex(),t=R.getClearAlpha();R.setClearColor(0,0),R.clearTarget(o,!0,!0,!1),R.setClearColor(e,t),R.clearBlend(),D=!1},this.setColor=function(e){u.uniforms.uShadowColor.value.x=e.r,u.uniforms.uShadowColor.value.y=e.g,u.uniforms.uShadowColor.value.z=e.b},this.getColor=function(){return new x.Color(u.uniforms.uShadowColor.value.x,u.uniforms.uShadowColor.value.y,u.uniforms.uShadowColor.value.z)},this.setAlpha=function(e){u.uniforms.uShadowColor.value.w=e},this.getAlpha=function(){return u.uniforms.uShadowColor.value.w},this.isValid=function(){return D},this.getStatus=function(){return O},this.setDirty=function(){I=!0,O=b.GroundFlags.GROUND_UNFINISHED},this.getDepthMaterial=function(){return c},t)for(var k in N)N[k]=t[k]||N[k];i=new x.Scene,n=new x.OrthographicCamera,(o=new x.WebGLRenderTarget(N.texSize,N.texSize,{minFilter:x.LinearFilter,magFilter:x.LinearFilter,format:x.RGBAFormat,stencilBuffer:!1})).generateMipmaps=!1,(l=new x.WebGLRenderTarget(N.texSize,N.texSize,{minFilter:x.LinearFilter,magFilter:x.LinearFilter,format:x.RGBAFormat,stencilBuffer:!1})).generateMipmaps=!1,(c=Object(a.createShaderMaterial)(w)).side=x.DoubleSide,c.blending=x.NoBlending,h=new s.a(E,"tDepth"),d=new s.a(E,"tDepth"),f=new s.a(A,"tDepth"),h.material.defines.KERNEL_SCALE=d.material.defines.KERNEL_SCALE=(N.pixScale/N.texSize).toFixed(4),h.material.defines.KERNEL_RADIUS=d.material.defines.KERNEL_RADIUS=N.blurRadius.toFixed(2),f.material.blending=h.material.blending=d.material.blending=x.NoBlending,f.material.depthWrite=h.material.depthWrite=d.material.depthWrite=!1,f.material.depthTest=h.material.depthTest=d.material.depthTest=!1,h.material.defines.HORIZONTAL=1,(u=Object(a.createShaderMaterial)(T)).uniforms.tDepth.value=o,u.depthWrite=!1,u.transparent=!0,r=M(u),i.add(r),N.debug&&(p=new x.Mesh(new x.BoxGeometry(1,1,1),new x.MeshBasicMaterial({color:65280,wireframe:!0})),i.add(p)),this.setTransform(new x.Vector3(0,0,0),new x.Vector3(1,1,1),new x.Vector3(0,1,0),x.Object3D.DefaultUp)}C.prototype.constructor=C},function(e,t,n){"use strict";n.r(t),n.d(t,"SAOShader",function(){return c});var i=n(0),r=n(15),o=n(36),a=n.n(o),s=n(212),l=n.n(s),c={uniforms:i.UniformsUtils.merge([r.ShaderChunks.DepthTextureUniforms,{size:{type:"v2",value:new i.Vector2(512,512)},resolution:{type:"v2",value:new i.Vector2(1/512,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},radius:{type:"f",value:12},bias:{type:"f",value:.1},projScale:{type:"f",value:500},intensity:{type:"f",value:1},tDepth_mip1:{type:"t",value:null},tDepth_mip2:{type:"t",value:null},tDepth_mip3:{type:"t",value:null},tDepth_mip4:{type:"t",value:null},tDepth_mip5:{type:"t",value:null}}]),vertexShader:a.a,fragmentShader:l.a}},function(e,t,n){"use strict";n.r(t),n.d(t,"DDSLoader",function(){return r});var i=n(0),r=function e(){this._parser=e.parse};r.prototype=Object.create(i.CompressedTextureLoader.prototype),r.prototype.constructor=r,r.parse=function(e,t){var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function o(e,t,n,i){for(var r=n*i*4,o=new Uint8Array(e,t,r),a=new Uint8Array(r),s=0,l=0,c=0;c<i;c++)for(var u=0;u<n;u++){var h=o[l],d=o[++l],f=o[++l],p=o[++l];l++,a[s]=f,a[++s]=d,a[++s]=h,a[++s]=p,s++}return a}var a,s=r("DXT1"),l=r("DXT3"),c=r("DXT5"),u=new Int32Array(e,0,31);if(542327876!==u[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;if(4&!u[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),n;var h,d=u[21],f=!1;switch(d){case s:a=8,n.format=i.RGB_S3TC_DXT1_Format;break;case l:a=16,n.format=i.RGBA_S3TC_DXT3_Format;break;case c:a=16,n.format=i.RGBA_S3TC_DXT5_Format;break;default:if(!(32==u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(h=d,String.fromCharCode(255&h,h>>8&255,h>>16&255,h>>24&255))),n;f=!0,a=64,n.format=i.RGBAFormat}n.mipmapCount=1,u[7]>0&&!1!==t&&(n.mipmapCount=Math.max(1,u[7])),n.isCubemap=!!(512&u[28]),n.width=u[4],n.height=u[3];for(var p=u[1]+4,m=n.width,g=n.height,v=n.isCubemap?6:1,y=0;y<v;y++){for(var _=0;_<n.mipmapCount;_++){if(f)var b=(x=o(e,p,m,g)).length;else{b=Math.max(4,m)/4*Math.max(4,g)/4*a;var x=new Uint8Array(e,p,b)}var w={data:x,width:m,height:g};n.mipmaps.push(w),p+=b,m=Math.max(.5*m,1),g=Math.max(.5*g,1)}m=n.width,g=n.height}return n}},function(e,t,n){"use strict";n.r(t),n.d(t,"FlatStringStorage",function(){return o}),n.d(t,"InstanceTreeStorage",function(){return s}),n.d(t,"InstanceTreeAccess",function(){return c});var i=n(42);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this.buf=t.buf,this.idx=t.idx,this.next=t.next):(this.buf=new Uint8Array(256),this.next=0,this.idx=[0])}var t,n,o;return t=e,(n=[{key:"allocate",value:function(e){if(this.buf.length-this.next<e){var t=Math.max(3*this.buf.length/2,this.buf.length+e),n=new Uint8Array(t);n.set(this.buf),this.buf=n}}},{key:"add",value:function(e){if(null==e)return 0;if(!e.length)return this.idx.push(this.next),this.idx.length-1;var t=Object(i.d)(e,null);return this.allocate(t),this.next+=Object(i.d)(e,this.buf,this.next),this.idx.push(this.next),this.idx.length-1}},{key:"get",value:function(e){if(e){var t=this.idx[e-1],n=this.idx[e];return t===n?"":Object(i.f)(this.buf,t,n-t)}}},{key:"flatten",value:function(){this.idx=l(this.idx)}}])&&r(t.prototype,n),o&&r(t,o),e}(),a=5;function s(e,t){this.nodes=[],this.nextNode=0,this.children=[],this.nextChild=0,this.dbIdToIndex={},this.names=[],this.s2i={},this.strings=new o,this.nameSuffixes=[],this.getIndex(0)}function l(e){var t=new Int32Array(e.length);return t.set(e),t}function c(e,t,n){this.nodes=e.nodes,this.children=e.children,this.dbIdToIndex=e.dbIdToIndex,this.names=e.names,this.nameSuffixes=e.nameSuffixes,this.strings=new o(e.strings),this.rootId=t,this.numNodes=this.nodes.length/a,this.visibleIds=null,this.nodeBoxes=n}s.prototype.getIndex=function(e){var t=this.dbIdToIndex[e];if(t)return t;t=this.nextNode++,this.nodes.push(e);for(var n=1;n<a;n++)this.nodes.push(0);return this.dbIdToIndex[e]=t,t},s.prototype.setNode=function(e,t,n,i,r,o){var s,l=this.getIndex(e),c=l*a,u=r.length,h=o&&o.length;for(h&&(u+=o.length),this.nodes[c+1]=t,this.nodes[c+2]=this.nextChild,this.nodes[c+3]=h?-u:u,this.nodes[c+4]=i,s=0;s<r.length;s++)this.children[this.nextChild++]=this.getIndex(r[s]);if(h)for(s=0;s<o.length;s++)this.children[this.nextChild++]=-o[s]-1;this.nextChild>this.children.length&&console.error("Child index out of bounds -- should not happen"),this.processName(l,n)},s.prototype.processName=function(e,t){var n,i,r=-1,o=-1;if(t&&(o=t.lastIndexOf("]"),-1!==(r=t.lastIndexOf("["))&&-1!==o||(r=t.lastIndexOf(":"),o=t.length)),r>=0&&o>r){n=t.slice(0,r+1);var a=t.slice(r+1,o);(i=parseInt(a,10))&&i+""===a||(n=t,i=0)}else n=t,i=0;var s=this.s2i[n];void 0===s&&(s=this.strings.add(n),this.s2i[n]=s),this.names[e]=s,this.nameSuffixes[e]=i},s.prototype.flatten=function(e,t,n,i,r,o){this.nodes=l(this.nodes),this.children=l(this.children),this.names=l(this.names),this.nameSuffixes=l(this.nameSuffixes),this.strings.flatten(),this.s2i=null},c.prototype.getNumNodes=function(){return this.numNodes},c.prototype.getIndex=function(e){return this.dbIdToIndex[e]},c.prototype.name=function(e){var t=this.dbIdToIndex[e],n=this.strings.get(this.names[t]),i=this.nameSuffixes[t];return i?"["===n.charAt(n.length-1)?n+i+"]":n+i:n},c.prototype.getParentId=function(e){var t=this.dbIdToIndex[e];return this.nodes[t*a+1]},c.prototype.getNodeFlags=function(e){var t=this.dbIdToIndex[e];return this.nodes[t*a+4]},c.prototype.setNodeFlags=function(e,t){var n=this.dbIdToIndex[e];n&&(this.nodes[n*a+4]=t)},c.prototype.getNumChildren=function(e){var t=this.dbIdToIndex[e],n=this.nodes[t*a+3];if(n>=0)return n;var i=this.nodes[t*a+2];n=Math.abs(n);for(var r=0,o=0;o<n;o++){if(this.children[i+o]<0)break;r++}return r},c.prototype.getNumFragments=function(e){var t=this.dbIdToIndex[e],n=this.nodes[t*a+3];if(n>=0)return 0;for(var i=this.nodes[t*a+2],r=0,o=(n=Math.abs(n))-1;o>=0;o--){if(this.children[i+o]>=0)break;r++}return r},c.prototype.getNodeBox=function(e,t){for(var n=6*this.getIndex(e),i=0;i<6;i++)t[i]=this.nodeBoxes[n+i]},c.prototype.getVisibleIds=function(){return this.visibleIds||(this.visibleIds=Object.keys(this.dbIdToIndex).map(function(e){return parseInt(e)})),this.visibleIds},c.prototype.enumNodeChildren=function(e,t){var n=this.dbIdToIndex[e],i=this.nodes[n*a+2],r=this.nodes[n*a+3];r=Math.abs(r);for(var o=0;o<r;o++){var s=this.children[i+o];if(s<0)break;if(t(this.nodes[s*a+0],e,n))return e}},c.prototype.enumNodeFragments=function(e,t){var n=this.dbIdToIndex[e],i=this.nodes[n*a+2],r=this.nodes[n*a+3];if(r<0){r=-r;for(var o=0;o<r;o++){var s=this.children[i+o];if(!(s>0)&&t(-s-1,e,n))return e}}},c.prototype.computeBoxes=function(e){this.nodeBoxes||(this.nodeBoxes=new Float32Array(6*this.numNodes));var t=this,n=t.getIndex(t.rootId),i=t.nodeBoxes;function r(e,n,r){var o=t.getIndex(e);a(e,o);for(var s=6*r,l=6*o,c=0;c<3;c++)i[s+c]>i[l+c]&&(i[s+c]=i[l+c]),i[s+c+3]<i[l+c+3]&&(i[s+c+3]=i[l+c+3])}function o(t,n,r){for(var o=6*t,a=6*r,s=0;s<3;s++)i[a+s]>e[o+s]&&(i[a+s]=e[o+s]),i[a+s+3]<e[o+s+3]&&(i[a+s+3]=e[o+s+3])}function a(e,n){var a=6*n;i[a]=i[a+1]=i[a+2]=1/0,i[a+3]=i[a+4]=i[a+5]=-1/0,t.getNumChildren(e)&&t.enumNodeChildren(e,r,!0),t.getNumFragments(e)&&t.enumNodeFragments(e,o)}a(t.rootId,n)}},function(e,t,n){"use strict";n.r(t),n.d(t,"HudMessage",function(){return r});var i=n(9);function r(){}r.instances=[],r.displayMessage=function(e,t,n,o,a){function s(e){var t=window.getComputedStyle(e),n=parseInt(t["margin-top"]),i=parseInt(t["margin-bottom"]);return e.getBoundingClientRect().height+n+i}if(!(r.instances.length>0)){var l=t.msgTitleKey,c=t.msgTitleDefaultValue||l,u=t.messageKey,h=t.messageDefaultValue||u,d=t.buttonText,f=t.checkboxChecked||!1,p=document.createElement("div");p.classList.add("docking-panel"),p.classList.add("hud"),e.appendChild(p);var m=document.createElement("div");if(m.classList.add("docking-panel-title"),m.classList.add("docking-panel-delimiter-shadow"),m.textContent=i.i18n.translate(l,{defaultValue:c}),m.setAttribute("data-i18n",l),p.appendChild(m),n){var g=document.createElement("div");g.classList.add("docking-panel-close"),g.addEventListener("click",function(e){r.dismiss(),n&&n(e)}),p.appendChild(g)}var v=document.createElement("div");v.classList.add("hud-client"),v.classList.add("docking-panel-container-solid-color-b"),p.appendChild(v);var y=document.createElement("div");y.className="hud-message",y.textContent=i.i18n.translate(u,{defaultValue:h}),y.setAttribute("data-i18n",h),v.appendChild(y);var _=s(y);if(o){var b=document.createElement("div");b.classList.add("docking-panel-primary-button"),b.classList.add("hud-button"),b.textContent=i.i18n.translate(d,{defaultValue:d}),b.setAttribute("data-i18n",d),b.addEventListener("click",o),v.appendChild(b),_+=s(b)}if(a){var x=document.createElement("div"),w=document.createElement("input");w.className="hud-checkbox",w.type="checkbox",w.checked=f,x.appendChild(w);var A="Do not show this message again",E=document.createElement("label");E.setAttribute("for",A),E.setAttribute("data-i18n",A),E.textContent=i.i18n.translate(A,{defaultValue:A}),x.appendChild(E),w.addEventListener("change",a),v.appendChild(x),_+=s(a)}v.style.height=_+"px",p.style.height=_+s(m)+"px";var T={hudMessage:p,container:e};r.instances.push(T)}},r.dismiss=function(){if(r.instances.length>0){var e=r.instances.pop();return e.hudMessage.style.visibility="hidden",e.container.removeChild(e.hudMessage),!0}return!1}},function(e,t,n){"use strict";n.r(t);var i=n(56),r=n(2),o=n(1),a=n(16),s=n(20),l=n(9),c=n(3),u=n(59);function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._width=t||60,this._height=n||60}var t,n,i;return t=e,(n=[{key:"createThumbnail",value:function(e,t){var n=this;return new Promise(function(t){var i=document.createElement("canvas");i.width=n._width,i.height=n._height;var r=i.getContext("2d"),o=r.createLinearGradient(0,0,0,i.height),a=e.bgColorGradient,s=f(a[0],a[1],a[2]),l=f(a[3],a[4],a[5]);o.addColorStop(0,s),o.addColorStop(1,l),r.fillStyle=o,r.fillRect(0,0,i.width,i.height),i.toBlob(function(e){var n=URL.createObjectURL(e);t(n)})})}}])&&h(t.prototype,n),i&&h(t,i),e}();function f(e,t,n){return"#"+p(e)+p(t)+p(n)}function p(e){if(0===e)return"00";for(var t="",n=e>255?255:e;0!==n;){var i=n%16;n=n/16|0,t=m[i.toString()]+t}return t.length>1?t:"0"+t}var m={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"A",11:"B",12:"C",13:"D",14:"E",15:"F"};n.d(t,"ViewerSettingTab",function(){return g}),n.d(t,"ViewerSettingsPanel",function(){return y});var g={Navigation:"navigationtab",Performance:"performancetab",Appearance:"appearance",Environment:"environment"},v=0;function y(e,t){this.viewer=e,this.is3dMode=!t.is2d(),this.visible=!1,i.SettingsPanel.call(this,e.container,"ViewerSettingsPanel"+e.id+"-"+v++,"Settings",{width:400,addFooter:!1,heightAdjustment:90}),this.container.classList.add("viewer-settings-panel"),this.addTab(g.Performance,"Performance",{className:"performance"}),this.addTab(g.Navigation,"Navigation",{className:"navigation"}),this.addTab(g.Appearance,"Appearance",{className:"appearance"}),this.is3dMode&&this.addTab(g.Environment,"Environment",{className:"environment"}),this.is3dMode||this.container.classList.add("for-2d-model"),this.createRestoreDefaultSettingsButton(),this.modelPreferenceCount=0,this.createNavigationPanel(),this.createPerformancePanel(),this.createAppearancePanel(),this.modelPreferenceCount&&o.logger.log("Model locked ("+this.modelPreferenceCount+") render settings in UI."),this.selectTab(g.Performance),this.syncUI=this.syncUI.bind(this),e.addEventListener(r.RESTORE_DEFAULT_SETTINGS_EVENT,this.syncUI),e.addEventListener(r.VIEWER_STATE_RESTORED_EVENT,this.syncUI)}function _(e,t,n){e.createThumbnail(n).then(function(e){t.src=e,t.onload=function(){URL.revokeObjectURL=e}})}y.prototype=Object.create(i.SettingsPanel.prototype),y.prototype.constructor=y,u.ViewerPanelMixin.call(y.prototype),y.prototype.uninitialize=function(){this.viewer&&(this.viewer.removeEventListener(r.RESTORE_DEFAULT_SETTINGS_EVENT,this.syncUI),this.viewer.removeEventListener(r.VIEWER_STATE_RESTORED_EVENT,this.syncUI)),this.viewer=null,i.SettingsPanel.prototype.uninitialize.call(this),this.envSelect=null},y.prototype.setVisible=function(e){this.visible=e,i.SettingsPanel.prototype.setVisible.call(this,e),e&&this.sizeToContent(),e&&this.createEnvironmentPanel()},y.prototype.addCheckbox=function(e,t,n,r,o,a){var s=this.viewer,l=s.prefs[a];r="boolean"==typeof l?l:r;var c=i.SettingsPanel.prototype.addCheckbox.call(this,e,t,r,function(e){a&&s.prefs.set(a,e),o(e)},n),u=this.getControl(c);return u.saveKey=a,a?s.prefs.addListeners(a,function(e){u.setValue(e)},function(e){u.setValue(e),o(e)}):u.sliderRow.classList.add("logical-group"),s.prefs.hasTag(a,"no-storage")&&(u.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),c},y.prototype.addGrid=function(e,t,n,i,r,o){var a=t,s=document.createElement("div");s.classList.add("environments-container"),a.appendChild(s);var c=document.createElement("div");c.classList.add("environments-lighting-table"),s.appendChild(c);for(var u=new d(42,26),h=0;h<n.length;h++){var f=n[h],p=document.createElement("div");p.classList.add("settings-environment-cell"),p.index=h;var m=document.createElement("img");m.classList.add("settings-environment-image"),_(u,m,f),p.appendChild(m);var g=document.createElement("span");g.textContent=l.i18n.translate(f.name),g.classList.add("settings-environment-name"),g.setAttribute("data-i18n",f.name),p.appendChild(g),p.addEventListener("click",function(){r(this.index)}),c.appendChild(p)}var v=this,y=this.viewer;return y.prefs.addListeners(o,function(){v.updateEnvironmentSelection()},function(e){r(y.prefs.lightPreset),v.updateEnvironmentSelection()}),this.updateEnvironmentSelection(),c},y.prototype.updateEnvironmentSelection=function(){if(this.is3dMode&&this.envTabCreated)for(var e=this.viewer.prefs.lightPreset,t=this.gridTable.querySelectorAll(".settings-environment-cell"),n=0;n<t.length;n++)t[n].index===e?t[n].classList.add("border-select"):t[n].classList.remove("border-select")},y.prototype.addLabel=function(e,t){var n,i=this.tabIdToIndex[e];return-1!==i&&(n=this.tablesContainer.childNodes[i],this.settingsLabel=new a.OptionLabel(t,n.tBodies[0]),this.settingsLabel.sliderRow.classList.add("logical-group"),this.settingsLabel)},y.prototype.removeCheckbox=function(e){return this.viewer.prefs.removeListeners(e.saveKey),this.removeEventListener(e,"change",e.changeListener),i.SettingsPanel.prototype.removeCheckbox.call(this,e)},y.prototype.createNavigationPanel=function(){var e=this.viewer,t=g.Navigation;this.tablesContainer.childNodes[1];this.is3dMode&&(this.addLabel(t,"ViewCube"),this.addCheckbox(t,"Show ViewCube","Toggles availability of the ViewCube navigation control",!0,function(t){e.displayViewCube(t)},"viewCube"),Object(c.isMobileDevice)()||this.addCheckbox(t,"ViewCube acts on pivot","When enabled, the ViewCube orbits the view around the active pivot point When disabled, it orbits around the center of the view",!1,function(t){e.setUsePivotAlways(t)},"alwaysUsePivot"),this.addLabel(t,"Orbit"),this.addCheckbox(t,"Fusion style orbit","Enables Fusion-style orbit overlay and gives the ability to lock orbit axis",!1,function(t){t?e.loadExtension("Autodesk.Viewing.FusionOrbit",null):e.unloadExtension("Autodesk.Viewing.FusionOrbit",null)},"fusionOrbit"),this.addCheckbox(t,"Orbit past world poles","Allows view rotation to continue past the modelâ€™s North Pole",!0,function(t){e.setOrbitPastWorldPoles(t)},"orbitPastWorldPoles"),Object(c.isMobileDevice)()||(this.addLabel(t,"Zoom"),this.addCheckbox(t,"Zoom towards pivot","When disabled, zooming operations are centered at the current cursor location",!1,function(t){e.setZoomTowardsPivot(t)},"zoomTowardsPivot"),this.addCheckbox(t,"Reverse mouse zoom direction","Toggles direction of zooming in and out",!1,function(t){e.setReverseZoomDirection(t)},"reverseMouseZoomDir"),this.addLabel(t,"Mouse"),this.addCheckbox(t,"Left handed mouse setup","Swaps the buttons on the mouse",!1,function(t){e.setUseLeftHandedInput(t)},"leftHandedMouseSetup"),this.addCheckbox(t,"Set pivot with left mouse button","Change left-click behavior to set new pivot point (overrides select object)",!1,function(t){e.setClickToSetCOI(t)},"clickToSetCOI")),this.addCheckbox(t,"Open properties on select","Always show properties upon selecting object",!0,function(t){e.setPropertiesOnSelect(t)},"openPropertiesOnSelect")),this.is3dMode||(this.addLabel(t,"Zoom"),this.addCheckbox(t,"Reverse mouse zoom direction","Toggles direction of zooming in and out",!1,function(t){e.setReverseZoomDirection(t)},"reverseMouseZoomDir"),this.addLabel(t,"Mouse"),this.addCheckbox(t,"Open properties on select","Always show properties upon selecting object",!0,function(t){e.setPropertiesOnSelect(t)},"openPropertiesOnSelect"),this.addCheckbox(t,"Left handed mouse setup","Swaps the buttons on the mouse",!1,function(t){e.setUseLeftHandedInput(t)},"leftHandedMouseSetup"))},y.prototype.createPerformancePanel=function(){var e=this.viewer,t=g.Performance;this.tablesContainer.childNodes[0];this.is3dMode&&(this.addLabel(t,"Performance Optimization"),this.optimizeNavigationhkBoxId=this.addCheckbox(t,"Smooth navigation","Provides faster response(but degrades quality) while navigating",Object(c.isMobileDevice)(),function(t){e.setOptimizeNavigation(t)},"optimizeNavigation"),this.progressiveRenderChkBoxId=this.addCheckbox(t,"Progressive display","Shows incremental updates of the view and allows for more responsive interaction with the model (some elements may flicker) This improves perceived waiting time",!0,function(t){e.setProgressiveRendering(t)},"progressiveRendering"),this.addLabel(t,"Display"),this.ghosthiddenChkBoxId=this.addCheckbox(t,"Ghost hidden objects","Leave hidden objects slightly visible",!0,function(t){e.setGhosting(t)},"ghosting"),this.displayLinesId=this.addCheckbox(t,"Display Lines","Toggles display of line objects",!0,function(t){e.hideLines(!t)},"lineRendering"),this.displayPointsId=this.addCheckbox(t,"Display Points","Toggles display of point objects",!0,function(t){e.hidePoints(!t)},"pointRendering"),this.displayEdgesId=this.addCheckbox(t,"Display edges","Shows outline of model surfaces",!1,function(t){e.setDisplayEdges(t)},"edgeRendering")),this.is3dMode||(this.addLabel(t,"Performance Optimization"),this.progressiveRenderChkBoxId=this.addCheckbox(t,"Progressive display","Shows incremental updates of the view and allows for more responsive interaction with the model (some elements may flicker) This improves perceived waiting time",!0,function(t){e.setProgressiveRendering(t)},"progressiveRendering"))},y.prototype.createAppearancePanel=function(){var e=this.viewer,t=g.Appearance;this.tablesContainer.childNodes[2];this.is3dMode&&(this.addLabel(t,"Visual Quality Optimization"),this.antialiasingChkBoxId=this.addCheckbox(t,"Anti-aliasing","Remove jagged edges from lines",!0,function(t){e.setQualityLevel(e.prefs.ambientShadows,t)},"antialiasing"),this.ambientshadowsChkBoxId=this.addCheckbox(t,"Ambient shadows","Improve shading of occluded surfaces",!0,function(t){e.setQualityLevel(t,e.prefs.antialiasing)},"ambientShadows"),this.groundShadowChkBoxId=this.addCheckbox(t,"Ground shadow","Add simulated ground surface shadows",!0,function(t){e.setGroundShadow(t)},"groundShadow"),this.groundReflectionChkBoxId=this.addCheckbox(t,"Ground reflection","Add simulated ground surface reflections",!1,function(t){e.setGroundReflection(t)},"groundReflection")),this.is3dMode||(this.addLabel(t,"Existing behavior"),this.swapBlackAndWhiteChkBoxId=this.addCheckbox(t,"2D Sheet Color","Switch sheet color white to black",!0,function(t){e.setSwapBlackAndWhite(t)},"swapBlackAndWhite"))},y.prototype.createEnvironmentPanel=function(){if(this.is3dMode&&!this.envTabCreated){this.envTabCreated=!0;var e=this.viewer,t=g.Environment,n=this.tablesContainer.childNodes[3];this.gridTable=n,this.addLabel(t,"Environment"),this.envMapBackgroundChkBoxId=this.addCheckbox(t,"Environment Image Visible","Shows lighting environment as background",!0,function(t){e.setEnvMapBackground(t)}.bind(this),"envMapBackground");var i=n.tBodies[0].insertRow(-1).insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n","Environments and Lighting Selection"),this.caption.textContent=l.i18n.translate("Environments and Lighting Selection"),this.caption.classList.add("settings-row-title"),i.appendChild(this.caption),i.colSpan="3",this.envSelect=this.addGrid("Environments and Lighting Selection",n,s.LightPresets,e.impl.currentLightPreset(),function(t){e.setLightPreset(t)},"lightPreset"),this.envSelect.classList.add("with-environment")}},y.prototype.createRestoreDefaultSettingsButton=function(){var e=this.viewer;this.restoreDiv=document.createElement("div"),this.restoreDiv.classList.add("docking-panel-container-solid-color-b"),this.restoreDiv.classList.add("restore-defaults-container"),this.restoreButton=document.createElement("div"),this.restoreButton.className="docking-panel-tertiary-button",this.restoreButton.setAttribute("data-i18n","Restore all default settings"),this.restoreButton.textContent=Autodesk.Viewing.i18n.translate("Restore all default settings"),this.restoreDiv.appendChild(this.restoreButton),this.versionDiv=document.createElement("div"),this.versionDiv.textContent=function(){var e=LMV_VIEWER_VERSION;"@"===LMV_VIEWER_VERSION.charAt(0)&&(e="0.0.0");return"v"+e}(),this.versionDiv.className="docking-panel-version-label",this.addEventListener(this.restoreDiv,"touchstart",c.touchStartToClick),this.addEventListener(this.restoreDiv,"click",function(){e.restoreDefaultSettings()},!1),this.scrollContainer.appendChild(this.restoreDiv),this.scrollContainer.appendChild(this.versionDiv)},y.prototype.selectTab=function(e){Autodesk.Viewing.UI.SettingsPanel.prototype.selectTab.call(this,e),this.sizeToContent()},y.prototype.sizeToContent=function(){var e=this.getContentSize().height+this.heightAdjustment,t=this.viewer.container.clientHeight-this.heightAdjustment,n=Math.min(e,t);this.container.style.height=parseInt(n)+"px"},y.prototype.onViewerResize=function(e,t,n,i,r,o){this.sizeToContent()},y.prototype.syncUI=function(){var e=this.viewer,t=this.viewer.prefs;this.setControlValue(this.antialiasingChkBoxId,t.antialiasing),this.setControlValue(this.ambientshadowsChkBoxId,t.ambientShadows),this.setControlValue(this.groundShadowChkBoxId,t.groundShadow),this.setControlValue(this.groundReflectionChkBoxId,t.groundReflection),this.setControlValue(this.envMapBackgroundChkBoxId,e.impl.isEnvMapBackground()),this.setControlValue(this.progressiveRenderChkBoxId,t.progressiveRendering),this.setControlValue(this.swapBlackAndWhiteChkBoxId,t.swapBlackAndWhite),this.setControlValue(this.ghosthiddenChkBoxId,t.ghosting),this.setControlValue(this.displayLinesId,t.lineRendering),this.setControlValue(this.displayPointsId,t.pointRendering),this.setControlValue(this.displayEdgesId,t.edgeRendering),this.updateEnvironmentSelection()},y.prototype.setControlValue=function(e,t){var n=this.getControl(e);n&&n.setValue(t)}},function(e,t,n){var i;function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
  /*! Hammer.JS - v2.0.8 - 2016-04-23
                                                                                                                                                                                                                                                                                                                                                        * http://hammerjs.github.io/
                                                                                                                                                                                                                                                                                                                                                        *
                                                                                                                                                                                                                                                                                                                                                        * Copyright (c) 2016 Jorik Tangelder;
                                                                                                                                                                                                                                                                                                                                                        * Licensed under the MIT license */
  /*! Hammer.JS - v2.0.8 - 2016-04-23
                                                                                                                                                                                                                                                                                                                                                        * http://hammerjs.github.io/
                                                                                                                                                                                                                                                                                                                                                        *
                                                                                                                                                                                                                                                                                                                                                        * Copyright (c) 2016 Jorik Tangelder;
                                                                                                                                                                                                                                                                                                                                                        * Licensed under the MIT license */
  !function(o,a,s,l){"use strict";var c=["","webkit","Moz","MS","ms","o"],u=a.createElement("div"),h="function",d=Math.round,f=Math.abs,p=Date.now;function m(e,t,n){return setTimeout(A(e,n),t)}function g(e,t,n){return!!Array.isArray(e)&&(v(e,n[t],n),!0)}function v(e,t,n){var i;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==l)for(i=0;i<e.length;)t.call(n,e[i],i,e),i++;else for(i in e)e.hasOwnProperty(i)&&t.call(n,e[i],i,e)}function y(e,t,n){var i="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",r=o.console&&(o.console.warn||o.console.log);return r&&r.call(o.console,i,n),e.apply(this,arguments)}}var _=function(e){if(e===l||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==l&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(t[r]=Array.isArray(i[r])?i[r].slice(0):i[r])}return t},b=y(function(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;)(!n||n&&e[i[r]]===l)&&(e[i[r]]=t[i[r]]),r++;return e},"extend","Use `assign`."),x=y(function(e,t){return b(e,t,!0)},"merge","Use `assign`.");function w(e,t,n){var i,r=t.prototype;(i=e.prototype=Object.create(r)).constructor=e,i._super=r,n&&_(i,n)}function A(e,t){return function(){return e.apply(t,arguments)}}function E(e,t){return r(e)==h?e.apply(t&&t[0]||l,t):e}function T(e,t){return e===l?t:e}function M(e,t,n){v(L(t),function(t){e.addEventListener(t,n,!1)})}function S(e,t,n){v(L(t),function(t){e.removeEventListener(t,n,!1)})}function C(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function P(e,t){return e.indexOf(t)>-1}function L(e){return e.trim().split(/\s+/g)}function R(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var i=0;i<e.length;){if(n&&e[i][n]==t||!n&&e[i]===t)return i;i++}return-1}function D(e){return Array.prototype.slice.call(e,0)}function I(e,t,n){for(var i=[],r=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];R(r,a)<0&&i.push(e[o]),r[o]=a,o++}return n&&(i=t?i.sort(function(e,n){return e[t]>n[t]}):i.sort()),i}function O(e,t){for(var n,i,r=t[0].toUpperCase()+t.slice(1),o=0;o<c.length;){if((i=(n=c[o])?n+r:t)in e)return i;o++}return l}var N=1;function k(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||o}var V="ontouchstart"in o,F=O(o,"PointerEvent")!==l,B=V&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),U=25,z=1,G=2,H=4,W=8,j=1,X=2,q=4,Y=8,K=16,Q=X|q,Z=Y|K,J=Q|Z,$=["x","y"],ee=["clientX","clientY"];function te(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){E(e.options.enable,[e])&&n.handler(t)},this.init()}function ne(e,t,n){var i=n.pointers.length,r=n.changedPointers.length,o=t&z&&i-r==0,a=t&(H|W)&&i-r==0;n.isFirst=!!o,n.isFinal=!!a,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,i=t.pointers,r=i.length;n.firstInput||(n.firstInput=ie(t));r>1&&!n.firstMultiple?n.firstMultiple=ie(t):1===r&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,c=t.center=re(i);t.timeStamp=p(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=le(s,c),t.distance=se(s,c),function(e,t){var n=t.center,i=e.offsetDelta||{},r=e.prevDelta||{},o=e.prevInput||{};t.eventType!==z&&o.eventType!==H||(r=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=e.offsetDelta={x:n.x,y:n.y});t.deltaX=r.x+(n.x-i.x),t.deltaY=r.y+(n.y-i.y)}(n,t),t.offsetDirection=ae(t.deltaX,t.deltaY);var u=oe(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=u.x,t.overallVelocityY=u.y,t.overallVelocity=f(u.x)>f(u.y)?u.x:u.y,t.scale=a?(h=a.pointers,d=i,se(d[0],d[1],ee)/se(h[0],h[1],ee)):1,t.rotation=a?function(e,t){return le(t[1],t[0],ee)-le(e[1],e[0],ee)}(a.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,i,r,o,a=e.lastInterval||t,s=t.timeStamp-a.timeStamp;if(t.eventType!=W&&(s>U||a.velocity===l)){var c=t.deltaX-a.deltaX,u=t.deltaY-a.deltaY,h=oe(s,c,u);i=h.x,r=h.y,n=f(h.x)>f(h.y)?h.x:h.y,o=ae(c,u),e.lastInterval=t}else n=a.velocity,i=a.velocityX,r=a.velocityY,o=a.direction;t.velocity=n,t.velocityX=i,t.velocityY=r,t.direction=o}(n,t);var h,d;var m=e.element;C(t.srcEvent.target,m)&&(m=t.srcEvent.target);t.target=m}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function ie(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:d(e.pointers[n].clientX),clientY:d(e.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:t,center:re(t),deltaX:e.deltaX,deltaY:e.deltaY}}function re(e){var t=e.length;if(1===t)return{x:d(e[0].clientX),y:d(e[0].clientY)};for(var n=0,i=0,r=0;r<t;)n+=e[r].clientX,i+=e[r].clientY,r++;return{x:d(n/t),y:d(i/t)}}function oe(e,t,n){return{x:t/e||0,y:n/e||0}}function ae(e,t){return e===t?j:f(e)>=f(t)?e<0?X:q:t<0?Y:K}function se(e,t,n){n||(n=$);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return Math.sqrt(i*i+r*r)}function le(e,t,n){n||(n=$);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return 180*Math.atan2(r,i)/Math.PI}te.prototype={handler:function(){},init:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(k(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(k(this.element),this.evWin,this.domHandler)}};var ce={mousedown:z,mousemove:G,mouseup:H},ue="mousedown",he="mousemove mouseup";function de(){this.evEl=ue,this.evWin=he,this.pressed=!1,te.apply(this,arguments)}w(de,te,{handler:function(e){var t=ce[e.type];t&z&&0===e.button&&(this.pressed=!0),t&G&&1!==e.which&&(t=H),this.pressed&&(t&H&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var fe={pointerdown:z,pointermove:G,pointerup:H,pointercancel:W,pointerout:W},pe={2:"touch",3:"pen",4:"mouse",5:"kinect"},me="pointerdown",ge="pointermove pointerup pointercancel";function ve(){this.evEl=me,this.evWin=ge,te.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}o.MSPointerEvent&&!o.PointerEvent&&(me="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel"),w(ve,te,{handler:function(e){var t=this.store,n=!1,i=e.type.toLowerCase().replace("ms",""),r=fe[i],o=pe[e.pointerType]||e.pointerType,a="touch"===o,s="mouse"===o,l=R(t,e.pointerId,"pointerId");r&z&&(0===e.button||a)?l<0&&(t.push(e),l=t.length-1):r&(H|W)&&(n=!0),l<0||(t[l]=e,s&&!this.manager.options.handlePointerEventMouse||this.callback(this.manager,r,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(l,1))}});var ye={touchstart:z,touchmove:G,touchend:H,touchcancel:W},_e="touchstart",be="touchstart touchmove touchend touchcancel";function xe(){this.evTarget=_e,this.evWin=be,this.started=!1,te.apply(this,arguments)}w(xe,te,{handler:function(e){var t=ye[e.type];if(t===z&&(this.started=!0),this.started){var n=function(e,t){var n=D(e.touches),i=D(e.changedTouches);t&(H|W)&&(n=I(n.concat(i),"identifier",!0));return[n,i]}.call(this,e,t);t&(H|W)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var we={touchstart:z,touchmove:G,touchend:H,touchcancel:W},Ae="touchstart touchmove touchend touchcancel";function Ee(){this.evTarget=Ae,this.targetIds={},te.apply(this,arguments)}w(Ee,te,{handler:function(e){var t=we[e.type],n=function(e,t){var n=D(e.touches),i=this.targetIds;if(t&(z|G)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,o,a=D(e.changedTouches),s=[],l=this.target;if(o=n.filter(function(e){return C(e.target,l)}),t===z)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;r=0;for(;r<a.length;)i[a[r].identifier]&&s.push(a[r]),t&(H|W)&&delete i[a[r].identifier],r++;if(!s.length)return;return[I(o.concat(s),"identifier",!0),s]}.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});var Te=2500,Me=25;function Se(){te.apply(this,arguments);var e=A(this.handler,this);this.touch=new Ee(this.manager,e),this.mouse=new de(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function Ce(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout(function(){var e=i.indexOf(n);e>-1&&i.splice(e,1)},Te)}}w(Se,te,{handler:function(e,t,n){var i="touch"==n.pointerType,r="mouse"==n.pointerType;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)(function(e,t){e&z?(this.primaryTouch=t.changedPointers[0].identifier,Ce.call(this,t)):e&(H|W)&&Ce.call(this,t)}).call(this,t,n);else if(r&&function(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(t-r.x),a=Math.abs(n-r.y);if(o<=Me&&a<=Me)return!0}return!1}.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Pe=O(u.style,"touchAction"),Le=Pe!==l,Re="auto",De="manipulation",Ie="none",Oe="pan-x",Ne="pan-y",ke=function(){if(!Le)return!1;var e={},t=o.CSS&&o.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){e[n]=!t||o.CSS.supports("touch-action",n)}),e}();function Ve(e,t){this.manager=e,this.set(t)}Ve.prototype={set:function(e){"compute"==e&&(e=this.compute()),Le&&this.manager.element.style&&ke[e]&&(this.manager.element.style[Pe]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return v(this.manager.recognizers,function(t){E(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(e){if(P(e,Ie))return Ie;var t=P(e,Oe),n=P(e,Ne);if(t&&n)return Ie;if(t||n)return t?Oe:Ne;if(P(e,De))return De;return Re}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var i=this.actions,r=P(i,Ie)&&!ke[Ie],o=P(i,Ne)&&!ke[Ne],a=P(i,Oe)&&!ke[Oe];if(r){var s=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(s&&l&&c)return}if(!a||!o)return r||o&&n&Q||a&&n&Z?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Fe=1,Be=2,Ue=4,ze=8,Ge=ze,He=16;function We(e){this.options=_({},this.defaults,e||{}),this.id=N++,this.manager=null,this.options.enable=T(this.options.enable,!0),this.state=Fe,this.simultaneous={},this.requireFail=[]}function je(e){return e&He?"cancel":e&ze?"end":e&Ue?"move":e&Be?"start":""}function Xe(e){return e==K?"down":e==Y?"up":e==X?"left":e==q?"right":""}function qe(e,t){var n=t.manager;return n?n.get(e):e}function Ye(){We.apply(this,arguments)}function Ke(){Ye.apply(this,arguments),this.pX=null,this.pY=null}function Qe(){Ye.apply(this,arguments)}function Ze(){We.apply(this,arguments),this._timer=null,this._input=null}function Je(){Ye.apply(this,arguments)}function $e(){Ye.apply(this,arguments)}function et(){We.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function tt(e,t){return(t=t||{}).recognizers=T(t.recognizers,tt.defaults.preset),new nt(e,t)}We.prototype={defaults:{},set:function(e){return _(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(g(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=qe(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return g(e,"dropRecognizeWith",this)?this:(e=qe(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(g(e,"requireFailure",this))return this;var t=this.requireFail;return-1===R(t,e=qe(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(g(e,"dropRequireFailure",this))return this;e=qe(e,this);var t=R(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function i(n){t.manager.emit(n,e)}n<ze&&i(t.options.event+je(n)),i(t.options.event),e.additionalEvent&&i(e.additionalEvent),n>=ze&&i(t.options.event+je(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|Fe)))return!1;e++}return!0},recognize:function(e){var t=_({},e);if(!E(this.options.enable,[this,t]))return this.reset(),void(this.state=32);this.state&(Ge|He|32)&&(this.state=Fe),this.state=this.process(t),this.state&(Be|Ue|ze|He)&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},w(Ye,We,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,i=t&(Be|Ue),r=this.attrTest(e);return i&&(n&W||!r)?t|He:i||r?n&H?t|ze:t&Be?t|Ue:Be:32}}),w(Ke,Ye,{defaults:{event:"pan",threshold:10,pointers:1,direction:J},getTouchAction:function(){var e=this.options.direction,t=[];return e&Q&&t.push(Ne),e&Z&&t.push(Oe),t},directionTest:function(e){var t=this.options,n=!0,i=e.distance,r=e.direction,o=e.deltaX,a=e.deltaY;return r&t.direction||(t.direction&Q?(r=0===o?j:o<0?X:q,n=o!=this.pX,i=Math.abs(e.deltaX)):(r=0===a?j:a<0?Y:K,n=a!=this.pY,i=Math.abs(e.deltaY))),e.direction=r,n&&i>t.threshold&&r&t.direction},attrTest:function(e){return Ye.prototype.attrTest.call(this,e)&&(this.state&Be||!(this.state&Be)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Xe(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),w(Qe,Ye,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ie]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&Be)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),w(Ze,We,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Re]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime>t.time;if(this._input=e,!i||!n||e.eventType&(H|W)&&!r)this.reset();else if(e.eventType&z)this.reset(),this._timer=m(function(){this.state=Ge,this.tryEmit()},t.time,this);else if(e.eventType&H)return Ge;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===Ge&&(e&&e.eventType&H?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),w(Je,Ye,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ie]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&Be)}}),w($e,Ye,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Q|Z,pointers:1},getTouchAction:function(){return Ke.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(Q|Z)?t=e.overallVelocity:n&Q?t=e.overallVelocityX:n&Z&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(t)>this.options.velocity&&e.eventType&H},emit:function(e){var t=Xe(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),w(et,We,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[De]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&z&&0===this.count)return this.failTimeout();if(i&&r&&n){if(e.eventType!=H)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||se(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=m(function(){this.state=Ge,this.tryEmit()},t.interval,this),Be):Ge}return 32},failTimeout:function(){return this._timer=m(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ge&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),tt.VERSION="2.0.8",tt.defaults={domEvents:!1,touchAction:"compute",enable:!0,handlePointerEventMouse:!0,inputTarget:null,inputClass:null,preset:[[Je,{enable:!1}],[Qe,{enable:!1},["rotate"]],[$e,{direction:Q}],[Ke,{direction:Q},["swipe"]],[et],[et,{event:"doubletap",taps:2},["tap"]],[Ze]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function nt(e,t){var n;this.options=_({},tt.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(F?ve:B?Ee:V?Se:de))(n,ne),this.touchAction=new Ve(this,this.options.touchAction),it(this,!0),v(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function it(e,t){var n,i=e.element;i.style&&(v(e.options.cssProps,function(r,o){n=O(i.style,o),t?(e.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=e.oldCssProps[n]||""}),t||(e.oldCssProps={}))}nt.prototype={set:function(e){return _(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var i=this.recognizers,r=t.curRecognizer;(!r||r&&r.state&Ge)&&(r=t.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],2===t.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&n.state&(Be|Ue|ze)&&(r=t.curRecognizer=n),o++}},get:function(e){if(e instanceof We)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(g(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(g(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=R(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==l&&t!==l){var n=this.handlers;return v(L(e),function(e){n[e]=n[e]||[],n[e].push(t)}),this}},off:function(e,t){if(e!==l){var n=this.handlers;return v(L(e),function(e){t?n[e]&&n[e].splice(R(n[e],t),1):delete n[e]}),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=a.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()},t.stopPropagation=function(){t.srcEvent.stopPropagation()};for(var i=0;i<n.length;)n[i](t),i++}},destroy:function(){this.element&&it(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},_(tt,{INPUT_START:z,INPUT_MOVE:G,INPUT_END:H,INPUT_CANCEL:W,STATE_POSSIBLE:Fe,STATE_BEGAN:Be,STATE_CHANGED:Ue,STATE_ENDED:ze,STATE_RECOGNIZED:Ge,STATE_CANCELLED:He,STATE_FAILED:32,DIRECTION_NONE:j,DIRECTION_LEFT:X,DIRECTION_RIGHT:q,DIRECTION_UP:Y,DIRECTION_DOWN:K,DIRECTION_HORIZONTAL:Q,DIRECTION_VERTICAL:Z,DIRECTION_ALL:J,Manager:nt,Input:te,TouchAction:Ve,TouchInput:Ee,MouseInput:de,PointerEventInput:ve,TouchMouseInput:Se,SingleTouchInput:xe,Recognizer:We,AttrRecognizer:Ye,Tap:et,Pan:Ke,Swipe:$e,Pinch:Qe,Rotate:Je,Press:Ze,on:M,off:S,each:v,merge:x,extend:b,assign:_,inherit:w,bindFn:A,prefixed:O}),(void 0!==o?o:"undefined"!=typeof self?self:{}).Hammer=tt,(i=function(){return tt}.call(t,n,t,e))===l||(e.exports=i)}(window,document)},function(e,t){},function(e,t,n){"use strict";n.r(t),n.d(t,"setUserName",function(){return c}),n.d(t,"MessageClient",function(){return u});var i,r=n(1),o=n(32),a=n(4),s=n(48),l={userName:""};function c(e){l.userName=e}function u(e,t){var n,o={camera:"cameraChange",pointer:"pointerMove",joystick:"joystick",state:"viewerState",txt:"chatReceived",joinok:"userListChange",sessionId:"connectSucceeded",joined:"userListChange",left:"userListChange",private:"privateMessage",join_error:"socketError"},a=null,s=Array.isArray(e)?e:[e],c=0,u={},h={},d=this;function f(){return l.userName&&l.userName.length?l.userName:a?a.slice(0,5):"Unknown"}function p(e){switch(e.type){case"txt":!function(e){if(0==e.msg.indexOf("/nick ")){var t=d.getUserById(e.from,e.roomId),n=e.msg.slice(6);if(n.length&&(t.name=n,t.id==a)){var i=Autodesk.Viewing.i18n.translate("you");t.name+=" ("+i+")"}d.dispatchEvent({type:"userListChange",data:e,channelId:e.roomId})}}(e);break;case"joinok":!function(e){var t=h[e.roomId];r.logger.info("joined channel "+e.roomId),e.users&&e.users.length?t.users=e.users:t.users=[];for(var n=0;n<t.users.length;n++)t.users[n].name&&t.users[n].name.length||(t.users[n].name=t.users[n].id.slice(0,5));var i=f(),o=Autodesk.Viewing.i18n.translate("you"),s={id:a,name:i+" ("+o+")",isSelf:!0,status:0};t.userSet[a]||(t.users.push(s),t.userSet[a]=s);0!=s.id.indexOf(i)&&d.sendChatMessage("/nick "+i,e.roomId)}(e);break;case"join_error":break;case"sessionId":r.logger.info("Connect successful, your id is: "+e.id),a=e.id;break;case"joined":e.userStatus="joined",function(e){e.user.name&&e.user.name.length||(e.user.name=e.user.id.slice(0,5));if(e.roomId){var t=h[e.roomId];t?(t.users.push(e.user),r.logger.info(e.user+" joined room "+e.roomId)):r.logger.warn("Channel "+e.roomId+" does not exist for socket "+a)}}(e);break;case"left":e.userStatus="left",function(e){for(var t in r.logger.info(e.user+" left room "+e.room),h){for(var n=h[t].users,i=-1,o=0;o<n.length;o++)if(n[o].id==e.user){i=o;break}-1!=i&&n.splice(i,1),delete h[t].userSet[e.user]}}(e);break;case"camera":case"pointer":break;default:r.logger.log(e)}var t=e.roomId,n={type:o[e.type],data:e,channelId:t};d.dispatchEvent(n)}function m(e){c<s.length?(r.logger.info("Connect failed, trying another server..."),n.disconnect(),n=null,c++,d.connect(d.sessionID)):d.dispatchEvent({type:"socketError",data:e})}function g(e){d.dispatchEvent({type:"socketError",data:e})}function v(e){for(var t in c=0,u)d.join(t)}this.connect=function(e){if(!n)return void 0!==window.WebSocket&&(i||(i="undefined"!=typeof lmv_io?lmv_io:io),this.sessionID=e,(n=i.connect(s[c]+"?sessionID="+e,{path:t,forceNew:!0})).on("connect",v),n.on("message",p),n.on("connect_error",m),n.on("error",g),!0)},this.join=function(e){n&&n.connected?(delete u[e],h[e]={id:e,users:[],userSet:{}},n.emit("join",{roomId:e,name:f()})):u[e]=1},this.disconnect=function(){n&&(n.disconnect(),n=null,h={},a=null)},this.sendMessage=function(e,t,i){var r={type:e,from:a,msg:t,roomId:i};n.emit("message",r)},this.sendPrivateMessage=function(e,t){var i={type:"private",target:e,from:a,msg:t};n.emit("message",i)},this.sendChatMessage=function(e,t){var i={type:"txt",from:a,msg:e,roomId:t};n.emit("message",i),p(i)},this.getUserById=function(e,t){for(var n=h[t].users,i=0;i<n.length;i++)if(n[i].id==e)return n[i];return null},this.getLocalId=function(){return a},this.getChannelInfo=function(e){return h[e]},this.isConnected=function(){return n}}u.prototype.constructor=u,o.EventDispatcher.prototype.apply(u.prototype);var h={};u.GetInstance=function(e,t){e||(e=s.EnvironmentConfigurations[Object(a.getEnv)()].LMV.RTC),Array.isArray(e)||(e=[e]);var n=h[e[0]];return n||(n=new u(e,t),h[e[0]]=n,n)}},function(e,t,n){"use strict";n.r(t),n.d(t,"Lang",function(){return i});var i=new function(){this.names=[{symbol:"en",label:"English"},{symbol:"zh-HANS",label:"Chinese Simplified"},{symbol:"zh-HANT",label:"Chinese Traditional"},{symbol:"ja",label:"Japanese"},{symbol:"cs",label:"Czech"},{symbol:"ko",label:"Korean"},{symbol:"pl",label:"Polish"},{symbol:"ru",label:"Russian"},{symbol:"fr",label:"French"},{symbol:"de",label:"German"},{symbol:"it",label:"Italian"},{symbol:"nl",label:"Dutch"},{symbol:"es",label:"Spanish"},{symbol:"pt-BR",label:"Portuguese Brazil"},{symbol:"tr",label:"Turkish"},{symbol:"sv",label:"Swedish"},{symbol:"da",label:"Danish"}],this.isSupported=function(e){for(var t=0;t<this.names.length;++t)if(this.names[t].symbol===e)return!0;return!1},this.getSupported=function(e){var t=e.split("-");return e=t.length>1?t[0].toLowerCase()+"-"+t[1].toUpperCase():t[0].toLowerCase(),this.isSupported(e)||(e=e.indexOf("zh-CN")>-1?"zh-HANS":e.indexOf("zh-TW")>-1?"zh-HANT":t.length>1&&this.isSupported(t[0].toLowerCase())?t[0]:"en"),e},this.getLanguages=function(){return this.names.slice()}}},function(e,t,n){"use strict";n.r(t),n.d(t,"CreateCubeMapFromColors",function(){return a}),n.d(t,"DecodeEnvMap",function(){return f});var i=n(0),r=n(104),o=n(1);function a(e,t){for(var n=255*e.x,r=255*e.y,o=255*e.z,a=255*t.x,s=255*t.y,l=255*t.z,c=new Uint8Array(16),u=new Uint8Array(16),h=new Uint8Array(16),d=0;d<4;d++)c[4*d]=n,c[4*d+1]=r,c[4*d+2]=o,c[4*d+3]=255,u[4*d]=a,u[4*d+1]=s,u[4*d+2]=l,u[4*d+3]=255,d>1?(h[4*d]=n,h[4*d+1]=r,h[4*d+2]=o,h[4*d+3]=255):(h[4*d]=a,h[4*d+1]=s,h[4*d+2]=l,h[4*d+3]=255);var f=new i.DataTexture(h,2,2,i.RGBAFormat),p=new i.DataTexture(h,2,2,i.RGBAFormat),m=new i.DataTexture(u,2,2,i.RGBAFormat),g=new i.DataTexture(c,2,2,i.RGBAFormat),v=new i.DataTexture(h,2,2,i.RGBAFormat),y=new i.DataTexture(h,2,2,i.RGBAFormat),_=new i.Texture(null,i.CubeReflectionMapping,i.RepeatWrapping,i.RepeatWrapping,i.LinearFilter,i.LinearFilter,i.RGBAFormat);return _.image=[p,f,g,m,y,v],_.needsUpdate=!0,_}var s=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268];function l(e,t){var n=255*t[2]+t[3],i=Math.pow(2,(n-127)/2),r=i/t[1],o=t[0]*r,a=s[0]*o+s[3]*i+s[6]*r,l=s[1]*o+s[4]*i+s[7]*r,c=s[2]*o+s[5]*i+s[8]*r;a<0&&(a=0),l<0&&(l=0),c<0&&(c=0),e[0]=a,e[1]=l,e[2]=c}function c(e,t,n){var i=.0625*Math.sqrt(t[0]*n),r=.0625*Math.sqrt(t[1]*n),o=.0625*Math.sqrt(t[2]*n),a=Math.max(Math.max(i,r),Math.max(o,1e-6));a>1&&(a=1);var s=Math.ceil(255*a)/255;i>1&&(i=1),r>1&&(r=1),o>1&&(o=1),e[3]=s;var l=1/s;e[0]=i*l,e[1]=r*l,e[2]=o*l}function u(e,t,n){var i=Math.sqrt(t[0]*n),r=Math.sqrt(t[1]*n),o=Math.sqrt(t[2]*n);i>65504&&(i=65504),r>65504&&(r=65504),o>65504&&(o=65504),e[0]=i,e[1]=r,e[2]=o}var h=new Float32Array(4),d=new Float32Array(4);function f(e,t,n,a){if(e.LogLuv){for(var s=Math.pow(2,t),f=Array.isArray(e.image)?e.image:[e.image],p=0;p<f.length;p++)for(var m=f[p],g=0;g<m.mipmaps.length;g++){var v,y=m.mipmaps[g],_=y.data;n?(v=new Uint16Array(_.length/4*3),y.data=v):v=_.buffer;for(var b=0,x=0;x<_.length;x+=4)h[0]=_[x]/255,h[1]=_[x+1]/255,h[2]=_[x+2]/255,h[3]=_[x+3]/255,l(d,h),n?(u(h,d,s),v[b++]=Object(r.FloatToHalf)(h[0]),v[b++]=Object(r.FloatToHalf)(h[1]),v[b++]=Object(r.FloatToHalf)(h[2])):(c(h,d,s),_[x]=Math.round(255*h[0]),_[x+1]=Math.round(255*h[1]),_[x+2]=Math.round(255*h[2]),_[x+3]=Math.round(255*h[3]))}e.LogLuv=!1,n?(e.type=i.HalfFloatType,e.format=i.RGBFormat,e.RGBM=!1,e.GammaEncoded=!0):e.RGBM=!0,a&&a(e)}else o.logger.warn("Environment map expected to be in LogLuv format.")}},function(e,t,n){"use strict";n.r(t),n.d(t,"FragmentList",function(){return f}),n.d(t,"FragmentPointer",function(){return w});var i=n(14),r=n(0),o=n(5),a=n(1),s=n(81),l=new r.Matrix4,c=new r.Box3,u=new r.Quaternion,h=new r.Vector3,d=new r.Vector3;function f(e,t){this.model=e,this.fragments=e.getData().fragments,this.geoms=e.getGeometryList(),this.pagingProxy=t,this.isFixedSize=this.fragments.length>0,this.isFixedSize?(this.boxes=this.fragments.boxes,this.transforms=this.fragments.transforms,this.useThreeMesh=!i.memoryOptimizedLoading):(this.boxes=null,this.transforms=null,this.useThreeMesh=!t||!t.onDemandLoadingEnabled());var n=this.fragments.length;if(this.vizflags=new Uint16Array(n),this.useThreeMesh&&(this.vizmeshes=new Array(n)),e.isOTG()){var r=e.getData().metadata.stats,o=r.num_materials,a=r.num_geoms;this.materialids=Object(s.a)(n,o),this.geomids=Object(s.a)(n,a)}else this.geomids=new Int32Array(n),this.materialids=new Int32Array(n);this.materialmap={},this.materialIdMap={},this.nextMaterialId=1,this.db2ThemingColor=[],this.originalColors=[],this.themingOrGhostingNeedsUpdate=[],this.dbIdIsHidden=[],this.dbIdIsGhosted=[],this.animxforms=null;for(var l=0;l<n;l++)this.vizflags[l]=1;!e.isOTG()&&this.fragments.visibilityFlags&&this.vizflags.set(this.fragments.visibilityFlags),this.allVisible=!0,this.allVisibleDirty=!0,this.nextAvailableFragID=n,this.boxTransform=[],this.boxCount=0,this.linesHidden=!1,this.pointsHidden=!1}function p(e){var t=e.r;return e.r=e.b,e.b=t,e}f.prototype.resetBoxRun=function(){this.boxCount=0},f.prototype.getNextAvailableFragmentId=function(){return this.nextAvailableFragID++},f.prototype.fragmentsHaveBeenAdded=function(){return this.vizflags.length>this.fragments.length},f.prototype.getSvfMaterialId=function(e){var t=this.getMaterial(e);return t?t.svfMatId:void 0},f.prototype.onDemandLoadingEnabled=function(){return this.pagingProxy&&this.pagingProxy.onDemandLoadingEnabled()},f.prototype.pageOutGeometryEnabled=function(){return this.pagingProxy&&this.pagingProxy.pageOutGeometryEnabled()},f.prototype.pixelCullingEnable=function(){return this.pagingProxy&&this.pagingProxy.pixelCullingEnable()},f.prototype.pixelCullingThreshold=function(){return this.pagingProxy?this.pagingProxy.pixelCullingThreshold():0},f.prototype.requireGeometry=function(e){var t=null,n=this.geomids[e];if(n>=0&&(t=this.geoms.getGeometry(n)),null==t){var i=this.fragments.packIds?this.fragments.packIds[e]:e;this.pagingProxy&&this.pagingProxy.loadPackFile(i)}return t},f.prototype.promiseGeometry=function(e){function t(e,t){var n;return(n=e.then(function(){return n&&(delete n.lmv_loader_promise,n.lmv_geom_canceled)?Promise.reject({canceled:!0}):t},function(e){return n&&(delete n.lmv_loader_promise,n.lmv_geom_canceled)?Promise.reject({canceled:!0}):Promise.reject(e)})).lmv_loader_promise=e,n}if(this.getGeometry(e))return t(Promise.resolve(),{model:this.model,fragId:e});var n=this.fragments.packIds?this.fragments.packIds[e]:e;if(!this.pagingProxy||!this.pagingProxy.promisePackFile)return t(Promise.reject({reason:"Not supported"}));var i=this.pagingProxy.promisePackFile(n);return i.hasOwnProperty("lmv_promise_count")||(i.lmv_promise_count=0),++i.lmv_promise_count,this.pagingProxy.pageOut(!1,!1),t(i,{model:this.model,fragId:e})},f.prototype.cancelPromisedGeometry=function(e){if(!e)return!1;var t=e.lmv_loader_promise;return!!t&&(!!e.lmv_geom_canceled||(e.lmv_geom_canceled=!0,t.hasOwnProperty("lmv_promise_count")&&--t.lmv_promise_count<=0&&this.pagingProxy&&this.pagingProxy.promisePackFile&&this.pagingProxy.cancelPromisedPackFile(t),!0))},f.prototype.setMesh=function(e,t,n){if(this.vizmeshes){var i=this.vizmeshes[e];i&&i.parent&&i.parent.remove(i)}if(this.vizflags.length<=e){this.isFixedSize&&(a.logger.warn("Attempting to resize a fragments list that was initialized with fixed data. This will have a performance impact."),this.isFixedSize=!1);var s=Math.ceil(1.5*this.vizflags.length)||1;this.useThreeMesh&&s<this.vizmeshes.length&&(s=this.vizmeshes.length);var l=new Uint16Array(s);if(l.set(this.vizflags),this.vizflags=l,this.transforms){var u=new Float32Array(12*s);u.set(this.transforms),this.transforms=u}if(this.boxes){var h=new Float32Array(6*s);h.set(this.boxes),this.boxes=h}if(this.geomids){var d=new Int32Array(s);d.set(this.geomids),this.geomids=d}if(this.materialids){var f=new Int32Array(s);f.set(this.materialids),this.materialids=f}}if(this.useThreeMesh){var p=new r.Mesh(t.geometry,t.material);t.matrix&&(p.matrix&&p.matrix.copy(t.matrix),p.matrixWorld.copy(t.matrix)),p.is2d=t.is2d,p.isLine=t.isLine,p.isWideLine=t.isWideLine,p.isPoint=t.isPoint,p.matrixAutoUpdate=!1,p.frustumCulled=!1,p.fragId=e,p.dbId=0|this.fragments.fragId2dbId[e],p.modelId=this.model.getModelId(),this.vizmeshes[e]=p}else{var m=void 0;t.geometry.hash?(void 0===t.geomId&&console.error("meshInfo must provide geomId"),m=t.geomId):m=t.geometry.svfid,this.geomids[e]=m,this.setMaterial(e,t.material)}var g=0;if(t.isLine?g=o.MeshFlags.MESH_ISLINE:t.isWideLine?g=o.MeshFlags.MESH_ISWIDELINE:t.isPoint&&(g=o.MeshFlags.MESH_ISPOINT),this.isFixedSize?this.vizflags[e]|=g:this.vizflags[e]|=o.MeshFlags.MESH_VISIBLE|g,n){var v=t.matrix,y=12*e,_=v.elements,b=this.transforms;if(b[y]=_[0],b[y+1]=_[1],b[y+2]=_[2],b[y+3]=_[4],b[y+4]=_[5],b[y+5]=_[6],b[y+6]=_[8],b[y+7]=_[9],b[y+8]=_[10],b[y+9]=_[12],b[y+10]=_[13],b[y+11]=_[14],!this.boxesLoaded){t.geometry&&t.geometry.boundingBox?c.copy(t.geometry.boundingBox):this.geoms.getModelBox(this.geomids[e],c),c.empty()||c.applyMatrix4(v);var x=6*e,w=this.boxes;w[x]=c.min.x,w[x+1]=c.min.y,w[x+2]=c.min.z,w[x+3]=c.max.x,w[x+4]=c.max.y,w[x+5]=c.max.z}}},f.prototype.isFlagSet=function(e,t){return!!(this.vizflags[e]&t)},f.prototype.setFlagFragment=function(e,t,n){var i=this.vizflags[e];return!!(i&t)!=n&&(this.vizflags[e]=n?i|t:i&~t,!0)},f.prototype.setFlagGlobal=function(e,t){var n=this.vizflags,i=0,r=n.length;if(t)for(;i<r;i++)n[i]=n[i]|e;else for(var o=~e;i<r;i++)n[i]=n[i]&o},f.prototype.hideLines=function(e){this.linesHidden=e},f.prototype.hidePoints=function(e){this.pointsHidden=e},f.prototype.hideFragments=function(e,t){var n=o.MeshFlags.MESH_HIDE,i=this.vizflags,r=0,a=i.length;if(t)for(;r<a;r++)i[r]&e&&(i[r]=i[r]|n);else for(var s=~n;r<a;r++)i[r]&e&&(i[r]=i[r]&s);this.allVisibleDirty=!0},f.prototype.isFragVisible=function(e){var t=this.linesHidden&&(this.isLine(e)||this.isWideLine(e)),n=this.pointsHidden&&this.isPoint(e);return 1==(this.vizflags[e]&(o.MeshFlags.MESH_VISIBLE|o.MeshFlags.MESH_HIDE))&&!t&&!n},f.prototype.isFragOff=function(e){return!!(this.vizflags[e]&o.MeshFlags.MESH_HIDE)},f.prototype.isNotLoaded=function(e){return this.vizflags[e]&o.MeshFlags.MESH_NOTLOADED},f.prototype.isLine=function(e){return!!(this.vizflags[e]&o.MeshFlags.MESH_ISLINE)},f.prototype.isWideLine=function(e){return this.isFlagSet(e,o.MeshFlags.MESH_ISWIDELINE)},f.prototype.isPoint=function(e){return this.isFlagSet(e,o.MeshFlags.MESH_ISPOINT)},f.prototype.areAllVisible=function(){if(this.allVisibleDirty){for(var e=this.vizflags,t=!0,n=0,i=e.length;n<i;n++)if(0==(1&e[n])){t=!1;break}this.allVisible=t,this.allVisibleDirty=!1}return this.allVisible};var m,g,v,y,_,b=(m=null,g=null,v=parseInt("00FFFFFF",16),y=parseInt("FF000000",16),function(e,t){return m||(m=new r.Color,g=new r.Color),m.set(e&v),p(m),t&&(g.setRGB(t.x,t.y,t.z),m.lerp(g,t.w)),p(m).getHex()|e&y});function x(e,t){if(e.model.is2d()){var n=e.fragments.dbId2fragId[t];if(Array.isArray(n))for(var i=0;i<n.length;i++)e.themingOrGhostingNeedsUpdate[n[i]]=!0;else"number"==typeof n&&(e.themingOrGhostingNeedsUpdate[n]=!0)}}function w(e,t){this.frags=e,this.fragId=t,this.scale=null,this.quaternion=null,this.position=null}f.prototype.getVizmesh=function(){var e=new r.Mesh(void 0,void 0,!0);e.isTemp=!0,e.dbId=0,e.modelId=0,e.fragId=-1,e.hide=!1,e.isLine=!1,e.isWideLine=!1,e.isPoint=!1;var t=new r.MeshLambertMaterial({color:0,depthWrite:!1,emissive:13421772});t.cutplanes=null;var n=new Float32Array([1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,1,1,-1,-1,-1,-1,-1,-1,1,1,-1,1,1,1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,1,-1,-1,-1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,1,1,1,1,-1,-1]),i=new r.BufferGeometry;return i.addAttribute("position",new r.BufferAttribute(n,3)),function(n,o,a){if(this.model.is2d()&&function(e,t){var n=e.originalColors[t];if(e.themingOrGhostingNeedsUpdate[t]){var i=e.getGeometry(t),r=i?i.attributes:null,o=r?r.color4b:null,a=r?r.dbId4b:null,s=r?r.layerVp4b:null,l=r?r.flags4b:null;if(o&&a&&i.vb&&s&&l){for(var c=new Uint32Array(i.vb.buffer),u=i.vbstride,h=c.length/i.vbstride,d=!1,f=o.itemOffset,p=a.itemOffset,m=s.itemOffset,g=l.itemOffset,v=0;v<h;v++){var y=c[v*u+p],_=n?n[v]:c[v*u+f],x=c[v*u+m],w=-1==(y=y<<8>>8)&&0==(x&parseInt("FFFF",16)),A=e.db2ThemingColor[y],E=e.dbIdIsHidden[y];if(A||E){if(!n){n=new Uint32Array(h);for(var T=0;T<h;T++)n[T]=c[T*u+f];e.originalColors[t]=n}_=E?0:b(_,A),d=!0}else n&&(_=n[v]);c[v*u+f]=_;var M=e.dbIdIsGhosted[y]&&!w,S=c[v*u+g];M?S|=255<<24:S&=16777215,c[v*u+g]=S}d||(e.originalColors[t]=null),i.vbNeedsUpdate=!0,e.themingOrGhostingNeedsUpdate[t]=!1}}}(this,n),this.useThreeMesh)return this.vizmeshes[n];this.getWorldMatrix(n,e.matrixWorld),e.visible=!0,e.hide=this.isFragOff(n),e.fragId=n,e.dbId=this.getDbIds(n),e.themingColor=this.db2ThemingColor[e.dbId],e.modelId=this.model.getModelId(),e.geometry=this.getGeometry(n);var s=!1;if(!s){var l=this.pagingProxy?this.pagingProxy.options.debug.boxProxyMaxCount:0;if(!e.geometry&&this.boxCount<l){var u=this.pagingProxy?this.pagingProxy.options.debug.boxProxyMinScreen:.1;(void 0===o||0==o||void 0!==o&&o>u)&&(s=!0)}}return s?(!function(e,t,n){if(!n.boxTransform[t]){!function(e,t,n,i){var r=e*t,o=i.boxes;n.min.x=o[r],n.min.y=o[r+1],n.min.z=o[r+2],n.max.x=o[r+3],n.max.y=o[r+4],n.max.z=o[r+5]}(t,6,c,n);var o=new r.Matrix4;d.subVectors(c.max,c.min),d.multiplyScalar(.5),o.makeScale(d.x,d.y,d.z),h.addVectors(c.max,c.min),h.multiplyScalar(.5);var a=o.elements;a[12]=h.x,a[13]=h.y,a[14]=h.z,n.boxTransform[t]=o}e.geometry_proxy=i,e.matrixWorld.copy(n.boxTransform[t])}(e,n,this),a||(e.geometry=e.geometry_proxy),this.boxCount++,e.material=t,e.isLine=!1,e.isWideLine=!1,e.isPoint=!1):(e.material=this.getMaterial(n),e.isLine=this.isLine(n),e.isWideLine=this.isWideLine(n),e.isPoint=this.isPoint(n),e.geometry&&this.boxTransform[n]&&(this.boxTransform[n]=null)),e}}(),f.prototype.promiseVizmesh=function(e){return this.promiseGeometry(e)},f.prototype.cancelPromisedVizmesh=function(e){return this.cancelPromisedGeometry(e)},f.prototype.getMaterialId=function(e){var t=this.getMaterial(e);return t?t.id:0},f.prototype.getMaterial=function(e){return this.useThreeMesh?this.vizmeshes[e].material:this.materialIdMap[this.materialids[e]]},f.prototype.getGeometry=function(e){var t;return this.useThreeMesh?(t=this.vizmeshes[e])?t.geometry:null:this.geoms.getGeometry(this.geomids[e])},f.prototype.lockGeometry=function(e){return!!this.useThreeMesh||this.geoms.lockGeometry(this.geomids[e])},f.prototype.unlockGeometry=function(e){return!!this.useThreeMesh||this.geoms.unlockGeometry(this.geomids[e])},f.prototype.getLockCount=function(e){return this.useThreeMesh?0:this.geoms.getLockCount(this.geomids[e])},f.prototype.getGeometryId=function(e){return this.useThreeMesh?e:this.geomids[e]},f.prototype.setMaterial=function(e,t){if(this.useThreeMesh)this.vizmeshes[e].material=t;else{var n=this.materialmap[t.id];n||(n=this.nextMaterialId++,this.materialids=Object(s.b)(this.materialids,n),this.materialIdMap[n]=t,this.materialmap[t.id]=n),this.materialids[e]=n}},f.prototype.getCount=function(){return this.vizmeshes?this.vizmeshes.length:this.vizflags.length},f.prototype.getDbIds=function(e){return this.fragments.fragId2dbId[e]},f.prototype.dispose=function(e){if(this.useThreeMesh)for(var t={type:"dispose"},n={type:"removed"},i=0;i<this.vizmeshes.length;i++){var r=this.vizmeshes[i];r&&(r.dispatchEvent(n),r.geometry.dispatchEvent(t))}else this.geoms.dispose(e)},f.prototype.setVisibility=function(e,t){this.setFlagFragment(e,o.MeshFlags.MESH_VISIBLE,t),this.allVisibleDirty=!0},f.prototype.setFragOff=function(e,t){this.setFlagFragment(e,o.MeshFlags.MESH_HIDE,t),this.allVisibleDirty=!0},f.prototype.setAllVisibility=function(e){if(this.model.is2d()){var t=this.fragments;if(t&&t.dbId2fragId)for(var n in t.dbId2fragId)this.setObject2DGhosted(n,!e)}else this.setFlagGlobal(o.MeshFlags.MESH_VISIBLE,e),this.allVisible=e,this.allVisibleDirty=!1},f.prototype.updateAnimTransform=function(e,t,n,i){var r,a=this.animxforms;if(!a){var s=this.getCount();a=this.animxforms=new Float32Array(10*s);for(var l=0;l<s;l++)a[r=10*l]=1,a[r+1]=1,a[r+2]=1,a[r+3]=0,a[r+4]=0,a[r+5]=0,a[r+6]=1,a[r+7]=0,a[r+8]=0,a[r+9]=0}r=10*e;var c=!1;t&&(a[r]=t.x,a[r+1]=t.y,a[r+2]=t.z,c=!0),n&&(a[r+3]=n.x,a[r+4]=n.y,a[r+5]=n.z,a[r+6]=n.w,c=!0),i&&(a[r+7]=i.x,a[r+8]=i.y,a[r+9]=i.z,c=!0),this.setFlagFragment(e,o.MeshFlags.MESH_MOVED,c),c||(a[r]=1,a[r+1]=1,a[r+2]=1,a[r+3]=0,a[r+4]=0,a[r+5]=0,a[r+6]=1,a[r+7]=0,a[r+8]=0,a[r+9]=0)},f.prototype.getAnimTransform=function(e,t,n,i){if(!this.animxforms)return!1;if(!this.isFlagSet(e,o.MeshFlags.MESH_MOVED))return!1;var r=10*e,a=this.animxforms;return t&&(t.x=a[r],t.y=a[r+1],t.z=a[r+2]),n&&(n.x=a[r+3],n.y=a[r+4],n.z=a[r+5],n.w=a[r+6]),i&&(i.x=a[r+7],i.y=a[r+8],i.z=a[r+9]),!0},f.prototype.getOriginalWorldMatrix=function(e,t){var n=12*e,i=t.elements,r=this.transforms;if(r)i[0]=r[n],i[1]=r[n+1],i[2]=r[n+2],i[3]=0,i[4]=r[n+3],i[5]=r[n+4],i[6]=r[n+5],i[7]=0,i[8]=r[n+6],i[9]=r[n+7],i[10]=r[n+8],i[11]=0,i[12]=r[n+9],i[13]=r[n+10],i[14]=r[n+11],i[15]=1;else if(this.useThreeMesh){var o=this.getVizmesh(e);o?t.copy(o.matrixWorld):t.identity()}else t.identity()},f.prototype.getWorldMatrix=(_=new r.Matrix4,function(e,t){this.getOriginalWorldMatrix(e,t),this.isFlagSet(e,o.MeshFlags.MESH_MOVED)&&(this.getAnimTransform(e,d,u,h),_.compose(h,u,d),t.multiplyMatrices(_,t))}),f.prototype.getWorldBounds=function(e,t){if(this.boxes&&!this.isFlagSet(e,o.MeshFlags.MESH_MOVED)){var n=this.boxes,i=6*e;return t.min.x=n[i],t.min.y=n[i+1],t.min.z=n[i+2],t.max.x=n[i+3],t.max.y=n[i+4],void(t.max.z=n[i+5])}if(this.useThreeMesh){var r=this.getVizmesh(e);r&&r.geometry&&t.copy(r.geometry.boundingBox)}else this.geoms.getModelBox(this.geomids[e],t);t.empty()||(this.getWorldMatrix(e,l),t.applyMatrix4(l))},f.prototype.getOriginalWorldBounds=function(e,t){if(this.boxes){var n=this.boxes,i=6*e;return t[0]=n[i],t[1]=n[i+1],t[2]=n[i+2],t[3]=n[i+3],t[4]=n[i+4],void(t[5]=n[i+5])}if(this.useThreeMesh){var r=this.getVizmesh(e);r&&r.geometry&&c.copy(r.geometry.boundingBox)}else this.geoms.getModelBox(this.geomids[e],c);c.empty()||(this.getOriginalWorldMatrix(e,l),c.applyMatrix4(l)),t[0]=c.min.x,t[1]=c.min.y,t[2]=c.min.z,t[3]=c.max.x,t[4]=c.max.y,t[5]=c.max.z},f.prototype.setThemingColor=function(e,t){var n=this.db2ThemingColor[e];n===t||n&&t&&n.equals(t)||(this.db2ThemingColor[e]=t,x(this,e))},f.prototype.clearThemingColors=function(){if(this.model.is2d())for(var e=1,t=this.fragments.dbId2fragId.length;e<t;e++)x(this,e);this.db2ThemingColor.length=0},f.prototype.setObject2DGhosted=function(e,t){!!t!=!!this.dbIdIsGhosted[e]&&(this.dbIdIsGhosted[e]=t,x(this,e))},f.prototype.setObject2DVisible=function(e,t){t!==!this.dbIdIsHidden[e]&&(this.dbIdIsHidden[e]=!t,x(this,e))},f.prototype.getMemoryInfo=function(){return this.pagingProxy?this.pagingProxy.getMemoryInfo():null},w.prototype.getWorldMatrix=function(e){this.frags.getWorldMatrix(this.fragId,e)},w.prototype.getOriginalWorldMatrix=function(e){this.frags.getOriginalWorldMatrix(this.fragId,e)},w.prototype.getWorldBounds=function(e){return this.frags.getWorldBounds(this.fragId,e)},w.prototype.getAnimTransform=function(){return this.scale||(this.scale=new r.Vector3(1,1,1),this.quaternion=new r.Quaternion(0,0,0,1),this.position=new r.Vector3(0,0,0)),this.frags.getAnimTransform(this.fragId,this.scale,this.quaternion,this.position)},w.prototype.updateAnimTransform=function(){this.scale||(this.scale=new r.Vector3(1,1,1),this.quaternion=new r.Quaternion(0,0,0,1),this.position=new r.Vector3(0,0,0)),this.frags.updateAnimTransform(this.fragId,this.scale,this.quaternion,this.position)},w.prototype.getMaterial=function(){return this.frags.getMaterial(this.fragId)},w.prototype.setMaterial=function(e){return this.frags.setMaterial(this.fragId,e)}},function(e,t,n){"use strict";n.r(t),n.d(t,"GeomMergeTask",function(){return r}),n.d(t,"writeIdToBuffer",function(){return a});var i=1;function r(){this.vb=null,this.vbstride=0,this.posOffset=0,this.normalOffset=0,this.matrices=null,this.ranges=null,this.dbIds=null,this.id=i++}function o(e){e.x=.5*(1+Math.atan2(e.y,e.x)/Math.PI),e.y=.5*(1+e.z),e.z=0}function a(e,t,n){t[n++]=255&e,t[n++]=e>>8&255,t[n++]=e>>16&255,t[n]=0}var s=function(e,t,n,i,r,a,s){for(var l,c,u,h,d,f,p,m=e.posOffset,g=i;g<r;g++){var v=g*e.vbstride+m;s.set(e.vb[v],e.vb[v+1],e.vb[v+2]),s.applyMatrix4(n),e.vb[v]=s.x,e.vb[v+1]=s.y,e.vb[v+2]=s.z}if(-1!==e.normalOffset){var y=2*e.vbstride,_=2*e.normalOffset,b=function(e,t){return t.copy(e),t[12]=0,t[13]=0,t[14]=0,t.getInverse(t).transpose()}(n,a);for(g=i;g<r;g++){var x=g*y+_;s.set(t[x],t[x+1],0),s.divideScalar(65535),c=void 0,u=void 0,h=void 0,d=void 0,f=void 0,p=void 0,c=2*(l=s).x-1,u=2*l.y-1,h=Math.sin(c*Math.PI),d=Math.cos(c*Math.PI),f=Math.sqrt(1-u*u),p=u,l.x=d*f,l.y=h*f,l.z=p,s.applyMatrix4(b),s.normalize(),o(s),s.multiplyScalar(65535),t[x]=s.x,t[x+1]=s.y}}};function l(e,t,n){for(var i=16*e,r=0;r<16;r++)n.elements[r]=t[r+i]}r.prototype.run=function(e,t){for(var n=this.vb,i=n.length/this.vbstride,r=e.clone(),o=new Uint8Array(3*i),c=-1!==this.normalOffset?new Uint16Array(n.buffer,n.byteOffset,2*n.length):null,u=this.ranges,h=this.matrices,d=u.length-1,f=0;f<d;f++){var p=u[f],m=u[f+1];l(f,h,e),s(this,c,e,p,m,r,t);for(var g=3*p,v=m-p,y=this.dbIds[f],_=0;_<v;_++)a(y,o,g),g+=3}return{taskId:this.id,vb:this.vb,vertexIds:o}}},function(e,t,n){"use strict";n.r(t),n.d(t,"InstanceBufferBuilder",function(){return l});var i=n(54),r=n(96),o=n(51),a=n(1),s=n(0);function l(e,t){var n=Object(o.createBufferGeometry)();n.ib=e.ib,n.vb=e.vb,n.iblines=e.iblines,Object(i.copyVertexFormat)(e,n),Object(i.copyPrimitiveProps)(e,n);this.offsets=new Float32Array(3*t),this.rotations=new Float32Array(4*t),this.scalings=new Float32Array(3*t),this.ids=new Uint8Array(3*t);var l=new s.Vector3,c=new s.Quaternion,u=new s.Vector3,h=new s.Matrix4,d=0,f=t;this.addInstance=function(e,t){return d>=f?(a.logger.warn("Instance buffer is already full."),!1):(e.decompose(l,c,u),!!function(e,t,n,i){h.compose(t,n,i);for(var r=e.elements,o=h.elements,a=0;a<16;a++){var s=r[a],l=o[a];if(Math.abs(l-s)>1e-5)return!1}return!0}(e,l,c,u)&&(this.offsets[3*d]=l.x,this.offsets[3*d+1]=l.y,this.offsets[3*d+2]=l.z,this.rotations[4*d]=c.x,this.rotations[4*d+1]=c.y,this.rotations[4*d+2]=c.z,this.rotations[4*d+3]=c.w,this.scalings[3*d]=u.x,this.scalings[3*d+1]=u.y,this.scalings[3*d+2]=u.z,Object(r.writeIdToBuffer)(t,this.ids,3*d),d++,!0))},this.finish=function(){if(0==d)return null;d<f&&(this.offsets=new Float32Array(this.offsets.buffer,0,3*d),this.rotations=new Float32Array(this.rotations.buffer,0,4*d),this.scalings=new Float32Array(this.scalings.buffer,0,3*d),this.ids=new Uint8Array(this.ids.buffer,0,3*d));var e=new s.BufferAttribute(this.offsets,3),t=new s.BufferAttribute(this.rotations,4),i=new s.BufferAttribute(this.scalings,3),r=new s.BufferAttribute(this.ids,3);return r.normalize=!0,r.bytesPerItem=1,e.divisor=1,t.divisor=1,i.divisor=1,r.divisor=1,n.addAttribute("instOffset",e),n.addAttribute("instRotation",t),n.addAttribute("instScaling",i),n.addAttribute("id",r),n.numInstances=d,n.byteSize=n.vb.byteLength+n.ib.byteLength+this.offsets.byteLength+this.rotations.byteLength+this.scalings.byteLength,n}}},function(e,t,n){"use strict";n.r(t),n.d(t,"InstanceTree",function(){return o});var i=n(75),r=n(1);function o(e,t,n){this.nodeAccess=e,this.maxDepth=n,this.objectCount=t,this.numHidden=0,this.numOff=0,this.fragList=null}o.prototype.setFlagNode=function(e,t,n){var i=this.nodeAccess.getNodeFlags(e);return!!(i&t)!=n&&(n?this.nodeAccess.setNodeFlags(e,i|t):this.nodeAccess.setNodeFlags(e,i&~t),!0)},o.prototype.setFlagGlobal=function(e,t){var n=this.nodeAccess,i=0,r=n.numNodes;if(t)for(;i<r;i++)n.setNodeFlags(i,n.getNodeFlags(i)|e);else for(var o=~e;i<r;i++)n.setNodeFlags(i,n.getNodeFlags(i)&o)},o.prototype.setNodeOff=function(e,t){var n=this.setFlagNode(e,1073741824,t);return n&&(t?this.numOff++:this.numOff--),n},o.prototype.isNodeOff=function(e){return!!(1073741824&this.nodeAccess.getNodeFlags(e))},o.prototype.setNodeHidden=function(e,t){var n=this.setFlagNode(e,2147483648,t);return n&&(t?this.numHidden++:this.numHidden--),n},o.prototype.isNodeHidden=function(e){return!!(2147483648&this.nodeAccess.getNodeFlags(e))},o.prototype.getNodeType=function(e){return 7&this.nodeAccess.getNodeFlags(e)},o.prototype.isNodeSelectable=function(e){return!(536870912&this.nodeAccess.getNodeFlags(e))},o.prototype.getNodeParentId=function(e){return this.nodeAccess.getParentId(e)},o.prototype.getRootId=function(){return this.nodeAccess.rootId},o.prototype.getNodeName=function(e){return this.nodeAccess.name(e)},o.prototype.getChildCount=function(e){return this.nodeAccess.getNumChildren(e)};var a=new Array(6);o.prototype.getNodeBox=function(e,t){if(this.nodeAccess.nodeBoxes)this.nodeAccess.getNodeBox(e,t);else{var n=this.fragList;if(n)return t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0,void this.enumNodeFragments(e,function(e){n.getOriginalWorldBounds(e,a),t[0]=Math.min(t[0],a[0]),t[1]=Math.min(t[1],a[1]),t[2]=Math.min(t[2],a[2]),t[3]=Math.max(t[3],a[3]),t[4]=Math.max(t[4],a[4]),t[5]=Math.max(t[5],a[5])},!0);r.logger.error("getNodeBox() requires fragBoxes or nodeBoxes")}},o.prototype.getNodeIndex=function(e){return this.nodeAccess.getIndex(e)},o.prototype.enumNodeFragments=function(e,t,n){var i;"number"==typeof e?i=e:e&&(i=e.dbId);var r=this;return function e(i){var o=r.nodeAccess.enumNodeFragments(i,t);return o||(n&&(o=r.enumNodeChildren(i,function(t){return e(t)}))?o:void 0)}(i)},o.prototype.enumNodeChildren=function(e,t,n){var i;"number"==typeof e?i=e:e&&(i=e.dbId);var r=this;if(n&&t(i))return i;return function e(i){var o=r.nodeAccess.enumNodeChildren(i,function(i){return t(i)?i:n?e(i):void 0});if(o)return o}(i)},o.prototype.findNodeForSelection=function(e,t){if(t===i.SelectionMode.LEAF_OBJECT)return e;var n,r,o=e;if(t===i.SelectionMode.FIRST_OBJECT){var a=[];for(n=e;n;)a.push(n),n=this.getNodeParentId(n);for(var s=a.length-1;s>=0;s--)if(5!==(r=this.getNodeType(a[s]))&&2!==r&&3!==r){o=a[s];break}}else if(t===i.SelectionMode.LAST_OBJECT)for(n=e;n;){if(4===(r=this.getNodeType(n))){o=n;break}n=this.getNodeParentId(n)}return o},o.prototype.setFragmentList=function(e){this.fragList=e}},function(e,t,n){"use strict";n.r(t),n.d(t,"ViewerState",function(){return a});var i=n(1),r=n(20);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e){this.getState=function(t){var n=e.navigation,i={};i.seedURN=this.getSeedUrn();var r=i.objectSet;Array.isArray(r)||(i.objectSet=r=[]),e.model&&!e.model.is2d()&&(r[0]={id:this.getSelectedNodes(),isolated:e.getIsolatedNodes(),hidden:e.getHiddenNodes(),explodeScale:e.getExplodeScale(),idType:"lmv"}),e.model&&e.model.is2d()&&(r[0]={id:this.getSelectedNodes(),isolated:this.getVisibleLayers2d(),allLayers:this.areAllLayersVisible(),hidden:[],idType:"lmv"});var o=i.viewport;o||(o=i.viewport={});var a=n.getCamera().isPerspective;o.name="",o.eye=n.getPosition().toArray(),o.target=n.getTarget().toArray(),o.up=n.getCameraUpVector().toArray(),o.worldUpVector=n.getWorldUpVector().toArray(),o.pivotPoint=n.getPivotPoint().toArray(),o.distanceToOrbit=n.getPivotPlaneDistance(),o.aspectRatio=this.getAspectRatio(),o.projection=a?"perspective":"orthographic",o.isOrthographic=!a,a?o.fieldOfView=n.getVerticalFov():o.orthographicHeight=this.getOrthographicHeight();var s=i.renderOptions;if(s||(s=i.renderOptions={}),s.environment=this.getEnvironmentName(),s.ambientOcclusion={enabled:e.impl.renderer().getAOEnabled(),radius:e.impl.renderer().getAORadius(),intensity:e.impl.renderer().getAOIntensity()},s.toneMap={method:e.impl.renderer().getToneMapMethod(),exposure:e.impl.renderer().getExposureBias(),lightMultiplier:this.getToneMapIntensity()},s.appearance={ghostHidden:e.impl.showGhosting,ambientShadow:e.prefs.ambientShadows,antiAliasing:e.impl.renderer().settings.antialias,progressiveDisplay:e.prefs.progressiveRendering,swapBlackAndWhite:e.prefs.swapBlackAndWhite,displayLines:e.prefs.lineRendering,displayPoints:e.prefs.pointRendering},e.model&&!e.model.is2d())for(var l=i.cutplanes=[],c=e.getCutPlanes(),u=0;u<c.length;u++)l.push(c[u].toArray());for(var h in e.loadedExtensions){var d=e.loadedExtensions[h];d.getState&&d.getState(i)}return t&&!0!==t&&this.applyFilter(i,t),i},this.restoreState=function(t,n,r){if(!t)return i.logger.warn("restoreState has no viewer state to restore from."),!1;if(!e||!e.model)return i.logger.warn("restoreState has no viewer or model to restore."),!1;n&&!0!==n&&(t=JSON.parse(JSON.stringify(t)),this.applyFilter(t,n));var o=e.navigation,a=e.model.is2d(),s=!a;if(Array.isArray(t.objectSet)&&t.objectSet.length>0){var l=t.objectSet[0],c=l.id;if(c&&(c=this.toIntArray(c),e.select(c)),a){var u=l.isolated;Array.isArray(u)&&u.length>0?(e.setLayerVisible(null,!1),e.impl.setLayerVisible(u,!0)):e.setLayerVisible(null,!0)}else{var h=l.isolated||[];if(h=this.toIntArray(h),e.isolate(h),0===h.length){var d=l.hidden||null;d&&d.length>0&&(d=this.toIntArray(d),e.hide(d))}}if("explodeScale"in l){var f=parseFloat(l.explodeScale);e.explode&&e.explode(f)}}var p=t.viewport;if(p){var m=this.getVector3FromArray(p.eye,o.getPosition()),g=this.getVector3FromArray(p.up,o.getCameraUpVector()),v=this.getVector3FromArray(p.target,o.getTarget()),y="fieldOfView"in p?parseFloat(p.fieldOfView):o.getVerticalFov(),_=this.getVector3FromArray(p.worldUpVector,null);if(!_){var b=e.model?e.model.getUpVector():null;_=b?(new THREE.Vector3).fromArray(b):new THREE.Vector3(0,1,0)}var x=this.getVector3FromArray(p.pivotPoint,o.getPivotPoint()),w=o.getCamera().isPerspective;"isOrthographic"in p&&(w=!p.isOrthographic);var A=this.getOrthographicHeight();"orthographicHeight"in p&&(A=Number(p.orthographicHeight));var E={position:m,target:v,up:g,worldup:_,aspect:e.impl.camera.aspect,fov:y,orthoScale:A,isPerspective:w,pivot:x};this.restoreCameraState(E,r)}var T=t.renderOptions;if(T){var M=e.impl.renderer(),S=e.prefs,C=S.ambientShadows,P=S.antialiasing,L=T.ambientOcclusion;if(L){"enabled"in L&&(C=L.enabled);var R="radius"in L?L.radius:null,D="intensity"in L?L.intensity:null;null!==R&&null!==D&&(R===M.getAORadius()&&D===M.getAOIntensity()||(M.setAOOptions(R,D),M.composeFinalFrame()))}if("environment"in T){var I=this.getLightPresetIndex(T.environment);-1!==I&&I!==S.get("lightPreset")&&s&&e.setLightPreset(I)}var O=T.toneMap;if(O){var N=!1,k="exposure"in O?O.exposure:null,V="lightMultiplier"in O?O.lightMultiplier:null;null!==k&&k!==M.getExposureBias()&&(M.setTonemapExposureBias(k),N=!0),null!==V&&e.impl.dir_light1&&V!==this.getToneMapIntensity()&&(e.impl.dir_light1.intensity=Math.pow(2,V),N=!0),N&&e.impl.invalidate(!0)}var F=T.appearance;F&&("antiAliasing"in F&&(P=F.antiAliasing),"progressiveDisplay"in F&&F.progressiveDisplay!==S.get("progressiveRendering")&&e.setProgressiveRendering(F.progressiveDisplay),"swapBlackAndWhite"in F&&F.swapBlackAndWhite!==S.get("swapBlackAndWhite")&&e.setSwapBlackAndWhite(F.swapBlackAndWhite),"ghostHidden"in F&&F.ghostHidden!==S.get("ghosting")&&s&&e.setGhosting(F.ghostHidden),"displayLines"in F&&F.displayLines!==S.get("lineRendering")&&e.hideLines(!F.displayLines),"displayPoints"in F&&F.displayPoints!==S.get("pointRendering")&&e.hidePoints(!F.displayPoints)),s&&C!==S.ambientShadows&&P!==S.antialiasing&&e.setQualityLevel(C,P)}if(Array.isArray(t.cutplanes)&&e.model&&s){for(var B=[],U=0;U<t.cutplanes.length;U++){var z=t.cutplanes[U];Array.isArray(z)&&z.length>=4&&B.push(new THREE.Vector4(z[0],z[1],z[2],z[3]))}e.setCutPlanes(B)}for(var G in e.loadedExtensions){var H=e.loadedExtensions[G];H.restoreState&&H.restoreState(t,r)}return!0},this.getEnvironmentName=function(){var t=r.LightPresets[e.impl.currentLightPreset()];return t?t.name:"none"},this.restoreCameraState=function(t,n){e.impl.adjustOrthoCamera(t);var i=e.navigation;n?(t.isPerspective?i.toPerspective():i.toOrthographic(),i.setCameraUpVector(t.up),i.setWorldUpVector(t.worldup),i.setView(t.position,t.target),i.setPivotPoint(t.pivot),i.setVerticalFov(t.fov,!1),e.impl.syncCamera(!0)):(e.impl.camera.isPerspective=t.isPerspective,i.setRequestTransitionWithUp(!0,t.position,t.target,t.fov,t.up,t.worldup,t.pivot))},this.areEqual=function(e,t,n){function i(e,t){if(t=t||[],(e=e||[]).length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}function r(e,t,n){return t=t||[],(e=e||[]).length===t.length&&(0!==e.length&&(a(e[0],t[0],n)||a(e[1],t[1],n)||a(e[2],t[2],n)))}function a(e,t,n){var i=e?parseFloat(e):null,r=e?parseFloat(t):null,a=o(i),s=o(r);return"number"===a&&"number"===s?Math.abs(e-t)<n:(e=e||null)===(t=t||null)}var s=e,l=t;if(n&&!0!==n&&(s=this.applyFilter(s,n),l=this.applyFilter(l,n)),s.seedURN!==l.seedURN)return!1;var c=s.objectSet||[],u=l.objectSet||[];if(c.length!==u.length)return!1;var h=c[0]||{},d=u[0]||{};if(!(h.idType===d.idType&&a(h.explodeScale,d.explodeScale,1e-9)&&i(h.id,d.id)&&i(h.isolated,d.isolated)&&i(h.hidden,d.hidden)))return!1;var f=s.viewport||{},p=l.viewport||{};return!!(f.name===p.name&&f.projection===p.projection&&f.isOrthographic===p.isOrthographic&&a(f.distanceToOrbit,p.distanceToOrbit,1e-9)&&a(f.fieldOfView,p.fieldOfView,1e-9)&&a(f.orthographicHeight,p.orthographicHeight,1e-9)&&r(f.eye,p.eye,1e-9)&&r(f.target,p.target,1e-9)&&r(f.up,p.up,1e-9)&&r(f.worldUpVector,p.worldUpVector,1e-9)&&r(f.pivotPoint,p.pivotPoint,1e-9))},this.toIntArray=function(e){var t=[];if(Array.isArray(e))for(var n=0,i=e.length;n<i;++n)t.push(parseInt(e[n]));return t},this.extractSelectedNodeIds=function(e){if(e&&Array.isArray(e.objectSet)&&e.objectSet.length>0){var t=e.objectSet[0];return this.toIntArray(t.id)}return[]},this.extractIsolatedNodeIds=function(e){if(e&&Array.isArray(e.objectSet)&&e.objectSet.length>0){var t=e.objectSet[0];return this.toIntArray(t.isolated)}return[]},this.getVector3FromArray=function(e,t){return e instanceof Array&&e.length>2?(e[0]=parseFloat(e[0]),e[1]=parseFloat(e[1]),e[2]=parseFloat(e[2]),(new THREE.Vector3).fromArray(e)):t},this.getSelectedNodes=function(){return e.impl&&e.impl.selector?e.impl.selector.getSelection():[]},this.getVisibleLayers2d=function(){var t=[],n=e.impl.matman(),i=n._layersMap;for(var r in i)i.hasOwnProperty(r)&&n.isLayerVisible(r)&&t.push(r);return t},this.areAllLayersVisible=function(){var t=e.impl.matman(),n=t._layersMap;for(var i in n)if(n.hasOwnProperty(i)&&!t.isLayerVisible(i))return!1;return!0},this.getAspectRatio=function(){var t=e.navigation.getScreenViewport();return t.width/t.height},this.getOrthographicHeight=function(){var t=e.navigation.getCamera();return t.isPerspective?0:Math.abs(2*t.orthographicCamera.top)},this.getSeedUrn=function(){return e.model&&e.model.loader&&e.model.loader.svfUrn||""},this.getToneMapIntensity=function(){var t=0;return e.impl.dir_light1&&(t=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),t},this.getLightPresetIndex=function(e){for(var t=0;t<r.LightPresets.length;t++)if(r.LightPresets[t].name===e)return t;return-1},this.applyFilter=function(e,t){if(!0!==t)for(var n in e)if(e.hasOwnProperty(n)){var r=t[n];void 0===r?delete e[n]:"boolean"==typeof r?!1===r&&delete e[n]:r instanceof Object?e[n]instanceof Object?this.applyFilter(e[n],t[n]):i.logger.warn("[applyFilter] A - Invalid filter Object for key ["+n+"]"):i.logger.warn("[applyFilter] B - Invalid filter value for key ["+n+"]")}}}a.prototype.constructor=a},function(e,t,n){"use strict";n.r(t),n.d(t,"SnapResult",function(){return r});var i=n(6);function r(){this.clear()}r.prototype.clear=function(){this.geomType=null,this.snapNode=null,this.geomVertex=null,this.geomEdge=null,this.geomFace=null,this.radius=null,this.intersectPoint=null,this.faceNormal=null,this.viewportIndex2d=null,this.circularArcCenter=null,this.circularArcRadius=null,this.fromTopology=!1,this.isPerpendicular=!1},r.prototype.copyTo=function(e){e.snapNode=this.snapNode,e.geomVertex=this.geomVertex,e.geomFace=this.geomFace,e.geomEdge=this.geomEdge,e.radius=this.radius,e.geomType=this.geomType,e.intersectPoint=this.intersectPoint,e.faceNormal=this.faceNormal,e.viewportIndex2d=this.viewportIndex2d,e.circularArcCenter=this.circularArcCenter,e.circularArcRadius=this.circularArcRadius,e.fromTopology=this.fromTopology,e.isPerpendicular=this.isPerpendicular},r.prototype.clone=function(){var e=new r;return this.copyTo(e),e},r.prototype.isEmpty=function(){return!this.getGeometry()},r.prototype.getFace=function(){return this.geomFace},r.prototype.getEdge=function(){return this.geomEdge},r.prototype.getVertex=function(){return this.geomVertex},r.prototype.getGeometry=function(){switch(this.geomType){case i.SnapType.SNAP_VERTEX:case i.SnapType.SNAP_MIDPOINT:case i.SnapType.SNAP_CIRCLE_CENTER:return this.geomVertex;case i.SnapType.SNAP_EDGE:return this.geomEdge;case i.SnapType.SNAP_FACE:return this.geomFace;case i.SnapType.SNAP_CIRCULARARC:case i.SnapType.SNAP_CURVEDEDGE:return this.geomEdge;case i.SnapType.SNAP_CURVEDFACE:return this.geomFace}return null},r.prototype.setGeometry=function(e,t){switch(e){case i.SnapType.SNAP_VERTEX:case i.SnapType.SNAP_MIDPOINT:case i.SnapType.SNAP_CIRCLE_CENTER:this.geomVertex=t;break;case i.SnapType.SNAP_EDGE:this.geomEdge=t;break;case i.SnapType.SNAP_FACE:this.geomFace=t;break;case i.SnapType.SNAP_CIRCULARARC:case i.SnapType.SNAP_CURVEDEDGE:this.geomEdge=t;break;case i.SnapType.SNAP_CURVEDFACE:this.geomFace=t;break;default:return}this.geomType=e}},function(e,t,n){"use strict";n.r(t),n.d(t,"Tree",function(){return a});var i=n(3),r=n(61),o=n(90);function a(e,t,n,i){this.myDelegate=e,this.mySelectedNodes=[],this.myOptions=i||{},this.parentContainer=n;this.groupClassName=this.myOptions.groupClassName||"expanded",this.leafClassName=this.myOptions.leafClassName||"expanded",this.selectedClassName=this.myOptions.selectedClassName||"selected",this.myGroupNodes=[],this.nodeToElement={},this.nodeIdToNode={};var r=this.myRootContainer=this.createHtmlElement_(n,"div","treeview"),o=this.rootElem=this.createElement_(t,r,i,0);this.setInputHandlers_(),i&&i.excludeRoot&&o.classList.add("exclude")}a.prototype.constructor=a,a.prototype.destroy=function(){this.parentContainer&&(this.parentContainer.removeChild(this.myRootContainer),this.myRootContainer=null,this.parentContainer=null)},a.prototype.show=function(e){var t=this.myRootContainer;t.style.display=e?"block":"none"},a.prototype.getRootContainer=function(){return this.myRootContainer},a.prototype.getElementForNode=function(e){return"number"!=typeof e&&"string"!=typeof e&&(e=this.myDelegate.getTreeNodeId(e)),this.nodeToElement[e]},a.prototype.delegate=function(){return this.myDelegate},a.prototype.isCollapsed=function(e){return this.hasClass(e,"collapsed")},a.prototype.setCollapsed=function(e,t,n){t?(this.addClass(e,"collapsed",n),this.removeClass(e,"expanded",n)):(this.addClass(e,"expanded",n),this.removeClass(e,"collapsed",n))},a.prototype.setAllCollapsed=function(e){var t,n;e?(t=function(e){return e.classList.contains("expanded")},n=function(e){e.classList.add("collapsed"),e.classList.remove("expanded")}):(t=function(e){return e.classList.contains("collapsed")},n=function(e){e.classList.add("expanded"),e.classList.remove("collapsed")});for(var i=0;i<this.myGroupNodes.length;++i){var r=this.myGroupNodes[i];t(r)&&n(r)}},a.prototype.addToSelection=function(e){var t=this;function n(e){return-1===t.mySelectedNodes.indexOf(e)&&(t.mySelectedNodes.push(e),!0)}for(var i=e.length,r=0;r<i;++r){var o=e[r];n(o)&&this.addClass(o,this.selectedClassName)}},a.prototype.removeFromSelection=function(e){var t=this;function n(e){var n=t.mySelectedNodes.indexOf(e);return-1!==n&&(t.mySelectedNodes.splice(n,1),!0)}for(var i=e.length-1;i>=0;--i){var r=e[i];n(r)&&this.removeClass(r,this.selectedClassName)}},a.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedNodes),this.addToSelection(e),this.mySelectedNodes},a.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedNodes)},a.prototype.isSelected=function(e){return this.hasClass(e,this.selectedClassName)},a.prototype.scrollTo=function(e){var t=this.getElementForNode(e);if(t){var n=t.offsetTop;for(t=t.parentNode;t&&t!=this.myRootContainer;)n+=t.offsetTop,t=t.parentNode;this.myRootContainer.parentNode.scrollTop=n}},a.prototype.addClass=function(e,t,n){var i=this.getElementForNode(e);if(i){if(n){i=i.parentNode;for(var r=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;i&&i!==r;)i.classList.add(t),i=i.parentNode}else i.classList.add(t);return!0}return!1},a.prototype.removeClass=function(e,t,n){var i=this.getElementForNode(e);if(i){if(n){i=i.parentNode;for(var r=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;i&&i!==r;)i.classList.remove(t),i=i.parentNode}else i.classList.remove(t);return!0}return!1},a.prototype.hasClass=function(e,t){return this.getElementForNode(e).classList.contains(t)},a.prototype.clear=function(){for(var e=this.myRootContainer;e.hasChildNodes();)e.removeChild(e.lastChild);this.nodeToElement={},this.nodeIdToNode={}},a.prototype.createElement_=function(e,t,n,i){if(null==e)return null;if(!this.myDelegate.shouldCreateTreeNode(e))return null;var r,o=this;function a(t,r,a,s){var l=o.createHtmlElement_(t,r,a),c=o.myDelegate.getTreeNodeId(s);l.setAttribute("lmv-nodeId",c);var u=o.createHtmlElement_(l,"lmvheader"),h=o.createHtmlElement_(u,"icon");return h.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault()},!1),h.addEventListener("click",function(t){o.myDelegate.onTreeNodeIconClick(o,e,t),t.stopPropagation(),t.preventDefault()},!1),o.myDelegate.createTreeNode(e,u,n,r,i),l}var s=this.myDelegate.getTreeNodeId(e);if(o.myDelegate.isTreeNodeGroup(e)){r=a(t,"group",o.groupClassName,e),o.nodeToElement[s]=r,o.nodeIdToNode[s]=e;var l=o.myOptions.excludeRoot?1:0;i==l&&(r.style.left="0px"),o.myGroupNodes.push(r),o.myDelegate.forEachChild(e,function(e){o.createElement_(e,r,n,i+1)})}else{r=a(t,"leaf",o.leafClassName,e),o.nodeToElement[s]=r,o.nodeIdToNode[s]=e;l=o.myOptions.excludeRoot?1:0;i==l&&(r.style.marginLeft="0px")}var c=o.myDelegate.getTreeNodeClass(e);return c&&r.classList.add(c),r},a.prototype.setInputHandlers_=function(){var e=this,t=this.myRootContainer,n=function(n){var i=null,r=!1;do{n&&n!==t?n.hasAttribute("lmv-nodeId")?(i=n,r=!0):n=n.parentElement:(i=null,r=!0)}while(!r);if(i){var o=i.getAttribute("lmv-nodeId");return e.nodeIdToNode[o]||null}return null};Object(i.isTouchDevice)()&&(this.hammer=new o.Manager(t,{recognizers:[r.GestureRecognizers.doubletap,r.GestureRecognizers.press],handlePointerEventMouse:!1,inputClass:i.isIE11?o.PointerEventInput:o.TouchInput}),this.hammer.on("doubletap",function(t){var i=n(t.target);null!==i&&e.myDelegate.onTreeNodeDoubleClick(e,i,t)}),this.hammer.on("press",function(t){var i=n(t.target);null!==i&&e.myDelegate.onTreeNodeRightClick(e,i,t)})),t.addEventListener("click",function(t){var i=n(t.target);null!==i&&(e.myDelegate.onTreeNodeClick(e,i,t),t.stopPropagation(),t.target.classList.contains("propertyLink")||t.preventDefault())},!1),t.addEventListener("dblclick",function(t){var i=n(t.target);null!==i&&(e.myDelegate.onTreeNodeDoubleClick(e,i,t),t.stopPropagation(),t.preventDefault())},!1),t.addEventListener("contextmenu",function(t){var i=n(t.target);null!==i&&(e.myDelegate.onTreeNodeRightClick(e,i,t),t.stopPropagation(),t.preventDefault())},!1),t.addEventListener("mouseover",function(t){var i=n(t.target);null!==i&&(e.myDelegate.onTreeNodeHover(e,i,t),t.stopPropagation(),t.preventDefault())},!1),t.addEventListener("mouseout",function(t){var i=t.toElement||t.relatedTarget;if(n(t.target)!=n(i)){e.myDelegate.onTreeNodeHover(e,-1,t),t.stopPropagation(),t.preventDefault()}},!1)},a.prototype.createHtmlElement_=function(e,t,n){var i=document.createElement(t);return e.appendChild(i),n&&(i.className=n),i},a.prototype.iterate=function(e,t){if(null!=e&&this.myDelegate.shouldCreateTreeNode(e)){var n=this.getElementForNode(e);if(n){t(e,n);var i=this;this.myDelegate.forEachChild(e,function(e){i.iterate(e,t)})}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"ToolBar",function(){return o});var i=n(35),r=n(19);function o(e,t){i.ControlGroup.call(this,e,t),this.removeClass("adsk-control-group"),this.addClass("adsk-toolbar")}o.Event={VISIBILITY_CHANGED:r.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:r.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:i.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:i.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:i.ControlGroup.Event.SIZE_CHANGED},o.prototype=Object.create(i.ControlGroup.prototype),o.prototype.constructor=o},function(e,t,n){"use strict";n.r(t);var i=n(73),r=n(43),o=n(29),a=n(0);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var h=function(e){function t(e,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r,o,a,c,h,d,f,p,m,g,v,y={};r=this,(i=!(o=l(t).call(this,e,n))||"object"!==s(o)&&"function"!=typeof o?u(r):o).buffers={stencil:(a=!1,c=null,h=null,d=null,f=null,p=null,m=null,g=null,v=null,{setTest:function(t){var n;t?(n=e.STENCIL_TEST,!0!==y[n]&&(e.enable(n),y[n]=!0)):function(t){!1!==y[t]&&(e.disable(t),y[t]=!1)}(e.STENCIL_TEST)},setMask:function(t){c===t||a||(e.stencilMask(t),c=t)},setFunc:function(t,n,i){h===t&&d===n&&f===i||(e.stencilFunc(t,n,i),h=t,d=n,f=i)},setOp:function(t,n,i){p===t&&m===n&&g===i||(e.stencilOp(t,n,i),p=t,m=n,g=i)},setLocked:function(e){a=e},setClear:function(t){v!==t&&(e.clearStencil(t),v=t)},reset:function(){a=!1,c=null,h=null,d=null,f=null,p=null,m=null,g=null,v=null}})};var _=i.reset.bind(u(u(i)));return i.reset=function(){this.buffers.stencil.reset(),_()},i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,a["WebGLState"]),t}(),d=n(3),f=n(14);n.d(t,"DEBUG_TEXTURE_LOAD",function(){return p}),n.d(t,"WebGLRenderer",function(){return m});var p=!1,m=function(e){a.log("THREE.WebGLRenderer",a.REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),n=window.devicePixelRatio||1,s=void 0!==e.precision?e.precision:"highp",l=s,c=void 0!==e.alpha&&e.alpha,u=void 0===e.premultipliedAlpha||e.premultipliedAlpha,m=void 0!==e.antialias&&e.antialias,g=void 0===e.stencil||e.stencil,v=void 0===e.preserveDrawingBuffer||e.preserveDrawingBuffer,y=void 0!==e.logarithmicDepthBuffer&&e.logarithmicDepthBuffer,_=new a.Color(0),b=0,x=-1!=window.navigator.userAgent.indexOf("Firefox")&&-1!=window.navigator.userAgent.indexOf("Mac OS");x=x||d.isIE11;var w=[],A={},E=[],T=new a.Matrix4,M=new a.Matrix3,S=[],C=[];this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var P,L,R,D,I=this,O=[],N=null,k=null,V=-1,F=null,B="",U=0,z="",G="",H=0,W=0,j=0,X=t.width,q=t.height,Y={},K=new a.Frustum,Q=new a.Matrix4,Z=new a.Matrix4,J=new a.Vector3,$=new a.Vector3,ee=!0,te={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var ne={alpha:c,premultipliedAlpha:u,antialias:m,stencil:g,preserveDrawingBuffer:v};if(null===(P=t.getContext("webgl",ne)||t.getContext("experimental-webgl",ne)))throw null!==t.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";0==P.getShaderPrecisionFormat(P.FRAGMENT_SHADER,P.HIGH_FLOAT).precision&&(l="mediump"),t.addEventListener("webglcontextlost",function(e){e.preventDefault(),se(),ae(),A={},I.webglcontextlost&&I.webglcontextlost(e)},!1)}catch(e){return void a.error(e)}var ie=new h(P,It);void 0===P.getShaderPrecisionFormat&&(P.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var re=new a.WebGLExtensions(P);re.get("OES_texture_float"),re.get("OES_texture_float_linear"),re.get("OES_texture_half_float"),re.get("OES_texture_half_float_linear"),re.get("OES_standard_derivatives"),re.get("EXT_shader_texture_lod"),re.get("EXT_texture_filter_anisotropic"),re.get("WEBGL_compressed_texture_s3tc"),L=re.get("WEBGL_draw_buffers"),R=re.get("ANGLE_instanced_arrays"),D=re.get("OES_vertex_array_object"),y&&re.get("EXT_frag_depth");var oe=function(e,t,n,i){!0===u&&(e*=i,t*=i,n*=i),P.clearColor(e,t,n,i)},ae=function(){P.clearColor(0,0,0,1),P.clearDepth(1),P.clearStencil(0),P.enable(P.DEPTH_TEST),P.depthFunc(P.LEQUAL),P.frontFace(P.CCW),P.cullFace(P.BACK),P.enable(P.CULL_FACE),P.enable(P.BLEND),P.blendEquation(P.FUNC_ADD),P.blendFunc(P.SRC_ALPHA,P.ONE_MINUS_SRC_ALPHA),P.viewport(W,j,X,q),oe(_.r,_.g,_.b,b)},se=function(){N=null,F=null,B="",V=-1,ee=!0,ie.reset(),ie.disableUnusedAttributes()};ae(),this.context=P,this.state=ie;for(var le=P.getParameter(P.MAX_TEXTURE_IMAGE_UNITS),ce=P.getParameter(P.MAX_VERTEX_TEXTURE_IMAGE_UNITS),ue=P.getParameter(P.MAX_TEXTURE_SIZE),he=P.getParameter(P.MAX_CUBE_MAP_TEXTURE_SIZE),de=ce>0,fe=P.getShaderPrecisionFormat(P.VERTEX_SHADER,P.HIGH_FLOAT),pe=P.getShaderPrecisionFormat(P.VERTEX_SHADER,P.MEDIUM_FLOAT),me=P.getShaderPrecisionFormat(P.FRAGMENT_SHADER,P.HIGH_FLOAT),ge=P.getShaderPrecisionFormat(P.FRAGMENT_SHADER,P.MEDIUM_FLOAT),ve=new Uint8Array(16),ye=0;ye<4;ye++)p?1===ye||2===ye?(ve[4*ye]=246,ve[4*ye+1]=140,ve[4*ye+2]=220):(ve[4*ye]=48,ve[4*ye+1]=195,ve[4*ye+2]=3):ve[4*ye]=ve[4*ye+1]=ve[4*ye+2]=0,ve[4*ye+3]=255;var _e=new a.DataTexture(ve,2,2,a.RGBAFormat,a.UnsignedByteType,a.UVMapping,a.RepeatWrapping,a.RepeatWrapping,a.NearestFilter,a.NearestFilter);_e.needsUpdate=!0;var be,xe,we=function(){if(void 0!==be)return be;if(be=[],re.get("WEBGL_compressed_texture_pvrtc")||re.get("WEBGL_compressed_texture_s3tc"))for(var e=P.getParameter(P.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)be.push(e[t]);return be},Ae=fe.precision>0,Ee=pe.precision>0;"highp"!==s||Ae||(Ee?(s="mediump",a.warn("WebGLRenderer: highp not supported, using mediump")):(s="lowp",a.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==s||Ee||(s="lowp",a.warn("WebGLRenderer: mediump not supported, using lowp")),Ae=me.precision>0,Ee=ge.precision>0,"highp"!==l||Ae||(Ee?(l="mediump",a.warn("WebGLRenderer: highp not supported, using mediump")):(l="lowp",a.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==l||Ee||(l="lowp",a.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return P},this.forceContextLoss=function(){re.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return de},this.supportsFloatTextures=function(){return re.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return re.get("OES_texture_half_float_linear")},this.supportsStandardDerivatives=function(){return re.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return re.get("WEBGL_compressed_texture_s3tc")},this.supportsMRT=function(){return!x&&L},this.supportsInstancedArrays=function(){return!!R},this.supportsBlendMinMax=function(){return re.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){if(void 0!==xe)return xe;var e=re.get("EXT_texture_filter_anisotropic");return xe=null!==e?P.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.getPixelRatio=function(){return n},this.setPixelRatio=function(e){n=e},this.getCurrentFramebuffer=function(){return k},this.setSize=function(e,i,r){t.width=e*n,t.height=i*n,!1!==r&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i)},this.setViewport=function(e,t,i,r){W=e*n,j=t*n,X=i*n,q=r*n,P.viewport(W,j,X,q)};var Te=!1;this.enableViewportOnOffscreenTargets=function(e){Te=e};var Me=[];function Se(e){e.__webglVertexBuffer=P.createBuffer(),e.__webglNormalBuffer=P.createBuffer(),e.__webglTangentBuffer=P.createBuffer(),e.__webglColorBuffer=P.createBuffer(),e.__webglUVBuffer=P.createBuffer(),e.__webglUV2Buffer=P.createBuffer(),e.__webglSkinIndicesBuffer=P.createBuffer(),e.__webglSkinWeightsBuffer=P.createBuffer(),e.__webglFaceBuffer=P.createBuffer(),e.__webglLineBuffer=P.createBuffer(),I.info.memory.geometries++}this.pushViewport=function(){Me.push(W),Me.push(j),Me.push(X),Me.push(q)},this.popViewport=function(){var e=Me.length-4;W=Me[e],j=Me[e+1],X=Me[e+2],q=Me[e+3],P.viewport(W,j,X,q),Me.length=e},this.setScissor=function(e,t,i,r){P.scissor(e*n,t*n,i*n,r*n)},this.enableScissorTest=function(e){e?P.enable(P.SCISSOR_TEST):P.disable(P.SCISSOR_TEST)},this.getClearColor=function(){return _},this.setClearColor=function(e,t){_.set(e),b=void 0!==t?t:1,oe(_.r,_.g,_.b,b)},this.getClearAlpha=function(){return b},this.setClearAlpha=function(e){b=e,oe(_.r,_.g,_.b,b)},this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=P.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=P.DEPTH_BUFFER_BIT),(void 0===n||n)&&(i|=P.STENCIL_BUFFER_BIT),P.clear(i)},this.clearColor=function(){P.clear(P.COLOR_BUFFER_BIT)},this.clearDepth=function(){P.clear(P.DEPTH_BUFFER_BIT)},this.clearStencil=function(){P.clear(P.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,n,i){this.setRenderTarget(e),this.clear(t,n,i)},this.resetGLState=se;var Ce=function e(t){t.target.traverse(function(t){t.removeEventListener("remove",e),function(e){e instanceof a.Mesh||e instanceof a.PointCloud||e instanceof a.Line?delete A[e.id]:(e instanceof a.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){for(var n=e.length-1;n>=0;n--)e[n].object===t&&e.splice(n,1)}(E,e);delete e.__webglInit,delete e.__webglActive}(t)})},Pe=function e(t){var n=t.target;n.removeEventListener("dispose",e),Oe(n)},Le=function e(t){var n=t.target;n.removeEventListener("dispose",e),Be(n),I.info.memory.textures--},Re=function e(t){var n=t.target;n.removeEventListener("dispose",e),Ue(n),I.info.memory.textures--},De=function e(t){var n=t.target;n.removeEventListener("dispose",e),ze(n)},Ie=function(e){if(void 0!==e.__webglVertexBuffer&&(P.deleteBuffer(e.__webglVertexBuffer),e.__webglVertexBuffer=void 0),void 0!==e.__webglNormalBuffer&&(P.deleteBuffer(e.__webglNormalBuffer),e.__webglNormalBuffer=void 0),void 0!==e.__webglTangentBuffer&&(P.deleteBuffer(e.__webglTangentBuffer),e.__webglTangentBuffer=void 0),void 0!==e.__webglColorBuffer&&(P.deleteBuffer(e.__webglColorBuffer),e.__webglColorBuffer=void 0),void 0!==e.__webglUVBuffer&&(P.deleteBuffer(e.__webglUVBuffer),e.__webglUVBuffer=void 0),void 0!==e.__webglUV2Buffer&&(P.deleteBuffer(e.__webglUV2Buffer),e.__webglUV2Buffer=void 0),void 0!==e.__webglSkinIndicesBuffer&&(P.deleteBuffer(e.__webglSkinIndicesBuffer),e.__webglSkinIndicesBuffer=void 0),void 0!==e.__webglSkinWeightsBuffer&&(P.deleteBuffer(e.__webglSkinWeightsBuffer),e.__webglSkinWeightsBuffer=void 0),void 0!==e.__webglFaceBuffer&&(P.deleteBuffer(e.__webglFaceBuffer),e.__webglFaceBuffer=void 0),void 0!==e.__webglLineBuffer&&(P.deleteBuffer(e.__webglLineBuffer),e.__webglLineBuffer=void 0),void 0!==e.__webglLineDistanceBuffer&&(P.deleteBuffer(e.__webglLineDistanceBuffer),e.__webglLineDistanceBuffer=void 0),void 0!==e.__webglCustomAttributesList){for(var t in e.__webglCustomAttributesList)P.deleteBuffer(e.__webglCustomAttributesList[t].buffer);e.__webglCustomAttributesList=void 0}I.info.memory.geometries--},Oe=function(e){var t,n,i,r;if(e.__webglInit=void 0,e instanceof a.BufferGeometry){if(void 0!==e.vbbuffer&&(P.deleteBuffer(e.vbbuffer),e.vbbuffer=void 0),void 0!==e.ibbuffer&&(P.deleteBuffer(e.ibbuffer),e.ibbuffer=void 0),void 0!==e.iblinesbuffer&&(P.deleteBuffer(e.iblinesbuffer),e.iblinesbuffer=void 0),e.vaos){for(t=0;t<e.vaos.length;t++)D.deleteVertexArrayOES(e.vaos[t].vao);e.vaos=void 0}var o=e.attributes;for(var s in o)void 0!==o[s].buffer&&(P.deleteBuffer(o[s].buffer),o[s].buffer=void 0);I.info.memory.geometries--}else{var l=ht[e.id];if(void 0!==l){for(t=0,n=l.length;t<n;t++){var c=l[t];if(void 0!==c.numMorphTargets){for(i=0,r=c.numMorphTargets;i<r;i++)P.deleteBuffer(c.__webglMorphTargetsBuffers[i]);delete c.__webglMorphTargetsBuffers}if(void 0!==c.numMorphNormals){for(i=0,r=c.numMorphNormals;i<r;i++)P.deleteBuffer(c.__webglMorphNormalsBuffers[i]);delete c.__webglMorphNormalsBuffers}Ie(c)}delete ht[e.id]}else Ie(e)}};this.deallocateGeometry=Oe;var Ne,ke,Ve,Fe,Be=function(e){if(e.__webglTextureCube)P.deleteTexture(e.__webglTextureCube),e.__webglTextureCube=void 0;else{if(!e.__webglInit)return;P.deleteTexture(e.__webglTexture),e.__webglInit=void 0,e.__webglTexture=void 0}},Ue=function(e){e&&e.__webglTexture&&(P.deleteTexture(e.__webglTexture),P.deleteFramebuffer(e.__webglFramebuffer),void 0!==e.__webglRenderbuffer&&P.deleteRenderbuffer(e.__webglRenderbuffer))},ze=function(e){var t=!1;e.program=void 0,e.programs.forEach(function(e){var n,i,r,o;if(void 0!==e&&null!=(n=e.program))for(i=0,r=O.length;i<r;i++)if((o=O[i])&&o.program===n){o.usedTimes--,0===o.usedTimes&&(O[i]=void 0,P.deleteProgram(n),I.info.memory.programs--,t=!0);break}},!1),e.programs.length=0,t&&(O=O.filter(function(e){return void 0!==e}))};function Ge(e,t){var n=e.vertices.length,i=t.material;if(i.attributes)for(var r in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),i.attributes){var o=i.attributes[r];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(n*a),o.buffer=P.createBuffer(),o.buffer.belongsToAttribute=r,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}function He(e,t){var n=t.geometry,i=e.faces3,r=3*i.length,o=1*i.length,a=3*i.length,s=We(t,e),l=qe(s),c=je(s),u=Xe(s);e.__vertexArray=new Float32Array(3*r),c&&(e.__normalArray=new Float32Array(3*r)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*r)),u&&(e.__colorArray=new Float32Array(3*r)),l&&(n.faceVertexUvs.length>0&&(e.__uvArray=new Float32Array(2*r)),n.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*r))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*r),e.__skinWeightArray=new Float32Array(4*r));var h=null!==re.get("OES_element_index_uint")&&o>21845?Uint32Array:Uint16Array;if(e.__typeArray=h,e.__faceArray=new h(3*o),e.__lineArray=new h(2*a),e.__webglFaceCount=3*o,e.__webglLineCount=2*a,s.attributes)for(var d in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),s.attributes){var f=s.attributes[d],p={};for(var m in f)p[m]=f[m];if(!p.__webglInitialized||p.createUniqueBuffers){p.__webglInitialized=!0;var g=1;"v2"===p.type?g=2:"v3"===p.type?g=3:"v4"===p.type?g=4:"c"===p.type&&(g=3),p.size=g,p.array=new Float32Array(r*g),p.buffer=P.createBuffer(),p.buffer.belongsToAttribute=d,f.needsUpdate=!0,p.__original=f}e.__webglCustomAttributesList.push(p)}e.__inittedArrays=!0}function We(e,t){return e.material instanceof a.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function je(e){return!(e instanceof a.MeshBasicMaterial&&!e.envMap||e instanceof a.MeshDepthMaterial)&&(function(e){return e&&void 0!==e.shading&&e.shading===a.SmoothShading}(e)?a.SmoothShading:a.FlatShading)}function Xe(e){return!!e.vertexColors&&e.vertexColors}function qe(e){return!!(e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e instanceof a.ShaderMaterial)}function Ye(e,t,n,i,r){if(e.__inittedArrays){var o,s,l,c,u,h,d,f,p,m,g,v,y,_,b,x,w,A,E,T,M,S,C,L,R,D,I=je(r),O=Xe(r),N=qe(r),k=I===a.SmoothShading,V=0,F=0,B=0,U=0,z=0,G=0,H=0,W=0,j=0,X=0,q=e.__vertexArray,Y=e.__uvArray,K=e.__uv2Array,Q=e.__normalArray,Z=e.__tangentArray,J=e.__colorArray,$=e.__webglCustomAttributesList,ee=e.__faceArray,te=e.__lineArray,ne=t.geometry,ie=ne.verticesNeedUpdate,re=ne.elementsNeedUpdate,oe=ne.uvsNeedUpdate,ae=ne.normalsNeedUpdate,se=ne.tangentsNeedUpdate,le=ne.colorsNeedUpdate,ce=ne.vertices,ue=e.faces3,he=ne.faces,de=ne.faceVertexUvs[0],fe=ne.faceVertexUvs[1];if(ie){for(o=0,s=ue.length;o<s;o++)g=ce[(l=he[ue[o]]).a],v=ce[l.b],y=ce[l.c],q[F]=g.x,q[F+1]=g.y,q[F+2]=g.z,q[F+3]=v.x,q[F+4]=v.y,q[F+5]=v.z,q[F+6]=y.x,q[F+7]=y.y,q[F+8]=y.z,F+=9;P.bindBuffer(P.ARRAY_BUFFER,e.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,q,n)}if(le&&O){for(o=0,s=ue.length;o<s;o++)h=(l=he[ue[o]]).vertexColors,d=l.color,3===h.length&&O===a.VertexColors?(w=h[0],A=h[1],E=h[2]):(w=d,A=d,E=d),J[j]=w.r,J[j+1]=w.g,J[j+2]=w.b,J[j+3]=A.r,J[j+4]=A.g,J[j+5]=A.b,J[j+6]=E.r,J[j+7]=E.g,J[j+8]=E.b,j+=9;j>0&&(P.bindBuffer(P.ARRAY_BUFFER,e.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,J,n))}if(se&&ne.hasTangents){for(o=0,s=ue.length;o<s;o++)_=(f=(l=he[ue[o]]).vertexTangents)[0],b=f[1],x=f[2],Z[H]=_.x,Z[H+1]=_.y,Z[H+2]=_.z,Z[H+3]=_.w,Z[H+4]=b.x,Z[H+5]=b.y,Z[H+6]=b.z,Z[H+7]=b.w,Z[H+8]=x.x,Z[H+9]=x.y,Z[H+10]=x.z,Z[H+11]=x.w,H+=12;P.bindBuffer(P.ARRAY_BUFFER,e.__webglTangentBuffer),P.bufferData(P.ARRAY_BUFFER,Z,n)}if(ae&&I){for(o=0,s=ue.length;o<s;o++)if(c=(l=he[ue[o]]).vertexNormals,u=l.normal,3===c.length&&k)for(T=0;T<3;T++)S=c[T],Q[G]=S.x,Q[G+1]=S.y,Q[G+2]=S.z,G+=3;else for(T=0;T<3;T++)Q[G]=u.x,Q[G+1]=u.y,Q[G+2]=u.z,G+=3;P.bindBuffer(P.ARRAY_BUFFER,e.__webglNormalBuffer),P.bufferData(P.ARRAY_BUFFER,Q,n)}if(oe&&de&&N){for(o=0,s=ue.length;o<s;o++)if(void 0!==(p=de[ue[o]]))for(T=0;T<3;T++)C=p[T],Y[B]=C.x,Y[B+1]=C.y,B+=2;B>0&&(P.bindBuffer(P.ARRAY_BUFFER,e.__webglUVBuffer),P.bufferData(P.ARRAY_BUFFER,Y,n))}if(oe&&fe&&N){for(o=0,s=ue.length;o<s;o++)if(void 0!==(m=fe[ue[o]]))for(T=0;T<3;T++)L=m[T],K[U]=L.x,K[U+1]=L.y,U+=2;U>0&&(P.bindBuffer(P.ARRAY_BUFFER,e.__webglUV2Buffer),P.bufferData(P.ARRAY_BUFFER,K,n))}if(re){for(o=0,s=ue.length;o<s;o++)ee[z]=V,ee[z+1]=V+1,ee[z+2]=V+2,z+=3,te[W]=V,te[W+1]=V+1,te[W+2]=V,te[W+3]=V+2,te[W+4]=V+1,te[W+5]=V+2,W+=6,V+=3;P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,ee,n),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,te,n)}if($)for(T=0,M=$.length;T<M;T++)if((D=$[T]).__original.needsUpdate){if(X=0,1===D.size){if(void 0===D.boundTo||"vertices"===D.boundTo)for(o=0,s=ue.length;o<s;o++)l=he[ue[o]],D.array[X]=D.value[l.a],D.array[X+1]=D.value[l.b],D.array[X+2]=D.value[l.c],X+=3;else if("faces"===D.boundTo)for(o=0,s=ue.length;o<s;o++)R=D.value[ue[o]],D.array[X]=R,D.array[X+1]=R,D.array[X+2]=R,X+=3}else if(2===D.size){if(void 0===D.boundTo||"vertices"===D.boundTo)for(o=0,s=ue.length;o<s;o++)l=he[ue[o]],g=D.value[l.a],v=D.value[l.b],y=D.value[l.c],D.array[X]=g.x,D.array[X+1]=g.y,D.array[X+2]=v.x,D.array[X+3]=v.y,D.array[X+4]=y.x,D.array[X+5]=y.y,X+=6;else if("faces"===D.boundTo)for(o=0,s=ue.length;o<s;o++)g=R=D.value[ue[o]],v=R,y=R,D.array[X]=g.x,D.array[X+1]=g.y,D.array[X+2]=v.x,D.array[X+3]=v.y,D.array[X+4]=y.x,D.array[X+5]=y.y,X+=6}else if(3===D.size){var pe;if(pe="c"===D.type?["r","g","b"]:["x","y","z"],void 0===D.boundTo||"vertices"===D.boundTo)for(o=0,s=ue.length;o<s;o++)l=he[ue[o]],g=D.value[l.a],v=D.value[l.b],y=D.value[l.c],D.array[X]=g[pe[0]],D.array[X+1]=g[pe[1]],D.array[X+2]=g[pe[2]],D.array[X+3]=v[pe[0]],D.array[X+4]=v[pe[1]],D.array[X+5]=v[pe[2]],D.array[X+6]=y[pe[0]],D.array[X+7]=y[pe[1]],D.array[X+8]=y[pe[2]],X+=9;else if("faces"===D.boundTo)for(o=0,s=ue.length;o<s;o++)g=R=D.value[ue[o]],v=R,y=R,D.array[X]=g[pe[0]],D.array[X+1]=g[pe[1]],D.array[X+2]=g[pe[2]],D.array[X+3]=v[pe[0]],D.array[X+4]=v[pe[1]],D.array[X+5]=v[pe[2]],D.array[X+6]=y[pe[0]],D.array[X+7]=y[pe[1]],D.array[X+8]=y[pe[2]],X+=9;else if("faceVertices"===D.boundTo)for(o=0,s=ue.length;o<s;o++)g=(R=D.value[ue[o]])[0],v=R[1],y=R[2],D.array[X]=g[pe[0]],D.array[X+1]=g[pe[1]],D.array[X+2]=g[pe[2]],D.array[X+3]=v[pe[0]],D.array[X+4]=v[pe[1]],D.array[X+5]=v[pe[2]],D.array[X+6]=y[pe[0]],D.array[X+7]=y[pe[1]],D.array[X+8]=y[pe[2]],X+=9}else if(4===D.size)if(void 0===D.boundTo||"vertices"===D.boundTo)for(o=0,s=ue.length;o<s;o++)l=he[ue[o]],g=D.value[l.a],v=D.value[l.b],y=D.value[l.c],D.array[X]=g.x,D.array[X+1]=g.y,D.array[X+2]=g.z,D.array[X+3]=g.w,D.array[X+4]=v.x,D.array[X+5]=v.y,D.array[X+6]=v.z,D.array[X+7]=v.w,D.array[X+8]=y.x,D.array[X+9]=y.y,D.array[X+10]=y.z,D.array[X+11]=y.w,X+=12;else if("faces"===D.boundTo)for(o=0,s=ue.length;o<s;o++)g=R=D.value[ue[o]],v=R,y=R,D.array[X]=g.x,D.array[X+1]=g.y,D.array[X+2]=g.z,D.array[X+3]=g.w,D.array[X+4]=v.x,D.array[X+5]=v.y,D.array[X+6]=v.z,D.array[X+7]=v.w,D.array[X+8]=y.x,D.array[X+9]=y.y,D.array[X+10]=y.z,D.array[X+11]=y.w,X+=12;else if("faceVertices"===D.boundTo)for(o=0,s=ue.length;o<s;o++)g=(R=D.value[ue[o]])[0],v=R[1],y=R[2],D.array[X]=g.x,D.array[X+1]=g.y,D.array[X+2]=g.z,D.array[X+3]=g.w,D.array[X+4]=v.x,D.array[X+5]=v.y,D.array[X+6]=v.z,D.array[X+7]=v.w,D.array[X+8]=y.x,D.array[X+9]=y.y,D.array[X+10]=y.z,D.array[X+11]=y.w,X+=12;P.bindBuffer(P.ARRAY_BUFFER,D.buffer),P.bufferData(P.ARRAY_BUFFER,D.array,n)}i&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function Ke(e){if(e.streamingDraw){if(!e.streamingIndex){var t=e.attributes.index;t&&(t.buffer=P.createBuffer(),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,t.buffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,t.array||e.ib,P.STATIC_DRAW))}}else{e.vb&&void 0===e.vbbuffer&&(e.vbbuffer=P.createBuffer(),e.vbNeedsUpdate=!0),e.ib&&void 0===e.ibbuffer&&(e.ibbuffer=P.createBuffer(),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,e.ibbuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,e.ib,P.STATIC_DRAW)),e.iblines&&void 0===e.iblinesbuffer&&(e.iblinesbuffer=P.createBuffer(),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,e.iblinesbuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,e.iblines,P.STATIC_DRAW));for(var n=e.attributes,i=e.attributesKeys,r=0,o=i.length;r<o;r++){var a=i[r],s=n[a],l="index"===a;if(s.array&&void 0===s.buffer&&(s.buffer=P.createBuffer(),s.needsUpdate=!0),!0===s.needsUpdate){var c=l?P.ELEMENT_ARRAY_BUFFER:P.ARRAY_BUFFER;P.bindBuffer(c,s.buffer),P.bufferData(c,s.array,P.STATIC_DRAW),s.needsUpdate=!1}}e.vbNeedsUpdate&&(P.bindBuffer(P.ARRAY_BUFFER,e.vbbuffer),P.bufferData(P.ARRAY_BUFFER,e.vb,P.STATIC_DRAW),e.vbNeedsUpdate=!1,e.discardAfterUpload&&(e.vb=null))}}function Qe(e,t,n,i){var r=n.vaos;if(r)for(var o=0,a=r.length;o<a;o++){var s=r[o];if(s.geomhash===t.id&&s.uv===i)return D.bindVertexArrayOES(s.vao),!0}else if(null===r)return!1;return function(e,t,n,i){var r;if(!D||!f.USE_VAO||n.streamingDraw)return n.vaos=null,!1;if(n.offsets&&n.offsets.length>1)return n.vaos=null,!1;if(void 0===n.vaos&&(n.vaos=[]),r=D.createVertexArrayOES(),n.vaos.push({geomhash:t.id,uv:i,vao:r}),D.bindVertexArrayOES(r),e.isEdgeMaterial)P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,n.iblinesbuffer);else{var o=n.attributes.index;o&&P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,n.ibbuffer||o.buffer)}for(var a=null,s=t.attributes,l=t.attributesKeys,c=n.vbstride,u=n.offsets&&n.offsets.length?n.offsets[0].index:0,h=0,d=l.length;h<d;h++){var p=l[h],m=s[p];if(m>=0){var g=n.attributes[p];if("uv"===p&&i&&(g=n.attributes["uv"+(i+1)]),!g){D.bindVertexArrayOES(null);for(var v=0;v<n.vaos.length;v++)D.deleteVertexArrayOES(n.vaos[v].vao);return n.vaos=null,!1}var y=P.FLOAT,_=g.bytesPerItem||4;1===_?y=P.UNSIGNED_BYTE:2===_&&(y=P.UNSIGNED_SHORT),P.enableVertexAttribArray(m),void 0!==g.itemOffset?(a!=n.vbbuffer&&(P.bindBuffer(P.ARRAY_BUFFER,n.vbbuffer),a=n.vbbuffer),P.vertexAttribPointer(m,g.itemSize,y,!!g.normalize,4*c,4*(g.itemOffset+u*c))):(P.bindBuffer(P.ARRAY_BUFFER,g.buffer),a=g.buffer,P.vertexAttribPointer(m,g.itemSize,y,!!g.normalize,0,u*g.itemSize*_)),R&&R.vertexAttribDivisorANGLE(m,n.numInstances&&g.divisor||0)}}return!0}(e,t,n,i)}function Ze(e,t){var n=Y[e];return n||(n=P.createBuffer(),Y[e]=n),P.bindBuffer(P.ARRAY_BUFFER,n),P.bufferData(P.ARRAY_BUFFER,t,P.DYNAMIC_DRAW),n}function Je(e,t,n,i,r,o){var a,s=t.attributes,l=t.attributesKeys,c=0;if(r)if(!r.buffer&&n.streamingDraw){var u=Y.index;u||(u=P.createBuffer(),Y.index=u),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,u),e.isEdgeMaterial?P.bufferData(P.ELEMENT_ARRAY_BUFFER,n.iblines,P.DYNAMIC_DRAW):P.bufferData(P.ELEMENT_ARRAY_BUFFER,r.array||n.ib,P.DYNAMIC_DRAW)}else e.isEdgeMaterial?P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,n.iblinesbuffer):P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,n.ibbuffer||r.buffer);for(var h=0,d=l.length;h<d;h++){var f=l[h],p=s[f];if(p>=0){var m=n.attributes[f];if("uv"===f&&o&&(m=n.attributes["uv"+(o+1)]),m){var g,v,y=void 0!==m.itemOffset;y?(g=n.vbstride,v=m.itemOffset,c!==a&&(n.streamingDraw?c=Ze("interleavedVB",n.vb):(c=n.vbbuffer,P.bindBuffer(P.ARRAY_BUFFER,c)),a=c)):(g=m.itemSize,v=0,n.streamingDraw?c=Ze(f,m.array):(c=m.buffer,P.bindBuffer(P.ARRAY_BUFFER,c)));var _=P.FLOAT,b=m.bytesPerItem||4;1===b?_=P.UNSIGNED_BYTE:2===b&&(_=P.UNSIGNED_SHORT),y&&(b=4),ie.enableAttribute(p),P.vertexAttribPointer(p,m.itemSize,_,m.normalize,g*b,(v+i*g)*b),R&&R.vertexAttribDivisorANGLE(p,n.numInstances&&m.divisor||0)}else if(e.defaultAttributeValues){var x=e.defaultAttributeValues[f];x&&2===x.length?P.vertexAttrib2fv(p,e.defaultAttributeValues[f]):x&&3===x.length?P.vertexAttrib3fv(p,e.defaultAttributeValues[f]):x&&4===x.length&&P.vertexAttrib4fv(p,e.defaultAttributeValues[f])}}}ie.disableUnusedAttributes()}function $e(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?e.z-t.z:e.id-t.id}function et(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?t.z-e.z:e.id-t.id}function tt(e){it(e,!0)}function nt(e){it(e,!1)}function it(e,t,n){var i,r;if(n||!1!==e.visible){if(e instanceof a.Scene||e instanceof a.Group);else if(e instanceof o.RenderBatch)e.forEach(t?tt:nt);else if(function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("removed",Ce));var t=e.geometry;void 0===t||void 0===t.__webglInit&&(t.__webglInit=!0,t.addEventListener("dispose",Pe),t instanceof a.BufferGeometry||(e instanceof a.Mesh?ft(e,t):e instanceof a.Line?void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=P.createBuffer(),e.__webglColorBuffer=P.createBuffer(),e.__webglLineDistanceBuffer=P.createBuffer(),I.info.memory.geometries++}(t),function(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__lineDistanceArray=new Float32Array(1*n),e.__webglLineCount=n,Ge(e,t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0,t.lineDistancesNeedUpdate=!0):e instanceof a.PointCloud&&void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=P.createBuffer(),e.__webglColorBuffer=P.createBuffer(),I.info.memory.geometries++}(t),function(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__webglPointCount=n,Ge(e,t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0)));if(void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof a.Mesh){if(t instanceof a.BufferGeometry)pt(A,t,e);else if(t instanceof a.Geometry)for(var n=ht[t.id],i=0,r=n.length;i<r;i++)pt(A,n[i],e)}else e instanceof a.Line||e instanceof a.PointCloud?pt(A,t,e):(e instanceof a.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}(E,e)}(e),e instanceof a.Light)w.push(e);else{var s=A[e.id];if(s&&(!1===e.frustumCulled||!0===K.intersectsObject(e)))for(i=0,r=s.length;i<r;i++){var l=s[i];ut(l),l.render=!0,!0===t&&(J.setFromMatrixPosition(e.matrixWorld),J.applyProjection(Q),l.z=J.z)}}if(e.children)for(i=0,r=e.children.length;i<r;i++)it(e.children[i],t,n)}}function rt(e,t){if(!t.getCustomOverrideMaterial)return t;var n=t.getCustomOverrideMaterial(e);return n||t}function ot(e,t,n,i,r){for(var o,s=0,l=e.length;s<l;s++){var c=e[s],u=c.object,h=c.buffer;if(r)o=rt(c.material,r);else{if(!(o=c.material))continue;_t(o)}if(o.twoPassTransparency){var d=o.side;o.side=a.BackSide,at(o,t,n,i,h,r,u),o.side=a.FrontSide,at(o,t,n,i,h,r,u),o.side=d}else at(o,t,n,i,h,r,u)}}function at(e,t,n,i,r,o,s){if(I.setMaterialFaces(e),r instanceof a.BufferGeometry?I.renderBufferDirect(t,n,i,e,r,s):I.renderBuffer(t,n,i,e,r,s),e.decals)for(var l=e.decals,c=0,u=l.length;c<u;c++){var h=l[c];_t(e=h.material),I.setMaterialFaces(e),r instanceof a.BufferGeometry&&I.renderBufferDirect(t,n,i,e,r,s,h.uv)}}function st(e,t){if(e.visible&&!e.hide){var n;if(Fe)n=rt(e.material,Fe);else{if(!(n=e.material))return;_t(n)}if(n.twoPassTransparency){var i=n.side;n.side=a.BackSide,lt(e,n),n.side=a.FrontSide,lt(e,n),n.side=i}else lt(e,n)}}function lt(e,t){if(I.setMaterialFaces(t),I.renderBufferDirect(Ne,ke,Ve,t,e.geometry,e),t.decals)for(var n=t.decals,i=0,r=n.length;i<r;i++){var o=n[i];_t(t=o.material),I.setMaterialFaces(t),I.renderBufferDirect(Ne,ke,Ve,t,e.geometry,e,o.uv)}}function ct(e,t,n,i,r,o){Ne=n,ke=i,Ve=r,Fe=o||null,e.forEach(st,e.forceVisible?1:32,!1)}function ut(e){var t=e.object,n=e.buffer,i=t.geometry,r=t.material;if(r instanceof a.MeshFaceMaterial){var o=i instanceof a.BufferGeometry?0:n.materialIndex;r=r.materials[o],e.material=r,r.transparent?C.push(e):S.push(e)}else r&&(e.material=r,r.transparent?C.push(e):S.push(e))}this.renderBufferDirect=function(e,t,n,i,r,o,a){if(!1!==i.visible&&(!i.isEdgeMaterial||r.iblines)){Ke(o.geometry);var s=bt(e,t,n,i,o),l=r.attributes,c=!1,u=i.wireframe?1:0,h="direct_"+r.id+(a?"/"+a:"")+"_"+s.id+"_"+u;h!==B&&(B=h,c=!0);var d=Qe(i,s,r,a||0);(c=c&&!d)&&ie.initAttributes();var f,p=l.index;if(p){var m,g,v=p.array?p.array:r.ib;i.isEdgeMaterial&&(p=l.indexlines,v=r.iblines),p.bytesPerItem?4===(g=p.bytesPerItem)&&re.get("OES_element_index_uint"):g=v instanceof Uint32Array&&re.get("OES_element_index_uint")?4:2,m=4===g?P.UNSIGNED_INT:P.UNSIGNED_SHORT;var y=i.isEdgeMaterial?null:r.offsets;y&&y.length>1&&(c=!0);var _=0;do{var b,x,w;y&&y.length?(b=y[_].index,x=y[_].start,w=y[_].count):(b=0,x=0,w=v.length),c&&Je(i,s,r,b,p,a),f=P.TRIANGLES,r.isPoints?f=P.POINTS:(r.isLines||i.isEdgeMaterial)&&(f=P.LINES),r.numInstances?R.drawElementsInstancedANGLE(f,w,m,x*g,r.numInstances):P.drawElements(f,w,m,x*g)}while(y&&++_<y.length)}else{c&&Je(i,s,r,0,void 0,a);var A=r.attributes.position;f=P.TRIANGLES,r.isPoints?f=P.POINTS:(r.isLines||i.isEdgeMaterial)&&(f=P.LINES),r.numInstances?R.drawArraysInstancedANGLE(f,0,A.array.length/3,r.numInstances):P.drawArrays(f,0,A.array.length/A.itemSize)}d&&D.bindVertexArrayOES(null)}},this.renderBuffer=function(e,t,i,r,o,s){if(!1!==r.visible){!function(e){var t,n,i=e.geometry;if(i instanceof a.BufferGeometry)Ke(i);else if(e instanceof a.Mesh){!0===i.groupsNeedUpdate&&ft(e,i);for(var r=ht[i.id],o=0,s=r.length;o<s;o++){var l=r[o];n=We(e,l),t=n.attributes&&mt(n),(i.verticesNeedUpdate||i.morphTargetsNeedUpdate||i.elementsNeedUpdate||i.uvsNeedUpdate||i.normalsNeedUpdate||i.colorsNeedUpdate||i.tangentsNeedUpdate||t)&&Ye(l,e,P.DYNAMIC_DRAW,!i.dynamic,n)}i.verticesNeedUpdate=!1,i.morphTargetsNeedUpdate=!1,i.elementsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.tangentsNeedUpdate=!1,n.attributes&&gt(n)}else e instanceof a.Line?(n=We(e,i),t=n.attributes&&mt(n),(i.verticesNeedUpdate||i.colorsNeedUpdate||i.lineDistancesNeedUpdate||t)&&function(e,t){var n,i,r,o,a,s,l,c,u,h,d,f,p=e.vertices,m=e.colors,g=e.lineDistances,v=p.length,y=m.length,_=g.length,b=e.__vertexArray,x=e.__colorArray,w=e.__lineDistanceArray,A=e.verticesNeedUpdate,E=e.colorsNeedUpdate,T=e.lineDistancesNeedUpdate,M=e.__webglCustomAttributesList;if(A){for(n=0;n<v;n++)o=p[n],b[a=3*n]=o.x,b[a+1]=o.y,b[a+2]=o.z;P.bindBuffer(P.ARRAY_BUFFER,e.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,b,t)}if(E){for(i=0;i<y;i++)s=m[i],x[a=3*i]=s.r,x[a+1]=s.g,x[a+2]=s.b;P.bindBuffer(P.ARRAY_BUFFER,e.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,x,t)}if(T){for(r=0;r<_;r++)w[r]=g[r];P.bindBuffer(P.ARRAY_BUFFER,e.__webglLineDistanceBuffer),P.bufferData(P.ARRAY_BUFFER,w,t)}if(M)for(l=0,c=M.length;l<c;l++)if((f=M[l]).needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(a=0,h=f.value.length,1===f.size)for(u=0;u<h;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;u<h;u++)d=f.value[u],f.array[a]=d.x,f.array[a+1]=d.y,a+=2;else if(3===f.size)if("c"===f.type)for(u=0;u<h;u++)d=f.value[u],f.array[a]=d.r,f.array[a+1]=d.g,f.array[a+2]=d.b,a+=3;else for(u=0;u<h;u++)d=f.value[u],f.array[a]=d.x,f.array[a+1]=d.y,f.array[a+2]=d.z,a+=3;else if(4===f.size)for(u=0;u<h;u++)d=f.value[u],f.array[a]=d.x,f.array[a+1]=d.y,f.array[a+2]=d.z,f.array[a+3]=d.w,a+=4;P.bindBuffer(P.ARRAY_BUFFER,f.buffer),P.bufferData(P.ARRAY_BUFFER,f.array,t)}}(i,P.DYNAMIC_DRAW),i.verticesNeedUpdate=!1,i.colorsNeedUpdate=!1,i.lineDistancesNeedUpdate=!1,n.attributes&&gt(n)):e instanceof a.PointCloud&&(n=We(e,i),t=n.attributes&&mt(n),(i.verticesNeedUpdate||i.colorsNeedUpdate||t)&&function(e,t){var n,i,r,o,a,s,l,c,u,h,d,f=e.vertices,p=e.colors,m=f.length,g=p.length,v=e.__vertexArray,y=e.__colorArray,_=e.verticesNeedUpdate,b=e.colorsNeedUpdate,x=e.__webglCustomAttributesList;if(_){for(n=0;n<m;n++)r=f[n],v[o=3*n]=r.x,v[o+1]=r.y,v[o+2]=r.z;P.bindBuffer(P.ARRAY_BUFFER,e.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,v,t)}if(b){for(i=0;i<g;i++)a=p[i],y[o=3*i]=a.r,y[o+1]=a.g,y[o+2]=a.b;P.bindBuffer(P.ARRAY_BUFFER,e.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,y,t)}if(x)for(s=0,l=x.length;s<l;s++)if((d=x[s]).needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo)){if(o=0,u=d.value.length,1===d.size)for(c=0;c<u;c++)d.array[c]=d.value[c];else if(2===d.size)for(c=0;c<u;c++)h=d.value[c],d.array[o]=h.x,d.array[o+1]=h.y,o+=2;else if(3===d.size)if("c"===d.type)for(c=0;c<u;c++)h=d.value[c],d.array[o]=h.r,d.array[o+1]=h.g,d.array[o+2]=h.b,o+=3;else for(c=0;c<u;c++)h=d.value[c],d.array[o]=h.x,d.array[o+1]=h.y,d.array[o+2]=h.z,o+=3;else if(4===d.size)for(c=0;c<u;c++)h=d.value[c],d.array[o]=h.x,d.array[o+1]=h.y,d.array[o+2]=h.z,d.array[o+3]=h.w,o+=4;P.bindBuffer(P.ARRAY_BUFFER,d.buffer),P.bufferData(P.ARRAY_BUFFER,d.array,t)}}(i,P.DYNAMIC_DRAW),i.verticesNeedUpdate=!1,i.colorsNeedUpdate=!1,n.attributes&&gt(n))}(s);var l=bt(e,t,i,r,s),c=l.attributes,u=!1,h=r.wireframe?1:0,d=o.id+"_"+l.id+"_"+h;if(d!==B&&(B=d,u=!0),u&&ie.initAttributes(),!r.morphTargets&&c.position>=0&&u&&(P.bindBuffer(P.ARRAY_BUFFER,o.__webglVertexBuffer),ie.enableAttribute(c.position),y(c.position,3,P.FLOAT,!1,0,0)),u){if(o.__webglCustomAttributesList)for(var f=0,p=o.__webglCustomAttributesList.length;f<p;f++){var m=o.__webglCustomAttributesList[f];c[m.buffer.belongsToAttribute]>=0&&(P.bindBuffer(P.ARRAY_BUFFER,m.buffer),ie.enableAttribute(c[m.buffer.belongsToAttribute]),y(c[m.buffer.belongsToAttribute],m.size,P.FLOAT,!1,0,0))}c.color>=0&&(s.geometry.colors.length>0||s.geometry.faces.length>0?(P.bindBuffer(P.ARRAY_BUFFER,o.__webglColorBuffer),ie.enableAttribute(c.color),y(c.color,3,P.FLOAT,!1,0,0)):r.defaultAttributeValues&&P.vertexAttrib3fv(c.color,r.defaultAttributeValues.color)),c.normal>=0&&(P.bindBuffer(P.ARRAY_BUFFER,o.__webglNormalBuffer),ie.enableAttribute(c.normal),y(c.normal,3,P.FLOAT,!1,0,0)),c.tangent>=0&&(P.bindBuffer(P.ARRAY_BUFFER,o.__webglTangentBuffer),ie.enableAttribute(c.tangent),y(c.tangent,4,P.FLOAT,!1,0,0)),c.uv>=0&&(s.geometry.faceVertexUvs[0]?(P.bindBuffer(P.ARRAY_BUFFER,o.__webglUVBuffer),ie.enableAttribute(c.uv),y(c.uv,2,P.FLOAT,!1,0,0)):r.defaultAttributeValues&&P.vertexAttrib2fv(c.uv,r.defaultAttributeValues.uv)),c.uv2>=0&&(s.geometry.faceVertexUvs[1]?(P.bindBuffer(P.ARRAY_BUFFER,o.__webglUV2Buffer),ie.enableAttribute(c.uv2),y(c.uv2,2,P.FLOAT,!1,0,0)):r.defaultAttributeValues&&P.vertexAttrib2fv(c.uv2,r.defaultAttributeValues.uv2)),c.lineDistance>=0&&(P.bindBuffer(P.ARRAY_BUFFER,o.__webglLineDistanceBuffer),ie.enableAttribute(c.lineDistance),y(c.lineDistance,1,P.FLOAT,!1,0,0))}if(ie.disableUnusedAttributes(),s instanceof a.Mesh){var g=o.__typeArray===Uint32Array?P.UNSIGNED_INT:P.UNSIGNED_SHORT;r.wireframe?(ie.setLineWidth(r.wireframeLinewidth*n),u&&P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),P.drawElements(P.LINES,o.__webglLineCount,g,0)):(u&&P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),P.drawElements(P.TRIANGLES,o.__webglFaceCount,g,0))}else if(s instanceof a.Line){var v=s.mode===a.LineStrip?P.LINE_STRIP:P.LINES;ie.setLineWidth(r.linewidth*n),P.drawArrays(v,0,o.__webglLineCount)}else s instanceof a.PointCloud&&P.drawArrays(P.POINTS,0,o.__webglPointCount)}function y(e,t,n,i,r,o){P.vertexAttribPointer(e,t,n,i,r,o),R&&R.vertexAttribDivisorANGLE(e,0)}},this.render=function(e,t,n,i,r){if(t instanceof a.Camera!=!1){B="",V=-1,F=null,void 0!==r&&(w.length=0,ee=!0);var s=e.fog;!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),t.worldUpTransform?Z.multiplyMatrices(t.worldUpTransform,t.matrixWorld):Z.copy(t.matrixWorld),Q.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),K.setFromMatrix(Q);var l=e instanceof o.RenderBatch&&e.renderImmediate;if(l||(S.length=0,C.length=0,it(e,!0===I.sortObjects,!0===e.forceVisible),!0===I.sortObjects&&(S.sort(et),C.sort($e))),ee&&(r&&r.length&&(w=r.slice()),St(w)),this.setRenderTarget(n),this.resetGLState(),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),e.overrideMaterial){var c=e.overrideMaterial;_t(c),l?ct(e,"",t,w,s,c):(ot(S,t,w,s,c),ot(C,t,w,s,c))}else l?ct(e,"",t,w,s,null):(ie.setBlending(a.NoBlending),ot(S,t,w,s,null),ot(C,t,w,s,null));n&&n.generateMipmaps&&n.minFilter!==a.NearestFilter&&n.minFilter!==a.LinearFilter&&function(e){P.bindTexture(P.TEXTURE_2D,e.__webglTexture),P.generateMipmap(P.TEXTURE_2D),P.bindTexture(P.TEXTURE_2D,null)}(n),this.resetGLState(),ie.setDepthTest(!0),ie.setDepthWrite(!0)}else a.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.clearBlend=function(){ie.setBlending(a.NoBlending)},this.setProgramPrefix=function(e,t,n){U=e,z=t,G=n},this.getProgramPrefix=function(){return{programPrefix:U,vertexPrefix:z,fragmentPrefix:G}};var ht={},dt=0;function ft(e,t){var n=e.material,i=!1;void 0!==ht[t.id]&&!0!==t.groupsNeedUpdate||(delete A[e.id],ht[t.id]=function(e,t){for(var n,i,r=re.get("OES_element_index_uint")?4294967296:65535,o={},a=e.morphTargets?e.morphTargets.length:0,s=e.morphNormals?e.morphNormals.length:0,l={},c=[],u=0,h=e.faces.length;u<h;u++){var d=e.faces[u],f=t?d.materialIndex:0;f in o||(o[f]={hash:f,counter:0}),(n=o[f].hash+"_"+o[f].counter)in l||(i={id:dt++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:a,numMorphNormals:s},l[n]=i,c.push(i)),l[n].vertices+3>r&&(o[f].counter+=1,(n=o[f].hash+"_"+o[f].counter)in l||(i={id:dt++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:a,numMorphNormals:s},l[n]=i,c.push(i))),l[n].faces3.push(u),l[n].vertices+=3}return c}(t,n instanceof a.MeshFaceMaterial),t.groupsNeedUpdate=!1);for(var r=ht[t.id],o=0,s=r.length;o<s;o++){var l=r[o];void 0===l.__webglVertexBuffer?(Se(l),He(l,e),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0,i=!0):i=!1,(i||void 0===e.__webglActive)&&pt(A,l,e)}e.__webglActive=!0}function pt(e,t,n){var i=n.id;e[i]=e[i]||[],e[i].push({id:i,buffer:t,object:n,material:null,z:0})}function mt(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function gt(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}var vt={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"firefly_basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"firefly_phong",LineBasicMaterial:"firefly_basic",LineDashedMaterial:"dashed",PointCloudMaterial:"firefly_basic"};function yt(e,t,n,r){e.addEventListener("dispose",De);var o=vt[e.type];if(o){var c=a.ShaderLib[o];e.__webglShader={uniforms:a.UniformsUtils.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};var u=function(e){for(var t=0,n=0,i=0,r=0,o=0,s=e.length;o<s;o++){var l=e[o];l.onlyShadow||(l instanceof a.DirectionalLight&&t++,l instanceof a.PointLight&&n++,l instanceof a.SpotLight&&i++,l instanceof a.HemisphereLight&&r++)}return{directional:t,point:n,spot:i,hemi:r}}(t),h={precision:s,precisionFragment:l,supportsVertexTextures:de,haveTextureLod:!!re.get("EXT_shader_texture_lod"),map:!!e.map,envMap:!!e.envMap,irradianceMap:!!e.irradianceMap,envIsSpherical:e.envMap&&e.envMap.mapping==a.SphericalReflectionMapping,envGammaEncoded:e.envMap&&e.envMap.GammaEncoded,irrGammaEncoded:e.irradianceMap&&e.irradianceMap.GammaEncoded,envRGBM:e.envMap&&e.envMap.RGBM,irrRGBM:e.irradianceMap&&e.irradianceMap.RGBM,lightMap:!!e.lightMap,bumpMap:re.get("OES_standard_derivatives")&&!!e.bumpMap,normalMap:re.get("OES_standard_derivatives")&&!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,vertexColors:e.vertexColors,vertexIds:e.vertexIds,useInstancing:e.useInstancing,wideLines:e.wideLines,fog:n,useFog:e.fog,fogExp:n instanceof a.FogExp2,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:y,maxDirLights:u.directional,maxPointLights:u.point,maxSpotLights:u.spot,maxHemiLights:u.hemi,alphaTest:e.alphaTest,metal:e.metal,clearcoat:e.clearcoat,wrapAround:e.wrapAround,doubleSided:e.side===a.DoubleSide,flipSided:e.side===a.BackSide,mrtNormals:e.mrtNormals,mrtIdBuffer:e.mrtIdBuffer,vertexPrefix:z,fragmentPrefix:G,tonemapOutput:e.tonemapOutput,packedNormals:e.packedNormals,hatchPattern:!!e.hatchParams,numCutplanes:e.cutplanes?e.cutplanes.length:0,useTiling:e.useTiling,tilingRepeatRange:e.useTiling&&e.tilingRepeatRange,hasRoundCorner:e.hasRoundCorner,useRandomOffset:e.useRandomOffset,mapInvert:e.map&&e.map.invert,mapClampS:e.map&&e.map.clampS,mapClampT:e.map&&e.map.clampT,bumpMapClampS:e.bumpMap&&e.bumpMap.clampS,bumpMapClampT:e.bumpMap&&e.bumpMap.clampT,normalMapClampS:e.normalMap&&e.normalMap.clampS,normalMapClampT:e.normalMap&&e.normalMap.clampT,specularMapClampS:e.specularMap&&e.specularMap.clampS,specularMapClampT:e.specularMap&&e.specularMap.clampT,alphaMapInvert:e.alphaMap&&e.alphaMap.invert,alphaMapClampS:e.alphaMap&&e.alphaMap.clampS,alphaMapClampT:e.alphaMap&&e.alphaMap.clampT};e.isPrismMaterial&&(!function(e,t){if(t.textureMaps)for(var n=0;n<i.PrismMaps.length;n++){var r=i.PrismMaps[n],o=t.textureMaps[r+"_map"];if(o){var a=o.textureObj.properties.booleans;e[r]={S:!a.texture_URepeat.values[0],T:!a.texture_VRepeat.values[0]}}}}(h,e),h.isPrism=!0);var d,f,p=[];for(var m in o?p.push(o):(p.push(e.fragmentShader),p.push(e.vertexShader)),e.defines)p.push(m),p.push(e.defines[m]);for(d in h)p.push(d),p.push(h[d]);var g,v=p.join();for(d=0,f=O.length;d<f;d++){var _=O[d];if(_.code===v){(g=_).usedTimes++;break}}for(var b in void 0===g&&(g=new i.WebGLProgram(I,v,e,h),O.push(g),I.info.memory.programs=O.length),e.programs||(e.programs=[]),e.programs[U]=g,e.uniformsLists||(e.uniformsLists=[]),e.uniformsList=e.uniformsLists[U]=[],e.__webglShader.uniforms){var x=g.uniforms[b];x&&e.uniformsList.push([e.__webglShader.uniforms[b],x])}}function _t(e){!0===e.transparent?ie.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):ie.setBlending(a.NoBlending),ie.setDepthTest(e.depthTest),ie.setDepthWrite(e.depthWrite),ie.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function bt(e,t,n,i,o){H=0,i.needsUpdate?(i.program&&ze(i),yt(i,t,n),i.needsUpdate=!1):i.programs[U]||yt(i,t,n);var s=!1,l=!1,c=!1;i.uniformsList=i.uniformsLists[U];var u,h=i.program=i.programs[U],d=h.uniforms,f=i.__webglShader.uniforms;if(h.id!==N&&(P.useProgram(h.program),N=h.id,s=!0,l=!0,c=!0),i.id!==V&&(-1===V&&(c=!0),V=i.id,l=!0),(s||e!==F)&&(P.uniformMatrix4fv(d.projectionMatrix,!1,e.projectionMatrix.elements),y&&P.uniform1f(d.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==F&&(F=e),(i instanceof a.ShaderMaterial||i instanceof a.MeshPhongMaterial||i.isPrismMaterial||i.envMap)&&null!==d.cameraPosition&&(J.setFromMatrixPosition(e.matrixWorld),P.uniform3f(d.cameraPosition,J.x,J.y,J.z)),(i instanceof a.MeshPhongMaterial||i instanceof a.MeshLambertMaterial||i instanceof a.ShaderMaterial||i.isPrismMaterial||i.skinning)&&(null!==d.viewMatrix&&P.uniformMatrix4fv(d.viewMatrix,!1,e.matrixWorldInverse.elements),null!==d.viewMatrixInverse&&P.uniformMatrix4fv(d.viewMatrixInverse,!1,Z.elements),d.mvpMatrix&&P.uniformMatrix4fv(d.mvpMatrix,!1,Q.elements),c?(wt(f,i),At(f,!0)):At(f,!1))),d.unpackXform){var p=o.geometry,m=p.unpackXform;if(m?P.uniform4f(d.unpackXform,m.x,m.y,m.z,m.w):P.uniform4f(d.unpackXform,1,1,0,0),d.tIdColor){P.uniform2f(d.vIdColorTexSize,p.vIdColorTexSize.x,p.vIdColorTexSize.y);var g=Tt();P.uniform1i(d.tIdColor,g),I.setTexture(p.tIdColor,g)}}if(l){if(n&&i.fog&&function(e,t){e.fogColor.value=t.color,t instanceof a.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof a.FogExp2&&(e.fogDensity.value=t.density)}(f,n),(i instanceof a.MeshPhongMaterial||i instanceof a.MeshLambertMaterial||i.isPrismMaterial||i.lights)&&(ee&&(c=!0,St(t),ee=!1),c?(!function(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}(f,te),Et(f,!0)):Et(f,!1)),(i instanceof a.MeshBasicMaterial||i instanceof a.MeshLambertMaterial||i instanceof a.MeshPhongMaterial)&&(!function(e,t){e.opacity.value=t.opacity,e.diffuse.value.copy(t.color),e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));function n(e,t,n){var i=n.offset,r=n.repeat;if(t){var o=t.value;n.matrix?o.copy(n.matrix):o.identity(),o.elements[6]+=i.x,o.elements[7]+=i.y,o.elements[0]*=r.x,o.elements[3]*=r.x,o.elements[1]*=r.y,o.elements[4]*=r.y}else e.offsetRepeat.value.set(i.x,i.y,r.x,r.y)}t.alphaMap&&n(e,e.texMatrixAlpha,t.alphaMap);var i,r;t.normalMap?i=t.normalMap:t.bumpMap&&(i=t.bumpMap);void 0!==i&&n(e,e.texMatrixBump,i);t.map?r=t.map:t.specularMap&&(r=t.specularMap);void 0!==r&&n(e,e.texMatrix,r);e.envMap.value=t.envMap,e.irradianceMap&&(e.irradianceMap.value=t.irradianceMap);e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}(f,i),wt(f,i)),i instanceof a.PointCloudMaterial?function(e,t){xt(e,t),e.point_size.value=t.size}(f,i):i instanceof a.LineBasicMaterial?xt(f,i):i instanceof a.LineDashedMaterial?(xt(f,i),function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(f,i)):i instanceof a.MeshPhongMaterial?function(e,t){if(e.shininess.value=t.shininess,e.reflMipIndex){var n=Math.log(Math.max(1+1e-10,t.shininess));e.reflMipIndex.value=Math.max(0,-.72134752*n+5.5)}e.emissive&&e.emissive.value.copy(t.emissive);e.specular.value.copy(t.specular),e.exposureBias&&(e.exposureBias.value=t.exposureBias)}(f,i):i instanceof a.MeshLambertMaterial?function(e,t){e.emissive.value.copy(t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(f,i):i instanceof a.MeshDepthMaterial?(f.mNear.value=e.near,f.mFar.value=e.far,f.opacity.value=i.opacity):i instanceof a.MeshNormalMaterial?f.opacity.value=i.opacity:i.isPrismMaterial&&(!function(e,t){function n(e,t,n){e[n].value=t[n],null!=t[n]&&(e[n+"_texMatrix"].value=t[n].matrix,e[n+"_invert"].value=t[n].invert)}function i(e,t,n){e[n].value=t[n],null!=t[n]&&(e[n+"_texMatrix"].value=t[n].matrix,e[n+"_bumpScale"].value=t[n].bumpScale,e[n+"_bumpmapType"].value=t[n].bumpmapType)}switch(e.exposureBias.value=t.exposureBias,e.opacity.value=t.opacity,e.surface_albedo.value=t.surface_albedo,e.surface_roughness.value=t.surface_roughness,e.surface_anisotropy.value=t.surface_anisotropy,e.surface_rotation.value=t.surface_rotation,n(e,t,"surface_albedo_map"),n(e,t,"surface_roughness_map"),n(e,t,"surface_cutout_map"),n(e,t,"surface_anisotropy_map"),n(e,t,"surface_rotation_map"),i(e,t,"surface_normal_map"),t.prismType){case"PrismOpaque":e.opaque_albedo.value=t.opaque_albedo,e.opaque_luminance_modifier.value=t.opaque_luminance_modifier,e.opaque_f0.value=t.opaque_f0,e.opaque_luminance.value=t.opaque_luminance,n(e,t,"opaque_albedo_map"),n(e,t,"opaque_luminance_modifier_map"),n(e,t,"opaque_f0_map");break;case"PrismMetal":e.metal_f0.value=t.metal_f0,n(e,t,"metal_f0_map");break;case"PrismLayered":e.layered_f0.value=t.layered_f0,e.layered_diffuse.value=t.layered_diffuse,e.layered_fraction.value=t.layered_fraction,e.layered_bottom_f0.value=t.layered_bottom_f0,e.layered_roughness.value=t.layered_roughness,e.layered_anisotropy.value=t.layered_anisotropy,e.layered_rotation.value=t.layered_rotation,n(e,t,"layered_bottom_f0_map"),n(e,t,"layered_f0_map"),n(e,t,"layered_diffuse_map"),n(e,t,"layered_fraction_map"),n(e,t,"layered_roughness_map"),n(e,t,"layered_anisotropy_map"),n(e,t,"layered_rotation_map"),i(e,t,"layered_normal_map");break;case"PrismTransparent":e.transparent_color.value=t.transparent_color,e.transparent_distance.value=t.transparent_distance,e.transparent_ior.value=t.transparent_ior;break;case"PrismGlazing":e.glazing_f0.value=t.glazing_f0,e.glazing_transmission_color.value=t.glazing_transmission_color,e.glazing_transmission_roughness.value=t.glazing_transmission_roughness,n(e,t,"glazing_f0_map"),n(e,t,"glazing_transmission_color_map"),n(e,t,"glazing_transmission_roughness_map");break;case"PrismWood":e.wood_fiber_cosine_enable.value=t.wood_fiber_cosine_enable,e.wood_fiber_cosine_bands.value=t.wood_fiber_cosine_bands,e.wood_fiber_cosine_weights.value=t.wood_fiber_cosine_weights,e.wood_fiber_cosine_frequencies.value=t.wood_fiber_cosine_frequencies,e.wood_fiber_perlin_enable.value=t.wood_fiber_perlin_enable,e.wood_fiber_perlin_bands.value=t.wood_fiber_perlin_bands,e.wood_fiber_perlin_weights.value=t.wood_fiber_perlin_weights,e.wood_fiber_perlin_frequencies.value=t.wood_fiber_perlin_frequencies,e.wood_fiber_perlin_scale_z.value=t.wood_fiber_perlin_scale_z,e.wood_growth_perlin_enable.value=t.wood_growth_perlin_enable,e.wood_growth_perlin_bands.value=t.wood_growth_perlin_bands,e.wood_growth_perlin_weights.value=t.wood_growth_perlin_weights,e.wood_growth_perlin_frequencies.value=t.wood_growth_perlin_frequencies,e.wood_latewood_ratio.value=t.wood_latewood_ratio,e.wood_earlywood_sharpness.value=t.wood_earlywood_sharpness,e.wood_latewood_sharpness.value=t.wood_latewood_sharpness,e.wood_ring_thickness.value=t.wood_ring_thickness,e.wood_earlycolor_perlin_enable.value=t.wood_earlycolor_perlin_enable,e.wood_earlycolor_perlin_bands.value=t.wood_earlycolor_perlin_bands,e.wood_earlycolor_perlin_weights.value=t.wood_earlycolor_perlin_weights,e.wood_earlycolor_perlin_frequencies.value=t.wood_earlycolor_perlin_frequencies,e.wood_early_color.value=t.wood_early_color,e.wood_use_manual_late_color.value=t.wood_use_manual_late_color,e.wood_manual_late_color.value=t.wood_manual_late_color,e.wood_latecolor_perlin_enable.value=t.wood_latecolor_perlin_enable,e.wood_latecolor_perlin_bands.value=t.wood_latecolor_perlin_bands,e.wood_latecolor_perlin_weights.value=t.wood_latecolor_perlin_weights,e.wood_latecolor_perlin_frequencies.value=t.wood_latecolor_perlin_frequencies,e.wood_late_color_power.value=t.wood_late_color_power,e.wood_diffuse_perlin_enable.value=t.wood_diffuse_perlin_enable,e.wood_diffuse_perlin_bands.value=t.wood_diffuse_perlin_bands,e.wood_diffuse_perlin_weights.value=t.wood_diffuse_perlin_weights,e.wood_diffuse_perlin_frequencies.value=t.wood_diffuse_perlin_frequencies,e.wood_diffuse_perlin_scale_z.value=t.wood_diffuse_perlin_scale_z,e.wood_use_pores.value=t.wood_use_pores,e.wood_pore_type.value=t.wood_pore_type,e.wood_pore_radius.value=t.wood_pore_radius,e.wood_pore_cell_dim.value=t.wood_pore_cell_dim,e.wood_pore_color_power.value=t.wood_pore_color_power,e.wood_pore_depth.value=t.wood_pore_depth,e.wood_use_rays.value=t.wood_use_rays,e.wood_ray_color_power.value=t.wood_ray_color_power,e.wood_ray_seg_length_z.value=t.wood_ray_seg_length_z,e.wood_ray_num_slices.value=t.wood_ray_num_slices,e.wood_ray_ellipse_z2x.value=t.wood_ray_ellipse_z2x,e.wood_ray_ellipse_radius_x.value=t.wood_ray_ellipse_radius_x,e.wood_use_latewood_bump.value=t.wood_use_latewood_bump,e.wood_latewood_bump_depth.value=t.wood_latewood_bump_depth,e.wood_use_groove_roughness.value=t.wood_use_groove_roughness,e.wood_groove_roughness.value=t.wood_groove_roughness,e.wood_diffuse_lobe_weight.value=t.wood_diffuse_lobe_weight,n(e,t,"wood_curly_distortion_map"),null!=e.wood_curly_distortion_map.value&&(e.wood_curly_distortion_map.value.minFilter=a.NearestFilter,e.wood_curly_distortion_map.value.magFilter=a.NearestFilter,e.wood_curly_distortion_enable.value=t.wood_curly_distortion_enable,e.wood_curly_distortion_scale.value=t.wood_curly_distortion_scale);var r=1-t.wood_latewood_ratio,o=t.wood_earlywood_sharpness*r,s=t.wood_latewood_sharpness*t.wood_latewood_ratio,l=r+s;e.wood_ring_fraction.value=new a.Vector4(r,o,s,l),e.wood_fall_rise.value=new a.Vector2(r-o,t.wood_latewood_ratio-s);break;default:a.warn("Unknown prism type: "+t.prismType)}t.useTiling&&(e.tilingOverallTransform.value=t.tilingOverallTransform,e.TilingMap.value=t.TilingMap,e.TilingMap_texMatrix.value=t.TilingMap_texMatrix,t.hasRoundCorner&&(e.TilingNormalMap.value=t.TilingNormalMap,e.TilingNormalMap_texMatrix.value=t.TilingNormalMap_texMatrix),t.useRandomOffset&&(e.TilingRandomMap.value=t.TilingRandomMap,e.TilingRandomMap_texMatrix.value=t.TilingRandomMap_texMatrix,e.tilingRandomAxisS.value=t.tilingRandomAxisS,e.tilingRandomAxisT.value=t.tilingRandomAxisT,e.tilingRandomAlignmentOffset.value=t.tilingRandomAlignmentOffset),e.uv2tile.value=t.uv2tile,e.tile2uv.value=t.tile2uv,e.tileAlignOffset.value=t.tileAlignOffset,e.tilingUVTransform.value=t.tilingUVTransform);e.envExponentMin.value=t.envExponentMin,e.envExponentMax.value=t.envExponentMax,e.envExponentCount.value=t.envExponentCount}(f,i),wt(f,i)),i.wideLines){var v=o.geometry.lineWidth;void 0!==i.linewidth&&(v=i.linewidth),f.view_size.value=new a.Vector2(window.innerWidth/v,window.innerHeight/v)}r.ShadowRender&&i.shadowMap&&r.ShadowRender.RefreshUniformsShadow(f,i);var _=f.cutplanes;i.cutplanes&&i.cutplanes.length>0&&_&&(_.value=i.cutplanes,_._array&&_._array.length!=4*i.cutplanes&&(_._array=void 0)),i.hatchParams&&f.hatchParams&&(f.hatchParams.value.copy(i.hatchParams),f.hatchTintColor.value.copy(i.hatchTintColor),f.hatchTintIntensity.value=i.hatchTintIntensity),function(e){for(var t,n,i,r=0,o=e.length;r<o;r++){var s=e[r][0];if(!1!==s.needsUpdate&&!s.perObject){var l,c,u=s.type,h=s.value,d=e[r][1];switch(u){case"1i":P.uniform1i(d,h);break;case"1f":P.uniform1f(d,h);break;case"2f":P.uniform2f(d,h[0],h[1]);break;case"3f":P.uniform3f(d,h[0],h[1],h[2]);break;case"4f":P.uniform4f(d,h[0],h[1],h[2],h[3]);break;case"1iv":P.uniform1iv(d,h);break;case"3iv":P.uniform3iv(d,h);break;case"1fv":P.uniform1fv(d,h);break;case"2fv":P.uniform2fv(d,h);break;case"3fv":P.uniform3fv(d,h);break;case"4fv":P.uniform4fv(d,h);break;case"Matrix3fv":P.uniformMatrix3fv(d,!1,h);break;case"Matrix4fv":P.uniformMatrix4fv(d,!1,h);break;case"i":P.uniform1i(d,h);break;case"f":P.uniform1f(d,h);break;case"v2":P.uniform2f(d,h.x,h.y);break;case"v3":P.uniform3f(d,h.x,h.y,h.z);break;case"v4":P.uniform4f(d,h.x,h.y,h.z,h.w);break;case"c":P.uniform3f(d,h.r,h.g,h.b);break;case"iv1":P.uniform1iv(d,h);break;case"iv":P.uniform3iv(d,h);break;case"fv1":P.uniform1fv(d,h);break;case"fv":P.uniform3fv(d,h);break;case"v2v":for(void 0===s._array&&(s._array=new Float32Array(2*h.length)),l=0,c=h.length;l<c;l++)i=2*l,s._array[i]=h[l].x,s._array[i+1]=h[l].y;P.uniform2fv(d,s._array);break;case"v3v":for(void 0===s._array&&(s._array=new Float32Array(3*h.length)),l=0,c=h.length;l<c;l++)i=3*l,s._array[i]=h[l].x,s._array[i+1]=h[l].y,s._array[i+2]=h[l].z;P.uniform3fv(d,s._array);break;case"v4v":for(void 0===s._array&&(s._array=new Float32Array(4*h.length)),l=0,c=h.length;l<c;l++)i=4*l,s._array[i]=h[l].x,s._array[i+1]=h[l].y,s._array[i+2]=h[l].z,s._array[i+3]=h[l].w;P.uniform4fv(d,s._array);break;case"m3":P.uniformMatrix3fv(d,!1,h.elements);break;case"m3v":for(void 0===s._array&&(s._array=new Float32Array(9*h.length)),l=0,c=h.length;l<c;l++)h[l].flattenToArrayOffset(s._array,9*l);P.uniformMatrix3fv(d,!1,s._array);break;case"m4":P.uniformMatrix4fv(d,!1,h.elements);break;case"m4v":for(void 0===s._array&&(s._array=new Float32Array(16*h.length)),l=0,c=h.length;l<c;l++)h[l].flattenToArrayOffset(s._array,16*l);P.uniformMatrix4fv(d,!1,s._array);break;case"t":if(t=h,n=Tt(),P.uniform1i(d,n),!t){P.activeTexture(P.TEXTURE0+n),P.bindTexture(P.TEXTURE_2D,_e.__webglTexture);continue}Array.isArray(t.image)&&6===t.image.length||t instanceof a.CubeTexture?t.needsUpdate?Lt(t,n):(P.activeTexture(P.TEXTURE0+n),P.bindTexture(P.TEXTURE_CUBE_MAP,t.__webglTextureCube)):t instanceof a.WebGLRenderTargetCube?Rt(t,n):I.setTexture(t,n);break;case"tv":for(void 0===s._array&&(s._array=[]),l=0,c=s.value.length;l<c;l++)s._array[l]=Tt();for(P.uniform1iv(d,s._array),l=0,c=s.value.length;l<c;l++)t=s.value[l],n=s._array[l],t&&I.setTexture(t,n);break;default:a.warn("THREE.WebGLRenderer: Unknown uniform type: "+u)}}}}(i.uniformsList)}if(function(e,t,n){T.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),P.uniformMatrix4fv(e.modelViewMatrix,!1,T.elements),e.normalMatrix&&(M.getNormalMatrix(T),P.uniformMatrix3fv(e.normalMatrix,!1,M.elements))}(d,o,e),null!==d.modelMatrix&&P.uniformMatrix4fv(d.modelMatrix,!1,o.matrixWorld.elements),d.modelId){d.dbId&&(u=o.dbId||o.fragId||0,P.uniform3f(d.dbId,(255&u)/255,(u>>8&255)/255,(u>>16&255)/255));var b=o.modelId;P.uniform3f(d.modelId,(255&b)/255,(b>>8&255)/255,(u>>24&255)/255)}else null!==d.dbId&&(u=o.dbId||o.fragId||0,P.uniform3f(d.dbId,(255&u)/255,(u>>8&255)/255,(u>>16&255)/255));if(d.themingColor){var x=o.themingColor;x instanceof a.Vector4?P.uniform4f(d.themingColor,x.x,x.y,x.z,x.w):P.uniform4f(d.themingColor,0,0,0,0)}return h}function xt(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function wt(e,t){e.envMap&&(e.envMap.value=t.envMap),e.irradianceMap&&(e.irradianceMap.value=t.irradianceMap),e.envMapExposure&&(e.envMapExposure.value=t.envMapExposure),e.envRotationSin&&e.envRotationCos&&(e.envRotationSin.value=t.envRotationSin,e.envRotationCos.value=t.envRotationCos)}function At(e,t){e.envMap&&(e.envMap.needsUpdate=t),e.irradianceMap&&(e.irradianceMap.needsUpdate=t),e.envMapExposure&&(e.envMapExposure.needsUpdate=t)}function Et(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function Tt(){var e=H;return e>=le&&a.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+le),H+=1,e}function Mt(e,t,n,i){e[t]=n.r*i,e[t+1]=n.g*i,e[t+2]=n.b*i}function St(e){var t,n,i,r,o,s,l,c,u=0,h=0,d=0,f=te,p=f.directional.colors,m=f.directional.positions,g=f.point.colors,v=f.point.positions,y=f.point.distances,_=f.spot.colors,b=f.spot.positions,x=f.spot.distances,w=f.spot.directions,A=f.spot.anglesCos,E=f.spot.exponents,T=f.hemi.skyColors,M=f.hemi.groundColors,S=f.hemi.positions,C=0,P=0,L=0,R=0,D=0,I=0,O=0,N=0,k=0,V=0,F=0,B=0;for(t=0,n=e.length;t<n;t++)if(!(i=e[t]).onlyShadow)if(r=i.color,l=i.intensity,c=i.distance,i instanceof a.AmbientLight){if(!i.visible)continue;u+=r.r,h+=r.g,d+=r.b}else if(i instanceof a.DirectionalLight){if(D+=1,!i.visible)continue;$.setFromMatrixPosition(i.matrixWorld),J.setFromMatrixPosition(i.target.matrixWorld),$.sub(J),$.normalize(),m[k=3*C]=$.x,m[k+1]=$.y,m[k+2]=$.z,Mt(p,k,r,l),C+=1}else if(i instanceof a.PointLight){if(I+=1,!i.visible)continue;Mt(g,V=3*P,r,l),J.setFromMatrixPosition(i.matrixWorld),v[V]=J.x,v[V+1]=J.y,v[V+2]=J.z,y[P]=c,P+=1}else if(i instanceof a.SpotLight){if(O+=1,!i.visible)continue;Mt(_,F=3*L,r,l),J.setFromMatrixPosition(i.matrixWorld),b[F]=J.x,b[F+1]=J.y,b[F+2]=J.z,x[L]=c,$.copy(J),J.setFromMatrixPosition(i.target.matrixWorld),$.sub(J),$.normalize(),w[F]=$.x,w[F+1]=$.y,w[F+2]=$.z,A[L]=Math.cos(i.angle),E[L]=i.exponent,L+=1}else if(i instanceof a.HemisphereLight){if(N+=1,!i.visible)continue;$.setFromMatrixPosition(i.matrixWorld),$.normalize(),S[B=3*R]=$.x,S[B+1]=$.y,S[B+2]=$.z,o=i.color,s=i.groundColor,Mt(T,B,o,l),Mt(M,B,s,l),R+=1}for(t=3*C,n=Math.max(p.length,3*D);t<n;t++)p[t]=0;for(t=3*P,n=Math.max(g.length,3*I);t<n;t++)g[t]=0;for(t=3*L,n=Math.max(_.length,3*O);t<n;t++)_[t]=0;for(t=3*R,n=Math.max(T.length,3*N);t<n;t++)T[t]=0;for(t=3*R,n=Math.max(M.length,3*N);t<n;t++)M[t]=0;f.directional.length=C,f.point.length=P,f.spot.length=L,f.hemi.length=R,f.ambient[0]=u,f.ambient[1]=h,f.ambient[2]=d}function Ct(e,t,n){var i;n?(P.texParameteri(e,P.TEXTURE_WRAP_S,It(t.wrapS)),P.texParameteri(e,P.TEXTURE_WRAP_T,It(t.wrapT)),P.texParameteri(e,P.TEXTURE_MAG_FILTER,It(t.magFilter)),P.texParameteri(e,P.TEXTURE_MIN_FILTER,It(t.minFilter))):(P.texParameteri(e,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(e,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),t.wrapS===a.ClampToEdgeWrapping&&t.wrapT===a.ClampToEdgeWrapping||a.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),P.texParameteri(e,P.TEXTURE_MAG_FILTER,Dt(t.magFilter)),P.texParameteri(e,P.TEXTURE_MIN_FILTER,Dt(t.minFilter)),t.minFilter!==a.NearestFilter&&t.minFilter!==a.LinearFilter&&a.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")),(i=re.get("EXT_texture_filter_anisotropic"))&&t.type!==a.FloatType&&t.type!==a.HalfFloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(P.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,I.getMaxAnisotropy())),t.__oldAnisotropy=t.anisotropy)}function Pt(e,t){if(e.width<=t&&e.height<=t)return e;var n=Math.max(e.width,e.height),i=Math.floor(e.width*t/n),r=Math.floor(e.height*t/n),o=document.createElement("canvas");return o.width=i,o.height=r,o.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i,r),o}function Lt(e,t){if(6===e.image.length)if(e.needsUpdate){e.__webglTextureCube||(e.addEventListener("dispose",Le),e.__webglTextureCube=P.createTexture(),I.info.memory.textures++),P.activeTexture(P.TEXTURE0+t),P.bindTexture(P.TEXTURE_CUBE_MAP,e.__webglTextureCube),P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,e.flipY);var n,i=e instanceof a.CompressedTexture,r=e.image[0]instanceof a.DataTexture,o=[];for(n=0;n<6;n++)!I.autoScaleCubemaps||i||r?o[n]=r?e.image[n].image:e.image[n]:o[n]=Pt(e.image[n],he);var s=o[0],l=a.Math.isPowerOfTwo(s.width)&&a.Math.isPowerOfTwo(s.height),c=It(e.format),u=It(e.type);for(Ct(P.TEXTURE_CUBE_MAP,e,l),n=0;n<6;n++)if(i)for(var h,d=o[n].mipmaps,f=0,p=d.length;f<p;f++)h=d[f],e.format!==a.RGBAFormat&&e.format!==a.RGBFormat?we().indexOf(c)>-1?P.compressedTexImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+n,f,c,h.width,h.height,0,h.data):a.warn("Attempt to load unsupported compressed texture format"):P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+n,f,c,h.width,h.height,0,c,u,h.data);else r?P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,c,o[n].width,o[n].height,0,c,u,o[n].data):P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,c,c,u,o[n]);e.generateMipmaps&&l&&P.generateMipmap(P.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else P.activeTexture(P.TEXTURE0+t),P.bindTexture(P.TEXTURE_CUBE_MAP,e.__webglTextureCube)}function Rt(e,t){P.activeTexture(P.TEXTURE0+t),P.bindTexture(P.TEXTURE_CUBE_MAP,e.__webglTexture)}function Dt(e){return e===a.NearestFilter||e===a.NearestMipMapNearestFilter||e===a.NearestMipMapLinearFilter?P.NEAREST:P.LINEAR}function It(e){var t;if(e===a.RepeatWrapping)return P.REPEAT;if(e===a.ClampToEdgeWrapping)return P.CLAMP_TO_EDGE;if(e===a.MirroredRepeatWrapping)return P.MIRRORED_REPEAT;if(e===a.NearestFilter)return P.NEAREST;if(e===a.NearestMipMapNearestFilter)return P.NEAREST_MIPMAP_NEAREST;if(e===a.NearestMipMapLinearFilter)return P.NEAREST_MIPMAP_LINEAR;if(e===a.LinearFilter)return P.LINEAR;if(e===a.LinearMipMapNearestFilter)return P.LINEAR_MIPMAP_NEAREST;if(e===a.LinearMipMapLinearFilter)return P.LINEAR_MIPMAP_LINEAR;if(e===a.UnsignedByteType)return P.UNSIGNED_BYTE;if(e===a.UnsignedShort4444Type)return P.UNSIGNED_SHORT_4_4_4_4;if(e===a.UnsignedShort5551Type)return P.UNSIGNED_SHORT_5_5_5_1;if(e===a.UnsignedShort565Type)return P.UNSIGNED_SHORT_5_6_5;if(e===a.ByteType)return P.BYTE;if(e===a.ShortType)return P.SHORT;if(e===a.UnsignedShortType)return P.UNSIGNED_SHORT;if(e===a.IntType)return P.INT;if(e===a.UnsignedIntType)return P.UNSIGNED_INT;if(e===a.FloatType)return P.FLOAT;if(e===a.HalfFloatType)return 36193;if(e===a.AlphaFormat)return P.ALPHA;if(e===a.RGBFormat)return P.RGB;if(e===a.RGBAFormat)return P.RGBA;if(e===a.LuminanceFormat)return P.LUMINANCE;if(e===a.LuminanceAlphaFormat)return P.LUMINANCE_ALPHA;if(e===a.AddEquation)return P.FUNC_ADD;if(e===a.SubtractEquation)return P.FUNC_SUBTRACT;if(e===a.ReverseSubtractEquation)return P.FUNC_REVERSE_SUBTRACT;if(e===a.ZeroFactor)return P.ZERO;if(e===a.OneFactor)return P.ONE;if(e===a.SrcColorFactor)return P.SRC_COLOR;if(e===a.OneMinusSrcColorFactor)return P.ONE_MINUS_SRC_COLOR;if(e===a.SrcAlphaFactor)return P.SRC_ALPHA;if(e===a.OneMinusSrcAlphaFactor)return P.ONE_MINUS_SRC_ALPHA;if(e===a.DstAlphaFactor)return P.DST_ALPHA;if(e===a.OneMinusDstAlphaFactor)return P.ONE_MINUS_DST_ALPHA;if(e===a.DstColorFactor)return P.DST_COLOR;if(e===a.OneMinusDstColorFactor)return P.ONE_MINUS_DST_COLOR;if(e===a.SrcAlphaSaturateFactor)return P.SRC_ALPHA_SATURATE;if(null!==(t=re.get("WEBGL_compressed_texture_s3tc"))){if(e===a.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===a.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===a.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===a.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=re.get("WEBGL_compressed_texture_pvrtc"))){if(e===a.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===a.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===a.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===a.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=re.get("EXT_blend_minmax"))){if(e===a.MinEquation)return t.MIN_EXT;if(e===a.MaxEquation)return t.MAX_EXT}return 0}this.setFaceCulling=function(e,t){e===a.CullFaceNone?P.disable(P.CULL_FACE):(t===a.FrontFaceDirectionCW?P.frontFace(P.CW):P.frontFace(P.CCW),e===a.CullFaceBack?P.cullFace(P.BACK):e===a.CullFaceFront?P.cullFace(P.FRONT):P.cullFace(P.FRONT_AND_BACK),P.enable(P.CULL_FACE))},this.setMaterialFaces=function(e){ie.setDoubleSided(e.side===a.DoubleSide),ie.setFlipSided(e.side===a.BackSide)},this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",Le),e.__webglTexture=P.createTexture(),I.info.memory.textures++),P.bindTexture(P.TEXTURE_2D,e.__webglTexture),P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,e.flipY),P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),P.pixelStorei(P.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=Pt(e.image,ue);var t=e.image,n=a.Math.isPowerOfTwo(t.width)&&a.Math.isPowerOfTwo(t.height),i=It(e.format),r=It(e.type);Ct(P.TEXTURE_2D,e,n);var o,s,l,c=e.mipmaps;if(e instanceof a.DataTexture)if(c.length>0&&n){for(s=0,l=c.length;s<l;s++)o=c[s],P.texImage2D(P.TEXTURE_2D,s,i,o.width,o.height,0,i,r,o.data);e.generateMipmaps=!1}else P.texImage2D(P.TEXTURE_2D,0,i,t.width,t.height,0,i,r,t.data);else if(e instanceof a.CompressedTexture){for(s=0,l=c.length;s<l;s++)o=c[s],e.format!==a.RGBAFormat&&e.format!==a.RGBFormat?we().indexOf(i)>-1?P.compressedTexImage2D(P.TEXTURE_2D,s,i,o.width,o.height,0,o.data):a.warn("Attempt to load unsupported compressed texture format"):P.texImage2D(P.TEXTURE_2D,s,i,o.width,o.height,0,i,r,o.data);if(c.length>1&&we().indexOf(i)>-1)for(var u,h=o.width>>1,d=o.height>>1,f=c.length;h>=1||d>=1;)u=4==o.width&&4==o.height?o.data:new DataView(o.data.buffer,o.data.byteOffset,o.data.byteLength*(Math.max(h,4)*Math.max(d,4))/(o.width*o.height)),P.compressedTexImage2D(P.TEXTURE_2D,f,i,Math.max(h,1),Math.max(d,1),0,u),h>>=1,d>>=1,++f}else if(c.length>0&&n){for(s=0,l=c.length;s<l;s++)P.texImage2D(P.TEXTURE_2D,s,i,i,r,c[s]);e.generateMipmaps=!1}else P.texImage2D(P.TEXTURE_2D,0,i,i,r,e.image);e.generateMipmaps&&n&&P.generateMipmap(P.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()},this.setTexture=function(e,t){P.activeTexture(P.TEXTURE0+t),e.needsUpdate?I.uploadTexture(e):e.__webglTexture?P.bindTexture(P.TEXTURE_2D,e.__webglTexture):P.bindTexture(P.TEXTURE_2D,_e.__webglTexture)},I.uploadTexture(_e),this.initFrameBufferMRT=function(e,t){var n,i=e[0],r=!1;i&&!i.__webglFramebuffer&&(void 0===i.depthBuffer&&(i.depthBuffer=!0),void 0===i.stencilBuffer&&(i.stencilBuffer=!0),i.__webglFramebuffer=P.createFramebuffer(),P.bindFramebuffer(P.FRAMEBUFFER,i.__webglFramebuffer),i.shareDepthFrom?n=i.__webglRenderbuffer=i.shareDepthFrom.__webglRenderbuffer:(n=i.__webglRenderbuffer,i.depthBuffer&&!i.stencilBuffer?(n||(n=i.__webglRenderbuffer=P.createRenderbuffer()),P.bindRenderbuffer(P.RENDERBUFFER,n),P.renderbufferStorage(P.RENDERBUFFER,P.DEPTH_COMPONENT16,i.width,i.height)):i.depthBuffer&&i.stencilBuffer&&(n||(n=i.__webglRenderbuffer=P.createRenderbuffer()),P.bindRenderbuffer(P.RENDERBUFFER,n),P.renderbufferStorage(P.RENDERBUFFER,P.DEPTH_STENCIL,i.width,i.height))),i.depthBuffer&&!i.stencilBuffer?P.framebufferRenderbuffer(P.FRAMEBUFFER,P.DEPTH_ATTACHMENT,P.RENDERBUFFER,n):i.depthBuffer&&i.stencilBuffer&&P.framebufferRenderbuffer(P.FRAMEBUFFER,P.DEPTH_STENCIL_ATTACHMENT,P.RENDERBUFFER,n),r=!0);var o,s=k;for(P.bindFramebuffer(P.FRAMEBUFFER,i.__webglFramebuffer),o=0;o<e.length;o++){var l=e[o];if(l&&!l.__webglTexture){var c=a.Math.isPowerOfTwo(l.width)&&a.Math.isPowerOfTwo(l.height),u=It(l.format),h=It(l.type);l.addEventListener("dispose",Re),l.__webglTexture=P.createTexture(),I.info.memory.textures++,P.bindTexture(P.TEXTURE_2D,l.__webglTexture),Ct(P.TEXTURE_2D,l,c),P.texImage2D(P.TEXTURE_2D,0,u,l.width,l.height,0,u,h,null),c&&l.generateMipmaps&&P.generateMipmap(P.TEXTURE_2D)}P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0+o,P.TEXTURE_2D,l&&l.__webglTexture,0)}if(this.supportsMRT()){for(var d=P.getParameter(L.MAX_COLOR_ATTACHMENTS_WEBGL);o<d;)P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0+o,P.TEXTURE_2D,null,0),o++;var f=[L.COLOR_ATTACHMENT0_WEBGL];for(o=1;o<e.length;o++)f.push(L.COLOR_ATTACHMENT0_WEBGL+o);L.drawBuffersWEBGL(f)}if(t){var p=P.checkFramebufferStatus(P.FRAMEBUFFER);p!==P.FRAMEBUFFER_COMPLETE&&(a.log("Can't use multiple render targets. Falling back to two passes. "+p),s===i.__webglFramebuffer&&(s=k=null),P.bindFramebuffer(P.FRAMEBUFFER,s),P.deleteFramebuffer(i.__webglFramebuffer),delete i.__webglFramebuffer,t=!1)}return P.bindFramebuffer(P.FRAMEBUFFER,s),r&&(P.bindTexture(P.TEXTURE_2D,null),P.bindRenderbuffer(P.RENDERBUFFER,null),P.bindFramebuffer(P.FRAMEBUFFER,null)),t},this.setRenderTarget=function(e){var t,n,i,r,o,a;if(Array.isArray(e))this.initFrameBufferMRT(e),t=e[0];else if(e){var s=e.__webglFramebuffer;s&&k===s||this.initFrameBufferMRT([e]),t=e}!t||Te?(i=X,r=q,o=W,a=j):(i=t.width,r=t.height,o=0,a=0),(n=t?t.__webglFramebuffer:null)!==k&&(P.bindFramebuffer(P.FRAMEBUFFER,n),P.viewport(o,a,i,r),k=n)},this.verifyMRTWorks=function(e){return!!this.supportsMRT()&&this.initFrameBufferMRT(e,!0)},this.readRenderTargetPixels=function(e,t,n,i,r,o){if(e instanceof a.WebGLRenderTarget){if(e.__webglFramebuffer){if(e.format!==a.RGBAFormat&&e.format!==a.RGBFormat||e.type!==a.UnsignedByteType)return void a.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not a readable format.");var s=!1;e.__webglFramebuffer!==k&&(P.bindFramebuffer(P.FRAMEBUFFER,e.__webglFramebuffer),s=!0),e.canReadPixels||P.checkFramebufferStatus(P.FRAMEBUFFER)===P.FRAMEBUFFER_COMPLETE?P.readPixels(t,n,i,r,P.RGBA,P.UNSIGNED_BYTE,o):a.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),s&&P.bindFramebuffer(P.FRAMEBUFFER,k)}}else a.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}}},function(e,t,n){"use strict";n.r(t),n.d(t,"FloatToHalf",function(){return s}),n.d(t,"HalfToFloat",function(){return l}),n.d(t,"HALF_INT_MAX",function(){return c}),n.d(t,"IntToHalf",function(){return u}),n.d(t,"HalfToInt",function(){return h}),n.d(t,"HalfTest",function(){return d});var i=new Float32Array(1),r=new Uint32Array(i.buffer),o=new Uint16Array(1),a=new Uint16Array(1),s=function(e){i[0]=e;var t=r[0],n=0;if(0==(2147483647&t))a[n++]=t>>16;else{var s=2147483648&t,l=2139095040&t,c=8388607&t;if(0===l)a[n++]=s>>16;else if(2139095040==l)a[n++]=0===c?s>>16|31744:65024;else{var u,h,d=s>>16,f=(0|l>>23)-127+15;f>=31?a[n++]=s>>16|31744:f<=0?(14-f>24?u=0:(u=(c|=8388608)>>14-f,o[0]=u,u=o[0],c>>13-f&1&&(u+=1)),a[n++]=d|u):(h=f<<10,o[0]=h,h=o[0],u=c>>13,o[0]=u,u=o[0],a[n++]=4096&c?1+(d|h|u):d|h|u)}}return a[0]},l=function(e){var t,n=65535&e;if(0==(32767&n))t=n<<16;else{var o=32768&n,a=31744&n,s=1023&n;if(0===a){var l=-1;do{l++,s<<=1}while(0==(1024&s));var c=o<<16,u=(a<<16>>26)-15+127-l,h=u<<23,d=(1023&s)<<13;t=c|h|d}else t=31744==a?0===s?o<<16|2139095040:4290772992:(c=o<<16)|(h=(u=(a<<16>>26)-15+127)<<23)|(d=s<<13)}return r[0]=t,i[0]},c=59390,u=function(e){if(e>c-1||e<0)return console.log("out of range"),s(NaN);if(0===e)return 0;var t=!1;e>c/2-1&&(t=!0,e-=c/2-1);var n=0|Math.abs(e/1024),i=Math.pow(2,n-13),r=i+(e-1024*n)*i/1024;return t&&(r=-r),s(r)},h=function(e){if(0===e)return 0;var t=l(e),n=!1;t<0&&(n=!0,t=-t);var i=0|Math.floor(Math.log(t)/Math.log(2)),r=Math.pow(2,i),o=(t-r)/r*1024+1024*(i+13);return n&&(o+=c/2-1),o},d=function(){for(var e=[-1/255,-.17,-75,-1789,-.005],t=0;t<e.length;t++)console.log("input",e[t],"encoded",s(e[t]),"decoded",l(s(e[t])));for(t=0;t<c;t++){var n=h(u(t));n!==t&&console.log("Roundtrip failed for",t,n)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"UnifiedCamera",function(){return r});var i=n(0);function r(e,t){i.Camera.call(this),this.fov=45,this.near=.1,this.far=1e5,this.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.clientWidth=e,this.clientHeight=t,this.target=new i.Vector3(0,0,-1),this.worldup=new i.Vector3(0,1,0),this.orthographicCamera=new i.OrthographicCamera(this.left,this.right,this.top,this.bottom,this.near,this.far),this.perspectiveCamera=new i.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this.zoom=1,this.toPerspective()}r.ORTHO_FOV=2*Math.atan(.5)*180/Math.PI,r.prototype=Object.create(i.Camera.prototype),r.prototype.clone=function(){var e=new r(2*this.right,2*this.top);return i.Camera.prototype.clone.call(this,e),e.position.copy(this.position),e.up.copy(this.up),this.target&&(e.target=this.target.clone()),this.worldup&&(e.worldup=this.worldup.clone()),this.worldUpTransform&&(e.worldUpTransform=this.worldUpTransform.clone()),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.fov=this.fov,e.aspect=this.aspect,e.zoom=this.zoom,e.clientWidth=this.clientWidth,e.clientHeight=this.clientHeight,e.isPerspective=this.isPerspective,this.updateProjectionMatrix(),e},r.prototype.__computeFovPosition=function(e){if(Math.abs(this.fov-e)<=1e-4)return this.position.clone();var t,n,r=this.target.clone().sub(this.position),o=r.clone().normalize(),a=i.Math.degToRad(this.fov),s=i.Math.degToRad(e),l=Math.tan(.5*a)/Math.tan(.5*s);this.pivot?(t=(new i.Plane).setFromNormalAndCoplanarPoint(o.clone().negate(),this.pivot).distanceToPoint(this.position),n=o.clone().multiplyScalar(t).add(this.position)):(t=r.length(),n=this.target);t*=l;var c=o.multiplyScalar(-t);return n.clone().add(c)},r.prototype.toPerspective=function(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov),this.perspectiveCamera.aspect=this.aspect,this.perspectiveCamera.near=this.near,this.perspectiveCamera.far=this.far,this.perspectiveCamera.fov=this.fov/this.zoom,this.perspectiveCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspectiveCamera.projectionMatrix,this.isPerspective=!0},r.prototype.toOrthographic=function(){if(this.isPerspective){this.saveFov=this.fov;var e=r.ORTHO_FOV;this.position.copy(this.__computeFovPosition(e)),this.fov=e}this.orthoScale=this.target.clone().sub(this.position).length();var t=.5*this.orthoScale,n=t*this.aspect;this.left=this.orthographicCamera.left=-n,this.right=this.orthographicCamera.right=n,this.top=this.orthographicCamera.top=t,this.bottom=this.orthographicCamera.bottom=-t,this.orthographicCamera.near=this.near,this.orthographicCamera.far=this.far,this.orthographicCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthographicCamera.projectionMatrix,this.isPerspective=!1},r.prototype.updateProjectionMatrix=function(){this.isPerspective?this.toPerspective():this.toOrthographic()},r.prototype.setSize=function(e,t){this.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},r.prototype.setFov=function(e){this.fov=e,this.updateProjectionMatrix()},r.prototype.setLens=function(e,t){void 0===t&&(t=24);var n=2*i.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(n),n}},function(e,t,n){"use strict";n.r(t);var i=n(1),r=n(29),o=n(7),a=n(3),s=n(11),l=n(0),c=n(22),u=n(223),h=n.n(u),d=n(224),f=n.n(d),p={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:h.a,fragmentShader:f.a},m=n(31),g=n(225),v=n.n(g),y=n(226),_=n.n(y),b={uniforms:{color:{type:"v4",value:new l.Vector4(0,0,0,.3)},cutplanes:{type:"v4v",value:[]}},vertexShader:v.a,fragmentShader:_.a},x=n(85),w=n(36),A=n.n(w),E=n(227),T=n.n(E),M={uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new l.Vector2(512,512)},resolution:{type:"v2",value:new l.Vector2(1/512,1/512)},axis:{type:"v2",value:new l.Vector2(1,0)},radius:{type:"f",value:50}},vertexShader:A.a,fragmentShader:T.a},S=n(158),C=n.n(S),P=n(228),L=n.n(P),R=n(229),D=n.n(R),I={uniforms:{tDiffuse:{type:"t",value:null},cameraNear:{type:"f",value:1},cameraInvNearFar:{type:"f",value:100},resolution:{type:"v2",value:new l.Vector2(1/512,1/512)}},vertexShader:C.a,fragmentShader:L.a},O={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new l.Vector2(1/512,1/512)}},vertexShader:C.a,fragmentShader:D.a},N=n(230),k=n.n(N),V=n(231),F=n.n(V),B={uniforms:{tDiffuse:{type:"t",value:null},uResolution:{type:"v2",value:new l.Vector2(1/1024,1/512)}},vertexShader:k.a,fragmentShader:F.a},U=n(15),z=n(232),G=n.n(z),H={uniforms:l.UniformsUtils.merge([U.ShaderChunks.DepthTextureUniforms,{tDiffuse:{type:"t",value:null},tID:{type:"t",value:null},resolution:{type:"v2",value:new l.Vector2(1/1024,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},tFill:{type:"t",value:null},tPaper:{type:"t",value:null},style:{type:"i",value:0},idEdges:{type:"i",value:1},normalEdges:{type:"i",value:1},depthEdges:{type:"i",value:1},brightness:{type:"f",value:0},contrast:{type:"f",value:0},grayscale:{type:"i",value:0},preserveColor:{type:"i",value:0},levels:{type:"f",value:6},repeats:{type:"f",value:3},rotation:{type:"f",value:0},tGraphite1:{type:"t",value:null},tGraphite2:{type:"t",value:null},tGraphite3:{type:"t",value:null},tGraphite4:{type:"t",value:null},tGraphite5:{type:"t",value:null},tGraphite6:{type:"t",value:null},tGraphite7:{type:"t",value:null},tGraphite8:{type:"t",value:null}}]),vertexShader:A.a,fragmentShader:G.a},W=n(233),j=n.n(W),X={uniforms:l.UniformsUtils.merge([U.ShaderChunks.DepthTextureUniforms,{tDiffuse:{type:"t",value:null},tAO:{type:"t",value:null},useAO:{type:"i",value:0},aoOpacity:{type:"f",value:.625},tOverlay:{type:"t",value:null},useOverlay:{type:"i",value:0},tID:{type:"t",value:null},tID2:{type:"t",value:null},objID:{type:"i",value:0},objIDv4:{type:"v4",value:new l.Vector4(0,0,0,0)},modelIDv2:{type:"v2",value:new l.Vector2(0,0)},highlightIntensity:{type:"f",value:1},resolution:{type:"v2",value:new l.Vector2(1/1024,1/512)},selectionColor:{type:"c",value:new l.Color(0,0,0)},expand2dSelection:{type:"f",value:.5},tCrossFadeTex0:{type:"t",value:null},tCrossFadeTex1:{type:"t",value:null},crossFadeOpacity0:{type:"f",value:0},crossFadeOpacity1:{type:"f",value:0},highlightRange:{type:"i",value:0},objIDStart:{type:"i",value:0},objIDEnd:{type:"i",value:0}}]),vertexShader:A.a,fragmentShader:j.a},q=n(110),Y=n(234),K=n.n(Y),Q={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:A.a,fragmentShader:K.a},Z=n(235),J=n.n(Z),$={uniforms:{color:{type:"v4",value:new l.Vector4(0,0,0,0)}},vertexShader:A.a,fragmentShader:J.a},ee=n(236),te=n.n(ee),ne={uniforms:{tHighlight0:{type:"t",value:null},tHighlight1:{type:"t",value:null},edgeColor:{type:"v4",value:new l.Vector4(1,1,1,1)}},vertexShader:A.a,fragmentShader:te.a},ie=n(237),re=n.n(ie),oe=n(238),ae=n.n(oe),se={uniforms:{color:{type:"v3",value:new l.Vector3(0,0,0)},opacity:{type:"f",value:1}},rawShader:!0,vertexShader:re.a,fragmentShader:ae.a};n.d(t,"RenderContext",function(){return pe});var le={Color:1,Depth:2,ModelId:3,Overlay:4,Post1:5,Post2:6,SSAO:7,PostDisplay:8,Highlight:9},ce=0,ue=1,he=2,de=3,fe=4;function pe(){var e,t,n,u,h,d,f,g,v,y,_,w,A,E,T,S,C,P,L,R,D,N,k,V,F,U,z,G=[],W=!1,j=!1,Y=null,K=[],Z=null,J=!1,ee=!1,te=!1,ie=null,re=null,oe=null,ae=null,pe=null,me=null,ge=null,ve=[],ye=[],_e=0,be=0,xe=0,we=0,Ae=1,Ee=[[],[]],Te=null,Me=null,Se=null,Ce=null,Pe=null,Le=!1,Re=!1,De=new Uint8Array(4),Ie=[0,0],Oe=(new l.Color).setRGB(1,1,1),Ne=(new l.Color).setRGB(0,0,0),ke=new l.Vector4(0,0,0,.3),Ve=new l.Vector4(1,1,1,1),Fe=new l.Vector4(1,1,1,.5),Be=null,Ue=1,ze=!1,Ge=!0,He=!1,We=!1,je=!1,Xe=!1,qe=l.RGBFormat,Ye=l.FloatType,Ke=!1,Qe=null,Ze=!1,Je=0,$e=0,et=0,tt=[.42,0,1,1],nt={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,idbuffer:!0,occlusionid:!0,customPresentPass:!1,postProcShaded:!1,envMapBg:!1,swapBlackAndWhite:!1,numIdTargets:1,renderEdges:!1},it={},rt=null,ot=null,at=!1;function st(e,t,n,i,r){var o=new l.WebGLRenderTarget(e,t,{minFilter:l.NearestFilter,magFilter:l.NearestFilter,format:n,type:i,stencilBuffer:W});return r&&(o.shareDepthFrom=r),o.name="depthTarget",o}function lt(t){try{var n=st(2,2,t.format,t.type);e.setRenderTarget(n);var i=e.context,r=i.checkFramebufferStatus(i.FRAMEBUFFER);return e.setRenderTarget(null),n.dispose(),r===i.FRAMEBUFFER_COMPLETE}catch(e){return!1}}function ct(e){e(t);for(var n=1;n<t.variants.length;n++)e(t.variants[n])}function ut(e){switch(e){case le.Color:return!0;case le.Depth:return Ke&&(nt.sao||nt.postProcShaded);case le.ModelId:return nt.idbuffer||nt.occlusionid;case le.Overlay:return!0;case le.SSAO:return nt.sao;case le.Post1:return nt.antialias||nt.sao||nt.customPresentPass||nt.postProcShaded;case le.Post2:return nt.postProcShaded||nt.customPresentPass;case le.PostDisplay:return nt.antialias&&nt.postProcShaded;case le.Highlight:return!0}}function ht(e,t){var n=new l.WebGLRenderTarget(e,t,{minFilter:l.NearestFilter,magFilter:l.NearestFilter,format:l.RGBAFormat,type:l.UnsignedByteType,stencilBuffer:W});return n.generateMipmaps=!1,n.shareDepthFrom=re,n.canReadPixels=!0,n}function dt(e,t,n,i){return e[t++]=n[i],e[t++]=n[i+1],e[t++]=n[i+2],e[t++]=n[i+3],e[t++]=n[i+1],e[t++]=n[i+2],e[t++]=n[i],e[t++]=n[i+4],e[t++]=n[i+2],e[t++]=n[i+3],e[t++]=n[i+4],e[t++]=n[i+2],e[t++]=n[i],e[t++]=n[i+1],e[t++]=n[i+5],e[t++]=n[i+3],e[t++]=n[i+1],e[t++]=n[i+5],e[t++]=n[i],e[t++]=n[i+4],e[t++]=n[i+5],e[t++]=n[i+3],e[t++]=n[i+4],e[t++]=n[i+5],t}function ft(e,t,n){return e[t++]=n,e[t++]=n+1,e[t++]=n+5,e[t++]=n,e[t++]=n+5,e[t++]=n+4,e[t++]=n,e[t++]=n+2,e[t++]=n+3,e[t++]=n,e[t++]=n+3,e[t++]=n+1,e[t++]=n,e[t++]=n+4,e[t++]=n+6,e[t++]=n,e[t++]=n+6,e[t++]=n+2,e[t++]=n+7,e[t++]=n+6,e[t++]=n+4,e[t++]=n+7,e[t++]=n+4,e[t++]=n+5,e[t++]=n+7,e[t++]=n+5,e[t++]=n+1,e[t++]=n+7,e[t++]=n+1,e[t++]=n+3,e[t++]=n+7,e[t++]=n+3,e[t++]=n+2,e[t++]=n+7,e[t++]=n+2,e[t++]=n+6,t}function pt(e,t,n,i){var r=new Float32Array(24*i),o=new Uint16Array(36*i),a=0,s=0,c=0;for(i+=n;n<i;++n,c+=8)s=ft(o,s,c),a=dt(r,a,e,6*t[n]);var u=new l.BufferGeometry;return u.addAttribute("position",new l.BufferAttribute(r,3)),u.addAttribute("index",new l.BufferAttribute(o,1)),u.streamingDraw=!0,u.streamingIndex=!0,u}function mt(e,t,n,i){for(var r=new Float32Array(3*i),o=new Float32Array(3*i),a=0,s=i+n;n<s;++n){var c=6*t[n];o[a]=e[c+3]-e[c],r[a++]=e[c++],o[a]=e[c+3]-e[c],r[a++]=e[c++],o[a]=e[c+3]-e[c],r[a++]=e[c++]}var u=new l.BufferGeometry;u.addAttribute("position",new l.BufferAttribute(Se,3)),u.addAttribute("index",new l.BufferAttribute(Ce,1));var h=new l.BufferAttribute(r,3);h.divisor=1;var d=new l.BufferAttribute(o,3);return d.divisor=1,u.addAttribute("instOffset",h),u.addAttribute("instScaling",d),u.numInstances=i,u.streamingDraw=!0,u.streamingIndex=!0,u}this.settings=nt,this.init=function(r,s,u,h){var d;(function(){function e(e){e.material.blending=l.NoBlending,e.material.depthWrite=!1,e.material.depthTest=!1}(function(){var e=p;(t=Object(c.createShaderMaterial)(e)).blending=l.NoBlending,t.packedNormals=!0,t.depthWrite=!1;var n={NoCutPlanes:1,Instancing:2,Count:4},i=[];i[0]=null;for(var r=1;r<n.Count;r++){var o=t.clone();r&n.NoCutPlanes&&(o.cutPlanes=null,o.blending=l.NoBlending,o.packedNormals=!0,o.doNotCut=!0),r&n.Instancing&&(o.useInstancing=!0),i[r]=o}t.variants=i,t.getCustomOverrideMaterial=function(e){var t=!e||!e.cutplanes||0==e.cutplanes.length,i=e.useInstancing,r=(t?n.NoCutPlanes:0)|(i?n.Instancing:0);return this.variants[r]}})(),function(){var e=b;(n=Object(c.createShaderMaterial)(e)).depthWrite=!0,n.depthTest=!0,n.isEdgeMaterial=!0,n.transparent=!0,n.blending=l.NormalBlending;var t={Instancing:1,DoNotCut:2,Count:4},i=[];i[0]=null;for(var r=1;r<t.Count;r++){var o=n.clone();o.defines=Object(a.ObjectAssign)({},n.defines),o.isEdgeMaterial=!0,r&t.Instancing&&(o.useInstancing=!0),r&t.DoNotCut&&(o.doNotCut=!0,o.cutplanes=[]),i[r]=o}n.variants=i,n.getCustomOverrideMaterial=function(e){var i=e.useInstancing,r=i?t.Instancing:0;e.doNotCut&&(r|=t.DoNotCut);var o=this.variants[r]||n;return o.uniforms.color.value=We?He?Fe:Ve:ke,o.uniforms.color.needsUpdate=!0,o}}(),e(w=new m.a(x.SAOShader)),e(_=new m.a(M)),e(E=new m.a(I)),e(A=new m.a(O)),e(T=new m.a(B)),e(S=new m.a(H)),e(C=new m.a(X)),e(y=new m.a(q.a)),e(P=new m.a(Q)),e(L=new m.a($)),(R=new m.a(ne)).material.depthWrite=!1,R.material.depthTest=!1,R.material.blending=l.CustomBlending,R.material.blendDst=l.DstAlphaFactor,R.material.blendDstAlpha=l.OneFactor,R.material.blendSrc=l.OneMinusDstAlphaFactor,R.material.blendSrcAlpha=l.OneMinusDstAlphaFactor,R.material.blendEquation=l.AddEquation,R.material.uniforms.edgeColor.value=Ve.clone(),R.material.transparent=!0}(),r)?(ze=Object(a.isMobileDevice)(),nt.idbuffer=!ze,U=s,z=u,W=!!(e=r).context.getContextAttributes().stencil,Re=!!h,(d=(ze?[{format:l.RGBFormat,type:l.HalfFloatType},{format:l.RGBAFormat,type:l.HalfFloatType},{format:l.RGBFormat,type:l.FloatType},{format:l.RGBAFormat,type:l.FloatType}]:[{format:l.RGBFormat,type:l.FloatType},{format:l.RGBAFormat,type:l.FloatType},{format:l.RGBFormat,type:l.HalfFloatType},{format:l.RGBAFormat,type:l.HalfFloatType}]).find(lt))?(Ke=!0,qe=d.format,Ye=d.type):(Ke=!1,i.logger.warn("Depth target is unsupported for this device."))):Object(a.isNodeJS)()||i.logger.error("You need a gl context to make a renderer. Things will go downhill from here.",Object(o.errorCodeString)(o.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED))},this.setDepthMaterialOffset=function(e,t,n){ct(function(i){i.polygonOffset=e,i.polygonOffsetFactor=t,i.polygonOffsetUnits=n,i.extraDepthOffset&&(i.polygonOffsetFactor+=i.extraDepthOffset),i.needsUpdate=!0})},this.overlayUpdate=function(){if(0===$e||-1===$e)return!1;var e=C.uniforms.highlightIntensity.value,t=.004*(performance.now()-Je);t=Math.min(t,1);var n=function(e,t){var n=3*e[1],i=3*(e[3]-e[1])-n;return(((1-n-i)*t+i)*t+n)*t}(tt,t);return e!=n&&(C.uniforms.highlightIntensity.value=n,!0)},this.clearHighlight=function(){if(J=!1,ut(le.Highlight)){e.setClearColor(Ne,0);for(var t=0;t<ve.length;++t)e.clearTarget(ve[t],!0,!1,!1)}},this.setHighlightLights=function(e){f=e},this.beginScene=function(t,n,r,s){if(h=n,v=t.fog,d=r,ee=!1,te=!1,!re&&U)this.initPostPipeline(nt.sao,nt.antialias);else if(!re&&!U)return void(Le||Object(a.isNodeJS)()||(i.logger.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance.",Object(o.errorCodeString)(o.ErrorCodes.VIEWER_INTERNAL_ERROR)),Le=!0));if(s){var c=nt.envMapBg&&!!y.material.envMap;if(Be&&!c){if(nt.swapBlackAndWhite&&at){var u=new l.Color(1,1,1),f=new l.Color(0,0,0);Be.equals(u)?e.setClearColor(f,Ue):Be.equals(f)?e.setClearColor(u,Ue):e.setClearColor(Be,Ue)}else e.setClearColor(Be,Ue);e.clearTarget(re,!0,!0,W)}else y.uniforms.uCamDir.value=h.worldUpTransform?h.getWorldDirection().clone().applyMatrix4(h.worldUpTransform):h.getWorldDirection(),y.uniforms.uCamUp.value=h.worldUpTransform?h.up.clone().applyMatrix4(h.worldUpTransform):h.up,y.uniforms.uResolution.value.set(U,z),y.uniforms.uHalfFovTan.value=Math.tan(l.Math.degToRad(.5*h.fov)),y.uniforms.opacity.value=Ue,e.clearTarget(re,!1,!0,W),y.render(e,re,null);rt&&rt.clearTarget(e);for(var p=0;p<ye.length;p++)e.setClearColor(Oe,1),e.clearTarget(ye[p],!0,!1,!1);this.clearHighlight(),Ze=!1}if(ut(le.Depth)){s&&(e.setClearColor(Ne,0),e.clearTarget(F,!0,!1,!1));var m=n.near,g=n.far;w.uniforms.cameraNear.value=m,w.uniforms.cameraFar.value=g,S.uniforms.cameraNear.value=m,S.uniforms.cameraFar.value=g,E.uniforms.cameraNear.value=m,E.uniforms.cameraInvNearFar.value=1/(m-g);var _=n.projectionMatrix.elements;n.isPerspective?w.uniforms.projInfo.value.set(-2/(re.width*_[0]),-2/(re.height*_[5]),(1-_[8])/_[0],(1+_[9])/_[5]):w.uniforms.projInfo.value.set(-2/(re.width*_[0]),-2/(re.height*_[5]),(1-_[12])/_[0],(1-_[13])/_[5]),S.uniforms.projInfo.value.copy(w.uniforms.projInfo.value);var b=n.isPerspective?0:1;w.uniforms.isOrtho.value=b,S.uniforms.isOrtho.value=b;w.uniforms.projScale.value=re.height*_[5]*.125}nt.sao||(C.uniforms.useAO.value=0),this.renderScenePart(t,!0,!0,!1,0,!0)},this.copyOcclusionIds=function(){return nt.occlusionid&&ye[0]&&Qe?(Ze||e.readRenderTargetPixels(ye[0],0,0,ye[0].width,ye[0].height,Qe),Qe):null},this.renderScenePart=function(i,o,a,s,l,c){s&&nt.occlusionid&&ye[0]&&Qe&&i instanceof r.RenderBatch&&(Ze=!1);var p,m,y=re,_=F;if(rt&&(y=rt.chooseColorTarget(i,y),_=rt.getRenderSao(i)?F:null),ee=!1,te=!1,i.fog=v,j){var b=l?1:0;e.state.buffers.stencil.setFunc(e.context.ALWAYS,b,1)}if(o){if(m=void 0,(c||d!==g)&&(g=m=d),je&&Xe)ut(le.ModelId)&&s&&ut(le.Depth)?e.render(i,h,[y,_].concat(ye),!1,m):ut(le.Depth)?e.render(i,h,[y,_],!1,m):ut(le.ModelId)&&s?e.render(i,h,[y].concat(ye)):e.render(i,h,y,!1,m);else if(Xe)ut(le.ModelId)&&s?e.render(i,h,[y].concat(ye),!1,m):e.render(i,h,y,!1,m),ut(le.Depth)&&a&&!i.sortObjects&&(p=i.overrideMaterial,i.overrideMaterial=t,t.depthWrite!==x&&(t.depthWrite=x,t.needsUpdate=!0),e.render(i,h,_,!1),i.overrideMaterial=p);else{var x=!1;o?e.render(i,h,y,!1,m):x=!0,ut(le.ModelId)&&s&&(u?(p=i.overrideMaterial,i.overrideMaterial=u,e.render(i,h,ye[0],!1),i.overrideMaterial=p):(e.setProgramPrefix(1,"#define ID_COLOR","#define ID_COLOR"),e.render(i,h,ye[0],!1),e.setProgramPrefix(0,"","")),x=!1),ut(le.Depth)&&a&&!i.sortObjects&&(p=i.overrideMaterial,t.depthWrite!==x&&(t.depthWrite=x,t.needsUpdate=!0),i.overrideMaterial=t,e.render(i,h,_,!1),i.overrideMaterial=p)}o&&nt.renderEdges&&(p=i.overrideMaterial,i.overrideMaterial=n,e.context.depthFunc(e.context.LESS),e.render(i,h,[y],!1),e.context.depthFunc(e.context.LEQUAL),i.overrideMaterial=p)}if(l){m=void 0,f!==g&&(g=m=f),p=i.overrideMaterial,We=!0,n.depthWrite=!1;for(var w=0;w<G.length;++w){var A=G[w];l&1<<w&&(J=!0,He=A.renderHidden,n.depthTest=!He,i.overrideMaterial=A.material,e.render(i,h,ve[A.target],!1,m),m=void 0)}We=!1,He=!1,n.depthWrite=!0,n.depthTest=!0,i.overrideMaterial=p}};var gt=[[0,1,1],[1,0,1],[1,1,0],[1,1,1]],vt=[1,1,1,0];var yt={};function _t(){var t=ae,n=re;if(C.uniforms.useAO.value){var i=function(){var e=[C.uniforms.useOverlay.value,C.uniforms.highlightRange.value,C.uniforms.objID.value];return C.uniforms.useOverlay.value=0,C.uniforms.highlightRange.value=0,C.uniforms.objID.value=0,e}();C.render(e,t,n),n=t,t=ge,function(e){C.uniforms.useOverlay.value=e[0],C.uniforms.highlightRange.value=e[1],C.uniforms.objID.value=e[2]}(i)}if(S.render(e,t,n),n=t,t=t===ae?ge:ae,C.uniforms.useOverlay.value||C.uniforms.highlightRange.value||C.uniforms.objID.value){i=function(){var e=C.uniforms.useAO.value;return C.uniforms.useAO.value=0,e}();C.render(e,t,n),n=t,function(e){C.uniforms.useAO.value=e}(i)}return n}this.occlusionTest=function(t,n,i,r,o){if(!i||i.length<=0||i.length>4)return Promise.reject({error:"fragIds invalid. Must be a nonempty array of fragment id arrays with length <= 4"});var a=[0,0,0,0],s=0;r=r&&e.supportsInstancedArrays()?1:0,(!Ee[r]||Ee[r].length<i.length)&&function(e,t){for(var n=!!t,i=Ee[t].length;i<e;++i){var r=Object(c.createShaderMaterial)(se);r.useInstancing=n,r.depthWrite=!1,r.uniforms.color.value.set(gt[i][0],gt[i][1],gt[i][2]),r.uniforms.opacity.value=vt[i],r.defaultAttributeValues.instRotate=[1,0,0,0],r.blending=l.CustomBlending,r.blendDst=l.SrcColorFactor,r.blendSrc=l.ZeroFactor,r.blendEquation=l.AddEquation,r.transparent=!0,Ee[t][i]=r}}(i.length,r),r&&!Se&&(Se=new Float32Array(24),ft(Ce=new Uint16Array(36),0,0),dt(Se,0,[0,0,0,1,1,1],0)),Pe||(Pe=new l.Scene),Pe.frustumCulled=!1;var u,d=r?32768:4096;for(u=0;u<i.length;++u){var f=i[u];if(f&&f.length>0){a[u]=n,++s;for(var p,m=Ee[r][u],g=f.length,v=0;v<g;v+=p){p=Math.min(d,g-v);var y=r?mt(t,f,v,p):pt(t,f,v,p),_=new l.Mesh(y,m);_.frustumCulled=!1,Pe.add(_)}}}switch(Te||((Te=new l.WebGLRenderTarget(nt.deviceWidth,nt.deviceHeight,{minFilter:l.NearestFilter,magFilter:l.NearestFilter,format:l.RGBAFormat,stencilBuffer:W})).generateMipmaps=!1,Te.shareDepthFrom=re),e.setClearColor(Oe,1),e.setRenderTarget(Te),e.clear(!0,!1,!1),e.render(Pe,h,Te,!1,null),e.clearBlend(),Pe.children.forEach(function(e){e.geometry.dispose()}),Pe.remove.apply(Pe,Pe.children),(yt[o[0]]||yt[o[1]]||yt[o[2]]||yt[o[3]])&&this.getRenderTargetPixels("occlusion"),Me||(Me=new Uint8Array(4*nt.deviceWidth*nt.deviceHeight)),e.readRenderTargetPixels(Te,0,0,nt.deviceWidth,nt.deviceHeight,Me),i.length){case 1:for(u=Me.length;s>0&&(u-=4)>=0;)Me[u]||(a[0]-=1,s-=!a[0]);return Promise.resolve([a[0]<=0]);case 2:for(u=Me.length;s>0&&(u-=4)>=0;)Me[u]||(a[0]-=1,s-=!a[0]),Me[u+1]||(a[1]-=1,s-=!a[1]);return Promise.resolve([a[0]<=0,a[1]<=0]);case 3:for(u=Me.length;s>0&&(u-=4)>=0;)Me[u]||(a[0]-=1,s-=!a[0]),Me[u+1]||(a[1]-=1,s-=!a[1]),Me[u+2]||(a[2]-=1,s-=!a[2]);return Promise.resolve([a[0]<=0,a[1]<=0,a[2]<=0]);case 4:for(u=Me.length;s>0&&(u-=4)>=0;)Me[u]||(a[0]-=1,s-=!a[0]),Me[u+1]||(a[1]-=1,s-=!a[1]),Me[u+2]||(a[2]-=1,s-=!a[2]),Me[u+3]||(a[3]-=1,s-=!a[3]);return Promise.resolve([a[0]<=0,a[1]<=0,a[2]<=0,a[3]<=0])}},this.setStencilEnabled=function(t){j=W&&t,e.state.buffers.stencil.setTest(t);var n=e.context;e.state.buffers.stencil.setOp(n.KEEP,n.KEEP,t?n.REPLACE:n.KEEP)},this.clearAllOverlays=function(){e.clearTarget(oe,!0,!1,!1)},this.renderOverlays=function(t,i,r){var o=0;for(var a in We=!0,t){var s=t[a],l=s.scene,c=s.camera?s.camera:h;l.children.length&&(o||(o=1,r||(e.setClearColor(Ne,0),e.clearTarget(oe,!0,!1,!1))),s.materialPre&&(l.overrideMaterial=s.materialPre),e.render(l,c,oe,!1,i),s.materialPost&&(He=!0,e.context.depthFunc(e.context.GREATER),nt.renderEdges&&(n.depthWrite=!1,n.depthTest=!1,l.overrideMaterial=n,e.render(l,c,oe,!1)),l.overrideMaterial=s.materialPost,e.render(l,c,oe,!1,i),e.context.depthFunc(e.context.LEQUAL),He=!1),nt.renderEdges&&s.materialPre&&(n.depthWrite=!1,n.depthTest=!0,l.overrideMaterial=n,e.render(l,c,oe,!1)),l.overrideMaterial=null)}if(We=!1,n.depthWrite=!0,n.depthTest=!0,J){o||(o=1,e.setClearColor(Ne,0),e.clearTarget(oe,!0,!1,!1));var u=e.state.buffers.stencil;u.setFunc(e.context.EQUAL,0,1),u.setTest(!0),L.render(e,ve[1],null),u.setTest(!1),R.render(e,oe,null)}C.uniforms.useOverlay.value=o},this.computeSSAO=function(t){if(!t&&nt.sao){if(!ee){if(ie&&ie.length){var n=ie[0];E.uniforms.resolution.value.set(1/n.width,1/n.height),E.render(e,n,F);for(var i=1;i<ie.length;i++){var r=ie[i];A.uniforms.resolution.value.set(1/r.width,1/r.height),A.render(e,r,n),n=r}}w.render(e,me,re),_.uniforms.axis.value.set(1,0),_.render(e,ae,me),_.uniforms.axis.value.set(0,1),_.render(e,me,ae),ee=!0}C.uniforms.useAO.value=1}else C.uniforms.useAO.value=0},this.presentBuffer=function(t){if(e){var n=ot||null;if(!(C.uniforms.useAO.value||C.uniforms.useOverlay.value||rt||0!==$e&&-1!==$e||0!==et&&-1!==et))nt.antialias?t?(T.render(e,ae,re),t.render(e,n,ae)):nt.postProcShaded?(S.render(e,ae,re),P.render(e,pe,ae),T.render(e,n,pe)):T.render(e,n,re):t?t.render(e,n,re):nt.postProcShaded?(S.render(e,ae,re),P.render(e,n,ae)):P.render(e,n,re);else if(nt.antialias)if(t)C.render(e,ae,re),T.render(e,ge,ae),t.render(e,n,ge);else if(nt.postProcShaded){var i=_t();P.render(e,pe,i),T.render(e,n,pe)}else C.render(e,ae,re),T.render(e,n,ae);else if(t)C.render(e,ae,re),t.render(e,n,ae);else if(nt.postProcShaded){i=_t();P.render(e,n,i)}else C.render(e,n,re)}},this.composeFinalFrame=function(e,t){this.computeSSAO(e),t||this.presentBuffer()},this.cleanup=function(){if(e&&e.setRenderTarget(null),re&&(re.dispose(),re=null),F&&(F.dispose(),F=null),oe&&(oe.dispose(),oe=null),rt&&rt.disposeTargets(),ae&&(ae.dispose(),ae=null),me&&(me.dispose(),me=null),ge&&(ge.dispose(),ge=null),ie){for(var t=0;t<ie.length;t++)ie[t].dispose();ie=[]}Te&&(Te.dispose(),Te=null),Me=null},this.postProcessEdgesOn=function(){return 0!==S.uniforms.idEdges.value||0!==S.uniforms.normalEdges.value||0!==S.uniforms.depthEdges.value};var bt=function(){var e=0;oe&&G.forEach(function(t){e=Math.max(e,1+(0|t.target))});for(var t=ve.length,n=Math.max(e,t),i=0;i<n;++i){var r=i<t?ve[i]:null;i>=t?(r=oe.clone(),ve[i]=r,r.name="highlight "+i):i>=e?(r.dispose(),r=null):r.shareDepthFrom!==oe.shareDepthFrom&&(r.dispose(),r=oe.clone(),ve[i]=r,r.name="highlight "+i);var o=R.uniforms["tHighlight"+i];o&&o.value!==r&&(o.value=r,C.material.needsUpdate=!0)}ve.length=e};this.setSize=function(t,n,r,o){if(U=t,z=n,nt.logicalWidth=t,nt.logicalHeight=n,0===t&&0===n||!e)this.cleanup();else{var a,s=0|t*e.getPixelRatio(),c=0|n*e.getPixelRatio();nt.deviceWidth=s,nt.deviceHeight=c,o||(Re?e.setViewport(0,0,t,n):e.setSize(t,n));var u=s,h=c;(nt.useSSAA||nt.postProcShaded&&!ze&&e.getPixelRatio()<=1&&this.postProcessEdgesOn())&&(s*=2,c*=2);var d=1/s,f=1/c;if(!r&&re&&re.width==s&&re.height==c||(i.logger.log("Reallocating render targets."),this.cleanup(),(re=new l.WebGLRenderTarget(s,c,{minFilter:l.LinearFilter,magFilter:l.LinearFilter,format:l.RGBFormat,type:nt.useHdrTarget?l.FloatType:l.UnsignedByteType,stencilBuffer:W})).generateMipmaps=!1,re.name="colorTarget",(oe=new l.WebGLRenderTarget(s,c,{minFilter:l.NearestFilter,magFilter:l.NearestFilter,format:l.RGBAFormat,stencilBuffer:W})).generateMipmaps=!1,oe.name="overlayTarget",oe.shareDepthFrom=re,bt(),F=null,ae=null,pe=null,me=null,ge=null,ie=[]),rt&&rt.updateTargets(s,c,r,nt.useHdrTarget),ut(le.Post1)&&(!r&&ae&&ae.width==s&&ae.height==c||((ae=new l.WebGLRenderTarget(s,c,{minFilter:l.LinearFilter,magFilter:l.LinearFilter,format:l.RGBAFormat,stencilBuffer:!1,depthBuffer:!1})).generateMipmaps=!1,ae.name="postTarget1")),!me&&ut(le.SSAO)&&((me=ae.clone()).name="SSAO target"),!ge&&ut(le.Post2)&&((ge=ae.clone()).name="post target 2"),!pe&&ut(le.PostDisplay)&&((pe=new l.WebGLRenderTarget(u,h,{minFilter:l.LinearFilter,magFilter:l.LinearFilter,format:l.RGBAFormat,stencilBuffer:!1,depthBuffer:!1})).generateMipmaps=!1,pe.name="postTargetNormal"),ut(le.Depth)){if(r||!F||F.width!=s||F.height!=c){F=st(s,c,qe,Ye,re),ie=[];for(var p=0;p<5;p++){var m=0|s/(2<<p),g=0|c/(2<<p),v=null;m>=1&&g>=1&&((v=new l.WebGLRenderTarget(m,g,{minFilter:l.NearestFilter,magFilter:l.NearestFilter,format:l.RGBAFormat,depthBuffer:!1,stencilBuffer:!1})).generateMipmaps=!1,ie.push(v)),w.uniforms["tDepth_mip"+(p+1)].value=v}je=e.verifyMRTWorks([re,F])}w.uniforms.size.value.set(s,c),w.uniforms.resolution.value.set(d,f),w.uniforms.tDepth.value=F,_.uniforms.size.value.set(s,c),_.uniforms.resolution.value.set(d,f),S.uniforms.tDepth.value=F}if(ut(le.ModelId)){if(r||!ye[0]||ye[0].width!=s||ye[0].height!=c){for(a=0;a<ye.length;a++)ye[a]&&ye[a].dispose();for(ye=[],a=0;a<nt.numIdTargets;a++){var y=ht(s,c);y.name="id "+a,ye.push(y)}(Xe=e.verifyMRTWorks([re].concat(ye)))||i.logger.warn("ID buffer requested, but MRT is not supported. Some features will not work."),Qe=new Uint8Array(4*ye[0].width*ye[0].height)}S.uniforms.tID.value=ye[0],S.uniforms.tID.value=ye[0]}else if(ye[0]){for(Qe=null,a=0;a<ye.length;a++)ye[a].dispose(),ye[a]=null;ye.length=0}T.uniforms.uResolution.value.set(d,f),S.uniforms.resolution.value.set(d,f),C.uniforms.tOverlay.value=oe,C.uniforms.tAO.value=me,C.uniforms.useAO.value=nt.sao?1:0,C.uniforms.resolution.value.set(d,f),C.uniforms.tID.value=ye[0]||null,C.uniforms.tID2.value=ye[1]||null,rt&&rt.updateBlendPass()}},this.getMaxAnisotropy=function(){return e?e.getMaxAnisotropy():0},this.mrtFlags=function(){return{mrtNormals:je&&ut(le.Depth),mrtIdBuffer:Xe&&ut(le.ModelId)?nt.numIdTargets:void 0}},this.setIdTargetCount=function(e){if(!(e>2||e<1)&&e!==nt.numIdTargets&&(nt.numIdTargets=e,0!==ye.length&&2===e&&1===ye.length)){var t=ht(ye[0].width,ye[0].height);return t.name="id "+ye.length,ye.push(t),C.uniforms.tID2.value=t,C.material.defines.USE_MODEL_ID="",C.material.needsUpdate=!0,!0}},this.getAntialiasing=function(){return nt.antialias},this.initPostPipeline=function(e,t){nt.sao=e&&!a.isIE11&&Ke,nt.antialias=t&&!a.isIE11,nt.haveTwoSided&&ct(function(e){e.side=l.DoubleSide}),ct(function(e){e.needsUpdate=!0}),w.material.needsUpdate=!0,_.material.needsUpdate=!0,E.material.needsUpdate=!0,A.material.needsUpdate=!0,T.material.needsUpdate=!0,S.material.needsUpdate=!0,C.material.needsUpdate=!0,y.material.needsUpdate=!0,P.material.needsUpdate=!0,this.setSize(U,z)},this.setClearColors=function(e,t){(Be=t?e.equals(t)||ze?new l.Color(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z)):void 0:e.clone())||(y.uniforms.color1.value.copy(e),y.uniforms.color2.value.copy(t))},this.setClearAlpha=function(e){Ue=e},this.setAOEnabled=function(e){nt.sao=e&&Ke,it.sao=nt.sao,this.setSize(U,z,!1,!0)},this.setAOOptions=function(e,t,n){void 0!==e&&(w.uniforms.radius.value=e,w.uniforms.bias.value=Object(a.isMobileDevice)()?.1:.01,_.uniforms.radius.value=e),void 0!==t&&(w.uniforms.intensity.value=t),C.uniforms.aoOpacity.value=void 0!==n?n:1,ee=!1},this.getAOEnabled=function(){return nt.sao},this.getAORadius=function(){return w.uniforms.radius.value},this.getAOIntensity=function(){return w.uniforms.intensity.value},this.setCubeMap=function(e){y.material.envMap=e,e||this.toggleEnvMapBackground(!1),e&&nt.envMapBg&&(y.uniforms.envMapBackground.value=!0)},this.getCubeMap=function(){return y.material.envMap},this.setEnvRotation=function(e){xe=e,y.material.envRotationSin=Math.sin(e),y.material.envRotationCos=Math.cos(e)},this.getEnvRotation=function(){return xe},this.setEnvExposure=function(e){y.uniforms.envMapExposure.value=Math.pow(2,e),y.material.envMapExposure=Math.pow(2,e),y.material.needsUpdate=!0,_e=e},this.setTonemapExposureBias=function(e){be=e,y.uniforms.exposureBias.value=Math.pow(2,e)},this.getExposureBias=function(){return be},this.setCamera=function(e){h=e},this.setTonemapMethod=function(t){we=t,e.gammaInput=0!==t,y.material.tonemapOutput=we,y.material.needsUpdate=!0},this.getToneMapMethod=function(){return we},this.toggleTwoSided=function(e){nt.haveTwoSided!=e&&t&&ct(function(t){t.side=e?l.DoubleSide:l.FrontSide,t.needsUpdate=!0}),nt.haveTwoSided=e},this.toggleEdges=function(e){nt.renderEdges=e,it.renderEdges=e},this.preloadPostProcessStyle=function(e){if(null==e)return this.preloadPostProcessStyle("graphite"),void this.preloadPostProcessStyle("pencil");switch(e){case"graphite":if(void 0===K[0]){l.ImageUtils.crossOrigin="";for(var t=0;t<8;t++){var n=Object(s.getResourceUrl)("res/postprocess/Graphite"+(t+1)+".png");K[t]=l.ImageUtils.loadTexture(n),K[t].wrapS=K[t].wrapT=l.RepeatWrapping}S.uniforms.tGraphite1.value=K[0],S.uniforms.tGraphite2.value=K[1],S.uniforms.tGraphite3.value=K[2],S.uniforms.tGraphite4.value=K[3],S.uniforms.tGraphite5.value=K[4],S.uniforms.tGraphite6.value=K[5],S.uniforms.tGraphite7.value=K[6],S.uniforms.tGraphite8.value=K[7]}break;case"pencil":null===Y&&(l.ImageUtils.crossOrigin="",(Y=l.ImageUtils.loadTexture(Object(s.getResourceUrl)("res/postprocess/ColorPencil_02.png"))).wrapS=Y.wrapT=l.RepeatWrapping,(Z=l.ImageUtils.loadTexture(Object(s.getResourceUrl)("res/postprocess/paper2.jpg"))).wrapS=Z.wrapT=l.RepeatWrapping,S.uniforms.tFill.value=Y,S.uniforms.tPaper.value=Z)}},this.setPostProcessParameter=function(e,t){switch(e){case"style":if(nt.postProcShaded=!1,S.uniforms.style.value=ce,Ke){switch(this.preloadPostProcessStyle(t),t){case"edging":nt.postProcShaded=!0,S.uniforms.style.value=ue;break;case"cel":nt.postProcShaded=!0,S.uniforms.style.value=he;break;case"graphite":nt.postProcShaded=!0,S.uniforms.style.value=de;break;case"pencil":nt.postProcShaded=!0,S.uniforms.style.value=fe}nt.postProcShaded?nt.idbuffer=!0:nt.idbuffer=Ge&&!ze,this.initPostPipeline(nt.sao,nt.antialias)}break;case"edges":S.uniforms.idEdges.value=t?1:0,S.uniforms.normalEdges.value=t?1:0,S.uniforms.depthEdges.value=t?1:0,this.initPostPipeline(nt.sao,nt.antialias);break;case"idEdges":S.uniforms.idEdges.value=t?1:0,this.initPostPipeline(nt.sao,nt.antialias);break;case"normalEdges":S.uniforms.normalEdges.value=t?1:0,this.initPostPipeline(nt.sao,nt.antialias);break;case"depthEdges":S.uniforms.depthEdges.value=t?1:0,this.initPostPipeline(nt.sao,nt.antialias);break;case"brightness":S.uniforms.brightness.value=t;break;case"contrast":S.uniforms.contrast.value=t;break;case"grayscale":S.uniforms.grayscale.value=t?1:0;break;case"preserveColor":S.uniforms.preserveColor.value=t?1:0;break;case"levels":S.uniforms.levels.value=t;break;case"repeats":S.uniforms.repeats.value=t;break;case"rotation":S.uniforms.rotation.value=t;break;default:console.error("setPostProcessParameter: parameter '"+e+"' is not valid.")}return 0},this.queryPostProcessParameter=function(e,t){return"undefined"!==S.uniforms[e]?S.uniforms[e].value:(i.logger.warning("queryPostProcessParameter: parameter '"+e+"' is not valid"),t)},this.getRenderEdges=function(){return nt.renderEdges},this.toggleEnvMapBackground=function(e){nt.envMapBg=e,y.uniforms.envMapBackground.value=e&&!!y.material.envMap},this.toggleSwapBlackAndWhite=function(e){nt.swapBlackAndWhite=e},this.enter2DMode=function(e,t){at=!0,u=e,it.sao=nt.sao,it.postProcShaded=nt.postProcShaded,it.antialias=nt.antialias,it.idbuffer=nt.idbuffer,it.renderEdges=nt.renderEdges,it.occlusionid=nt.occlusionid,nt.idbuffer=!!t,nt.occlusionid=!1,nt.postProcShaded=!1,nt.renderEdges=!1,C.material.defines.IS_2D="",this.initPostPipeline(!1,!1)},this.exit2DMode=function(){at=!1,u=null,nt.idbuffer=it.idbuffer&&Ge,nt.occlusionid=it.occlusionid,nt.postProcShaded=it.postProcShaded,nt.renderEdges=it.renderEdges,delete C.material.defines.IS_2D,this.initPostPipeline(it.sao,it.antialias)},this.idAtPixel=function(t,n,i){if(!ye[0])return 0;var r=0|.5*(t+1)*ye[0].width,o=0|.5*(n+1)*ye[0].height;if(te&&r===D&&o===N)return i&&(i[0]=k,i[1]=V),k;e.readRenderTargetPixels(ye[0],r,o,1,1,De);var a=De[2]<<16|De[1]<<8|De[0],s=0;return ye[1]?(e.readRenderTargetPixels(ye[1],r,o,1,1,De),s=(s=De[1]<<8|De[0])<<16>>16,a=a<<8>>8):a=a<<8>>8,D=r,N=o,k=a,V=s,te=!0,i&&(i[0]=a,i[1]=s),a},this.idAtPixels=function(t,n,i,r){if(!ye[0])return 0;var o=.5*(t+1)*ye[0].width-.5*(i-1),a=.5*(n+1)*ye[0].height-.5*(i-1),s=new Uint8Array(4*i*i);e.readRenderTargetPixels(ye[0],o,a,i,i,s);var l=void 0;return r&&ye[1]&&(l=new Uint8Array(4*i*i),e.readRenderTargetPixels(ye[1],o,a,i,i,l)),function(){for(var e,t=0,n=0,o=0,a=-1,c=0;c<i*i;c++){var u=t+(i-1)/2,h=n+(i-1)/2;if(u>=0&&u<=i&&h>=0&&h<=i){var d=u+h*i;if((e=(e=s[4*d+2]<<16|s[4*d+1]<<8|s[4*d])<<8>>8)>=0){if(l){var f=l[4*d+1]<<8|l[4*d];f=f<<16>>16,r[0]=e,r[1]=f}break}}if(t==n||t<0&&t==-n||t>0&&t==1-n){var p=o;o=-a,a=p}t+=o,n+=a}return e}()},this.readbackTargetId=function(){if(!ye[0])return null;var t=new Uint8Array(4*ye[0].width*ye[0].height);return e.readRenderTargetPixels(ye[0],0,0,ye[0].width,ye[0].height,t),{buffer:t,width:ye[0].width,height:ye[0].height}},this.rolloverObjectViewport=function(e,t){if(!Ge)return!1;Ie[1]=0;var n=this.idAtPixel(e,t,Ie);return this.rolloverObjectId(n,null,Ie[1])},this.rolloverObjectId=function(e,t,n){return n=n||0,e<=0&&(e=0),!(!Ge||e===$e&&n===et)&&(C.uniforms.highlightIntensity.value=0,C.uniforms.objID.value=e,Je=performance.now(),$e=e,et=n,t?(t.length>1&&t.shift(),C.uniforms.highlightRange.value=1,C.uniforms.objIDStart.value=t[0],C.uniforms.objIDEnd.value=t[t.length-1]):(C.uniforms.highlightRange.value=0,C.uniforms.objIDv4.value.set((255&e)/255,(e>>8&255)/255,(e>>16&255)/255,(e>>24&255)/255),C.uniforms.modelIDv2.value.set((255&n)/255,(n>>8&255)/255)),!0)},this.setSpatialFilterForRollOver=function(e){if(!e||this.spatialFilterForRollOverSupported()){C.material.defines.SPATIAL_FILTER!==e&&(e&&""!==e?C.material.defines.SPATIAL_FILTER=e:delete C.material.defines.SPATIAL_FILTER,C.material.needsUpdate=!0,C.uniforms.highlightIntensity.value=0,Je=performance.now())}else i.logger.warn("Spatial filter for mouse-over can only be used with depth target")},this.spatialFilterForRollOverSupported=function(){return ut(le.Depth)},this.setEdgeColor=function(e){ke.copy(e)},this.setSelectionColor=function(e){var t=new l.Color(e);t.r=Math.pow(t.r,2),t.g=Math.pow(t.g,2),t.b=Math.pow(t.b,2),C.uniforms.selectionColor.value.set(t),C.material.needsUpdate=!0},this.setSelectionMaterials=function(e){G.length=e.length;for(var t=0;t<e.length;t++)G[t]=e[t];return bt(),!0},this.setMemoryLimited=function(e){Ge=!e,nt.idbuffer=nt.idbuffer&&Ge,nt.occlusionid=e,this.setSize(U,z)},this.isMemoryLimited=function(){return!Ge},this.setUnitScale=function(e){Ae=e},this.getUnitScale=function(){return Ae},this.getBlendPass=function(){return C},this.getClearPass=function(){return y},this.getColorTarget=function(){return re},this.getIDTargets=function(){return ye},this.getDepthTarget=function(){return F},this.getIdTarget=function(){return ye[0]},this.getDepthMaterial=function(){return t},this.getPostTarget=function(){return ae},this.getEdgeMaterial=function(){return n},this.setCrossFade=function(e){rt=e},this.getCrossFade=function(){return rt},this.setOffscreenTarget=function(e){ot=e},this.getNamedTarget=function(e){switch(e){case"color":return re;case"overlay":return oe;case"id":return ye[0];case"post1":return ae;case"post2":return ge;case"postdisplay":return pe;case"ssao":return me;case"occlusion":return Te;case"depth":return F;case"highlight0":return ve[0];case"highlight1":return ve[1];case"highlight2":return ve[2];case"highlight3":return ve[3]}return null},this.getCurrentFramebuffer=function(){return e.getCurrentFramebuffer()},this.getConfig=function(){return{renderEdges:nt.renderEdges,envMapBackground:nt.envMapBg,envMap:y.material.envMap,envExposure:_e,toneMapExposureBias:be,envRotation:this.getEnvRotation(),tonemapMethod:we,clearColor:Be&&Be.clone(),clearColorTop:!Be&&y.uniforms.color1.value.clone(),clearColorBottom:!Be&&y.uniforms.color2.value.clone(),clearAlpha:Ue,aoEnabled:this.getAOEnabled(),aoRadius:this.getAORadius(),aoIntensity:this.getAOIntensity(),twoSided:nt.haveTwoSided,edgeColor:ke.clone(),unitScale:this.getUnitScale(),is2D:!!C.material.defines.IS_2D,antialias:this.getAntialiasing()}},this.applyConfig=function(e){this.toggleEdges(e.renderEdges),this.toggleEnvMapBackground(e.envMapBackground),this.setCubeMap(e.envMap),this.setEnvExposure(e.envExposure),this.setTonemapExposureBias(e.toneMapExposureBias),this.setEnvRotation(e.envRotation),this.setTonemapMethod(e.tonemapMethod),this.toggleTwoSided(e.twoSided),this.setEdgeColor(e.edgeColor),this.setUnitScale(e.unitScale),e.clearColor?this.setClearColors(e.clearColor):this.setClearColors(e.clearColorTop,e.clearColorBottom),this.setClearAlpha(e.clearAlpha);var t=!!C.material.defines.IS_2D;e.is2D&&!t?this.enter2DMode():!e.is2D&&t&&this.exit2DMode();var n=e.aoEnabled!=this.getAOEnabled(),i=e.antialias!=this.getAntialiasing();(n||i)&&this.initPostPipeline(e.aoEnabled,e.antialias)},this.targetToCanvas=function(t){var n=t.width,i=t.height,r=new Uint8Array(n*i*4);e.readRenderTargetPixels(t,0,0,n,i,r);var o=document.createElement("canvas");o.width=n,o.height=i;var s,l=o.getContext("2d"),c=new Uint8ClampedArray(r);return a.isIE11?(s=l.createImageData(n,i)).data.set(c):s=new ImageData(c,n,i),l.putImageData(s,0,0),l.globalCompositeOperation="copy",l.translate(0,i),l.scale(1,-1),l.drawImage(o,0,0,n,i),l.globalCompositeOperation="source-over",{canvas:o,ctx:l}}}},function(e,t,n){"use strict";var i={};(0,n(65).assign)(i,n(245),n(248),n(164)),e.exports=i},function(e,t,n){"use strict";n.r(t),n.d(t,"RenderModel",function(){return x});var i=n(14),r=n(119),o=n(95),a=n(29),s=n(120),l=n(121),c=n(112),u=n(122),h=n(71),d=n(70),f=n(0),p=n(5),m=n(13),g=n(44),v=n(1),y=10;var _=1,b=[1,8,8,2,4];function x(){var e=new f.Box3,t=new f.Box3,n=new f.Box3;this.visibleBoundsDirty=!1,this.enforceBvh=!1;var x=0;this.id=_++;var w=null,A=null,E=null,T=null,M=null,S=null,C=null,P=null,L=null,R=0,D=null,I=m.RenderFlags.RENDER_NORMAL,O=b[m.RenderFlags.RENDER_NORMAL],N=!1,k=i.PAGEOUT_NONE;function V(e){var t=A.fragments.packIds[e];A.pagingProxy.addGeomPackMissingLastFrame(t)}this.getGeometryList=function(){return w},this.getFragmentList=function(){return A},this.getModelId=function(){return this.id},this.initialize=function(n){var a=this.getData(),s=a.numGeoms||0,l=!function(e,t,n){return!(e&&e-3*t*2<=i.GPU_MEMORY_LIMIT&&n<i.GPU_OBJECT_LIMIT)}(a.packFileTotalSize,a.primitiveCount,s);w=new r.GeometryList(s,this.is2d(),l,this.isOTG()),A=new o.FragmentList(this,n);var u=this.getBoundingBox();u&&(e.copy(u),t.copy(u)),C=M=E=new c.ModelIteratorLinear(this),S=new c.HighlightIteratorLinear(this)},this.getIterator=function(){return M},this.initFromCustomIterator=function(e){C=M=e,this.visibleBoundsDirty=!0},this.dtor=function(e){A&&A.dispose(e),M&&M.dtor&&M.dtor(),P&&P.dispose()},this.activateFragment=function(i,r,o){A&&(A.setMesh(i,r,o),M.addFragment(i),A.getWorldBounds(i,n),e.union(n),t.union(n))},this.setFragment=function(i,r){return void 0===i&&(i=this.getFragmentList().getNextAvailableFragmentId()),A.setMesh(i,r,!0),E&&E.addFragment(i),T&&!A.fragmentsHaveBeenAdded()&&T.addFragment(i),A.getWorldBounds(i,n),e.union(n),t.union(n),i},this.setBVH=function(e,t,n){C=M=T=new u.ModelIteratorBVH,M.initialize(this,e,t,n)},this.resetIterator=function(e,t,n,r,o){return r=r||g.ResetFlags.RESET_NORMAL,A&&A.pagingProxy&&A.pagingProxy.resetIterator(e,r),r!=g.ResetFlags.RESET_NORMAL&&(r>=g.ResetFlags.RESET_REDRAW&&A&&A.onDemandLoadingEnabled()&&(A.setFlagGlobal(p.MeshFlags.MESH_TRAVERSED,!1),M.resetVisStatus(),S&&S.resetVisStatus()),r>=g.ResetFlags.RESET_RELOAD&&A&&A.pageOutGeometryEnabled()&&(k=i.PAGEOUT_NONE,A.pagingProxy&&A.pagingProxy.reset())),N=!1,T&&!A.fragmentsHaveBeenAdded()&&(N=!0),N?M=T:E&&(M=E),C=o&&S.getSceneCount()<y?S:M,R=0,I=n,O=n<b.length?b[n]:b[m.RenderFlags.RENDER_NORMAL],D=t,C.reset(t,e),A&&A.resetBoxRun(),P&&P.reset(),C},this.nextBatch=function(){for(;;){var e=C.nextBatch();if(R++,!e)return null;if(P&&e instanceof a.RenderBatch&&(e=P.consolidateNextBatch(e,D)),e.modelId=this.id,e instanceof f.Scene)return e;if(e.visibleStats&O)t=!(e.visibleStats&O<<16);else{var t=e.applyVisibility(I,D,A.pagingProxy?V:void 0);void 0!==e.visibleStats&&(e.visibleStats|=O,t||(e.visibleStats|=O<<16)),t||this.is2d()||(e.sortObjects&&!this.getFragmentList().useThreeMesh?e.sortByDepth(D):e.sortDone||e.sortByMaterial())}if(!t)return e}},this.getVisibleBounds=function(n){return this.visibleBoundsDirty&&(e.makeEmpty(),t.makeEmpty(),M.getVisibleBounds(e,t,n),this.visibleBoundsDirty=!1),n?t:e},this.rayIntersect=function(e,t,n,i){this.visibleBoundsDirty&&this.getVisibleBounds();var r,o=[];if(n&&n.length>0){var a=this.getFragmentMap(),s=[];if(a)for(r=0;r<n.length;r++)a.enumNodeFragments(n[r],function(e){s.push(e)},!0);else s=n;if(s.length>2)M.rayCast(e,o,n);else for(r=0;r<s.length;r++){var l=A.getVizmesh(s[r]);if(l){var c=d.VBIntersector.rayCast(l,e,o);c&&o.push(c)}}}else M.rayCast(e,o);if(!o.length)return null;o.sort(function(e,t){return e.distance-t.distance});var u=!!i;for(i=i||[],r=0;r<o.length;r++){var h=o[r].fragId;if(!this.is2d())if(this.isFragVisible(h)){var p=A.getMaterial(h);if(t&&p.transparent)continue;var m=o[r],g=!1,v=m.point;if(p&&p.cutplanes)for(var y=0;y<p.cutplanes.length;y++)g=g||p.cutplanes[y].dot(new f.Vector4(v.x,v.y,v.z,1))>1e-6;if(g||i.push(m),m.model=this,!u&&i.length>0)break}}var _=i[0]||null;return _&&(_.model=this),_},this.setHighlighted=function(e,t){if(!A)return!1;var n=A.setFlagFragment(e,p.MeshFlags.MESH_HIGHLIGHTED,t);return n&&(t?(S.addFragment(e),x++):(S.removeFragment(e),x--)),n},this.setVisibility=function(e,t){A&&(A.setVisibility(e,t),this.visibleBoundsDirty=!0)},this.setAllVisibility=function(e){A&&(A.setAllVisibility(e),this.visibleBoundsDirty=!0)},this.hideLines=function(e){A&&A.hideLines(e)},this.hidePoints=function(e){A&&A.hidePoints(e)},this.hasHighlighted=function(){return!!x},this.isFragVisible=function(e){return A.isFragVisible(e)},this.areAllVisible=function(){return!A||A.areAllVisible()},this.getGeomScenes=function(){return M.getGeomScenes()},this.getRenderProgress=function(){var e=R/C.getSceneCount();return e>1?1:e},this.pageOutIfNeeded=function(e,t,n){return A.pagingProxy?A.pagingProxy.pageOut(e,t,n):i.PAGEOUT_NONE},this.frameUpdatePaging=function(e,t){return A&&A.pageOutGeometryEnabled()?(k=this.pageOutIfNeeded(!1,!1,t),C.done()&&(k=this.pageOutIfNeeded(!0,!1,t))==i.PAGEOUT_FAIL&&(k=this.pageOutIfNeeded(!0,!0,t)),k):k},this.geomPacksMissingLastFrame=function(){return A&&A.pagingProxy?A.pagingProxy.geomPacksMissingLastFrame():[]},this.addGeomPackMissingLastFrame=function(e){return!A||!A.pagingProxy||A.pagingProxy.addGeomPackMissingLastFrame(e)},this.needResumeNextFrame=function(){return!(!A||!A.pagingProxy)&&A.pagingProxy.needResumeNextFrame()},this.update=function(e){return!(!M||!M.update)&&M.update(e)},this.setThemingColor=function(e,t){e=this.reverseMapDbId(e),A?A.setThemingColor(e,t):v.logger.warn("Theming colors are not supported by this model type.")},this.clearThemingColors=function(){A&&A.clearThemingColors()},this.getLeaflet=function(){return M instanceof h.ModelIteratorTexQuad?M:null},this.consolidate=function(e,t,n){var i=Object(s.consolidateFragmentList)(A,e,t,n,L);P=new l.ConsolidationIterator(A,i),L=i.consolidationMap},this.unconsolidate=function(){P&&(P.dispose(),P=null)},this.isConsolidated=function(){return!!P},this.getConsolidation=function(){return P?P.getConsolidation():null},this.setDbIdRemap=function(e){this.is2d&&(this.idRemap=e)},this.remapDbId=function(e){return this.idRemap&&e>0&&e<this.idRemap.length?this.idRemap[e]:e},this.reverseMapDbId=function(e){if(!this.idRemap||e<=0)return e;if(!this.reverseMap){this.reverseMap={};for(var t=0;t<this.idRemap.length;t++)this.reverseMap[this.idRemap[t]]=t}return this.reverseMap[e]},this.updateRenderProxy=function(e,t){P&&P.updateRenderProxy(e,t)},this.skipOpaqueShapes=function(){M&&M.skipOpaqueShapes&&M.skipOpaqueShapes()},this.getMemoryInfo=function(){return A&&A.getMemoryInfo()}}},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(0),r=n(167),o=n.n(r),a=n(168),s=n.n(a),l=n(31),c={uniforms:{tDiffuse:{type:"t",value:null},uColor:{type:"v4",value:new i.Vector4(1,1,1,1)}},vertexShader:o.a,fragmentShader:s.a},u=function(e,t,n,r,o){var a,s,u,h=e,d=t,f=n||3,p=r||1,m=o.hasAlpha||!1,g=o.blending||!1,v=o.flipUV||!1;this.render=function(e,t,n){a.render(e,u,n),s.render(e,t,u)},this.setSize=function(e,t){this.cleanup(),h=e,d=t,(u=new i.WebGLRenderTarget(e,t,{minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:void 0!==o.format?o.format:i.RGBAFormat,type:void 0!==o.type?o.type:i.UnsignedByteType,stencilBuffer:!1})).generateMipmaps=!1,a.material.defines.KERNEL_SCALE_H=s.material.defines.KERNEL_SCALE_H=(p/h).toFixed(4),a.material.defines.KERNEL_SCALE_V=s.material.defines.KERNEL_SCALE_V=(p/d).toFixed(4),a.material.needsUpdate=s.material.needsUpdate=!0},this.cleanup=function(){u&&u.dispose()},this.setColor=function(e){s.material.uniforms.uColor.value.x=e.r,s.material.uniforms.uColor.value.y=e.g,s.material.uniforms.uColor.value.z=e.b},this.setAlpha=function(e){s.material.uniforms.uColor.value.w=e},a=new l.a(c),s=new l.a(c),this.setSize(e,t),a.material.blending=s.material.blending=i.NoBlending,a.material.depthWrite=s.material.depthWrite=!1,a.material.depthTest=s.material.depthTest=!1,a.material.defines.HORIZONTAL=1,a.material.defines.KERNEL_RADIUS=s.material.defines.KERNEL_RADIUS=f.toFixed(1),g&&(s.material.transparent=!0,s.material.blending=i.NormalBlending),m&&(a.material.defines.HAS_ALPHA=s.material.defines.HAS_ALPHA=""),v&&(a.material.defines.FLIP_UV="")}},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(0),r=n(169),o=n.n(r),a=n(170),s=n.n(a),l={uniforms:{color1:{type:"v3",value:new i.Vector3(41/255,76/255,120/255)},color2:{type:"v3",value:new i.Vector3(1/255,2/255,3/255)},opacity:{type:"f",value:1},envMap:{type:"t",value:null},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},uCamDir:{type:"v3",value:new i.Vector3},uCamUp:{type:"v3",value:new i.Vector3},uResolution:{type:"v2",value:new i.Vector2(600,400)},uHalfFovTan:{type:"f",value:.5},envMapBackground:{type:"i",value:0}},vertexShader:o.a,fragmentShader:s.a}},function(e,t,n){"use strict";n.r(t),n.d(t,"WebGLShader",function(){return o});var i=n(0),r=function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")};function o(e,t,n){var o=e.createShader(t);return e.shaderSource(o,n),e.compileShader(o),"undefined"!=typeof DEBUG_SHADERS&&DEBUG_SHADERS&&(!1===e.getShaderParameter(o,e.COMPILE_STATUS)&&i.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(o)&&i.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e.getShaderInfoLog(o),r(n))),o}},function(e,t,n){"use strict";n.r(t),n.d(t,"IteratorLinear",function(){return g}),n.d(t,"ModelIteratorLinear",function(){return v}),n.d(t,"HighlightIteratorLinear",function(){return y});var i=n(29),r=n(113),o=n(3);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}var m=function(e){var t=500;return e&&(t/=3),Object(o.isMobileDevice)()&&(t/=3,e&&(t/=2)),(t=Math.floor(t))>0?t:500},g=function(){function e(t,n,i){d(this,e),this._frags=t.getFragmentList(),this._model=t,this._fillLast=i,this._fragsPerScene=m(t.is2d()),this._fragOrder=[],this._geomScenes=[];for(var r=new Int32Array(n),o=0;o<this._fragCount;o++)r[o]=o;this.setFragmentOrder(r,n)}return p(e,[{key:"setFragmentOrder",value:function(e,t){this._fragCount=t,this._fragOrder[0]=e;var n=Math.ceil(this._fragCount/this._fragsPerScene),o=this._frags.onDemandLoadingEnabled(),a=this._RBClass=o?r.a:i.RenderBatch,s=this._geomScenes.length;this._geomScenes.length=n;for(var l=this._geomScenes,c=this._fragsPerScene,u=0;u<n;u++){var h=u*c,d=u<s?l[u]:l[u]=new a(this._frags,this._fragOrder,h,this._fragsPerScene),f=h+this._fragsPerScene;f>this._fragCount&&(f=this._fragCount),d.lastItem=f,o&&d.calculateBounds()}}},{key:"addFragment",value:function(e){if(this._fragOrder[0].length<=e){var t=2*this._fragOrder[0].length;t<=e&&(t=e+1);var n=new Int32Array(t);n.set(this._fragOrder[0]),this._fragOrder[0]=n}this._fragOrder[0][e]=e;var i=Math.floor(e/this._fragsPerScene);if(this._geomScenes){var r=this._geomScenes[i];r||(this._geomScenes[i]=r=new this._RBClass(this._frags,this._fragOrder,i*this._fragsPerScene,this._fragsPerScene)),r&&r.onFragmentAdded(e,e)}}},{key:"reset",value:function(e,t){if(this._currentScene=0,this._fillLast&&this._geomScenes[0]&&(this._geomScenes[0].drawEnd=0),this._resetVisStatus){for(var n=this._geomScenes,i=n.length,r=0;r<i;++r){var o=n[r];o&&o.resetVisStatus&&o.resetVisStatus()}this._resetVisStatus=!1}}},{key:"getSceneCount",value:function(){return this._geomScenes.length}},{key:"getGeomScenes",value:function(){return this._geomScenes}},{key:"resetVisStatus",value:function(){this._resetVisStatus=!0}},{key:"done",value:function(){return!(this._fillLast&&!this._model.isLoadDone())&&(this._currentScene>=this._geomScenes.length-1&&(!(e=this._geomScenes[this._currentScene])||e.drawStart>=e.lastItem));var e}},{key:"nextBatch",value:function(){if(this._currentScene>=this.getSceneCount())return null;var e=this._geomScenes[this._currentScene];if(this._fillLast){if(e.lastItem>=e.start+e.count&&(++this._currentScene,this._geomScenes[this._currentScene]&&(this._geomScenes[this._currentScene].drawEnd=this._geomScenes[this._currentScene].start)),e.drawStart=e.drawEnd,e.drawEnd=e.lastItem,e.hasOwnProperty("drawStart")&&e.lastItem<=e.drawStart)return null}else++this._currentScene;return e.renderImportance=0,e}},{key:"getVisibleBounds",value:function(e,t){for(var n=this.getSceneCount(),i=0;i<n;i++){this._geomScenes[i].calculateBounds();var r=this._geomScenes[i].getBoundingBox();e.union(r),t.union(r),t.union(this._geomScenes[i].getBoundingBoxHidden())}}},{key:"rayCast",value:function(e,t,n){for(var i=this.getSceneCount(),r=0;r<i;r++)this._geomScenes[r].raycast(e,t,n)}}]),e}(),v=function(e){function t(e){d(this,t);var n=e.getFragmentList(),i=e.is2d()&&!n.onDemandLoadingEnabled();return l(this,c(t).call(this,e,n.getCount(),i))}return u(t,g),t}(),y=function(e){function t(e){var n;return d(this,t),(n=l(this,c(t).call(this,e,0,!1)))._ids={},n._curCount=0,n._dirty=!1,n}return u(t,g),p(t,[{key:"addFragment",value:function(e){this._ids[e]||(this._ids[e]=!0,++this._curCount,this._dirty=!0)}},{key:"removeFragment",value:function(e){this._ids[e]&&(delete this._ids[e],--this._curCount,this._dirty=!0)}},{key:"reset",value:function(e,n){if(this._dirty){for(var i=Object.keys(this._ids),r=new Int32Array(i.length),o=i.length;--o>=0;)r[o]=parseInt(i[o]);this.setFragmentOrder(r,i.length),this._dirty=!1}s(c(t.prototype),"reset",this).call(this,e,n)}},{key:"getSceneCount",value:function(){return Math.ceil(this._curCount/this._fragsPerScene)}}]),t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(29),r=n(27),o=n(0),a=n(5),s=n(13),l=new(n(37).LmvBox3);function c(e,t,n,r){i.RenderBatch.call(this,e,t,n,r),this.visibleStats=0}c.prototype=Object.create(i.RenderBatch.prototype),c.prototype.constructor=c,c.prototype.resetVisStatus=function(){this.visibleStats=0},c.prototype.forEach=function(e,t,n){for(var i=this.getIndices(),r=this.frags,o=!this.sortByShaderDone,s=r.pageOutGeometryEnabled(),l=r.onDemandLoadingEnabled(),c=this.start,u=this.lastItem;c<u;c++){var h=i?i[c]:c,d=r.getVizmesh(h,this.renderImportance,!0);if(!o||d&&d.material&&d.material.program&&!d.geometry_proxy||(o=!1),l){if(r.isFlagSet(h,a.MeshFlags.MESH_TRAVERSED)&&t==a.MeshFlags.MESH_RENDERFLAG)continue;if(!n&&t&&r.isFlagSet(h,t)&&(d.geometry||(d.geometry=r.requireGeometry(h),h<this.drawOrderRender&&(this.drawOrderRender=h),!d.geometry&&d.geometry_proxy&&(d.geometry=d.geometry_proxy)),d.geometry)){var f=t==a.MeshFlags.MESH_RENDERFLAG&&r.isFlagSet(h,a.MeshFlags.MESH_DRAWN);if(t==a.MeshFlags.MESH_RENDERFLAG){if(!(null==this.drawOrderRender||h<this.drawOrderRender))continue;r.setFlagFragment(h,a.MeshFlags.MESH_DRAWN,!0)}if(!f&&s&&r.pagingProxy){var p=r.getMaterial(h);p&&r.pagingProxy.onGeomTraversed(d.geometry,p.transparent)}}}!(n||d&&d.geometry)||t&&!r.isFlagSet(h,t)||e(d,h)}o&&this.sortByShader()},c.prototype.applyVisibility=function(){var e,t,n,i,c,u,h,d;function f(f,p){if(f||!e.useThreeMesh)if(d||function(e,t,n,i){var a=!1;l||(l=new o.Box3),n.getWorldBounds(i,l);var s=t.intersectsBox(l);if(e&&s===r.FrustumIntersector.OUTSIDE)a=!0;else if(n.pixelCullingEnable()){var c=t.projectedBoxArea(l,s===r.FrustumIntersector.CONTAINS);(c*=t.areaConv)<n.pixelCullingThreshold()&&(a=!0)}return a}(u,n,e,p)){if(f?f.visible=!1:o.warn("Unexpected null mesh"),t[p]=t[p]&~a.MeshFlags.MESH_RENDERFLAG,e.pageOutGeometryEnabled()){var m=e.geomids[p],g=e.geoms.getGeometry(m);e.pagingProxy&&e.pagingProxy.onGeomCulled(g)}}else{var v=function(e,t,n,i,r){var o,l=t[n]&~a.MeshFlags.MESH_RENDERFLAG;switch(e){case s.RenderFlags.RENDER_HIDDEN:o=!(l&a.MeshFlags.MESH_VISIBLE);break;case s.RenderFlags.RENDER_HIGHLIGHTED1:case s.RenderFlags.RENDER_HIGHLIGHTED2:o=l&a.MeshFlags.MESH_HIGHLIGHTED;break;default:o=1==(l&(a.MeshFlags.MESH_VISIBLE|a.MeshFlags.MESH_HIGHLIGHTED|a.MeshFlags.MESH_HIDE))}if(i){var c=l&(a.MeshFlags.MESH_ISLINE|a.MeshFlags.MESH_ISWIDELINE);o=o&&!c}if(r){var u=l&a.MeshFlags.MESH_ISPOINT;o=o&&!u}return t[n]=l|(o?a.MeshFlags.MESH_RENDERFLAG:0),o}(i,t,p);f&&(f.visible=!!v),h=h&&!v}else c&&c(p)}return function(o,a,l){h=!0,d=!1,n=a,i=o,c=l,e=this.frags;var p=i===s.RenderFlags.RENDER_HIDDEN?this.getBoundingBoxHidden():this.getBoundingBox(),m=n.intersectsBox(p);if(m===r.FrustumIntersector.OUTSIDE&&(d=!0),u=m!==r.FrustumIntersector.CONTAINS,e.pixelCullingEnable()){var g=this.renderImportance;0==g&&(g=n.projectedBoxArea(p,!u)),(g*=n.areaConv)<e.pixelCullingThreshold()&&(d=!0)}return t=this.frags.vizflags,this.forEach(f,null,c),h}}()},function(e,t,n){"use strict";n.r(t),n.d(t,"ObjectContextMenu",function(){return r});var i=n(150);function r(e){this.viewer=e,this.contextMenu=new i.ContextMenu(e)}r.prototype.constructor=r,r.prototype.show=function(e){var t=this.viewer.getSelectionCount(),n=this.viewer.getSelectionVisibility(),i={numSelected:t,hasSelected:0<t,hasVisible:n.hasVisible,hasHidden:n.hasHidden},r=this.buildMenu(e,i);this.viewer.runContextMenuCallbacks(r,i),r&&0<r.length&&this.contextMenu.show(e,r)},r.prototype.hide=function(){return this.contextMenu.hide()},r.prototype.buildMenu=function(e,t){return null}},function(e,t,n){"use strict";n.r(t),n.d(t,"ComboButton",function(){return a});var i=n(8),r=n(55),o=n(11);function a(e,t){i.Button.call(this,e,t),this.arrowButton=new i.Button(e+"arrow"),this.arrowButton.addClass("adsk-button-arrow"),this.arrowButton.removeClass("adsk-button"),this.subMenu=new r.RadioButtonGroup(e+"SubMenu"),this.subMenu.addClass("toolbar-vertical-group"),this.subMenu.setVisible(!1),this.container.insertBefore(this.subMenu.container,this.container.firstChild),this.container.insertBefore(this.arrowButton.container,this.container.firstChild);var n=this;this.arrowButton.onClick=function(e){n.subMenu.setVisible(!n.subMenu.isVisible())},this.toggleFlyoutVisible=function(){n.subMenu.setVisible(!n.subMenu.isVisible())},this.onClick=function(e){n.subMenu.setVisible(!n.subMenu.isVisible())},this.subMenuActiveButtonChangedHandler=function(e){e.isActiveButton?(n.setIcon(e.target.getActiveButton().iconClass),n.setToolTip(e.target.getActiveButton().getToolTip()),n.setState(i.Button.State.ACTIVE),n.onClick=e.button.onClick):n.setState(i.Button.State.INACTIVE)},this.subMenu.addEventListener(r.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.subMenuActiveButtonChangedHandler);var a=Object(o.stringToDOM)('<div class="clickoff" style="position:fixed; top:0; left:0; width:100vw; height:100vh;"></div>');this.subMenu.container.insertBefore(a,this.subMenu.container.firstChild),a.addEventListener("click",function(e){n.subMenu.setVisible(!1),e.stopPropagation()})}a.prototype=Object.create(i.Button.prototype),a.prototype.constructor=a,a.prototype.addControl=function(e){this.subMenu.addControl(e),e.addEventListener(i.Button.Event.CLICK,this.toggleFlyoutVisible)},a.prototype.removeControl=function(e){e.removeEventListener(i.Button.Event.CLICK,this.toggleFlyoutVisible)},a.prototype.setState=function(e){if(e===i.Button.State.INACTIVE){var t=this.subMenu.getActiveButton();t&&t.setState(i.Button.State.INACTIVE)}i.Button.prototype.setState.call(this,e)},a.prototype.saveAsDefault=function(){this.defaultState={},this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")&&(this.defaultState.tooltip=this._toolTipElement.getAttribute("tooltipText")),this.defaultState.icon=this.iconClass,this.defaultState.onClick=this.onClick},a.prototype.restoreDefault=function(){this.defaultState&&(this.defaultState.tooltip&&this.setToolTip(this.defaultState.tooltip),this.defaultState.icon&&this.setIcon(this.defaultState.icon),this.onClick=this.defaultState.onClick,this.setState(i.Button.State.INACTIVE))}},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";n.r(t),n.d(t,"GroundReflection",function(){return f});var i=n(31),r=n(109),o=n(110),a=n(36),s=n.n(a),l=n(171),c=n.n(l),u=n(21),h=n(0),d={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:s.a,fragmentShader:c.a},f=function(e,t,n,a){var s,l,c,f,p,m,g=e,v=g.getContext(),y=t||512,_=n||512,b=!1,x=new h.Color(0,0,0),w=!1,A=!1;this.inTarget=void 0,this.outTarget=void 0;var E,T,M,S,C=!0,P=u.GroundFlags.GROUND_UNFINISHED,L={color:new h.Color(1,1,1),alpha:.3,texScale:.5,blurRadius:2,blurTexScale:.5,fadeAngle:Math.PI/18};if(this.setTransform=function(e,t,n){f=e,c.normal=t,c.constant=-e.dot(t)},this.cleanup=function(){s&&s.cleanup(),this.inTarget&&this.inTarget.dispose(),this.outTarget&&this.outTarget.dispose()},this.setSize=function(e,t){y=e,_=t,this.cleanup(),this.inTarget=new h.WebGLRenderTarget(y*L.texScale,_*L.texScale,{magFilter:h.LinearFilter,minFilter:h.LinearFilter,format:h.RGBAFormat,stencilBuffer:!1}),this.inTarget.generateMipmaps=!1,this.outTarget=new h.WebGLRenderTarget(y*L.texScale,_*L.texScale,{magFilter:h.LinearFilter,minFilter:h.LinearFilter,format:h.RGBAFormat,stencilBuffer:!1}),this.outTarget.generateMipmaps=!1,s?s.setSize(y*L.texScale*L.blurTexScale,_*L.texScale*L.blurTexScale):s=new r.a(y*L.texScale*L.blurTexScale,_*L.texScale*L.blurTexScale,L.blurRadius,1,{hasAlpha:!0,blending:!0,flipUV:!0})},this.updateCamera=function(e){var t;t=e.isPerspective?f.clone():e.target.clone();var n=e.position.clone().sub(t).normalize(),i=Math.PI/2-n.angleTo(c.normal);if(!(b=i<0)){if(L.fadeAngle>0){var r=Math.min(L.fadeAngle,i)/L.fadeAngle;s.setAlpha(r*L.alpha)}var o,a,l,u=(a=(o=c).normal,l=o.constant,(new h.Matrix4).set(1-2*a.x*a.x,-2*a.y*a.x,-2*a.x*a.z,-2*l*a.x,-2*a.x*a.y,1-2*a.y*a.y,-2*a.y*a.z,-2*l*a.y,-2*a.x*a.z,-2*a.y*a.z,1-2*a.z*a.z,-2*l*a.z,0,0,0,1));(p=e.clone()).applyMatrix(u),p.projectionMatrix.elements[5]*=-1,p.matrixWorldNeedsUpdate=!0,e.worldUpTransform?p.worldUpTransform=e.worldUpTransform.clone():p.worldUpTransform=new h.Matrix4}},this.renderIntoReflection=function(e){b||g.render(e,p,this.inTarget)},this.prepareGroundReflection=(T=0,M=0,S=0,function(e,t,n,i,r,o){var a,s,l,c=t.modelQueue();if(P!==u.GroundFlags.GROUND_UNFINISHED||c.isEmpty())return P=u.GroundFlags.GROUND_FINISHED,r;if(E!=c.getGeomScenes()&&(C=!0),C){if(C=!1,this.updateCamera(t.camera),this.isGroundCulled())return P=u.GroundFlags.GROUND_FINISHED,r;this.clear(),E=c.getGeomScenes(),T=E.length,M=0,S=i?Math.max(Math.ceil(T/100),i):T,P=u.GroundFlags.GROUND_UNFINISHED}else{if(P!==u.GroundFlags.GROUND_UNFINISHED)return P=u.GroundFlags.GROUND_FINISHED,r;0===i&&(S=T)}r&&(a=performance.now(),s=(o=void 0===o?1:o)*r);for(var h=0;h<S&&M<T;){var d=E[M++];if(d&&(h++,d.forceVisible=!0,this.renderIntoReflection(d),d.forceVisible=!1,r)){var f=performance.now()-a;if(s<f&&M<T){P=u.GroundFlags.GROUND_UNFINISHED,l=r-f;break}}}return M<T&&(P=u.GroundFlags.GROUND_UNFINISHED,l=r?r-performance.now()+a:1),void 0===l||n?(this.postprocess(t.camera,t.matman()),e&&e.enabled&&t.renderGroundShadow(this.outTarget),this.renderReflection(t.camera,t.renderer().getColorTarget()),void 0===l&&(P=u.GroundFlags.GROUND_RENDERED),r?r-performance.now()+a:1):l}),this.renderReflection=function(e,t){b||(v.depthRange(.999999,1),l.render(g,t,this.outTarget),v.depthRange(0,1))},this.toggleEnvMapBackground=function(e){A=e,m.uniforms.envMapBackground.value=e},this.postprocess=function(e){b||(w||A?(m.uniforms.uCamDir.value=e.worldUpTransform?e.getWorldDirection().clone().applyMatrix4(e.worldUpTransform):e.getWorldDirection(),m.uniforms.uCamUp.value=e.worldUpTransform?e.up.clone().applyMatrix4(e.worldUpTransform):e.up,m.uniforms.uResolution.value.set(y,_),m.uniforms.uHalfFovTan.value=Math.tan(h.Math.degToRad(.5*e.fov)),m.render(g,this.outTarget),g.clearTarget(this.outTarget,!1,!0,!1)):(g.setClearColor(x,1),g.clearTarget(this.outTarget,!0,!0,!1)),s.render(g,this.outTarget,this.inTarget))},this.clear=function(){g.setClearColor(x,0),g.clearTarget(this.inTarget,!0,!0,!1),g.clearBlend()},this.setClearColors=function(e,t,n){t?(x.setRGB(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z)),w=!e.equals(t)&&!n):(x.copy(e),w=!1),w&&(m.uniforms.color1.value.copy(e),m.uniforms.color2.value.copy(t))},this.setEnvRotation=function(e){m.material.envRotationSin=Math.sin(e),m.material.envRotationCos=Math.cos(e)},this.isGroundCulled=function(){return b},this.getStatus=function(){return P},this.setDirty=function(){C=!0,P=u.GroundFlags.GROUND_UNFINISHED},this.setColor=function(e){s.setColor(L.color),L.color.set(e)},this.setAlpha=function(e){s.setAlpha(L.alpha),L.alpha=e},a)for(var R in L)L[R]=void 0!==a[R]?a[R]:L[R];(l=new i.a(d)).material.blending=h.NoBlending,l.material.depthTest=!0,l.material.depthWrite=!1,l.scene.position.z=-.999999,a.clearPass?m=a.clearPass:((m=new i.a(o.a)).material.blending=h.NoBlending,m.material.depthWrite=!1,m.material.depthTest=!1),this.setSize(y,_),s.setAlpha(L.color),s.setAlpha(L.alpha),c=new h.Plane(new h.Vector3(0,1,0),0),f=new h.Vector3(0,0,0)}},function(e,t,n){"use strict";n.r(t),n.d(t,"LineStyleDefs",function(){return r}),n.d(t,"createLinePatternTexture",function(){return o});var i=n(0),r=[{id:"SOLID",name:"Solid",ascii_art:"_______________________________________",def:[1]},{id:"BORDER",name:"Border",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.5,-.25,.5,-.25,0,-.25]},{id:"BORDER2",name:"Border (.5x)",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.25,-.125,.25,-.125,0,-.125]},{id:"BORDERX2",name:"Border (2x)",ascii_art:"____  ____  .  ____  ____  .  ___",def:[1,-.5,1,-.5,0,-.5]},{id:"CENTER",name:"Center",ascii_art:"____ _ ____ _ ____ _ ____ _ ____ _ ____",def:[1.25,-.25,.25,-.25]},{id:"CENTER2",name:"Center (.5x)",ascii_art:"___ _ ___ _ ___ _ ___ _ ___ _ ___",def:[.75,-.125,.125,-.125]},{id:"CENTERX2",name:"Center (2x)",ascii_art:"________  __  ________  __  _____",def:[2.5,-.5,.5,-.5]},{id:"DASHDOT",name:"Dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . __",def:[.5,-.25,0,-.25]},{id:"DASHDOT2",name:"Dash dot (.5x)",ascii_art:"_._._._._._._._._._._._._._._.",def:[.25,-.125,0,-.125]},{id:"DASHDOTX2",name:"Dash dot (2x)",ascii_art:"____  .  ____  .  ____  .  ___",def:[1,-.5,0,-.5]},{id:"DASHED",name:"Dashed",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ _",def:[.5,-.25]},{id:"DASHED2",name:"Dashed (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.25,-.125]},{id:"DASHEDX2",name:"Dashed (2x)",ascii_art:"____  ____  ____  ____  ____  ___",def:[1,-.5]},{id:"DIVIDE",name:"Divide",ascii_art:"____ . . ____ . . ____ . . ____ . . ____",def:[.5,-.25,0,-.25,0,-.25]},{id:"DIVIDE2",name:"Divide (.5x)",ascii_art:"__..__..__..__..__..__..__..__.._",def:[.25,-.125,0,-.125,0,-.125]},{id:"DIVIDEX2",name:"Divide (2x)",ascii_art:"________  .  .  ________  .  .  _",def:[1,-.5,0,-.5,0,-.5]},{id:"DOT",name:"Dot",ascii_art:". . . . . . . . . . . . . . . . . . . . . . . .",def:[0,-.25]},{id:"DOT2",name:"Dot (.5x)",ascii_art:"........................................",def:[0,-.125]},{id:"DOTX2",name:"Dot (2x)",ascii_art:".  .  .  .  .  .  .  .  .  .  .  .  .  .",def:[0,-.5]},{id:"HIDDEN",name:"Hidden",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ __",def:[.25,-.125]},{id:"HIDDEN2",name:"Hidden (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.125,-.0625]},{id:"HIDDENX2",name:"Hidden (2x)",ascii_art:"____ ____ ____ ____ ____ ____ ____",def:[.5,-.25]},{id:"PHANTOM",name:"Phantom",ascii_art:"______  __  __  ______  __  __  ______",def:[1.25,-.25,.25,-.25,.25,-.25]},{id:"PHANTOM2",name:"Phantom (.5x)",ascii_art:"___ _ _ ___ _ _ ___ _ _ ___ _ _",def:[.625,-.125,.125,-.125,.125,-.125]},{id:"PHANTOMX2",name:"Phantom (2x)",ascii_art:"____________    ____    ____   _",def:[2.5,-.5,.5,-.5,.5,-.5]},{id:"ACAD_ISO02W100",name:"ISO dash",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __",def:[12,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO03W100",name:"ISO dash space",ascii_art:"__    __    __    __    __    __",def:[12,-18],pen_width:1,unit:"mm"},{id:"ACAD_ISO04W100",name:"ISO long-dash dot",ascii_art:"____ . ____ . ____ . ____ . _",def:[24,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO05W100",name:"ISO long-dash double-dot",ascii_art:"____ .. ____ .. ____ .",def:[24,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO06W100",name:"ISO long-dash triple-dot",ascii_art:"____ ... ____ ... ____",def:[24,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO07W100",name:"ISO dot",ascii_art:". . . . . . . . . . . . . . . . . . . .",def:[.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO08W100",name:"ISO long-dash short-dash",ascii_art:"____ __ ____ __ ____ _",def:[24,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO09W100",name:"ISO long-dash double-short-dash",ascii_art:"____ __ __ ____",def:[24,-3,6,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO10W100",name:"ISO dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . ",def:[12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO11W100",name:"ISO double-dash dot",ascii_art:"__ __ . __ __ . __ __ . __ _",def:[12,-3,12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO12W100",name:"ISO dash double-dot",ascii_art:"__ . . __ . . __ . . __ . .",def:[12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO13W100",name:"ISO double-dash double-dot",ascii_art:"__ __ . . __ __ . . _",def:[12,-3,12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO14W100",name:"ISO dash triple-dot",ascii_art:"__ . . . __ . . . __ . . . _",def:[12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO15W100",name:"ISO double-dash triple-dot",ascii_art:"__ __ . . . __ __ . .",def:[12,-3,12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"FENCELINE1",name:"Fenceline circle",ascii_art:"----0-----0----0-----0----0-----0--",def:[.25,-.1,["CIRC1","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"FENCELINE2",name:"Fenceline square",ascii_art:"----[]-----[]----[]-----[]----[]---",def:[.25,-.1,["BOX","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"TRACKS",name:"Tracks",ascii_art:"-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-",def:[.15,["TRACK1","ltypeshp.shx","s=.25"],.15]},{id:"BATTING",name:"Batting",ascii_art:"SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS",def:[1e-4,-.1,["BAT","ltypeshp.shx","x=-.1","s=.1"],-.2,["BAT","ltypeshp.shx","r=180","x=.1","s=.1"],-.1]},{id:"HOT_WATER_SUPPLY",name:"Hot water supply",ascii_art:"---- HW ---- HW ---- HW ----",def:[.5,-.2,["HW","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.2]},{id:"GAS_LINE",name:"Gas line",ascii_art:"----GAS----GAS----GAS----GAS----GAS----GAS--",def:[.5,-.2,["GAS","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.25]},{id:"ZIGZAG",name:"Zig zag",ascii_art:"/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/",def:[1e-4,-.2,["ZIG","ltypeshp.shx","x=-.2","s=.2"],-.4,["ZIG","ltypeshp.shx","r=180","x=.2","s=.2"],-.2]}],o=function(){for(var e=r.length,t=0,n=0;n<e;n++){(u=r[n]).def.length>t&&(t=u.def.length)}for(var o=t+3,a=e,s=1;s<o;)s*=2;for(o=s,s=1;s<a;)s*=2;a=s;for(var l=new Uint8Array(o*a),c=0;c<e;c++){var u,h=c*o,d=(u=r[c]).unit&&"mm"==u.unit?1/25.4:1,f=u.pen_width||0,p=u.def,m=0;for(n=0;n<p.length;n++){var g=Math.abs(p[n]);g<=.5*f&&(g=0);var v=0|96*g*d;m+=v,l[h+n+2]=v||1}l[h]=m%256,l[h+1]=m/256,l[h+p.length+2]=0}var y=new i.DataTexture(l,o,a,i.LuminanceFormat,i.UnsignedByteType,i.UVMapping,i.ClampToEdgeWrapping,i.ClampToEdgeWrapping,i.NearestFilter,i.NearestFilter,0);return y.generateMipmaps=!1,y.flipY=!1,y.needsUpdate=!0,y}},function(e,t,n){"use strict";n.r(t),n.d(t,"GeometryList",function(){return a});var i=n(14),r=n(3),o=n(0);function a(e,t,n,i){this.geoms=[null],this.numGeomsInMemory=0,this.geomMemory=0,this.gpuMeshMemory=0,this.gpuNumMeshes=0,this.geomPolyCount=0,this.instancePolyCount=0,this.is2d=t,this.geomBoxes=i?null:new Float32Array(6*Math.max(1,e+1)),this.numObjects=e,this.disableStreaming=!!n}a.prototype.getGeometry=function(e){return this.geoms[e]},a.prototype.chooseMemoryType=function(e,t,n,r){var o=i.GPU_MEMORY_LIMIT,a=2*o,s=i.GPU_OBJECT_LIMIT;if(0===o)return e.streamingDraw=!0,void(e.streamingIndex=!0);if(this.disableStreaming||r<o&&n<s)e.streamingDraw=!1,e.streamingIndex=!1;else if(r>=a)e.streamingDraw=!0,e.streamingIndex=!0;else{(this.is2d?100001:e.byteSize*(t||1))<1e5&&(e.streamingDraw=!0,e.streamingIndex=!0)}},a.prototype.addGeometry=function(e,t,n){this.chooseMemoryType(e,t,this.gpuNumMeshes,this.gpuMeshMemory);var a=e.byteSize+i.GEOMETRY_OVERHEAD;if(e.streamingDraw||(Object(r.isMobileDevice)()&&(a+=e.byteSize),this.gpuMeshMemory+=e.byteSize,this.gpuNumMeshes+=1),this.numGeomsInMemory++,(void 0===n||n<=0)&&(n=this.geoms.length),this.geoms[n]=e,this.geomBoxes){var s=this.geomBoxes.length/6|0;if(s<this.geoms.length){var l=3*this.geoms.length/2|0,c=new Float32Array(6*l);c.set(this.geomBoxes);var u=new o.Box3;for(u.makeEmpty();s<l;)c[6*s]=u.min.x,c[6*s+1]=u.min.y,c[6*s+2]=u.min.z,c[6*s+3]=u.max.x,c[6*s+4]=u.max.y,c[6*s+++5]=u.max.z;this.geomBoxes=c}var h=e.boundingBox;h?(this.geomBoxes[6*n]=h.min.x,this.geomBoxes[6*n+1]=h.min.y,this.geomBoxes[6*n+2]=h.min.z,this.geomBoxes[6*n+3]=h.max.x,this.geomBoxes[6*n+4]=h.max.y,this.geomBoxes[6*n+5]=h.max.z):(e.hash||console.error("Mesh without bbox and without hash should not be."),this.geomBoxes[6*n]=-.5,this.geomBoxes[6*n+1]=-.5,this.geomBoxes[6*n+2]=-.5,this.geomBoxes[6*n+3]=.5,this.geomBoxes[6*n+4]=.5,this.geomBoxes[6*n+5]=.5)}i.memoryOptimizedLoading&&!this.is2d&&(e.boundingBox=null,e.boundingSphere=null),this.geomMemory+=a;var d=e.attributes.index.array||e.ib,f=e.isLines?d.length/2:d.length/3;return this.geomPolyCount+=f,this.instancePolyCount+=f*(t||1),e.polyCount=f,e.instanceCount=t||1,e.svfid=n,e.lockCount=0,n},a.prototype.removeGeometry=function(e,t){var n=this.getGeometry(e);if(!n||n.lockCount>0)return 0;var o=n.byteSize+i.GEOMETRY_OVERHEAD;return t&&t.deallocateGeometry(n),n.streamingDraw||(Object(r.isMobileDevice)()&&(o+=n.byteSize),this.gpuMeshMemory-=n.byteSize,this.gpuNumMeshes-=1),this.geoms[e]=null,this.geomMemory-=o,this.numGeomsInMemory--,this.geomPolyCount-=n.polyCount,this.instancePolyCount-=n.instanceCount*n.polyCount,o},a.prototype.lockGeometry=function(e){var t=this.getGeometry(e);return!!t&&(++t.lockCount,!0)},a.prototype.unlockGeometry=function(e){var t=this.getGeometry(e);return!(!t||t.lockCount<=0)&&(--t.lockCount,!0)},a.prototype.getLockCount=function(e){var t=this.getGeometry(e);return t?t.lockCount:-1},a.prototype.getModelBox=function(e,t){if(this.geomBoxes)if(this.geomBoxes.length/6<=e)t.makeEmpty();else{var n=6*e,i=this.geomBoxes;t.min.x=i[n],t.min.y=i[n+1],t.min.z=i[n+2],t.max.x=i[n+3],t.max.y=i[n+4],t.max.z=i[n+5]}else e>=1&&e<this.numObjects?(t.min.x=-.5,t.min.y=-.5,t.min.z=-.5,t.max.x=.5,t.max.y=.5,t.max.z=.5):t.makeEmpty()},a.prototype.dispose=function(e){if(e)for(var t=0,n=this.geoms.length;t<n;t++)this.geoms[t]&&e.deallocateGeometry(this.geoms[t])},a.prototype.printStats=function(){o.log("Total geometry size: "+this.geomMemory/1048576+" MB"),o.log("Number of meshes: "+(this.geoms.length-1)),o.log("Num Meshes on GPU: "+this.gpuNumMeshes),o.log("Net GPU geom memory used: "+this.gpuMeshMemory)}},function(e,t,n){"use strict";n.r(t),n.d(t,"consolidateFragmentList",function(){return u});var i=n(54),r=n(97),o=n(72),a=n(0);var s,l,c=(s=null,l=[],function(e,t,n,i,c,u){s||(s=new a.Matrix4);var h=n[i],d=e.getGeometry(h),f=e.getMaterial(h),p=c-i;if(1!=p){l.length=0;for(var m=new r.InstanceBufferBuilder(d,p),g=i;g<c;g++){var v=n[g];e.getOriginalWorldMatrix(v,s);var y=e.fragments.fragId2dbId[v];m.addInstance(s,y)||l.push(v)}var _=m.finish();if(_){var b=t.getMaterialVariant(f,o.MATERIAL_VARIANT.INSTANCED,e.model);u.addContainerMesh(_,b,n,i,p)}for(g=0;g<l.length;g++)v=l[g],u.addSingleFragment(e,v)}else u.addSingleFragment(e,h)});function u(e,t,n,r,o){var s=r.supportsInstancedArrays();n=n||100<<20;var l=function(e){for(var t=e.getCount(),n=[],i=0;i<t;i++){var r=e.getGeometryId(i),o=0|n[r];n[r]=o+1}return n}(e);if(!o){var u=function(e,t){function n(n,i){var r=e.getGeometry(n),o=e.getGeometry(i),a=t[r.id],s=t[o.id],l=a*r.byteSize,c=s*o.byteSize;return l!=c?l-c:r.id!=o.id?r.id-o.id:e.getMaterialId(n)-e.getMaterialId(i)}for(var i=0,r=e.getCount(),o=new Int32Array(r),a=0;a<r;a++)e.getGeometry(a)&&(o[i]=a,i++);if(i<r&&(o=new Int32Array(o.buffer,o.byteOffset,i)),o.sort)o.sort(n);else{var s=new Array(r);for(a=0;a<r;a++)s[a]=o[a];for(s.sort(n),a=0;a<o.length;a++)o[a]=s[a]}return o}(e,l);o=function(e,t,n,r){for(var o=new a.Box3,s=new i.ConsolidationBuilder,l=0;l<n.length&&!(s.costs>=r);l++){var c=n[l];e.getWorldBounds(c,o);var u=e.getGeometry(c),h=e.getMaterial(c);s.addGeom(u,h,o,c)}return s.createConsolidationMap(n,l)}(e,0,u,n)}var h=o.buildConsolidation(e,t,e.model),d=o.fragOrder,f=o.numConsolidated;if(s)!function(e,t,n,i,r){if(!(i>=n.length)){for(var o=i,a=-1,s=-1,l=i;l<n.length;l++){var u=n[l],h=e.getGeometryId(u),d=e.getMaterialId(u);h==a&&d==s||(l!=i&&c(e,t,n,o,l,r),o=l,a=h,s=d)}c(e,t,n,o,n.length,r)}}(e,t,d,f,h);else for(var p=f;p<d.length;p++){var m=d[p];h.addSingleFragment(e,m)}!function(e,t,n,i){for(var r=e.geoms,o=[],a=0,s=0,l=0;l<t.meshes.length;l++){var c=t.meshes[l],u=c.geometry;u.byteSize||(u.byteSize=(u.vb.byteLength||0)+(u.ib.byteLength||0));var h=Number.isInteger(c.fragId);r.chooseMemoryType(u,u.numInstances,a,s),u.streamingDraw||(s+=u.byteSize,a+=1,h||(u.discardAfterUpload=!0)),h&&(o[u.id]=!0)}for(l=1;l<r.geoms.length;l++)if((u=r.geoms[l])&&!o[l]){var d=n[l];r.chooseMemoryType(u,d,a,s),u.streamingDraw&&i.deallocateGeometry(u),u.streamingDraw||(s+=u.byteSize,a+=1)}}(e,h,l,r);var g=e.model.getModelId();for(p=0;p<h.meshes.length;p++){h.meshes[p].modelId=g}return h}},function(e,t,n){"use strict";n.r(t),n.d(t,"ConsolidationIterator",function(){return l});var i=n(54),r=n(97),o=n(0),a=n(5),s=n(1);function l(e,t){var n=e,l=t,c=[],u=!1,h=[],d=new o.Matrix4,f=new o.Box3;this.getConsolidation=function(){return l},this.reset=function(){c.length=null;var e=n.getCount();u=!1;for(var t=n.db2ThemingColor.length>0,i=0;i<e;i++){var r=n.vizflags[i],o=0==(r&a.MeshFlags.MESH_VISIBLE),s=0!=(r&a.MeshFlags.MESH_HIDE),l=0!=(r&a.MeshFlags.MESH_MOVED),h=!1;if(t){var d=n.fragments.fragId2dbId[i];h=!!n.db2ThemingColor[d]}if(o||s||h||l){u=!0;break}}},this.dispose=function(){for(var e=0;e<l.meshes.length;e++){var t=l.meshes[e].geometry;t&&(t.dispose(),t.needsUpdate=!0)}},this.consolidateNextBatch=function(e,t){var i=e.nodeIndex;if(u||void 0===i)return e;if(l.inProgress)return e;for(var r=function(e){h[e]||(h[e]=new o.Scene);var t=h[e];return t.children.length=0,t}(i),a=e.start;a<e.lastItem;a++){var d,p=e.indices?e.indices[a]:a,m=l.fragId2MeshIndex[p];if(-1===m){if(!n.getGeometry(p))continue;return s.logger.warn("Warning: Missing fragment in consolidation. Consolidation disabled."),e}if(!c[m]&&(n.getWorldBounds(p,f),t.intersectsBox(f))){d=l.meshes[m],c[m]=!0;var g=d&&d.geometry,v=g&&(g.isLines||g.isWideLines),y=g&&g.isPoints;n.linesHidden&&v||n.pointsHidden&&y||r.children.push(d)}}return r.boundingBox||(r.boundingBox=new o.Box3),e.getBoundingBox(r.boundingBox),r.renderImportance=e.renderImportance,r.sortObjects=e.sortObjects,r};var p={Merged:1,Instanced:2,Original:3};function m(e){return e.numInstances?p.Instanced:e.attributes.id?p.Merged:p.Original}this.updateRenderProxy=function(e,t){if(e.geometry&&e.geometry.attributes){var o=function(e){if(u)return p.Original;var t=l.fragId2MeshIndex[e];return m(l.meshes[t].geometry)}(t);if(m(e.geometry)!=o){var a=n.getGeometry(t),s=l.fragId2MeshIndex[t],c=l.meshes[s];if(o===p.Original)e.geometry=a,e.material=n.getMaterial(t),n.getWorldMatrix(t,e.matrix);else if(o===p.Instanced){n.getWorldMatrix(t,d);var h=n.fragments.fragId2dbId[t],g=new r.InstanceBufferBuilder(a,1);g.addInstance(d,h),e.geometry=g.finish(),e.material=c.material,e.matrix.identity()}else n.getWorldMatrix(t,d),n.getWorldBounds(t,f),h=n.fragments.fragId2dbId[t],e.geometry=Object(i.mergeGeometries)([a],d.elements,[h],f),e.material=c.material,e.matrix.identity();e.dispatchEvent({type:"removed"})}}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"ModelIteratorBVH",function(){return s});var i=n(29),r=n(113),o=n(27),a=n(0);function s(){var e,t,n,s,l=null,c=null,u=null,h=null,d=null,f=null,p=1,m=!0,g=!1,v=!1,y=new a.Box3,_=new a.Box3,b=!1,x=!0;function w(e){var i=f[e],r=n;if(p)for(;r>t&&f[d[r-1]]>i;)d[r]=d[r-1],r--;else for(;r>t&&f[d[r-1]]<i;)d[r]=d[r-1],r--;d[r]=e,n++}function A(e){var t=l.getLeftChild(e);-1!==t&&(A(t),A(t+1)),y.makeEmpty(),-1!==t&&(l.getBoxThree(t,_),y.union(_),l.getBoxThree(t+1,_),y.union(_)),l.getPrimCount(e)&&(y.union(u[e].getBoundingBox()),y.union(u[e].getBoundingBoxHidden())),l.setBoxThree(e,y)}this.initialize=function(t,n,o,a){e=t.getFragmentList(),a&&a.hasOwnProperty("prioritize_screen_size")&&(m=a.prioritize_screen_size),c=o,u=new Array(n.nodeCount),h=new Int8Array(n.nodeCount),l=n,d=new Int32Array(n.nodeCount+1),f=new Float32Array(n.nodeCount);for(var s=e.onDemandLoadingEnabled()?r.a:i.RenderBatch,p=0;p<n.nodeCount;p++){var g=n.getPrimCount(p);g&&(u[p]=new s(e,c,n.getPrimStart(p),g),u[p].lastItem=u[p].start+g,u[p].numAdded=g,u[p].nodeIndex=p,8&n.getFlags(p)&&(u[p].sortObjects=!0),n.getBoxArray(p,u[p].bboxes))}},this.addFragment=function(e,t){},this.reset=function(e){if(s=e,t=0,n=0,h[0]=h[1]=o.FrustumIntersector.CONTAINMENT_UNKNOWN,d[n++]=0,g=!1,v=!1,b=!1,x){for(var i=u,r=i.length,a=0;a<r;++a){var l=i[a];l&&l.resetVisStatus&&l.resetVisStatus()}x=!1}},this.nextBatch=function(){for(v||g||t!==n||(d[n++]=1,g=!0);t!==n;){var e=p||g?d[--n]:d[t++],i=h[e];if(i!==o.FrustumIntersector.CONTAINS&&(l.getBoxThree(e,y),i=s.intersectsBox(y)),i!==o.FrustumIntersector.OUTSIDE){var r,a,c=l.getLeftChild(e);if(-1!==c){var _=l.getFlags(e),x=s.viewDir[3&_]<0?1:0,A=_>>2&1,E=_>>3&1,T=p||g?1:0,M=0,S=0;m&&!g?(r=c+A,a=c+1-A,l.getBoxThree(r,y),f[r]=M=s.projectedBoxArea(y,i===o.FrustumIntersector.CONTAINS),l.getBoxThree(a,y),f[a]=S=s.projectedBoxArea(y,i===o.FrustumIntersector.CONTAINS),h[r]=h[a]=i,M>0&&w(r),S>0&&w(a)):(x^T^E&&(A=1-A),r=c+A,a=c+1-A,d[n++]=r,f[r]=-1,d[n++]=a,f[a]=-1,h[r]=h[a]=i)}if(0!==l.getPrimCount(e)){var C=u[e];return C.renderImportance=s.projectedBoxArea(C.getBoundingBox(),i===o.FrustumIntersector.CONTAINS),C}}g||v||t!==n||(d[n++]=1,g=!0)}return b=!0,null},this.skipOpaqueShapes=function(){g||v||(t=0,n=0,d[n++]=1,v=!0)},this.getVisibleBounds=function(e,t){for(var n=0;n<u.length;n++){var i=u[n];if(i){i.calculateBounds();var r=i.getBoundingBox();e.union(r),t.union(r),t.union(i.getBoundingBoxHidden())}}A(0),A(1)},this.rayCast=function(e,t,n){for(var i=[1,0],r=new a.Vector3;i.length;){var o=i.pop();if(l.getBoxThree(o,y),y.expandByScalar(.5),null!==e.ray.intersectBox(y,r)){var s=l.getLeftChild(o);if(-1!==s&&(i.push(s),i.push(s+1)),0!==l.getPrimCount(o))u[o].raycast(e,t,n)}}},this.getSceneCount=function(){return u.length},this.getGeomScenes=function(){return u},this.resetVisStatus=function(){x=!0},this.done=function(){return b}}},function(e,t,n){"use strict";function i(e){var t=e||function(e,t){return e<t},n=[],i=[];this.add=function(e){var r=function e(r,o,a){if(o||(o=0),a||(a=i.length),o>=a)return a;if(a===o+1){var s=n[i[o]];return t(s,r)?a:o}var l=parseInt(o+(a-o)/2),c=n[i[l-1]];return t(r,c)?e(r,o,l):t(c,r)?e(r,l,a):l-1}(e);if(r==i.length)return n.push(e),void i.push(n.length-1);n.push(e),i.splice(r,0,n.length-1)},this.size=function(){return i.length},this.get=function(e){return n[i[e]]},this.removeAt=function(e){var t=i[e];n[t]=void 0,i.splice(e,1)},this.toString=function(){for(var e="",t=0,n=this.size();t<n;++t)e+=this.get(t),t<n-1&&(e+=", ");return e}}n.r(t),n.d(t,"SortedList",function(){return i})},function(e,t,n){"use strict";function i(){this.entries={},this.add=function(e,t){this.entries[e]={callback:t}},this.remove=function(e){this.entries[e]&&delete this.entries[e]},this.render=function(){for(var e in this.entries)this.entries[e].callback()}}n.r(t),n.d(t,"RenderCallbacks",function(){return i})},function(e,t,n){"use strict";n.r(t),n.d(t,"RenderScene",function(){return c});var i=n(14),r=n(27),o=n(0),a=n(5),s=n(13),l=n(44);function c(){var e=!1,t=!1,n=0,c=[],u=[],h=[],d=new o.Box3,f=[],p=new r.FrustumIntersector,m=new o.Raycaster,g=performance,v=i.PAGEOUT_NONE;this.enableNonResumableFrames=!1,this.budgetForTransparent=.1;var y=!1,_=[],b=null;function x(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i&&i.id===t)return i}return null}function w(e,t){void 0===e.avgFrameTime?e.avgFrameTime=t:e.avgFrameTime=.8*e.avgFrameTime+.2*t}this.frustum=function(){return p},this.findModel=function(e){return x(c,e)},this.findHiddenModel=function(e){return x(f,e)},this.addModel=function(e){c.push(e),u.length=c.length,h.length=c.length,this.recomputeLinePrecision()},this.removeModel=function(e){var t=c.indexOf(e);return t>=0&&c.splice(t,1),u.length=c.length,h.length=c.length,this.recomputeLinePrecision(),t>=0},this.addHiddenModel=function(e){var t=f.indexOf(e);return t<0&&f.push(e),t<0},this.removeHiddenModel=function(e){var t=f.indexOf(e);return t>=0&&f.splice(t,1),t>=0},this.isEmpty=function(){return 0===c.length},this.needsRender=function(){return e},this.resetNeedsRender=function(){e=!1},this.recomputeLinePrecision=function(){for(var e=1,t=0,n=c.length;t<n;++t){var i=c[t].getData().bbox,r=o.Box3.prototype.getBoundingSphere.call(i).radius/1e3;e=Math.min(e,r)}m.linePrecision=e},this.frameResumePossible=function(){return!y},this.renderSome=function(i,r,o){for(var s,l,d=g.now(),f=0===n,p=this.budgetForTransparent*r;;){for(var m=0,x=null,A=0;A<u.length;A++){var E=u[A];if(l=c[A],E||(u[A]=E=l.nextBatch()),y&&r<p)E&&!E.sortObjects&&(l.skipOpaqueShapes(),E=l.nextBatch());null!==E&&(x||(m=A,x=E),E.renderImportance>x.renderImportance&&(m=A,x=E))}if(!x){t=!0;for(var T=0;T<c.length;++T)if((l=c[T])&&l.is2d()&&!l.isLoadDone()&&!l.getFragmentList().onDemandLoadingEnabled()){t=!1;break}break}if(c[m].is2d()&&c[m].getFragmentList()&&c[m].getFragmentList().onDemandLoadingEnabled()){var M=h[m];x.drawOrderRender=M&&M.drawOrderRender<M.lastItem?x.start:x.lastItem,h[m]=x}if(u[m]=c[m].nextBatch(),n++,x.sortObjects&&y)_.push(x),r-=void 0===x.avgFrameTime?.05:x.avgFrameTime;else{i(x),x.hasOwnProperty("drawEnd")&&(x.drawEnd=x.lastItem);var S=(s=g.now())-d;d=s,w(x,S),r-=x.avgFrameTime}if(c[m].getFragmentList()&&c[m].getFragmentList().onDemandLoadingEnabled())for(var C,P=x.start,L=x.lastItem,R=c[m].getFragmentList().vizflags,D=x.getIndices();P<L;)R[C=D?D[P]:P]&a.MeshFlags.MESH_DRAWN&&(R[C]=(R[C]|a.MeshFlags.MESH_TRAVERSED)&~a.MeshFlags.MESH_DRAWN),++P;if(r<=0)break}var I=c[0].frameUpdatePaging(f,o);return(v!=I||c[0].needResumeNextFrame())&&(e=!0,v=I),_.length>0&&(!function(e,t,n){var i,r;for(i=0;i<e.length;i++){var o=(r=e[i]).boundingBox||r.getBoundingBox();r.cameraDistance=o.distanceToPoint(t.position)}e.sort(function(e,t){return t.cameraDistance-e.cameraDistance});var a=performance.now();for(i=0;i<e.length;i++){n(r=e[i]);var s=performance.now(),l=s-a;a=s,w(r,l)}}(_,b,i),_.length=0),r},this.reset=function(e,r,o,a,d){if(t=!1,n=0,this.resetNeedsRender(),p.reset(e,a),p.areaCullThreshold=i.PIXEL_CULLING_THRESHOLD,c.length){y=this.enableNonResumableFrames&&o==l.ResetFlags.RESET_RELOAD&&r===s.RenderFlags.RENDER_NORMAL,b=e;for(var f=0;f<c.length;f++)c[f].resetIterator(e,p,r,o,d),u[f]=c[f].nextBatch(),h[f]=null}},this.isDone=function(){return t||this.isEmpty()},this.setAllVisibility=function(e){for(var t=0;t<c.length;t++)c[t].setAllVisibility(e)},this.hideLines=function(e){for(var t=0;t<c.length;t++)c[t].hideLines(e)},this.hidePoints=function(e){for(var t=0;t<c.length;t++)c[t].hidePoints(e)},this.hasHighlighted=function(){for(var e=0;e<c.length;e++)if(c[e].hasHighlighted())return!0;return!1},this.areAllVisible=function(){for(var e=0;e<c.length;e++)if(!c[e].areAllVisible())return!1;return!0},this.areAll2D=function(){for(var e=0;e<c.length;e++)if(!c[e].is2d())return!1;return!0},this.areAll3D=function(){for(var e=0;e<c.length;e++)if(!c[e].is3d())return!1;return!0},this.invalidateVisibleBounds=function(){for(var e=0;e<c.length;e++)c[e].visibleBoundsDirty=!0},this.getVisibleBounds=function(e){if(1===c.length)return c[0].getVisibleBounds(e);d.makeEmpty();for(var t=0;t<c.length;t++)d.union(c[t].getVisibleBounds(e));return d},this.rayIntersect=function(e,t,n,i,r,o){var a;if(m.set(e,t),c.length>1){var s=[];if(r)for(a=0;a<r.length;a++){if(h=this.findModel(r[a])){var l=i&&i[a];(u=h.rayIntersect(m,n,l))&&s.push(u)}}else for(a=0;a<c.length;a++){var u;if(!c[a].is2d())(u=c[a].rayIntersect(m,n,i,o))&&s.push(u)}return s.length?(s.sort(function(e,t){return e.distance-t.distance}),s[0]):null}if(!c.length||c[0].is2d())return null;var h=c[0];return r&&-1===r.indexOf(h.id)?null:h.rayIntersect(m,n,i,o)},this.getRenderProgress=function(){return c[0].getRenderProgress()},this.getModels=function(){return c},this.getHiddenModels=function(){return f},this.getFragmentList=function(){return c[0].getFragmentList()},this.getGeometryList=function(){return c[0].getGeometryList()},this.getSceneCount=function(){return c[0].getSceneCount()},this.getGeomScenes=function(){return c[0].getGeomScenes()},this.geomPacksMissingLastFrame=function(){return c[0].geomPacksMissingLastFrame()},this.explode=function(e){if(c.length){for(var t=new o.Vector3,n=0;n<c.length;n++){var i=c[n],r=i.getData().instanceTree,a=i.getFragmentList(),s=i.getVisibleBounds(!0).center();if(e*=2,r&&r.nodeAccess.nodeBoxes&&0!==e){var l=e*(r.maxDepth-1)+1,u=0|l,h=l-u,d=new Float32Array(6);!function n(i,o,s,l,c,f,p,m){var g=2*e;o==u&&(g*=h),r.getNodeBox(i,d);var v=.5*(d[0]+d[3]),y=.5*(d[1]+d[4]),_=.5*(d[2]+d[5]);o>0&&o<=u&&(f+=(v-s)*g,p+=(y-l)*g,m+=(_-c)*g);r.enumNodeChildren(i,function(e){n(e,o+1,v,y,_,f,p,m)},!1),t.x=f,t.y=p,t.z=m,r.enumNodeFragments(i,function(e){a.updateAnimTransform(e,null,null,t)},!1)}(r.getRootId(),0,s.x,s.y,s.x,0,0,0)}else for(var f=a.fragments.boxes,p=0,m=a.getCount();p<m;p++)if(0==e)a.updateAnimTransform(p);else{var g=6*p,v=.5*(f[g]+f[g+3]),y=.5*(f[g+1]+f[g+4]),_=.5*(f[g+2]+f[g+5]);t.x=e*(v-s.x),t.y=e*(y-s.y),t.z=e*(_-s.z),a.updateAnimTransform(p,null,null,t)}}this.invalidateVisibleBounds()}},this.update=function(e){for(var t=!1,n=0;n<c.length;n++){var i=c[n];t=t||i.update(e)}return t},this.hideModel=function(e){for(var t=0;t<c.length;t++){var n=c[t];if(n&&n.id===e)return this.removeModel(n),f.push(n),!0}return!1},this.showModel=function(e){for(var t=0;t<f.length;++t){var n=f[t];if(n&&n.id===e)return this.addModel(n),f.splice(t,1),!0}return!1},this.getMemoryInfo=function(){var e,t={limit:0,effectiveLimit:0,loaded:0};function n(n){for(var i=0;i<n.length;++i){var r=n[i].getMemoryInfo();r&&(e=r,t.limit+=r.limit,t.effectiveLimit+=r.effectiveLimit,t.loaded+=r.loaded)}}return n(c),n(f),e?t:null}}},function(e,t,n){"use strict";n.r(t),n.d(t,"DbidFragmentMap",function(){return s});var i=16777216,r=33554432,o=16777215,a=-1<<30;function s(e){this.numOffs=0,this.numHidden=0;var t,n={};!function(e){var i=0,r=[],o=[0];function a(t){for(var n=0,i=e.length;n<i;n++){var r=e[n];Array.isArray(r)||(o[0]=r,r=o);for(var a=0;a<r.length;a++)t(n,r[a])}}a(function(e,t){var o=n[t];void 0===o&&(n[t]=o=r.length,r.push(0),r.push(0)),++r[o],++i}),(t=new Uint32Array(i+r.length/2)).fill(0);var s,l,c=0;for(s in n){l=n[s];var u=r[l],h=c+u+1;t[c]=u,r[l]=r[l+1]=c,c=h}var d=!1;for(s in a(function(e,i){var o=n[i],a=r[o+1]+1;a>t.length||t[a]?d||(console.error("DbidFragmentMap.buildMap: Internal error fragment overlap"),d=!0):(t[a]=e,r[o+1]=a)}),d=!1,n){l=n[s];var f=r[l+1]+1;f<t.length&&!t[f]&&(d||(console.error("DbidFragmentMap.buildMap: Internal error fragment underfilled"),d=!0))}for(s in n)l=n[s],n[s]=r[l]}(e),this.setFlagNode=function(e,i,r){if(!n.hasOwnProperty(e))return!1;var o=n[e];return!!(t[o]&i)!=r&&(r?t[o]|=i:t[o]&=~i,!0)},this.setNodeOff=function(e,t){var n=this.setFlagNode(e,i,t);return n&&(t?this.numOff++:this.numOff--),n},this.isNodeOff=function(e){var r=n[e];return!!(t[r]&i)},this.setNodeHidden=function(e,t){var n=this.setFlagNode(e,r,t);return n&&(t?this.numHidden++:this.numHidden--),n},this.isNodeHidden=function(e){var i=n[e];return!!(t[i]&r)},this.getRootId=function(){return a},this.enumNodeFragments=function(e,i){var r;"number"==typeof e?r=e:e&&(r=e.dbId);for(var a=n[r],s=(t[a]&o)+a+1;++a<s;)i(t[a],r)},this.enumNodeChildren=function(e,t,i){if(i&&t(e),e==a)for(var r in n)t(Number(r))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"LiveReviewClient",function(){return s}),n.d(t,"InteractionInterceptor",function(){return l}),n.d(t,"ViewTransceiver",function(){return c});var i=n(32),r=n(92),o=n(99),a=n(2);function s(e){this.viewer=e,this.messageClient=null,this.presenceChannelId=null,this.viewtx=null,this.interceptor=null}function l(e){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(e){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e,t){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(t){return e.takeControl(),!1},this.handleButtonDown=function(t,n){return e.takeControl(),!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(t){return e.updatePointer(t),!1},this.handleGesture=function(t){return e.takeControl(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}}function c(e){var t,n,i=this,r=this.viewer=null,s=!1,l=!1,c=!1,u=this.client=e,h=new THREE.Ray,d=null,f=!1;this.channelId=null;var p={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};function m(e){s=!0;var t=JSON.parse(e.data.msg);n.restoreState(t),r.impl.invalidate(!0,!1,!0),s=!1}function g(e){return Math.round(1e3*e)/1e3}function v(e){for(var t=0;t<e.length;t++)e[t]=g(e[t])}function y(e){var n=e.data.msg;!0===n[1]||c||(n[0]!=t&&(t=n[0],e.data.lastInControl=n[0],i.dispatchEvent({type:"controlChange",channelId:i.channelId,data:e.data})),l=!1,r.navigation.setView((new THREE.Vector3).set(n[2],n[3],n[4]),(new THREE.Vector3).set(n[5],n[6],n[7])),r.navigation.setCameraUpVector((new THREE.Vector3).set(n[8],n[9],n[10])))}function _(n){if(l||c){var r=n.camera,o=[r.position.x,r.position.y,r.position.z,r.target.x,r.target.y,r.target.z,r.up.x,r.up.y,r.up.z];v(o),o.unshift(c),o.unshift(e.getLocalId()),u.sendMessage("camera",o,i.channelId),t!=o[0]&&(t=o[0],i.dispatchEvent({type:"controlChange",channelId:i.channelId,data:{lastInControl:t}}))}}function b(e,t,n){e&&!d&&(d=document.createElement("div")).classList.add("collabPointer"),e&&!f?(r.container.appendChild(d),f=!0):!e&&f&&(r.container.removeChild(d),f=!1),e&&(d.style.left=t-6+"px",d.style.top=n-6+"px")}function x(e){if(!l&&!c){var t=e.data.msg;h.origin.set(t[1],t[2],t[3]),h.direction.set(t[4],t[5],t[6]);var n=h.at(r.getCamera().near);n.project(r.getCamera()),b(!0,(n=r.impl.viewportToClient(n.x,n.y)).x,n.y)}}function w(t){if(!s){var r=n.getState(p);e.sendMessage("state",JSON.stringify(r),i.channelId)}}this.takeControl=function(){l=!0,b(!1)},this.updatePointer=function(t){!function(t){if(l){var n=r.impl.clientToViewport(t.canvasX,t.canvasY);r.impl.viewportToRay(n,h);var o=[h.origin.x,h.origin.y,h.origin.z,h.direction.x,h.direction.y,h.direction.z];v(o),o.unshift(e.getLocalId()),u.sendMessage("pointer",o,i.channelId)}}(t)},this.connectCamera=function(e){c=!e},this.attach=function(e,t){r&&this.detach(),this.viewer=r=e,n=new o.ViewerState(r),u.addEventListener("cameraChange",y),u.addEventListener("pointerMove",x),r.hasEventListener(a.CAMERA_CHANGE_EVENT,_)||r.addEventListener(a.CAMERA_CHANGE_EVENT,_),t||(u.addEventListener("viewerState",m),r.hasEventListener(a.SELECTION_CHANGED_EVENT,w)||(r.addEventListener(a.SELECTION_CHANGED_EVENT,w),r.addEventListener(a.ISOLATE_EVENT,w),r.addEventListener(a.HIDE_EVENT,w),r.addEventListener(a.SHOW_EVENT,w),r.addEventListener(a.EXPLODE_CHANGE_EVENT,w),r.addEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,w),r.addEventListener(a.CUTPLANES_CHANGE_EVENT,w)))},this.detach=function(){b(!1),u&&(u.removeEventListener("cameraChange",y),u.removeEventListener("viewerState",m)),r&&(r.removeEventListener(a.CAMERA_CHANGE_EVENT,_),r.removeEventListener(a.SELECTION_CHANGED_EVENT,w),r.removeEventListener(a.ISOLATE_EVENT,w),r.removeEventListener(a.HIDE_EVENT,w),r.removeEventListener(a.SHOW_EVENT,w),r.removeEventListener(a.EXPLODE_CHANGE_EVENT,w),r.removeEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,w),r.removeEventListener(a.CUTPLANES_CHANGE_EVENT,w),this.viewer=r=null,n=null)}}s.prototype.destroy=function(){this.leaveLiveReviewSession()},s.prototype.joinLiveReviewSession=function(e){this.messageClient||(this.messageClient=r.MessageClient.GetInstance()),this.presenceChannelId||(this.presenceChannelId=window.location.host),this.messageClient.isConnected()||this.messageClient.connect(e),this.viewtx||(this.viewtx=new c(this.messageClient)),this.viewtx.channelId=e,this.viewtx.attach(this.viewer),this.messageClient.join(this.viewtx.channelId),this.interceptor||(this.interceptor=new l(this.viewtx)),this.viewer.toolController.registerTool(this.interceptor),this.viewer.toolController.activateTool(this.interceptor.getName())},s.prototype.leaveLiveReviewSession=function(){this.viewtx&&this.viewtx.detach(this.viewer),this.messageClient&&this.messageClient.disconnect(),this.interceptor&&this.viewer.toolController.deactivateTool(this.interceptor.getName()),this.viewtx=null,this.messageClient=null,this.interceptor=null},c.prototype.constructor=c,i.EventDispatcher.prototype.apply(c.prototype)},function(e,t,n){"use strict";n.r(t),n.d(t,"ModelLayers",function(){return s});var i=n(1),r=n(2),o=1024,a={name:"root",id:"root",isLayer:!1,children:[],childCount:0};function s(e){this.viewer=e,this.matman=e.matman(),this.model=null,this.root=null,this.initialized=!1,this.layerToIndex={},this.indexToLayer=[null],this.nodeToLayer=[]}var l=s.prototype;function c(e,t){var n=e.model,i=e.indexToLayer;if(n.is2d()){var r=[];for(var a in e.layerToIndex)r.push(e.layerToIndex[a]);e.matman.setLayerVisible(r,t),e.viewer.invalidate(!0)}else{var s=[],l=t?e.viewer.visibilityManager.show:e.viewer.visibilityManager.hide;u(e,function(e,r){i[r].visible!==t&&(s.push(e),s.length===o&&(l(s,n),s.length=0))}),s.length>0&&l(s,n)}for(var c=i.length,h=1;h<c;++h){var d=i[h];d&&(d.visible=t)}}function u(e,t){var n=e.nodeToLayer;if(n&&n.length){var i=e.model.getData().instanceTree.nodeAccess;for(var r in i.dbIdToIndex){var o=n[i.dbIdToIndex[r]]||0;0!==o&&t(0|r,o)}}}function h(e,t){return"number"==typeof t?t:e.layerToIndex[t.name||t]||0}l.addModel=function(e){var t=function(t){var n=this.model.getData().instanceTree;if(t){t.children=t.children||[],t.childCount=t.children.length,this.indexToLayer=new Array(t.childCount+1),this.indexToLayer[0]=null;for(var r=0;r<t.childCount;++r){var o=t.children[r],a=o.name,s=o.id,l=o.index;this.indexToLayer[l]={name:a,id:s,index:l,visible:!0},this.layerToIndex[a]=l}if(!this.model.is2d()&&0!==t.childCount){this.nodeToLayer=t.childCount<=256?new Uint8Array(n.nodeAccess.getNumNodes()):new Uint16Array(n.nodeAccess.getNumNodes());var c=function(e){if(this.model){var t=this.model.getData().instanceTree;for(var n in e)if(e.hasOwnProperty(n))for(var i=this.layerToIndex[n],r=e[n],o=0,a=r.length;o<a;++o){var s=t.nodeAccess.getIndex(r[o]);this.nodeToLayer[s]=i}}}.bind(this),u=function(){i.logger.warn("ModelLayers error: coudn't get layers from property database.")}.bind(this);e.getLayerToNodeIdMapping(c,u)}}}.bind(this),n=function(t){this.root=t,this.initialized=!0,this.activateLayerState("Initial"),this.viewer.api.dispatchEvent({type:r.MODEL_LAYERS_LOADED_EVENT,model:e,root:t})}.bind(this);this.model=e,(e.is2d()?function(e){var t=e.getData(),n=a;t&&t.layersRoot&&(n=t.layersRoot);return Promise.resolve(n)}(e):function(e,t){if(t.getData().loadOptions.skipPropertyDb)return Promise.resolve(null);var n=t.getPropertyDb();if(!n||t.getData().loadOptions.disable3DModelLayers)return Promise.resolve(a);return n.findLayers()}(0,e)).then(function(e){t(e),n(e)}).catch(function(e){i.logger.warn(e),n(a)})},l.removeModel=function(e){this.model===e&&(this.model=null,this.root=null,this.initialized=!1,this.layerToIndex={},this.indexToLayer=[null],this.nodeToLayer=[])},l.getRoot=function(){return this.initialized||i.logger.warn("Autodesk.Viewing.ModelLayers.getRoot couldn't peform action, layers are still being loaded"),this.root},l.showAllLayers=function(){c(this,!0)},l.hideAllLayers=function(){c(this,!1)},l.isLayerVisible=function(e){return this.initialized?(e=h(this,e),this.indexToLayer[e]&&this.indexToLayer[e].visible):(i.logger.warn("Autodesk.Viewing.ModelLayers.isLayerVisible couldn't peform action, layers are still being loaded"),!1)},l.setLayerVisible=function(e,t){if(this.initialized){var n=Array.isArray(e)?e:[e];n=e.map(function(e){return h(this,e)}.bind(this));var r=this.model,a=this.indexToLayer;if(r.is2d())this.matman.setLayerVisible(n,t),this.viewer.invalidate(!0);else{var s=a.map(function(e){return!(null!==e&&-1!==n.indexOf(e.index)&&e.visible!==t)}),l=[],c=t?this.viewer.visibilityManager.show:this.viewer.visibilityManager.hide;u(this,function(e,t){s[t]||(l.push(e),l.length===o&&(c(l,r),l.length=0))}),l.length>0&&c(l,r)}for(var d=n.length,f=0;f<d;++f){var p=this.indexToLayer[n[f]];p&&(p.visible=t)}}else i.logger.warn("Autodesk.Viewing.ModelLayers.setLayersVisible couldn't peform action, layers are still being loaded")},l.getVisibleLayerIndices=function(){if(!this.initialized)return i.logger.warn("Autodesk.Viewing.ModelLayers.getVisibleLayerIndices couldn't peform action, layers are still being loaded"),[];this.model;for(var e=[],t=this.indexToLayer,n=t.length,r=1;r<n;++r){var o=t[r];o&&o.visible&&e.push(o.index)}return e},l.activateLayerState=function(e){if(this.initialized&&this.model){var t=this.model.getData().metadata,n=t?t.layer_states:null;if(!this.model.is3d()&&n&&e){var r;for(r=0;r<n.length&&n[r].name!==e;r++);if(r<n.length){var o=n[r].visible_layers,a={};if(o&&0<o.length)for(var s=0;s<o.length;s++)a[o[s]]=1;var l=[],c=[];for(var u in t.layers){var h=t.layers[u].name;u|=0,1===a[h]?l.push(u):c.push(u)}this.setLayerVisible(l,!0),this.setLayerVisible(c,!1)}}}else i.logger.warn("Autodesk.Viewing.ModelLayers.activateLayerState couldn't peform action, layers are still being loaded")},l.getLayerStates=function(){function e(e,t){var n=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(t);if(n.length!==i.length)return!1;for(var r=0;r<n.length;++r){var o=n[r];if(e[o]!==t[o])return!1}return!0}if(!this.initialized)return i.logger.warn("Autodesk.Viewing.ModelLayers.getLayerStates couldn't peform action, layers are still being loaded"),null;var t,n=this.model,r=n?n.getData().metadata:null,o=r?r.layers:null,a=r?r.layer_states:null;if(this.model.is3d()||!o||!a)return null;var s={},l={};for(var c in o)if(o.hasOwnProperty(c)){var u=parseInt(c),h=o[c];s[t="string"==typeof h?h:h.name]=!0,this.isLayerVisible(u)&&(l[t]=!0)}for(var d=[],f=0;f<a.length;++f){var p=a[f],m=p.visible_layers,g={};if(!p.hidden){if(m&&0<m.length)for(var v=0;v<m.length;++v)t=m[v],s.hasOwnProperty(t)&&(g[t]=!0);d.push({name:p.name,description:p.description,active:e(l,g)})}}return 0<d.length?d:null}},function(e,t,n){"use strict";n.r(t),n.d(t,"LeafletLoader",function(){return p});var i=n(34),r=n(7),o=n(1),a=n(12),s=n(71),l=n(33),c=n(47),u=n(52),h=n(4),d=n(2),f=n(0);function p(e){var t=e,n=function(e,t){var n=[80,75,1,2],i=t;if(e[i++]!==n[0]||e[i++]!==n[1]||e[i++]!==n[2]||e[i++]!==n[3])return o.logger.error("invalid file header signature"),null;var r={};return r.version=e[i++],r.os=e[i++],r.needVersion=e[i++]|e[i++]<<8,r.flags=e[i++]|e[i++]<<8,r.compression=e[i++]|e[i++]<<8,r.time=e[i++]|e[i++]<<8,r.date=e[i++]|e[i++]<<8,r.crc32=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,r.compressedSize=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,r.plainSize=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,r.fileNameLength=e[i++]|e[i++]<<8,r.extraFieldLength=e[i++]|e[i++]<<8,r.fileCommentLength=e[i++]|e[i++]<<8,r.diskNumberStart=e[i++]|e[i++]<<8,r.internalFileAttributes=e[i++]|e[i++]<<8,r.externalFileAttributes=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24,r.relativeOffset=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,r.filename=String.fromCharCode.apply(null,e.slice(i,i+=r.fileNameLength)),r.extraField=e.slice(i,i+=r.extraFieldLength),r.comment=e.slice(i,i+r.fileCommentLength),r.length=i-t,r},c=function(e){var t=function(e){var t=[80,75,3,4],n=0;if(e[n++]!==t[0]||e[n++]!==t[1]||e[n++]!==t[2]||e[n++]!==t[3])return o.logger.error("invalid local file header signature"),null;var i={};return i.needVersion=e[n++]|e[n++]<<8,i.flags=e[n++]|e[n++]<<8,i.compression=e[n++]|e[n++]<<8,i.time=e[n++]|e[n++]<<8,i.date=e[n++]|e[n++]<<8,i.crc32=(e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24)>>>0,i.compressedSize=(e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24)>>>0,i.plainSize=(e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24)>>>0,i.fileNameLength=e[n++]|e[n++]<<8,i.extraFieldLength=e[n++]|e[n++]<<8,i.filename=String.fromCharCode.apply(null,e.slice(n,n+=i.fileNameLength)),i.extraField=e.slice(n,n+=i.extraFieldLength),i.length=n,i}(e),n=t.length,i=t.compressedSize;return e.slice(n,n+i)};this.continueLoadFile=function(e,n,r,a,l,c){var h,p=this;n.loadOptions&&n.loadOptions.loadFromZip?h="{z}/{x}_{y}."+n.loadOptions.mime.split("/")[1]:h=e;l.initFromLoadOptions(h,n.loadOptions,c);var m=null;function g(){var a=new function(n){this.bbox=new f.Box3,this.basePath=e,this.is2d=!0;var r=n&&n.paperWidth>=0?n.paperWidth:l.texWidth,o=n&&n.paperHeight>=0?n.paperHeight:l.texHeight;this.pageToModelTransform=l.getPageToModelTransform(r,o),this.metadata={},this.metadata.page_dimensions={};var a=this.metadata.page_dimensions;a.page_width=r,a.page_height=o,a.page_units=n.paperUnits,this.loadDone=!0,this.isLeaflet=!0,t.signalProgress(100,i.ProgressState.LOADING),l.texWidth>0&&(this.maxPixelPerUnit=l.texWidth/l.getQuadWidth(),l.isSimpleImage&&(this.maxPixelPerUnit*=10))}(n.loadOptions);a.loadOptions=n,m.getVisibleBounds(a.bbox);var s=new u.Model(a);s.initFromCustomIterator(m),s.loader=p,t.api.dispatchEvent({type:d.MODEL_ROOT_LOADED_EVENT,svf:a,model:s}),m.callWhenRefined(function(){var e=Date.now();a.loadTime=e-p.t0,o.logger.log("SVF load: "+a.loadTime)}),r(null,s)}a&&a();var v=!l.valid();v&&l.initForSimpleImage(e,g),l.pixelRatio=t.glrenderer().getPixelRatio(),m=new s.ModelIteratorTexQuad(l,t.getMaterials()),v||g()},this.loadFile=function(e,t,i,u){var d=this;this.t0=Date.now();var p=new s.TexQuadConfig,m=null,g=t.acmSessionId;if(t.loadOptions&&t.loadOptions.loadFromZip){m=function(e,t,n){for(var i,r=e.split("/")[0]-p.levelOffset,o=0;o<p.zips.length;o++)if(r<=p.zips[o].zipMaxLevel){i=p.zips[o];break}if(!i)return n("Failed loading texture - tile's level doesn't exists."),!1;var a=i.fileTable[e];if(!a)return n("Failed loading texture - entry does not exist inside fileTable."),!1;var s={extractImage:c},u=a.relativeOffset,h=a.relativeOffset+a.contentSize;if(i.rawData)s.rawData=i.rawData.slice(u,h);else{var d="start="+u+"&end="+h;s.queryParams=d}l.TextureLoader.loadTextureWithSecurity(i.urnZip,!1,f.UVMapping,t,g,!0,s)};t.loadOptions.zips.forEach(function(s){var l=s.centralDirOffset,c=s.centralDirLength,f=s.centralDirEntries;!function(e,t,n,i,r,o){var s=null;if(!Object(h.isOffline)()){t&&(s="acmsession="+t);var l="start="+n+"&end="+(i+n);s?s+="&"+l:s=l}var c=Object(h.initLoadContext)({queryParams:s});a.ViewingService.getItem(c,e,r,o)}(s.urnZip,g,l,c,function(r){Object(h.isOffline)()&&(s.rawData=r,r=r.slice(l,l+c));var o=function(e,t,i){for(var r,o=0,a=[],s=null,l=0;l<i;++l){if(!(r=n(e,o)))return null;s&&(s.contentSize=r.relativeOffset-s.relativeOffset),o+=r.length,a[r.filename]=r,s=r}return s.contentSize=t-s.relativeOffset,a}(r,l,f);if(!o)return i("Failed parsing central directory of the zip.",null),!1;s.fileTable=o,t.loadOptions.zips.every(function(e){return!!e.fileTable})&&d.continueLoadFile(e,t,i,u,p,m)},function(e){o.logger.error("Zip download failed: "+e.statusText,Object(r.errorCodeString)(r.ErrorCodes.NETWORK_FAILURE)),i("Zip download failed: "+e.statusText,null)})})}else m=function(e,t,n){l.TextureLoader.loadTextureWithSecurity(e,!1,f.UVMapping,t,g,!0)},this.continueLoadFile(e,t,i,u,p,m)},this.dtor=function(){}}p.computeLevelOffset=function(e){for(var t=1,n=0,i=0;i<20;i++){if((t*=2)>e)return n;n++}return o.logger.log("unexpected leaflet tileSize"),0},p.prototype.is3d=function(){return!1},c.FileLoaderManager.registerFileLoader("Leaflet",["jpeg","jpg","png"],p)},function(e,t,n){"use strict";n.r(t),n.d(t,"Preferences",function(){return o});var i=n(2),r=n(1);function o(e,t){"string"==typeof t&&(t={prefix:t}),t||(t={}),t.prefix||(t.prefix="Autodesk.Viewing.Preferences."),t.hasOwnProperty("localStorage")||(t.localStorage=!0);var n={},o={},a={},s=t.localStorage&&function(){var e=t.prefix+"test";try{var n=window.localStorage;return n.setItem(e,"1"),n.removeItem(e),!0}catch(e){return!1}}(),l=this;function c(e,n){if(s){if(l.hasTag(e,"no-storage"))return;var i=t.prefix+e;return void 0!==n?window.localStorage[i]=n:n=window.localStorage[i],n}}function u(e,t){if("string"==typeof e&&"function"!=typeof l[e]){var n=c(e),i=!1;if(void 0!==n)try{n=JSON.parse(n),i=!0}catch(e){}l[e]=i?n:t,a[e]={}}else r.logger.log("Preferences: invalid name="+e)}function h(e){s&&(e=t.prefix+e,delete localStorage[e])}e.addEventListener(i.PREF_CHANGED_EVENT,function(e){var t=o[e.name];if(t){var n=t.changed;n&&n(e.value)}}),e.addEventListener(i.PREF_RESET_EVENT,function(e){var t=o[e.name];if(t){var n=t.reset;n&&n(e.value)}}),this.load=function(e){for(var t in n=e)n.hasOwnProperty(t)&&u(t,n[t])},this.tag=function(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(n);for(var i=0;i<t.length;++i)a[t[i]]&&(a[t[i]][e]=!0)}},this.untag=function(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(n);for(var i=0;i<t.length;++i)a[t[i]]&&(a[t[i]][e]=!1)}},this.hasTag=function(e,t){var n=a[e];return!!n&&!0===n[t]},this.add=function(e,t,i){if(!n.hasOwnProperty(e)){if(n[e]=t,u(e,t),i){Array.isArray(i)||(i=[i]);for(var o=0;o<i.length;++o)this.tag(i[o],e)}return!0}return r.logger.log("Preferences: "+e+" already exists"),!1},this.remove=function(e,t){return!!n.hasOwnProperty(e)&&(delete n[e],delete a[e],delete this[e],t&&h(e),!0)},this.reset=function(t,r){for(var o in t&&void 0===r&&(r=!0),n)if(n.hasOwnProperty(o)){if(t){var s=!!a[o][t];if(r&&!s||!r&&s)continue}this.set(o,n[o],!1)&&e.dispatchEvent({type:i.PREF_RESET_EVENT,name:o,value:this[o]}),h(o)}},this.get=function(e){return this[e]},this.set=function(t,n,r){return this[t]!==n&&(this[t]=n,c(t,n),(void 0===r||r)&&e.dispatchEvent({type:i.PREF_CHANGED_EVENT,name:t,value:n}),!0)},this.addListeners=function(e,t,n){o[e]={changed:t,reset:n}},this.removeListeners=function(e){void 0!==o[e]&&delete o[e]}}},function(e,t,n){"use strict";n.r(t),n.d(t,"HotkeyManager",function(){return i});n(30);function i(){var e=[],t=[],n=[],i=[],r=["hotkeys"];function o(e,t){return e-t}function a(){var e,r=t.join();for(e=0;e<i.length;)i[e].keys===r?i.splice(e,1):e++;for(e=0;e<n.length;)n[e].keys!==r?n.splice(e,1):e++}function s(r,o){var s=t.join(),l=t.slice(0),c=t.indexOf(o);c>-1&&t.splice(c,1);var u=t.join(),h=t.slice(0);a();var d,f=[],p=[];for(c=e.length-1;c>=0;c--)(d=e[c]).keys===s&&d.onRelease?f.unshift(d):d.keys===u&&d.onPress&&p.unshift(d);for(c=f.length-1;c>=0&&!(d=f[c]).onRelease(l);c--)d.options.tryUntilSuccess&&i.unshift(d);for(c=p.length-1;c>=0&&!(d=p[c]).onPress(h);c--)d.options.tryUntilSuccess&&n.unshift(d)}return{pushHotkeys:function(t,n,i){if(e.some(function(e){return e.id===t}))return!1;for(var r=0;r<n.length;r++)e.push({id:t,keys:n[r].keycodes.sort(o).join(),onPress:n[r].onPress,onRelease:n[r].onRelease,options:i||{}});return!0},popHotkeys:function(t){for(var n=!1,i=e.length-1;i>=0;i--)e[i].id===t&&(e.splice(i,1),n=!0);return n},handleKeyDown:function(r,o){if(-1===t.indexOf(o)){for(var s=t.join(),l=t.slice(0),c=0;c<t.length&&t[c]<o;)c++;t.splice(c,0,o);var u=t.join(),h=t.slice(0);a();var d,f=[],p=[];for(c=e.length-1;c>=0;c--)(d=e[c]).keys===s&&d.onRelease?f.unshift(d):d.keys===u&&d.onPress&&p.unshift(d);for(c=f.length-1;c>=0&&!(d=f[c]).onRelease(l);c--)d.options.tryUntilSuccess&&i.unshift(d);for(c=p.length-1;c>=0&&!(d=p[c]).onPress(h);c--)d.options.tryUntilSuccess&&n.unshift(d)}},handleKeyUp:s,handleBlur:function(){for(var e=t.length-1;e>=0;e--)s(0,t[e])},getName:function(){return r[0]},getNames:function(){return r},activate:function(){},deactivate:function(){},update:function(){var e,t;for(t=0;t<i.length;)!0===(e=i[t]).onRelease(e.keys.split())?i.splice(t,1):t++;for(t=0;t<n.length;)!0===(e=n[t]).onPress(e.keys.split())?n.splice(t,1):t++;return!1}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"ToolController",function(){return s});var i=n(3),r=n(1),o=n(2),a=n(30);function s(e,t,n,s,l){this.domElement=t.canvasWrap,this.selector=e.selector,this.autocam=n,this.lastClickX=-1,this.lastClickY=-1,this.scrollInputEnabled=!0;var c=-1!=navigator.userAgent.search("Mac OS"),u=-1!=navigator.userAgent.search("Firefox"),h=-1!==navigator.userAgent.search("Chrome"),d=-1!==navigator.userAgent.search("Safari")&&!h,f={},p=[],m=!1,g=-1,v=-1,y=!1,_=null,b=null,x=!1,w={},A=this;function E(e){return e.getPriority instanceof Function&&e.getPriority()||0}function T(e,n){return t.navigation.getUseLeftHandedInput()&&0===e||u&&1===e||c&&!d&&0===e&&n.ctrlKey}this.__registerToolByName=function(e,t){f[t]=e},this.registerTool=function(e){var t=e.getNames();if(!t||0==t.length)return r.logger.warn("Cannot register tool with no name."),!1;for(var n=!1,i=0;i<t.length;++i)"default"!==t[i]&&(this.__registerToolByName(e,t[i]),n=!0);return e.utilities=s,e.controller=this,e.register&&e.register(),n},this.deregisterTool=function(e){this.deactivateTool(e.getName());var t=e.getNames();if(!t||0==t.length)return!1;for(var n=t.length;--n>=0;)this.__deregisterToolName(t[n]);return e.deregister&&e.deregister(),e.utilities=null,e.controller=null,!0},this.__deregisterToolName=function(e){e in f&&(!function(e){for(var t=p.length;--t>=0;)p[t].activeName===e&&(f[e].deactivate(e),p.splice(t,1))}(e),delete f[e])},this.getTool=function(e){return f[e]},this.getActiveToolName=function(){var e=p.length;return e>0?p[e-1].activeName:"default"},this.getActiveTool=function(){var e=p.length;return e>0?p[e-1]:f.default},this.isToolActivated=function(e){for(var t=0;t<p.length;t++)if(p[t].activeName===e)return!0;return!1},this.setToolActiveName=function(e){var t=f[e];t&&(t.activeName=e)},this.activateTool=function(e){if(m)return!1;var n=f[e];if(n){void 0===n.count&&(n.count=0);var i=null;p.length&&"intercept"===p[p.length-1].activeName&&(i=p.pop());for(var a=0,s=0;s<p.length;s++)p[s]===n&&n.count++,E(p[s])<=E(n)&&(a=s+1);return n.activeName=e,0===n.count&&(n.count++,p.splice(a,0,n)),n.activate(e,t),i&&p.push(i),t.dispatchEvent({type:o.TOOL_CHANGE_EVENT,toolName:e,tool:n,active:!0}),!0}return r.logger.warn("activateTool not found: "+e),!1},this.deactivateTool=function(e){if(m)return!1;for(var n=p.length;--n>=0;)if(p[n].activeName===e)return 1===f[e].count&&p.splice(n,1),f[e].count--,f[e].deactivate(e),t.dispatchEvent({type:o.TOOL_CHANGE_EVENT,toolName:e,tool:p[n],active:!1}),!0;return r.logger.warn("deactivateTool not found: "+e),!1},this.getToolNames=function(){return Object.keys(f)},this.setDefaultTool=function(e){var t=this.getDefaultTool();return!(!e||e===t)&&(this.__registerToolByName(e,"default"),t&&t.deactivate("default"),e.activate("default"),!0)},this.getDefaultTool=function(){return f.default},this.setDefaultTool(l),this.setIsLocked=function(e){var t=m;return m=!!e,t},this.getIsLocked=function(){return m},this.__checkCursor=function(){for(var e=null,n=p.length;--n>=0;){var i=p[n];if(i.getCursor&&(e=i.getCursor()))break}e||(e="auto"),_!=e&&(t.canvas.style.cursor=e,_=e)},this.update=function(e){this.__checkCursor();var n=!1;s&&s.update()&&(n=!0);for(var i=p.length;--i>=0;){var r=p[i];r.update&&r.update(e)&&(n=!0)}if(t.navigation.getCamera().dirty?(t.navigation.updateCamera(),n=!0,this.cameraUpdated=!0):this.cameraUpdated=!1,n)t.navigation.updateCamera(),this.moveDelay=Date.now()+150;else if(0!==this.moveDelay){this.moveDelay-Date.now()>0?n=!0:this.moveDelay=0}return n},this.__clientToCanvasCoords=function(t,n,i){var r=e.getCanvasBoundingClientRect(),o=r.width,a=r.height,s=t.clientX-r.left,l=t.clientY-r.top;t.canvasX=s,t.canvasY=l,t.normalizedX=s/o*2-1,t.normalizedY=(a-l)/a*2-1,n&&n.set(s/o,l/a,0),i&&i.set(s,l)},this.__invokeStack=function(e,t,n){for(var i=p.length;--i>=0;){var r=p[i];if(r[e]&&r[e](t,n))return!0}var o=this.getDefaultTool();return!(!o[e]||!o[e](t,n))},this.distributeEvent=function(e,t,n){return this.__invokeStack(e,t,n)},this.handleResize=function(){t.navigation.setScreenViewport(t.container.getBoundingClientRect());for(var e=p.length;--e>=0;){var n=p[e];n.handleResize&&n.handleResize()}},this.handleSingleClick=function(e){var t=this.applyButtonMappings(e);this.lastClickX=e.clientX,this.lastClickY=e.clientY,this.__invokeStack("handleSingleClick",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleDoubleClick=function(e){var t=this.applyButtonMappings(e);this.__invokeStack("handleDoubleClick",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleSingleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleSingleTap",e)&&(e.preventDefault(),e.stopPropagation())},this.handleDoubleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleDoubleTap",e)&&(e.preventDefault(),e.stopPropagation())},this.handleWheelInput=function(e,t){this.__invokeStack("handleWheelInput",e)&&(t.preventDefault(),t.stopPropagation())},this.applyButtonMappings=function(e){var n=e.button;return"buttons"in e&&(e.firefoxSpoof?n=0:!y||1&e.buttons?2===n&&1&e.buttons&&(n=0,e.firefoxSpoof=y=!0):(e.firefoxSpoof=!0,y=!1,n=0)),t.navigation.getUseLeftHandedInput()&&(n=0===n?2:2===n?0:n),n},this.applyKeyMappings=function(e){switch(e.keyCode){case a.KeyCode.LCOMMAND:case a.KeyCode.RCOMMAND:case a.KeyCode.COMMANDMOZ:return a.KeyCode.CONTROL;case a.KeyCode.EQUALSMOZ:return a.KeyCode.EQUALS;case a.KeyCode.DASHMOZNEW:case a.KeyCode.DASHMOZ:return a.KeyCode.DASH}return e.keyCode},this.handleKeyDown=function(e){var t=this.applyKeyMappings(e);t&&this.__invokeStack("handleKeyDown",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleKeyUp=function(e){var t=this.applyKeyMappings(e);t&&this.__invokeStack("handleKeyUp",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleButtonDown=function(e,t){this.__invokeStack("handleButtonDown",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleButtonUp=function(e,t){this.__invokeStack("handleButtonUp",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleMouseMove=function(e){this.__invokeStack("handleMouseMove",e)&&(e.preventDefault(),e.stopPropagation())},this.handleBlur=function(e){this.__invokeStack("handleBlur",e)&&(e.preventDefault(),e.stopPropagation())},this.keydown=function(e){if((!b||A.domElement.contains(b))&&!(document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLSelectElement)){if(document.activeElement){var t=document.activeElement.getAttribute("contenteditable");if("true"===t||""===t)return}A.handleKeyDown(e)}},this.keyup=function(e){A.handleKeyUp(e)},this.mousedown=function(e){i.isIE11&&Object(i.inFullscreen)()||document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),A.__clientToCanvasCoords(e);var t=A.applyButtonMappings(e);if(A.handleButtonDown(e,t),g=e.canvasX,v=e.canvasY,T(t,e)){var n=w,r=void 0!==n.time&&e.timeStamp-n.time<500,o=void 0!==n.x&&void 0!==n.y&&Math.abs(n.x-e.canvasX)<=2&&Math.abs(n.y-e.canvasY)<=2;(!r||!o||n.clickCount&&2<=n.clickCount)&&(n.clickCount=0),n.clickCount?1===n.clickCount&&(n.clickCount=2):(n.clickCount=1,n.x=e.canvasX,n.y=e.canvasY,n.time=e.timeStamp)}document.addEventListener("mouseup",function e(n){A.applyButtonMappings(n)===t&&(document.removeEventListener("mouseup",e),A.mouseup(n))},!1),A.registerWindowMouseMove()},this.mousemove=function(e){A.__clientToCanvasCoords(e);var t=g-e.canvasX,n=v-e.canvasY;(Math.abs(t)>2||Math.abs(n)>2)&&(g=-1,v=-1),A.handleMouseMove(e)},this.mouseup=function(e){A.__clientToCanvasCoords(e);var t=A.applyButtonMappings(e);A.handleButtonUp(e,t);var n=g-e.canvasX,i=v-e.canvasY;if(g=-1,v=-1,Math.abs(n)<=2&&Math.abs(i)<=2&&A.handleSingleClick(e),T(t,e)){var r=w;2===r.clickCount&&(A.handleDoubleClick(e),r.clickCount=0,r.x=void 0,r.y=void 0,r.time=void 0)}A.unregisterWindowMouseMove()},this.doubleclick=function(e){A.__clientToCanvasCoords(e),g=e.canvasX,v=e.canvasY,A.handleDoubleClick(e)},this.mousewheel=function(e){if(A.scrollInputEnabled){var t=0;if(e.wheelDelta)t=e.wheelDelta/40;else if(e.detail)t=-e.detail;else if(e.deltaY){var n=u?1:40;t=-e.deltaY/n}A.handleWheelInput(t,e)}},this.blur=function(e){A.handleBlur(e)},this.mouseover=function(e){b=e.target},this.registerWindowMouseMove=function(){window.addEventListener("mousemove",A.mousemove),window.addEventListener("mouseover",A.mouseover),A.domElement.removeEventListener("mousemove",A.mousemove),A.domElement.removeEventListener("mouseover",A.mouseover)},this.unregisterWindowMouseMove=function(){window.removeEventListener("mousemove",A.mousemove),window.removeEventListener("mouseover",A.mouseover),A.domElement.addEventListener("mousemove",A.mousemove),A.domElement.addEventListener("mouseover",A.mouseover)},this.enableMouseButtons=function(e){e&&!x?(this.domElement.addEventListener("mousedown",this.mousedown),this.domElement.addEventListener("dblclick",this.doubleclick),this.domElement.addEventListener("mousemove",this.mousemove),this.domElement.addEventListener("mouseover",this.mouseover)):!e&&x&&(this.domElement.removeEventListener("mousedown",this.mousedown),this.domElement.removeEventListener("dblclick",this.doubleclick),this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover));var t=x;return x=e,t},this.domElement.addEventListener("mousewheel",this.mousewheel,!1),this.domElement.addEventListener("DOMMouseScroll",this.mousewheel,!1),window.addEventListener("keydown",this.keydown,!1),window.addEventListener("keyup",this.keyup,!1),window.addEventListener("blur",this.blur,!1),this.uninitialize=function(){for(x&&(this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover),window.removeEventListener("mousemove",A.mousemove),window.removeEventListener("mouseover",A.mouseover)),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup),window.removeEventListener("blur",this.blur),this.domElement=null,this.selector=null,this.autocam=null;p.length>0;)this.deactivateTool(p[p.length-1].activeName);f=null,p=null,A=null,s=null,t=null,e=null,b=null},this.set2DMode=function(e){},this.setAutocam=function(e){},this.syncCamera=function(){},this.recordHomeView=function(){var e=t.navigation.getCamera();n.sync(e),n.setHomeViewFrom(e)},this.setMouseWheelInputEnabled=function(e){this.scrollInputEnabled=e}}},function(e,t,n){"use strict";n.r(t),n.d(t,"ViewingUtilities",function(){return r});var i=n(0);function r(e,t,n){this.autocam=t,this.viewerImpl=e;var r=n.getCamera(),o={},a={};var s=new function(e){var t=.6,n=0,r=new i.SphereGeometry(1),o=new i.MeshPhongMaterial({color:32512,ambient:32512,opacity:t,transparent:!0}),a=new i.Mesh(r,o),s=e,l=1;s.createOverlayScene("pivot"),a.visible=!1,this.shown=function(){return a.visible},this.show=function(e,i,r){a.scale.x=i*l,a.scale.y=i*l,a.scale.z=i*l,a.position.set(e.x,e.y,e.z),o.opacity=t,a.visible=!0,s.addOverlay("pivot",a),s.invalidate(!1,!1,!0),n=r?Date.now()+500:0},this.hide=function(){a.visible&&(a.visible=!1,s.removeOverlay("pivot",a),s.invalidate(!1,!1,!0),n=0)},this.fade=function(){if(n>0){var e=n-Date.now();if(e<=0)return this.hide(),!0;var i=e/500*t;return o.opacity=i,!0}return!1},this.fading=function(){return n>0},this.setSize=function(e){l=e},this.setColor=function(e,n){o.color=new i.Color(e),void 0!==n&&(t=n,o.opacity=t)}}(this.viewerImpl);this.transitionView=function(e,i,o,a,s,l,c){s=s||n.getWorldUpVector();var u=l?function(e,t,n){var i=t.clone().sub(e);if(0===i.lengthSq())return i.copy(n);var r=i.clone().cross(n);return 0===r.lengthSq()&&(n.z>n.y?i.y-=1e-4:i.z-=1e-4,r.crossVectors(i,n)),r.cross(i).normalize()}(e,i,s):a;u||(u=r.up);var h={position:e,center:i,pivot:c=c||i,fov:o,up:u,worldUp:s,isOrtho:!1===r.isPerspective};t.goToView(h)},this.goHome=function(){this.viewerImpl.track({name:"navigation/home",aggregate:"count"}),t.goHome()},this.getHitPoint=function(e,t){var i=this.viewerImpl.hitTestViewport(n.screenToViewport(e,t),!1);return i?i.intersectPoint:null},this.activatePivot=function(e){if(this.viewerImpl.model&&!this.viewerImpl.model.is2d()){var t=r.isPerspective?n.getPivotPlaneDistance():n.getEyeVector().length(),o=n.getVerticalFov(),a=2*t*Math.tan(i.Math.degToRad(.5*o)),l=n.getScreenViewport(),c=window.devicePixelRatio||1,u=5*a/(l.height*c);s.show(n.getPivotPoint(),u,e)}},this.pivotActive=function(e,t){t=t||!1,(e=e&&!n.getIs2D())||!s.shown()?e&&this.activatePivot(t):s.hide()},this.pivotUpdate=function(){s.shown()&&s.fade()&&this.viewerImpl.invalidate(!1,!1,!0)},this.setPivotPoint=function(e,t,i){n.setPivotPoint(e),t||n.setTarget(e),i&&n.setPivotSetFlag(!0),this.setTemporaryPivot(null),n.getIs2D()||s.shown()&&this.activatePivot(s.fading())},this.savePivot=function(e){e||(e="default"),o[e]=n.getPivotPoint(),a[e]=n.getPivotSetFlag()},this.restorePivot=function(e){if(e||(e="default"),o[e]){var t=a[e];this.setPivotPoint(o[e],!0,t),t||n.setPivotSetFlag(!1),delete o[e],delete a[e]}},this.setTemporaryPivot=function(e){if(e){var t=n.getPivotPoint(),i=n.getPivotSetFlag();this.setPivotPoint(e,!0,i),o.TEMP=t,a.TEMP=i}else delete o.TEMP,delete a.TEMP},this.removeTemporaryPivot=function(){this.restorePivot("TEMP")},this.setPivotSize=function(e){s.setSize(e)},this.setPivotColor=function(e,t){s.setColor(e,t)},this.getBoundingBox=function(e){return this.viewerImpl.getFitBounds(e)},this.fitToView=function(e){this.viewerImpl.track({name:"navigation/fit",aggregate:"count"}),this.viewerImpl.fitToView(this.viewerImpl.selector.getAggregateSelection(),e),this.activatePivot(!0)},this.update=function(){n.getRequestFitToView()&&!n.getTransitionActive()&&(n.setRequestFitToView(!1),this.fitToView()),n.getRequestHomeView()&&!n.getTransitionActive()&&(n.setRequestHomeView(!1),this.goHome());var e=n.getRequestTransition();return e&&!n.getTransitionActive()&&(n.setRequestTransition(!1),this.transitionView(e.position,e.coi,e.fov,e.up,e.worldUp,e.reorient,e.pivot)),!1}}},function(e,t,n){"use strict";n.r(t),n.d(t,"DefaultHandler",function(){return i});n(0);function i(e,t,n){this.clickConfig=null,this.getNames=function(){return["default"]},this.getName=function(){return this.getNames()[0]},this.setClickBehavior=function(e){this.clickConfig=e},this.getClickBehavior=function(){return this.clickConfig},this.activate=function(e){},this.deactivate=function(e){},this.handleAction=function(t,i){for(var r=0;r<t.length;++r)switch(t[r]){case"selectOnly":e.selector&&i&&e.selector.setSelection([i.dbId],i.model);break;case"deselectAll":e.selector&&e.selector.setSelection([]);break;case"selectToggle":e.selector&&i&&e.selector.toggleSelection(i.dbId,i.model);break;case"isolate":i&&e.isolate(i.dbId);break;case"showAll":e.showAll();break;case"setCOI":i&&i.intersectPoint&&(n.setPivotPoint(i.intersectPoint,!0,!0),n.pivotActive(!0,!0));break;case"hide":i&&e.hide(i.dbId);break;case"show":i&&e.show(i.dbId);break;case"toggleVisibility":i&&e.toggleVisibility(i.dbId);break;case"focus":e.selector&&(i?e.selector.setSelection([i.dbId],i.model):e.selector.setSelection([]),n.fitToView())}},this.handleSingleClick=function(t,i){var r=t.ctrlKey||t.metaKey,o=t.shiftKey,a=t.altKey;if(0===i){var s=e.clientToViewport(t.canvasX,t.canvasY),l="click";r&&(l+="Ctrl"),o&&(l+="Shift"),a&&(l+="Alt");var c=(u=e.hitTestViewport(s,!1))?"onObject":"offObject";if(this.clickConfig&&this.clickConfig[l]&&this.clickConfig[l][c])return this.handleAction(this.clickConfig[l][c],u),!0}else if(1===i&&o&&!a&&!r){var u;s=e.clientToViewport(t.canvasX,t.canvasY);if((u=e.hitTestViewport(s,!1))&&u.intersectPoint)return n.setPivotPoint(u.intersectPoint,!0,!0),n.pivotActive(!0,!0),!0}return!1},this.handleDoubleClick=function(i,r){if(e.selector&&0===r){var o=e.clientToViewport(i.canvasX,i.canvasY),a=e.hitTestViewport(o,!1);return a?e.selector.setSelection([a.dbId],a.model):e.selector.clearSelection(),n.fitToView(),!0}return 1===r&&(t.fitBounds(!1,n.getBoundingBox(!0)),t.setPivotSetFlag(!1),!0)},this.handleSingleTap=function(n){if(n.clientX=n.pointers[0].clientX,n.clientY=n.pointers[0].clientY,e.api.triggerSingleTapCallback(n),n.hasOwnProperty("pointers")&&2===n.pointers.length)return t.setRequestHomeView(!0),!0;if(e.selector){var i=e.clientToViewport(n.canvasX,n.canvasY),r=e.hitTestViewport(i,!1);return r?(e.selector.setSelection([r.dbId],r.model),e.api.triggerSelectionChanged([r.dbId])):(e.selector.clearSelection(),e.api.triggerSelectionChanged(null)),!0}return!1},this.handleDoubleTap=function(t){t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerDoubleTapCallback(t);var i=this.handleSingleTap(t,0);return n.fitToView(),i},this.handlePressHold=function(t){return"press"===t.type&&(t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerContextMenu(t))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"OrbitDollyPanTool",function(){return r});var i=n(2);function r(e,t){var n,r,o,a=this,s=2,l=-1!=navigator.userAgent.search("Mac OS"),c=t.navigation,u=c.getCamera(),h=["orbit","freeorbit","dolly","pan"],d=h[0],f=[d],p=d,m=null,g=1,v=0,y=0,_=0,b=0,x=!1,w=null,A=!1,E=33,T=34,M=37,S=38,C=39,P=40,L=48,R=187,D=189,I=0,O=1,N=2,k=-5,V=new THREE.Vector3,F=new THREE.Vector3,B=new THREE.Vector2,U=new THREE.Vector2,z=new THREE.Vector2,G=new THREE.Vector2,H=new THREE.Vector3,W=new THREE.Vector3,j=new THREE.Vector3,X=new THREE.Vector3,q=new THREE.Vector3,Y=new THREE.Vector3,K=new THREE.Vector3,Q=new THREE.Vector3,Z=new THREE.Vector3,J=new THREE.Quaternion,$=!1,ee=!0,te=.2,ne=[!1,!1,!1,!1,!1,!1],ie={SHIFT:0,ALT:0,CONTROL:0,SPACE:0},re=function(t){e.renderer().rolloverObjectId(0,null,0)},oe=1,ae=5,se=.025;function le(e,t){var n=0,i=0,r=window.innerWidth,o=window.innerHeight;Q.set((e-.5*r-n)/(.5*r),(.5*o+i-t)/(.5*o),0);var a=Q.length();return $?a<Math.SQRT1_2?Q.z=Math.sqrt(1-a*a):Q.z=.5/a:a>1?Q.normalize():Q.z=Math.sqrt(1-a*a),X.copy(u.position).sub(u.pivot),Y.copy(u.up).setLength(Q.y),Y.add(K.copy(u.up).cross(X).setLength(Q.x)),Y.add(X.setLength(Q.z)),Y}this.getNames=function(){return h},this.getName=function(){return h[0]},this.activate=function(t){f.push(t),p=t,e.canvas.addEventListener("mouseout",re)},this.deactivate=function(t){var n=f.length-1;n>0&&f[n]===t&&(f.pop(),p=f[n-1]),0===f.length&&e.canvas.removeEventListener("mouseout",re)},this.adjustDollyLookSpeed=function(e){0===e?(se=.025,ae=5):((se*=e>0?1.1:.9)<1e-6&&(se=1e-6),(ae*=e>0?1.1:.9)<1e-6&&(ae=1e-6))},this.getDollySpeed=function(e){var t=c.getEyeVector(),n=c.getPosition(),i=e.clone().sub(n).dot(t.normalize())*se;return Math.abs(i)<.01?i<0?-.01:.01:i},this.getLookSpeed=function(){return ae},this.coiIsActive=function(){return c.getPivotSetFlag()&&c.isPointVisible(c.getPivotPoint())},this.adjustSpeed=function(e){this.adjustDollyLookSpeed(e),this.utilities.autocam&&(this.utilities.autocam.orbitMultiplier=this.getLookSpeed())},this.getTriggeredMode=function(){return k===O&&ie.SHIFT?f[1]:(e=ie,k===N&&e.SHIFT&&!e.ALT&&!e.CONTROL||k===N&&e.ALT&&!e.SHIFT&&!e.CONTROL||"dolly"===p&&!e.ALT&&"pinch"!==m||0!==H.z?function(){var e=ie;return!(e.CONTROL||e.ALT||e.SHIFT||k!==N&&k!==O)}()?"pan":"dolly":function(){var e=ie;return k===N&&!e.SHIFT&&!(e.ALT^e.CONTROL)||k===N&&e.SHIFT&&e.CONTROL||k===O&&!e.SHIFT&&!e.CONTROL||k===O&&e.ALT||k===O&&e.CONTROL&&!e.ALT||k===I&&e.SHIFT&&!e.CONTROL&&!e.ALT||"pan"===p&&k!==O&&!e.ALT&&!("pinch"===m)||e.SPACE}()?"pan":"pan"===m||"pinch"===m?"dollypan":p);var e},this.initTracking=function(e,t){var n;if(u.isPerspective){n=.5*(u.near+u.far);var i=this.utilities.getHitPoint(e,t),r=c.getPosition();if(i&&i.sub){var o=i.sub(r),a=c.getEyeVector().normalize();n=Math.abs(a.dot(o))}else{if(c.getPivotSetFlag()&&c.isPointVisible(c.getPivotPoint())){var s=c.getPivotPlaneDistance();s>1e-5&&(n=s)}}}else n=c.getEyeVector().length();oe=n},this.initOrbit=function(){this.utilities.setTemporaryPivot(u.isPerspective&&c.getPivotPoint().sub(c.getPosition()).dot(c.getEyeVector())<=0?c.getTarget():null)},this.getActiveMode=function(){return d},this.getCursor=function(){switch(d){case"freeorbit":case"orbit":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto";case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return null},this.getMotionDelta=function(e,t){var n=c&&c.getReverseZoomDirection()?-1.5:1.5;l&&(n*=-1),ne[0]&&(F.x+=.01,z.x+=20),ne[1]&&(F.x-=.01,z.x-=20),ne[2]&&(F.y+=.01,z.y+=20),ne[3]&&(F.y-=.01,z.y-=20),ne[4]&&(F.z+=n),ne[5]&&(F.z-=n);var i=F.x-V.x,r=F.y-V.y,o=F.z-V.z;Math.abs(i)<.001&&(i=0),Math.abs(r)<.001&&(r=0),Math.abs(o)<.001&&(o=0),e.set(i,r,o),t&&t.set(z.x-U.x,z.y-U.y)},this.stepMotionDelta=function(e,t){t?(V.x+=.6*e.x,V.y+=.6*e.y,V.z+=.6*e.z):V.copy(F),U.copy(z)},this.getFitBounds=function(){return this.utilities.viewerImpl.zoomBoundsChanged&&(o=this.utilities.viewerImpl.getVisibleBounds(!0),this.utilities.viewerImpl.zoomBoundsChanged=!1),o},this.update=function(){var e,i=!1,o=!1;this.getMotionDelta(H,G);var a=H.x,l=H.y,f=H.z;if(x||this.checkInteractionMode(),(x=k>-1)&&this.controller.setIsLocked(!0),0!==a||0!==l||0!==f){switch(d){case"orbit":this.utilities.autocam&&this.utilities.autocam.startState&&(G.x=-G.x,w&&this.utilities.autocam.orbit(z,w,G.multiplyScalar(s),this.utilities.autocam.startState));break;case"freeorbit":!function(){if(c.isActionEnabled("orbit")){X.subVectors(u.position,u.pivot),q.subVectors(u.position,u.target);var e=q.length();q.normalize();var t=Math.acos(W.dot(j)/W.length()/j.length());t&&(t*=s,Z.crossVectors(W,j).normalize(),J.setFromAxisAngle(Z,-t),X.applyQuaternion(J),u.up.applyQuaternion(J),j.applyQuaternion(J),q.applyQuaternion(J),ee?W.copy(j):(J.setFromAxisAngle(Z,t*(te-1)),W.applyQuaternion(J))),u.position.addVectors(u.pivot,X),u.target.subVectors(u.position,q.multiplyScalar(e)),u.dirty=!0}}();break;case"dolly":var p,b=new THREE.Vector2;f*=.6,k>=I?(l=-l,f=Math.abs(a)>Math.abs(l)?a:l,c.getReverseZoomDirection()&&(f*=-1),f*=100,a=0,l=0,b=c.viewportToScreen(0,0)):(e=c.getScreenViewport(),n&&r?(b.x=n/e.width,b.y=r/e.height):b=c.viewportToScreen(0,0)),!c.getIs2D()&&c.getZoomTowardsPivot()?this.coiIsActive()?p=c.getPivotPoint():(b=c.viewportToScreen(0,0),p=c.getWorldPoint(b.x,b.y)):p=c.getWorldPoint(b.x,b.y),c.dollyFromPoint(f*this.getDollySpeed(p),p,this.getFitBounds());break;case"pan":c.panRelative(-a,l,oe);break;case"dollypan":0===a&&0===l||c.panRelative(-a,l,oe),e=c.getScreenViewport(),p=c.getWorldPoint(n/e.width,r/e.height);var E=c.getPosition(),T=c.getIs2D()?E.sub(p).length():oe,M=(v/y-1)*T;c.dollyFromPoint(M,p,this.getFitBounds());var S=new THREE.Vector3,C=new THREE.Quaternion,P=c.getCameraUpVector(),L=S.copy(u.position).sub(u.target).normalize();C.setFromAxisAngle(L,1.2*_),P.applyQuaternion(C),c.getIs2D()||c.setCameraUpVector(P),v=y,g,oe=T+M}o=!0}return this.stepMotionDelta(H,"pan"!==d&&"dollypan"!==d),-1===k&&Math.abs(f)<1e-5&&(this.interactionEnd(-1),i=!0,o=!0),(ie.SHIFT||ie.ALT)&&-1!==h.indexOf(t.getActiveNavigationTool())&&(o=!0),!A&&(i||k>-5)&&(k>-1&&(V.copy(F),this.utilities.removeTemporaryPivot()),this.utilities.autocam.endInteraction(),k=-5,x&&this.controller.setIsLocked(!1),x=!1,w=null,m=null),o?this.utilities.pivotActive(c.getPivotSetFlag(),k<=-1):this.utilities.pivotUpdate(),u.dirty},this.checkInteractionMode=function(){var e=this.getTriggeredMode();e!==d&&("pan"===(d=e)&&k>-1||"dollypan"===d)&&this.initTracking(V.x,V.y)},this.interactionStart=function(e,t){(t||e>k)&&(k=e,A=!0,e>-1&&("pan"===d&&this.initTracking(V.x,V.y),"orbit"===d&&this.initOrbit()),this.utilities.pivotActive(c.getPivotSetFlag(),-1===e),this.utilities.autocam&&(this.utilities.autocam.sync(u),this.utilities.autocam.startInteraction(U.x,U.y),w=U.clone()))},this.interactionCheck=function(){(ne[0]||ne[1]||ne[2]||ne[3]||ne[4]||ne[5]||ie.SHIFT||ie.CONTROL||ie.ALT||ie.SPACE)&&this.interactionStart(-4,!0)},this.interactionEnd=function(e){e===k&&(-1!==e&&this.utilities.pivotActive(!1),A=!1)},this.isInteractionActive=function(){return A},this.handleWheelInput=function(t){if(this.isDragging)return!1;if(c.getIs2D()){var i=c.getScreenViewport(),o=e.intersectGround(n+i.width,r+i.height);this.utilities.setPivotPoint(o,!0,!0)}else if(c.getWheelSetsPivot()){var a=e.hitTest(n,r,!0);a&&a.intersectPoint&&this.utilities.setPivotPoint(a.intersectPoint,!0,!0)}return c.getReverseZoomDirection()&&(t*=-1),F.z+=t,0!=t&&this.interactionStart(-1),!0},this.resetKeys=function(){this.autoMove(-1,!1),ie.SHIFT=0,ie.CONTROL=0,ie.ALT=0,ie.SPACE=0},this.autoMove=function(e,t){t&&this.isDragging||(e<0?ne[0]=ne[1]=ne[2]=ne[3]=ne[4]=ne[5]=t:ne[e]=t,t||this.interactionEnd(-4),this.interactionCheck())},this.updateModifierState=function(e){ie.CONTROL=l&&e.metaKey||e.ctrlKey?1:0,ie.SHIFT=e.shiftKey?1:0,ie.ALT=e.altKey?1:0},this.handleKeyDown=function(e,t){this.updateModifierState(e);var n=!1;switch(t){case R:this.adjustSpeed(1),n=!0;break;case D:this.adjustSpeed(-1),n=!0;break;case L:this.adjustSpeed(0),n=!0;break;case M:this.autoMove(0,!0),n=!0;break;case C:this.autoMove(1,!0),n=!0;break;case E:this.autoMove(2,!0),n=!0;break;case T:this.autoMove(3,!0),n=!0;break;case S:this.autoMove(4,!0),n=!0;break;case P:this.autoMove(5,!0),n=!0;break;default:return!1}return this.isDragging||this.interactionStart(-4),n},this.handleKeyUp=function(e,t){this.updateModifierState(e);var n=!1;switch(t){case M:this.autoMove(0,!1),n=!0;break;case C:this.autoMove(1,!1),n=!0;break;case E:this.autoMove(2,!1),n=!0;break;case T:this.autoMove(3,!1),n=!0;break;case S:this.autoMove(4,!1),n=!0;break;case P:this.autoMove(5,!1),n=!0;break;default:return!1}return n&&(this.interactionEnd(-4),A||this.interactionCheck()),n},this.handleDollyPan=function(e){n=e.canvasX,r=e.canvasY;var t=c.getScreenViewport();z.x=n,z.y=r,F.x=z.x/t.width,F.y=z.y/t.height,y=function(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,n=e.pointers[1].clientY-e.pointers[0].clientY;return Math.sqrt(t*t+n*n)}(e);var i,o,a=THREE.Math.degToRad(e.rotation);_=a-b,Math.abs(_)>1&&(_=0),b=a,i=e.type,o="start",-1!==i.indexOf(o,i.length-o.length)&&(v=y,1,_=0,b=a),g=e.scale},this.handleGesture=function(e){switch(e.type){case"dragstart":return m="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"!==m&&(this.handleButtonDown(e,0),m="drag"),this.handleMouseMove(e);case"dragend":return"drag"===m&&(this.handleButtonUp(e,0),m=null,!0);case"panstart":return m="pan",this.handlePanStart(e),this.handleDollyPan(e),!0;case"panmove":return"pan"!==m&&(m="pan",this.handlePanStart(e)),this.handleDollyPan(e);case"panend":return"pan"===m&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(3),!0);case"pinchstart":return this.isDragging=!0,m="pinch",V.x=.5*(e.normalizedX+1),V.y=1-.5*(e.normalizedY+1),B.set(e.canvasX,e.canvasY),U.set(e.canvasX,e.canvasY),x=!1,this.interactionStart(3),this.handleDollyPan(e),!0;case"pinchmove":return"pinch"===m&&this.handleDollyPan(e);case"pinchend":return"pinch"===m&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(3),!0)}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),V.x=.5*(e.normalizedX+1),V.y=1-.5*(e.normalizedY+1),U.set(e.canvasX,e.canvasY),F.copy(V),z.copy(U),W.copy(le(e.canvasX,e.canvasY)),j.copy(W),n=e.canvasX,r=e.canvasY,this.isDragging=!0,this.interactionStart(t),!0},this.handlePanStart=function(e){return this.isDragging=!0,V.x=.5*(e.normalizedX+1),V.y=1-.5*(e.normalizedY+1),B.set(e.canvasX,e.canvasY),U.set(e.canvasX,e.canvasY),this.interactionStart(3),!0},this.handleButtonUp=function(e,t){return this.updateModifierState(e),F.x=.5*(e.normalizedX+1),F.y=1-.5*(e.normalizedY+1),z.set(e.canvasX,e.canvasY),j.copy(le(e.canvasX,e.canvasY)),W.copy(j),n=e.canvasX,r=e.canvasY,this.interactionEnd(t),this.isDragging=!1,!0},this.handleMouseMove=function(t){return this.updateModifierState(t),this.isDragging?(F.x=.5*(t.normalizedX+1),F.y=1-.5*(t.normalizedY+1),z.set(t.canvasX,t.canvasY),j.copy(le(t.canvasX,t.canvasY)),n=t.canvasX,r=t.canvasY,!0):(V.x=.5*(t.normalizedX+1),V.y=1-.5*(t.normalizedY+1),U.set(t.canvasX,t.canvasY),F.x=V.x,F.y=V.y,z.copy(U),n=t.canvasX,r=t.canvasY,t.target===e.canvas&&e.rolloverObject(n,r),!1)},this.handleBlur=function(e){this.resetKeys(),this.interactionEnd(k)},t.addEventListener(i.ESCAPE_EVENT,function(e){a.handleBlur(e)})}},function(e,t,n){"use strict";n.r(t),n.d(t,"ViewCubeUi",function(){return a});var i=n(137),r=n(3),o=Object(r.getGlobal)();function a(e){this.viewer=e,this.container=null,this.cube=null,this.viewcube=null,this.homeViewContainer=null,this._created=!1,this._initTriadVisibility=!1}a.prototype={constructor:a,create:function(){this._created||(this.initContainer(),this.initHomeButton(),this._created=!0)},initContainer:function(){this.container=document.createElement("div"),this.container.className="viewcubeWrapper",this.viewer.container.appendChild(this.container)},initHomeButton:function(){if(!this.homeViewContainer){var e=document.createElement("div");e.className="homeViewWrapper",this.container.appendChild(e),this.homeViewContainer=e;var t=this;e.addEventListener("click",function(e){t.viewer.navigation.setRequestHomeView(!0)})}},setVisible:function(e){this.container.style.display=e?"block":"none"},showTriad:function(e){this.cube?this.cube.showTriad(e):this._initTriadVisibility=e},displayViewCube:function(e,t){if(t&&this.viewer.prefs.set("viewCube",e),e&&!this.cube)this.viewcube=document.createElement("div"),this.viewcube.className="viewcube",this.container.appendChild(this.viewcube),this.cube=new i.ViewCube("cube",this.viewer.autocam,this.viewcube,o.LOCALIZATION_REL_PATH),this.container.appendChild(this.homeViewContainer),this._initTriadVisibility&&this.showTriad(!0),delete this._initTriadVisibility;else if(!this.cube)return void this._positionHomeButton();this.viewcube.style.display=e?"block":"none",this._positionHomeButton(),e&&this.viewer.autocam.refresh()},localize:function(){this.cube&&this.cube.localize()},_positionHomeButton:function(){this.homeViewContainer&&(this.cube&&this.viewcube&&"block"===this.viewcube.style.display?this.homeViewContainer.classList.remove("no-viewcube"):this.homeViewContainer.classList.add("no-viewcube"))},uninitialize:function(){this.container&&(this.viewer.container.removeChild(this.container),this.viewcube=null),this.cube&&(this.cube.dtor(),this.cube=null),this.homeViewContainer=null,this.hideHomeViewMenu=null,this.viewer=null}}},function(e,t,n){"use strict";n.r(t),n.d(t,"ViewCube",function(){return f});var i=n(0),r=n(86),o=n(22),a=n(103),s=n(1),l=n(3),c=n(7),u=n(4),h=function(e){return!(1!==e.length()||1!==Math.abs(e.x)&&1!==Math.abs(e.y)&&1!==Math.abs(e.z))};function d(e){var t=e/2,n=16711680,r=65280,o=255,a=new i.Matrix4,s=[],l=new i.PlaneBufferGeometry(50,50),c=function(e,t){var n=document.createElement("canvas");n.width=n.height=128;var r=n.getContext("2d");r.font="128px Arial",r.fillStyle="rgba(255,255,255,1)",r.textAlign="center",r.textBaseline="middle",r.fillText(e,n.width/2,n.height/2);var o=new i.Texture(n);return o.needsUpdate=!0,new i.Mesh(l,new i.MeshBasicMaterial({map:o,side:i.DoubleSide,transparent:!0,color:t,depthWrite:!1,depthTest:!0}))};this.triadScene=new i.Scene,this.triadLabelScene=new i.Scene;var u=new i.BoxGeometry(e,10,10),d=new i.Mesh(u,new i.MeshBasicMaterial({color:n,shading:i.SmoothShading})),f=new i.Mesh(u,new i.MeshBasicMaterial({color:r,shading:i.SmoothShading})),p=new i.Mesh(u,new i.MeshBasicMaterial({color:o,shading:i.SmoothShading}));d.applyMatrix(a.makeTranslation(5,-t,-t)),f.applyMatrix(a.makeRotationZ(Math.PI/2)),f.applyMatrix(a.makeTranslation(-t,5,-t)),p.applyMatrix(a.makeRotationY(Math.PI/2)),p.applyMatrix(a.makeTranslation(-t,-t,5)),this.triadScene.add(d),this.triadScene.add(f),this.triadScene.add(p);var m=c("X",n),g=c("Y",r),v=c("Z",o),y=function(e){var n=-(50+t)/2-20,i=t+50;m.position.set(i,n,n),g.position.set(n,i,n),v.position.set(n,n,i),e&&(m.position.applyQuaternion(e),g.position.applyQuaternion(e),v.position.applyQuaternion(e))};y(),s.push(m),s.push(g),s.push(v),this.triadLabelScene.add(m),this.triadLabelScene.add(g),this.triadLabelScene.add(v),this.orient=function(e,t){if(h(e)&&h(t)&&!(this.up&&this.front&&e.equals(this.up)&&t.equals(this.front))){this.up=e.clone(),this.front=t.clone();var n,r,o,a,s=0,l=0;e.x?(n="x",r="y",o="z",s=2*Math.PI/3):e.y?(n="y",r="z",o="x"):e.z&&(n="z",r="x",o="y",s=-2*Math.PI/3),-1===t[r]?l=Math.PI:t[o]&&(l=-t[o]*e[n]*Math.PI/2),a=-1===e[n]?Math.PI:0;var c=new i.Quaternion,u=new i.Quaternion,d=new i.Vector3(1,1,1);d.normalize(),u.setFromAxisAngle(d,s),c.setFromAxisAngle(e,l),u.multiply(c),c.setFromAxisAngle(t,a),u.multiply(c),y(u),this.triadScene.setRotationFromQuaternion(u)}},this.getSprites=function(){return s}}function f(e,t,n,f,p){var m=this,g=t,v=t.camera;t.setCube(this),m.currentFace="front",m.showTriad=p&&p.showTriad,m.localizeResourcePath=f;var y,_,b,x,w,A,E,T,M,S,C,P,L=["top,front","top right","top,left","top,back","bottom,front","bottom,right","bottom,left","bottom,back","left,front","front,right","right,back","back,left"],R=["front,top,right","back,top,right","front,top,left","back,top,left","front,bottom,right","back,bottom,right","front,bottom,left","back,bottom,left"],D=["Go Home",null,"Orthographic","Perspective","Perspective with Ortho Faces",null,"Set current view as Home","Focus and set as Home","Reset Home",null,"Set current view as Front","Set current view as Top","Reset orientation"],I=[!0,null,!0,!0,!0,null,!0,!0,!0,null,!0,!0,!0],O=[null,null,function(){return!g.orthographicFaces&&!v.isPerspective},function(){return!g.orthographicFaces&&v.isPerspective},function(){return g.orthographicFaces},null,null,null,null,null,null,null,null],N=[];m.pcam=new i.PerspectiveCamera(45,1,1,2e3),m.ocam=new i.OrthographicCamera(-265,265,265,-265,-1e3,1e3),m.ocam.fov=m.pcam.fov,m.ocam.aspect=m.pcam.aspect,m.camera=v.isPerspective?m.pcam:m.ocam,m.camera.position.copy(v.position),m.center=new i.Vector3(0,0,0),m.camera.lookAt(m.center);var k,V,F,B,U,z,G,H=[],W=[],j=[],X=[],q=[],Y=null,K=null,Q=null,Z=0,J=0,$=!0,ee=!1,te=!1,ne=!1,ie=-1!=navigator.userAgent.search("Chrome"),re=-1!=navigator.platform.search("Win32"),oe=!1,ae=!1,se=[];this.width=0,this.height=0,this.animSpeed=500,this.animate=!0,this.compass=!1,this.viewScaleFactorCompass=1.5,this.viewScale=1,this.draggable=!0,this.wantHomeButton=!1,this.wantRollArrows=!0,this.wantContextMenu=!0,this.inactiveOpacity=.5;var le=function(e){var t=e.getBoundingClientRect();return{x:t.left,y:t.top,w:t.width,h:t.height}},ce=function(e){e.preventDefault(),e.stopPropagation(),te=document.pointerLockElement===n||document.mozPointerLockElement===n||document.webkitPointerLockElement===n},ue=function(){g.navApi.isActionEnabled("orbit")&&(n.style.opacity="1.0",ae=!1),requestAnimationFrame(m.render)},he=function(e){if(ae||g.viewCubeMenuOpen||!g.navApi.isActionEnabled("orbit"))g.navApi.isActionEnabled("orbit")&&(n.style.opacity=1);else{var t=Math.max(4*Math.abs((e.clientX-G.x)/G.w-.5)-1,0),i=Math.max(4*Math.abs((e.clientY-G.y)/G.h-.5)-1,0),r=Math.max(0,Math.min(Math.sqrt(t*t+i*i),1));n.style.opacity=1-r*(1-m.inactiveOpacity)}},de=function(){g.viewCubeMenuOpen||(n.style.opacity=m.inactiveOpacity,ae=!0,requestAnimationFrame(m.render))},fe=function(e){var t=new Image,n=u.endpoint.getUseCredentials()&&(-1===e.indexOf("://")||-1!==e.indexOf(window.location.host));t.crossOrigin=n?"use-credentials":"anonymous";var r=new i.Texture(t);return t.onload=function(){r.needsUpdate=!0,++J>=11&&requestAnimationFrame(m.render)},t.src=e,r},pe=function(){var e,t,n=[],i=[];for(n[0]=Me(0,0),n[1]=Me(0,Math.PI/2),n[2]=Me(0,-Math.PI/2),n[3]=Me(0,Math.PI),n[4]=Me(Math.PI/2,0),n[5]=Me(Math.PI/2,Math.PI/2),n[6]=Me(Math.PI/2,-Math.PI/2),n[7]=Me(Math.PI/2,Math.PI),i[0]=Te(0,0,0),i[1]=Te(0,Math.PI/2,0),i[2]=Te(0,-Math.PI/2,0),i[3]=Te(0,Math.PI,0),i[4]=Te(Math.PI/2,0,0),i[5]=Te(Math.PI/2,Math.PI/2,0),i[6]=Te(Math.PI/2,-Math.PI/2,0),i[7]=Te(Math.PI/2,Math.PI,0),i[8]=Te(0,0,Math.PI/2),i[9]=Te(0,0,-Math.PI/2),i[10]=Te(-Math.PI/2,0,-Math.PI/2),i[11]=Te(-Math.PI,0,-Math.PI/2),H.push(Ee(0,0)),H[0].name="front",j.push(H[0]),q.push(H[0]),b.add(H[0]),H.push(Ee(0,Math.PI/2)),H[1].name="right",j.push(H[1]),q.push(H[1]),b.add(H[1]),H.push(Ee(0,Math.PI)),H[2].name="back",j.push(H[2]),q.push(H[2]),b.add(H[2]),H.push(Ee(0,-Math.PI/2)),H[3].name="left",j.push(H[3]),q.push(H[3]),b.add(H[3]),H.push(Ee(Math.PI/2,0)),H[4].name="bottom",j.push(H[4]),q.push(H[4]),b.add(H[4]),H.push(Ee(-Math.PI/2,0)),H[5].name="top",j.push(H[5]),q.push(H[5]),b.add(H[5]),e=H.length,t=0;t<n.length;t++)H.push(n[t]),H[e+t].name=R[t],b.add(H[e+t]),j.push(H[e+t]),q.push(H[e+t]);for(e=H.length,t=0;t<i.length;t++)H.push(i[t]),H[e+t].name=L[t],b.add(H[e+t]),j.push(H[e+t]),q.push(H[e+t])},me=function(e,t,n){var r,o=new i.Vector3;if("PerspectiveCamera"===t.type)o.copy(e),o.unproject(t),r=new i.Raycaster(t.position,o.sub(t.position).normalize());else{var a=new i.Vector3;a.copy(e),a.unproject(t),o.copy(t.position).negate().normalize(),r=new i.Raycaster(a,o)}return r.intersectObjects(n)},ge=function(e,t){var n=e.clientX-t.x,r=e.clientY-t.y;return n=n/t.w*2-1,r=(t.h-r)/t.h*2-1,new i.Vector3(n,r,.5)};function ve(e,t){var n={};return 0===e.type.indexOf("touch")?e.touches.length>0?(n.clientX=e.touches[0].clientX,n.clientY=e.touches[0].clientY,n.pageX=e.touches[0].pageX,n.pageY=e.touches[0].pageY,n.screenX=e.touches[0].screenX,n.screenY=e.touches[0].screenY,n.movementX=n.screenX-t.prevX,n.movementY=n.screenY-t.prevY,n.which=g.navApi.getUseLeftHandedInput()?3:1):n=t.prevCoords:(n.clientX=e.clientX,n.clientY=e.clientY,n.pageX=e.pageX,n.pageY=e.pageY,n.screenX=e.screenX,n.screenY=e.screenY,n.which=e.which,ee?(n.movementX=e.movementX||e.mozMovementX||e.webkitMovementX||0,n.movementY=e.movementY||e.mozMovementY||e.webkitMovementY||0):(n.movementX=n.screenX-t.prevX,n.movementY=n.screenY-t.prevY)),t.prevX=n.screenX,t.prevY=n.screenY,t.prevCoords=n,n}var ye=function(e){if(e.preventDefault(),e.stopPropagation(),g.navApi.isActionEnabled("orbit")&&!g.currentlyAnimating){var t,i=ve(e,m);G=le(n),n.removeEventListener("mousemove",we,!1),document.addEventListener("mouseup",xe,!1),document.addEventListener("touchend",xe,!1),g.navApi.getUsePivotAlways()||(g.pivot.copy(g.center),g.navApi.setPivotPoint(g.center),g.navApi.setPivotSetFlag(!1)),g.startInteraction(i.pageX,i.pageY),0==g.rewindParams.history.length&&g.addHistoryElement(),g.rewindParams.snapped&&g.rewindParams.timelineIndex+1==g.rewindParams.history.length||g.addIntermediateHistoryElement();var r=g.navApi.getUseLeftHandedInput()?1:3;i.which!==r&&(m.animSpeed<=0?s.logger.error("animSpeed cannot be 0 or less, use ViewCube.animate flag to turn on and off animation",Object(c.errorCodeString)(c.ErrorCodes.VIEWER_INTERNAL_ERROR)):(t=ge(i,G),me(t,m.camera,q).length>0&&(Pe(),m.draggable&&(document.addEventListener("mousemove",_e,!1),document.addEventListener("touchmove",_e,!1),ee&&(n.requestPointerLock(),ne=ie&&re)))))}},_e=function e(t){if(t.preventDefault(),t.stopPropagation(),m.animSpeed<=0)return document.removeEventListener("mousemove",e,!1),document.removeEventListener("touchmove",e,!1),void s.logger.error("animSpeed cannot be 0 or less",Object(c.errorCodeString)(c.ErrorCodes.VIEWER_INTERNAL_ERROR));if(!g.currentlyAnimating){var n=ve(t,m);ee&&ne&&(ne=!1,n.movementX=n.movementY=0),te&&(n.movementX>300||n.movementY>300)&&(n.movementX=0,n.movementY=0),n.movementX!==n.movementY||0!==n.movementX?($=!1,oe=!0,g.showPivot(!0),g.currentCursor=new i.Vector2(n.pageX,n.pageY),g.orbit(g.currentCursor,g.startCursor,new i.Vector3(-n.movementX,n.movementY,0),g.startState),m.camera.lookAt(m.center),requestAnimationFrame(m.render)):g.currentlyAnimating=!1}},be=function(e){e||(document.removeEventListener("mouseup",xe,!1),document.removeEventListener("touchend",xe,!1)),document.removeEventListener("mousemove",_e,!1),document.removeEventListener("touchmove",_e,!1),n.addEventListener("mousemove",we,!1),te&&document.exitPointerLock()},xe=function(e){var t,i,r;if(e.preventDefault(),e.stopPropagation(),g.currentlyAnimating||oe)return g.endInteraction(),g.showPivot(!1),oe=!1,void be(!1);var o=ve(e,m);if(g.viewCubeMenuOpen){var a=o.clientX-G.x,l=o.clientY-G.y;if(g.menuOrigin.x<=a&&a<=g.menuOrigin.x+g.menuSize.x&&g.menuOrigin.y<=l&&l<=g.menuOrigin.y+g.menuSize.y){var c=function(e){s.logger.track({name:"navigation/"+e,aggregate:"count"})};switch(Math.floor((l-5-g.menuOrigin.y)/25)){case 0:c("home"),g.goHome();break;case 1:c("setortho"),g.setOrthographicFaces(!1),g.toOrthographic(),m.camera=m.ocam;break;case 2:c("setpersp"),g.setOrthographicFaces(!1),g.toPerspective(),m.camera=m.pcam;break;case 3:g.setOrthographicFaces(!0),$?(g.toOrthographic(),m.camera=m.ocam):(g.toPerspective(),m.camera=m.pcam);break;case 4:c("sethome"),g.setCurrentViewAsHome(!1);break;case 5:c("focushome"),g.setCurrentViewAsHome(!0);break;case 6:c("resethome"),g.resetHome();break;case 7:c("setfront"),g.setCurrentViewAsFront();break;case 8:c("settop"),g.setCurrentViewAsTop();break;case 9:g.resetOrientation()}}return g.viewCubeMenuOpen=!1,g.removeDropdownMenu(n),(o.clientX<G.x||o.clientX>G.w+G.x||o.clientY<G.y||o.clientY>G.h+G.y)&&de(),m.mouseMoveSave&&m.processMouseMove(m.mouseMoveSave),g.endInteraction(),void be(!1)}var u=g.navApi.getUseLeftHandedInput()?1:3;if(o.which===u)return g.viewCubeMenuOpen=!0,g.drawDropdownMenu(D,I,O,o.clientX,o.clientY,n,G),void be(!0);var h=ge(o,G);if(t=me(h,m.camera,q),i=me(h,E,W),r=me(h,E,X),i.length>0&&$){for(var d=["top","bottom","right","left","front","back"],f=g.getOrientation(),p={front:{up:[0,1,2,3],right:[2,3,1,0],down:[1,0,3,2],left:[3,2,0,1]},right:{up:[0,1,5,4],right:[5,4,1,0],down:[1,0,4,5],left:[4,5,0,1]},left:{up:[0,1,4,5],right:[4,5,1,0],down:[1,0,5,4],left:[5,4,0,1]},back:{up:[0,1,3,2],right:[3,2,1,0],down:[1,0,2,3],left:[2,3,0,1]},top:{up:[5,4,2,3],right:[2,3,4,5],down:[4,5,3,2],left:[3,2,5,4]},bottom:{up:[4,5,2,3],right:[2,3,5,4],down:[5,4,3,2],left:[3,2,4,5]}}[m.currentFace][f],y=0;y<4;y++)if(i[0].object===W[y]){w=d[p[y]];break}g.calculateCubeTransform(w),m.currentFace=w,g.elapsedTime=0,g.sphericallyInterpolateTransition()}if(r.length>0){if(g.elapsedTime=0,m.wantHomeButton&&r[0].object===X[U])return g.goHome(),void be(!1);if(m.wantContextMenu&&r[0].object===X[z])return g.viewCubeMenuOpen=!0,g.drawDropdownMenu(D,I,O,o.clientX,o.clientY,n,G),void be(!0);if(m.wantRollArrows&&$&&(r[0].object===X[V]||r[0].object===X[F])){var _=r[0].object===X[F],b={center:g.center.clone(),position:v.position.clone(),pivot:v.pivot.clone(),fov:v.fov,worldUp:g.sceneUpDirection.clone(),isOrtho:!1===v.isPerspective},x=g.center.clone().sub(v.position).normalize();_?b.up=v.up.clone().cross(x):(b.up=v.up.clone().multiplyScalar(-1),b.up.cross(x)),b.up.normalize(),g.elapsedTime=0,g.animateTransition(b)}}if(t.length>0){var w=t[0].object.name;m.mouseMoveSave=e,m.cubeRotateTo(w)}be(!1)};this.cubeRotateTo=function(e){m.currentFace=e,g.orthographicFaces&&-1!==m.currentFace.indexOf(",")&&g.setCameraOrtho(!1),g.calculateCubeTransform(m.currentFace),g.elapsedTime=0,g.sphericallyInterpolateTransition(function(){m.mouseMoveSave&&m.processMouseMove(m.mouseMoveSave)})},this.processMouseMove=function(e){var t,n,i;if(g.viewCubeMenuOpen||g.currentlyAnimating)m.mouseMoveSave=e;else{m.mouseMoveSave=null;var r=ve(e,m),o=ge(r,G);if(t=me(o,m.camera,j),n=me(o,E,W),i=me(o,E,X),Y&&!oe&&(Y.material.color.setHex(14540253),Y=null,requestAnimationFrame(m.render)),n.length>0&&!oe){Y=n[0].object;for(var a=k.children.length;--a>=0;)if(Y===W[a]){(Y=k.children[a]).material.color.setHex(45055);break}requestAnimationFrame(m.render)}K&&!oe&&(K.material.opacity=0,K=null,requestAnimationFrame(m.render)),t.length>0&&!oe&&((K=t[0].object).material.opacity=.3,requestAnimationFrame(m.render)),i.length>0&&!oe?Q!==i[0].object&&(m.wantHomeButton&&i[0].object===X[U]?(Q=i[0].object,X[U].material.map=se[0]):m.wantRollArrows&&i[0].object===X[V]?(Q=i[0].object,X[B].material.map=se[1]):m.wantRollArrows&&i[0].object===X[F]?(Q=i[0].object,X[B].material.map=se[2]):m.wantContextMenu&&i[0].object===X[z]?(Q=i[0].object,X[z].material.map=se[6]):m.wantHomeButton&&Q===X[U]?(Q=null,X[U].material.map=se[3]):!m.wantRollArrows||Q!==X[V]&&Q!==X[F]&&Q!==X[B]?m.wantContextMenu&&Q===X[z]&&(Q=null,X[z].material.map=se[5]):(Q=null,X[B].material.map=se[4]),requestAnimationFrame(m.render)):null===Q||oe||(m.wantHomeButton&&Q===X[U]?(Q=null,X[U].material.map=se[3]):!m.wantRollArrows||Q!==X[V]&&Q!==X[F]&&Q!==X[B]?m.wantContextMenu&&Q===X[z]&&(Q=null,X[z].material.map=se[5]):(Q=null,X[B].material.map=se[4]),requestAnimationFrame(m.render))}};var we=function(e){g.navApi.isActionEnabled("orbit")&&m.processMouseMove(e)},Ae=function(){G=le(n),m.width=n.offsetWidth,m.height=n.offsetHeight,m.pcam.aspect=m.ocam.aspect=m.width/m.height,m.pcam.updateProjectionMatrix(),m.ocam.updateProjectionMatrix(),m.camera.topFov=m.camera.bottomFov=m.camera.fov/2,m.camera.leftFov=m.camera.rightFov=m.camera.aspect*m.camera.fov/2,m.pcam.aspect=m.ocam.aspect=m.camera.aspect,m.pcam.topFov=m.ocam.topFov=m.camera.topFov,m.pcam.bottomFov=m.ocam.bottomFov=m.camera.bottomFov,m.pcam.leftFov=m.ocam.leftFov=m.camera.leftFov,m.pcam.rightFov=m.ocam.rightFov=m.camera.rightFov,m.renderer.setSize(m.width,m.height),requestAnimationFrame(m.render)},Ee=function(e,t){var n,r=new i.Geometry,o=new i.Vector3(0,0,0),a=new i.Vector3(60,-60,105),s=new i.Vector3(60,60,105),l=new i.Vector3(-60,60,105),c=new i.Vector3(-60,-60,105);return r.vertices.push(o),r.vertices.push(a),r.vertices.push(s),r.vertices.push(l),r.vertices.push(c),r.faces.push(new i.Face3(1,2,3)),r.faces.push(new i.Face3(1,3,4)),r.applyMatrix((new i.Matrix4).makeRotationX(e)),r.applyMatrix((new i.Matrix4).makeRotationY(t)),r.computeFaceNormals(),r.computeVertexNormals(),n=new i.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new i.Mesh(r,n)},Te=function(e,t,n){var r,o=new i.Geometry,a=new i.Vector3(60,105,105),s=new i.Vector3(-60,105,105),l=new i.Vector3(-60,60,105),c=new i.Vector3(60,60,105),u=new i.Vector3(60,105,60),h=new i.Vector3(-60,105,60),d=new i.Vector3(-60,105,105),f=new i.Vector3(60,105,105);return o.vertices.push(a),o.vertices.push(s),o.vertices.push(l),o.vertices.push(c),o.vertices.push(u),o.vertices.push(h),o.vertices.push(d),o.vertices.push(f),o.faces.push(new i.Face3(0,1,2)),o.faces.push(new i.Face3(0,2,3)),o.faces.push(new i.Face3(4,5,6)),o.faces.push(new i.Face3(4,6,7)),o.applyMatrix((new i.Matrix4).makeRotationX(e)),o.applyMatrix((new i.Matrix4).makeRotationY(t)),o.applyMatrix((new i.Matrix4).makeRotationZ(n)),o.computeFaceNormals(),o.computeVertexNormals(),r=new i.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new i.Mesh(o,r)},Me=function(e,t){var n,r=new i.Geometry,o=new i.Vector3(105,105,105),a=new i.Vector3(60,105,105),s=new i.Vector3(60,60,105),l=new i.Vector3(105,60,105),c=new i.Vector3(105,105,60),u=new i.Vector3(105,105,105),h=new i.Vector3(105,60,105),d=new i.Vector3(105,60,60),f=new i.Vector3(105,105,105),p=new i.Vector3(105,105,60),m=new i.Vector3(60,105,60),g=new i.Vector3(60,105,105);return r.vertices.push(o),r.vertices.push(a),r.vertices.push(s),r.vertices.push(l),r.vertices.push(c),r.vertices.push(u),r.vertices.push(h),r.vertices.push(d),r.vertices.push(f),r.vertices.push(p),r.vertices.push(m),r.vertices.push(g),r.faces.push(new i.Face3(0,1,2)),r.faces.push(new i.Face3(0,2,3)),r.faces.push(new i.Face3(4,5,6)),r.faces.push(new i.Face3(4,6,7)),r.faces.push(new i.Face3(8,9,10)),r.faces.push(new i.Face3(8,10,11)),r.applyMatrix((new i.Matrix4).makeRotationX(e)),r.applyMatrix((new i.Matrix4).makeRotationY(t)),r.computeFaceNormals(),r.computeVertexNormals(),n=new i.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new i.Mesh(r,n)},Se=function(e){var t=g.cubeFront.clone(),n=g.sceneUpDirection.clone(),r=t.clone().cross(n);n.copy(r).cross(t),t.normalize(),n.normalize(),r.normalize();var o=new i.Vector3(t.x,n.x,r.x).multiplyScalar(e.x);return o.add(new i.Vector3(t.y,n.y,r.y).multiplyScalar(e.y)),o.add(new i.Vector3(t.z,n.z,r.z).multiplyScalar(e.z)),o};this.render=function(){m.camera=v.isPerspective?m.pcam:m.ocam;var e=m.compass?m.viewScaleFactorCompass*m.viewScale:m.viewScale,t=g.center.clone().sub(v.position).normalize(),n=v.up.normalize(),r=new i.Matrix4;t=Se(t),n=Se(n),m.camera.position.copy(t),m.camera.position.multiplyScalar(-e/m.camera.position.length()),m.camera.up=n.normalize(),m.camera.lookAt(m.center),Ce();var o=m.renderTriad&&h(g.sceneUpDirection)&&h(g.sceneFrontDirection),a=m.renderer;if(a){for(var s=0;s<N.length;s++)r.lookAt(m.camera.position,N[s].position,m.camera.up),N[s].setRotationFromMatrix(r);a.clear(),a.render(y,m.camera),a.render(_,m.camera),a.render(x,m.camera),o&&(w.orient(g.sceneUpDirection,g.sceneFrontDirection.clone().multiplyScalar(-1)),a.render(w.triadScene,m.camera),a.render(w.triadLabelScene,m.camera)),a.render(b,m.camera),a.render(A,E)}};var Ce=function(){!($=g.isFaceView())||ae||g.currentlyAnimating?Pe():Le(),ae?Re():De(),ae?Ie():Oe()},Pe=function(){A.remove(k),X[B].material.opacity=0,X[z].material.opacity=0},Le=function(){A.add(k);var e=m.wantRollArrows?1:0;X[B].material.opacity=e,X[z].material.opacity=e},Re=function(){P.material.opacity=Object(l.isMobileDevice)()?1:0},De=function(){P.material.opacity=m.wantContextMenu?1:0},Ie=function(){S.material.opacity=0},Oe=function(){S.material.opacity=m.wantHomeButton?1:0};this.refreshCube=function(){Ae()},this.setSize=function(e,t){if(m.width=e,m.height=t,n.children.length>1)for(var i=1;i<n.children.length;i++)n.children[i].style.bottom=(m.height/5).toString()+"px";Ae()},this.useTransparency=function(e){ae=e,e?(n.onmouseover=ue,n.onmousemove=he,n.onmouseout=de,de()):(n.onmouseover=null,n.onmouseout=null,n.onmousemove=null,n.style.opacity="1.0")},this.showTriad=function(e){e!==m.renderTriad&&(m.renderTriad=e,requestAnimationFrame(m.render))},this.dtor=function(){this.renderer=null},this.refreshTexture=function(e){var t=Autodesk.Viewing.Private.getResourceUrl,n=this.localizeResourcePath||"res/textures/",a=(new r.DDSLoader).load(t(n+"VCcrossRGBA8small.dds"),e);a.minFilter=a.maxFilter=i.LinearFilter,this.texture&&this.texture.dispose(),this.texture=a;var s=this.material;if(!s){var l=i.ShaderLib.cube;(s=Object(o.createShaderMaterial)(l)).depthWrite=!1,this.material=s}return s.uniforms.tCube.value=a,s},this.localize=function(){var e=this,t=Object(l.getGlobal)();this.localizeResourcePath=t.LOCALIZATION_REL_PATH,this.refreshTexture(function(){requestAnimationFrame(e.render)})},function(){var e=n.getBoundingClientRect();m.width=e.width,m.height=e.height,G=le(n),(E=new i.PerspectiveCamera(70,m.height/m.width,1,1e4)).position.set(0,0,500),y=new i.Scene,_=new i.Scene,b=new i.Scene,x=new i.Scene,A=new i.Scene,$=!0,Z=200,m.viewScale=3.5*Z;var t=m.refreshTexture(),r=i.LinearFilter,o=Autodesk.Viewing.Private.getResourceUrl,l="res/textures/",c=new i.BoxGeometry(Z,Z,Z,4,4,4),u=new i.BoxGeometry(Z+1,Z+1,Z+1,4,4,4);(T=new i.Mesh(c,t)).position.set(0,0,0),_.add(T);var h=fe(o(l+"VCedge1.png"));h.minFilter=h.maxFilter=r,(M=new i.Mesh(u,new i.MeshBasicMaterial({map:h,overdraw:!1,transparent:!0,shading:i.SmoothShading}))).position.set(0,0,0),x.add(M),w=new d(Z+20),Array.prototype.push.apply(N,w.getSprites());var f=Z,p=new i.Geometry,v=new i.Vector3(-30,0,0),L=new i.Vector3(30,0,0),R=new i.Vector3(0,-30,0);p.vertices.push(v),p.vertices.push(L),p.vertices.push(R),p.faces.push(new i.Face3(1,0,2)),p.computeFaceNormals();var D=new i.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:i.FlatShading}),I=new i.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:i.FlatShading}),O=new i.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:i.FlatShading}),H=new i.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:i.FlatShading}),j=new i.PlaneBufferGeometry(.5*Z,.3*Z,2,2),q=new i.MeshBasicMaterial({transparent:!0,opacity:0}),Y=new i.Mesh(p,D),K=new i.Mesh(j,q);Y.position.set(0,f,0),K.position.set(0,.9*f,.1);var Q=new i.Mesh(p,I),J=new i.Mesh(j,q);Q.position.set(0,-f,0),J.position.set(0,.9*-f,.1),Q.rotation.z+=Math.PI,J.rotation.z+=Math.PI;var te=new i.Mesh(p,O),ne=new i.Mesh(j,q);te.position.set(f,0,0),ne.position.set(.9*f,0,.1),te.rotation.z-=Math.PI/2,ne.rotation.z-=Math.PI/2;var ie=new i.Mesh(p,H),re=new i.Mesh(j,q);ie.position.set(-f,0,0),re.position.set(.9*-f,0,.1),ie.rotation.z+=Math.PI/2,re.rotation.z+=Math.PI/2,(k=new i.Object3D).position.set(0,0,0),k.add(Y),k.add(Q),k.add(te),k.add(ie),A.add(K),A.add(J),A.add(ne),A.add(re),A.add(k),W.push(K),W.push(J),W.push(ne),W.push(re);var oe=new i.PlaneBufferGeometry(Z/3,Z/3,2,2),ae=new i.MeshBasicMaterial({map:fe(o(l+"VChome.png")),transparent:!0,shading:i.FlatShading});(S=new i.Mesh(oe,ae)).position.set(-Z,Z,0),U=X.length,A.add(S),X.push(S);var ue=new i.PlaneBufferGeometry(1.5*Z,1.5*Z,2,2),he=new i.MeshBasicMaterial({map:fe(o(l+"VCarrows.png")),shading:i.FlatShading,transparent:!0}),de=new i.Mesh(ue,he);de.position.set(.5*Z+20,.5*Z+20,0);var me=new i.PlaneBufferGeometry(.6*Z,.45*Z,2,2),ge=new i.MeshBasicMaterial({transparent:!0,opacity:0}),ve=new i.Mesh(me,ge);ve.position.set(.5*Z+20,Z+20,.1);var _e=new i.PlaneBufferGeometry(.45*Z,.6*Z,2,2),be=new i.MeshBasicMaterial({transparent:!0,opacity:0}),xe=new i.Mesh(_e,be);xe.position.set(Z+20,.5*Z+20,.1),A.add(de),A.add(ve),A.add(xe),V=X.length,X.push(ve),F=X.length,X.push(xe),B=X.length,X.push(de);var Ae=new i.PlaneBufferGeometry(Z/2.3,Z/2.3,2,2),Ee=new i.MeshBasicMaterial({map:fe(o(l+"VCcontext.png")),transparent:!0,shading:i.FlatShading});(P=new i.Mesh(Ae,Ee)).position.set(Z,-Z,0),z=X.length,A.add(P),X.push(P);var Te,Me=new i.Geometry;Me.vertices.push(new i.Vector3(0,0,0)),Me.vertices.push(new i.Vector3(-Z/2,-Z/2-20,-Z/2)),Me.vertices.push(new i.Vector3(Z/2,-Z/2-20,-Z/2)),Me.vertices.push(new i.Vector3(Z/2,-Z/2-20,Z/2)),Me.vertices.push(new i.Vector3(-Z/2,-Z/2-20,Z/2)),Me.faces.push(new i.Face3(4,3,2)),Me.faces.push(new i.Face3(4,2,1)),Te=new i.MeshBasicMaterial({color:0,transparent:!0,opacity:.5}),C=new i.Mesh(Me,Te),y.add(C),pe(),"CANVAS"===g.renderer.toUpperCase()?m.renderer=new i.CanvasRenderer:"WEBGL"===g.renderer.toUpperCase()?m.renderer=new a.WebGLRenderer({alpha:!0,antialias:!1}):(s.logger.warn("Incorrect use of Autocam.renderer property"),m.renderer=new i.CanvasRenderer),m.useTransparency(!0),m.setSize(m.width,m.height),m.camera.topFov=m.camera.bottomFov=m.camera.fov/2,m.camera.leftFov=m.camera.rightFov=m.camera.aspect*m.camera.fov/2,m.pcam.topFov=m.ocam.topFov=m.camera.topFov,m.pcam.bottomFov=m.ocam.bottomFov=m.camera.bottomFov,m.pcam.leftFov=m.ocam.leftFov=m.camera.leftFov,m.pcam.rightFov=m.ocam.rightFov=m.camera.rightFov,m.renderer.autoClear=!1,m.renderer.setSize(m.width,m.height),m.renderer.sortObjects=!1,n.appendChild(m.renderer.domElement),n.addEventListener("touchstart",ye,!1),n.addEventListener("mousedown",ye,!1),n.addEventListener("mousemove",we,!1),(ee=!1)&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock,document.addEventListener("pointerlockchange",ce,!1),document.addEventListener("mozpointerlockchange",ce,!1),document.addEventListener("webkitpointerlockchange",ce,!1)),se.push(fe(o(l+"VChomeS.png"))),se.push(fe(o(l+"VCarrowsS0.png"))),se.push(fe(o(l+"VCarrowsS1.png"))),se.push(fe(o(l+"VChome.png"))),se.push(fe(o(l+"VCarrows.png"))),se.push(fe(o(l+"VCcontext.png"))),se.push(fe(o(l+"VCcontextS.png")))}()}},function(e,t,n){"use strict";n.r(t),n.d(t,"Autocam",function(){return o});var i=n(0),r=n(9);function o(e,t,n){var o=this,a=null,s=!1;this.cube=null,this.camera=e,this.renderer="WEBGL",this.startState={},this.navApi=t,this.orthographicFaces=!1,this.canvas=n,this.cameraChangedCallback=function(){},this.pivotDisplayCallback=function(){},this.transitionCompletedCallback=function(){};var l,c,u,h,d,f=Date.now(),p=!1;function m(t){s=!0,e.target.copy(o.center),e.pivot.copy(o.pivot),e.worldup?e.worldup.copy(o.sceneUpDirection):e.up.copy(o.sceneUpDirection),o.cameraChangedCallback(t),s=!1}this.dtor=function(){this.cube=null,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.transitionCompletedCallback=null,this.canvas=null},this.registerCallbackCameraChanged=function(e){this.cameraChangedCallback=e},this.registerCallbackPivotDisplay=function(e){this.pivotDisplayCallback=e},this.registerCallbackTransitionCompleted=function(e){this.transitionCompletedCallback=e},this.showPivot=function(e){this.pivotDisplayCallback(e)},this.setWorldUpVector=function(e){s||e&&e.lengthSq()>0&&!e.normalize().equals(this.sceneUpDirection)&&(this.sceneUpDirection.copy(e),this.sceneFrontDirection.copy(this.getWorldFrontVector()),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.cube&&requestAnimationFrame(this.cube.render))},this.getWorldUpVector=function(){return this.sceneUpDirection.clone()},this.getWorldRightVector=function(){var e=this.sceneUpDirection.clone();return Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},this.getWorldFrontVector=function(){return this.getWorldUpVector().cross(this.getWorldRightVector()).normalize()},this.goToView=function(e){if(this.navApi.isActionEnabled("gotoview")){var t={position:e.position.clone(),up:e.up.clone(),center:e.center.clone(),pivot:e.pivot.clone(),fov:e.fov,worldUp:e.worldUp.clone(),isOrtho:e.isOrtho};o.elapsedTime=0,this.animateTransition(t)}},this.getCurrentView=function(){return{position:e.position.clone(),up:e.up.clone(),center:this.center.clone(),pivot:this.pivot.clone(),fov:e.fov,worldUp:this.sceneUpDirection.clone(),isOrtho:!1===e.isPerspective}},this.setCurrentViewAsHome=function(e){e?(this.navApi.setRequestFitToView(!0),p=!0):this.homeVector=this.getCurrentView()},this.setHomeViewFrom=function(e){var t=e.pivot?e.pivot:this.center,n=e.target?e.target:this.pivot,i=e.worldup?e.worldup:this.sceneUpDirection;this.homeVector={position:e.position.clone(),up:e.up.clone(),center:n.clone(),pivot:t.clone(),fov:e.fov,worldUp:i.clone(),isOrtho:!1===e.isPerspective},this.originalHomeVector={position:e.position.clone(),up:e.up.clone(),center:n.clone(),pivot:t.clone(),fov:e.fov,worldUp:i.clone(),worldFront:this.sceneFrontDirection.clone(),isOrtho:!1===e.isPerspective}},this.toPerspective=function(){e.isPerspective||(e.toPerspective(),m(!1))},this.toOrthographic=function(){e.isPerspective&&(e.toOrthographic(),m(!1))},this.setOrthographicFaces=function(e){this.orthographicFaces=e},this.goHome=function(){this.navApi.isActionEnabled("gotoview")&&(this.navApi.setPivotSetFlag(!1),this.goToView(this.homeVector))},this.resetHome=function(){this.homeVector.position.copy(this.originalHomeVector.position),this.homeVector.up.copy(this.originalHomeVector.up),this.homeVector.center.copy(this.originalHomeVector.center),this.homeVector.pivot.copy(this.originalHomeVector.pivot),this.homeVector.fov=this.originalHomeVector.fov,this.homeVector.worldUp.copy(this.originalHomeVector.worldUp),this.homeVector.isOrtho=this.originalHomeVector.isOrtho,this.goHome()},this.getView=function(){return this.center.clone().sub(e.position)},this.setCameraUp=function(t){var n=this.dir.clone(),i=n.cross(t).normalize();0===i.lengthSq()&&(n.copy(this.dir),t.z>t.y?n.y+=1e-4:n.z+=1e-4,i=n.cross(t).normalize()),e.up.copy(i).cross(this.dir).normalize()},function e(){requestAnimationFrame(e);var t=Date.now();l=t-f,f=t}(),this.ortho=!1,this.center=e.target?e.target.clone():new i.Vector3(0,0,0),this.pivot=e.pivot?e.pivot.clone():this.center.clone(),this.sceneUpDirection=e.worldup?e.worldup.clone():e.up.clone(),this.sceneFrontDirection=this.getWorldFrontVector(),this.dir=this.getView(),this.setCameraUp(e.up),this.saveCenter=this.center.clone(),this.savePivot=this.pivot.clone(),this.saveEye=e.position.clone(),this.saveUp=e.up.clone(),this.cubeFront=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),this.setHomeViewFrom(e);var g,v,_=new i.Quaternion,b=new i.Quaternion,w=new i.Quaternion,A=new i.Quaternion;this.userPanSpeed=.5,this.userLookSpeed=2,this.userHeightSpeed=5,this.walkMultiplier=1,this.userZoomSpeed=1.015,this.orbitMultiplier=5,this.currentlyAnimating=!1,e.keepSceneUpright=!0,this.preserveOrbitUpDirection=!0,this.alignOrbitUpDirection=!0,this.constrainOrbitHorizontal=!1,this.constrainOrbitVertical=!1,this.doCustomOrbit=!1,this.snapOrbitDeadZone=.045,this.snapOrbitThresholdH=this.snapOrbitThresholdV=i.Math.degToRad(15),this.snapOrbitAccelerationAX=this.snapOrbitAccelerationAY=1.5,this.snapOrbitAccelerationBX=this.snapOrbitAccelerationBY=2,this.snapOrbitAccelerationPointX=this.snapOrbitAccelerationPointY=.5,this.alignDirTable=new Array(26),this.alignDirTable[0]=new i.Vector3(-1,0,0),this.alignDirTable[1]=new i.Vector3(1,0,0),this.alignDirTable[2]=new i.Vector3(0,-1,0),this.alignDirTable[3]=new i.Vector3(0,1,0),this.alignDirTable[4]=new i.Vector3(0,0,-1),this.alignDirTable[5]=new i.Vector3(0,0,1),this.alignDirTable[6]=new i.Vector3(-1,-1,0),this.alignDirTable[7]=new i.Vector3(-1,1,0),this.alignDirTable[8]=new i.Vector3(1,-1,0),this.alignDirTable[9]=new i.Vector3(1,1,0),this.alignDirTable[10]=new i.Vector3(0,-1,-1),this.alignDirTable[11]=new i.Vector3(0,-1,1),this.alignDirTable[12]=new i.Vector3(0,1,-1),this.alignDirTable[13]=new i.Vector3(0,1,1),this.alignDirTable[14]=new i.Vector3(-1,0,-1),this.alignDirTable[15]=new i.Vector3(1,0,-1),this.alignDirTable[16]=new i.Vector3(-1,0,1),this.alignDirTable[17]=new i.Vector3(1,0,1),this.alignDirTable[18]=new i.Vector3(-1,-1,-1),this.alignDirTable[19]=new i.Vector3(-1,-1,1),this.alignDirTable[20]=new i.Vector3(-1,1,-1),this.alignDirTable[21]=new i.Vector3(-1,1,1),this.alignDirTable[22]=new i.Vector3(1,-1,-1),this.alignDirTable[23]=new i.Vector3(1,-1,1),this.alignDirTable[24]=new i.Vector3(1,1,-1),this.alignDirTable[25]=new i.Vector3(1,1,1),this.combined=!1,this.useSnap=!1,this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new i.Vector3(0,0,0),this.topLimit=!1,this.bottomLimit=!1,this.minSceneBound=0,this.maxSceneBound=0;var E,T,M={destinationPercent:1,duration:1,zoomToFitScene:!0,useOffAxis:!1};this.shotParams=M,this.zoomDelta=new i.Vector2;var S,C=new i.Vector3,P=new i.Vector3;function L(e,t){var n=new i.Vector2(0,0);return n.x=e/window.innerWidth,n.y=t/window.innerHeight,n}function R(e,t,n){var i,r,a,s;i=r=a=s=0;var l=0,c=null,u=null,h=o.snapOrbitDeadZone,d=o.orbitMultiplier;return"h"==e?(i=o.snapOrbitThresholdH,r=o.snapOrbitAccelerationAX,a=o.snapOrbitAccelerationBX,s=1-o.snapOrbitAccelerationPointX,u=o.lockDeltaX,c=o.lockedX):(i=o.snapOrbitThresholdV,r=o.snapOrbitAccelerationAY,a=o.snapOrbitAccelerationBY,s=1-o.snapOrbitAccelerationPointY,u=o.lockDeltaY,c=o.lockedY),c?(u+=n)<-h?(l=(u+h)*d*1/a,c=!1):u>h&&(l=(u-h)*d*1/a,c=!1):(l=Math.abs(t)>i?n*d:Math.abs(t)>s*i?n*t>0?n*d*r:n*d*1/r:n*t>0?n*d*a:n*d*1/a)*t>0&&Math.abs(l)>Math.abs(t)&&(this.lockDeltaX=this.lockDeltaY=0,c=!0,l=t),l}function D(){return o.combined}function I(e,t){var n=!1,i=window.innerWidth,r=e.x%i,o=window.innerHeight,a=e.y%o,s=r>0?r-t.x:i+r-t.x,l=a>0?a-t.y:o+a-t.y;return Math.abs(s)<30&&Math.abs(l)<30&&(n=!0),n}function O(e,t,n){if(!S||!e){if(e){var r=new i.Vector2,o=t.x,a=t.y;!function(e,t,n){n.x=(e.x-t.x)/window.innerWidth,e.x=t.x+(e.x-t.x)%window.innerWidth,n.y=(e.y-t.y)/window.innerHeight,e.y=t.y+(e.y-t.y)%window.innerHeight}(t,n,r),window.innerWidth*r.x,window.innerHeight*r.y,o<n.x?o-=60:o+=60,a<n.y?a-=60:a+=60}S=e}}function N(e){var t=Math.pow(e,2);e<0&&(t=-t);var n=L(0,t),i=.01*(o.maxSceneBound-o.minSceneBound);n.y*=i;var r=o.userHeightSpeed*n.y;return r=function(e,t,n){if(0===t)return 0;var i=e,r=o.saveEye.clone().sub(worldUp.clone().multiplyScalar(n+i)),a=o.saveEye.clone().sub(worldUp.clone().multiplyScalar(n)),s=0,l=(o.maxSceneBound-o.minSceneBound)/1e3;o.topLimit&&t>0?(s=o.maxSceneBound-l,o.topLimit=!1):o.bottomLimit&&t<0?(s=o.minSceneBound+l,o.bottomLimit=!1):s=r.dot(worldUp);var c=a.dot(worldUp);return s<o.minSceneBound?c<o.minSceneBound&&(o.bottomLimit=!0,i=0):s>o.maxSceneBound&&c>o.maxSceneBound&&(o.topLimit=!0,i=0),i}(r,e,o.m_amount)}function k(e){var t=o.sceneFrontDirection.clone().cross(o.sceneUpDirection),n=Math.abs(Math.abs(e.dot(o.sceneUpDirection))-1),i=Math.abs(Math.abs(e.dot(o.sceneFrontDirection))-1),r=Math.abs(Math.abs(e.dot(t))-1);return n<1e-5||i<1e-5||r<1e-5}this.rewindParams={history:[],startTime:void 0,thumbnailSize:56,thumbnailGapSize:12,maxHistorySize:25,snappingEnabled:!0,timelineIndex:0,timelineIndexSlide:0,open:!1,openLocation:new i.Vector2(0,0),openBracket:new i.Vector2(0,0),openBracketA:new i.Vector2(0,0),openBracketB:new i.Vector2(0,0),openLocationOrigin:new i.Vector2(0,0),locationOffset:new i.Vector2(0,0),snapOffset:new i.Vector2(0,0),slideOffset:new i.Vector2(0,0),snapped:!0,resetWeights:!1,recordEnabled:!1,elementIsRecording:!1},this.viewCubeMenuOpen=!1,this.menuSize=new i.Vector2(0,0),this.menuOrigin=new i.Vector2(0,0),e.lookAt(this.center),this.setCube=function(e){this.cube=e},this.loadObject=function(e,t,n){(new i.JSONLoader).load(e,function(e,r){var o=new i.MeshPhongMaterial(r),a=new i.Mesh(e,o);a.scale=t,a.position.copy(n),a.geometry.computeBoundingBox();var s=a.geometry.boundingBox.clone();P.set(s.max.x,s.max.y,s.max.z),C.set(s.min.x,s.min.y,s.min.z),P.multiply(t),C.multiply(t),scene.add(a),objects.push(a)})},this.sync=function(t){t.isPerspective!==e.isPerspective&&(t.isPerspective?e.toPerspective():(e.toOrthographic(),t.saveFov&&(e.saveFov=t.saveFov))),e.fov=t.fov,e.position.copy(t.position),t.target&&(this.center.copy(t.target),e.target.copy(t.target)),t.pivot&&(this.pivot.copy(t.pivot),e.pivot.copy(t.pivot)),this.dir.copy(this.center).sub(e.position),this.setCameraUp(t.up);var n=t.worldup?t.worldup:t.up;n.distanceToSquared(this.sceneUpDirection)>1e-4&&this.setWorldUpVector(n),p&&!this.navApi.getTransitionActive()&&(p=!1,this.setCurrentViewAsHome(!1)),this.cube&&requestAnimationFrame(this.cube.render)},this.refresh=function(){this.cube&&this.cube.refreshCube()},i.Box2.prototype.setCenter=function(e){var t=new i.Vector2(Math.abs(this.max.x-this.min.x)/2,Math.abs(this.max.y-this.min.y)/2);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this},i.Box2.prototype.getIcon2DCoords=function(e,t){var n=this.center;t.set((e.x-n.x)/(this.size().x/2),(e.y-n.y)/(this.size().y/2))},i.Matrix3.prototype.makeRotationFromQuaternion=function(e){var t=this.elements,n=e.x,i=e.y,r=e.z,o=e.w,a=n+n,s=i+i,l=r+r,c=n*a,u=n*s,h=n*l,d=i*s,f=i*l,p=r*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(d+p),t[3]=u-v,t[6]=h+g,t[1]=u+v,t[4]=1-(c+p),t[7]=f-m,t[2]=h-g,t[5]=f+m,t[8]=1-(c+d),this},i.Quaternion.prototype.setFromRotationMatrix3=function(e){var t,n=e.elements,i=n[0],r=n[3],o=n[6],a=n[1],s=n[4],l=n[7],c=n[2],u=n[5],h=n[8],d=i+s+h;return d>0?(t=.5/Math.sqrt(d+1),this.w=.25/t,this.x=(u-l)*t,this.y=(o-c)*t,this.z=(a-r)*t):i>s&&i>h?(t=2*Math.sqrt(1+i-s-h),this.w=(u-l)/t,this.x=.25*t,this.y=(r+a)/t,this.z=(o+c)/t):s>h?(t=2*Math.sqrt(1+s-i-h),this.w=(o-c)/t,this.x=(r+a)/t,this.y=.25*t,this.z=(l+u)/t):(t=2*Math.sqrt(1+h-i-s),this.w=(a-r)/t,this.x=(o+c)/t,this.y=(l+u)/t,this.z=.25*t),this},i.Quaternion.prototype.rotate=function(e){var t=(new i.Matrix4).makeRotationFromQuaternion(this).elements,n=(new i.Matrix3).set(t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]);return e.applyMatrix3(n)},i.Vector3.prototype.findAngleWith=function(e,t){var n=0,r=this.clone().normalize().clone().dot(e.clone().normalize()),o=this.clone().cross(e).clone().normalize();if(o.clone().length()<Number.MIN_VALUE)n=r>0?0:180;else{var a=o.clone().dot(t.clone().normalize());t=a>0?o:-o;var s=(new i.Quaternion).setFromAxisAngle(t,90*i.Math.degToRad);s=s.clone().rotate(e).clone().normalize().clone().dot(this),n=Math.acos(r)*i.Math.radToDeg,Math.abs(n-90)<Number.MIN_VALUE&&(n=90),(n<90&&r*s>0||n>90&&r*s<0||90==n&&s>0)&&(n*=-1)}return n=i.Math.degToRad(n)},"contains"in String.prototype||(String.prototype.contains=function(e,t){return-1!==String.prototype.indexOf.call(this,e,t)}),Math.linearClamp=function(e,t,n){return e<=t?0:e>=n?1:(e-t)/(n-t)},Math.easeClamp=function(e,t,n){if(e<=t)return 0;if(e>=n)return 1;var i=(e-t)/(n-t);return.5*(Math.sin((i-.5)*Math.PI)+1)},Math.linearInterp=function(e,t,n){return t*(1-e)+n*e},Math.equalityClamp=function(e,t,n){return e<=t?t:e>=n?n:e},Math.round2=function(e){return Math.round(100*e)/100},Math.round1=function(e){return Math.round(10*e)/10},this.animateTransition=function(t){if(t){var n=!1,i=0;if(this.setCameraOrtho(t.isOrtho),o.elapsedTime>=M.duration)return i=1,o.center.copy(t.center),o.pivot.copy(t.pivot),e.position.copy(t.position),e.up.copy(t.up),e.target.copy(t.center),t.isOrtho||(e.fov=t.fov),e.dirty=!0,(n=!t.worldUp.equals(this.sceneUpDirection))&&this.setWorldUpVector(t.worldUp),this.currentlyAnimating=!1,m(n),this.showPivot(!1),this.cube&&requestAnimationFrame(this.cube.render),this.addHistoryElement(),this.navApi.setTransitionActive(!1),void this.transitionCompletedCallback();this.currentlyAnimating=!0,this.showPivot(!0),this.navApi.setTransitionActive(!0);var r=M.destinationPercent,a=1-(i=Math.easeClamp(o.elapsedTime/M.duration,0,r));o.elapsedTime+=l/500;var s=o.center.clone().multiplyScalar(a).add(t.center.clone().multiplyScalar(i)),c=e.position.clone().multiplyScalar(a).add(t.position.clone().multiplyScalar(i)),u=e.up.clone().multiplyScalar(a).add(t.up.clone().multiplyScalar(i)),h=e.pivot.clone().multiplyScalar(a).add(t.pivot.clone().multiplyScalar(i)),d=this.sceneUpDirection.clone().multiplyScalar(a).add(t.worldUp.clone().multiplyScalar(i)),f=e.fov*a+t.fov*i;o.center.copy(s),o.pivot.copy(h),e.position.copy(c),e.up.copy(u),e.target.copy(s),t.isOrtho||(e.fov=f),e.dirty=!0,(n=d.distanceToSquared(this.sceneUpDirection)>1e-4)&&this.setWorldUpVector(d),e.lookAt(o.center),m(n),this.cube&&requestAnimationFrame(this.cube.render),requestAnimationFrame(function(){o.animateTransition(t)})}},this.sphericallyInterpolateTransition=function(t){var n,r,a,s=0;if(this.currentlyAnimating=!0,this.navApi.setTransitionActive(!0),o.elapsedTime>=M.duration)s=1,this.currentlyAnimating=!1;else{var c=M.destinationPercent;s=Math.easeClamp(o.elapsedTime/M.duration,0,c),o.elapsedTime+=l/500}if(1===s)r=T.position,n=T.center,a=T.up;else{var u=new i.Matrix3,h=_.clone();h.slerp(b,s),u.makeRotationFromQuaternion(h);var d=Math.linearInterp(s,g,v),f=u.elements;r=(n=E.center.clone().multiplyScalar(1-s).add(T.center.clone().multiplyScalar(s))).clone().sub(new i.Vector3(f[0],f[1],f[2]).multiplyScalar(d)),a=new i.Vector3(f[3],f[4],f[5])}o.center.copy(n),e.position.copy(r),e.up.copy(a),o.navApi.getUsePivotAlways()||o.pivot.copy(n),e.lookAt(o.center),!0===this.currentlyAnimating?(this.showPivot(!0),requestAnimationFrame(function(){o.sphericallyInterpolateTransition(t)})):(this.navApi.setTransitionActive(!1),this.showPivot(!1),this.addHistoryElement(),this.orthographicFaces&&this.isFaceView()&&this.setCameraOrtho(!0),t&&t()),m(!1),this.cube&&requestAnimationFrame(this.cube.render)},this.getOrientation=function(){if(this.cube){var t=Math.round1(e.up.x),n=Math.round1(e.up.y),i=Math.round1(e.up.z),r=this.sceneFrontDirection.clone(),o=this.sceneUpDirection.clone(),a=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();r.x=Math.round1(r.x),r.y=Math.round1(r.y),r.z=Math.round1(r.z),o.x=Math.round1(o.x),o.y=Math.round1(o.y),o.z=Math.round1(o.z),a.x=Math.round1(a.x),a.y=Math.round1(a.y),a.z=Math.round1(a.z);var s=a.clone().multiplyScalar(-1),l=o.clone().multiplyScalar(-1),c=r.clone().multiplyScalar(-1);switch(this.cube.currentFace){case"front":if(o.x==t&&o.y==n&&o.z==i)return"up";if(l.x==t&&l.y==n&&l.z==i)return"down";if(a.x==t&&a.y==n&&a.z==i)return"right";if(s.x==t&&s.y==n&&s.z==i)return"left";break;case"right":if(o.x==t&&o.y==n&&o.z==i)return"up";if(l.x==t&&l.y==n&&l.z==i)return"down";if(c.x==t&&c.y==n&&c.z==i)return"left";if(r.x==t&&r.y==n&&r.z==i)return"right";break;case"left":if(o.x==t&&o.y==n&&o.z==i)return"up";if(l.x==t&&l.y==n&&l.z==i)return"down";if(r.x==t&&r.y==n&&r.z==i)return"left";if(c.x==t&&c.y==n&&c.z==i)return"right";break;case"back":if(o.x==t&&o.y==n&&o.z==i)return"up";if(l.x==t&&l.y==n&&l.z==i)return"down";if(s.x==t&&s.y==n&&s.z==i)return"right";if(a.x==t&&a.y==n&&a.z==i)return"left";break;case"top":if(c.x==t&&c.y==n&&c.z==i)return"down";if(r.x==t&&r.y==n&&r.z==i)return"up";if(a.x==t&&a.y==n&&a.z==i)return"right";if(s.x==t&&s.y==n&&s.z==i)return"left";break;case"bottom":if(r.x==t&&r.y==n&&r.z==i)return"down";if(c.x==t&&c.y==n&&c.z==i)return"up";if(a.x==t&&a.y==n&&a.z==i)return"right";if(s.x==t&&s.y==n&&s.z==i)return"left"}}},this.setCameraOrtho=function(t){t&&e.isPerspective&&e.toOrthographic(),t||e.isPerspective||e.toPerspective()},this.resetOrientation=function(){this.setCameraOrtho(this.originalHomeVector.isOrtho),this.sceneUpDirection.copy(this.originalHomeVector.worldUp),this.sceneFrontDirection.copy(this.originalHomeVector.worldFront),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.setCameraUp(this.sceneUpDirection),m(!0)},this.setCurrentViewAsFront=function(){this.cube&&(this.cube.currentFace="front"),this.sceneUpDirection.copy(e.up.clone()),this.sceneFrontDirection.copy(this.getView()).normalize(),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.orthographicFaces&&this.setCameraOrtho(!0),m(!0)},this.setCurrentViewAsTop=function(){this.cube&&(this.cube.currentFace="top"),this.sceneUpDirection.copy(this.getView()).multiplyScalar(-1).normalize(),this.sceneFrontDirection.copy(e.up),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),m(!0)},this.calculateCubeTransform=function(t){var n=this.sceneUpDirection.clone(),r=this.sceneFrontDirection.clone(),a=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();(E=e.clone()).center=o.center.clone(),E.pivot=o.pivot.clone(),(T=e.clone()).center=o.center.clone(),T.pivot=o.pivot.clone();var s=new i.Vector3(0,0,0);t.contains("back")&&(s=s.add(r)),t.contains("front")&&(s=s.sub(r)),t.contains("top")&&(s=s.add(n)),t.contains("bottom")&&(s=s.sub(n)),t.contains("right")&&(s=s.add(a)),t.contains("left")&&(s=s.sub(a));var l=n,c=s.clone().normalize();if(1-Math.abs(c.dot(n))<Number.MIN_VALUE)for(var u=this.getView().normalize(),h=[r.clone(),r.clone().negate(),a.clone(),a.clone().negate()],d=c.dot(n)>0?1:-1,f=u.clone().add(e.up.clone().multiplyScalar(d)).normalize(),p=-2,m=0;m<4;m++){var y=f.dot(h[m]);y>p&&(p=y,l=h[m].multiplyScalar(d))}v=g=this.getView().length(),T.position.copy(T.center.clone().add(s.multiplyScalar(v/s.length()))),T.up.copy(l);var x=E.center.clone().sub(E.position).normalize(),M=x.clone().cross(E.up).normalize(),S=M.clone().cross(x).normalize(),C=new i.Matrix3;C.set(x.x,S.x,M.x,x.y,S.y,M.y,x.z,S.z,M.z),_.setFromRotationMatrix3(C),S=(M=(x=T.center.clone().sub(T.position).normalize()).clone().cross(T.up).normalize()).clone().cross(x).normalize(),C.set(x.x,S.x,M.x,x.y,S.y,M.y,x.z,S.z,M.z),w.setFromAxisAngle(x,0),A.setFromAxisAngle(S,0),b.setFromRotationMatrix3(C),b.multiply(w).multiply(A).normalize()},this.centerShot=function(t){E&&!t||(o.elapsedTime=0,(E=T=e.clone()).center=o.center);var n=o.pivot.clone(),i=n.clone().sub(E.position),r=E.center.clone().sub(E.position).normalize(),a=E.up.clone(),s=r.clone().cross(a).normalize();a=s.clone().cross(r).normalize();var c=s.clone().multiplyScalar(s.dot(i)),u=a.clone().multiplyScalar(a.dot(i)),h=c.clone().add(u);T.position.copy(E.position.clone().add(h)),T.center=n,T.pivot=n;var d=0;if(o.elapsedTime>=M.duration)d=1;else{var f=M.destinationPercent;d=Math.easeClamp(o.elapsedTime/M.duration,0,f),o.elapsedTime+=l/2e3}var p=e.position.clone().multiplyScalar(1-d).add(T.position.clone().multiplyScalar(d)),g=o.center.clone().multiplyScalar(1-d).add(T.center.clone().multiplyScalar(d)),v=o.pivot.clone().multiplyScalar(1-d).add(T.pivot.clone().multiplyScalar(d));e.position.copy(p),o.center.copy(g),o.pivot.copy(v),e.lookAt(o.center),m(!1),1===d?this.addHistoryElement():requestAnimationFrame(function(){o.centerShot(!1)})},this.levelShot=function(){var t=this.getView(),n=t.length(),i=this.sceneUpDirection.clone(),r=e.up.clone().normalize(),a=t.normalize(),s=a.dot(i);if(1-Math.abs(s)>Number.MIN_VALUE){var l=a.clone().cross(i);(a=i.clone().cross(l)).normalize()}else a=r.clone();a.multiplyScalar(n);var c={center:a.add(e.position),up:i,position:e.position,pivot:o.center.clone().add(a),fov:e.fov,worldUp:i};o.elapsedTime=0,o.animateTransition(c)},this.fitToWindow=function(){var t=this.getView(),n=e.up.clone();t.normalize(),n.normalize(),(T=e.clone()).center=o.center,(n=function(e,t){var n=e.clone();if(Math.abs(n.clone().dot(t))<Number.MIN_VALUE)return n.normalize(),n;(n=function(e,t){t.normalize();var n=e.clone().dot(t),i=t.clone().multiplyScalar(n);return i=e.clone().sub(i)}(e,t)).length()<Number.MIN_VALUE&&(n=function(e){for(var t=new i.Vector3(0,0,0),n=[new i.Vector3(0,1,0),new i.Vector3(1,0,0),new i.Vector3(0,0,1),new i.Vector3(0,1,1),new i.Vector3(1,0,1),new i.Vector3(1,1,0),new i.Vector3(1,1,1)],r=0;r<7;r++)if(Math.abs(n[r].dot(e))<Number.MIN_VALUE){t=n[r];break}return t}(t));return n.normalize(),n}(n,t)).normalize(),T.up.copy(n);var r=t.clone().cross(n);r.normalize();var a=C.clone(),s=P.clone(),l=[a,s],c=new i.Vector3(s.x-a.x,s.y-a.y,s.z-a.z);l[2]=new i.Vector3(s.x,a.y,s.z),l[3]=new i.Vector3(s.x,a.y,a.z),l[4]=new i.Vector3(s.x,s.y,a.z),l[5]=new i.Vector3(a.x,s.y,s.z),l[6]=new i.Vector3(a.x,s.y,a.z),l[7]=new i.Vector3(a.x,a.y,s.z);for(var u=0;u<8;u++){var h=l[u].clone().sub(e.position);l[u].setX(h.clone().dot(r)),l[u].setY(h.clone().dot(n)),l[u].setZ(h.clone().dot(t))}var d,f,p,m,g=i.Math.degToRad(e.topFov),v=i.Math.degToRad(e.bottomFov),y=i.Math.degToRad(e.leftFov),_=i.Math.degToRad(e.rightFov);d=y>=0?Number.MAX_VALUE:Number.MIN_VALUE,f=_>=0?Number.MAX_VALUE:Number.MIN_VALUE,p=g>=0?Number.MAX_VALUE:Number.MIN_VALUE,m=v>=0?Number.MAX_VALUE:Number.MIN_VALUE;for(var b=1/Math.tan(_),x=-1/Math.tan(y),w=1/Math.tan(g),A=-1/Math.tan(v),E=0;E<8;E++){var M=l[E].clone(),S=M.z-x*M.x;d=y>=0?Math.min(d,S):Math.max(d,S),S=M.z-b*M.x,f=_>=0?Math.min(f,S):Math.max(f,S),S=M.z-w*M.y,p=g>=0?Math.min(p,S):Math.max(p,S),S=M.z-A*M.y,m=v>=0?Math.min(m,S):Math.max(m,S)}var L=(f-d)/(x-b),R=x*L+d,D=(m-p)/(w-A),I=w*D+p,O=0;if(R<=I){var N=(g-v)/2;if(Math.abs(N)>Number.MIN_VALUE){var k=1/Math.tan(N);D=D-I/k+R/k}O=R}else{var V=(_-y)/2;if(Math.abs(V)>Number.MIN_VALUE){var F=1/Math.tan(V);L=L-R/F+I/F}O=I}var B=new i.Vector3(L,D,O),U=r.clone().multiplyScalar(B.x),z=n.clone().multiplyScalar(B.y),G=t.clone().multiplyScalar(B.z);B=U.clone().add(z.clone().add(G)),T.position.add(B);var H=c.clone().sub(T.position).dot(t);T.center=T.position.clone().add(t.multiplyScalar(H)),T.pivot=c.clone();var W={center:T.center,up:T.up,position:T.position,pivot:T.pivot,fov:e.fov,worldUp:o.sceneUpDirection.clone()};o.elapsedTime=0,o.animateTransition(W)},this.updatePivotPosition=function(t){var n,r=new i.Vector3(t.x/window.innerWidth*2-1,-t.y/window.innerHeight*2+1,.5);if(r=r.unproject(e),n=new i.Raycaster(e.position,r.sub(e.position).normalize()).intersectObjects(objects),"zoom"==o.mode)if(void 0!==n[0]){var a=n[0].point;o.pivot.copy(a)}else{var s=function(t){var n,r;t.y=Math.abs(t.y-window.innerHeight);var a=e.position,s=o.center.clone().sub(a),l=e.up,c=s.clone().cross(l),u=s.clone().length(),h=u*Math.tan(i.Math.degToRad(e.leftFov)),d=u*Math.tan(i.Math.degToRad(e.rightFov)),f=u*Math.tan(i.Math.degToRad(e.topFov)),p=u*Math.tan(i.Math.degToRad(e.bottomFov)),m=h+d,g=f+p,v=t.x*m/window.innerWidth-h,y=t.y*g/window.innerHeight-p;return l=l.clone().normalize().clone().multiplyScalar(y),c=c.clone().normalize().clone().multiplyScalar(v),o.ortho?(n=a.clone().add(c).clone().add(l),r=s):(n=a,r=s.clone().add(l).clone().add(c)),{rayO:n,rayD:r}}(t);o.pivot.copy(s.rayO.clone().add(s.rayD))}else if(void 0!==n[0]){wheel.cursorImage("pivot");a=n[0].point;o.isMouseDown||o.pivot.copy(a)}else wheel.cursorImage("SWInvalidArea")},this.onDrawHeight=function(t,n,r,a,s){var l=new i.Vector3(0,1,0),c=e.position.clone().dot(l);Math.linearClamp(c,o.minSceneBound,o.maxSceneBound)},this.drawDropdownMenu=function(e,t,n,i,o,s,l){var c=0;if(a)s.appendChild(a);else{(a=document.createElement("div")).className="dropDownMenu",a.style.top="100px",a.style.left="-400px";for(var u=0,h=0,d=0;d<e.length;d++){var f;if(null===e[d])(f=document.createElement("li")).style.height="1px",u+=1,f.style.backgroundColor="#E0E0E0";else{var p=r.i18n.translate(e[d]);if(h=p.length>h?p.length:h,n[d]){f=document.createElement("div");var m=document.createElement("input"),g=document.createElement("label");m.type="radio",m.className="dropDownMenuCheck",g.innerHTML=p,g.className="dropDownMenuCheckText",f.appendChild(m),f.appendChild(g),f.className="dropDownMenuCheckbox"}else(f=document.createElement("li")).textContent=p,f.className=t[d]?"dropDownMenuItem":"dropDownMenuItemDisabled";f.id="menuItem"+c,c++,u+=25,f.setAttribute("data-i18n",e[d])}a.appendChild(f)}s.appendChild(a),a.style.minWidth=Math.max(256,7.4*h)+"px";var v=a.getBoundingClientRect().width;this.menuSize.x=v,this.menuSize.y=u}c=0;for(d=0;d<e.length;d++)if(null!==e[d]){if(n[d]){var y="menuItem"+c,_=document.getElementById(y);_&&(_.children[0].checked=n[d]())}c++}var b=o-15,x=i+1,w=this.canvas.getBoundingClientRect();x+this.menuSize.x>w.right&&(x=i-this.menuSize.x-1),b+this.menuSize.y>w.bottom&&(b=w.bottom-this.menuSize.y),b-=l.y,x-=l.x,a.style.top=b+"px",a.style.left=x+"px",this.menuOrigin.x=x,this.menuOrigin.y=b},this.removeDropdownMenu=function(e){e.removeChild(a)},this.isFaceView=function(){return k(this.center.clone().sub(e.position).normalize())&&k(e.up)},this.startInteraction=function(e,t){this.startCursor=new i.Vector2(e,t),this.startState={saveCenter:this.center.clone(),saveEye:this.camera.position.clone(),savePivot:this.pivot.clone(),saveUp:this.camera.up.clone()},this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new i.Vector3(0,0,0),this.navApi.setTransitionActive(!0)},this.orbit=function(t,n,r,a){if(this.navApi.isActionEnabled("orbit")&&!0!==this.currentlyAnimating){var s="wheel";if(o.orthographicFaces&&!e.isPerspective&&(e.toPerspective(),a&&a.saveEye.copy(this.camera.position)),a&&(s="cube"),"cube"==s?(this.saveCenter.copy(a.saveCenter),this.saveEye.copy(a.saveEye),this.savePivot.copy(a.savePivot),this.saveUp.copy(a.saveUp),this.useSnap=!0,this.doCustomOrbit=!0):(this.saveCenter.copy(this.center),this.savePivot.copy(this.pivot),this.saveEye.copy(e.position),this.saveUp.copy(e.up),this.useSnap=!1,this.doCustomOrbit=!1),D()&&null==u&&(u=this.saveCenter.clone(),c=this.saveEye.clone(),d=this.savePivot.clone(),h=this.saveUp.clone()),this.preserveOrbitUpDirection){var l=L(t.x-n.x,t.y-n.y),f=L(r.x,r.y),p=this.sceneUpDirection.clone(),g=this.sceneFrontDirection.clone(),v=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),y=D()?d:this.savePivot,_=D()?c:this.saveEye,b=D()?u:this.saveCenter,x=D()?h:this.saveUp,w=y.clone().sub(_).normalize(),A=b.clone().sub(_).normalize(),E=A.clone().cross(x),T=_.clone().sub(y).length(),M=_.clone().sub(b).length(),S=w.clone().multiplyScalar(-1),C=A.clone().multiplyScalar(-1),P=E,I=x.clone();if(!this.constrainOrbitHorizontal){p.dot(this.saveUp)<-.009&&(l.x=-l.x,f.x=-f.x);var O=0;O=D()?f.x*this.orbitMultiplier:this.useSnap?this.lastSnapRotateX+R("h",0,-f.x):l.x*this.orbitMultiplier,this.lastSnapRotateX=O;var N=(new i.Quaternion).setFromAxisAngle(p,-O);S.applyQuaternion(N),C.applyQuaternion(N),P.applyQuaternion(N),I.applyQuaternion(N)}if(!this.constrainOrbitVertical){var k=g.clone().multiplyScalar(g.dot(P)),V=v.clone().multiplyScalar(v.dot(P)),F=k.clone().add(V);F.clone().normalize();var B=0;if(D())B=f.y*this.orbitMultiplier;else{var U=R("v",0,f.y);B=this.useSnap?this.lastSnapRotateY+U:l.y*this.orbitMultiplier}var z=(new i.Quaternion).setFromAxisAngle(F,-B);if(this.navApi.getOrbitPastWorldPoles())S.applyQuaternion(z).normalize(),C.applyQuaternion(z).normalize(),I.applyQuaternion(z).normalize();else{var G=I.clone();if(G.applyQuaternion(z).normalize(),p.dot(G)<0){var H=C.clone();H.applyQuaternion(z).normalize();var W=H.angleTo(p);Math.abs(W)>.5*Math.PI&&(W-=W>0?Math.PI:-Math.PI),B-=W,z.setFromAxisAngle(F,-B),S.applyQuaternion(z).normalize(),C.applyQuaternion(z).normalize(),I.applyQuaternion(z).normalize()}else S.applyQuaternion(z).normalize(),C.applyQuaternion(z).normalize(),I.applyQuaternion(z).normalize()}this.lastSnapRotateY=B}var j=S.multiplyScalar(T).add(y);e.position.copy(j),e.up.copy(I),this.center.copy(j),this.center.sub(C.multiplyScalar(M)),D()&&(u.copy(this.center),c.copy(e.position),d.copy(this.pivot),h.copy(e.up))}e.lookAt(this.center),m(!1)}},this.endInteraction=function(){this.navApi.setTransitionActive(!1)},this.look=function(t){if(this.navApi.isActionEnabled("walk")){var n=L(t.x,t.y),r=this.userLookSpeed,o=this.getView(),a=e.up,s=o.clone().cross(a).normalize(),l=this.sceneUpDirection.clone(),c=n.clone();c.x*=Math.PI,c.y*=Math.PI/e.aspect,c.multiplyScalar(r);var u=(new i.Quaternion).setFromAxisAngle(s,-c.y);if(e.keepSceneUpright&&!this.navApi.getOrbitPastWorldPoles()){var h=a.clone();if(h.applyQuaternion(u).normalize(),h.dot(l)<0){var d=o.clone();d.applyQuaternion(u);var f=d.angleTo(l);Math.abs(f)>.5*Math.PI&&(f-=f>0?Math.PI:-Math.PI),c.y-=f,u.setFromAxisAngle(s,-c.y)}}o=u.clone().rotate(o),(a=u.clone().rotate(a)).normalize();var p=e.keepSceneUpright?l:a,g=(new i.Quaternion).setFromAxisAngle(p,-c.x);o=g.clone().rotate(o),a=g.clone().rotate(a),this.center.copy(o.add(e.position)),e.up.copy(a),e.lookAt(this.center),m(!1)}},this.pan=function(t){if(this.navApi.isActionEnabled("pan")){t=L(t.x,t.y);var n=this.getView(),r=e.up.clone().cross(n),o=n.clone().cross(r);r.normalize(),o.normalize(),n.normalize();var a=this.pivot.clone().sub(e.position),s=n.clone().dot(a),l=s*(Math.tan(i.Math.degToRad(e.leftFov))+Math.tan(i.Math.degToRad(e.rightFov))),c=s*(Math.tan(i.Math.degToRad(e.topFov))+Math.tan(i.Math.degToRad(e.bottomFov))),u=t.x*Math.abs(l),h=t.y*Math.abs(c),d=new i.Vector3,f=r.clone().multiplyScalar(u),p=o.clone().multiplyScalar(h);d=f.clone().add(p).clone().multiplyScalar(this.userPanSpeed),e.position.add(d),this.center.add(d),e.lookAt(this.center),m(!1)}},this.zoom=function(t){if(this.navApi.isActionEnabled("zoom")){var n=this.userZoomSpeed,i=Number.MAX_VALUE,r=t.x+t.y,a=Math.pow(n,r),s=this.pivot.clone().sub(this.pivot.clone().sub(this.saveEye).clone().multiplyScalar(a)),l=s.clone().add(o.D.clone().multiplyScalar(o.D.clone().dot(this.pivot.clone().sub(s).clone())));if(!(a>=i)){if(r>0){Math.pow(n,r-0);if(r<0)return void 0;e.position.copy(s),this.center.copy(l);var c=s.clone().sub(this.saveEye).dot(o.D);c>i?(e.position.copy(this.saveEye.sub(o.D).clone().multiplyScalar(i)),i>0?-1:0):-c/i}else e.position.copy(s),this.center.copy(l);e.lookAt(this.center),m(!1)}}},this.walk=function(t,n,r,o,a){if(this.navApi.isActionEnabled("walk")){var s=this.sceneUpDirection.clone(),l=this.sceneFrontDirection.clone(),c=this.sceneFrontDirection.clone().cross(this.sceneUpDirection);I(t,n)?(wheel.cursorImage("SWWalk"),O(!0,t,n),x=n.x,y=n.y):O(!1,t,n),x=t.x,y=t.y;var u=L(x-n.x,y-n.y),h=-u.x,d=-u.y,f=h<0?-1:1,p=d<0?-1:1,g=Math.abs(h),v=Math.abs(d),_=new i.Vector2(30,30);_=L(_.x,_.y),g=I(t,n)?0:Math.abs(h)-_.x,v=I(t,n)?0:Math.abs(d)-_.y;v/=.25;var b=(g=(g/=.25)<1?Math.easeClamp(g,0,1):Math.pow(g,1))>0?g*f:0,w=(v=v<1?Math.easeClamp(v,0,1):Math.pow(v,1))>0?v*p:0,A=this.getView(),E=A.length();A.normalize(),A.clone().cross(e.up).normalize();var T=c.clone().multiplyScalar(c.clone().dot(A)),M=l.clone().multiplyScalar(l.clone().dot(A)).clone().add(T);M=M.clone().length()>Number.MIN_VALUE?M.normalize():e.up;var S=w*(1*this.walkMultiplier),C=M,P=Math.cos(.65);1!=P&&(s.clone().dot(e.up)<-Number.MIN_VALUE&&s.clone().dot(A)<-P||s.clone().dot(e.up)>Number.MIN_VALUE&&s.clone().dot(A)>P)&&(C=-C);var R=-b*this.walkMultiplier*.05,D=e.up;(s.clone().dot(e.up)<-Number.MIN_VALUE||Math.abs(s.clone().dot(e.up))<Number.MIN_VALUE&&s.clone().dot(A)>Number.MIN_VALUE)&&(R=-R),D=s;var N=(new i.Quaternion).setFromAxisAngle(D,R);N.normalize(),(A=N.clone().rotate(A)).normalize(),e.up.copy(N.clone().rotate(e.up)),e.up.normalize(),e.position.add(C.clone().multiplyScalar(S)),this.center.copy(e.position.clone().add(A.clone().multiplyScalar(E))),(C=s).normalize(),0===S&&(S=.01),e.lookAt(this.center),m(!1)}},this.updown=function(t){if(!this.navApi.getIsLocked()){var n=N(t);o.m_amount+=n;var r=new i.Vector3(0,1,0),a=o.saveEye.clone().sub(r.clone().multiplyScalar(o.m_amount)),s=a.clone().dot(r);e.position.copy(a),s<o.minSceneBound&&e.position.add(r.clone().multiplyScalar(o.minSceneBound-s)),s>o.maxSceneBound&&e.position.add(r.clone().multiplyScalar(o.maxSceneBound-s)),this.center.copy(e.position.clone().add(o.saveCenter.clone().sub(o.saveEye))),e.lookAt(this.center),m(!1)}},this.addHistoryElement=function(){},this.addIntermediateHistoryElement=function(){this.rewindParams.snapped?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.slideOffset.x>0?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex+1),this.addHistoryElement()},this.clearHistory=function(){this.rewindParams.history.length=0,this.rewindParams.timelineIndex=0,this.rewindParams.timelineIndexSlide=0,this.rewindParams.resetWeights=!0},this.openTimeline=function(e){this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights&&(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=this.rewindParams.snappingEnabled),0===this.rewindParams.history.length&&this.addHistoryElement();for(var t=0;t<this.rewindParams.history.length;t++){var n=t-this.rewindParams.timelineIndex,r=this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize;this.rewindParams.history[t].thumbnailBounds.setCenter(new i.Vector2(e.x+n*r,e.y).add(this.rewindParams.slideOffset)),this.rewindParams.resetWeights&&(this.rewindParams.history[t].weight=t==this.rewindParams.timelineIndex?1:0)}this.rewindParams.resetWeights&&(this.rewindParams.resetWeights=!1);r=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize);if(this.rewindParams.open=!0,this.rewindParams.openLocation=e.clone(),this.rewindParams.openLocationOrigin=e.clone(),this.rewindParams.openBracket=e.clone(),this.rewindParams.openBracketA=new i.Vector2(r,e.y),this.rewindParams.openBracketB=new i.Vector2(window.innerWidth-r,e.y),this.rewindParams.openBracketA.x>this.rewindParams.openBracketB.x){var o=this.rewindParams.openBracketA.x;this.rewindParams.openBracketA.x=this.rewindParams.openBracketB.x,this.rewindParams.openBracketB.x=o}this.rewindParams.locationOffset=new i.Vector2(0,0),this.rewindParams.snapOffset=new i.Vector2(0,0)},this.slideTimeline=function(e){if(this.rewindParams.open&&0!==this.rewindParams.history.length){var t=e.clone().add(this.rewindParams.locationOffset),n=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),r=n,o=window.innerWidth-n,a=this.rewindParams.history[0].thumbnailBounds.center().x,s=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x,l=0;if(t.x<this.rewindParams.openBracketA.x){var c=a-(l=t.x-this.rewindParams.openBracketA.x);r<c&&(l=Math.min(l+(c-r),0))}if(t.x>this.rewindParams.openBracketB.x){var u=s-(l=t.x-this.rewindParams.openBracketB.x);o>u&&(l=Math.max(l+(u-o),0))}this.rewindParams.openLocation.x+=l,this.rewindParams.openBracketA.x+=l,this.rewindParams.openBracketB.x+=l,this.rewindParams.openBracket.x=t.x-(this.rewindParams.openLocation.x-this.rewindParams.openLocationOrigin.x);var h=new i.Vector2(-l,0),d=t.clone().sub(this.rewindParams.openLocation.clone().sub(this.rewindParams.openLocationOrigin));h.x+=this.rewindParams.snapOffset.x,this.rewindParams.snapOffset.x=0;var f=!1;if(this.rewindParams.snappingEnabled)for(var p=0;p<this.rewindParams.history.length;p++){var m=this.rewindParams.history[p].thumbnailBounds.center().add(h);if(Math.abs(m.x-d.x)<4||this.rewindParams.snapped&&Math.abs(m.x-d.x)<16){f=!0,0!==l?(this.rewindParams.snapOffset.x=m.x-d.x,h.x-=this.rewindParams.snapOffset.x):this.rewindParams.openBracket.x+=m.x-d.x,d.x=m.x;break}}this.rewindParams.snapped=f;for(var g=-1,v=0,y=0;y<this.rewindParams.history.length;y++){var _=this.rewindParams.history[y].thumbnailBounds.clone();if(this.rewindParams.history[y].thumbnailBounds.setCenter(this.rewindParams.history[y].thumbnailBounds.center().add(h)),this.rewindParams.history[y].thumbnail){var b=this.rewindParams.history[y].thumbnailBounds.center().x-this.rewindParams.thumbnailSize/2;$("#rewindFrame"+y).css("left",b),$("#rewindBorder"+y).css("left",b-4)}var x=new i.Vector2(2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize));_.setFromCenterAndSize(_.center(),x);var w=new i.Vector2(0,0);_.getIcon2DCoords(d,w);var A=1-Math.abs(Math.equalityClamp(w.x,-1,1));this.rewindParams.history[y].weight=A,0===y&&d.x<_.center().x&&(this.rewindParams.history[y].weight=1),y===this.rewindParams.history.length-1&&d.x>_.center().x&&(this.rewindParams.history[y].weight=1),v+=this.rewindParams.history[y].weight,this.rewindParams.history[y].weight>g&&(g=this.rewindParams.history[y].weight,this.rewindParams.snappingEnabled&&1==this.rewindParams.history[y].weight?(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=!0):this.rewindParams.slideOffset.x=this.rewindParams.history[y].thumbnailBounds.center().x-d.x,this.rewindParams.timelineIndexSlide=y)}for(var E=0;E<this.rewindParams.history.length;E++)this.rewindParams.history[E].weight=this.rewindParams.history[E].weight/v;var T=this.rewindParams.history[0].thumbnailBounds.center().x,M=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x;this.rewindParams.openBracket.x<T?(this.rewindParams.locationOffset.x+=T-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=T):this.rewindParams.openBracket.x>M&&(this.rewindParams.locationOffset.x+=M-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=M)}},this.shiftBackOneElement=function(){0!==this.rewindParams.history.length&&(this.rewindParams.timelineIndex>0||0!==this.rewindParams.slideOffset.x)&&((this.rewindParams.snapped||this.rewindParams.slideOffset.x>0)&&this.rewindParams.timelineIndex--,this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights=!0,o.elapsedTime=0,this.animateToRewindIndex())},this.animateToRewindIndex=function(){var t=this.rewindParams.timelineIndex,n=0;if(o.elapsedTime>=M.duration)n=1;else{var i=M.destinationPercent;n=Math.easeClamp(o.elapsedTime/M.duration,0,i),o.elapsedTime+=l/500}o.center.copy(o.center.clone().multiplyScalar(1-n).clone().add(this.rewindParams.history[t].camera.center.clone().multiplyScalar(n))),e.position.copy(e.position.clone().multiplyScalar(1-n).clone().add(this.rewindParams.history[t].camera.position.clone().multiplyScalar(n))),e.up.copy(this.rewindParams.history[t].camera.up),o.pivot.copy(o.center),e.lookAt(o.center),m(!1),this.cube&&requestAnimationFrame(this.cube.render),1!==n&&requestAnimationFrame(function(){o.animateToRewindIndex()})},this.closeTimeline=function(){this.rewindParams.timelineIndex!=this.rewindParams.timelineIndexSlide&&(this.rewindParams.timelineIndex=this.rewindParams.timelineIndexSlide),this.rewindParams.open=!1},this.getInterpolatedCamera=function(){var t=new i.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4);t.center=new i.Vector3(0,0,0),t.pivot=new i.Vector3(0,0,0),t.leftFov=0,t.rightFov=0,t.topFov=0,t.bottomFov=0,t.up.set(0,0,0);for(var n=0;n<this.rewindParams.history.length;n++){var r=this.rewindParams.history[n].camera,a=this.rewindParams.history[n].weight;t.center.add(r.center.clone().multiplyScalar(a)),t.position.add(r.position.clone().multiplyScalar(a)),t.up.add(r.up.clone().multiplyScalar(a)),t.rotation.add(r.rotation.clone().multiplyScalar(a)),t.pivot.add(r.pivot.clone().multiplyScalar(a)),t.leftFov+=r.leftFov*a,t.rightFov+=r.rightFov*a,t.topFov+=r.topFov*a,t.bottomFov+=r.bottomFov*a}e.position.copy(t.position),e.up.copy(t.up),e.rotation=t.rotation,e.leftFov=t.leftFov,e.rightFov=t.rightFov,e.topFov=t.topFov,e.bottomFov=t.bottomFov,o.center.copy(t.center),o.pivot.copy(t.pivot),e.lookAt(o.center),e.up.normalize(),m(!1)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"InitParametersSetting",function(){return z}),n.d(t,"Viewer3DImpl",function(){return G});var i=n(3),r=n(34),o=n(125),a=n(27),s=n(106),l=n(72),c=n(124),u=n(140),h=n(141),d=n(20),f=n(84),p=n(66),m=n(1),g=n(33),v=n(103),y=n(13),_=n(29),b=n(43),x=n(21),w=n(44),A=n(117),E=n(128),T=n(156),M=n(95),S=n(5),C=n(94),P=n(11),L=n(14),R=n(85),D=n(70),I=n(74),O=n(0),N=n(105),k=n(2),V=n(60),F=(Autodesk.Viewing.Private.DefaultLightPresetAec,null),B=Object(i.getGlobal)().ENABLE_DEBUG,U=Object(i.getGlobal)().ENABLE_DEBUG_RCS,z={canvas:null,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!1,depth:!1,devicePixelRatio:null};function G(e,t){var n,G,H,W,j,X,q,Y,K,Q,Z,J,$,ee=this,te=1e3/15,ne=1e3/30,ie=1e3/120,re=-1,oe=-1,ae=null,se="y",le=null,ce=null,ue=null,he=!1,de=!1,fe=!1,pe=!1,me={type:k.PROGRESS_UPDATE_EVENT,state:r.ProgressState.LOADING,percent:0},ge=!1,ve=!1,ye=!1,_e=0,be=0,xe=1e3/60,we=0,Ae=!0,Ee=!1,Te=!1,Me=null,Se=null;this.edgeColorMain=new O.Vector4(0,0,0,.3),this.edgeColorGhosted=new O.Vector4(0,0,0,.1);var Ce,Pe,Le,Re,De=Object(i.getGlobal)(),Ie={},Oe="",Ne={visibleIdCB:function(){return Y?Y.copyOcclusionIds():null},occlusionTestCB:function(e,t,n,i,r){return Y?Y.occlusionTest(e,t,n,i,r):Promise.resolve(!0)}},ke=!0;function Ve(e){var t=Ce.phase,n=t!=y.RenderFlags.RENDER_HIGHLIGHTED2,i=t==y.RenderFlags.RENDER_NORMAL||t==y.RenderFlags.RENDER_HIGHLIGHTED1,r=(Y.settings.idbuffer||Y.settings.occlusionid)&&t!=y.RenderFlags.RENDER_HIDDEN,o=t==y.RenderFlags.RENDER_HIGHLIGHTED1||t==y.RenderFlags.RENDER_HIGHLIGHTED2?15:0;r&&Y.settings.occlusionid&&e instanceof _.RenderBatch&&e.sortObjects&&(r=!1);var a=t==y.RenderFlags.RENDER_HIDDEN?ee.edgeColorGhosted:ee.edgeColorMain;Y.setEdgeColor(a),t==y.RenderFlags.RENDER_HIDDEN&&(e.overrideMaterial=ee.fadeMaterial),Y.renderScenePart(e,n,i,r,o),e.overrideMaterial=null}function Fe(e){H&&(ee.canvasBoundingclientRectDirty=!0,ee.camera.aspect=W/j,ee.camera.clientWidth=W,ee.camera.clientHeight=j,Y.setSize(W,j),ee.controls.handleResize(),J&&J.setSize(W,j),ee.invalidate(!0,!0,!0),H=!1,e||ee.api.dispatchEvent({type:k.VIEWER_RESIZE_EVENT,width:W,height:j}))}function Be(){var e;if((Z.enabled||J)&&!ee.is2d&&(e=ee.model&&!ee.model.isLoadDone()?ee.model.getData().bbox:ee.getVisibleBounds(!0,!1))){var t=ee.camera,n=e.clone(),i=new O.Vector3(1,0,0),r=ce.clone();t.worldUpTransform&&(n.applyMatrix4(t.worldUpTransform),i.applyMatrix4(t.worldUpTransform),r.applyMatrix4(t.worldUpTransform)),n.min.y-=.005*(n.max.y-n.min.y),K&&K.expandByGroundShadow(n,r);var o=n.size(),a=n.center();if(K||(o.x*=1.25,o.z*=1.25,o.x=o.z=Math.max(o.x,o.z)),t.worldUpTransform){var s=(new O.Matrix4).getInverse(t.worldUpTransform);a.applyMatrix4(s)}if(Z.setTransform(a,o,t.worldup,i),J){var l=(new O.Vector3).subVectors(a,t.worldup.clone().multiplyScalar(o.y/2));J.setTransform(l,t.worldup,o)}K&&K.setGroundShadowTransform(a,o,t.worldup,i)}}function Ue(){K&&(K.state=b.SHADOWMAP_NEEDS_UPDATE)}e&&setInterval(function(){Ae||we<60||ee.track({name:"fps",value:Number(ee.fps().toFixed(2)),aggregate:"last"})},3e4),this.api=t,this.canvas=e,this.loader=null,this.canvasBoundingclientRectDirty=!0,this.initialize=function(){if(n=new O.Vector3(0,1,0),$=new o.RenderScene,(q=function(e){if(!e)return null;var t=window.devicePixelRatio;t||(t=1);var n=z;n.canvas=e,n.devicePixelRatio=t,n.stencil=!0;var i=new v.WebGLRenderer(n);return i.context?(i.autoClear=!1,i.sortObjects=!1,i):null}(e))||Object(i.isNodeJS)()){q&&(this.onWebGLcontextLost=this.onWebGLcontextLost.bind(this),q.webglcontextlost=this.onWebGLcontextLost),(Y=new s.RenderContext).init(q,e?e.clientWidth:0,e?e.clientHeight:0),this.use2dInstancing=Object(i.isMobileDevice)()&&this.glrenderer().supportsInstancedArrays(),X=new l.MaterialManager(q),this.camera=new N.UnifiedCamera(e?e.clientWidth:512,e?e.clientHeight:512),this.lightsOn=!1,this.lights=[],this.highlight_lights=[],this.no_lights=[],Me=(new O.Color).setRGB(1,1,1),Se=(new O.Color).setRGB(1,1,1),this.cameraChangedEvent={type:k.CAMERA_CHANGE_EVENT,camera:this.camera},le=new O.Vector3(1,1,1),ce=(new O.Vector3).copy(le),ue=new O.Vector3(-1,0,1),this.scene=new O.Scene,this.sceneAfter=new O.Scene,this.sceneAfter.sortObjects=!1,this.renderAfters=new c.RenderCallbacks,this.overlayScenes={},pt(),this.createOverlayScene("selection",this.selectionMaterialBase,this.selectionMaterialTop),this.createOverlayScene("selection_points",null,null),this.selectionMeshes={},this.fadeMaterial=new O.MeshPhongMaterial({color:16777215,opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1}),this.fadeMaterial.packedNormals=!0,X.addInstancingSupport(this.fadeMaterial),X.addMaterial("__fadeMaterial__",this.fadeMaterial,!0),this.setSelectionColor(6724095),X.togglePolygonOffset(!0),Y.setDepthMaterialOffset(X.getPolygonOffsetOn(),X.getPolygonOffsetFactor(),X.getPolygonOffsetUnits()),this.progressiveRender=!0,this.swapBlackAndWhite=!1,this.targetFrameBudget=ne,this.frameDisplayRate=5,Object(i.isMobileDevice)()&&(te*=2,ie/=2,ne*=2,this.targetFrameBudget/=2,this.frameDisplayRate/=2),this.interruptBudget=1e10,this.controls={update:function(e){this.camera.lookAt(this.camera.target),this.camera.updateProjectionMatrix(),this.camera.dirty=!1},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){},isToolActivated:function(){return!1}},this.selector=new u.MultiModelSelector(this),this.visibilityManager=new h.MultiModelVisibilityManager(this),this.showGhosting=!0,this.showOverlaysWhileMoving=!0,this.skipAOWhenMoving=!1,this.keyFrameAnimator=null,this.zoomBoundsChanged=!0;var t=d.LightPresets[d.DefaultLightPreset].bgColorGradient;this.setClearColors(t[0],t[1],t[2],t[3],t[4],t[5]),(Z=new f.GroundShadow(q)).enabled=!0,Ce=new Ge,X.addMaterialNonHDR("groundShadowDepthMaterial",Z.getDepthMaterial()),X.addOverrideMaterial("normalsMaterial",Y.getDepthMaterial()),X.addOverrideMaterial("edgeMaterial",Y.getEdgeMaterial()),Y.beginScene(this.scene,this.camera,this.noLights,!0),Y.composeFinalFrame(!0,i.isIE11),this.api.addEventListener(k.GEOMETRY_DOWNLOAD_COMPLETE,function(e){e.memoryLimited?ee.onDemandLoadComplete(e.model):ee.onLoadComplete(e.model)},!1),Le=function(){var e=!!$.getMemoryInfo();X.toggleDepthWriteTransparent(!e),Y.setMemoryLimited(e),e&&(this.toggleGroundReflection(!1),this.toggleGroundShadow(!1))}.bind(this),this.api.addEventListener(k.MODEL_ROOT_LOADED_EVENT,Le),this.api.addEventListener(k.MODEL_UNLOADED_EVENT,Le)}},this.renderGroundShadow=function(e){K?K.state==b.SHADOWMAP_VALID&&K.renderGroundShadow(ee.camera,e||Y.getColorTarget()):(Z.renderShadow(ee.camera,e||Y.getColorTarget()),Z.rendered=!0)};var ze={NOTHING_DRAWN:0,MODEL_DRAWN:1,BACKGROUND_DRAWN:2,OVERLAY_DRAWN:4,REFLECTION_DRAWN:8,ALL_DRAWN:15};function Ge(){this.highResTimeStamp=-1,this.screenDrawn=ze.NOTHING_DRAWN,this.screenHasChanged=!1,this.frameBudget=0,this.frameRemaining=0,this.phase=y.RenderFlags.RENDER_NORMAL,this.useStencil=!1,this.signalProgressByRendering=!1,this.tickCount=0,this.beginFrameAvg=0,this.lastBeginFrameTimeStamp=0,this.RENDERMODE_FULL=0,this.RENDERMODE_PROGRESSIVE=1,this.RENDERMODE_SILENT=2,this.renderType=this.RENDERMODE_FULL,this.INITIAL_GROUND_SHADOW=.2,this.cmdListActive=!1,this.cmdIndex=0,this.continueExecution=!0,this.encounteredAlwaysDo=!1,this.finishedFullRender=!0,this.groundShadowInPost=!1,this.drawOverlay=!1,this.cmdIsOpen=!1,this.allocArraySize=0,this.cmdListLength=0,this.cmdList=[],this.paramList=[],this.CMD_NORMAL_SEQUENCE=0,this.CMD_DO_AFTER=1,this.CMD_ALWAYS_DO=2,this.isActive=function(){return this.cmdListActive},this.setFrame=function(e){this.frameBudget=e},this.beginCommandSet=function(){this.cmdListActive=!0,this.cmdIndex=0,this.cmdListLength=0,this.encounteredAlwaysDo=!1,this.tickCount=0,this.screenDrawn=ze.NOTHING_DRAWN,this.screenHasChanged=!1},this.endCommandSet=function(){this.cmdIsOpen&&(this.cmdIsOpen=!1,this.cmdListLength++)},this._internalSetParam=function(e,t){this.paramList[this.cmdIndex][e]=t},this.addCommand=function(e,t){for(this.cmdIsOpen&&this.cmdListLength++,this.cmdIsOpen=!0;this.allocArraySize<=this.cmdListLength;)this.cmdList[this.cmdListLength]={},this.paramList[this.cmdListLength]={},this.allocArraySize++;return this.cmdList[this.cmdListLength]=e,this.paramList[this.cmdListLength].executionLevel=t||this.CMD_NORMAL_SEQUENCE,this.encounteredAlwaysDo=this.encounteredAlwaysDo||t===this.CMD_ALWAYS_DO,this.cmdListLength},this.setParam=function(e,t){this.cmdIsOpen?this.paramList[this.cmdListLength][e]=t:B&&m.logger.error("ERROR: cannot set param when no command is open!")},this.getParam=function(e){return B&&void 0===this.paramList[this.cmdIndex][e]&&m.logger.error("ERROR: parameter "+e+" was never set for this command! Go fix it."),this.paramList[this.cmdIndex][e]},this.executeCommandList=function(){if(Ce.cmdListActive){var e;if(this.frameRemaining=this.frameBudget,B&&this.cmdIsOpen&&m.logger.error("ERROR: should call endCommandSet before executing"),this.continueExecution=!0,U&&(0===this.tickCount&&console.log("==================="),console.log("Running commands for "+(Ce.renderType===Ce.RENDERMODE_PROGRESSIVE?"progressive":Ce.renderType===Ce.RENDERMODE_FULL?"full":"silent")+" render, for tick count "+this.tickCount)),this.encounteredAlwaysDo)for(var t=0;t<this.cmdIndex;)this.paramList[t].executionLevel>=Ce.CMD_ALWAYS_DO&&(U&&console.log("  ALWAYS DO command "+t+": "+this.cmdList[t].name),this.cmdList[t]()),t++;for(;this.cmdIndex<this.cmdListLength;)(this.continueExecution||this.paramList[this.cmdIndex].executionLevel>=Ce.CMD_DO_AFTER)&&(U&&console.log("  command "+this.cmdIndex+": "+this.cmdList[this.cmdIndex].name+" and "+Ce.frameRemaining+" frame budget remaining"),this.cmdList[this.cmdIndex]()&&(U&&console.log("  >>> out of tick time with "+Ce.frameRemaining),e=this.cmdIndex,this.continueExecution=!1)),this.cmdIndex++;return this.continueExecution?this.cmdListActive=!1:this.cmdIndex=e,this.tickCount++,!this.continueExecution}return!0}}function He(){if(Ce.renderType===Ce.RENDERMODE_PROGRESSIVE)if(Ce.getParam("GenerateGroundShadow.afterBeauty")){if(Ce.frameRemaining=Z.prepareGroundShadow(ee.modelQueue(),0,Ce.frameRemaining),Z.getStatus()==x.GroundFlags.GROUND_RENDERED){if(Ce.getParam("GenerateGroundShadow.signalRedraw"))return ee.requestSilentRender(),U&&console.log(" $$$$ SIGNAL FULL GROUND SHADOW REDRAW"),!0;Ce.groundShadowInPost=!0}}else 0===Ce.tickCount&&Z.prepareGroundShadow(ee.modelQueue(),10);else Ce.frameRemaining=Z.prepareGroundShadow(ee.modelQueue(),0,Ce.frameRemaining);return Ce.frameRemaining<0&&Z.getStatus()===x.GroundFlags.GROUND_UNFINISHED}function We(){return Z.getStatus()!==x.GroundFlags.GROUND_UNFINISHED&&ee.renderGroundShadow(),!1}function je(){return Ce.renderType===Ce.RENDERMODE_PROGRESSIVE?Ce.getParam("GenerateGroundReflection.afterBeauty")?(Ce.frameRemaining=J.prepareGroundReflection(Z,ee,!1,0,Ce.frameRemaining),J.getStatus()==x.GroundFlags.GROUND_RENDERED&&(Ce.screenDrawn|=ze.REFLECTION_DRAWN,Ce.groundShadowInPost&&X.hasTransparentMaterial()&&ee.requestDeferredSilentRender())):0===Ce.tickCount&&J.prepareGroundReflection(Z,ee,!0,10):Ce.frameRemaining=J.prepareGroundReflection(Z,ee,!1,0,Ce.frameRemaining),Ce.frameRemaining<0&&J.getStatus()===x.GroundFlags.GROUND_UNFINISHED}function Xe(){if(K.state===b.SHADOWMAP_NEEDS_UPDATE)Ce.frameRemaining=K.startUpdate($,Ce.frameRemaining,ee.camera,ce,X);else if(K.state==b.SHADOWMAP_INCOMPLETE&&(Ce.frameRemaining=K.continueUpdate($,Ce.frameRemaining,X),K.state==b.SHADOWMAP_VALID))return ee.requestSilentRender(),U&&console.log(" $$$$ SIGNAL FULL SHADOW MAP REDRAW"),!0;return Ce.frameRemaining<0&&K.state!==b.SHADOWMAP_VALID}function qe(){K.state=b.SHADOWMAP_NEEDS_UPDATE}function Ye(){if(Ce.signalProgressByRendering&&ee.signalProgress(0,r.ProgressState.RENDERING),Ce.renderType===Ce.RENDERMODE_PROGRESSIVE){if(Ce.lastBeginFrameTimeStamp>0){var e=Ce.highResTimeStamp-Ce.lastBeginFrameTimeStamp;Ce.beginFrameAvg=.75*Ce.beginFrameAvg+.25*e}Ce.lastBeginFrameTimeStamp=Ce.highResTimeStamp,Ce.beginFrameAvg<ne&&Ce.frameBudget<te?(ee.targetFrameBudget+=1,ee.targetFrameBudget>te&&(ee.targetFrameBudget=te)):Ce.beginFrameAvg>ne&&Ce.frameBudget>ie&&(ee.targetFrameBudget-=1,ee.targetFrameBudget<ie&&(ee.targetFrameBudget=ie))}ee.updateCameraMatrices();var t=Ce.getParam("BeginScene.clear");return Y.beginScene(ee.scene,ee.camera,ee.lightsOn?ee.lights:ee.no_lights,t),ee.toggleHighlightsLights(!0),t&&(Ce.screenDrawn|=ze.BACKGROUND_DRAWN),Ce.getParam("BeginScene.signalCameraChanged")&&ee.api.dispatchEvent(ee.cameraChangedEvent),!1}function Ke(){return Ce.phase=Ce.getParam("BeginPhase.phase"),Ce.useStencil=Ce.getParam("BeginPhase.useStencil"),Ce.useStencil||Y.setStencilEnabled(!1),U&&console.log("     render phase is now "+Ce.phase),$.reset(ee.camera,Ce.phase,Ce.getParam("BeginPhase.moved"),X.getCutPlanes(),Ce.phase==y.RenderFlags.RENDER_HIGHLIGHTED1||Ce.phase==y.RenderFlags.RENDER_HIGHLIGHTED2),!1}function Qe(){return $.isEmpty()||$.isDone()||(Ce.useStencil&&Y.setStencilEnabled(Ce.phase<=y.RenderFlags.RENDER_HIGHLIGHTED2),Ce.screenDrawn|=ze.MODEL_DRAWN,Ce.frameRemaining=$.renderSome(Ve,Ce.frameRemaining,Ne),Ce.signalProgressByRendering&&(ee.signalProgress(100*$.getRenderProgress(),r.ProgressState.RENDERING),U&&console.log("  %%% percent done "+100*$.getRenderProgress())),Ce.useStencil&&Y.setStencilEnabled(!1)),!$.isDone()}function Ze(){return Ce.phase=y.RenderFlags.RENDER_FINISHED,Y.renderScenePart(ee.sceneAfter,!0,!0,!0,0),ee.renderAfters.render(),!1}function Je(){return Ce.phase=y.RenderFlags.RENDER_FINISHED,!1}function $e(){ee.signalProgress(100,r.ProgressState.RENDERING)}function et(){return ee.isOverlayDirty()&&(ee.clearOverlayDirtyFlag(),Ce.drawOverlay=!0),Ce.drawOverlay&&(!$.isEmpty()&&$.isDone()||ee.showOverlaysWhileMoving?(ee.renderOverlays(),Ce.screenDrawn|=ze.OVERLAY_DRAWN):(Y.clearAllOverlays(),Ce.drawOverlay=!1)),!1}function tt(){Ce.screenDrawn|=ze.ALL_DRAWN}function nt(){if(Ce.screenDrawn&&(Ce.phase===y.RenderFlags.RENDER_FINISHED||Ce.tickCount%ee.frameDisplayRate==0)){var e=!Ce.getParam("PostAndPresent.performAO")||(Ce.screenDrawn&(ze.BACKGROUND_DRAWN|ze.MODEL_DRAWN))==ze.BACKGROUND_DRAWN;Y.composeFinalFrame(e),Ce.screenHasChanged=!0,Ce.screenDrawn=ze.NOTHING_DRAWN,t=Ce.highResTimeStamp,we++,be<=t&&be>0&&(xe=.8*xe+.2*(t-be)),ee.fpsCallback&&ee.fpsCallback(ee.fps()),ee.api.dispatchEvent({type:k.RENDER_PRESENTED_EVENT})}var t;return!1}function it(){return B&&!1===Y.getAOEnabled()&&m.logger.error("AO should be on at this point!"),Y.setAOEnabled(!1),!1}function rt(){return B&&!0===Y.getAOEnabled()&&m.logger.error("AO should be off at this point!"),Y.setAOEnabled(!0),!1}function ot(){return ee.requestSilentRender(),!1}function at(){return Ce.finishedFullRender=!0,!1}this.tick=function(e){Ce.highResTimeStamp=e=e||0;var t=X.updateMaterials();ee.invalidate(t.needsClear,t.needsRender,t.overlayDirty);var n=function(e){if(ee.keyFrameAnimator){var t=be>0?(e-be)/1e3:0,n=ee.keyFrameAnimator.update(t);if(n&&(ee.sceneUpdated(!0),n&ee.keyFrameAnimator.UPDATE_CAMERA))return!0}return!1}(e),i=ee.controls.update(e),r=$&&$.update(e),o=i||n||Q||r;Ne.moved=o,Q=!1;var a=H;Fe(),he=he||o,pe=pe||o;var s=!1;(fe=fe||o)?function(e){for(var t in ee.selectionMeshes){var n=ee.selectionMeshes[t];if(n.model){var i=n.model.getFragmentList();n.geometry===i.getGeometry(n.fragId)&&i.getWorldMatrix(n.fragId,n.matrix)}}}():Y.overlayUpdate()&&!fe&&(fe=s=!0),Ce.signalProgressByRendering=ee.model&&(ee.model.isLoadDone()||!0===ee.model.getData().partPacksLoadDone)&&!ee.model.getData().isLeaflet,ge&&(Be(),Z.setDirty(),ge=!1,1)&&(he=!0);var l=he,c=$.frameResumePossible();if(he=he||!c,ye=ye||ve&&!Ce.cmdListActive,pe&&Ce.cmdListActive&&(he=!0),he||de||fe||pe||ye)if(Ce.drawOverlay=fe,he||de||ye){var u,h=l?w.ResetFlags.RESET_RELOAD:he?w.ResetFlags.RESET_REDRAW:w.ResetFlags.RESET_NORMAL;he||de?ee.progressiveRender?(Ce.renderType=Ce.RENDERMODE_PROGRESSIVE,u=ee.targetFrameBudget):(Ce.renderType=Ce.RENDERMODE_FULL,u=ee.interruptBudget):(Ce.renderType=Ce.RENDERMODE_SILENT,u=ee.targetFrameBudget,he=!0,h=w.ResetFlags.RESET_REDRAW),ve=ye=!1,Ce.setFrame(u),Ce.finishedFullRender=!1,Ce.beginCommandSet();var d=Z.enabled&&!ee.is2d&&!Ae,f=!!J&&!ee.is2d&&!Ae,p=o||a,m=o&&ee.skipAOWhenMoving&&Y.getAOEnabled();Ce.addCommand(Ye),Ce.setParam("BeginScene.signalCameraChanged",p),Ce.setParam("BeginScene.clear",he),m&&Ce.addCommand(it,Ce.CMD_ALWAYS_DO);var g=!1;$&&(K&&K.state!==b.SHADOWMAP_VALID&&Ce.addCommand(Xe),d&&(Ce.addCommand(He),Ce.setParam("GenerateGroundShadow.afterBeauty",!1),Ce.setParam("GenerateGroundShadow.signalRedraw",!1)),f?(J.setDirty(),Ce.addCommand(je),Ce.setParam("GenerateGroundReflection.afterBeauty",!1)):d&&Ce.addCommand(We),(g=$.hasHighlighted())&&(Ce.addCommand(Ke),Ce.setParam("BeginPhase.phase",y.RenderFlags.RENDER_HIGHLIGHTED1),Ce.setParam("BeginPhase.moved",h),Ce.setParam("BeginPhase.useStencil",g),h=!1,Ce.addCommand(Qe)),Ce.addCommand(Ke),Ce.setParam("BeginPhase.phase",y.RenderFlags.RENDER_NORMAL),Ce.setParam("BeginPhase.moved",h),Ce.setParam("BeginPhase.useStencil",g),h=!1,Ce.addCommand(Qe),!$.areAllVisible()&&ee.showGhosting?(f&&Ce.renderType===Ce.RENDERMODE_PROGRESSIVE||(Ce.addCommand(Ke),Ce.setParam("BeginPhase.phase",y.RenderFlags.RENDER_HIDDEN),Ce.setParam("BeginPhase.moved",h),Ce.setParam("BeginPhase.useStencil",g),Ce.addCommand(Qe)),Ce.addCommand(Je)):Ce.addCommand(Ze),Ce.signalProgressByRendering&&Ce.addCommand($e)),Ce.addCommand(et,Ce.renderType===Ce.RENDERMODE_PROGRESSIVE?Ce.CMD_DO_AFTER:Ce.CMD_NORMAL_SEQUENCE),Ce.addCommand(nt,Ce.renderType===Ce.RENDERMODE_PROGRESSIVE?Ce.CMD_DO_AFTER:Ce.CMD_NORMAL_SEQUENCE),Ce.setParam("PostAndPresent.performAO",Y.getAOEnabled()&&!m),Ce.renderType===Ce.RENDERMODE_PROGRESSIVE&&$&&(K&&K.state!==b.SHADOWMAP_VALID&&(Ce.addCommand(qe),Ce.addCommand(Xe)),d&&(Ce.addCommand(He),Ce.setParam("GenerateGroundShadow.afterBeauty",!0),Ce.setParam("GenerateGroundShadow.signalRedraw",!f),Ce.signalProgressByRendering&&Ce.addCommand($e)),f&&(Ce.groundShadowInPost=!1,Ce.addCommand(je),Ce.setParam("GenerateGroundReflection.afterBeauty",!0),!$.areAllVisible()&&ee.showGhosting&&(Ce.addCommand(Ke),Ce.setParam("BeginPhase.phase",y.RenderFlags.RENDER_HIDDEN),Ce.setParam("BeginPhase.moved",h),Ce.setParam("BeginPhase.useStencil",g),Ce.addCommand(Qe)),Ce.addCommand(Je),Ce.addCommand(nt),Ce.setParam("PostAndPresent.performAO",Y.getAOEnabled()&&!m),Ce.signalProgressByRendering&&Ce.addCommand($e))),m&&(Ce.addCommand(rt,Ce.CMD_ALWAYS_DO),Ce.addCommand(ot)),Ce.addCommand(at),Ce.endCommandSet(),he=!1,de=!1,fe=!1,pe=!1}else Ce.finishedFullRender&&(Ce.beginCommandSet(),U&&console.log("=====\nOVERLAY DIRTY"),pe&&(Ce.addCommand(Y.clearHighlight.bind(Y)),$.hasHighlighted()&&(Ce.addCommand(Ke),Ce.setParam("BeginPhase.phase",y.RenderFlags.RENDER_HIGHLIGHTED2),Ce.setParam("BeginPhase.moved",w.ResetFlags.RESET_REDRAW),Ce.setParam("BeginPhase.useStencil",!0),Ce.addCommand(Qe))),s?Ce.addCommand(tt):Ce.addCommand(et,!0),Ce.addCommand(nt,!0),Ce.setParam("PostAndPresent.performAO",Y.getAOEnabled()),Ce.endCommandSet(),fe=!1,pe=!1);Re=Ce.cmdListActive,Ce.executeCommandList(),Re!==ke&&(ee.api.dispatchEvent({type:k.FINAL_FRAME_RENDERED_CHANGED_EVENT,value:{finalFrame:!Re}}),ke=Re),be=Ce.highResTimeStamp},this.setLmvDisplay=function(e){De=e},this.run=function(){G=0,setTimeout(function(){!function e(t){G=De.requestAnimationFrame(e),ee.tick(t)}()},1)},this.stop=function(){window.cancelAnimationFrame(G)},this.toggleProgressive=function(e){this.progressiveRender=e,he=!0},this.toggleSwapBlackAndWhite=function(e){this.swapBlackAndWhite=e,Y.toggleSwapBlackAndWhite(e),he=!0},this.toggleGrayscale=function(e){X.setGrayscale(e),he=!0},this.toggleGhosting=function(e){this.showGhosting=e,he=!0},this.toggleOverlaysWhileMoving=function(e){this.showOverlaysWhileMoving=e},this.togglePostProcess=function(e,t){Y.initPostPipeline(e,t),this.fireRenderOptionChanged(),he=!0},this.preloadPostProcessStyle=function(e){Y.preloadPostProcessStyle(e)},this.setPostProcessParameter=function(e,t){Y.setPostProcessParameter(e,t),this.fireRenderOptionChanged(),this.invalidate(!0)},this.toggleGroundShadow=function(e){Z.enabled!==e&&(Z.enabled=e,Z.clear(),e&&Z.setDirty(),Be(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundShadowColor=function(e){Z.enabled&&(Z.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundShadowAlpha=function(e){Z.enabled&&(Z.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleGroundReflection=function(e){e&&J||!e&&!J||(e?((J=new A.GroundReflection(q,this.canvas.clientWidth,this.canvas.clientHeight,{clearPass:Y.getClearPass()})).setClearColors(this.clearColorTop,this.clearColorBottom,Object(i.isMobileDevice)()),J.toggleEnvMapBackground(Ee),J.setEnvRotation(Y.getEnvRotation()),Be()):(J.cleanup(),J=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundReflectionColor=function(e){J&&(J.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundReflectionAlpha=function(e){J&&(J.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleEnvMapBackground=function(e){Ee=e,Y.toggleEnvMapBackground(e),J&&J.toggleEnvMapBackground(e),this.invalidate(!0,!0,!1)},this.isEnvMapBackground=function(){return Ee},this.setOptimizeNavigation=function(e){this.skipAOWhenMoving=e},this.renderOverlays=function(){!function(){for(var e in ee.selectionMeshes){var t=ee.selectionMeshes[e];t.model&&t.model.isConsolidated()&&t.model.updateRenderProxy(t,t.fragId)}}();var e,t=this.lightsOn;t||this.toggleLights(!0,!0),this.dir_light1&&(e=this.dir_light1.intensity,this.dir_light1.intensity=1),Y.renderOverlays(this.overlayScenes,this.lightsOn?this.lights:this.no_lights),t||this.toggleLights(!1,!0),this.dir_light1&&(this.dir_light1.intensity=e)},this.setLayerVisible=function(e,t){this.layers.setLayerVisible(e,t)},this.isLayerVisible=function(e){return this.layers.isLayerVisible(e)},this.getVisibleLayerIndices=function(){return this.layers.getVisibleLayerIndices()},this.updateNearFarValues=function(){var e,t,n;return function(i,r){if(n||(e=new O.Matrix4,t=new O.Matrix4,n=new O.Box3),e.compose(i.position,i.quaternion,i.scale),t.getInverse(e),n.copy(r),J){var o=new O.Vector3;o.multiplyVectors(n.max,i.worldup);var a=new O.Vector3;a.multiplyVectors(n.min,i.worldup),o.sub(a),o.x>=0?n.min.x-=o.x:n.max.x-=o.x,o.y>=0?n.min.y-=o.y:n.max.y-=o.y,o.z>=0?n.min.z-=o.z:n.max.z-=o.z}K&&K.groundShapeBox&&n.union(K.groundShapeBox),n.applyMatrix4(t);var s=1e-5*(n.max.z-n.min.z),l=.5*(n.max.y-n.min.y),c=-(n.max.z+s)-l,u=-(n.min.z-s)+l;i.isPerspective&&(c=Math.max(c,Math.min(1,1e-4*Math.abs(u-c))),u<0&&(u=1e-4),c=Math.max(c,1e-5*u)),u=Math.max(u,c),i.near=c,i.far=u,i.updateProjectionMatrix(),i.updateMatrixWorld(),i.matrixWorldInverse.getInverse(i.matrixWorld)}}(),this.getPixelPerUnit=function(e,t){var n,i;if(this.model.is2d()){var r=this.intersectGroundViewport(new O.Vector3(0,0,1));n=r?e.position.distanceTo(r):e.position.distanceTo(t.center()),i=Y.settings.deviceHeight/(2*n*Math.tan(O.Math.degToRad(.5*e.fov)))}else{var o,a=X.getCutPlanesRaw();if(a&&a.length){var s=a[0],l=e.target.clone().sub(e.position).normalize(),c=l.dot(s);if(0===c)o=t.center();else{var u=-(e.position.clone().dot(s)+s.w)/c;o=t.clampPoint(l.multiplyScalar(u).add(e.position))}}else o=t.center();n=e.position.distanceTo(o),i=Y.settings.deviceHeight/(2*n*Math.tan(O.Math.degToRad(.5*e.fov)))}return i},this.updateCameraMatrices=function(){var e=this.camera;if(e.worldup&&this.setWorldUp(e.worldup),this.model){var t=this.getVisibleBounds(!0,fe);this.updateNearFarValues(e,t);var n=this.getPixelPerUnit(e,t);this.model.is2d()?(X.updatePixelScale(n,Y.settings.deviceWidth,Y.settings.deviceHeight),X.updateSwapBlackAndWhite(this.swapBlackAndWhite)):X.updatePixelScale(n,Y.settings.deviceWidth,Y.settings.deviceHeight)}},this.initLights=function(){this.dir_light1=new O.DirectionalLight(Me,1),this.dir_light1.position.copy(ue),this.highlight_dir_light1=new O.DirectionalLight(Me,1),this.highlight_dir_light1.intensity=1,this.highlight_dir_light1.position.copy(ue),this.amb_light=new O.AmbientLight(Se),this.highlight_amb_light=new O.AmbientLight(Se),this.lights=[this.dir_light1,this.amb_light],this.highlight_lights=[this.highlight_dir_light1,this.highlight_amb_light],this.camera.add(this.dir_light1),this.camera.add(this.dir_light1.target),this.camera.add(this.highlight_dir_light1),this.camera.add(this.highlight_dir_light1.target),Te=!0};var st=function(e,t,n,i){var r=d.LightPresets[re],o=r&&r.ambientColor,a=r&&r.directLightColor;o=o||Se.toArray(),a=a||Me.toArray(),n?(i&&e?e.color.setRGB(.5*a[0],.5*a[1],.5*a[2]):e&&e.color.setRGB(o[0],o[1],o[2]),t&&t.color.setRGB(a[0],a[1],a[2])):e&&i&&e.color.setRGB(o[0],o[1],o[2])};function lt(e){var t=e.getData().animations;function n(){if(t){for(var e in ee.keyFrameAnimator=new T.KeyFrameAnimator(ee,t.duration),t.animations)ee.keyFrameAnimator.add(t.animations[e]);ee.keyFrameAnimator.goto(0),ee.api.dispatchEvent({type:k.ANIMATION_READY_EVENT})}ee.api.removeEventListener(k.OBJECT_TREE_CREATED_EVENT,n)}t&&(e.isObjectTreeCreated()?n():ee.api.addEventListener(k.OBJECT_TREE_CREATED_EVENT,n))}function ct(e){return"selection2d"+e.id}function ut(){if(!Object(i.isMobileDevice)()){var e=$.getModels().length;Y.setIdTargetCount(e)&&X.toggleMRTSetting(Y.mrtFlags())}}this.toggleHighlightsLights=function(e){this.highlight_amb_light&&(this.highlightsOn=e,st(this.highlight_amb_light,this.highlight_dir_light1,e,!0),Y.setHighlightLights(e?this.highlight_lights:this.no_lights))},this.toggleLights=function(e,t){this.amb_light&&(this.lightsOn=e,st(this.amb_light,this.dir_light1,e,t))},this.syncCamera=function(e){this.camera.updateProjectionMatrix(),e&&this.setWorldUp(this.api.navigation.getWorldUpVector()),Q=!0},this.setViewFromFile=function(e,t){if(e){var n,i=e.getDefaultCamera();if(i)n=i;else{n={};var r=e.getBoundingBox(),o=r.size();if(n.target=r.center(),e.is2d()){n.isPerspective=!1;var a=o.x/o.y,s=this.camera.aspect;n.orthoScale=s>a?o.y:o.x/s,n.up=new O.Vector3(0,0,1),n.position=n.target.clone(),n.position.z+=n.orthoScale,n.target.y+=1e-6*o.y}else n.isPerspective=!0,n.fov=this.camera.fov,n.up=this.camera.up.clone(),n.position=n.target.clone(),n.position.z+=1.5*Math.max(o.x,o.y,o.z)}var l=e.getMetadata("navigation hint","value",null),c=this.controls.isToolActivated("freeorbit")||t&&"Freeorbit"===l;this.setViewFromCamera(n,t,c)}},this.adjustOrthoCamera=function(e){if(!e.isPerspective&&this.model){var t=this.model.getBoundingBox(),n=t.size(),i=e.target.clone().sub(e.position),r=i.length();if(r>1e3*n.length()){var o=e.position.distanceTo(t.center());e.target.copy(e.position).add(i.normalize().multiplyScalar(o))}else{if(Math.abs(r-e.orthoScale)/r>1e-5)m.logger.warn("Ortho scale does not match eye-target distance. One of them is likely wrong, but which one?"),!(0===e.fov&&1===e.orthoScale)&&e.position.copy(e.target).add(i.normalize().multiplyScalar(-e.orthoScale))}}},this.setViewFromCamera=function(e,t,n){this.adjustOrthoCamera(e);var i,r=this.model?this.model.getUpVector():null;i=r?(new O.Vector3).fromArray(r):n?e.up.clone():V.Navigation.snapToAxis(e.up.clone()),n?this.api.prefs&&this.api.prefs.set("fusionOrbitConstrained",i.equals(e.up)):e.up=i;var o=this.api.navigation;if(o){var a=this.camera;if(t)a.up.copy(e.up),a.position.copy(e.position),a.target.copy(e.target),e.isPerspective?a.fov=e.fov:(a.saveFov=e.fov,a.fov=N.UnifiedCamera.ORTHO_FOV),a.isPerspective=e.isPerspective,a.orthoScale=e.orthoScale,a.dirty=!0,o.setWorldUpVector(n?i:a.up),o.setView(a.position,a.target),o.setPivotPoint(a.target),this.syncCamera(!0);else if(a.isPerspective=e.isPerspective,e.isPerspective||(a.saveFov=e.fov,e.fov=N.UnifiedCamera.ORTHO_FOV),n)o.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,e.up,i);else{var s=this.model.getData().bbox;if(!s.containsPoint(e.target)){var l=s.center().distanceTo(e.position),c=e.target.clone().sub(e.position).normalize().multiplyScalar(l);e.target.copy(e.position.clone().add(c))}var u=o.computeOrthogonalUp(e.position,e.target);o.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,u,i)}}Q=!0},this.getViewArrayFromCamera=function(e){var t,n=e||{x:0,y:0,z:0},i=this.camera,r=this.model.getUpVector();t=r?(new O.Vector3).fromArray(r):V.Navigation.snapToAxis(i.up.clone());var o=this.api.navigation.getPivotPoint();return[i.position.x+n.x,i.position.y+n.y,i.position.z+n.z,o.x+n.x,o.y+n.y,o.z+n.z,t.x,t.y,t.z,i.aspect,O.Math.degToRad(i.fov),i.orthoScale,i.isPerspective?0:1]},this.setViewFromViewBox=function(e,t,n,i){if(e.is2d()){var r={},o=e.getBoundingBox(),a={width:t[2]-t[0],height:t[3]-t[1]};a.aspect=a.width/a.height,a.centerX=t[0]+a.width/2,a.centerY=t[1]+a.height/2;var s=this.camera.aspect;s>a.aspect?r.orthoScale=a.height:r.orthoScale=a.width/s,r.isPerspective=!1,r.position=new O.Vector3(a.centerX,a.centerY,o.center().z+r.orthoScale),r.target=new O.Vector3(a.centerX,a.centerY,o.center().z),r.target.y+=1e-6*a.height,r.up=new O.Vector3(0,0,1),this.setViewFromCamera(r,i,!1)}},this.setWorldUp=function(e){if(!n.equals(e)){n.copy(e);var t=Math.abs(e.x);se="x",Math.abs(e.y)>t&&(se="y",t=Math.abs(e.y)),Math.abs(e.z)>t&&(se="z");var i,r,o,a,s=new O.Vector3(0,1,0);ee.camera.worldUpTransform=(i=s,r=e,o=(new O.Vector3).crossVectors(r,i).normalize(),a=Math.acos(i.dot(r)),(new O.Matrix4).makeRotationAxis(o,a)),this.sceneUpdated(!1)}},this.addModel=function(e,t){if(e){var n=!!this.model,i=e.is2d();if(this.model||(this.model=e,Y.setUnitScale(e.getUnitScale())),this.layers||(this.layers=new E.ModelLayers(this)),this.layers.initialized||this.layers.addModel(e),$.addModel(e),this.selector.addModel(e),this.visibilityManager.addModel(e),this.api.fireEvent({type:k.MODEL_ADDED_EVENT,model:e,preserveTools:t}),this.api.prefs&&(e.hideLines(!this.api.prefs.lineRendering),e.hidePoints(!this.api.prefs.pointRendering)),i){for(var r=e.getData(),o=$.getModels(),a=0;a<o.length;++a){var s=o[a];if(s===e){X.initLayersTexture(r.layerCount,r.layersMap);break}if(s.is2d())break}var l=X.create2DMaterial(null,{useInstancing:this.use2dInstancing},!0,!1,function(){ee.invalidate(!1,!0,!1)}),c=X.findMaterial(null,l);if(this.is2d||Y.enter2DMode(c,n||!e.getData().isLeaflet),!n){this.is2d||this.saveLightPreset(),this.is2d=!0,this.setLightPreset(d.DefaultLightPreset2d);var u=e.getData();if(u.hidePaper){var h=u.bgColor,f=h>>16&255,p=h>>8&255,m=255&h;this.setClearColors(f,p,m,f,p,m)}}}else!n&&this.is2d&&(this.is2d=void 0,Y.exit2DMode());this.setupLighting(e),ut(),this.fireRenderOptionChanged(),this.invalidate(!0)}},this.setupLighting=function(e){e=e||this.model,Object(i.isNodeJS)()||!e||e.is2d()||(this.setLightPresetFromFile(e)||(oe>=0?(this.setLightPreset(oe,!0,ae),oe=-1,ae=null):this.setLightPreset(re,!1)),this.setAOHeuristics(e))},this.getSvfMaterialId=function(e){return this.model.getFragmentList().getSvfMaterialId(e)},this.getMaterials=function(){return X},this.setupMesh=function(e,t,n,i){var r={geometry:t,matrix:i,isLine:t.isLines,isWideLine:t.isWideLines,isPoint:t.isPoints,is2d:t.is2d};return n&&(r.material=this.matman().setupMaterial(e,t,n)),r},this.onDemandLoadComplete=function(e){Ae=!1,this.signalProgress(100,r.ProgressState.LOADING),(Z&&Z.enabled||J)&&this.invalidate(!1,!0),this.is2d&&e.is2d()&&this.init2dSelection(e),X.hasTransparentMaterial()&&this.requestDeferredSilentRender(),lt(e),this.api.dispatchEvent({type:k.GEOMETRY_LOADED_EVENT,model:e,onDemandLoad:!0})},this.init2dSelection=function(e){var t=ct(e);if(!this.overlayScenes[t]){var n=X.initSelectionTexture(e.getData().maxObjectNumber,e.id),i=X.create2DMaterial(e,{useInstancing:this.use2dInstancing},!1,n,function(){ee.invalidate(!1,!0,!1)}),r=X.findMaterial(e,i);this.createOverlayScene(t,r)}},this.onLoadComplete=function(e){Ae=!1,this.signalProgress(100,r.ProgressState.LOADING),(Z&&Z.enabled||J)&&this.sceneUpdated(!1),this.is2d&&e.is2d()&&this.init2dSelection(e);e.getData();$.getGeometryList()&&$.getGeometryList().printStats(),e.hasGeometry()?X.hasTransparentMaterial()&&this.requestSilentRender():m.logger.warn("Loaded model has no geometry."),this.handleInitialVisibility(e),lt(e),this.api.dispatchEvent({type:k.GEOMETRY_LOADED_EVENT,model:e})},this.onTextureLoadComplete=function(e){this.api.dispatchEvent({type:k.TEXTURES_LOADED_EVENT,model:e})},this.signalProgress=function(e,t){void 0===t&&(t=r.ProgressState.LOADING),me.percent===e&&me.state===t||(me.percent=e,me.state=t,this.api.dispatchEvent(me))},this.resize=function(e,t){H=!0,W=e,j=t},this.unloadModel=function(e){(this.removeModel(e)||$.removeHiddenModel(e))&&(e.dtor(this.glrenderer()),X.cleanup(e),e.loader&&(e.loader.dtor(),e.loader=null),e.is2d()&&this.overlayScenes[e.id]&&this.removeOverlayScene(ct(e)),this.api.dispatchEvent({type:k.MODEL_UNLOADED_EVENT,model:e}))},this._addLoadingFile=function(e){this.loaders||(this.loaders=[]),this.loaders.push(e)},this._removeLoadingFile=function(e){if(this.loaders){var t=this.loaders.indexOf(e);t>=0&&this.loaders.splice(t,1)}},this.removeModel=function(e){return!!$.removeModel(e)&&(this.keyFrameAnimator&&(this.keyFrameAnimator.destroy(),this.keyFrameAnimator=null),this.selector.removeModel(e),this.visibilityManager.removeModel(e),this.layers.removeModel(e),e===this.model&&(this.model=null,$.isEmpty()||(this.model=$.getModels()[0])),ut(),this.invalidate(!0,!0,!0),!0)},this.unloadCurrentModel=function(){this.model&&(this.is2d?(this.is2d=void 0,this.removeOverlayScene(ct(this.model)),Y.exit2DMode()):oe=re,Y.beginScene(this.scene,this.camera,this.lightsOn?this.lights:this.no_lights,!0),Y.composeFinalFrame(!0)),this.loaders&&(this.loaders.forEach(function(e){e.dtor()}),this.loaders=[]);for(var e=$.getModels(),t=e.length-1;t>=0;t--)this.unloadModel(e[t]);this.model=null};var ht,dt,ft=function(e){var t=[{material:ee.selectionMaterialBase,target:1,renderHidden:!1},{material:ee.selectionMaterialTop,target:0,renderHidden:!0}];if(e){var n=Y.getEdgeMaterial();t.splice(1,0,{material:n,target:1,renderHidden:!1}),t.push({material:n,target:0,renderHidden:!0})}Y.setSelectionMaterials(t)},pt=function(){var e=ee.selectionMaterialBase=new O.MeshPhongMaterial({specular:526344,ambient:0,opacity:1,transparent:!1});e.packedNormals=!0,e.depthWrite=!0,e.depthTest=!0,e._polygonOffsetOn=!0,e._polygonOffsetFactor=1,e._polygonOffsetUnits=.075,e.side=O.DoubleSide;var t=ee.selectionMaterialTop=new O.MeshPhongMaterial({specular:526344,ambient:0,opacity:.15,transparent:!0});t.packedNormals=!0,t.depthWrite=!1,t.depthTest=!1,t.side=O.DoubleSide,X.addInstancingSupport(e),X.addOverrideMaterial("selectionHighlightBase",e),X.addInstancingSupport(t),X.addOverrideMaterial("selectionHighlightTop",t),ft(!1)};function mt(e,t){ht=ht||new O.Box3,t.updateMatrixWorld(!0),t.traverse(function(t){var n=t.geometry;void 0!==n&&n.visible&&(n.boundingBox||n.computeBoundingBox(),ht.copy(n.boundingBox),ht.applyMatrix4(t.matrixWorld),e.union(ht))})}function gt(){var e=void 0;for(var t in Ie){var n=Ie[t];n&&n.length&&(e=e?t===Oe?n.concat(e):e.concat(n):n)}ee.setCutPlanes(e)}this.createOverlayScene=function(e,t,n,i){t&&X.addOverrideMaterial(e+"_pre",t),n&&X.addOverrideMaterial(e+"_post",n);var r=new O.Scene;r.__lights=this.scene.__lights,this.overlayScenes[e]={scene:r,camera:i,materialPre:t,materialPost:n}},this.removeOverlayScene=function(e){this.overlayScenes[e]&&(delete this.overlayScenes[e],this.invalidate(!1,!1,!0))},this.addOverlay=function(e,t){this.overlayScenes[e]&&(this.overlayScenes[e].scene.add(t),this.invalidate(!1,!1,!0))},this.addMultipleOverlays=function(e,t){for(var n in t)t.hasOwnProperty(n)&&this.addOverlay(e,t[n])},this.removeOverlay=function(e,t){this.overlayScenes[e]&&(this.overlayScenes[e].scene.remove(t),this.invalidate(!1,!1,!0))},this.removeMultipleOverlays=function(e,t){for(var n in t)t.hasOwnProperty(n)&&this.removeOverlay(e,t[n])},this.clearOverlay=function(e){if(this.overlayScenes[e]){var t,n,i=this.overlayScenes[e].scene;for(n=i.children.length-1;n>=0;--n)(t=i.children[n])&&i.remove(t);this.invalidate(!1,!1,!0)}},this.setClearColors=function(e,t,n,r,o,a){this.clearColorTop=new O.Vector3(e/255,t/255,n/255),this.clearColorBottom=new O.Vector3(r/255,o/255,a/255),Y.setClearColors(this.clearColorTop,this.clearColorBottom),J&&J.setClearColors(this.clearColorTop,this.clearColorBottom,Object(i.isMobileDevice)()),he=!0,this.fireRenderOptionChanged()},this.getVisibleBounds=function(e,t){var n=new O.Box3;return $.isEmpty()||(mt(n,this.scene),n=$.getVisibleBounds(e).union(n),t&&(n=function(){var e=new O.Box3,t=ee.overlayScenes;for(var n in t)t.hasOwnProperty(n)&&mt(e,t[n].scene);return mt(e,ee.scene),e}().union(n))),n},this.getFitBounds=function(e){var t;return e||null===this.selector||(t=this.selector.getSelectionBounds()),t&&!t.empty()||(t=this.getVisibleBounds()),t},this.getRenderProxy=function(e,t){return e.getFragmentList().getVizmesh(t)},this.getLayersRoot=function(){return this.layers.getRoot()},this.promiseRenderProxy=function(e,t){var n=e.getFragmentList().promiseVizmesh(t);return n.lmv_model=e,n},this.cancelPromisedRenderProxy=function(e){return!!e.lmv_model&&e.lmv_model.getFragmentList().cancelPromisedVizmesh(e)},this.getFragmentProxy=function(e,t){return new M.FragmentPointer(e.getFragmentList(),t)},this.getRenderProxyCount=function(e){return e.getFragmentList().getCount()},this.getRenderProxyDbIds=function(e,t){return e.getFragmentList().getDbIds(t)},this.isWholeModelVisible=function(e){return!$||$.areAllVisible()},this.isNodeVisible=function(e,t){return this.visibilityManager.isNodeVisible(t,e)},this.highlightObjectNode=function(e,t,n){e.is2d()&&(X.highlightObject2D(t,n,e.id),this.invalidate(!1,!1,!0));var i=this,r=e.getData().instanceTree||e.getData().fragmentMap;if(r&&!e.is2d())r.enumNodeFragments(t,function(t){i.highlightFragment(e,t,n)},!1);else{var o=t;if(e.is2d()&&(o=e.getData().fragments.dbId2fragId[t]),Array.isArray(o))for(var a=0;a<o.length;a++)i.highlightFragment(e,o[a],n);else i.highlightFragment(e,o,n)}},this.highlightFragment=function(e,t,n){var i=this.getRenderProxy(e,t);if(i){var r=i.is2D||i.isPoint||!!i.material&&i.material.transparent,o=e.id+":"+t;if(r){var a="selection";if(e.is2d()&&(a=ct(e)),i.isPoint&&(a+="_points"),n){var s=this.promiseRenderProxy(e,t),l=this;this.selectionMeshes[o]=s,s.then(function(n){var i,r=l.getRenderProxy(n.model,n.fragId);if(r&&r.geometry){if(r.isPoint){var s=r.material.clone();s.color=l.selectionMaterialBase.color,s.needsUpdate=!0,i=new O.Mesh(r.geometry,s)}else i=new O.Mesh(r.geometry,r.material);i.matrix.copy(r.matrixWorld),i.matrixAutoUpdate=!1,i.matrixWorldNeedsUpdate=!0,i.frustumCulled=!1,i.model=e,i.fragId=t,n.model.getFragmentList().lockGeometry(t),l.addOverlay(a,i),l.selectionMeshes[o]=i}}).catch(function(e){e.canceled||delete l.selectionMeshes[o]})}else if(this.selectionMeshes.hasOwnProperty(o)){var c=this.selectionMeshes[o];c instanceof Promise?this.cancelPromisedRenderProxy(c):(e.getFragmentList().unlockGeometry(t),this.removeOverlay(a,c)),delete this.selectionMeshes[o]}}r&&n||e.setHighlighted(t,n)&&this.invalidateHighlight()}},this.explode=function(e){e!=_e&&(_e=e,$.explode(e),this.sceneUpdated(!0),this.api.dispatchEvent({type:k.EXPLODE_CHANGE_EVENT,scale:e}))},this.getExplodeScale=function(){return _e},this.setGhostingBrightness=function(e){this.fadeMaterial.color=e?new O.Color(1052688):new O.Color(16777215),this.fadeMaterial.needsUpdate=!0},this.loadCubeMapFromColors=function(e,t){var n=Object(C.CreateCubeMapFromColors)(e,t);return n.isBgColor=!0,X.setReflectionMap(n),n},this.loadCubeMap=function(e,t){this._reflectionMapPath=e;return g.TextureLoader.loadCubeMap(e,t,function(t){e===ee._reflectionMapPath&&X&&(X.setReflectionMap(t),ee.invalidate(!0),t?d.LightPresets[re].useIrradianceAsBackground||Y.setCubeMap(t):ee.loadCubeMapFromColors(ee.clearColorTop,ee.clearColorBottom))})},this.loadIrradianceMap=function(e,t){this._irradianceMapPath=e;return g.TextureLoader.loadCubeMap(e,t,function(t){e===ee._irradianceMapPath&&X&&(X.setIrradianceMap(t),ee.invalidate(!0),d.LightPresets[re].useIrradianceAsBackground&&Y.setCubeMap(t))})},this.setLightPreset=function(e,t,n){if(Object(i.isNodeJS)()&&(e=0),Te||this.initLights(),re!==e||t){if((e<0||d.LightPresets.length<=e)&&(e=d.DefaultLightPreset),re=e,$.isEmpty())return oe=re,void(ae=n);var r=d.LightPresets[e],o=r.bgColorGradient;if(o||(o=d.BackgroundPresets.Custom),this.setClearColors(o[0],o[1],o[2],o[3],o[4],o[5]),void 0!==r.useIrradianceAsBackground&&(this.api.prefs.hasTag("envMapBackground","ignore-producer")?m.logger.debug("setLightPreset(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(r.useIrradianceAsBackground))),r.path){var a="res/environments/"+r.path,s=Object(P.getResourceUrl)(a+"_mipdrop."+(r.type||"")+".dds"),l=Object(P.getResourceUrl)(a+"_irr."+(r.type||"")+".dds");this.loadIrradianceMap(l,r.E_bias),this.loadCubeMap(s,r.E_bias),X.setEnvExposure(-r.E_bias),Y.setEnvExposure(-r.E_bias),this.setTonemapExposureBias(r.E_bias),this.setTonemapMethod(r.tonemap),this.setGhostingBrightness(r.darkerFade)}else{var c=this.loadCubeMapFromColors(this.clearColorTop,this.clearColorBottom);Y.setCubeMap(c),X.setIrradianceMap(null),X.setEnvExposure(-r.E_bias||0),Y.setEnvExposure(-r.E_bias||0),this.setTonemapExposureBias(r.E_bias||0),this.setTonemapMethod(r.tonemap||0),this.setGhostingBrightness(r.darkerFade),Y.toggleEnvMapBackground(Ee),this.invalidate(!0)}var u=R.SAOShader.uniforms.radius.value,h=R.SAOShader.uniforms.intensity.value;r.hasOwnProperty("saoRadius")&&(u=r.saoRadius),r.hasOwnProperty("saoIntensity")&&(h=r.saoIntensity),Y.setAOOptions(u,h);var f=1;null!==r.lightMultiplier&&void 0!==r.lightMultiplier&&(f=r.lightMultiplier),ce.copy(le),r.lightDirection&&ce.fromArray(r.lightDirection).negate(),K&&Ue(),this.dir_light1&&(this.dir_light1.intensity=f,r.lightDirection?(this.dir_light1.position.set(-r.lightDirection[0],-r.lightDirection[1],-r.lightDirection[2]),this.highlight_dir_light1.position.set(-r.lightDirection[0],-r.lightDirection[1],-r.lightDirection[2])):(this.dir_light1.position.copy(ue),this.highlight_dir_light1.position.copy(ue))),X.setEnvRotation(r.rotation||0),Y.setEnvRotation(r.rotation||0),J&&J.setEnvRotation(r.rotation||0),this.toggleLights(0!==f),this.invalidate(!0,!1,!0),this.fireRenderOptionChanged(),n&&n()}else n&&n()},this.setLightPresetFromFile=function(e){if(!e||e.is2d())return!1;var t=e.getMetadata("renderEnvironmentGroundReflection","value",null);null!==t&&(this.api.prefs.hasTag("groundReflection","ignore-producer")?m.logger.debug("setLightPresetFromFile(): groundReflection is locked. No changes."):(this.api.prefs.tag("no-storage","groundReflection"),this.api.setGroundReflection(t)));var n=e.getMetadata("renderEnvironmentGroundShadow","value",null);null!==n&&(this.api.prefs.hasTag("groundShadow","ignore-producer")?m.logger.debug("setLightPresetFromFile(): groundShadow is locked. No changes."):(this.api.prefs.tag("no-storage","groundShadow"),this.api.setGroundShadow(n)));var r=e.getMetadata("renderEnvironmentAmbientShadows","value",null);null!==r&&(this.api.prefs.hasTag("ambientShadows","ignore-producer")?m.logger.debug("setLightPresetFromFile(): ambientShadows is locked. No changes."):(this.api.prefs.tag("no-storage","ambientShadows"),this.api.setQualityLevel(r,Y.getAntialiasing())));var o=e.getMetadata("renderEnvironmentDisplayLines","value",null);null!==o&&(this.api.prefs.hasTag("lineRendering","ignore-producer")?m.logger.debug("setLightPresetFromFile(): lineRendering is locked. No changes."):(this.api.prefs.tag("no-storage","lineRendering"),this.api.hideLines(!o)));var a=e.getMetadata("renderEnvironmentDisplayPoints","value",null);null!==a&&(this.api.prefs.hasTag("pointRendering","ignore-producer")?m.logger.debug("setLightPresetFromFile(): pointRendering is locked. No changes."):(this.api.prefs.tag("no-storage","pointRendering"),this.api.hidePoints(!a)));var s=e.getMetadata("renderEnvironmentDisplayEdges","value",null);null!==s&&(this.api.prefs.hasTag("edgeRendering","ignore-producer")?_Logger.logger.debug("setLightPresetFromFile(): edgeRendering is locked. No changes."):(this.api.prefs.tag("no-storage","edgeRendering"),this.api.setDisplayEdges(!Object(i.isMobileDevice)()&&!!s)));var l=e.getMetadata("renderEnvironmentStyle","value",null),c=d.LightPresets.filter(function(e){return e.name===l})[0];if(c)if(this.api.prefs.hasTag("lightPreset","ignore-producer"))m.logger.debug("setLightPresetFromFile(): lightPreset is locked. No changes.");else{this.api.prefs.tag("no-storage","lightPreset");var u=F;u||(u=F={},d.LightPresets.push(u)),Object(d.copyLightPreset)(c,u),u.name="(Custom: Model defined)";var h=e.getMetadata("renderEnvironmentExposureBias","value",null),f=e.getMetadata("renderEnvironmentExposureBase","value",null);null!==h&&null!==f&&(u.E_bias=h+f);var p=e.getMetadata("renderEnvironmentBackgroundColor","value",null);this.api.prefs.hasTag("backgroundColorPreset","ignore-producer")?m.logger.debug("setLightPresetFromFile(): backgroundColorPreset is locked. No changes."):p&&(u.bgColorGradient=[255*p[0],255*p[1],255*p[2],255*p[0],255*p[1],255*p[2]]);var g=e.getMetadata("renderEnvironmentRotation","value",null);null!==g&&(u.rotation=g);var v=d.LightPresets.indexOf(u);this.setLightPreset(v,!0)}var y=e.getMetadata("renderEnvironmentBackgroundFromEnvironment","value",null);return null!==y&&(this.api.prefs.hasTag("envMapBackground","ignore-producer")?m.logger.debug("setLightPresetFromFile(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(y))),c},this.setLightPresetForAec=function(){for(var e=Object(i.getGlobal)().DefaultLightPresetAec||"Boardwalk",t=-1,n=0;n<d.LightPresets.length;n++)if(d.LightPresets[n].name===e){t=n;break}return t>=0&&(this.api.prefs.hasTag("lightPreset","ignore-producer")?m.logger.debug("setLightPresetForAec(): lightPreset is locked. No changes."):(this.api.prefs.tag("no-storage","lightPreset"),this.setLightPreset(t,!0,function(){this.api.prefs.tag("ignore-producer","envMapBackground")}.bind(this)),this.saveLightPreset())),this.api.prefs.hasTag("edgeRendering","ignore-producer")?m.logger.debug("setLightPresetForAec(): edgeRendering is locked. No changes."):(this.api.prefs.tag("no-storage","edgeRendering"),this.api.setDisplayEdges(!Object(i.isMobileDevice)())),!0},this.setAOHeuristics=function(e){var t=e.getUnitScale(),n=e.getMetadata("renderEnvironmentAmbientShadows","radius",void 0),i=e.getMetadata("renderEnvironmentAmbientShadows","intensity",void 0),r=e.getMetadata("renderEnvironmentAmbientShadows","opacity",void 0);if(void 0!==n||void 0!==i||void 0!==r)Y.setAOOptions(n/t,i,r);else if(e.isAEC()){t>.3?Y.setAOOptions(4/t,1,.625):Y.setAOOptions(.25/t,1,.625)}else{var o=e.getData().bbox.size().length();Y.setAOOptions(Math.min(10,.05*o))}},this.setTonemapMethod=function(e){e!=Y.getToneMapMethod()&&(Y.setTonemapMethod(e),X.setTonemapMethod(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setTonemapExposureBias=function(e){e!=Y.getExposureBias()&&(Y.setTonemapExposureBias(e),X.setTonemapExposureBias(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setRenderingPrefsFor2D=function(e){if(!Object(i.isNodeJS)()){var t=!e&&!!this.api.prefs.envMapBackground;this.toggleEnvMapBackground(t)}},this.dtor=function(){window.cancelAnimationFrame(G),this.api.removeEventListener(k.MODEL_ROOT_LOADED_EVENT,Le),this.api.removeEventListener(k.MODEL_UNLOADED_EVENT,Le),this.unloadCurrentModel(),this.controls=null,this.canvas=null,this.loader=null,this.selector.dtor(),this.selector=null,this.model=null,this.layers=null,this.visibilityManager=null,Pe&&(Pe.dtor(),Pe=null),$=null,Y=null,X.dtor(),X=null,q&&(q.webglcontextlost=null)},this.hideLines=function(e){$&&!$.isEmpty()&&($.hideLines(e),this.sceneUpdated(!0))},this.hidePoints=function(e){$&&!$.isEmpty()&&($.hidePoints(e),this.sceneUpdated(!0))},this.setDisplayEdges=function(e){Y.toggleEdges(e),ft(e),this.invalidateHighlight(),this.invalidate(!0)},this.setCutPlaneSet=function(e,t){Ie[e]=t?t.slice():void 0,gt()},this.setCutPlaneSetFor2DRendering=function(e){Oe=e,gt()},this.getCutPlaneSet=function(e){return Ie[e]},this.getCutPlaneSets=function(){var e=[];for(var t in Ie){var n=Ie[t];n&&n.length&&e.push(t)}return e},this.getCutPlanes=function(){return X.getCutPlanes()},this.setCutPlanes=function(e){X.setCutPlanes(e),this.sceneUpdated(),this.api.dispatchEvent({type:k.CUTPLANES_CHANGE_EVENT,planes:e})},this.fireRenderOptionChanged=function(){X.toggleMRTSetting(Y.mrtFlags()),this.api.dispatchEvent({type:k.RENDER_OPTION_CHANGED_EVENT})},this.dispatchEvent=function(e){this.api.dispatchEvent(e)},this.viewportToRay=function(e,t){var n=this.camera;e.z=-1;var i=new O.Vector3(e.x,e.y,1);return e=e.unproject(n),(i=i.unproject(n)).sub(e).normalize(),t||(t=new O.Ray),t.set(n.isPerspective?n.position:e,i),t},this.rayIntersect=function(e,t,n,i,r){var o=$.rayIntersect(e.origin,e.direction,t,n,i,r);if(this.sceneAfter.children.length){var a=new O.Raycaster(e.origin,e.direction,this.camera.near,this.camera.far),s=[];D.VBIntersector.intersectObject(this.sceneAfter,a,s,!0),s.length&&(!o||s[0].distance<o.distance)&&(o=s[0])}if(!o)return null;var l=o.fragId,c=o.point,u=o.face,h=o.model,d=o.dbId;void 0===d&&void 0!==l&&(d=h.getFragmentList().getDbIds(l),h.getData().instanceTree||h.getData().fragmentMap||(d=l));return{dbId:d,fragId:l,intersectPoint:c,face:u,model:h}},this.castRayViewport=function(e,t,n,i,r){return dt=dt||new O.Ray,$?(this.viewportToRay(e,dt),this.rayIntersect(dt,t,n,i,r)):{}},this.getCanvasBoundingClientRect=function(){return this.canvasBoundingclientRectDirty&&(this.canvasBoundingclientRectDirty=!1,this.boundingClientRect=this.canvas.getBoundingClientRect()),this.boundingClientRect},this.clientToViewport=function(e,t){var n=this.getCanvasBoundingClientRect();return new O.Vector3((e+.5)/n.width*2-1,-(t+.5)/n.height*2+1,1)},this.viewportToClient=function(e,t){var n=this.getCanvasBoundingClientRect();return new O.Vector3(.5*(e+1)*n.width-.5,-.5*(t-1)*n.height-.5,0)},this.castRay=function(e,t,n){return this.castRayViewport(this.clientToViewport(e,t),n)},this.intersectGroundViewport=function(e){var t=this.camera,n="z";this.is2d||(n=se);var i=e;i.z=-1;var r=new O.Vector3(i.x,i.y,1);i=i.unproject(t),(r=r.unproject(t)).sub(i).normalize();var o,a=r;if(Math.abs(a[n])<1e-6)return null;o=t.isPerspective?t.position:i;var s=((this.model?this.model.getBoundingBox().min[n]:0)-o[n])/a[n];return a.multiplyScalar(s),a.add(o),a},this.intersectGround=function(e,t){return this.intersectGroundViewport(this.clientToViewport(e,t))};var vt=[0,0];function yt(e,t,n,i,r){var o=e.getFragmentList().getVizmesh(t);new I.VertexBufferReader(o.geometry,i).enumGeomsForVisibleLayer(n,r)}function _t(e,t,n,i,r){var o=e.getFragmentList().getVizmesh(t);new I.VertexBufferReader(o.geometry,i).enumGeomsForObject(n,r)}this.hitTestViewport=function(e,t){var n;if(ee.is2d){var r=Object(i.isMobileDevice)()?45:5,o=Y.idAtPixels(e.x,e.y,r,vt);if(o<=0)return null;var a=this.intersectGroundViewport(e),s=$.findModel(vt[1])||ee.model;n={intersectPoint:a,dbId:s.remapDbId(o),fragId:s.getData().fragments.dbId2fragId[o],model:s}}else n=this.castRayViewport(e,t);return n},this.hitTest=function(e,t,n){return ee.hitTestViewport(this.clientToViewport(e,t),n)},this.snappingHitTestViewport=function(e,t){var n,r,o;if(this.model&&this.model.getData().isLeaflet)n={intersectPoint:r=this.intersectGroundViewport(e)};else if(ee.is2d){var a=Object(i.isMobileDevice)()?45:17,s=Y.idAtPixels(e.x,e.y,a,vt),l=$.findModel(vt[1])||ee.model;if(s<0)return null;r=this.intersectGroundViewport(e);var c=ee.model.getData().fragments,u=c?c.dbId2fragId[s]:-1;n={intersectPoint:r,dbId:l.remapDbId(s),fragId:u}}else o=Y.idAtPixel(e.x,e.y),n=this.castRayViewport(e,t,o>0?[o]:null);return n},this.snappingHitTest=function(e,t,n){return this.snappingHitTestViewport(this.clientToViewport(e,t),n)},this.rolloverObjectViewport=function(e){this.model&&this.model.getData().isLeaflet||Y.rolloverObjectViewport(e.x,e.y)&&this.invalidate(!1,!1,!0)},this.rolloverObject=function(e,t){this.selector.highlightPaused||this.selector.highlightDisabled||this.rolloverObjectViewport(this.clientToViewport(e,t))},this.pauseHighlight=function(e){this.selector.highlightPaused=e,e&&(Y.rolloverObjectId(-1),this.invalidate(!1,!1,!0))},this.disableHighlight=function(e){this.selector.highlightDisabled=e,e&&(Y.rolloverObjectId(-1),this.invalidate(!1,!1,!0))},this.disableSelection=function(e){this.selector.selectionDisabled=e},this.rolloverObjectNode=function(e,t){var n=[],i=(t=t||ee.model)?t.getData().instanceTree:void 0;if(i){if(i.enumNodeChildren(e,function(e){n.push(e)},!0),n.length>1){var r=n.shift();n.sort(function(e,t){return e-t}),n.unshift(r)}}else n.push(e);var o=t?t.id:0;Y.rolloverObjectId(e,n,o)&&this.invalidate(!1,!1,!0)},this.getScreenShot=function(e,t,n,i){var r=Y.settings.logicalWidth,o=Y.settings.logicalHeight,a=this.progressiveRender,s=q.getPixelRatio();e&&t||(e=r,t=o),this.progressiveRender=!1,this.resize(e/s,t/s),Fe(!0),this.tick(performance.now());var l=new O.WebGLRenderTarget(e,t,{minFilter:O.LinearFilter,magFilter:O.LinearFilter,format:O.RGBFormat,type:O.UnsignedByteType});function c(){var e=Y.targetToCanvas(l||Y.getColorTarget());function t(){ee.progressiveRender=a,ee.resize(r,o),Fe(!0),e.canvas.toBlob(function(e){var t=window.URL.createObjectURL(e);n?n(t):window.open(t)},"image/png")}l&&(l.dispose(),l=void 0),i?i(e.ctx,t):t()}if(Y.setOffscreenTarget(l),Y.presentBuffer(),Y.setOffscreenTarget(null),this.model.getData().isLeaflet){var u=function(){h=!0,ee.progressiveRender=a,ee.resize(r,o)},h=!1;ee.api.addEventListener(k.CANCEL_LEAFLET_SCREENSHOT,u,{once:!0}),this.invalidate(!0),this.model.getIterator().callWhenRefined(function(){h||(ee.api.removeEventListener(k.CANCEL_LEAFLET_SCREENSHOT,u),c())})}else c();l&&l.dispose()},this.getScreenShotProgressive=function(e,t,n,i){for(var r=[],o=(i=i||{}).models||$.getModels(),l=0;l<o.length;l++){if((P=(C=o[l]).getIterator())&&P.getGeomScenes)for(var c=P.getGeomScenes(),u=0;u<c.length;u++){var h=c[u];h&&r.push(h)}}var d=i.camera||this.camera;d===this.camera&&(d=d.clone()),d.clientWidth=e,d.clientHeight=t;var f=this.getPixelPerUnit(d,this.getVisibleBounds()),p=new a.FrustumIntersector,m=i.excludeCutPlanes?[]:X.getCutPlanes();p.reset(d,m),p.areaCullThreshold=L.PIXEL_CULLING_THRESHOLD,q.pushViewport();var g=q.getPixelRatio();q.setPixelRatio(1);var v=new s.RenderContext;v.init(q,e,t,!0),X.addOverrideMaterial("normalsMaterial_screenshot",v.getDepthMaterial()),X.addOverrideMaterial("edgeMaterial_screenshot",v.getEdgeMaterial());var b=i.renderConfig||Y.getConfig();v.applyConfig(b),v.beginScene(ee.scene,d,ee.noLights,!0),q.popViewport(),q.setPixelRatio(g);var x=20,w=0,A=void 0,E={stop:function(){return A&&De.clearTimeout(A)},finished:function(){return!!A}},T=-1,M=[];for(l=0;l<o.length;l++){var C;if((C=o[l]).getData().isLeaflet){var P=C.getIterator();M.push({iter:P,viewId:P.registerView(),ready:!1})}}var R=function(){for(var e=!0,t=0;t<M.length;t++){(n=M[t]).ready||(n.ready=n.iter.reset(p,d,n.viewId)),e=e&&n.ready}if(e)for(t=0;t<M.length;t++){var n,i=(n=M[t]).iter.getScene(n.viewId);r.push(i)}return e},D=function(){M.forEach(function(e){return e.iter.unregisterView(e.viewId)}),M.length=0},I=i.fragOptions,N=I?[]:void 0,k=function(e){if(!!I&&e instanceof _.RenderBatch){var t=e.frags;e.forEachNoMesh(function(e,n){N[n]=t.vizflags[e];var i=I.isFragOff&&I.isFragOff(e);void 0!==i&&t.setFlagFragment(e,S.MeshFlags.MESH_HIDE,i);var r=I.isFragVisible&&I.isFragVisible(e);void 0!==r&&t.setFlagFragment(e,S.MeshFlags.MESH_VISIBLE,r)})}},V=function(e){if(!!I&&e instanceof _.RenderBatch){var t=e.frags;e.forEachNoMesh(function(e,n){var i=N[n],r=!!(i&S.MeshFlags.MESH_HIDE),o=!!(i&S.MeshFlags.MESH_VISIBLE);t.setFlagFragment(e,S.MeshFlags.MESH_HIDE,r),t.setFlagFragment(e,S.MeshFlags.MESH_VISIBLE,o)})}},F=[],B=null,U=function(e){i.excludeThemingColors&&e instanceof _.RenderBatch&&(e.frags.model.is2d()||(B=e.frags.db2ThemingColor,e.frags.db2ThemingColor=F))},z=function(e){B&&(e.frags.db2ThemingColor=B,B=null)},G=new O.Vector4(0,0,-1,-1e20),H=[],W=null,j=function(){var e=(W=X.getCutPlanes()).length;if(H.length!==e){H.length=e;for(var t=0;t<e;t++)H[t]=G}X.setCutPlanes(H)},K=function(){X.setCutPlanes(W)};return function o(){if(R()){var a=performance.now();q.pushViewport();var s=q.getPixelRatio();q.setPixelRatio(1),q.setViewport(0,0,e,t);var l=ee.getPixelPerUnit(ee.camera,ee.getVisibleBounds());for(X.updatePixelScale(f,e,t),i.excludeCutPlanes&&j(),i.beforeRender&&i.beforeRender();w<r.length;){var c=r[w];if(k(c),U(c),c instanceof _.RenderBatch&&c.applyVisibility(y.RenderFlags.RENDER_NORMAL,p),v.renderScenePart(c,!0,!0,!1,!1),c instanceof _.RenderBatch&&(!c.frags.areAllVisible()||I)&&(c.applyVisibility(y.RenderFlags.RENDER_HIDDEN,p),Y.setEdgeColor(ee.edgeColorGhosted),c.overrideMaterial=ee.fadeMaterial,v.renderScenePart(c,!0,!0,!1,!1),Y.setEdgeColor(ee.edgeColorMain),c.overrideMaterial=null),z(c),V(c),w++,performance.now()-a>x)break}if(q.popViewport(),q.setPixelRatio(s),X.updatePixelScale(l,Y.settings.deviceWidth,Y.settings.deviceHeight),i.excludeCutPlanes&&K(),i.afterRender&&i.afterRender(),w===r.length?function(){D();var e=v.getColorTarget();(b.aoEnabled||b.antialias)&&(b.aoEnabled&&v.computeSSAO(),e=v.getNamedTarget("overlay"),v.getBlendPass().uniforms.tOverlay.value=null,v.setOffscreenTarget(e),v.presentBuffer()),i.returnAsTarget?n(v,e,d):v.targetToCanvas(e).canvas.toBlob(function(e){var t=window.URL.createObjectURL(e);n&&n(t)})}():A=De.setTimeout(o,0),i.onProgress){var u=Math.floor(100*w/r.length);u!==T&&(T=u,i.onProgress(u))}}else A=De.setTimeout(o,0)}(),E},this.cancelLeafletScreenshot=function(){ee.api.dispatchEvent({type:k.CANCEL_LEAFLET_SCREENSHOT})},this.modelQueue=function(){return $},this.glrenderer=function(){return q},this.renderer=function(){return Y},this.geomCache=function(){return Pe||(Pe=new p.OtgGeomCache(ee.api)),Pe},this.shadowMaps=function(){return K},this.worldUp=function(){return n},this.worldUpName=function(){return se},this.setUserRenderContext=function(e,t){Y=e||new s.RenderContext,t||(Y.init(q,this.canvas.clientWidth,this.canvas.clientHeight),Y.setClearColors(this.clearColorTop,this.clearColorBottom)),this.invalidate(!0),this.sceneUpdated(!1)},this.setUserGroundShadow=function(e){var t=Z;return Z=e,t},this.invalidate=function(e,t,n){he=e||he,de=t||de,fe=n||fe},this.invalidateHighlight=function(){pe=!0,this.invalidate(!1,!1,!0)},this.isOverlayDirty=function(){return fe},this.clearOverlayDirtyFlag=function(){fe=!1},this.sceneUpdated=function(e){this.invalidate(!0,!1,!0),$&&e&&($.invalidateVisibleBounds(),this.zoomBoundsChanged=!0),ge=!0,Ue()},this.requestSilentRender=function(){ve=ye=!0},this.requestDeferredSilentRender=function(){ve=!0},this.currentLightPreset=function(){return re},this.saveLightPreset=function(){oe=re},this.matman=function(){return X},this.fps=function(){return 1e3/xe},this.setFPSTargets=function(e,t,n){te=1e3/n,ie=1e3/e,ne=1e3/t,this.targetFrameBudget=Object(i.isMobileDevice)()?ne/4:ne},this.track=function(e){m.logger.track(e)},this.worldToClient=function(e){var t=new O.Vector4(e.x,e.y,e.z,1);return t.applyMatrix4(this.camera.matrixWorldInverse),t.applyMatrix4(this.camera.projectionMatrix),t.w>0&&(t.x/=t.w,t.y/=t.w,t.z/=t.w),this.viewportToClient(t.x,t.y)},this.clientToWorld=function(e,t,n){var i=null,r=this.model,o=r.getData();if(r.is2d()){var a=this.intersectGround(e,t);if(a){a.z=0;var s=o.bbox;(o.hidePaper||s.containsPoint(a))&&(i={point:a,model:r})}}else(i=this.hitTest(e,t,n))&&(i.point=i.intersectPoint);return i},this.setSelectionColor=function(e,t){var n=new O.Color(e);n.multiplyScalar(.5);var i=function(t){t.color.set(e),t.emissive.set(n)};i(this.selectionMaterialBase),i(this.selectionMaterialTop),this.selectionMaterialBase.variants&&this.selectionMaterialBase.variants.forEach(i),this.selectionMaterialTop.variants&&this.selectionMaterialTop.variants.forEach(i),Y.setSelectionColor(e),this.invalidateHighlight(),this.invalidate(!1,!1,!0)},this.updateViewportId=function(e){X.updateViewportId(e),this.invalidate(!0)},this.findModel=function(e){return $.findModel(e)},this.getFrameRate=function(){return this.frameDisplayRate},this.setFrameRate=function(e){this.frameDisplayRate=e<1?1:e},this.setShadowLightDirection=function(e){ce.copy(e),Ue(),this.invalidate(!0,!1,!1),Be()},this.getShadowLightDirection=function(e){var t=e||new O.Vector3;return t.copy(ce),t},this.toggleShadows=function(e){!!K!=!!e&&(e?K=new b.ShadowMaps(q):(K.cleanup(X),K=null),Be(),this.invalidate(!0,!0,!1))},this.showTransparencyWhenMoving=function(e){$.enableNonResumableFrames=e},this.fitToView=function(e,t){(t=!!t,0===e.length)&&(e=$.getModels().map(function(e){return{model:e,selection:[]}}));for(var n=0,i=0,r=0;r<e.length;++r){var o=e[r].model;if(!o)return!1;o.is2d()?n++:i++}var a=!1;if(i===e.length)a=this._fitToView3d(e,t);else{if(n!==e.length)return m.logger.warn("Hybrid 2d/3d fitToView() not supported."),!1;a=this._fitToView2d(e,t)}return!!a&&(1===$.getModels().length&&this.api.dispatchEvent({type:k.FIT_TO_VIEW_EVENT,nodeIdArray:e[0].selection,immediate:t,model:e[0].model}),this.api.dispatchEvent({type:k.AGGREGATE_FIT_TO_VIEW_EVENT,selection:e,immediate:t}),!0)},this._fitToView2d=function(e,t){e.length>1&&m.logger.warn("fitToView() doesn't support multiple 2D models. Using the first one...");var n=e[0].model,i=e[0].selection,r=new O.Box3,o=new I.BoundsCallback(r);if(i&&0!==i.length)for(var a=n.getData().fragments.dbId2fragId,s=0;s<i.length;s++){var l=n.reverseMapDbId(i[s]),c=a[l];if(Array.isArray(c))for(var u=0;u<c.length;u++)_t(n,c[u],l,this.use2dInstancing,o);else"number"==typeof c&&_t(n,c,l,this.use2dInstancing,o)}else if(this.api.anyLayerHidden()){var h=n.getData().fragments,d=this.getVisibleLayerIndices();for(s=0;s<h.length;s++)yt(n,s,d,this.use2dInstancing,o)}else r=this.getFitBounds(!0);return!r.empty()&&(this.api.navigation.fitBounds(t,r),!0)},this._fitToView3d=function(e,t){for(var n=!1,i=0;i<e.length;++i)if(e[i].selection.length>0){n=!0;break}var r=new O.Box3,o=new O.Box3;if(n)for(var a=0;a<e.length;++a){var s=e[a].selection;if(0!==s.length){var l=e[a].model,c=l.getFragmentMap(),u=l.getFragmentList();if(c)for(var h=0;h<s.length;++h){var d=parseInt(s[h]);c.enumNodeFragments(d,function(e){u.getWorldBounds(e,o),r.union(o)},!0)}}}else r.union(this.getVisibleBounds(!1,!1));return!r.empty()&&(this.api.navigation.fitBounds(t,r),!0)},this.onWebGLcontextLost=function(e){this.api.fireEvent({type:k.WEBGL_CONTEXT_LOST_EVENT})},this.modelVisible=function(e){return!!$.findModel(e)},this.handleInitialVisibility=function(e){var t=this.api;e.getObjectTree(function(n){var i=e.getFragmentList();if(!i.areAllVisible()){var r=e.getFragmentMap(),o=[];n.enumNodeChildren(e.getRootId(),function(e){r.enumNodeFragments(e,function(e){return i.isFragVisible(e)},!0)||o.push(e)},!0),o.length&&t.hide(o,e)}})},this.box2CutPlanes=function(e){for(var t=[new O.Vector3(1,0,0),new O.Vector3(0,1,0),new O.Vector3(0,0,1),new O.Vector3(-1,0,0),new O.Vector3(0,-1,0),new O.Vector3(0,0,-1)],n=[],i=0;i<t.length;i++){var r=t[i],o=i<3?e.max:e.min,a=-r.dot(o);n.push(new O.Vector4(r.x,r.y,r.z,a))}return n},this._signalNoMeshes=function(){$.isEmpty()&&(this._geometryAvailable=0)},this._signalMeshAvailable=function(){0===this._geometryAvailable&&(this._geometryAvailable=1,this.api.fireEvent({type:k.RENDER_FIRST_PIXEL}))},this.hasModels=function(){return!$.isEmpty()}}G.prototype.constructor=G},function(e,t,n){"use strict";n.r(t),n.d(t,"Selector",function(){return l}),n.d(t,"MultiModelSelector",function(){return c});var i=n(75),r=n(7),o=n(1),a=n(2),s=n(0);function l(e,t){var n=this;this.selectedObjectIds={},this.selectionCount=0,this.selectionMode=i.SelectionMode.LEAF_OBJECT;var a={};function l(){return t.getData().instanceTree}function c(){return t.getData().instanceTree||t.getData().fragmentMap}function u(n){var i=l();if(a[n]>0)a[n]--,0==a[n]&&e.highlightObjectNode(t,n,!1);else if(a[n]<0)throw"Selection State machine broken. Negatively selected object!";i&&i.enumNodeChildren(n,function(e){u(e)},!1)}function h(e){if(void 0!==e&&n.selectedObjectIds[e])return!0}function d(i){var r=l();r&&(i=r.findNodeForSelection(i,n.selectionMode),!r.isNodeSelectable(i))||(h(i)||(n.selectedObjectIds[i]=i,n.selectionCount++,function n(i){var r=l();a[i]?a[i]++:(e.highlightObjectNode(t,i,!0),a[i]=1),r&&r.enumNodeChildren(i,function(e){n(e)},!1)}(i)))}function f(e){h(e)&&(u(e),n.selectedObjectIds[e]=0,n.selectionCount--)}this.getInstanceTree=l,this.getFragmentMap=c,this.getSelectionLength=function(){return n.selectionCount},this.getSelection=function(){var e=[],t=n.selectedObjectIds;for(var i in t)if(t[i]){var r=parseInt(i);e.push(r)}return e},this.isSelected=function(e){return h(e)},this.clearSelection=function(e){if(this.selectionCount>0){var t=n.selectedObjectIds;for(var i in t){var r=parseInt(i);void 0!==r&&u(r)}return n.selectedObjectIds={},n.selectionCount=0,!0}},this.deselectInvisible=function(){var i=!1,r=n.selectedObjectIds,o=e.visibilityManager;for(var a in r){var s=parseInt(a);s&&!o.isNodeVisible(t,s)&&(f(s),i=!0)}return i},this.toggleSelection=function(e){e?h(e)?f(e):d(e):o.logger.error("Attempting to select node 0.",Object(r.errorCodeString)(r.ErrorCodes.VIEWER_INTERNAL_ERROR))},this.setSelectionMode=function(e){this.clearSelection(!0),this.selectionMode=e},this.setSelection=function(e){if(!function(e){if(n.selectionCount!==e.length)return!1;for(var t=0;t<e.length;t++)if(!h(e[t]))return!1;return!0}(e)&&(this.clearSelection(!0),null!=e&&0!==e.length))for(var t=0;t<e.length;t++)d(e[t])},this.getSelectionBounds=function(){var e=new s.Box3,i=new s.Box3,r=c();if(r){var o=t.getFragmentList(),a=n.selectedObjectIds;for(var l in a){var u=parseInt(l);r.enumNodeFragments(u,function(t){o.getWorldBounds(t,i),e.union(i)},!0)}}return e},this.getSelectionVisibility=function(){var e=!1,i=!1,r=n.selectedObjectIds;for(var o in r){var a=parseInt(o);if(a){var s=c();if(s&&s.isNodeHidden(a)?i=!0:e=!0,e&&i)break}}return{hasVisible:e,hasHidden:i,model:t}},this.dtor=function(){this.selectedObjectIds=null}}function c(e){var t=[];function n(){t.length>1&&o.logger.warn("This selection call does not yet support multiple models.")}function i(){for(var n,i=[],r=0;r<t.length;r++){var o=[],s=[],l=t[r].selector.selectedObjectIds,c=t[r].selector.getFragmentMap();for(var u in l)if(l[u]){var h=parseInt(u);h&&(o.push(h),c&&c.enumNodeFragments(h,function(e){s.push(e)},!1))}o.length&&i.push({fragIdsArray:s,dbIdArray:o,nodeArray:o,model:t[r]})}1===t.length&&(n={type:a.SELECTION_CHANGED_EVENT,fragIdsArray:i[0]?i[0].fragIdsArray:[],dbIdArray:i[0]?i[0].dbIdArray:[],nodeArray:i[0]?i[0].dbIdArray:[],model:t[0]},e.api.dispatchEvent(n)),n={type:a.AGGREGATE_SELECTION_CHANGED_EVENT,selections:i},e.api.dispatchEvent(n)}function r(){for(var e=!1,n=0;n<t.length;n++)e=t[n].selector.deselectInvisible()||e;e&&i()}this.highlightDisabled=!1,this.highlightPaused=!1,this.selectionDisabled=!1,this.addModel=function(n){-1==t.indexOf(n)&&(n.selector=new l(e,n),t.push(n))},this.removeModel=function(e){var n=t.indexOf(e);e.selector.getSelection();e.selector.clearSelection(),e.selector=null,t.splice(n,1)},this.getSelectionLength=function(){for(var e=0,n=0;n<t.length;n++)e+=t[n].selector.getSelectionLength();return e},this.getSelection=function(){return n(),t.length>1&&o.logger.warn("Use getAggregateSelection instead of getSelection when there are multiple models in the scene."),t[0]?t[0].selector.getSelection():[]},this.getAggregateSelection=function(){for(var e=[],n=0;n<t.length;n++){var i=t[n].selector.getSelection();i&&i.length&&e.push({model:t[n],selection:i})}return e},this.clearSelection=function(e){for(var n,r=0;r<t.length;r++)t[r].selector.clearSelection(e)&&(n=!0);!e&&n&&i()},this.toggleSelection=function(e,r){r||(n(),r=t[0]),r.selector.toggleSelection(e),i()},this.setSelectionMode=function(e){for(var n=0;n<t.length;n++)t[n].selector.setSelectionMode(e)},this.setSelection=function(e,r){if(!this.selectionDisabled){if(e&&0!==e.length){if(r)for(var o=0;o<t.length;o++)t[o]!==r&&t[o].selector.clearSelection();else n(),r=t[0];r.selector.setSelection(e)}else this.clearSelection(!0);i()}},this.setAggregateSelection=function(e){if(!this.selectionDisabled){if(e&&0!==e.length)for(var t=0;t<e.length;++t){var n=e[t].model,r=e[t].ids;n.selector.setSelection(r)}else this.clearSelection(!0);i()}},this.getSelectionBounds=function(){if(1==t.length)return t[0].selector.getSelectionBounds();for(var e=new s.Box3,n=0;n<t.length;n++){var i=t[n].selector.getSelectionBounds();e.union(i)}return e},this.getSelectionVisibility=function(){for(var e={hasVisible:!1,hasHidden:!1,details:[]},n=0;n<t.length;n++){var i=t[n].selector.getSelectionVisibility();e.hasVisible=e.hasVisible||i.hasVisible,e.hasHidden=e.hasHidden||i.hasHidden,e.details.push(i)}return e},this.dtor=function(){for(var e=0;e<t.length;e++)t[e].selector.dtor()},e.api.addEventListener(a.ISOLATE_EVENT,function(e){r()}),e.api.addEventListener(a.HIDE_EVENT,function(e){r()})}},function(e,t,n){"use strict";n.r(t),n.d(t,"VisibilityManager",function(){return a}),n.d(t,"MultiModelVisibilityManager",function(){return s});var i=n(1),r=n(2);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){this.viewerImpl=e,this.model=t,this.isolatedNodes=[],this.hiddenNodes=[]}function s(e){this.viewerImpl=e,this.models=[]}function l(e){var t=e.getAggregateIsolatedNodes();if(1===e.models.length){var n={type:r.ISOLATE_EVENT,nodeIdArray:t.length?t[0].ids:[],model:e.models[0]};e.viewerImpl.api.dispatchEvent(n)}n={type:r.AGGREGATE_ISOLATION_CHANGED_EVENT,isolation:t};e.viewerImpl.api.dispatchEvent(n)}a.prototype.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null},a.prototype.getFragmentMap=function(){return this.model?this.model.getData().instanceTree||this.model.getData().fragmentMap:null},a.prototype.getIsolatedNodes=function(){return this.isolatedNodes.slice(0)},a.prototype.getHiddenNodes=function(){return this.hiddenNodes.slice(0)},a.prototype.setAllVisibility=function(e){var t=this.model?this.model.getRootId():null;t&&this.setVisibilityOnNode(t,e),this.model.getData().is2d&&this.model.setAllVisibility(e)},a.prototype.isNodeVisible=function(e){var t=this.getInstanceTree();return t?!t.isNodeHidden(e):-1==this.hiddenNodes.indexOf(e)&&(0==this.isolatedNodes.length||-1!=this.isolatedNodes.indexOf(e))},a.prototype.isolate=function(e){var t=this.getInstanceTree(),n=t?t.getRootId():null,i="number"==typeof e&&e===n||"object"==o(e)&&e.dbId===n;e&&!i?this.isolateMultiple(Array.isArray(e)?e:[e]):this.isolateNone()},a.prototype.isolateNone=function(){this.model.setAllVisibility(!0),this.viewerImpl.sceneUpdated(!0),this.setAllVisibility(!0),this.hiddenNodes=[],this.isolatedNodes=[],this.viewerImpl.invalidate(!0)},a.prototype.isolateMultiple=function(e){if(e&&0!=e.length){this.setAllVisibility(!1),this.model.getData().is2d||(this.model.setAllVisibility(!1),this.viewerImpl.sceneUpdated(!0)),this.isolatedNodes=e.slice(0),this.hiddenNodes=[];for(var t=0;t<e.length;t++)this.setVisibilityOnNode(e[t],!0)}else this.isolateNone();this.viewerImpl.invalidate(!0)},a.prototype.hide=function(e){var t;if(Array.isArray(e)){for(var n=0;n<e.length;++n)this.setVisibilityOnNode(e[n],!1);e.length>0&&(t={type:r.HIDE_EVENT,nodeIdArray:e,model:this.model})}else this.setVisibilityOnNode(e,!1),t={type:r.HIDE_EVENT,nodeIdArray:[e],model:this.model};t&&this.viewerImpl.api.dispatchEvent(t)},a.prototype.show=function(e){var t;if(Array.isArray(e)){for(var n=0;n<e.length;++n)this.setVisibilityOnNode(e[n],!0);e.length>0&&(t={type:r.SHOW_EVENT,nodeIdArray:e,model:this.model})}else this.setVisibilityOnNode(e,!0),t={type:r.SHOW_EVENT,nodeIdArray:[e],model:this.model};t&&this.viewerImpl.api.dispatchEvent(t)},a.prototype.toggleVisibility=function(e){var t=this.getFragmentMap().isNodeHidden(e);this.setVisibilityOnNode(e,t);var n={type:t?r.SHOW_EVENT:r.HIDE_EVENT,nodeIdArray:[e],model:this.model};this.viewerImpl.api.dispatchEvent(n)},a.prototype.setVisibilityOnNode=function(e,t){var n=this.viewerImpl,i=this.model,r=this.getFragmentMap(),o=!t,a=i.getData().is2d;this.viewerImpl.matman();r?r.enumNodeChildren(e,function(e){if(r.setNodeHidden(e,o),a){var n=i.reverseMapDbId(e);i.getFragmentList().setObject2DGhosted(n,!t)}else r.enumNodeFragments(e,function(e){i.setVisibility(e,t)},!1)},!0):a?i.getFragmentList().setObject2DGhosted(e,!t):i.setVisibility(e,t),n.sceneUpdated(!0),this.updateNodeVisibilityTracking(e,t)},a.prototype.updateNodeVisibilityTracking=function(e,t){var n=t;if(this.isolatedNodes.length>0){var i=this.isolatedNodes.indexOf(e);n&&-1===i?this.isolatedNodes.push(e):n||-1===i||(this.isolatedNodes.splice(i,1),0===this.isolatedNodes.length&&(this.hiddenNodes=[this.model.getRootId()]))}else{var r=this.hiddenNodes.indexOf(e);n||-1!==r?n&&-1!==r&&this.hiddenNodes.splice(r,1):this.hiddenNodes.push(e)}var o=this.getInstanceTree();o&&o.root&&o.root.dbId===e&&(t?(this.isolatedNodes=[],this.hiddenNodes=[]):(this.isolatedNodes=[],this.hiddenNodes=[e]))},a.prototype.setNodeOff=function(e,t){var n=this.viewerImpl,i=this.model,r=this.getFragmentMap(),o=i.getData().is2d;r?r.enumNodeChildren(e,function(e){if(r.setNodeOff(e,t),o){var n=i.reverseMapDbId(e);i.getFragmentList().setObject2DVisible(n,!t)}else r.enumNodeFragments(e,function(e){i.getFragmentList().setFragOff(e,t)},!1)},!0):o?i.getFragmentList().setObject2DVisible(e,!t):i.getFragmentList().setFragOff(e,t),n.sceneUpdated(!0)},s.prototype.addModel=function(e){-1==this.models.indexOf(e)&&(e.visibilityManager=new a(this.viewerImpl,e),this.models.push(e))},s.prototype.removeModel=function(e){var t=this.models.indexOf(e);e.visibilityManager.isolateNone(),e.visibilityManager=null,this.models.splice(t,1)},s.prototype.warn=function(){this.models.length>1&&i.logger.warn("This selection call does not yet support multiple models.")},s.prototype.getAggregateIsolatedNodes=function(){for(var e=[],t=this.models,n=0;n<t.length;n++){var i=t[n].visibilityManager.getIsolatedNodes();i&&i.length&&e.push({model:t[n],ids:i})}return e},s.prototype.getIsolatedNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getIsolatedNodes()},s.prototype.getAggregateHiddenNodes=function(){for(var e=[],t=this.models,n=0;n<t.length;n++){var i=t[n].visibilityManager.getHiddenNodes();i&&i.length&&e.push({model:t[n],ids:i})}return e},s.prototype.getHiddenNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getHiddenNodes()},s.prototype.isNodeVisible=function(e,t){return e||(this.warn(),e=this.models[0]),e.visibilityManager.isNodeVisible(t)},s.prototype.isolate=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.isolate(e),l(this)},s.prototype.aggregateIsolate=function(e){if(e&&0!==e.length){var t=this.models.concat();for(o=0;o<e.length;++o){var n=e[o].model,i=e[o].ids||e[o].selection,r=t.indexOf(n);t.splice(r,1),n.visibilityManager.isolate(i)}for(;t.length;)t.pop().visibilityManager.setAllVisibility(!1)}else for(var o=0;o<this.models.length;++o)this.models[o].visibilityManager.isolateNone();l(this)},s.prototype.hide=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.hide(e)},s.prototype.show=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.show(e)},s.prototype.toggleVisibility=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.toggleVisibility(e)},s.prototype.setVisibilityOnNode=function(e,t,n){n||(this.warn(),n=this.models[0]),n.visibilityManager.setVisibilityOnNode(e,t)},s.prototype.setNodeOff=function(e,t,n){n||(this.warn(),n=this.models[0]),n.visibilityManager.setNodeOff(e,t)}},function(e,t,n){"use strict";n.r(t),n.d(t,"MeshAnimation",function(){return d});var i,r,o,a,s,l,c=n(0),u=n(41),h=n(25);function d(e,t,n){h.Animation.call(this,e,t,n),this.localMatrix=new c.Matrix4,this.root.getAnimTransform(),this.relativeTransform=!t.custom||!t.custom.transform||"abs"!==t.custom.transform}d.prototype=Object.create(h.Animation.prototype),d.prototype.constructor=d,d.prototype.keyTypes=["pos","rot","scl"],d.prototype.defaultKey={pos:0,rot:0,scl:0},d.prototype.update=(i=[],r=new c.Vector3,o=new c.Vector3,a=new c.Quaternion,s=new c.Matrix4,l=new c.Matrix4,function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var t=0,n=this.hierarchy.length;t<n;t++){for(var d=this.hierarchy[t],f=d.animationCache[this.data.name],p=0;p<this.keyTypes.length;p++){var m=this.keyTypes[p],g=f.prevKey[m],v=f.nextKey[m];if(v.time<=this.currentTime||g.time>=this.currentTime){for(g=this.data.hierarchy[t].keys[0],v=this.getNextKeyWith(m,t,1);v.time<this.currentTime&&v.index>g.index;)g=v,v=this.getNextKeyWith(m,t,v.index+1);f.prevKey[m]=g,f.nextKey[m]=v}var y=g[m],_=v[m];if(v.time!==g.time&&void 0!==y&&void 0!==_){var b=(this.currentTime-g.time)/(v.time-g.time);if(b<0&&(b=0),b>1&&(b=1),"pos"===m)if(this.interpolationType===u.a.LINEAR)o.x=y[0]+(_[0]-y[0])*b,o.y=y[1]+(_[1]-y[1])*b,o.z=y[2]+(_[2]-y[2])*b,d.position.copy(o);else{i[0]=this.getPrevKeyWith("pos",t,g.index-1).pos,i[1]=y,i[2]=_,i[3]=this.getNextKeyWith("pos",t,v.index+1).pos,b=.33*b+.33;var x=Object(h.interpolateCatmullRom)(i,b);if(o.x=x[0],o.y=x[1],o.z=x[2],d.position.copy(o),this.interpolationType===u.a.CATMULLROM_FORWARD){var w=Object(h.interpolateCatmullRom)(i,1.01*b);r.set(w[0],w[1],w[2]),r.sub(vector),r.y=0,r.normalize();var A=Math.atan2(r.x,r.z);d.rotation.set(0,A,0)}}else"rot"===m?(c.Quaternion.slerp(y,_,a,b),d.quaternion.copy(a)):"scl"===m&&(o.x=y[0]+(_[0]-y[0])*b,o.y=y[1]+(_[1]-y[1])*b,o.z=y[2]+(_[2]-y[2])*b,d.scale.copy(o))}}if(!this.relativeTransform){var E=s.compose(d.position,d.quaternion,d.scale),T=l;d.getOriginalWorldMatrix(T),T.getInverse(T),s.multiplyMatrices(E,T).decompose(d.position,d.quaternion,d.scale)}d.updateAnimTransform()}})},function(e,t,n){"use strict";n.r(t),n.d(t,"createViewerConfig",function(){return o}),n.d(t,"createInitializerOptions",function(){return a});var i=n(39),r=n(1);function o(){var e={extensions:[],sharedPropertyDbPath:void 0,canvasConfig:void 0,startOnInitialize:!0,experimental:[]};return i.theExtensionManager.popuplateOptions(e),e.hasOwnProperty("disabledExtensions")||(e.disabledExtensions={}),["measure","hyperlink","section"].forEach(function(t){e.disabledExtensions.hasOwnProperty(t)||(e.disabledExtensions[t]=!1)}),e}function a(){return{env:"AutodeskProduction",api:void 0,getAccessToken:void 0,language:void 0,logLevel:r.LogLevels.ERROR,webGLHelpLink:null}}},function(e,t,n){"use strict";function i(e){var t=["hottouch"],n={SHIFT:0,ALT:0,CONTROL:0},i=null,r=null,o=!1,a=!1,s=null,l=16,c=17,u=18;this.getNames=function(){return t},this.getName=function(){return t[0]},this.activate=function(e){},this.deactivate=function(e){},this.__checkStart=function(){s&&(this.controller.distributeEvent("handleGesture",s),s=null)},this.update=function(){if(this.controller.getIsLocked())return!1;var t=e.getActiveNavigationTool(),n=!1===o&&!0===a;if(n||!0===o&&!1===a){var s=n?"worldup":"fov";if(t===s)return!1;if(t===i)return e.setActiveNavigationTool(s),i=s,this.__checkStart(),!1;r=t,e.setActiveNavigationTool(s),i=s,this.__checkStart()}else i&&(e.setActiveNavigationTool(r),i=null,r=null);return!1},this.resetKeys=function(){n.SHIFT=0,n.CONTROL=0,n.ALT=0},this.updateModifierState=function(e){n.CONTROL=e.ctrlKey?1:0,n.SHIFT=e.shiftKey?1:0,n.ALT=e.altKey?1:0},this.handleGesture=function(t){if(t===s)return!1;switch(t.type){case"drag3start":e.navigation.isActionEnabled("fov")&&(s=t,o=!0);break;case"drag3move":break;case"drag3end":o=!1;break;case"rotatestart":e.navigation.isActionEnabled("roll")&&(s=t,a=!0);break;case"rotatemove":break;case"rotateend":a=!1}return!1},this.handleKeyDown=function(e,t){switch(this.updateModifierState(e),t){case l:n.SHIFT=1;break;case c:n.CONTROL=1;break;case u:n.ALT=1}return!1},this.handleKeyUp=function(e,t){switch(this.updateModifierState(e),t){case l:n.SHIFT=0;break;case c:n.CONTROL=0;break;case u:n.ALT=0}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),!1},this.handleButtonUp=function(e,t){return this.updateModifierState(e),!1},this.handleMouseMove=function(e){return this.updateModifierState(e),!1},this.handleBlur=function(e){return this.resetKeys(),!1}}n.r(t),n.d(t,"HotGestureTool",function(){return i})},function(e,t,n){"use strict";n.r(t),n.d(t,"FovTool",function(){return r});var i=n(0);function r(e){var t=e.navigation,n=t.getCamera(),r=["fov"],o=!1,a=0,s=null,l=null,c=!1,u=0,h=-5,d=new i.Vector3,f=new i.Vector3,p=new i.Vector3,m=null;function g(e){return e<0&&e>-3?-3:e>0&&e<3?3:e}this.getNames=function(){return r},this.getName=function(){return r[0]},this.activate=function(e){u=0},this.deactivate=function(e){h=-5},this.getCursor=function(){return 0!==u&&-5===h?null:"url(data:image/x-icon;base64,AAACAAEAGBgAAAAAAACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAYAkAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnAwMD/yEhIf8AAABmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAGknJyf/goKC/8/Pz/8aGhr/AAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAABTFBQU/2lpaf/MzMz///////////+Wlpb/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAOAAAAKFTU1P/t7e3////////////8PDw////////////AQEB/wAAAAEAAAAAAAAAFAAAAH0KCgr/AAAAYwAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAjCwsL/6Ghof/t7e3///////Dw8P9MTEz/LS0t//Pz8///////Ghoa/wAAABoAAAANDQ0N/319ff+rq6v/Y2Nj/wAAAK8AAABGAAAA////////////AAAA/wAAAF0hISH/jIyM////////////sLCw/xEREf8AAACHAAAArKysrP//////V1dX/wAAAFcAAABSUlJS//f39///////8PDw/6+vr/86Ojr/LS0t////////////FRUV/1xcXP/Gxsb/+Pj4//Hx8f9MTEz/AAAAsAAAAEcAAAAAAAAAZ2dnZ///////pKSk/wAAAKQAAACtra2t///////////////////////m5ub/kZGR/wAAAP8AAAD/q6ur//Hx8f//////vb29/x0dHf8AAACIAAAAAAAAAAAAAAAAAAAAOjo6Ov//////5+fn/wAAAOcAAADd3d3d////////////////////////////+/v7/9bW1v/i4uL//v7+//Pz8/9hYWH/AAAAvQAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAJycnJ//6+vr//////wMDA/8AAADv7+/v/////////////////////////////////////////////////7y8vP8ODg7/AAAAKwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJiYmJv/6+vr//////wkJCf8AAADv7+/v//////////////////////////////////f39//9/f3//////+np6f+UlJT/GBgY/wAAAH0AAAACAAAAAAAAAAAAAAAAAAAAKSkpKf///////v7+/w0NDf8AAADd3d3d////////////////////////////29vb/39/f/+Xl5f/5+fn////////////5ubm/1RUVP8CAgL/AAAAPwAAAAAAAAAAAAAAOTk5Of//////8PDw/wgICP8AAAChoaGh/////////////////+np6f+YmJj/QkJC/wAAAP8AAAD/UFBQ/7e3t//39/f///////////+oqKj/EBAQ/wAAAIgAAAAAAAAAZ2dnZ///////29vb/wEBAf8AAAA4NTU1/9zc3P/t7e3/tbW1/01NTf8AAACYAAAA////////////AwMD/wsLC/9oaGj/y8vL////////////8fHx/zg4OP8AAACWAAAApaWlpf//////n5+f/wAAAJ8AAAAAAAAAczg4OP9LS0v/EhIS/wAAAE0AAAAAAAAA////////////FRUV/wAAABUAAABoJSUl/4GBgf/i4uL///////////9+fn7/Pz8///b29v//////SkpK/wAAAEoAAAAAAAAAAAAAADgAAABLAAAAEgAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAJQAAAIE8PDz/np6e//z8/P/////////////////8/Pz/CQkJ/wAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAA8DAwM/09PT/+7u7v///////////+QkJD/AAAAkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////Dw8P/wAAAA8AAAAAAAAAAAAAAAAAAAAAAAAADAAAAFIYGBj/aGho/729vf8WFhb/AAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////FRUV/wAAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAQEB/w8PD/8AAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////DAwM/wAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8x/h/nO/4fw1D+HwFy/h4BRu4YAHOGEABkAAAAXAAAIFwAAOBnAAHgIAAD4GUAAOB4AABgXAAAIGMAAABtggAAVMYYAHT+HgE7/g8BcP4Pw2/+D+dc/h//XP///2c=), auto"},this.getMotionDelta=function(e){var t=f.x-d.x,n=f.y-d.y,i=f.z-d.z;Math.abs(t)<.001&&(t=0),Math.abs(n)<.001&&(n=0),Math.abs(i)<.001&&(i=0),e.set(t,n,i)},this.stepMotionDelta=function(e,t){t?(d.x+=.6*e.x,d.y+=.6*e.y,d.z+=.6*e.z):d.copy(f)},this.getAccumulatedWheelDelta=function(){var e=Date.now(),t=0;return l&&e-l>100?(t=g(a),a=0,s=null,l=null,c=!1):s&&e-s>100&&(c?Math.abs(a)>=3&&(t=a,a=0):(t=g(a),c=!0,a=0)),t},this.update=function(){var e=!1,i=h>-5;if(h>-5){this.controller.setIsLocked(!0),this.getMotionDelta(p);var r=p.x,a=p.y,s=p.z;if(0!==r||0!==a||0!==s)if(i=!0,h>=0)a=-a,0!==(s=Math.abs(r)>Math.abs(a)?r:a)&&(s*=-1,t.setVerticalFov(t.getVerticalFov()*(1+s),!0));else{var l=this.getAccumulatedWheelDelta()/3;0!==l&&t.setFocalLength(t.getFocalLength()+l,!0)}this.stepMotionDelta(p,!0),-1===h&&Math.abs(s)<1e-5&&(this.interactionEnd(-1),e=!0)}return i?this.utilities.pivotActive(t.getPivotSetFlag(),!0):this.utilities.pivotUpdate(),!o&&(e||h>-5)&&(h>-1&&d.copy(f),h=-5,this.controller.setIsLocked(!1)),n.dirty},this.interactionStart=function(e,n){(n||e>h)&&(h=e,o=!0),t.toPerspective()},this.interactionEnd=function(e){e===h&&(-1!==e&&this.utilities.pivotActive(!1),o=!1)},this.handleWheelInput=function(e){if(h>-1)return!1;t.getReverseZoomDirection()&&(e*=-1),f.z+=e,a+=e;var n=Date.now();return s||(s=n),l=n,0!=e&&this.interactionStart(-1),!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return this.handleButtonDown(e,0);case"dragmove":return this.handleMouseMove(e);case"dragend":return this.handleButtonUp(e,0);case"drag3start":return m="drag",this.handleButtonDown(e,0);case"drag3move":return"drag"===m&&this.handleMouseMove(e);case"drag3end":return"drag"===m&&this.handleButtonUp(e,0),m=null,!1}return!1},this.handleButtonDown=function(e,t){return u+=1<<t,2!==t&&(d.x=.5*(e.normalizedX+1),d.y=1-.5*(e.normalizedY+1),f.copy(d),this.interactionStart(t),!0)},this.handleButtonUp=function(e,t){return u-=1<<t,2!==t&&(f.x=.5*(e.normalizedX+1),f.y=1-.5*(e.normalizedY+1),this.interactionEnd(t),!0)},this.handleMouseMove=function(e){return f.x=.5*(e.normalizedX+1),f.y=1-.5*(e.normalizedY+1),h>-1},this.handleBlur=function(e){return this.interactionEnd(h),!1}}},function(e,t,n){"use strict";n.r(t),n.d(t,"WorldUpTool",function(){return o});var i=n(0),r=n(2);function o(e,t){var n,o=.35,a=.8,s=t.navigation,l=s.getCamera(),c=["worldup"],u=this,h=(n=new i.Vector3,function(e,t,r,o){var a=new i.Vector3(e,t,r),s=o.dot(a);return n.copy(o),n.multiplyScalar(s),a.sub(n)});var d=2*Math.PI,f=1e-5,p=!1,m=!1,g=!1,v=new function(e,t){var n=2*Math.tan(i.Math.degToRad(15)),r=new i.MeshPhongMaterial({color:12303291,ambient:12303291,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),l=new i.Vector3,c=new i.Vector3,u=new i.Quaternion,p=new i.PerspectiveCamera(30,t.aspect,t.near,t.far),m=t,g=1,v=1,y=null,_=null,b=null,x=null,w=null,A=null,E=null,T=null,M=null,S=new Array(6),C=0,P=!1,L=!0,R=0,D=5*Math.PI/180,I=7*Math.PI/180,O=1,N=1e3,k=.1;function V(e,t){var n=Math.abs(e-t);return n>d?n:Math.min(d-n,n)}function F(e,t){var n=G(e);return n.distanceToSquared(t)<f||(c.set(-t.x,-t.y,-t.z),n.distanceToSquared(c)<f)}function B(e){return e>d?e:e<=0?e+Math.PI:e-Math.PI}function U(e,t,n){var i,r=e.clone().normalize(),o=new Array(3),a=new Array(6);o[0]=h(1,0,0,r),o[1]=h(0,1,0,r),o[2]=h(0,0,1,r);var s=t.clone().cross(r).normalize();for(i=0;i<3;++i){var l=o[i];a[i]=l.length(),a[i]<k?S[i]=N:(l.multiplyScalar(1/a[i]),S[i]=Math.atan2(s.dot(l),t.dot(l)))}for(S[3]=B(S[0]),S[4]=B(S[1]),S[5]=B(S[2]),a[3]=a[0],a[4]=a[1],a[5]=a[2],function(e,t){for(var n=D+I+2*Math.PI/180,i=0;i<6;++i)if(S[i]!==N)for(var r=i+1;r<6;++r)if(S[r]!==N&&V(S[i],S[r])<n){if(e[i]<e[r]&&!F(i,t)||F(r,t)){S[i]=N;break}S[r]=N}}(a,n),i=0;i<6;++i)if(S[i]!==N){var d=c.set(0,0,1);u.setFromAxisAngle(d,S[i]);var f=c.set(0,.54,0);f.applyQuaternion(u),T[i].position.copy(f),T[i].visible=!0}else T[i].visible=!1}function z(e,t,n,o,a){return A||(A=function(){A=new i.Object3D;var e=new i.RingGeometry(.5-.01*g,.5,60),t=new i.Mesh(e,r);_=t;var n=.007*g,o=new i.BoxGeometry(.93,n,n),a=new i.BoxGeometry(n,.93,n),s=new i.BoxGeometry(n,n,.93);b=new i.Mesh(o,r),x=new i.Mesh(a,r),w=new i.Mesh(s,r),A.add(b),A.add(x),A.add(w),E=new i.Mesh(new i.CircleGeometry(.005),r),A.add(E),T=new Array(6),M=new Array(6);for(var l=0;l<6;++l){var c=.005*g,u=.0025*g;T[l]=new i.Mesh(new i.CircleGeometry(c,16),r),M[l]=new i.Mesh(new i.CircleGeometry(u,16),r),M[l].visible=!1,T[l].add(M[l]),t.add(T[l])}return A.add(t),A}()),s.orient(_,t,p.position,o),U(n,a,o),A.scale.x=e,A.scale.y=e,A.scale.z=e,A.position.copy(t),A}function G(e){if(l.set(0,0,0),e>=0){var t=e>=3?-1:1;0==(e%=3)&&(l.x=t),1===e&&(l.y=t),2===e&&(l.z=t)}return P&&l.multiplyScalar(-1),l}function H(e,t){for(var n=V(S[0],e),i=0,r=1;r<6;++r){var o=V(S[r],e);o<n&&(n=o,i=r)}return n<t?i:-1}function W(e){s.setWorldUpVector(e,!0)}function j(e){if(0!==e){var t=30*Math.PI/180,n=c.copy(p.position).sub(y).normalize();u.setFromAxisAngle(n,e);var i=s.getWorldUpVector(),r=Math.abs(n.angleTo(i));(r<t||Math.PI-r<t)&&i.copy(s.getCameraUpVector()),i.applyQuaternion(u),W(i)}}function X(e,t,n,i){return e<t&&G(n).distanceToSquared(i)<f}function q(e,t){e.dot(t)<0&&(t=t.clone().multiplyScalar(-1)),s.orient(E,y,p.position,t),E.position.copy(t.multiplyScalar(.495));for(var n=!1,i=L?I:D,r=0;r<6;++r){var o=V(S[r],C),a=X(o,i,r,e);a&&(n=!0);var l=a?4:3*(1-3*o/Math.PI);l<1&&(l=1),l*=g,M[r].visible=a;var c=T[r];c.scale.x=l,c.scale.y=l,c.scale.z=l}return b.visible=n,x.visible=n,w.visible=n,n}function Y(e){(C+=e)>Math.PI?C-=d:C<=-Math.PI&&(C=d+C);var t=function(){if(!L){var e=H(C,D);if(e>=0)return L=!0,C=S[e],G(e)}return!1}();if(t)R=C,W(t);else if(L&&H(C,I)<0&&(L=!1,1))j(C-R),R=0;else{if(L)return!1;j(e)}return!0}e.createOverlayScene("roll",null,null,p),this.updateRollCamera=function(e,t){p.position.copy(m.position),p.quaternion.copy(m.quaternion),p.up.copy(m.up),p.aspect=m.aspect,e&&t&&(p.near=t-e,p.far=t+e),p.updateProjectionMatrix()},this.isSnapped=function(){return L},this.resize=function(){var e=O*n,t=e*m.aspect,i=(m.aspect<1?t:e)*v;A.scale.x=i,A.scale.y=i,A.scale.z=i},this.start=function(t,n){this.updateHUD(t,n),e.addOverlay("roll",A)},this.updateHUD=function(e,t){y=e,t<o?t=o:t>a&&(t=a),v=t,g=a/t;var i=l.copy(e).sub(m.position),r=(O=i.length())*n,c=r*m.aspect,u=(m.aspect<1?c:r)*t;this.updateRollCamera(u,O);var h=s.getWorldUpVector(),d=s.getCameraUpVector();z(u,e,i,h,d),C=0,R=0;var f=h.dot(d);P=f<0,L=q(h,d)},this.handleRoll=function(e,t,n){if(this.updateRollCamera(),q(s.getWorldUpVector(),s.getCameraUpVector()),0!==e||0!==t){var i=n.x-e-.5,r=n.y-t-.5,o=n.x-.5,a=n.y-.5;return Y(Math.atan2(a,o)-Math.atan2(r,i))}return!1},this.handleRollTouch=function(e){this.updateRollCamera(),q(s.getWorldUpVector(),s.getCameraUpVector());var t=e-C;return Math.abs(t)>.001&&Y(t)},this.end=function(){e.removeOverlay("roll",A)}}(e,l),y=new i.Vector3,_=new i.Vector3,b=new i.Vector3,x=null,w=0;this.getNames=function(){return c},this.getName=function(){return c[0]},this.activate=function(e){t.addEventListener(r.CAMERA_CHANGE_EVENT,this.handleCameraChange),g=!1},this.deactivate=function(e){v.end(),t.removeEventListener(r.CAMERA_CHANGE_EVENT,this.handleCameraChange),this.utilities.restorePivot(),x=null,p=!1,g=!1},this.getCursor=function(){return"auto"},this.getMotionDelta=function(e){var t=_.x-y.x,n=_.y-y.y,i=_.z-y.z;Math.abs(t)<.001&&(t=0),Math.abs(n)<.001&&(n=0),Math.abs(i)<.001&&(i=0),e.set(t,n,i)},this.stepMotionDelta=function(){y.copy(_)},this.update=function(){if(!g){var e=s.getEyeVector(),t=.5*(l.near+l.far);e.normalize().multiplyScalar(t);var n=e.add(l.position);this.utilities.savePivot(),this.utilities.setPivotPoint(n,!0,!0),this.utilities.pivotActive(!0);v.start(n,.65),g=!0}var i=m;this.getMotionDelta(b);var r=b.x,o=b.y,a=b.z;return(m||"roll"===x||p&&(0!==r||0!==o||0!==a))&&(m="roll"===x?v.handleRollTouch(w):v.handleRoll(r,o,_)),this.stepMotionDelta(),l.dirty&&(i=!0),i},this.handleResize=function(){v.resize(),m=!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return x="drag",this.handleButtonDown(e,0);case"dragmove":return this.handleMouseMove(e);case"dragend":return x=null,this.handleButtonUp(e,0);case"rotatestart":return t.removeEventListener(r.CAMERA_CHANGE_EVENT,this.handleCameraChange),x="roll",w=i.Math.degToRad(e.rotation),{x:.5*(e.normalizedX+1),y:1-.5*(e.normalizedY+1)},function(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,n=e.pointers[1].clientY-e.pointers[0].clientY,i=Math.sqrt(t*t+n*n),r=s.getScreenViewport();return i/Math.min(r.width,r.height)}(e),!0;case"rotatemove":return w=i.Math.degToRad(e.rotation),"roll"===x;case"rotateend":return t.addEventListener(r.CAMERA_CHANGE_EVENT,this.handleCameraChange),w=i.Math.degToRad(e.rotation),x=null,!1}return!1},this.handleWheelInput=function(e){return!0},this.handleCameraChange=function(){var e=s.getEyeVector(),t=.5*(l.near+l.far);e.normalize().multiplyScalar(t);var n=e.add(l.position);v.updateHUD(n,.65)},this.handleButtonDown=function(e,n){return y.x=.5*(e.normalizedX+1),y.y=1-.5*(e.normalizedY+1),_.copy(y),p=!0,x=null,this.controller.setIsLocked(!0),t.removeEventListener(r.CAMERA_CHANGE_EVENT,u.handleCameraChange),!0},this.handleButtonUp=function(e,n){return _.x=.5*(e.normalizedX+1),_.y=1-.5*(e.normalizedY+1),p=!1,m=!0,this.controller.setIsLocked(!1),t.addEventListener(r.CAMERA_CHANGE_EVENT,u.handleCameraChange),!0},this.handleMouseMove=function(e){return _.x=.5*(e.normalizedX+1),_.y=1-.5*(e.normalizedY+1),!0},this.handleBlur=function(e){return p=!1,x=null,!1}}},function(e,t,n){"use strict";n.r(t),n.d(t,"F2DPagingProxy",function(){return h});var i=n(3),r=n(14),o="PARSE_F2D_FRAME",a=1,s=2,l=4,c=8,u=1048576,h=function(e,t){var n=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},h=e;this.options={onDemandLoading:!1,pageOutGeometryEnabled:!1},n(this.options,t),this.options.debug={pageOutStart:.75,pageOutEnd:.5,pixelCullingEnable:!1,pixelCullingThreshold:r.PIXEL_CULLING_THRESHOLD},n(this.options.debug,t.debug);var d,f=[],p={},m=[],g=0,v=0,y=-1,_=-1,b=-1,x=0,w=!0,A=0;d=h.useInstancing?48*(d=(Object(i.isMobileDevice)()?16383:32767)/4|0)/u:3932100/u;var E=!1,T=[];function M(e){for(;++e<f.length&&(f[e]&(l|c))!=l;);return e}function S(e){var t=0;if(h.model){var n=h.model.getGeometryList();n&&(t=n.geomMemory/u)}for(var i=M(y),r=t+h.fileMemorySize+d;r+g<e.limit;){var l=-1;if(m.length>0&&(w||i>f.length))l=m.shift().lmv_buffer_id;else{if(!(i<f.length))break;l=i,y=i,i=M(i),w=!0}h.parsingWorker.doOperation({operation:o,bufferId:l,rendered:!!(f[l]&a),promised:!!(f[l]&s),conditional:!!(f[l]&c)}),f[l]&c||(g+=d,f[l]|=c)}}this.options.limit=Math.max(this.options.limit,10),this.options.debug.pageOutEnd=Math.min(this.options.debug.pageOutEnd,this.options.debug.pageOutStart),this.totalGeomSize=e.totalGeomSize,this.onDemandLoadingEnabled=function(){return this.options.onDemandLoading},this.pageOutGeometryEnabled=function(){return this.options.onDemandLoading},this.pixelCullingEnable=function(){return this.options.debug.pixelCullingEnable},this.pixelCullingThreshold=function(){return this.options.debug.pixelCullingThreshold},this.getMemoryInfo=function(){var e=0;if(h.model){var t=h.model.getGeometryList();t&&(e=t.geomMemory/u)}return this.onDemandLoadingEnabled()?{limit:this.options.limit,effectiveLimit:this.options.limit,loaded:e+h.fileMemorySize}:null},this.loadPackFile=function(e){return!!this.onDemandLoadingEnabled()&&(!(e<0||E&&e>=A)&&(e>b&&(b=e),f[e]&a||(e<=y&&this.reset(),f[e]|=l|a),S(this.options),!0))},this.promisePackFile=function(e){if(!this.onDemandLoadingEnabled())return Promise.reject({reason:"Not supported"});if(e<0||e>=A)return Promise.reject({reason:"Buffer id out of bounds"});var t,n,i=p[e];return i?(S(this.options),i):((i=new Promise(function(e,i){t=e,n=i})).lmv_resolve=t,i.lmv_reject=n,i.lmv_buffer_id=e,m.push(i),p[e]=i,f[e]|=l|s,S(this.options),i)},this.cancelPromisedPackFile=function(e){if(!e||!e.hasOwnProperty("lmv_buffer_id")||p[e.lmv_buffer_id]!=e)return!1;var t=m.indexOf(e);t>=0&&m.splice(t,1);var n=f[e.lmv_buffer_id];return n&c&&(h.parsingWorker.doOperation({operation:o,cancelPromise:e.lmv_buffer_id}),n&a||(g-=d)),n&a?n&=~s:n=0,f[e.lmv_buffer_id]=n,delete p[e.lmv_buffer_id],e.lmv_reject&&e.lmv_reject({canceled:!0}),S(this.options),!0},this.resetIterator=function(){},this.reset=function(){h.parsingWorker.doOperation({operation:o,cancel:!0}),g=0;for(var e=0;e<f.length;++e)f[e]&s?(f[e]&=~a,f[e]&c&&(g+=d)):f[e]=0;this.lastPageOut=-1,y=-1,_=-1,T.length=0,b=A-1,++x},this.addGeomPackMissingLastFrame=function(){return!0},this.needResumeNextFrame=function(){return!1},this.pageOut=function(e,t){var n=h.model.getGeometryList(),i=n.geomMemory/u+h.fileMemorySize,o=Math.min(this.options.debug.pageOutStart*this.options.limit,this.options.limit-1.1*d),a=Math.min(this.options.debug.pageOutEnd*this.options.limit,o);if(i>o){for(var s=0,l=i-a;s<T.length&&l>0;)l-=n.removeGeometry(T[s++],h.viewer3DImpl.glrenderer())/u;for(T.splice(0,s),s=n.geoms.length;--s>0&&l>0;)(s<=_||s>y)&&(l-=n.removeGeometry(s,h.viewer3DImpl.glrenderer())/u);if(t)for(l=n.geomMemory/u-o,s=y;s>0&&l>0;--s)l-=n.removeGeometry(s,h.viewer3DImpl.glrenderer())/u;this.lastPageOut=i-n.geomMemory/u,window&&window.gc&&window.gc()}var c=n.geomMemory/u;if(e&&!E){var f=this.options.limit-c;if(f>0)for(var p=y;(f-=d)>=0;)this.loadPackFile(++p)}return r.PAGEOUT_SUCCESS},this.onGeomTraversed=function(e){_=e.svfid-1},this.onGeomCulled=function(e){this.onDemandLoadingEnabled()&&e&&T.push(e.svfid-1)},this.onMeshReceived=function(e,t){if(!this.onDemandLoadingEnabled())return!0;var n=p[t];if(n){n.lmv_resolve&&n.lmv_resolve(),delete p[t];var i=m.indexOf(n);i>=0&&m.splice(i,1)}return!!(f[t]&c&&(0==x||f[t]&s))&&(t>=A&&(A=t+1,v+=e.vb.byteLength+e.indices.byteLength+r.GEOMETRY_OVERHEAD),f[t]&a&&h.viewer3DImpl.invalidate(!1,!0),f[t]=0,g-=d,!0)},this.onFinalFrame=function(){this.onDemandLoadingEnabled()&&(E||(this.totalGeomSize=v/u+h.fileMemorySize),E=!0,f.splice(A,f.length).forEach(function(e){e&c&&(g-=d)}))},this.preparedPackFilesSize=function(){return h.fileMemorySize+g+h.model.getGeometryList().geomMemory/u},this.cancelAcknowledged=function(){--x}}},function(e,t,n){"use strict";n.r(t),n.d(t,"LoadingSpinner",function(){return r});var i=n(9);function r(e){this.parentDiv=e,this.container=document.createElement("div"),this.container.innerHTML=['<div class="path">','<svg width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">','<path d="M2.5,50a47.5,47.5 0 1,0 95,0a47.5,47.5 0 1,0 -95,0" vector-effect="non-scaling-stroke"/>','<path d="M 2.5 50 A 47.5 47.5 0 0 1 47.5 2.5" vector-effect="non-scaling-stroke"/>',"</svg>","</div>",'<div class="message" data-i18n="Spinner Loading">LOADING</div>'].join(""),this.container.className="loading-spinner"}r.prototype.addClass=function(e){this.container.classList.add(e)},r.prototype.attachToDom=function(){return!this.container.parentNode&&(i.i18n.localize(this.container),this.parentDiv.appendChild(this.container),!0)},r.prototype.removeFromDom=function(){return!!this.container.parentNode&&(this.container.parentNode.removeChild(this.container),!0)},r.prototype.setVisible=function(e){e?this.attachToDom():this.removeFromDom()}},function(e,t,n){"use strict";n.r(t),n.d(t,"TreeOnDemand",function(){return u});var i=n(3),r=n(61),o=n(148),a=n(9),s=n(90),l=150,c=300;function u(e,t){this.dirty=!1,this.nextFrameId=0,this.scrollY=0,this.delegates=[],this.idToDelegate={},this.options=t,this.rootContainer=document.createElement("div"),this.rootContainer.classList.add("docking-panel-container-gradient"),this.rootContainer.classList.add("treeview"),this.rootContainer.classList.add("on-demand"),e.appendChild(this.rootContainer),this.paddingDiv=document.createElement("div"),this.paddingDiv.style.border=0,this.paddingDiv.style.margin=0,this.paddingDiv.style.padding=0,this.sizedDiv=e.parentNode,this.nodeCssTable=[[],["group"],["leaf"]],this.cssStringToNodeCssTable={"":0,group:1,leaf:2},this.nodeIndexToNodeCssTables={};for(var n=[],a=l,c=0;c<a;++c){var u=b();n[c]=u}this.elementsPool=n,this.elementsUsed=0,this.spinner=new o.LoadingSpinner(e),this.spinner.addClass("tree-loading-spinner");var h=Object(i.isTouchDevice)();h&&(this.hammer=new s.Manager(this.rootContainer,{recognizers:[r.GestureRecognizers.doubletap,r.GestureRecognizers.press],handlePointerEventMouse:!1,inputClass:i.isIE11?s.PointerEventInput:s.TouchInput}));for(c=0;c<a;++c){u=n[c];h&&(this.hammer.on("doubletap",x.bind(this)),this.hammer.on("press",w.bind(this))),u.addEventListener("click",A.bind(this)),u.addEventListener("dblclick",E.bind(this)),u.addEventListener("contextmenu",T.bind(this)),u.icon.addEventListener("click",M.bind(this)),u.icon.addEventListener("mousedown",S.bind(this))}p(this)}var h=u.prototype;function d(e){if(e.dirty=!1,function(e){for(var t=e.elementsUsed,n=e.elementsPool,i=0;i<t;++i){var r=n[i];r.setAttribute("lmv-nodeId",""),r.className="";for(var o=r.header,a=o.childNodes.length-1,s=0;s<a;++s)o.removeChild(o.lastChild)}e.clear()}(e),0!==e.delegates.length)if(1===e.delegates.length&&e.delegates[0].isLoading())e.spinner.setVisible(!0);else{if(1===e.delegates.length&&e.delegates[0].isNotAvailable())return e.spinner.setVisible(!1),void e.displayNoProperties(!0);e.spinner.setVisible(!1),e.displayNoProperties(!1),function(e){var t=e.rootContainer,n=function(e){return{width:0|e.sizedDiv.clientWidth,height:0|e.sizedDiv.clientHeight}}(e).height,i=0,r=0,o=!0;t.appendChild(e.paddingDiv);var a=e.delegates.slice(0),s=e.isExcludeRoot();for(;a.length;){var l=a.shift(),u=l.modelDiv;t.appendChild(u);for(var h=[l.getRootId()],d={curr:s?-1:0,popIds:[]};h.length&&o;){if(i>e.scrollY+n+c){o=!1;break}if(e.elementsUsed===e.elementsPool.length){o=!1;break}var p=h.shift(),m=-1===d.curr?0:l.getTreeNodeClientHeight(p),g=i,v=g+m;if(m>0&&v+c>=e.scrollY){var _=e.elementsPool[e.elementsUsed++];_.setAttribute("lmv-nodeId",p),l.createTreeNode(p,_.header);var b=l.getTreeNodeClass(p);b&&_.classList.add(b);var x=y(e,l,p);if(x)for(var w=x.length,A=0;A<w;++A)_.classList.add(x[A]);var E=l.getTreeNodeDepthOffset(p,d.curr);_.header.style.paddingLeft=E+"px",u.appendChild(_)}v+c<e.scrollY&&(r=v),i=v;var T=0===m,M=f(e,l,p,T);if(M&&M.length>0){d.curr++;for(var S=M[M.length-1],C=d.popIds.length-1;C>=0&&d.popIds[C]===p;)d.popIds[C--]=S;d.popIds.push(S),h=M.concat(h)}for(;d.popIds.length>0&&p===d.popIds[d.popIds.length-1];)d.popIds.pop(),d.curr--}for(e.paddingDiv.style.height=r+"px";h.length;){var p=h.shift(),m=-1===d.curr?0:l.getTreeNodeClientHeight(p),g=i,v=g+m;i=v;var M=f(e,l,p);M&&M.length&&(h=M.concat(h))}}t.style.height=i+"px"}(e)}else e.spinner.setVisible(!1)}function f(e,t,n,i){if(!t.isTreeNodeGroup(n))return null;if(!i&&e.isCollapsed(t,n))return null;var r=[];return t.forEachChild(n,function(e){r.push(e)}),r}function p(e,t){e.dirty&&!t||(t?d(e):(e.dirty=!0,e.nextFrameId=requestAnimationFrame(function(){d(e)})))}function m(e,t){return"number"!=typeof t&&"string"!=typeof t?e.threeDelegate.getTreeNodeId(0|t):t}function g(e,t){for(var n=null;t&&t!==e.rootContainer;){if(t.hasAttribute("lmv-nodeId")){n=t;break}t=t.parentElement}if(!n)return null;var i=n.getAttribute("lmv-nodeId");return parseFloat(i)}function v(e,t){for(var n=null;t&&t!==e.rootContainer;){if(t.hasAttribute("lmv-modelId")){n=t;break}t=t.parentElement}if(!n)return null;var i=n.getAttribute("lmv-modelId");return parseInt(i)}function y(e,t,n){if(t.isControlId(n))return t.getControlIdCss(n);var i=t.getTreeNodeIndex(n);return e.nodeCssTable[e.nodeIndexToNodeCssTables[t.model.id][i]]}function _(e,t,n,i){var r=i.join(" "),o=e.cssStringToNodeCssTable[r]||e.nodeCssTable.length;o===e.nodeCssTable.length&&(e.nodeCssTable.push(i),e.cssStringToNodeCssTable[r]=o);var a=t.getTreeNodeIndex(n);e.nodeIndexToNodeCssTables[t.model.id][a]=o}function b(e,t){var n=document.createElement("lmvheader"),i=document.createElement("icon");n.appendChild(i);var r=document.createElement("div");return r.header=n,r.icon=i,r.appendChild(n),r}function x(e){var t=g(this,e.target);if(t){var n=v(this,e.target),i=this.getDelegate(n);i&&i.onTreeNodeDoubleClick(this,t,e)}}function w(e){var t=g(this,e.target);if(t){var n=v(this,e.target),i=this.getDelegate(n);i&&i.onTreeNodeRightClick(this,t,e)}}function A(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=g(this,e.target);if(t){var n=v(this,e.target),i=this.getDelegate(n);i&&(i.onTreeNodeClick(this,t,e),e.stopPropagation(),e.preventDefault())}}}function E(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=g(this,e.target);if(t){var n=v(this,e.target),i=this.getDelegate(n);i&&(i.onTreeNodeDoubleClick(this,t,e),e.stopPropagation(),e.preventDefault())}}}function T(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=g(this,e.target);if(t){var n=v(this,e.target),i=this.getDelegate(n);i&&(i.onTreeNodeRightClick(this,t,e),e.stopPropagation(),e.preventDefault())}}}function M(e){var t=g(this,e.target);if(t){var n=v(this,e.target),i=this.getDelegate(n);i&&(i.onTreeNodeIconClick(this,t,e),e.stopPropagation(),e.preventDefault())}}function S(e){e.stopPropagation(),e.preventDefault()}h.constructor=u,h.pushDelegate=function(e){this.delegates.push(e),this.idToDelegate[e.model.id]=e,p(this)},h.removeDelegate=function(e){for(var t=0;t<this.delegates.length;++t){if(this.delegates[t].model.id===e)return this.delegates.splice(t,1),delete this.idToDelegate[e],delete this.nodeIndexToNodeCssTables[e],void p(this)}},h.setInstanceTree=function(e,t){if(e.setInstanceTree(t),p(this),t){var n=new Uint8Array(e.getTreeNodeCount()),i=e.instanceTree.getRootId();e.forEachChild(i,function(t){var i=e.getTreeNodeIndex(t);n[i]=e.isTreeNodeGroup(t)?1:2},!0);var r=e.model.id;this.nodeIndexToNodeCssTables[r]=n;var o=0,a=0;t.enumNodeChildren(i,function(e){a||(o=e),a++}),this.setAllCollapsed(e,!0);var s=this.options.excludeRoot,l=this.options.startCollapsed;s?(this.setCollapsed(e,i,!1),l||this.setCollapsed(e,o,!1)):l||this.setCollapsed(e,e.rootId,!1),p(this,!0)}},h.show=function(e){this.rootContainer.style.display=block},h.getRootContainer=function(){return this.rootContainer},h.getDelegate=function(e){return this.idToDelegate[parseInt(e)]},h.isCollapsed=function(e,t){var n=y(this,e,t);return n&&-1!==n.indexOf("collapsed")},h.setCollapsed=function(e,t,n,i){n?(this.addClass(e,t,"collapsed",i),this.removeClass(e,t,"expanded",i)):(this.addClass(e,t,"expanded",i),this.removeClass(e,t,"collapsed",i))},h.setAllCollapsed=function(e,t){var n=function(t){this.addClass(e,t,"collapsed",!1),this.removeClass(e,t,"expanded",!1)}.bind(this),i=e.instanceTree.getRootId();this.iterate(e,i,function(t){return e.isTreeNodeGroup(t)&&n(t),!0})},h.addToSelection=function(e,t){for(var n=t.length,i=0;i<n;++i)this.addClass(e,t[i],"selected",!1);p(this)},h.removeFromSelection=function(e,t){for(var n=t.length,i=0;i<n;++i)this.removeClass(e,t[i],"selected",!1);p(this)},h.setSelection=function(e,t){return this.clearSelection(e),this.addToSelection(e,t),this.selectedNodes},h.clearSelection=function(e){var t=[],n=function(n){var i=y(this,e,n);i&&-1!==i.indexOf("selected")&&(t[0]=n,this.removeFromSelection(e,t))}.bind(this),i=e.instanceTree.getRootId();e.forEachChild(i,n,!0)},h.isSelected=function(e){var t=y(this,delegate,e);return t&&-1!==t.indexOf("selected")},h.scrollTo=function(e,t){var n=this.getDelegate(t.id),i=!1,r=[],o=function(t,n){if(!(i=i||e===t)){r.push(n.getTreeNodeClientHeight(t));var a=r.length,s=n.isTreeNodeGroup(t)&&-1!==y(this,n,t).indexOf("expanded");n.forEachChild(t,function(e){o(e,n)}),s||i||r.length>a&&r.splice(a)}}.bind(this);this.setCollapsed(n,e,!1,!0);var a=n.getRootId();if(o(a,n),!i)return-1;for(var s=0,l=r.length,c=this.isExcludeRoot()?1:0;c<l;++c)s+=r[c];if(1===this.delegates.length)return p(this,!0),s;for(c=0;c<this.delegates.length;++c){var u=this.delegates[c];if(u===n)break;r=[],e=-1,i=!1,a=u.getRootId(),o(a,u),l=r.length;for(var h=0,d=0;d<l;++d)h+=r[d];s+=h}return p(this,!0),s},h.addClass=function(e,t,n,i){function r(t,n,i){var r=y(t,e,n);r&&(-1===r.indexOf(i)&&((r=r.slice(0)).push(i),r.sort(),_(t,e,n,r)))}if(i)for(var o=e.getTreeNodeParentId(m(this,t));o;)r(this,o,n),o=e.getTreeNodeParentId(o);else r(this,t,n);return p(this),!0},h.removeClass=function(e,t,n,i){function r(t,n,i){var r=y(t,e,n);if(r){var o=r.indexOf(i);-1!==o&&((r=r.slice(0)).splice(o,1),_(t,e,n,r))}}if(i)for(var o=e.getTreeNodeParentId(m(this,t));o;)r(this,o,n),o=e.getTreeNodeParentId(o);else r(this,t,n);return p(this),!0},h.hasClass=function(e,t){return 1!==y(this,delegate,e).indexOf(t)},h.clear=function(){for(var e,t=this.rootContainer;e=t.lastChild;)t.removeChild(e);for(var n=0;n<this.delegates.length;++n)this.delegates[n].clean();this.elementsUsed=0},h.iterate=function(e,t,n){null!=t&&e.shouldCreateTreeNode(t)&&n(t)&&e.forEachChild(t,function(t){this.iterate(e,t,n)}.bind(this))},h.forEachDelegate=function(e){for(var t=0;t<this.delegates.length;++t)e(this.delegates[t])},h.destroy=function(){this.clear(),cancelAnimationFrame(this.nextFrameId),this.rootContainer.parentNode.removeChild(this.rootContainer),this.rootContainer=null,this.rootId=-1,this.nodeCssTable=null,this.nodeIndexToNodeCssTables=null,this.cssStringToNodeCssTable=null,this.elementsPool=null,this.elementsUsed=-1,this.scrollY=-1,this.hammer&&(this.hammer.destroy(),this.hammer=null)},h.setScroll=function(e){Math.abs(this.scrollY-e)>c&&(this.scrollY=e,p(this))},h.displayNoProperties=function(e){if(e){if(!this.divNoProps){this.divNoProps=document.createElement("div");var t="Model Browser is not available.";this.divNoProps.innerText=a.i18n.translate(t),this.divNoProps.setAttribute("data-i18n",t),this.divNoProps.classList.add("lmv-no-properties")}if(!this.divNoProps.parentNode)this.rootContainer.parentNode.appendChild(this.divNoProps)}else this.divNoProps&&this.divNoProps.parentNode&&this.divNoProps.parentNode.removeChild(this.divNoProps)},h.isExcludeRoot=function(){return 1===this.delegates.length&&this.options.excludeRoot},h.getDelegateCount=function(){return this.delegates.length}},function(e,t,n){"use strict";n.r(t),n.d(t,"ContextMenu",function(){return a});var i=n(3),r=n(1),o=n(9);function a(e){this.viewer=e,this.menus=[],this.container=null,this.open=!1}a.prototype.constructor=a,a.prototype.show=function(e,t){var n=this.viewer.container.getBoundingClientRect();Array.isArray(e.changedPointers)&&e.changedPointers.length>0&&(e.clientX=e.changedPointers[0].clientX,e.clientY=e.changedPointers[0].clientY);var i=e.clientX-n.left,r=e.clientY-n.top;this.open||(this.showMenu(t,i,r),this.open=!0)},a.prototype.showMenu=function(e,t,n){var o,a=[],s=document.createElement("div");s.style.left="0",s.style.top="0",s.style.width="100%",s.style.height="100%",s.style.position="absolute",s.style.zIndex="10";var l=document.createElement("div");l.classList.add("menu"),l.classList.add("docking-panel"),l.classList.add("docking-panel-container-solid-color-a"),s.appendChild(l),this.viewer.container.appendChild(s),this.container=s,this.menus.push(l);for(var c=0;c<e.length;++c){var u=e[c],h=u.title,d=u.target,f=u.icon,p=u.shortcut;o=this.createMenuItem(h,f,p),l.appendChild(o),"function"==typeof d?this.addCallbackToMenuItem(o,d):Array.isArray(d)?a.push({menuItem:o,target:d}):r.logger.warn("Invalid context menu option:",h,d)}var m=l.getBoundingClientRect(),g=m.width,v=m.height,y=this.viewer.container.getBoundingClientRect(),_=y.width,b=y.height,x=Object(i.isTouchDevice)()&&!this.viewer.navigation.getUseLeftHandedInput();for(x&&(t-=g),t<0&&(t=0),_<t+g&&(t=_-g)<0&&(t=0),n<0&&(n=0),b<n+v&&(n=b-v)<0&&(n=0),l.style.top=Math.round(n)+"px",l.style.left=Math.round(t)+"px",c=0;c<a.length;++c){var w=a[c];m=(o=w.menuItem).getBoundingClientRect(),t=Math.round((x?m.left:m.right)-y.left),n=Math.round(m.top-y.top),this.addSubmenuCallbackToMenuItem(o,w.target,t,n)}this.OnHide=function(e){"menu-item"!==e.target.className&&0===e.button&&this.hide(e)}.bind(this),this.OnMove=function(t){"menu-item"!==t.target.className&&(this.hide(t),this.show(t,e))}.bind(this),this.container.addEventListener("touchend",this.OnHide),this.container.addEventListener("click",this.OnHide),this.container.addEventListener("contextmenu",this.OnMove)},a.prototype.createMenuItem=function(e,t,n){var i=document.createElement("div");return i.className="menu-item",n=n||"",this.setMenuItemIcon(i,t),this.setMenuItemText(i,e),this.setMenuItemShortcut(i,n),i},a.prototype.setMenuItemIcon=function(e,t){var n=document.createElement("div");n.classList.add("menu-item-icon"),t&&n.classList.add(t),e.appendChild(n)},a.prototype.setMenuItemText=function(e,t){var n=document.createElement("div");n.classList.add("menu-item-text"),n.setAttribute("data-i18n",t),n.textContent=o.i18n.translate(t),e.appendChild(n)},a.prototype.setMenuItemShortcut=function(e,t){var n=document.createElement("div");n.classList.add("menu-item-shortcut"),n.textContent=t,e.appendChild(n)},a.prototype.addCallbackToMenuItem=function(e,t){var n=this;e.addEventListener("click",function(e){return n.hide(),t(),e.preventDefault(),!1},!1)},a.prototype.addSubmenuCallbackToMenuItem=function(e,t,n,i){var r=this;e.addEventListener("click",function(){r.showMenu(t,n,i)},!1)},a.prototype.hide=function(){return!!this.open&&(this.menus=[],this.open=!1,this.container.removeEventListener("touchend",this.OnHide),this.container.removeEventListener("click",this.OnHide),this.container.removeEventListener("contextmenu",this.OnMove),this.container.parentNode.removeChild(this.container),this.container=null,!0)}},function(e,t,n){"use strict";function i(e){this.bg=document.createElement("div"),this.bg.className="progressbg",this.fg=document.createElement("div"),this.fg.className="progressfg",this.bg.appendChild(this.fg),this.lastValue=-1,e.appendChild(this.bg),this.widthScale=this.fg.clientWidth}n.r(t),n.d(t,"ProgressBar",function(){return i}),i.prototype.setPercent=function(e){e!=this.lastValue&&(this.lastValue=e,e>=99?this.bg.style.visibility="hidden":(this.bg.style.visibility="visible",this.fg.style.width=this.widthScale*e*.01+"px"))}},function(e,t,n){"use strict";n.r(t),n.d(t,"Filterbox",function(){return o});var i=n(19),r=n(9);function o(e,t){this._id=e,this._listeners={},this._options=t||{},this._filterFunction=this._options.filterFunction||function(){},this.container=document.createElement("div"),this.container.id=e,this.addClass("adsk-control"),this.addClass("adsk-filterbox"),this.addClass("empty");var n=document.createElement("input");n.classList.add("filter-box"),n.classList.add("docking-panel-delimiter-shadow"),n.type="search",n.placeholder=r.i18n.translate("Enter filter term"),n.setAttribute("data-i18n","Enter filter term"),n.incremental="incremental",n.autosave=this.container.id+"filter",this.container.appendChild(n),this.filterbox=n;var i=this,o=function(e){0===(e=e.trim()).length?i.container.classList.add("empty"):i.container.classList.remove("empty"),i._filterFunction&&i._filterFunction(e)},a=document.createElement("div");a.className="filter-box-icon",this.container.insertBefore(a,n.nextSibling);var s=document.createElement("div");s.className="filter-box-close",s.addEventListener("click",function(){i.filterbox.value="",i.addClass("empty")}),this.container.appendChild(s),n.addEventListener("keydown",function(e){13===(e=e||window.event).keyCode&&i.filterbox.blur()}),n.addEventListener("input",function(e){o(this.value)}),n.addEventListener("change",function(e){o(this.value)}),n.addEventListener("focus",function(){a.classList.add("focused")}),n.addEventListener("blur",function(){a.classList.remove("focused")})}o.prototype=Object.create(i.Control.prototype),o.prototype.constructor=o},function(e,t,n){"use strict";n.r(t),n.d(t,"RenderOptionsPanel",function(){return l});var i=n(28),r=n(2),o=n(3),a=n(16),s=n(20);function l(e){var t=this;this.viewer=e,i.DockingPanel.call(this,e.container,"RenderOptionsPanel","Rendering Options"),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.createScrollContainer({heightAdjustment:70}),this.scrollContainer.appendChild(this.table),this.container.style.width="320px",this.container.style.top="260px",this.container.style.left="220px",this.container.style.height="460px",this.container.dockRight=!0,this.postprocStyle=new a.OptionSlider("Postprocess Style",0,4,this.tbody),this.postprocStyle.setValue(0),this.postprocStyle.sliderElement.step=this.postprocStyle.stepperElement.step=1,this.addEventListener(this.postprocStyle,"change",function(n){var i=Math.floor(parseFloat(t.postprocStyle.value)),r="";switch(i){case 0:r="";break;case 1:r="edging";break;case 2:r="cel";break;case 3:r="graphite";break;case 4:r="pencil"}e.impl.preloadPostProcessStyle(),e.impl.setPostProcessParameter("style",r);var o=0!=i;t.edgesToggle.setDisabled(!o),t.grayscaleToggle.setDisabled(!o),t.brightness.setDisabled(!o),t.contrast.setDisabled(!o),t.preserveColor.setDisabled(!o),t.firstParam.setDisabled(i<2),t.secondParam.setDisabled(i<3)}),this.edgesToggle=new a.OptionCheckbox("Display edges",this.tbody,!0),this.edgesToggle.setDisabled(!0),this.addEventListener(this.edgesToggle,"change",function(n){e.impl.setPostProcessParameter("edges",t.edgesToggle.checked)}),this.grayscaleToggle=new a.OptionCheckbox("Grayscale",this.tbody,!1),this.grayscaleToggle.setDisabled(!0),this.addEventListener(this.grayscaleToggle,"change",function(n){e.impl.setPostProcessParameter("grayscale",t.grayscaleToggle.checked)}),this.brightness=new a.OptionSlider("Brightness",-1,1,this.tbody),this.brightness.setValue(0),this.brightness.sliderElement.step=this.brightness.stepperElement.step=.01,this.brightness.setDisabled(!0),this.addEventListener(this.brightness,"change",function(n){e.impl.setPostProcessParameter("brightness",parseFloat(t.brightness.value))}),this.contrast=new a.OptionSlider("Contrast",-1,1,this.tbody),this.contrast.setValue(0),this.contrast.sliderElement.step=this.contrast.stepperElement.step=.01,this.contrast.setDisabled(!0),this.addEventListener(this.contrast,"change",function(n){e.impl.setPostProcessParameter("contrast",parseFloat(t.contrast.value))}),this.preserveColor=new a.OptionCheckbox("Preserve Color",this.tbody,!1),this.preserveColor.setDisabled(!0),this.addEventListener(this.preserveColor,"change",function(n){e.impl.setPostProcessParameter("preserveColor",t.preserveColor.checked)}),this.firstParam=new a.OptionSlider("2*Levels/Repeats",1,5,this.tbody),this.firstParam.setValue(3),this.firstParam.sliderElement.step=this.firstParam.stepperElement.step=.01,this.firstParam.setDisabled(!0),this.addEventListener(this.firstParam,"change",function(n){switch(Math.floor(parseFloat(t.postprocStyle.value))){case 1:break;case 2:e.impl.setPostProcessParameter("levels",2*parseFloat(t.firstParam.value));break;case 3:case 4:e.impl.setPostProcessParameter("repeats",parseFloat(t.firstParam.value))}}),this.secondParam=new a.OptionSlider("Rotation",0,1,this.tbody),this.secondParam.setValue(0),this.secondParam.sliderElement.step=this.secondParam.stepperElement.step=.01,this.secondParam.setDisabled(!0),this.addEventListener(this.secondParam,"change",function(n){e.impl.setPostProcessParameter("rotation",parseFloat(t.secondParam.value))}),this.saoToggle=new a.OptionCheckbox("AO Enabled",this.tbody,!0),this.addEventListener(this.saoToggle,"change",function(n){var i=t.saoToggle.checked;e.prefs.set("ambientShadows",i),e.setQualityLevel(i,e.impl.renderer().settings.antialias)}),this.saoRadius=new a.OptionSlider("AO Radius",0,200,this.tbody),this.saoRadius.setValue(10),this.saoRadius.sliderElement.step=this.saoRadius.stepperElement.step=.01,this.addEventListener(this.saoRadius,"change",function(n){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()}),this.saoIntensity=new a.OptionSlider("AO Intensity",0,3,this.tbody),this.saoIntensity.setValue(.4),this.saoIntensity.sliderElement.step=this.saoIntensity.stepperElement.step=.01,this.addEventListener(this.saoIntensity,"change",function(n){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()}),this.groundShadowAlpha=new a.OptionSlider("Shadow Alpha",0,2,this.tbody),this.groundShadowAlpha.setValue(1),this.groundShadowAlpha.sliderElement.step=this.groundShadowAlpha.stepperElement.step=.1,this.addEventListener(this.groundShadowAlpha,"change",function(n){e.setGroundShadowAlpha(parseFloat(t.groundShadowAlpha.value))}),this.groundShadowColor=new a.OptionCheckbox("Shadow Color",this.tbody),o.isIE11||(this.groundShadowColor.checkElement.value="#000000",this.groundShadowColor.checkElement.type="color"),this.addEventListener(this.groundShadowColor,"change",function(n){var i=t.groundShadowColor.checkElement.value;e.setGroundShadowColor(new THREE.Color(parseInt(i.substr(1,7),16)))}),this.groundReflectionAlpha=new a.OptionSlider("Reflection Alpha",0,2,this.tbody),this.groundReflectionAlpha.setValue(1),this.groundReflectionAlpha.sliderElement.step=this.groundReflectionAlpha.stepperElement.step=.1,this.addEventListener(this.groundReflectionAlpha,"change",function(n){e.setGroundReflectionAlpha(parseFloat(t.groundReflectionAlpha.value))}),this.groundReflectionColor=new a.OptionCheckbox("Reflection Color",this.tbody),o.isIE11||(this.groundReflectionColor.checkElement.value="#000000",this.groundReflectionColor.checkElement.type="color"),this.addEventListener(this.groundReflectionColor,"change",function(n){var i=t.groundReflectionColor.checkElement.value;e.setGroundReflectionColor(new THREE.Color(parseInt(i.substr(1,7),16)))});for(var n=[],l=0;l<s.LightPresets.length;l++)n.push(s.LightPresets[l].name);this.envSelect=new a.OptionDropDown("Environment",this.tbody,n,e.impl.currentLightPreset()),this.addEventListener(this.envSelect,"change",function(n){var i=t.envSelect.selectedIndex;e.setLightPreset(i)});var c=e.impl.renderer().getToneMapMethod();this.toneMapMethod=new a.OptionDropDown("Tonemap Method",this.tbody,["None","Canon-Lum","Canon-RGB"],c),this.addEventListener(this.toneMapMethod,"change",function(){var n=t.toneMapMethod.selectedIndex;e.impl.setTonemapMethod(n)}),this.exposureBias=new a.OptionSlider("Exposure Bias",-30,30,this.tbody),this.exposureBias.setValue(e.impl.renderer().getExposureBias()),this.exposureBias.sliderElement.step=this.exposureBias.stepperElement.step=.1,this.addEventListener(this.exposureBias,"change",function(n){e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)}),this.exposureBias.setDisabled(0==c),this.whiteScale=new a.OptionSlider("Light Intensity",-5,20,this.tbody);var u=0;e.impl.dir_light1&&(u=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(u),this.whiteScale.sliderElement.step=this.whiteScale.stepperElement.step=.1,this.addEventListener(this.whiteScale,"change",function(n){e.impl.dir_light1.intensity=Math.pow(2,t.whiteScale.value),e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)}),this.fovAngle=new a.OptionSlider("FOV-degrees",6.88,100,this.tbody),this.fovAngle.setValue(e.getFOV()),this.addEventListener(this.fovAngle,"change",function(n){e.setFOV(parseFloat(t.fovAngle.value))}),this.frameRate=new a.OptionSlider("Frame rate:",1,100,this.tbody),this.frameRate.setValue(e.impl.getFrameRate()),this.frameRate.sliderElement.step=this.frameRate.stepperElement.step=1,this.addEventListener(this.frameRate,"change",function(n){e.impl.setFrameRate(t.frameRate.value)}),this.addEventListener(this.viewer,r.CAMERA_CHANGE_EVENT,function(n){var i=parseFloat(t.fovAngle.value),r=e.getFOV();i!=r&&t.fovAngle.setValue(r)}),this.addEventListener(this.viewer,r.RENDER_OPTION_CHANGED_EVENT,function(e){t.syncUI()}),this.addVisibilityListener(function(){t.resizeToContent()})}l.prototype=Object.create(i.DockingPanel.prototype),l.prototype.constructor=l,l.prototype.getContentSize=function(){return{height:this.table.clientHeight+75,width:this.table.clientWidth}},l.prototype.syncUI=function(){var e=this.viewer.impl,t=0;e.dir_light1&&(t=0!=e.dir_light1.intensity?Math.log(e.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(t),this.exposureBias.setValue(e.renderer().getExposureBias());var n=e.renderer().getToneMapMethod();this.toneMapMethod.setSelectedIndex(n),this.envSelect.setSelectedIndex(e.currentLightPreset()),this.exposureBias.setDisabled(0==n),this.saoToggle.setValue(e.renderer().getAOEnabled()),this.saoRadius.setDisabled(!e.renderer().getAOEnabled()),this.saoIntensity.setDisabled(!e.renderer().getAOEnabled()),this.saoRadius.setValue(e.renderer().getAORadius()),this.saoIntensity.setValue(e.renderer().getAOIntensity()),this.groundShadowAlpha.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundShadowColor.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundReflectionAlpha.setDisabled(!this.viewer.prefs.get("groundReflection")),this.groundReflectionColor.setDisabled(!this.viewer.prefs.get("groundReflection")),this.fovAngle.setValue(this.viewer.getFOV())},l.prototype.uninitialize=function(){i.DockingPanel.prototype.uninitialize.call(this),this.table=null,this.tbody=null,this.postprocStyle=null,this.edgesToggle=null,this.grayscale=null,this.brightness=null,this.contrast=null,this.preserveColor=null,this.firstParam=null,this.secondParam=null,this.saoToggle=null,this.saoRadius=null,this.saoIntensity=null,this.groundShadowAlpha=null,this.envSelect=null,this.toneMapMethod=null,this.exposureBias=null,this.whiteScale=null,this.fovAngle=null,this.viewer=null}},function(e,t,n){"use strict";n.r(t),n.d(t,"ViewerModelStructurePanel",function(){return u});var i=n(64),r=n(2),o=n(79),a=n(157),s=n(1),l=n(59),c={click:{onObject:["toggleOverlayedSelection"]},clickShift:{onObject:["toggleMultipleOverlayedSelection"]},clickCtrl:{onObject:["toggleMultipleOverlayedSelection"]}};function u(e,t,n){this.viewer=e,this.visible=!1,this._trackNodeClick=!0,(n=n||{}).defaultTitle="Model",n.excludeRoot=void 0===n.excludeRoot||n.excludeRoot,n.startCollapsed=void 0!==n.startCollapsed&&n.startCollapsed,n.scrollEaseCurve=n.scrollEaseCurve||[0,0,.29,1],n.scrollEaseSpeed=void 0!==n.scrollEaseSpeed?n.scrollEaseSpeed:.003,n.addFooter=void 0===n.addFooter||n.addFooter,this.clickConfig=n&&n.docStructureConfig?n.docStructureConfig:c,this.isMac=-1!==navigator.userAgent.search("Mac OS"),n.hideSearch?(n.heightAdjustment=70,i.ModelStructurePanel.call(this,e.container,e.container.id+"ViewerModelStructurePanel",t,n),this.scrollContainer.classList.add("no-search")):(n.heightAdjustment=104,i.ModelStructurePanel.call(this,e.container,e.container.id+"ViewerModelStructurePanel",t,n),this.searchbox=new a.Searchbox(e.container.id+"ViewerModelStructurePanel-Searchbox",e,{excludeRoot:n.excludeRoot,searchFunction:h.bind(this)}),this.searchbox.addEventListener(o.a,function(e){var t=e.id,n=this.viewer.impl.findModel(e.modelId);this.viewer.select(t,n),this.viewer.fitToView([t],n,!1)}.bind(this)),this.container.appendChild(this.searchbox.container)),this._ignoreScroll=!1,this.selectedNodes={},this.onViewerSelect=this.onViewerSelect.bind(this),this.onViewerIsolate=this.onViewerIsolate.bind(this),this.onViewerHide=this.onViewerHide.bind(this),this.onViewerShow=this.onViewerShow.bind(this)}function h(e){var t=this.tree,n=e.toLowerCase(),i=[];return t.forEachDelegate(function(e){var r=e.getRootId(),o=[];t.iterate(e,r,function(t){var i=e.instanceTree.getNodeName(t);return i&&-1!==i.toLowerCase().indexOf(n)&&o.push(t),!0}),i.push({ids:o,delegate:e})}),i}u.prototype=Object.create(i.ModelStructurePanel.prototype),u.prototype.constructor=u,l.ViewerPanelMixin.call(u.prototype),u.prototype.uninitialize=function(){this.viewer&&(this.viewer.removeEventListener(r.AGGREGATE_SELECTION_CHANGED_EVENT,this.onViewerSelect),this.viewer.removeEventListener(r.AGGREGATE_ISOLATION_CHANGED_EVENT,this.onViewerIsolate),this.viewer.removeEventListener(r.HIDE_EVENT,this.onViewerHide),this.viewer.removeEventListener(r.SHOW_EVENT,this.onViewerShow),this.viewer=null),this.searchResults&&(this.searchResults.uninitialize(),this.searchResults=null),i.ModelStructurePanel.prototype.uninitialize.call(this)},u.prototype.resizeToContent=function(){var e=this.scrollContainer,t=this.tree?this.tree.getRootContainer():null;if(e&&t){var n="calc(100% + "+e.scrollLeft+"px)";t.style.width=n}},u.prototype.createUI=function(){if(!this.uiCreated){var e=this.viewer;i.ModelStructurePanel.prototype.createUI.call(this);var t=this.scrollContainer;t.classList.remove("left");var n=function(){this.visible&&this.resizeToContent(),requestAnimationFrame(n)}.bind(this);n();var o=this.options,a=0,s=e.container.getBoundingClientRect(),l=e.getToolbar(!1);o.maxHeight?o.maxHeight:s.height;if(l){var c=l.container.getBoundingClientRect();a=s.bottom-c.top}else a=0;this.container.style.top="10px",this.container.style.left="10px",this.container.style.height="calc(100% - "+(a+20)+"px)",this.container.style.maxHeight="calc(100% - "+(a+20)+"px)",t.addEventListener("contextmenu",function(e){this.viewer.contextMenu.show(e)}.bind(this)),this.viewer.addEventListener(r.AGGREGATE_SELECTION_CHANGED_EVENT,this.onViewerSelect),this.viewer.addEventListener(r.AGGREGATE_ISOLATION_CHANGED_EVENT,this.onViewerIsolate),this.viewer.addEventListener(r.HIDE_EVENT,this.onViewerHide),this.viewer.addEventListener(r.SHOW_EVENT,this.onViewerShow)}},u.prototype.onViewerSelect=function(e){this.setSelection(e.selections),this._ignoreScroll||this.scrollToSelection(e.selections),this._ignoreScroll=!1},u.prototype.onViewerIsolate=function(e){this.setIsolation(e.isolation)},u.prototype.onViewerHide=function(e){this.setHidden(e.nodeIdArray.slice(),e.model,!0)},u.prototype.onViewerShow=function(e){this.setHidden(e.nodeIdArray.slice(),e.model,!1)},u.prototype.setVisible=function(e){i.ModelStructurePanel.prototype.setVisible.call(this,e),this.visible!==e&&(this.visible=e,this.visible&&this.sync())},u.prototype.sync=function(){var e=this.viewer.getAggregateIsolation();if(this.setIsolation(e),0===e.length)for(var t=this.viewer.getAggregateHiddenNodes(),n=0;n<t.length;++n){var i=t[n].model,r=t[n].ids;this.setHidden(r,i,!0)}var o=this.viewer.getAggregateSelection();this.setSelection(o),this.scrollToSelection(o)},u.prototype.removeTreeUI=function(e){delete this.selectedNodes[e.id],i.ModelStructurePanel.prototype.removeTreeUI.call(this,e)},u.prototype.setHidden=function(e,t,n){for(var i=this.tree,r=i.getDelegate(t.id),o=n?function(e){return i.addClass(r,e,"dim",!1),i.removeClass(r,e,"visible",!1),!0}:function(e){return i.removeClass(r,e,"dim",!1),i.addClass(r,e,"visible",!1),!0},a=0;a<e.length;++a)i.iterate(r,e[a],o)},u.prototype.setIsolation=function(e){if(0!==e.length){var t=[];e.length&&this.tree.forEachDelegate(function(n){for(var i=-1,r=0;r<e.length;r++)if(e[r].model===n.model){i=r;break}-1===i&&t.push(n)}.bind(this));for(var n=0;n<e.length;++n){var i=(a=e[n].model).getData().instanceTree.getRootId(),r=(s=this.tree).getDelegate(a.id);s.iterate(r,i,function(e){return s.removeClass(r,e,"dim",!1),s.removeClass(r,e,"visible",!1),!0});var o=e[n].ids;if(0!==o.length){if(1===o.length&&o[0]===i)return;this.setHidden([i],a,!0),this.setHidden(o,a,!1)}}for(n=0;n<t.length;++n){s=this.tree;var a=(r=t[n]).model;i=r.instanceTree.getRootId();s.iterate(r,i,function(e){return s.removeClass(r,e,"dim",!1),s.removeClass(r,e,"visible",!1),!0}),this.setHidden([i],a,!0)}}else{var s;(s=this.tree).forEachDelegate(function(e){var t=e.model,n=e.instanceTree;if(n){var i=n.getRootId();s.iterate(e,i,function(t){return s.removeClass(e,t,"dim",!1),s.removeClass(e,t,"visible",!1),!0}),this.setHidden([i],t,!1)}}.bind(this))}},u.prototype.setSelection=function(e){var t,n,i,r,o,a,s,l=this.tree,c=this.viewer.impl.modelQueue();for(var u in this.selectedNodes)if(r=c.findModel(parseInt(u)),o=this.selectedNodes[u],s=(a=l.getDelegate(u)).instanceTree){for(n=0;n<o.length;++n)for(i=s.getNodeParentId(o[t]);i;)l.removeClass(a,i,"ancestor-selected"),i=s.getNodeParentId(i);l.clearSelection(a)}for(this.selectedNodes={},t=0;t<e.length;++t)if(r=e[t].model,o=e[t].dbIdArray||e[t].selection,s=(a=l.getDelegate(r.id)).instanceTree){for(n=0;n<o.length;++n)for(i=s.getNodeParentId(o[t]);i;)l.addClass(a,i,"ancestor-selected"),i=s.getNodeParentId(i);l.setSelection(a,o),this.selectedNodes[r.id]=o.concat()}},u.prototype.scrollToSelection=function(e){var t=e[0];if(t){var n=t.model,i=t.dbIdArray||t.selection,r=this.tree.scrollTo(i[0],n),o=this.scrollContainer.scrollTop;this.scrollContainer.scrollTop=r;var a=this.scrollContainer.scrollTop;this.scrollContainer.scrollTop=o,this.options.scrollEaseSpeed>0?this.animateScroll(o,a,function(e){this.tree.setScroll(e)}.bind(this)):(this.scrollContainer.scrollTop=a,this.tree.setScroll(a))}},u.prototype.onEyeIcon=function(e,t){this.viewer.toggleVisibility(e,t)},u.prototype.onTreeNodeClick=function(e,t,n,i){if(this._trackNodeClick&&(s.logger.track({category:"node_selected",name:"model_browser_tool"}),this._trackNodeClick=!1),!this.isMac||!i.ctrlKey){var r="click";this.ctrlDown(i)&&(r+="Ctrl"),i.shiftKey&&(r+="Shift"),i.altKey&&(r+="Alt");var o=["toggleOverlayedSelection"],a=this.clickConfig[r];a&&(o=a.onObject),this.handleAction(o,t,n)}},u.prototype.onTreeNodeRightClick=function(e,t,n,i){return this.isMac&&i.ctrlKey&&0===i.button?(this.clickConfig&&this.clickConfig.clickCtrl&&this.handleAction(this.clickConfig.clickCtrl.onObject,t,n),null):this.viewer.contextMenu.show(i)},u.prototype.handleAction=function(e,t,n){for(var i in e)switch(e[i]){case"toggleOverlayedSelection":this.toggleOverlayedSelection(t,n);break;case"toggleMultipleOverlayedSelection":this.toggleMultipleOverlayedSelection(t,n);break;case"selectOnly":this.viewer.select(t,n);break;case"deselectAll":this.viewer.clearSelection();break;case"selectToggle":this.viewer.toggleSelect(t,n);break;case"isolate":this.viewer.isolate(t,n);break;case"showAll":this.viewer.showAll();break;case"focus":this.viewer.fitToView();break;case"hide":this.viewer.hide(t,n);break;case"show":this.viewer.show(t,n);break;case"toggleVisibility":this.viewer.toggleVisibility(t,n)}},u.prototype.toggleOverlayedSelection=function(e,t){var n=this.selectedNodes[t.id],i=n?n.indexOf(e):-1;this._ignoreScroll=!0,-1===i?(this.viewer.select(e,t),this.viewer.fitToView([e],t,!1)):this.viewer.select([],void 0,t)},u.prototype.toggleMultipleOverlayedSelection=function(e,t){var n=this.selectedNodes[t.id],i=n?n.indexOf(e):-1;-1===i?(n||(n=this.selectedNodes[t.id]=[]),n.push(e)):n.splice(i,1);var r=[];for(var o in this.selectedNodes)if(this.selectedNodes.hasOwnProperty(o)){t=this.viewer.impl.findModel(parseInt(o));var a=this.selectedNodes[o];r.push({model:t,ids:a})}this._ignoreScroll=!0,this.viewer.impl.selector.setAggregateSelection(r);var s=this.viewer.getAggregateSelection();this.viewer.fitToView(s)},u.prototype.ctrlDown=function(e){return this.isMac&&e.metaKey||!this.isMac&&e.ctrlKey}},function(e,t,n){"use strict";n.r(t),n.d(t,"ViewerPropertyPanel",function(){return s});var i=n(49),r=n(59),o=n(2),a=n(28);function s(e){this.viewer=e,this.currentNodeIds=[],this.currentModel=null,this.isDirty=!0,this.propertyNodeId=null,this.normalTitle="Properties",this.loadingTitle="Object Properties Loading...",i.PropertyPanel.call(this,e.container,"ViewerPropertyPanel",this.loadingTitle)}s.prototype=Object.create(i.PropertyPanel.prototype),s.prototype.constructor=s,r.ViewerPanelMixin.call(s.prototype),s.prototype.initialize=function(){i.PropertyPanel.prototype.initialize.call(this);var e=this;e.addEventListener(e.viewer,o.AGGREGATE_SELECTION_CHANGED_EVENT,function(t){t.selections&&t.selections.length?(e.currentNodeIds=t.selections[0].dbIdArray,e.currentModel=t.selections[0].model):e.resetCurrentModel(),e.isDirty=!0,e.requestProperties()}),e.addEventListener(e.viewer,o.HIDE_EVENT,function(t){e.isDirty=!0,e.requestProperties()}),e.addEventListener(e.viewer,o.OBJECT_TREE_CREATED_EVENT,function(t){e.currentModel===t.model&&(e.isDirty=!0,e.requestProperties())}),e.addEventListener(e.viewer,o.SHOW_EVENT,function(t){e.isDirty=!0,e.requestProperties()});var t=this.viewer.getAggregateSelection();t.length?(this.currentModel=t[0].model,this.currentNodeIds=t[0].selection):this.resetCurrentModel()},s.prototype.resetCurrentModel=function(){var e=this.viewer?this.viewer.getVisibleModels():[];1===e.length?(this.currentModel=e[0],this.currentNodeIds=[]):(this.currentModel=null,this.currentNodeIds=[])},s.prototype.setTitle=function(e,t){e||(e="Object Properties",(t=t||{}).localizeTitle=!0),i.PropertyPanel.prototype.setTitle.call(this,e,t)},s.prototype.setVisible=function(e){a.DockingPanel.prototype.setVisible.call(this,e),this.requestProperties()},s.prototype.visibilityChanged=function(){a.DockingPanel.prototype.visibilityChanged.call(this),this.isVisible()&&this.requestProperties()},s.prototype.requestProperties=function(){this.isVisible()&&this.isDirty&&(this.currentModel&&this.currentNodeIds.length>0?this.setNodeProperties(this.currentNodeIds[this.currentNodeIds.length-1]):this.showDefaultProperties(),this.isDirty=!1)},s.prototype.setNodeProperties=function(e){var t=this;this.propertyNodeId=e,t.currentModel.getProperties(e,function(e){if(t.viewer){for(var n,i,r,o=[],a=e.properties,s=0,l=a.length;s<l;++s){var c=a[s];"__internalref__"===c.displayCategory&&o.push(c.displayValue)}(t.currentModel.is3d()&&(n=t.currentModel,i=n.getDocumentNode(),(r=i&&i.findViewableParent())&&-1!==r.name().toLocaleLowerCase().indexOf(".sld"))&&o.length>0?function(e,t,n){return new Promise(function(i,r){e.getBulkProperties(t,{ignoreHidden:!0},function(e){for(var t=0,r=e.length;t<r;++t)for(var o=e[t],a=0,s=o.properties.length;a<s;++a){for(var l=o.properties[a],c=!0,u=0,h=n.properties.length;u<h;++u)n.properties[u].displayName===l.displayName&&(c=!1,u=h);c&&n.properties.push(l)}i(n)})})}(t.currentModel,o,e):Promise.resolve(e)).then(function(e){var n=e.name||t.normalTitle,i=!e.name;t.setTitle(n,{localizeTitle:i}),t.setProperties(e.properties),t.highlight(t.viewer.searchText),t.resizeToContent(),t.respositionPanel()}).catch(function(){t.setProperties([]),t.highlight(""),t.resizeToContent(),t.respositionPanel()})}},function(){t.setTitle(t.normalTitle,{localizeTitle:!0}),t.showNoProperties()})},s.prototype.respositionPanel=function(){if(this.isVisible()){var e=this.viewer.toolController,t=e.lastClickX,n=e.lastClickY,i=this.container.getBoundingClientRect(),r=i.left,o=i.top,a=i.width,s=i.height,l=this.viewer.impl.getCanvasBoundingClientRect(),c=l.left,u=l.top,h=l.width,d=l.height;r<=t&&t<r+a&&o<=n&&n<o+s&&(t<r+a/2&&t+a<c+h?(this.container.style.left=Math.round(t-c)+"px",this.container.dockRight=!1):c<=t-a?(this.container.style.left=Math.round(t-c-a)+"px",this.container.dockRight=!1):t+a<c+h?(this.container.style.left=Math.round(t-c)+"px",this.container.dockRight=!1):n+s<u+d?(this.container.style.top=Math.round(n-u)+"px",this.container.dockBottom=!1):u<=n-s&&(this.container.style.top=Math.round(n-u-s)+"px",this.container.dockBottom=!1))}},s.prototype.showDefaultProperties=function(){var e=this.currentModel?this.currentModel.getRootId():null;e?this.setNodeProperties(e):(this.propertyNodeId=null,this.setTitle(this.normalTitle,{localizeTitle:!0}),i.PropertyPanel.prototype.showDefaultProperties.call(this))},s.prototype.areDefaultPropertiesShown=function(){if(!this.currentModel)return!1;var e=this.currentModel.getRootId();return this.propertyNodeId===e},s.prototype.uninitialize=function(){i.PropertyPanel.prototype.uninitialize.call(this),this.viewer=null},s.prototype.onCategoryClick=function(e,t){i.PropertyPanel.prototype.onCategoryClick.call(this,e,t),this.resizeToContent()},s.prototype.onCategoryIconClick=function(e,t){i.PropertyPanel.prototype.onCategoryIconClick.call(this,e,t),this.resizeToContent()}},function(e,t,n){"use strict";n.r(t);var i=n(0);function r(){this.animations=[]}r.prototype.init=function(e){if(!0===e.initialized)return e;for(var t=0;t<e.hierarchy.length;t++){for(var n=0;n<e.hierarchy[t].keys.length;n++)if(e.hierarchy[t].keys[n].time<0&&(e.hierarchy[t].keys[n].time=0),void 0!==e.hierarchy[t].keys[n].rot&&!(e.hierarchy[t].keys[n].rot instanceof i.Quaternion)){var r=e.hierarchy[t].keys[n].rot;Array.isArray(r)||(r=[r._x,r._y,r._z,r._w]),e.hierarchy[t].keys[n].rot=(new i.Quaternion).fromArray(r)}for(n=1;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].time===e.hierarchy[t].keys[n-1].time&&(e.hierarchy[t].keys.splice(n,1),n--);for(n=0;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].index=n}return e.initialized=!0,e},r.prototype.parse=function(e){var t=[];return function e(t,n){if(n.push(t),t.children&&!(t instanceof i.Camera))for(var r=0;r<t.children.length;r++)e(t.children[r],n)}(e,t),t},r.prototype.play=function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},r.prototype.stop=function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},r.prototype.update=function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)};var o,a,s,l=n(142),c=n(41),u=n(25);function h(e,t,n){u.Animation.call(this,e,t,n)}function d(e,t,n,i){u.Animation.call(this,e,t,i),this.nodeId=n,this.epsilon=.1,this.root.setMaterial(this.viewer.matman().cloneMaterial(e.getMaterial(),i.viewer.model))}function f(e,t,n){var r=this;null===e&&(e=function(e,t,n){var o=r.container=document.createElement("div"),a=e.name;o.id=a,o.style.cursor="pointer",o.style.visibility=n;var s=document.createElement("div");s.id=a+"-txt",s.style.cssText="display: none;position: absolute;z-index: 1;",o.appendChild(s);var l=document.createElement("img"),c=e.custom&&e.custom.att&&1===e.custom.att;l.src=c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAAAAAAAAAAAAAABAwEAAAAAAAAjSRkAAAAFDASJqnZhg1IqTyAjSRkpTx8hRxggRRcAAAAhRRcKFwgAAACau4R9mnFmiFUhSBgbOhMZNhIAAAAECQMgQxcAAAAAAAAAAAAHDwXB2q2jw4yfvoivyJ6fuI6mv5eSr4KAoWu2trZpiV3Nzc0wVSUhRxhNT01vb28AAAAgRBcAAAAAAAAAAAAhRxgeQBYAAAAAAAAAAAAfQRbP5MC0zqCqyJKpyJJBYje3z6WxyKOFpXF9nmkrTiG+wb5xkGVcf0xYfEg1WSpNTU0hRhgfQhYfQhZVVVVAQEAXMREcOhQcHBwSJw0AAAAAAAAWLxAVLQ8AAAAAAAAfQhYIEgYAAACbvn+DsGCGsmSUunaItGXc6dStypelxY2ZvX2Ntm2JtGnS48fB17G40aWNuWucxH6ny4mUvnPF27aPuHCEsGHV5czI3Lq52KGvzJqz1JmqyJOqzY6ew4OYwHiGs2OEsWHb29vL4LvM5bnD3q2+3KWkyoaLtWuKtmfOzs7IyMi21pyawXqPuG/g4ODX68fI4rTG4LCu0ZKszJKlx4qZwHuBnXR2iXENcZskAAAAXnRSTlMAEAIBCAsF6BUn+vPu7erjsZyBEwP99/TRk3JgRUQ1IxwO/v79/Pv6+fn09PPq08q7sqWDe2xrY01AMBj+/v7+/v37+fn59fXz8u/c1cbFxLWonZiIcm1lYVdSQT8de/EoFwAAAgVJREFUOMutklVz21AQRiNFlswYs+M6DTdN0kCDZWZmuAKDZFtgiO2YYm6TlOEHV53ptGs5j93Xc+a7e3d36P/W9prdZ/PZ17aPxphz3mR0x91G07wTG8TDo5R3HLGH3S6fGPdSo8Na/to6W2HZBEqwPCNULlu1BkFdQSyKx4qxOMoyDDJSRB/HnTcqWbSbTmVS6V3E57hvXicOBZd1gmfj6Z1kPrmTjrMMfRizumDA+k3UTcRSyWg0mkzFEgLNlU3rIIJcns0KqJjJq0I+U0SqUJlZJv8JugU3J/QnHEwu6MCMqPN1pq+H3sFxCgOC7RyT48Ev6qLUL/gmeJrJ/p0DzSnyxTtAGLMbv9dohv8zSbomSqUpOxB0AdNXsUbnGEEQmJzKq3JrLgCaJAzms5LI1enfVefEamc/YzYQYFB6/1xBUsQex3E9UZHkUvO6X48PwQjLTKEjVRVFqUqd8v6naQsMUCNcL8xTrVJZluXyl1K7OW1+7sL71x15cvVH43O7UGi3mmc8lkCE0ByMbvXazwueycbHxiXPrUdv3hLDGiF8au/d4sO7Novtnj9k0BO45uRGTp98f2JlK/RqYzN8TK8bGTjZLTXgfvDp6rMNA0ZADAOWHI6VTYwE4WAZjz/s3V5yvIxADosIPlh0BNXHSdA8LFIfDgE8WDg5hmmx9h/40fgXth2SDk3yjP4AAAAASUVORK5CYII=":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABvFBMVEUAAAAAAAADAAAAAAAAAAACAAAAAAAAAAC5PznHVE8BAAAAAADbc27NXVeUDQaZDQaRBwAAAAAAAACHBgDuhoHVa2W9RD2QCAKYCAGPBgB0BQAAAAAAAACMBgAAAAADAAD2jonWb2n2jYjYbWfmeXPNzc3RYFqzODKfFA1RUVGKBgCVBwBvb2+WBwCBBgCFBgCWBwCLBgAAAAAAAACMBgCTBwByBQCTBwBbBACEBgAAAAAAAAAoAgBSBADgeHOoOzXmfnnofnjieHPGvr63t7e0tLTidW/ebmnba2XWZWDAT0qRHBfBSkRNTU2aFxGOBgBYTEsAAACNBgBAQEAAAABbBQAcHBxyBQBKBAAAAABfBAAAAAAAAAAsAgAkAgCJBgDZRT3MOTHQPDTVQjrlUkrjUEjRPjbOOjP/bGTvXFTqV0/fTETNOjL5Zl7eS0PzYFjxXlbiT0fUQTn0e3T7aGDWXFXbSEDTRj/PQTrOPjbb29vgamTxY1zoVE3STETTQjvSPzfOzs7IyMj5g3zzaWLXY13XYVrsXlbbU0zg4OD8lZD4gXq0eHXqd3HscWv2b2jrZmDQZWDdWVLkV1C5y9+5AAAAYHRSTlMAAgUBDggMEeDsIBj+8NHJxpxAEP754tDDtIFsYDkvI/78+/j08/DfycfHxbuvr5mTjYN0bWxkWVZTTDUjEfz8+/n59fT08vHw8PDw5NzV0Mq5uLWrm5iLfX1hV0g/ODZEwKduAAACAklEQVQ4y62SVXPbQBzEa1mWZYaY49ihBhtmKjMzw92JLLBsyxxT2mCZvnCVmU59VpO37Ms97G929nb+p05WXUvTE5GJ6aWuY+yFEdoVdAZd9MjCEYi5J0L3FZutSqVZdIYiPWaj/85j2yszAACGVyq7Lo+RIMZtxRaQOZaTwZZSLbrGLR2+aX54twVykpgVpRzgYbVGz5twYMPTV2ZkKZMupDOSzAiwfNazgQesDO9VASemU6lUWuQAgnyNXsEiiBlbEwE2W9CBQpbVAfRraIZoA5ZosII6EpB6MYrVpLxOQejowKsBL9UGSK+zCnnsF4omB7wkBkQHylDZ+rcDROD3hYcYQE0NHQhQ4f8uCQVG/XF9isJKLtI1TYBQQAgdPlqJzYcWMYBYd58/YJACD6UgpsTVA+51AhvKGgt9zQGN1xN4Dajs/vbtmBXf2mIP3/jGqiW9Q0nlGtn8tXBSnwGPWHYP5PcbLMs2JHFn+6p7WQ/ARTie3/rZm9+pZ+rfP/fawi8dhOFgqLlLX87dHOz/1D9ou/vsrcNiNgBrZzbf338yOXZvbDL2xm4ljCdn6j794cpswr/62p+wWy2m/042oQeMxudedK8mSdzGAy4/9vlm/STRtjGRTz9u3nnge2U3+O2h4o9GfXG7lcLKGWZY8ycduG3sQJCk0Tb+w3S0/Qemc4+eJchuZgAAAABJRU5ErkJggg==",l.id=a+"-img",l.style.cssText="display: block;position: absolute;z-index: 1;",o.appendChild(l),t.api.container.appendChild(o),o.addEventListener("click",function(){s.style.display="none"===s.style.display?"block":"none"});var u=new i.SphereGeometry(.01),h=new i.MeshPhongMaterial({color:32512,ambient:32512,opacity:.6,transparent:!0}),d=new i.Mesh(u,h);return d.visible=!1,void 0===t.overlayScenes.annotation&&t.createOverlayScene("annotation"),t.addOverlay("annotation",d),d}(t,n.viewer,"hidden")),u.Animation.call(this,e,t,n),this.id=t.name,this.text="",this.state="hidden",this.epsilon=.1,this.viewer.api.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(t){r.updateText(e.position,r.text)})}function p(e,t,n){this.viewer=n.viewer,null===e&&(e=this.createPolyline([])),u.Animation.call(this,e,t,n),this.epsilon=.1}function m(e,t){this.animations=[],this.viewer=e,this.keys=[],this.isPlaying=!1,this.isPaused=!0,this.updateFlag=0,this.duration=t,this.currentTime=0,this.onPlayCallback=null,this.animationHandler=new r,this.areCameraAnimationsPaused=!1,this.UPDATE_SCENE=1,this.UPDATE_CAMERA=2}h.prototype=Object.create(u.Animation.prototype),h.prototype.constructor=h,h.prototype.keyTypes=["pos","up","target","fov","perspective"],h.prototype.defaultKey={pos:0,up:0,target:0,fov:0,perspective:0},h.prototype.update=(o=[],a=new i.Vector3,s=new i.Vector3,function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange())){for(var t=0,n=this.hierarchy.length;t<n;t++){for(var i=this.hierarchy[t],r=i.animationCache[this.data.name],l=0;l<this.keyTypes.length;l++){var h=this.keyTypes[l],d=r.prevKey[h],f=r.nextKey[h];if(f.time<=this.currentTime||d.time>=this.currentTime){for(d=this.data.hierarchy[t].keys[0],f=this.getNextKeyWith(h,t,1);f.time<this.currentTime&&f.index>d.index;)d=f,f=this.getNextKeyWith(h,t,f.index+1);r.prevKey[h]=d,r.nextKey[h]=f}var p=d[h],m=f[h];if(f.time!==d.time&&void 0!==p&&void 0!==m){var g,v=(this.currentTime-d.time)/(f.time-d.time);if(v<0&&(v=0),v>1&&(v=1),"pos"===h)g=i.position;else if("up"===h)g=i.up;else if("target"===h)g=i.target;else{if("fov"===h){i.setFov(p+(m-p)*v);continue}if("perspective"===h){(v>.5?m:p)?i.toPerspective():i.toOrthographic();continue}}if(this.interpolationType===c.a.LINEAR)s.x=p[0]+(m[0]-p[0])*v,s.y=p[1]+(m[1]-p[1])*v,s.z=p[2]+(m[2]-p[2])*v,g.copy(s);else{o[0]=this.getPrevKeyWith(h,t,d.index-1)[h],o[1]=p,o[2]=m,o[3]=this.getNextKeyWith(h,t,f.index+1)[h],v=.33*v+.33;var y=Object(u.interpolateCatmullRom)(o,v);if(s.x=y[0],s.y=y[1],s.z=y[2],g.copy(s),this.interpolationType===c.a.CATMULLROM_FORWARD){var _=Object(u.interpolateCatmullRom)(o,1.01*v);a.set(_[0],_[1],_[2]),a.sub(g),a.y=0,a.normalize();var b=Math.atan2(a.x,a.z);i.rotation.set(0,b,0)}}}}i.matrixAutoUpdate=!0,i.matrixWorldNeedsUpdate=!0}i.lookAt(i.target),this.animator.updateFlag|=this.animator.UPDATE_CAMERA}}),d.prototype=Object.create(u.Animation.prototype),d.prototype.constructor=d,d.prototype.keyTypes=["vis","opa"],d.prototype.defaultKey={viz:1,opa:1},d.prototype.update=function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var t=0,n=this.hierarchy.length;t<n;t++)for(var i=this.hierarchy[t],r=i.animationCache[this.data.name],o=0;o<this.keyTypes.length;o++){var a=this.keyTypes[o],s=r.prevKey[a],l=r.nextKey[a];if(l.time<=this.currentTime||s.time>=this.currentTime){for(s=this.data.hierarchy[t].keys[0],l=this.getNextKeyWith(a,t,1);l.time<this.currentTime&&l.index>s.index;)s=l,l=this.getNextKeyWith(a,t,l.index+1);r.prevKey[a]=s,r.nextKey[a]=l}var c=s[a],u=l[a];if(void 0===c&&(c=u),l.time!==s.time&&void 0!==u){var h=i.getMaterial();if("vis"===a){var d=Math.abs(this.currentTime-l.time)<this.epsilon,f=d?u:c;this.viewer.visibilityManager.setNodeOff(this.nodeId,!f)}else if("opa"===a){var p=(this.currentTime-s.time)/(l.time-s.time);p<0&&(p=0),p>1&&(p=1);var m=c+(u-c)*p;h.transparent=1!==m,h.opacity=m,m>0&&this.viewer.visibilityManager.setNodeOff(this.nodeId,!1)}}}},f.prototype=Object.create(u.Animation.prototype),f.prototype.constructor=f,f.prototype.keyTypes=["pos","text","vis"],f.prototype.defaultKey={pos:0,text:"",vis:1},f.prototype.stop=function(){u.Animation.prototype.stop.call(this),this.container.parentNode.removeChild(this.container),this.viewer.removeOverlay("annotation",this.root),this.root=null},f.prototype.updateText=function(e,t){var n=function(e,t,n){var r=e.clone(),o=new i.Matrix4;return t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),o.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),r.applyProjection(o),{x:(r.x+1)*n.width/2+n.offsetLeft-12,y:(1-r.y)*n.height/2+n.offsetTop+12}}(e,this.viewer.camera,this.viewer.canvas),r=document.getElementById(this.id+"-txt");r&&(r.innerHTML=t,r.style.left=n.x+"px",r.style.top=n.y+"px",this.text=t),(r=document.getElementById(this.id+"-img"))&&(r.style.left=n.x+"px",r.style.top=n.y-24+"px")},f.prototype.update=function(){var e=[],t=new i.Vector3,n=new i.Vector3;return function(i){if(!1!==this.isPlaying&&(this.currentTime+=i*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))if(this.isPaused&&this.currentTime<this.startKeyTime)(x=document.getElementById(this.id))&&(x.style.visibility=this.state);else for(var r=0,o=this.hierarchy.length;r<o;r++){for(var a=this.hierarchy[r],s=a.animationCache[this.data.name],l=0;l<this.keyTypes.length;l++){var h=this.keyTypes[l],d=s.prevKey[h],f=s.nextKey[h];if(f.time<=this.currentTime||d.time>=this.currentTime){for(d=this.data.hierarchy[r].keys[0],f=this.getNextKeyWith(h,r,1);f.time<this.currentTime&&f.index>d.index;)d=f,f=this.getNextKeyWith(h,r,f.index+1);s.prevKey[h]=d,s.nextKey[h]=f}var p=d[h],m=f[h];if(f.time!==d.time&&void 0!==p&&void 0!==m){var g=(this.currentTime-d.time)/(f.time-d.time);if(g<0&&(g=0),g>1&&(g=1),"pos"===h){if(this.interpolationType===c.a.LINEAR)n.x=p[0]+(m[0]-p[0])*g,n.y=p[1]+(m[1]-p[1])*g,n.z=p[2]+(m[2]-p[2])*g,a.position.copy(n);else if(this.interpolationType===c.a.CATMULLROM||this.interpolationType===c.a.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",r,d.index-1).pos,e[1]=p,e[2]=m,e[3]=this.getNextKeyWith("pos",r,f.index+1).pos,g=.33*g+.33;var v=Object(u.interpolateCatmullRom)(e,g);if(n.x=v[0],n.y=v[1],n.z=v[2],a.position.copy(n),this.interpolationType===c.a.CATMULLROM_FORWARD){var y=Object(u.interpolateCatmullRom)(e,1.01*g);t.set(y[0],y[1],y[2]),t.sub(vector),t.y=0,t.normalize();var _=Math.atan2(t.x,t.z);a.rotation.set(0,_,0)}}}else if("text"===h){var b=Math.abs(this.currentTime-f.time)<this.epsilon?m:p;this.updateText(a.position,b)}else if("vis"===h){var x;if(x=document.getElementById(this.id)){var w=Math.abs(this.currentTime-f.time)<this.epsilon?m:p;x.style.visibility=w?"visible":"hidden"}}}}a.matrixAutoUpdate=!0,a.matrixWorldNeedsUpdate=!0}}}(),p.prototype=Object.create(u.Animation.prototype),p.prototype.constructor=p,p.prototype.keyTypes=["points","vis"],p.prototype.defaultKey={points:[],vis:1},p.prototype.stop=function(){u.Animation.prototype.stop.call(this),this.viewer.removeOverlay("polyline",this.root),this.root=null},p.prototype.update=function(){function e(e){e.root&&(e.viewer.removeOverlay("polyline",e.root),e.root=null)}return function(t){if(!1!==this.isPlaying&&(this.currentTime+=t*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))if(this.isPaused&&this.currentTime<this.startKeyTime)e(this);else for(var n=0,r=this.hierarchy.length;n<r;n++)for(var o=this.hierarchy[n].animationCache[this.data.name],a=0;a<this.keyTypes.length;a++){var s=this.keyTypes[a],l=o.prevKey[s],c=o.nextKey[s];if(c.time<=this.currentTime||l.time>=this.currentTime){for(l=this.data.hierarchy[n].keys[0],c=this.getNextKeyWith(s,n,1);c.time<this.currentTime&&c.index>l.index;)l=c,c=this.getNextKeyWith(s,n,c.index+1);o.prevKey[s]=l,o.nextKey[s]=c}var u=l[s],h=c[s];if(c.time!==l.time&&void 0!==u&&void 0!==h){var d=(this.currentTime-l.time)/(c.time-l.time);if(d<0&&(d=0),d>1&&(d=1),"points"===s){var f=d<.5?u:h;this.viewer.removeOverlay("polyline",this.root),this.root=null;for(var p=[],m=0;m<f.length;m++){var g=f[m].slice();if(0===m)g[0]=u[m][0]+(h[m][0]-u[m][0])*d,g[1]=u[m][1]+(h[m][1]-u[m][1])*d,g[2]=u[m][2]+(h[m][2]-u[m][2])*d;else if(m===f.length-1){var v=u.length-1,y=h.length-1;g[0]=u[v][0]+(h[y][0]-u[v][0])*d,g[1]=u[v][1]+(h[y][1]-u[v][1])*d,g[2]=u[v][2]+(h[y][2]-u[v][2])*d}var _=new i.Vector3(g[0],g[1],g[2]);p.push(_)}this.root=this.createPolyline(p)}else if("vis"===s){var b=Math.abs(this.currentTime-c.time)<this.epsilon?h:u;this.root.visible=b,b||e(this)}}}}}(),p.prototype.createPolyline=function(e){for(var t=new i.Geometry,n=0;n<e.length;n++)t.vertices.push(e[n]);t.computeLineDistances();var r=new i.LineDashedMaterial({color:0,dashSize:1,gapSize:.5,linewidth:1}),o=new i.Line(t,r,i.LineStrip);return void 0===this.viewer.overlayScenes.polyline&&this.viewer.createOverlayScene("polyline"),this.viewer.addOverlay("polyline",o),o},n.d(t,"KeyFrameAnimator",function(){return m}),m.prototype.destroy=function(){this.stop(),this.viewer=null,this.keys=null,this.animations=null,this.isPlaying=!1,this.isPaused=!1,this.animationHandler=null},m.prototype.add=function(e){if(!(!e.hierarchy||e.hierarchy.length<1||!e.hierarchy[0].keys||e.hierarchy[0].keys.length<2)){var t=null,n=this;if("camera"===e.type?(t=new h(n.viewer.camera,e,n),n.animations.push(t)):"annotation"===e.type?(t=new f(null,e,n),n.animations.push(t)):"polyline"===e.type?(t=new p(null,e,n),n.animations.push(t)):"mesh"!==e.type&&"visibility"!==e.type||n.viewer.model.getData().instanceTree.enumNodeFragments(e.id,function(i){var r=n.viewer.getFragmentProxy(n.viewer.model,i);r&&(t="mesh"===e.type?new l.MeshAnimation(r,e,n):new d(r,e,e.id,n),n.animations.push(t))},!0),t){for(var i=0,r=e.hierarchy.length;i<r;i++)for(var o=e.hierarchy[i].keys,a=0;a<o.length;a++)void 0===o[a].xk&&n.keys.push(o[a].time);!function(e){e.sort(function(e,t){return e-t}),function(e,t,n){for(t=e.length;n=--t;)for(;n--;)e[t]!==e[n]||e.splice(n,1)}(e)}(n.keys)}this.updateFlag|=this.UPDATE_SCENE}},m.prototype.update=function(e){this.animationHandler.update(e);var t=this.updateFlag;return this.isPlaying&&!this.isPaused&&(this.currentTime+=e,this.currentTime=Math.min(this.currentTime,this.duration),this.onPlayCallback&&this.onPlayCallback(this.duration>0?this.currentTime/this.duration*100:0),this.currentTime>=this.duration&&this.pause(),t|=this.UPDATE_SCENE),this.updateFlag=0,t},m.prototype.play=function(e,t){if(this.onPlayCallback=t,this.currentTime>=this.duration&&this.goto(0),this.isPlaying)this.pause();else{for(var n=0;n<this.animations.length;n++){this.animations[n].play(e)}this.isPlaying=!0,this.isPaused=!1}},m.prototype.pause=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t.isPaused===this.isPaused&&t.pause()}this.isPaused=!this.isPaused,this.areCameraAnimationsPaused=this.isPaused},m.prototype.pauseCameraAnimations=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t instanceof h&&t.pause()}this.areCameraAnimationsPaused=!this.areCameraAnimationsPaused},m.prototype.stop=function(){for(var e=0;e<this.animations.length;e++){this.animations[e].stop()}this.isPlaying=!1,this.isPaused=!1},m.prototype.goto=function(e){if(void 0!==e){for(var t=0;t<this.animations.length;t++){this.animations[t].goto(e)}this.isPlaying=!0,this.isPaused=!0,this.currentTime=e,this.updateFlag|=this.UPDATE_SCENE}},m.prototype.next=function(){var e=function(e,t){for(var n=-1,i=0;i<t.length;i++)if(t[i]>e){n=t[i];break}return n<0?t[t.length-1]:n}(this.currentTime,this.keys);this.goto(e)},m.prototype.prev=function(){var e=function(e,t){for(var n=-1,i=t.length-1;i>-1;i--)if(t[i]<e){n=t[i];break}return n<0?t[0]:n}(this.currentTime,this.keys);this.goto(e)}},function(e,t,n){"use strict";n.r(t);var i=n(19),r=n(79),o=n(1),a=n(32),s=n(16),l=50,c=150,u=100;function h(e,t,n){this.excludeRoot=t,this.viewer=n,this.results=[],this.resultCount=0,this.selectedIndex=-1,this.container=document.createElement("div"),this.container.classList.add("docking-panel"),this.container.classList.add("adsk-search-results"),this.container.results=document.createElement("div"),this.container.results.classList.add("docking-panel-scroll"),this.container.results.classList.add("docking-panel-container-solid-color-b"),this.container.results.addEventListener("scroll",function(e){var t=this.container.results.scrollTop;Math.abs(this.scrollY-t)>=u&&(this.scrollY=t,d(this))}.bind(this)),this.container.appendChild(this.container.results),e.insertBefore(this.container,e.firstChild),this.scrollingContainer=document.createElement("div"),this.scrollingContainer.classList.add("adsk-search-results-scrolling-panel"),this.scrollingContainer.addEventListener("click",function(e){var t=e.target,n=this._getNodeAndModelIds(t);if(!n)return;this.fireEvent({type:r.a,id:n.nodeId,modelId:n.modelId}),e.preventDefault()}.bind(this)),this.container.results.appendChild(this.scrollingContainer),this.footer=new s.ResizeFooter(this.container,function(){var e=this.container.getBoundingClientRect(),t=this.viewer.container.getBoundingClientRect();t.right<e.right&&(this.container.style.width=t.right-e.left+"px"),t.bottom<e.bottom&&(this.container.style.height=t.bottom-e.top+"px")}.bind(this)),this.divNoResults=function(){var e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div");e.classList.add("no-results-container"),e.style.display="none";t.setAttribute("data-i18n","No Results"),t.textContent=Autodesk.Viewing.i18n.translate("No Results"),t.classList.add("no-results-title");return n.setAttribute("data-i18n","Try another term"),n.textContent=Autodesk.Viewing.i18n.translate("Try another term"),n.classList.add("no-results-description"),e.appendChild(t),e.appendChild(n),e.domTitle=t,e.domMessage=n,e}(),this.scrollingContainer.appendChild(this.divNoResults),this.scrollY=0,this.dirty=!1,this.nextFrameId=0,this.it={init:function(e){return this.isDone=!1,this.results=e,this.indexRs=0,this.indexId=-1,this},done:function(){return this.isDone},next:function(){if(this.isDone)return this;for(this.indexId++;this.results.length!==this.indexRs&&this.indexId===this.results[this.indexRs].ids.length;)this.indexId=0,this.indexRs++;return this.isDone=this.indexRs===this.results.length,this},id:function(){return this.results[this.indexRs].ids[this.indexId]},delegate:function(){return this.results[this.indexRs].delegate}},this.elementsPool=[],this.elementsUsed=0;for(var i=0;i<c;++i)this.elementsPool[i]=m();this.setVisible(!1)}function d(e,t){e.dirty&&!t||(t?f(e):(e.dirty=!0,e.nextFrameId=requestAnimationFrame(function(){f(e)})))}function f(e){e.dirty=!1,function(e){for(var t=e.elementsUsed,n=e.elementsPool,i=0;i<t;++i){var r=n[i];g(r)}e.elementsUsed=0}(e),0!==e.resultCount?(e.setDisplayNoResults(!1),function(e){var t=e.container.results,n=0,i=t.clientHeight,r=e.scrollY,o=e.it.init(e.results),a=Math.max(0,e.scrollY-u),s=0|Math.floor(a/l),c=0;n=s*l;for(;s;)s--,c++,o.next();var h=e.elementsPool[e.elementsUsed++];h.style.height=n+"px",e.scrollingContainer.appendChild(h);var d=!0;for(;d;){if(o.next(),o.done()){d=!1;break}if(n>r+i+u){d=!1;break}if(e.elementsUsed===e.elementsPool.length){d=!1;break}var f=o.id(),m=o.delegate(),g=l,v=n,y=v+g,_=e.elementsPool[e.elementsUsed++];p(f,m,_,e,c===e.selectedIndex),e.scrollingContainer.appendChild(_),n=y,c++}var b=e.resultCount*l;e.scrollingContainer.style.height=b+"px"}(e)):e.setDisplayNoResults(!0)}function p(e,t,n,i,r){n.classList.add("search-result"),r?n.classList.add("selected"):n.classList.remove("selected"),n.setAttribute("lmv-nodeId",e),n.setAttribute("lmv-modelId",t.model.id),n.style.height=l+"px";var o=t.instanceTree.getNodeName(e),a=i.searchString,s=o.toLowerCase().indexOf(a.toLowerCase()),c=o.substr(0,s),u=o.substr(s,a.length),h=o.substr(s+a.length);n.domPrefix.innerText=c,n.domMatch.innerText=u,n.domSufix.innerText=h;var d=function(e,t,n){var i=[],r=t.getRootId(),o=n.isRootExcluded(),a=t.instanceTree,s=e,l=!1;for(;s&&!l&&(s!==r||(l=!0,!o));){var c=a.getNodeName(s);i.unshift(c),s=a.getNodeParentId(s)}return i}(e,t,i);n.domPath.innerText=d.join(" > ")}function m(){var e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("span"),i=document.createElement("span"),r=document.createElement("span"),o=document.createElement("span");return t.classList.add("search-result-container"),i.classList.add("search-match"),o.classList.add("search-path"),t.appendChild(n),t.appendChild(i),t.appendChild(r),t.appendChild(o),e.appendChild(t),e.domPrefix=n,e.domMatch=i,e.domSufix=r,e.domPath=o,e.domContainer=t,e}function g(e){e.setAttribute("lmv-nodeId",""),e.setAttribute("lmv-modelId",""),e.domPrefix.innerText="",e.domMatch.innerText="",e.domSufix.innerText="",e.domPath.innerText="",e.style.height="0"}function v(e,t){e.scrollTop+e.clientHeight<(t+1)*l&&(e.scrollTop+=(t+1)*l-(e.scrollTop+e.clientHeight)),e.scrollTop/l>t&&(e.scrollTop=t*l)}h.prototype.constructor=h,a.EventDispatcher.prototype.apply(h.prototype),h.prototype.setPosition=function(e,t){this.container.style.left=e+"px",this.container.style.top=t+"px"},h.prototype.setMinWidth=function(e){this.container.style.width=e+"px"},h.prototype.setMaxWidth=function(e){this.container.style.maxHeight=e+"px"},h.prototype.setVisible=function(e){this.container.style.display=e?"":"none"},h.prototype.setResults=function(e,t){this.searchString=e,this.results=t,this.resultCount=function(e){for(var t=0,n=0;n<e.length;++n){var i=e[n];t+=i.ids.length}return t}(t),this.selectedIndex=0==this.resultCount?-1:0,this.container.style.height=this.resultCount*l+20+"px",this.container.results.scrollTop=0,this.scrollY=0,0===this.resultCount?this.container.classList.add("no-content"):this.container.classList.remove("no-content"),d(this)},h.prototype.getSelection=function(){var e=this.scrollingContainer.querySelector(".selected");if(!e)return null;var t=this._getNodeAndModelIds(e);return t||null},h.prototype.isRootExcluded=function(){return!(this.results&&this.results.length>1)&&(!(this.modelCount>1)&&this.excludeRoot)},h.prototype.uninitialize=function(){this.setVisible(!1),this.container=null,this.container.parentNode&&this.container.parentNode.removeChild(this.container),cancelAnimationFrame(this.nextFrameId),this.clearListeners()},h.prototype.setDisplayNoResults=function(e){this.divNoResults.style.display=e?"":"none"},h.prototype.selectNext=function(){0!==this.resultCount&&(this.selectedIndex=Math.min(this.resultCount-1,this.selectedIndex+1),v(this.container.results,this.selectedIndex),d(this))},h.prototype.selectPrevious=function(){0!==this.resultCount&&(this.selectedIndex=Math.max(0,this.selectedIndex-1),v(this.container.results,this.selectedIndex),d(this))},h.prototype._getNodeAndModelIds=function(e){for(;!e.hasAttribute("lmv-nodeId");)if(!(e=e.parentNode)||e===this.scrollingContainer)return;return{nodeId:parseInt(e.getAttribute("lmv-nodeId")),modelId:parseInt(e.getAttribute("lmv-modelId"))}};var y=n(9);function _(e,t,n){this._id=e,this._listeners={},this._options=n||{},this._searchFunction=this._options.searchFunction||function(){},this.container=document.createElement("div"),this.container.id=e,this.addClass("adsk-control"),this.addClass("adsk-searchbox"),this.addClass("empty");var i=document.createElement("input");i.classList.add("search-box"),i.classList.add("docking-panel-delimiter-shadow"),i.type="search",i.results=[],i.placeholder=y.i18n.translate("Search"),i.setAttribute("data-i18n","Search"),i.incremental="incremental",i.autosave=this.container.id+"search_autosave",this.container.insertBefore(i,this.scrollContainer),this.searchbox=i;var a=function(){u.searchbox.value="",u.addClass("empty")},s=function(){u.searchbox.classList.remove("searching"),u.searchResults.setVisible(!1)},l=document.createElement("div");l.className="search-box-icon",this.container.insertBefore(l,i.nextSibling);var c=document.createElement("div");c.className="search-box-close",c.addEventListener("click",function(){a(),s()}),this.container.appendChild(c),this.searchResults=new h(this.container,n.excludeRoot,t),this.searchResults.addEventListener(r.a,function(e){a(),s(),u.fireEvent(e)});var u=this,d=!0;function f(){var e=i.value.trim();if(0!==e.length){d&&(o.logger.track({category:"search_node",name:"model_browser_tool"}),d=!1),i.classList.add("searching");var t=u._searchFunction(e);u.searchResults.setResults(e,t),u.searchResults.setVisible(!0)}else s()}var p;i.addEventListener("keydown",function(e){if(38===(e=e||window.event).keyCode&&(u.searchResults.selectPrevious(),e.preventDefault()),40===e.keyCode&&(u.searchResults.selectNext(),e.preventDefault()),13===e.keyCode){var t=u.searchResults.getSelection();if(!t)return!1;a(),s(),u.fireEvent({type:_.Events.ON_SEARCH_SELECTED,id:t.nodeId,modelId:t.modelId}),e.preventDefault()}}),i.addEventListener("input",function(e){if(0===this.value.length)return u.container.classList.add("empty"),void s();u.container.classList.remove("empty"),this.value.length<3||(clearTimeout(p),p=setTimeout(f,800))}),i.addEventListener("change",function(e){e.target===document.activeElement&&(clearTimeout(p),f())}),i.addEventListener("focus",function(){l.classList.add("focused")}),i.addEventListener("blur",function(){l.classList.remove("focused")})}n.d(t,"Searchbox",function(){return _}),_.prototype=Object.create(i.Control.prototype),_.prototype.constructor=_,_.Events={ON_SEARCH_SELECTED:r.a}},function(e,t){e.exports="\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";e.exports=function(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(r=r+t[i++]|0)|0}while(--a);r%=65521,o%=65521}return r|o<<16|0}},function(e,t,n){"use strict";var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,r){var o=i,a=r+n;e^=-1;for(var s=r;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},function(e,t,n){"use strict";var i=n(65),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new i.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function l(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,t.string2buf=function(e){var t,n,r,o,a,s=e.length,l=0;for(o=0;o<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(l),a=0,o=0;a<l;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},t.buf2binstring=function(e){return l(e,e.length)},t.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,i,r,o,s=t||e.length,c=new Array(2*s);for(i=0,n=0;n<s;)if((r=e[n++])<128)c[i++]=r;else if((o=a[r])>4)c[i++]=65533,n+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&n<s;)r=r<<6|63&e[n++],o--;o>1?c[i++]=65533:r<65536?c[i++]=r:(r-=65536,c[i++]=55296|r>>10&1023,c[i++]=56320|1023&r)}return l(c,i)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+a[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t){function n(){this.pending=0,this.max=1/0,this.listeners=[],this.waiting=[],this.error=null}function i(e){e.pending+=1;var t=!1;return function(i){if(t)throw new Error("callback called twice");if(t=!0,e.error=e.error||i,e.pending-=1,e.waiting.length>0&&e.pending<e.max)r(e,e.waiting.shift());else if(0===e.pending){var o=e.listeners;e.listeners=[],o.forEach(n)}};function n(t){t(e.error)}}function r(e,t){t(i(e))}e.exports=n,n.prototype.go=function(e){this.pending<this.max?r(this,e):this.waiting.push(e)},n.prototype.wait=function(e){0===this.pending?e(this.error):this.listeners.push(e)},n.prototype.hold=function(){return i(this)}},function(e,t,n){"use strict";n.r(t),n.d(t,"LocalStorage",function(){return a});var i=n(1),r=function(){if("undefined"==typeof window)return!1;try{var e="lmv_viewer_test_localStorage",t=window.localStorage;return!!t&&(t.setItem(e,"1"),t.removeItem(e),!0)}catch(e){return!1}}();function o(){}o.prototype.getItem=function(e){return r?window.localStorage.getItem(e):null},o.prototype.setItem=function(e,t){if(r)try{window.localStorage.setItem(e,t)}catch(e){i.logger.debug("avp.LocalStorage: Failed to setItem()")}},o.prototype.removeItem=function(e){r&&window.localStorage.removeItem(e)},o.prototype.isSupported=function(){return r};var a=new o},function(e,t){e.exports="varying vec2 vUv;\nvoid main() {\n#if defined(HORIZONTAL) && defined(FLIP_UV)\n    vUv = vec2(uv.x, 1.0-uv.y);\n#else\n    vUv = vec2(uv.x, uv.y);\n#endif\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},function(e,t){e.exports="uniform sampler2D tDiffuse;\nuniform vec4 uColor;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE_H*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE_V*(Y))\n#endif\n#define PI 3.14159265358979\n#define SIGMA ((KERNEL_RADIUS+KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#define GAUSSIAN(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\nvoid main() {\n    vec4 texColSum = vec4(0.0);\n    float gaussSum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        float gauss = GAUSSIAN(x);\n        vec4 texCol = texture2D(tDiffuse, GET_UV(x));\n#ifdef HAS_ALPHA\n        texCol.rgb *= texCol.a;\n#endif\n        texColSum += texCol * gauss;\n        gaussSum += gauss;\n    }\n#ifdef HAS_ALPHA\n    texColSum.rgb /= (texColSum.a == 0.0 ? 0.0001 : texColSum.a);\n#endif\n#ifdef HORIZONTAL\n    gl_FragColor = texColSum/gaussSum;\n#else\n    gl_FragColor = texColSum/gaussSum * uColor;\n#endif\n}\n"},function(e,t){e.exports="uniform vec3 color1;\nuniform vec3 color2;\nvarying vec2 vUv;\nvarying vec3 vColor;\nvoid main() {\n    if (uv.y == 0.0)\n        vColor = color2;\n    else\n        vColor = color1;\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},function(e,t){e.exports="varying vec3 vColor;\nvarying vec2 vUv;\nuniform samplerCube envMap;\nuniform vec3 uCamDir;\nuniform vec3 uCamUp;\nuniform vec2 uResolution;\nuniform float uHalfFovTan;\nuniform float opacity;\nuniform bool envMapBackground;\n#include<env_sample>\nconst int bloomRange = 4;\n#include<ordered_dither>\nuniform float envMapExposure;\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\n#include<tonemap>\n#endif\nvec3 rayDir(in vec2 vUv) {\n    vec3 A = (uResolution.x/uResolution.y)*normalize(cross(uCamDir,uCamUp)) * (uHalfFovTan * 2.0);\n    vec3 B = normalize(uCamUp) * (uHalfFovTan * 2.0);\n    vec3 C = normalize(uCamDir);\n    vec3 ray = normalize( C + (2.0*vUv.x-1.0)*A + (2.0*vUv.y-1.0)*B );\n    return ray;\n}\nvec3 getColor(in vec3 rd) {\n    return RGBMDecode(textureCube(envMap, adjustLookupVector(rd)), envMapExposure);\n}\nvoid main() {\n    vec3 rd = rayDir(vUv);\n    vec3 outColor;\n    if (envMapBackground) {\n        outColor = getColor(rd);\n#if TONEMAP_OUTPUT == 1\n        outColor = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * outColor);\n#elif TONEMAP_OUTPUT == 2\n        outColor = toneMapCanonFilmic_WithGamma(exposureBias * outColor);\n#endif\n    }\n    else {\n        outColor = vColor;\n    }\n    gl_FragColor = vec4(orderedDithering(outColor), opacity);\n}\n"},function(e,t){e.exports="uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n    vec4 texel = texture2D( tDiffuse, vUv );\n    gl_FragColor = texel;\n}\n"},function(e,t){e.exports="#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );;\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n    vFragDepth = 1.0 + gl_Position.w;\n#else\n    gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n#endif\n}\n"},function(e,t){e.exports="#ifdef USE_LOGDEPTHBUF\nuniform float logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n#extension GL_EXT_frag_depth : enable\nvarying float vFragDepth;\n#endif\n#endif\n#include<pack_depth>\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n    gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif\n#ifdef USE_LOGDEPTHBUF_EXT\n    float depth = gl_FragDepthEXT / gl_FragCoord.w;\n#else\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n#endif\n    depth = 1.0 - depth;\n    gl_FragColor = packDepth(depth);\n}\n"},function(e,t){e.exports="#define NUM_SAMPLES 29.0\n#define NUM_SPIRAL_TURNS 7.0\nuniform sampler2D tDepth;\nuniform vec3 worldSize;\nvarying vec2 vUv;\n#ifdef PRESET_2\n#define SAMPLE_RADIUS 0.3\n#define AO_GAMMA 1.0\n#define AO_INTENSITY 1.0\n#else\n#define SAMPLE_RADIUS 0.2\n#define AO_GAMMA 3.0\n#define AO_INTENSITY 0.8\n#endif\n#include<pack_depth>\n#define PI 3.14159265358979\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\nfloat getRandomAngle(vec2 pos) {\n    return rand(pos) * (2.0 * PI);\n}\nvec2 tapLocation(float sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(sampleNumber + 0.5) * (1.0 / NUM_SAMPLES);\n    float angle = alpha * (NUM_SPIRAL_TURNS * PI * 2.0) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nvec2 sampleAO(vec2 unitDirection, float radius) {\n    vec2 sampleOffset = unitDirection * radius;\n    float idepth = unpackDepth(texture2D(tDepth, vUv + sampleOffset));\n    float depth = 1.0 - idepth;\n    if (depth < 1e-6) {\n        if (radius == 0.0)\n            return vec2(1.0, 1.0);\n        else\n            return vec2(0.0, 1.0);\n    }\n    vec3 dir = vec3(sampleOffset.x, depth, sampleOffset.y) * worldSize;\n    float distance2 = dot(dir,dir);\n    float idistance = 1.0 / sqrt(distance2);\n    vec3 ndir = dir * idistance;\n#ifdef PRESET_2\n    float importance = ndir.y * idistance;\n#else\n    float importance = ndir.y / distance2;\n#endif\n    vec2 ret;\n    ret.x = (idepth == 0.0) ? 0.0 : importance;\n    ret.y = importance;\n    return ret;\n}\nvoid main() {\n    vec2 sum = vec2(0.0);\n    float angle = getRandomAngle(vUv);\n    for (float i = 0.0; i<NUM_SAMPLES; i+= 1.0) {\n        float ssR;\n        vec2 uv = tapLocation(i, angle, ssR);\n        sum += sampleAO(uv, ssR * SAMPLE_RADIUS);\n    }\n    float ao = sum.x / sum.y;\n    gl_FragColor = packDepth(AO_INTENSITY * clamp(pow(ao, AO_GAMMA), 0.0, 0.9999));\n}\n"},function(e,t){e.exports="uniform sampler2D tDepth;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE*(Y))\n#endif\n#include<pack_depth>\n#define PI 3.14159265358979\n#define SIGMA ((2.0 * KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#ifdef BOX\n#define KERNEL_VAL(X) 1.0\n#else\n#define KERNEL_VAL(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\n#endif\nvoid main() {\n    float depthVal = 0.0;\n    float sum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        depthVal += unpackDepth(texture2D(tDepth, GET_UV(x))) * KERNEL_VAL(x);\n        sum += KERNEL_VAL(x);\n    }\n    gl_FragColor = packDepth(depthVal/sum);\n}\n"},function(e,t){e.exports="uniform sampler2D tDepth;\nuniform vec4 uShadowColor;\nvarying vec2 vUv;\n#include<pack_depth>\nvoid main() {\n    float depthVal = unpackDepth(texture2D(tDepth, vUv));\n    gl_FragColor = vec4(uShadowColor.rgb, uShadowColor.a * depthVal);\n}\n"},function(e,t){e.exports="\nvec4 packDepth( const in float depth ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\nfloat unpackDepth( const in vec4 rgba_depth ) {\n    return dot( rgba_depth, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}\n"},function(e,t){e.exports="\nuniform sampler2D tDepth;\nuniform vec4 projInfo;\nuniform float isOrtho;\nuniform mat4 worldMatrix_mainPass;\nvec3 reconstructCSPosition(vec2 fragCoords, float z) {\n    return vec3((fragCoords * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);\n}\nvec3 reconstructWorldPosition(vec2 fragCoords, vec2 screenUv) {\n    float zCam = texture2D(tDepth, screenUv).z;\n    vec3 csPos = reconstructCSPosition(fragCoords, zCam);\n    return (worldMatrix_mainPass * vec4(csPos, 1.0)).xyz;\n}\n"},function(e,t){e.exports="\nfloat luminance_post(vec3 rgb) {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nfloat luminance_pre(vec3 rgb) {\n    return dot(rgb, vec3(0.212671, 0.715160, 0.072169));\n}\nvec3 xyz2rgb(vec3 xyz) {\n    vec3 R = vec3( 3.240479, -1.537150, -0.498535);\n    vec3 G = vec3(-0.969256,  1.875992,  0.041556);\n    vec3 B = vec3( 0.055648, -0.204043,  1.057311);\n    vec3 rgb;\n    rgb.b = dot(xyz, B);\n    rgb.g = dot(xyz, G);\n    rgb.r = dot(xyz, R);\n    return rgb;\n}\nvec3 rgb2xyz(vec3 rgb) {\n    vec3 X = vec3(0.412453, 0.35758, 0.180423);\n    vec3 Y = vec3(0.212671, 0.71516, 0.0721688);\n    vec3 Z = vec3(0.0193338, 0.119194, 0.950227);\n    vec3 xyz;\n    xyz.x = dot(rgb, X);\n    xyz.y = dot(rgb, Y);\n    xyz.z = dot(rgb, Z);\n    return xyz;\n}\nvec3 xyz2xyY(vec3 xyz) {\n    float sum = xyz.x + xyz.y + xyz.z;\n    sum = 1.0 / sum;\n    vec3 xyY;\n    xyY.z = xyz.y;\n    xyY.x = xyz.x * sum;\n    xyY.y = xyz.y * sum;\n    return xyY;\n}\nvec3 xyY2xyz(vec3 xyY) {\n    float x = xyY.x;\n    float y = xyY.y;\n    float Y = xyY.z;\n    vec3 xyz;\n    xyz.y = Y;\n    xyz.x = x * (Y / y);\n    xyz.z = (1.0 - x - y) * (Y / y);\n    return xyz;\n}\nfloat toneMapCanon_T(float x)\n{\n    float xpow = pow(x, 1.60525727);\n    float tmp = ((1.05542877*4.68037409)*xpow) / (4.68037409*xpow + 1.0);\n    return clamp(tmp, 0.0, 1.0);\n}\nconst float Shift = 1.0 / 0.18;\nfloat toneMapCanonFilmic_NoGamma(float x) {\n    x *= Shift;\n    const float A = 0.2;\n    const float B = 0.34;\n    const float C = 0.002;\n    const float D = 1.68;\n    const float E = 0.0005;\n    const float F = 0.252;\n    const float scale = 1.0/0.833837;\n    return (((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F) * scale;\n}\nvec3 toneMapCanonFilmic_WithGamma(vec3 x) {\n    x *= Shift;\n    const float A = 0.27;\n    const float B = 0.29;\n    const float C = 0.052;\n    const float D = 0.2;\n    const float F = 0.18;\n    const float scale = 1.0/0.897105;\n    return (((x*(A*x+C*B))/(x*(A*x+B)+D*F))) * scale;\n}\nvec3 toneMapCanonOGS_WithGamma_WithColorPerserving(vec3 x) {\n    vec3 outColor = x.rgb;\n    outColor = min(outColor, vec3(3.0));\n    float inLum = luminance_pre(outColor);\n    if (inLum > 0.0) {\n        float outLum = toneMapCanon_T(inLum);\n        outColor = outColor * (outLum / inLum);\n        outColor = clamp(outColor, vec3(0.0), vec3(1.0));\n    }\n    float gamma = 1.0/2.2;\n    outColor = pow(outColor, vec3(gamma));\n    return outColor;\n}\n"},function(e,t){e.exports="vec3 orderedDithering(vec3 col) {\n    const vec4 m0 = vec4( 1.0, 13.0,  4.0, 16.0);\n    const vec4 m1 = vec4( 9.0,  5.0, 12.0,  8.0);\n    const vec4 m2 = vec4( 3.0, 15.0,  2.0, 14.0);\n    const vec4 m3 = vec4(11.0,  7.0, 10.0,  6.0);\n    int i = int(mod(float(gl_FragCoord.x), 4.0));\n    int j = int(mod(float(gl_FragCoord.y), 4.0));\n    vec4 biasRow;\n    if      (i==0) biasRow = m0;\n    else if (i==1) biasRow = m1;\n    else if (i==2) biasRow = m2;\n    else           biasRow = m3;\n    float bias;\n    if      (j==0) bias = biasRow.x;\n    else if (j==1) bias = biasRow.y;\n    else if (j==2) bias = biasRow.z;\n    else           bias = biasRow.w;\n    return col + bias / 17.0 / 256.0;\n}\n"},function(e,t){e.exports="#if NUM_CUTPLANES > 0\nuniform vec4 cutplanes[NUM_CUTPLANES];\nvoid checkCutPlanes(vec3 worldPosition) {\n    for (int i=0; i<NUM_CUTPLANES; i++) {\n        if (dot(vec4(worldPosition, 1.0), cutplanes[i]) > 0.0) {\n            discard;\n        }\n    }\n}\n#endif\n"},function(e,t){e.exports="\n#define kPI 3.14159265358979\nvec2 encodeNormal (vec3 n) {\n    return (vec2(atan(n.y,n.x)/kPI, n.z)+1.0)*0.5;\n}\nvec3 decodeNormal (vec2 enc) {\n    vec2 ang = enc * 2.0 - 1.0;\n    vec2 scth = vec2(sin(ang.x * kPI), cos(ang.x * kPI));\n    vec2 scphi = vec2(sqrt(1.0 - ang.y * ang.y), ang.y);\n    return vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y);\n}\n"},function(e,t){e.exports="#ifdef HATCH_PATTERN\nuniform vec2 hatchParams;\nuniform vec3 hatchTintColor;\nuniform float hatchTintIntensity;\nfloat curveGaussian(float r, float invWidth) {\n    float amt = clamp(r * invWidth, 0.0, 1.0);\n    float exponent = amt * 3.5;\n    return exp(-exponent*exponent);\n}\nvec4 calculateHatchPattern(vec2 hatchParams, vec2 coord, vec4 fragColor, vec3 hatchTintColor, float hatchTintIntensity ) {\n    float hatchSlope = hatchParams.x;\n    float hatchPeriod = hatchParams.y;\n    if (abs(hatchSlope) <= 1.0) {\n        float hatchPhase = coord.y - hatchSlope * coord.x;\n        float dist = abs(mod((hatchPhase), (hatchPeriod)));\n        if (dist < 1.0) {\n            fragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);\n        }\n    } else {\n        float hatchPhase = - coord.y / hatchSlope + coord.x;\n        float dist = abs(mod((hatchPhase), (hatchPeriod)));\n        if (dist < 1.0) {\n            fragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);\n        }\n    }\n    return fragColor;\n}\n#endif\n"},function(e,t){e.exports="\nuniform float envRotationSin;\nuniform float envRotationCos;\nvec3 adjustLookupVector(in vec3 lookup) {\n    return vec3(\n            envRotationCos * lookup.x - envRotationSin * lookup.z,\n            lookup.y,\n            envRotationSin * lookup.x + envRotationCos * lookup.z);\n}\nvec3 RGBMDecode(in vec4 vRGBM, in float exposure) {\n    vec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);\n    ret *= ret;\n    ret *= exposure;\n    return ret;\n}\nvec3 GammaDecode(in vec4 vRGBA, in float exposure) {\n    return vRGBA.xyz * vRGBA.xyz * exposure;\n}\nvec3 sampleIrradianceMap(vec3 dirWorld, samplerCube irrMap, float exposure) {\n    vec4 cubeColor4 = textureCube(irrMap, adjustLookupVector(dirWorld));\n#ifdef IRR_GAMMA\n    vec3 indirectDiffuse = GammaDecode(cubeColor4, exposure);\n#elif defined(IRR_RGBM)\n    vec3 indirectDiffuse = RGBMDecode(cubeColor4, exposure);\n#else\n    vec3 indirectDiffuse = cubeColor4.xyz;\n#ifdef GAMMA_INPUT\n    indirectDiffuse.xyz *= indirectDiffuse.xyz;\n#endif\n#endif\n    return indirectDiffuse;\n}\n"},function(e,t){e.exports="#ifdef USE_VERTEX_ID\nattribute vec3 id;\nvarying   vec3 vId;\n#endif\n"},function(e,t){e.exports="\n#ifdef USE_VERTEX_ID\nvId = id;\n#endif\n"},function(e,t){e.exports="#if defined(MRT_NORMALS) || defined(MRT_ID_BUFFER)\nvarying highp float depth;\n#define gl_FragColor gl_FragData[0]\n#endif\n#if defined(MRT_ID_BUFFER) || defined(ID_COLOR)\n#ifdef USE_VERTEX_ID\nvarying vec3 vId;\n#else\nuniform vec3 dbId;\n#endif\n#endif\n#if defined(MRT_ID_BUFFER) || defined(MODEL_COLOR)\nuniform vec3 modelId;\n#endif\n"},function(e,t){e.exports="\n#if defined(USE_VERTEX_ID) && (defined(MRT_ID_BUFFER) || defined(ID_COLOR))\nvec3 dbId = vId;\n#endif\n#ifdef MRT_ID_BUFFER\n#ifdef MRT_NORMALS\nconst int index = 2;\n#else\nconst int index = 1;\n#endif\n#ifndef ENABLE_ID_DISCARD\nconst float writeId = 1.0;\n#endif\ngl_FragData[index] = vec4(dbId.rgb, writeId);\n#ifdef MODEL_COLOR\ngl_FragData[index+1] = vec4(modelId.rgb, writeId);\n#endif\n#elif defined(ID_COLOR)\n#ifdef ENABLE_ID_DISCARD\nif (writeId==0.0) {\n    discard;\n}\n#endif\ngl_FragColor = vec4(dbId.rgb, 1.0);\n#elif defined(MODEL_COLOR)\n#ifdef ENABLE_ID_DISCARD\nif (writeId==0.0) {\n    discard;\n}\n#endif\ngl_FragColor = vec4(modelId.rgb, 1.0);\n#endif\n"},function(e,t){e.exports="#ifdef HATCH_PATTERN\ngl_FragColor = calculateHatchPattern(hatchParams, gl_FragCoord.xy, gl_FragColor, hatchTintColor, hatchTintIntensity);\n#endif\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\ngl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif\n#ifdef MRT_NORMALS\ngl_FragData[1] = vec4(geomNormal.x, geomNormal.y, depth, gl_FragColor.a < 1.0 ? 0.0 : 1.0);\n#endif\n#include<id_frag>\n"},function(e,t){e.exports="uniform vec4 themingColor;\n"},function(e,t){e.exports="gl_FragColor.rgb = mix(gl_FragColor.rgb, themingColor.rgb, themingColor.a);\n"},function(e,t){e.exports="\n#ifdef USE_INSTANCING\nattribute vec3 instOffset;\nattribute vec4 instRotation;\nattribute vec3 instScaling;\nvec3 applyQuaternion(vec3 p, vec4 q) {\n    return p + 2.0 * cross(q.xyz, cross(q.xyz, p) + q.w * p);\n}\nvec3 getInstancePos(vec3 pos) {\n    return instOffset + applyQuaternion(instScaling * pos, instRotation);\n}\nvec3 getInstanceNormal(vec3 normal) {\n    return applyQuaternion(normal/instScaling, instRotation);\n}\n#else\nvec3 getInstancePos(vec3 pos)       { return pos;    }\nvec3 getInstanceNormal(vec3 normal) { return normal; }\n#endif\n"},function(e,t){e.exports="\nuniform float shadowESMConstant;\nuniform float shadowMapRangeMin;\nuniform float shadowMapRangeSize;\n"},function(e,t){e.exports="\n#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord;\nuniform mat4 shadowMatrix;\n#endif\n"},function(e,t){e.exports="\n#ifdef USE_SHADOWMAP\n{\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vShadowCoord = shadowMatrix * worldPosition;\n}\n#endif\n"},function(e,t){e.exports="\n#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap;\nuniform vec2      shadowMapSize;\nuniform float     shadowDarkness;\nuniform float     shadowBias;\nuniform vec3      shadowLightDir;\nvarying vec4 vShadowCoord;\n#include<shadowmap_decl_common>\nfloat getShadowValue() {\n    float fDepth;\n    vec3 shadowColor = vec3( 1.0 );\n    vec3 shadowCoord = vShadowCoord.xyz / vShadowCoord.w;\n    shadowCoord.xyz = 0.5 * (shadowCoord.xyz + vec3(1.0, 1.0, 1.0));\n    bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n    bool inFrustum = all( inFrustumVec );\n    float shadowValue = 1.0;\n    if (inFrustum) {\n        shadowCoord.z = min(0.999, shadowCoord.z);\n        shadowCoord.z -= shadowBias;\n#ifdef USE_HARD_SHADOWS\n        vec4 rgbaDepth = texture2D( shadowMap, shadowCoord.xy );\n        float fDepth = rgbaDepth.r;\n        if ( fDepth < shadowCoord.z ) {\n            shadowValue = 1.0 - shadowDarkness;\n        }\n#else\n        vec4 rgbaDepth = texture2D( shadowMap, shadowCoord.xy );\n        float shadowMapValue = rgbaDepth.r;\n        shadowValue = exp(-shadowESMConstant * shadowCoord.z) * shadowMapValue;\n        shadowValue = min(shadowValue, 1.0);\n        shadowValue = mix(1.0 - shadowDarkness, 1.0, shadowValue);\n#endif\n    }\n    return shadowValue;\n}\n#else\nfloat getShadowValue() { return 1.0; }\n#endif\nvec3 applyEnvShadow(vec3 colorWithoutShadow, vec3 worldNormal) {\n#if defined(USE_SHADOWMAP)\n    float dp  = dot(shadowLightDir, worldNormal);\n    float dpValue = (dp + 1.0) / 2.0;\n    dpValue = min(1.0, dpValue * 1.5);\n    float sv = getShadowValue();\n    vec3 result = colorWithoutShadow * min(sv, dpValue);\n    return result;\n#else\n    return colorWithoutShadow;\n#endif\n}\n"},function(e,t){e.exports="float averageOfFloat3(in vec3 value) { \n    const float oneThird = 1.0 / 3.0; \n    return dot(value, vec3(oneThird, oneThird, oneThird)); \n} \n"},function(e,t){e.exports="\n#define TAU     6.28318530718\n#define PI      3.14159265358979\n#define HALF_PI 1.57079632679\n#define PI_0_5  HALF_PI\n#define PI_1_5  4.71238898038\n#define ENABLE_ID_DISCARD\n#define VBB_GT_TRIANGLE_INDEXED  0.0\n#define VBB_GT_LINE_SEGMENT      1.0\n#define VBB_GT_ARC_CIRCULAR      2.0\n#define VBB_GT_ARC_ELLIPTICAL    3.0\n#define VBB_GT_TEX_QUAD          4.0\n#define VBB_GT_ONE_TRIANGLE      5.0\n#define VBB_INSTANCED_FLAG   0.0\n#define VBB_SEG_START_RIGHT  0.0\n#define VBB_SEG_START_LEFT   1.0\n#define VBB_SEG_END_RIGHT    2.0\n#define VBB_SEG_END_LEFT     3.0\nvarying vec4 fsColor;\nvarying vec4 dbId;\nvarying vec2 fsOffsetDirection;\nvarying vec4 fsMultipurpose;\nvarying float fsHalfWidth;\nvarying vec2 fsVpTC;\nvarying float fsGhosting;\n"},function(e,t){e.exports="#if defined( PRISMWOOD )\n#define ONE 0.00390625\nfloat GetIndexedValue(vec4 array, int index)\n{\n    if (index == 0)\n        return array[0];\n    else if (index == 1)\n        return array[1];\n    else if (index == 2)\n        return array[2];\n    else if (index == 3)\n        return array[3];\n    else\n        return 0.0;\n}\nint GetIndexedValue(ivec2 array, int index)\n{\n    if (index == 0)\n        return array[0];\n    else if (index == 1)\n        return array[1];\n    else\n        return 0;\n}\n#if defined( USE_WOOD_CURLY_DISTORTION_MAP )\nfloat SampleCurlyPattern(vec2 uv)\n{\n    vec2 uv_wood_curly_distortion_map = (wood_curly_distortion_map_texMatrix * vec3(uv, 1.0)).xy;\n    WOOD_CURLY_DISTORTION_CLAMP_TEST;\n    vec3 curlyDistortion = texture2D(wood_curly_distortion_map, uv_wood_curly_distortion_map).xyz;\n    if(wood_curly_distortion_map_invert) curlyDistortion = vec3(1.0) - curlyDistortion;\n    return curlyDistortion.r;\n}\nvec3 DistortCurly(vec3 p)\n{\n    if (!wood_curly_distortion_enable) return p;\n    float r = length(p.xy);\n    if (r < 0.00001) return p;\n    const float INV_ANGLE_INTERVAL = 1.27323954;\n    const float NUM_INTERVAL = 8.0;\n    float theta = atan(p.y, p.x);\n    if (theta < 0.0)\n        theta += PI2;\n    float intIdx = theta * INV_ANGLE_INTERVAL;\n    int idx0 = int(mod(floor(intIdx), NUM_INTERVAL));\n    int idx1 = int(mod(ceil(intIdx), NUM_INTERVAL));\n    const vec4 HASH_TABLE1 = vec4(0.450572,0.114598, 0.886043, 0.315119);\n    const vec4 HASH_TABLE2 = vec4(0.216133,0.306264, 0.685616, 0.317907);\n    float offset0 = idx0 < 4 ? GetIndexedValue(HASH_TABLE1, idx0) : GetIndexedValue(HASH_TABLE2, idx0-4);\n    float offset1 = idx1 < 4 ? GetIndexedValue(HASH_TABLE1, idx1) : GetIndexedValue(HASH_TABLE2, idx1-4);\n    const float maxOffset = 100.0;\n    offset0 = (offset0 - 0.5) * maxOffset;\n    offset1 = (offset1 - 0.5) * maxOffset;\n    vec2 uv0 = vec2(p.z + offset0, r);\n    float shiftWeight0 =  SampleCurlyPattern(uv0);\n    vec2 uv1 = vec2(p.z + offset1, r);\n    float shiftWeight1 =  SampleCurlyPattern(uv1);\n    float interpWeight = fract(intIdx);\n    float shiftWeight = mix(shiftWeight0, shiftWeight1, interpWeight);\n    const float INV_MIN_RADIUS = 2.0;\n    float shiftWeightAdjust = smoothstep(0.0, 1.0, r * INV_MIN_RADIUS);\n    r -= wood_curly_distortion_scale * (shiftWeight * shiftWeightAdjust);\n    float thetaNew = atan(p.y, p.x);\n    vec3 pNew = p;\n    pNew.x = r * cos(thetaNew);\n    pNew.y = r * sin(thetaNew);\n    return pNew;\n}\n#endif\nvec3 un2sn(vec3 range)\n{\n    return range * 2.0 - 1.0;\n}\nfloat inoise(vec3 p)\n{\n    vec3 modp = mod(floor(p), 256.0);\n    modp.xy = modp.xy * ONE;\n    vec4 AA = texture2D(perm2DMap, vec2(modp.x, modp.y), 0.0) * 255.0;\n    AA = AA + modp.z;\n    AA = mod(floor(AA), 256.0);\n    AA *= ONE;\n    vec3 gradx1 = un2sn(texture2D(permGradMap,vec2(AA.x,0.0),0.0).xyz);\n    vec3 grady1 = un2sn(texture2D(permGradMap,vec2(AA.y,0.0),0.0).xyz);\n    vec3 gradz1 = un2sn(texture2D(permGradMap,vec2(AA.z,0.0),0.0).xyz);\n    vec3 gradw1 = un2sn(texture2D(permGradMap,vec2(AA.w,0.0),0.0).xyz);\n    vec3 gradx2 = un2sn(texture2D(permGradMap,vec2(AA.x + ONE,0.0),0.0).xyz);\n    vec3 grady2 = un2sn(texture2D(permGradMap,vec2(AA.y + ONE,0.0),0.0).xyz);\n    vec3 gradz2 = un2sn(texture2D(permGradMap,vec2(AA.z + ONE,0.0),0.0).xyz);\n    vec3 gradw2 = un2sn(texture2D(permGradMap,vec2(AA.w + ONE,0.0),0.0).xyz);\n    p -= floor(p);\n    vec3 fadep = p * p * p * (p * (p * 6.0 - 15.0) + 10.0);\n    return mix( mix( mix( dot(gradx1, p ),\n                          dot(gradz1, p + vec3(-1.0, 0.0, 0.0)), fadep.x),\n                     mix( dot(grady1, p + vec3(0.0, -1.0, 0.0)),\n                          dot(gradw1, p + vec3(-1.0, -1.0, 0.0)), fadep.x), fadep.y),\n                mix( mix( dot(gradx2, p + vec3(0.0, 0.0, -1.0)),\n                          dot(gradz2, p + vec3(-1.0, 0.0, -1.0)), fadep.x),\n                     mix( dot(grady2, p + vec3(0.0, -1.0, -1.0)),\n                          dot(gradw2, p + vec3(-1.0, -1.0, -1.0)), fadep.x), fadep.y), fadep.z);\n}\nfloat inoise(float p)\n{\n    float modp = mod(floor(p), 256.0);\n    modp = (modp + 256.0) * ONE;\n    float permx = texture2D(permutationMap, vec2(modp, 0.0), 0.0).r;\n    float gradx = texture2D(gradientMap, vec2(permx, 0.0), 0.0).r*2.0-1.0;\n    float permy = texture2D(permutationMap, vec2(modp + ONE, 0.0), 0.0).r;\n    float grady = texture2D(gradientMap, vec2(permy, 0.0), 0.0).r*2.0-1.0;\n    p -= floor(p);\n    float fadep = p * p * p * (p * (p * 6.0 - 15.0) + 10.0);\n    return mix(gradx * p, grady * (p - 1.0), fadep);\n}\nfloat multiband_inoise(vec3 p, int bands, vec4 w, vec4 f)\n{\n    float noise = 0.0;\n    for(int i = 0; i < 4; ++i)\n    {\n        if (i >= bands) break;\n        noise += GetIndexedValue(w, i) * inoise(p * GetIndexedValue(f, i));\n    }\n    return noise;\n}\nfloat multiband_inoise(float p, int bands, vec4 w, vec4 f)\n{\n    float noise = 0.0;\n    for(int i = 0; i < 4; ++i)\n    {\n        if (i >= bands) break;\n        noise += GetIndexedValue(w, i) * inoise(p * GetIndexedValue(f, i));\n    }\n    return noise;\n}\nvec3 Distort3DCosineRadialDir(vec3 p)\n{\n    float radius = length(p.xy);\n    if (radius < 0.00001) return p;\n    vec2 theta = p.xy / radius;\n    float radiusShift = 0.0;\n    for (int i = 0; i < 4; ++i)\n    {\n        if (i >= wood_fiber_cosine_bands) break;\n        radiusShift += GetIndexedValue(wood_fiber_cosine_weights, i) * cos(p.z * RECIPROCAL_PI2 * GetIndexedValue(wood_fiber_cosine_frequencies, i));\n    }\n    const float MIN_RADIUS = 1.5;\n    float weight = clamp(radius / MIN_RADIUS, 0.0, 1.0);\n    if(weight >= 0.5)\n        weight = weight * weight * (3.0 - (weight + weight));\n    p.xy += theta * radiusShift * weight;\n    return p;\n}\nvec3 Distort3DPerlin(vec3 p)\n{\n    vec3 pAniso = vec3(p.xy, p.z * wood_fiber_perlin_scale_z);\n    p.xy += multiband_inoise(pAniso, wood_fiber_perlin_bands, wood_fiber_perlin_weights, wood_fiber_perlin_frequencies);\n    return p;\n}\nvec3 Distort(vec3 p)\n{\n    if(wood_fiber_cosine_enable)\n        p = Distort3DCosineRadialDir(p);\n    if(wood_fiber_perlin_enable)\n        p = Distort3DPerlin(p);\n    return p;\n}\nfloat DistortRadiusLength(float radiusLength)\n{\n    radiusLength += multiband_inoise(radiusLength, wood_growth_perlin_bands, wood_growth_perlin_weights, wood_growth_perlin_frequencies);\n    if (radiusLength < 0.0) radiusLength = 0.0;\n    return radiusLength;\n}\nfloat ComputeEarlyWoodRatio(float radiusLength)\n{\n    float fraction = mod(radiusLength, wood_ring_thickness) / wood_ring_thickness;\n    if (fraction <= wood_ring_fraction.y)\n       return 1.0;\n    else if(fraction <= wood_ring_fraction.x)\n       return (1.0 - (fraction - wood_ring_fraction.y) / wood_fall_rise.x);\n    else if(fraction <= wood_ring_fraction.w)\n       return 0.0;\n    else\n       return ((fraction - wood_ring_fraction.w) / wood_fall_rise.y);\n}\nvec3 DistortEarlyColor(vec3 earlyColor, float radiusLength)\n{\n    float expValue = 1.0 + multiband_inoise(radiusLength,wood_earlycolor_perlin_bands,wood_earlycolor_perlin_weights,wood_earlycolor_perlin_frequencies);\n    earlyColor = pow(abs(earlyColor), vec3(expValue));\n    return earlyColor;\n}\nvec3 DistortLateColor(vec3 lateColor, float radiusLength)\n{\n    float expValue = 1.0 + multiband_inoise(radiusLength,wood_latecolor_perlin_bands,wood_latecolor_perlin_weights,wood_latecolor_perlin_frequencies);\n    lateColor = pow(abs(lateColor), vec3(expValue));\n    return lateColor;\n}\nvec3 DistortDiffuseColor(vec3 diffAlbedo, vec3 p)\n{\n    p.z *= wood_diffuse_perlin_scale_z;\n    float expValue = 1.0 + multiband_inoise(p, wood_diffuse_perlin_bands, wood_diffuse_perlin_weights, wood_diffuse_perlin_frequencies);\n    diffAlbedo = pow(abs(diffAlbedo), vec3(expValue));\n    return diffAlbedo;\n}\nfloat LayerRoughnessVar(float roughness, float earlyWoodRatio)\n{\n    return earlyWoodRatio * wood_groove_roughness + (1.0 - earlyWoodRatio) * roughness;\n}\nfloat hashword(vec2 k)\n{\n    k = mod(k, vec2(256.0)) * ONE;\n    float a = texture2D(permutationMap, vec2(k.x, 0.0)).x + k.y ;\n    a = texture2D(permutationMap, vec2(a, 0.0)).x ;\n    return a*255.0;\n}\nfloat wyvillsq(float rsq)\n{\n    if (rsq >= 1.0) return 0.0;\n    float tmp = 1.0 - rsq;\n    return tmp*tmp*tmp;\n}\nfloat Weight2DNeighborImpulses(vec3 p, float woodWeight)\n{\n    if(woodWeight <= 0.0) return 0.0;\n    float poreRadius = wood_pore_radius * woodWeight;\n    vec2 left = floor((p.xy - poreRadius) / wood_pore_cell_dim);\n    vec2 right = floor((p.xy + poreRadius) / wood_pore_cell_dim);\n    float weight = 0.0;\n    float invRsq = 1.0 / (poreRadius * poreRadius);\n    const float norm =  1.0 / 15.0;\n    for (int j = 0; j <= 4; j++)\n    {\n        if (j > int(right.y - left.y)) continue;\n        for (int i = 0; i <= 4; i++)\n        {\n            if (i > int(right.x - left.x)) continue;\n            vec2 pij = vec2(float(i) + left.x,float(j) + left.y);\n            float hRNum = hashword(pij);\n            float impPosX = mod(hRNum, 16.0) * norm;\n            float impPosY = floor(hRNum / 16.0) * norm;\n            impPosX = (pij.x + impPosX)* wood_pore_cell_dim;\n            impPosY = (pij.y + impPosY)* wood_pore_cell_dim;\n            float dsq = (p.x - impPosX) * (p.x - impPosX) + (p.y - impPosY) * (p.y - impPosY);\n            weight += wyvillsq(dsq * invRsq);\n        }\n    }\n    return weight;\n}\nfloat Weight3DRayImpulses(vec3 p)\n{\n    int segIdx = int(floor(p.z / wood_ray_seg_length_z));\n    float factor = p.z / wood_ray_seg_length_z - float(segIdx);\n    int segIdx1 = segIdx - 1;\n    if ( factor > 0.5 )\n        segIdx1 = segIdx + 1;\n    float theta = atan(p.y, p.x);\n    float sliceIdx = floor(((theta + PI) * RECIPROCAL_PI2) * wood_ray_num_slices);\n    if ( sliceIdx == wood_ray_num_slices)\n        sliceIdx-=1.0;\n    ivec2 arrSegs = ivec2(segIdx, segIdx1);\n    float weight = 0.0;\n    const float norm =  1.0 / 15.0;\n    float radialOffset = 5.0;\n    float radialLength = length(p.xy);\n    for (int seg = 0; seg < 2; seg++)\n    {\n        float hRNum = hashword(vec2(sliceIdx, GetIndexedValue(arrSegs, seg)));\n        float rn1 = mod(hRNum,16.0) * norm;\n        if (radialLength < radialOffset * rn1)\n            continue;\n        float rayTheta = rn1;\n        rayTheta = ( ( sliceIdx + rayTheta ) / wood_ray_num_slices ) * ( 2.0 * PI ) - PI;\n        float rayPosZ = (hRNum/16.0)* norm;\n        rayPosZ = ( float(GetIndexedValue(arrSegs, seg)) + rayPosZ ) * wood_ray_seg_length_z;\n        vec3 pt1 = vec3(0.0);\n        vec3 pt2 = vec3(cos(rayTheta), sin(rayTheta), 0.0);\n        vec3 p1 = p;\n        p1.z -= rayPosZ;\n        p1.z /=  wood_ray_ellipse_z2x;\n        vec3 v1 = pt2 - pt1;\n        vec3 v2 = pt1 - p1;\n        v2 = cross(v1, v2);\n        float dist = length(v2) / length(v1);\n        float invRsq = 1.0 / ( wood_ray_ellipse_radius_x * wood_ray_ellipse_radius_x);\n        weight += wyvillsq( (dist * dist) * invRsq );\n    }\n    return weight;\n}\nvec3 DarkenColorWithPores(vec3 p, vec3 diffColor, float woodWeight)\n{\n    float poresWeight = Weight2DNeighborImpulses(p, woodWeight);\n    float a = wood_pore_color_power - 1.0;\n    float b = 1.0;\n    float y = a * poresWeight + b;\n    return pow(abs(diffColor), vec3(y));\n}\nvec3 DarkenColorWithRays(vec3 p, vec3 diffColor)\n{\n    float raysWeight = Weight3DRayImpulses(p);\n    float a = wood_ray_color_power - 1.0;\n    float b = 1.0;\n    float y = a * raysWeight + b;\n    return pow(abs(diffColor), vec3(y));\n}\nfloat ComputeWoodWeight(float earlyWoodRatio)\n{\n    float woodWeight = 0.0;\n    if (wood_pore_type == 0)\n        woodWeight = 1.0;\n    else if (wood_pore_type == 1)\n        woodWeight = earlyWoodRatio;\n    else if (wood_pore_type == 2)\n        woodWeight = 1.0 - earlyWoodRatio;\n    else\n        woodWeight = -1.0;\n    return woodWeight;\n}\n#if defined( PRISMWOODBUMP )\nfloat ComputeEarlyWoodRatioAA(float radiusLength, float invUnitExt)\n{\n    float transPixels = min(wood_fall_rise.x, wood_fall_rise.y) * wood_ring_thickness * invUnitExt;\n    float samplesf = clamp(4.0 / transPixels, 1.0, 4.0);\n    int samples = int(samplesf);\n    float inverseSamples = 1.0 / float(samples);\n    vec2 rdelta = vec2(dFdx(radiusLength), dFdy(radiusLength)) * inverseSamples;\n    float earlywoodRatio = 0.0;\n    for (int i = 0; i < 4; ++i)\n    {\n        if (i >= samples) break;\n        for (int j = 0; j < 4; ++j)\n        {\n            if (j >= samples) break;\n            float r = radiusLength + dot(vec2(i, j), rdelta);\n            earlywoodRatio += ComputeEarlyWoodRatio(r);\n        }\n    }\n    return earlywoodRatio * (inverseSamples * inverseSamples);\n}\nfloat LatewoodDepthVariation(float invUnitExt)\n{\n    float transPixels = min(wood_fall_rise.x, wood_fall_rise.y) * wood_ring_thickness * invUnitExt;\n    return clamp(transPixels * 0.5, 0.0, 1.0);\n}\nfloat LatewoodHeightVariation(float earlyWoodRatio, float latewoodBumpDepth,\n                              float depthVar)\n{\n    return ( 1.0 - earlyWoodRatio ) * latewoodBumpDepth * depthVar;\n}\nfloat PoreDepthVariation(float woodWeight, float invUnitExt)\n{\n    float porePixels = woodWeight * wood_pore_radius * invUnitExt;\n    return clamp(porePixels, 0.0, 1.0);\n}\nfloat PoreHeightVariation(float earlyWoodRatio, float poresWeight, float poreDepth,\n                          float depthVar)\n{\n    return poresWeight * (-1.0 * poreDepth) * depthVar;\n}\nvoid ComputeTangents(vec3 normal, out vec3 u, out vec3 v)\n{\n    float scale = normal.z < 0.0 ? -1.0 : 1.0;\n    vec3 temp = scale * normal;\n    float e    = temp.z;\n    float h    = 1.0/(1.0 + e);\n    float hvx  = h   *  temp.y;\n    float hvxy = hvx * -temp.x;\n    u = vec3(e + hvx * temp.y, hvxy,                -temp.x);\n    v = vec3(hvxy,             e + h * temp.x * temp.x, -temp.y);\n    u *= scale;\n    v *= scale;\n}\nvec3 WoodBumpHeight(float heightLeft, float heightRight, float heightBack, float heightFront)\n{\n    const float epsilon = 0.001;\n    float heightDeltaX = heightRight - heightLeft;\n    vec3 Tu = vec3(2.0 * epsilon, 0.0, heightDeltaX);\n    float heightDeltaY = heightFront - heightBack;\n    vec3 Tv = vec3(0.0, 2.0 * epsilon, heightDeltaY);\n    return cross(Tu, Tv);\n}\nvec3 SelectNormal(vec3 N, vec3 bumpN, vec3 V)\n{\n    float bumpNdotV = dot(bumpN, V);\n    if(bumpNdotV > 0.0)\n        return bumpN;\n    else return N;\n}\nfloat MinInverseUnitExtent(vec3 p)\n{\n    return 1.0 / max(max(length(dFdx(p.xy)), length(dFdy(p.xy))), 0.000001);\n}\nfloat HeightVariation(vec3 pos)\n{\n    vec3 p = Distort(pos);\n    float radiusLength = length(p.xy);\n    if (wood_growth_perlin_enable)\n        radiusLength = DistortRadiusLength(radiusLength);\n    float invUnitExt = MinInverseUnitExtent(p);\n    float earlyWoodRatio = ComputeEarlyWoodRatioAA(radiusLength, invUnitExt);\n    float woodWeight = ComputeWoodWeight(earlyWoodRatio);\n    float poresWeight = Weight2DNeighborImpulses(p, woodWeight);\n    float depthVar = PoreDepthVariation(woodWeight, invUnitExt);\n    float poreHeightVariation = -1.0 * poresWeight * wood_pore_depth * depthVar;\n    float latewoodHeightVariation = 0.0;\n    if (wood_use_latewood_bump)\n    {\n        float latewoodDepthVar = LatewoodDepthVariation(invUnitExt);\n        latewoodHeightVariation = (1.0 - earlyWoodRatio) * wood_latewood_bump_depth * latewoodDepthVar;\n    }\n    float sumHeightVariation = poreHeightVariation + latewoodHeightVariation;\n    return sumHeightVariation;\n}\n#endif\nvec3 NoiseWood(vec3 p, inout float roughness)\n{\n    p = Distort(p);\n    float radiusLength = length(p.xy);\n    if(wood_growth_perlin_enable)\n        radiusLength = DistortRadiusLength(radiusLength);\n#if defined( PRISMWOODBUMP )\n    float invUnitExt = MinInverseUnitExtent( p );\n    float earlyWoodRatio = ComputeEarlyWoodRatioAA(radiusLength, invUnitExt);\n#else\n    float earlyWoodRatio = ComputeEarlyWoodRatio(radiusLength);\n#endif\n    vec3 earlyColor = wood_early_color;\n    if (wood_earlycolor_perlin_enable)\n        earlyColor = DistortEarlyColor(earlyColor, radiusLength);\n    vec3 lateColor;\n    if (wood_use_manual_late_color)\n        lateColor = wood_manual_late_color;\n    else\n        lateColor = pow(abs(earlyColor), vec3(wood_late_color_power));\n    if(wood_latecolor_perlin_enable)\n        lateColor = DistortLateColor(lateColor, radiusLength);\n    vec3 diffAlbedo = earlyWoodRatio * earlyColor + (1.0 - earlyWoodRatio) * lateColor;\n    if(wood_diffuse_perlin_enable)\n        diffAlbedo = DistortDiffuseColor(diffAlbedo, p);\n    if (wood_use_pores)\n    {\n        float woodWeight = ComputeWoodWeight(earlyWoodRatio);\n        diffAlbedo = DarkenColorWithPores(p, diffAlbedo, woodWeight);\n    }\n    if (wood_use_rays)\n        diffAlbedo = DarkenColorWithRays(p, diffAlbedo);\n    if(wood_use_groove_roughness)\n        roughness = LayerRoughnessVar(roughness, earlyWoodRatio);\n    return clamp(diffAlbedo, vec3(0.0), vec3(1.0));\n}\n#if defined(PRISMWOODBUMP)\nvoid getFinalWoodContext(\n    inout vec3 N, vec3 V, inout vec3 Tu, inout vec3 Tv, vec3 p,\n    vec3 geoNormal, vec3 tNormal, mat3 normalMatrix\n) {\n    vec3 offsetTuLeft = p - 0.001 * Tu;\n    vec3 offsetTuRight = p + 0.001 * Tu;\n    vec3 offsetTvLeft = p - 0.001 * Tv;\n    vec3 offsetTvRight = p + 0.001 * Tv;\n    float heightVariationTuLeft = HeightVariation(offsetTuLeft);\n    float heightVariationTuRight = HeightVariation(offsetTuRight);\n    float heightVariationTvLeft = HeightVariation(offsetTvLeft);\n    float heightVariationTvRight = HeightVariation(offsetTvRight);\n    vec3 bumpHeight = WoodBumpHeight(heightVariationTuLeft, heightVariationTuRight, heightVariationTvLeft, heightVariationTvRight);\n    vec3 newNormal = normalize(bumpHeight.x * Tu + bumpHeight.y * Tv + bumpHeight.z * vtNormal);\n    vec3 newNormalView = normalize(vNormalMatrix * newNormal);\n    vec3 selectedNormal = SelectNormal(geoNormal, newNormalView, V);\n    ComputeTangents(selectedNormal, Tu, Tv);\n    Tu = normalize(Tu);\n    Tv = normalize(Tv);\n    N = faceforward(selectedNormal, -V, selectedNormal);\n}\n#endif\n#endif\n"},function(e,t){e.exports="\nvec3 TransmitAdjust(vec3 transmission, vec3 f0) \n{ \n   vec3 limit = max(1.0 - f0, 0.00001); \n   return clamp(transmission, vec3(0.0, 0.0, 0.0), limit) / limit; \n} \nfloat ColorToIlluminance(in vec3 color) \n{ \n   const vec3 rgb2grey = vec3(0.299, 0.587, 0.114); \n   float illuminance = dot(rgb2grey, color); \n   return illuminance; \n} \nvoid applyPrismGlazingOpacity(\n    inout vec4 color,\n    vec3 transmissionF,\n    float transmissionAlpha,\n    float NdotV,\n    float glazingIlluminace) \n{\n    const float third = 1.0/3.0; \n    float transSurface = exp(-(transmissionAlpha + (transmissionAlpha < 0.0025 ? 0.0 : 0.25)) * NdotV * PI); \n    float opacity = 1.0- dot((1.0 - transmissionF), vec3(third,third,third)) * transSurface * glazingIlluminace; \n    opacity = clamp(opacity, 0.01, 0.99);\n    color.a *= opacity;\n} \n"},function(e,t){e.exports="void applyPrismTransparency(\n    inout vec4 color,\n    vec3 transparentColor,\n    float transparentIor\n) {\n    float fsLevel = max(max(color.r, color.g), color.b);\n    color = vec4(color.rgb/fsLevel, fsLevel);\n    float transLevel = min(min(transparentColor.r, transparentColor.g), transparentColor.b);\n    transLevel = min( (1.0 - surface_roughness), transLevel );\n    float transAlpha = (1.0 - transLevel) * 0.4 + surface_roughness * 0.55;\n    vec3 tr_g_color = sqrt(transparentColor);\n    vec4 transColor = vec4(0.5 * vec3(tr_g_color), transAlpha);\n    float strength = 1.0 - (1.0 - fsLevel) * (1.0 - fsLevel);\n    color = mix(transColor, color, strength);\n    color.a = max(color.a, 0.05);\n    if (transparentIor == 1.0 && tr_g_color == vec3(1.0)) {\n        color.a = 0.0;\n    }\n}"},function(e,t){e.exports="#if defined(USE_SURFACE_NORMAL_MAP) || defined( USE_LAYERED_NORMAL_MAP ) || defined( USE_TILING_NORMAL )\nvoid heightMapTransform(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    vec2 bumpScale,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (transform * vec3(uv, 1.0)).xy;\n    mat3 mtxTangent = mat3(T, B, N);\n    T = normalize(mtxTangent * (transform * vec3(1.0, 0.0, 0.0)));\n    B = normalize(mtxTangent * (transform * vec3(0.0, 1.0, 0.0)));\n    const float oneThird = 1.0 / 3.0;\n    vec3 avg = vec3(oneThird, oneThird, oneThird);\n    vec2 offset = fwidth(st);\n    float h0 = dot(texture2D(bumpTexture, st).xyz, avg);\n    float hx = dot(texture2D(bumpTexture, st + vec2(offset.x, 0.0)).xyz, avg);\n    float hy = dot(texture2D(bumpTexture, st + vec2(0.0, offset.y)).xyz, avg);\n    vec2 diff = vec2(h0 - hx, h0 - hy) / offset;\n    N = normalize(\n        N + (\n            diff.x * T * bumpScale.x +\n            diff.y * B * bumpScale.y\n        )\n    );\n}\nvoid normalMapTransform(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    vec2 bumpScale,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (transform * vec3(uv, 1.0)).xy;\n    vec3 mapN =  2.0 * texture2D(bumpTexture, st).xyz - 1.0;\n    mapN.xy *= bumpScale.x;\n    mapN.z *= bumpScale.y;\n    vec3 v = vec3(mapN.y, -mapN.x, 0.0);\n    float c = -mapN.z;\n    mat3 skewV = mat3(\n        0.0, v.z, -v.y,\n        -v.z, 0.0, v.x,\n        v.y, -v.x, 0.0\n    );\n    mat3 rot = mat3(1.0) + skewV + skewV*skewV * 1.0/(1.0-c);\n    N *= rot;\n    T *= rot;\n    B *= rot;\n}\n#endif\n"},function(e,t){e.exports="uniform float point_size;"},function(e,t){e.exports="gl_PointSize = point_size;"},function(e,t){e.exports="\n#ifdef WIDE_LINES\nattribute vec3 prev;\nattribute vec3 next;\nattribute float side;\nuniform vec2 view_size;\nvec2 to2d(vec4 i) {\n  return i.xy / i.w;\n}\n#endif\n"},function(e,t){e.exports="\n#ifdef WIDE_LINES\nvec4 mvpPosition = projectionMatrix * mvPosition; \nmat3 vectorMatrix = mat3(modelViewMatrix);\nvec2 _pos = to2d(mvpPosition) * view_size;\nvec2 _prev = to2d(projectionMatrix * vec4(mvPosition.xyz + vectorMatrix * (prev * 0.01), 1.0)) * view_size;\nvec2 _next = to2d(projectionMatrix * vec4(mvPosition.xyz - vectorMatrix * (next * 0.01), 1.0)) * view_size;\nvec2 dir1 = _pos - _next;\nvec2 dir2 = _prev - _pos;\ndir2 = (length(dir2) > 0.0000001) ? normalize(dir2) : vec2(0.0, 0.0);\ndir1 = (length(dir1) > 0.0000001) ? normalize(dir1) : dir2;\nvec2 dir_sharp = normalize(dir1 + dir2);\nvec2 dir = normalize(dir1 + dir_sharp);\nvec2 offset = vec2(-dir.y, dir.x);\nfloat len = 1.0 / cross(vec3(offset, 0), vec3(dir1, 0)).z;\noffset *= len;\noffset /= view_size;\noffset *= side;\noffset *= mvpPosition.w;\nmvpPosition.xy += offset;\ngl_Position = mvpPosition;\n#endif\n"},function(e,t){e.exports="vec3 rgb2hsv(vec3 color)\n{\n    float delta;\n    float colorMax, colorMin;\n    float h,s,v;\n    vec3 hsv;\n    colorMax = max(color.r,color.g);\n    colorMax = max(colorMax,color.b);\n    colorMin = min(color.r,color.g);\n    colorMin = min(colorMin,color.b);\n    v = colorMax;\n    if(colorMax != 0.0)\n    {\n        s = (colorMax - colorMin)/colorMax;\n    }\n    else\n    {\n        s = 0.0;\n    }\n    if(s != 0.0)\n    {\n        delta = colorMax-colorMin;\n        if (color.r == colorMax)\n        {\n            h = (color.g-color.b)/delta;\n        }\n        else if (color.g == colorMax)\n        {\n            h = 2.0 + (color.b-color.r) / delta;\n        }\n        else\n        {\n            h = 4.0 + (color.r-color.g)/delta;\n        }\n        h /= 6.0;\n        if( h < 0.0)\n        {\n            h +=1.0;\n        }\n    }\n    else\n    {\n        h = 0.0;\n    }\n    hsv = vec3(h,s,v);\n    return hsv;\n}\nvec3 hsv2rgb(vec3 hsv)\n{\n    vec3 color;\n    float f,p,q,t;\n    float h,s,v;\n    float i,hi;\n    {\n        h = hsv.x*6.0;\n        s = hsv.y;\n        v = hsv.z;\n        i = floor(h);\n        f = h-i;\n        p = v * (1.0 - s);\n        q = v * (1.0 - (s * f));\n        t = v * (1.0 - (s * (1.0 - f)));\n        float r,g,b;\n        if (i == 0.0)\n        {\n            r = v;\n            g = t;\n            b = p;\n        }\n        else if (i == 1.0)\n        {\n            r = q;\n            g = v;\n            b = p;\n        }\n        else if (i == 2.0)\n        {\n            r = p;\n            g = v;\n            b = t;\n        }\n        else if (i == 3.0)\n        {\n            r = p;\n            g = q;\n            b = v;\n        }\n        else if (i == 4.0)\n        {\n            r = t;\n            g = p;\n            b = v;\n        }\n        else\n        {\n            r = v;\n            g = p;\n            b = q;\n        }\n        color = vec3(r,g,b);\n    }\n    return color;\n}"},function(e,t){e.exports="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvarying vec2 vUvBump;\nuniform mat3 texMatrixBump;\n#endif\n#if defined( USE_ALPHAMAP )\nvarying vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#if defined( USE_ENVMAP )\n#if ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nuniform float refractionRatio;\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#ifdef MRT_NORMALS\nvarying float depth;\n#endif\n#include<pack_normals>\n#include<instancing_decl_vert>\n#include<id_decl_vert>\n#include<wide_lines_decl>\n#include<shadowmap_decl_vert>\nvoid main() {\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\n    vUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n    vUvBump = (texMatrixBump * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_ALPHAMAP )\n    vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\n    vColor = color * color;\n#else\n    vColor = color;\n#endif\n#endif\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n    vec3 transformedNormal = normalMatrix * objectNormal;\n#ifndef FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n#include<wide_lines_vert>\n    vViewPosition = -mvPosition.xyz;\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    if (projectionMatrix[3][3] == 0.0) {\n        gl_Position.z = log2(max(1.0e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + gl_Position.w;\n#else\n        gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n    } else {\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + vViewPosition.z;\n#else\n#endif\n    }\n#endif\n#ifdef MRT_NORMALS\n    depth = mvPosition.z;\n#endif\n#include<shadowmap_vert>\n#include<id_vert>\n}\n"},function(e,t){e.exports="uniform vec3 diffuse;\r\nuniform float opacity;\r\n\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\n\r\n#include<env_sample>\r\n\r\n#ifdef USE_COLOR\r\nvarying vec3 vColor;\r\n#endif\r\n\r\n#ifdef GAMMA_INPUT\r\nvec3 InputToLinear(vec3 c) {\r\n    return c * c;\r\n}\r\nfloat InputToLinear(float c) {\r\n    return c * c;\r\n}\r\n#else\r\nvec3 InputToLinear(vec3 c) {\r\n    return c;\r\n}\r\nfloat InputToLinear(float c) {\r\n    return c;\r\n}\r\n#endif\r\n\r\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\r\nvarying vec2 vUv;\r\n#endif\r\n\r\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\nvarying vec2 vUvBump;\r\n#endif\r\n\r\n#if defined( USE_ALPHAMAP )\r\nvarying vec2 vUvAlpha;\r\n#endif\r\n\r\n#ifdef USE_MAP\r\nuniform sampler2D map;\r\n#endif\r\n\r\n#if TONEMAP_OUTPUT > 0\r\nuniform float exposureBias;\r\n#include<tonemap>\r\n#endif\r\n\r\n#if defined(IRR_RGBM) || defined(ENV_RGBM) || defined(ENV_GAMMA) || defined(IRR_GAMMA)\r\nuniform float envMapExposure;\r\n#endif\r\n\r\n#ifdef USE_FOG\r\nuniform vec3 fogColor;\r\nuniform float fogNear;\r\nuniform float fogFar;\r\n#endif\r\n#include<id_decl_frag>\r\n#include<theming_decl_frag>\r\n#include<shadowmap_decl_frag>\r\n\r\n#ifdef USE_ENVMAP\r\n\r\nuniform float reflMipIndex;\r\n\r\nuniform float reflectivity;\r\nuniform samplerCube envMap;\r\n\r\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\n\r\nuniform float refractionRatio;\r\n\r\n#endif\r\n\r\nvec3 sampleReflection(vec3 dir, float mipIndex) {\r\n\r\n    vec3 adjDir = adjustLookupVector(dir);\r\n\r\n#ifdef ENV_GAMMA\r\n\r\n#ifdef HAVE_TEXTURE_LOD\r\n    vec4 envTexColor = textureCubeLodEXT( envMap, adjDir, mipIndex );\r\n#else\r\n\r\n\r\n    vec4 envTexColor = textureCube( envMap, adjDir, mipIndex );\r\n#endif\r\n\r\n    return GammaDecode(envTexColor, envMapExposure);\r\n\r\n#elif defined(ENV_RGBM)\r\n\r\n#ifdef HAVE_TEXTURE_LOD\r\n    vec4 envTexColor = textureCubeLodEXT( envMap, adjDir, mipIndex );\r\n#else\r\n\r\n\r\n    vec4 envTexColor = textureCube( envMap, adjDir, mipIndex );\r\n#endif\r\n\r\n    return RGBMDecode(envTexColor, envMapExposure);\r\n\r\n#else\r\n\r\n\r\n\r\n    vec4 envTexColor = textureCube( envMap, adjDir );\r\n    vec3 cubeColor = envTexColor.xyz;\r\n\r\n#ifdef GAMMA_INPUT\r\n    cubeColor *= cubeColor;\r\n#endif\r\n\r\n    return cubeColor;\r\n\r\n#endif\r\n\r\n}\r\n\r\n#endif\r\n\r\n\r\nuniform vec3 ambientLightColor;\r\n\r\n#if MAX_DIR_LIGHTS > 0\r\n\r\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\r\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\r\n\r\n#endif\r\n\r\n#if MAX_POINT_LIGHTS > 0\r\n\r\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\r\n\r\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\r\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\r\n\r\n#endif\r\n\r\n#if MAX_SPOT_LIGHTS > 0\r\n\r\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\r\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\r\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\r\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\r\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\r\n\r\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\r\n\r\n#endif\r\n\r\n#ifdef USE_IRRADIANCEMAP\r\nuniform samplerCube irradianceMap;\r\n#endif\r\n\r\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\r\nvarying highp vec3 vWorldPosition;\r\n#endif\r\n\r\nvarying highp vec3 vViewPosition;\r\n#ifndef FLAT_SHADED\r\nvarying highp vec3 vNormal;\r\n#endif\r\n\r\n#ifdef USE_BUMPMAP\r\n\r\nuniform sampler2D bumpMap;\r\nuniform float bumpScale;\r\n\r\n\r\n\r\n\r\n\r\n\r\nvec2 dHdxy_fwd() {\r\n\r\n    vec2 dSTdx = dFdx( vUvBump );\r\n    vec2 dSTdy = dFdy( vUvBump );\r\n\r\n    float Hll = bumpScale * GET_BUMPMAP(vUvBump).x;\r\n    float dBx = bumpScale * GET_BUMPMAP(vUvBump + dSTdx).x - Hll;\r\n    float dBy = bumpScale * GET_BUMPMAP(vUvBump + dSTdy).x - Hll;\r\n\r\n    return vec2( dBx, dBy );\r\n\r\n}\r\n\r\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\r\n\r\n    vec3 vSigmaX = dFdx( surf_pos );\r\n    vec3 vSigmaY = dFdy( surf_pos );\r\n    vec3 vN = surf_norm;\r\n\r\n    vec3 R1 = cross( vSigmaY, vN );\r\n    vec3 R2 = cross( vN, vSigmaX );\r\n\r\n    float fDet = dot( vSigmaX, R1 );\r\n\r\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\r\n    return normalize( abs( fDet ) * surf_norm - vGrad );\r\n\r\n}\r\n\r\n#endif\r\n\r\n\r\n#ifdef USE_NORMALMAP\r\n\r\nuniform sampler2D normalMap;\r\nuniform vec2 normalScale;\r\n\r\n\r\n\r\n\r\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\r\n\r\n    vec3 q0 = dFdx( eye_pos.xyz );\r\n    vec3 q1 = dFdy( eye_pos.xyz );\r\n    vec2 st0 = dFdx( vUvBump.st );\r\n    vec2 st1 = dFdy( vUvBump.st );\r\n\r\n    vec3 S = normalize(  q0 * st1.t - q1 * st0.t );\r\n    vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\r\n    vec3 N = normalize( surf_norm );\r\n\r\n    vec3 mapN = GET_NORMALMAP(vUvBump).xyz * 2.0 - 1.0;\r\n    mapN.xy = normalScale * mapN.xy;\r\n    mat3 tsn = mat3( S, T, N );\r\n    return normalize( tsn * mapN );\r\n\r\n}\r\n\r\n#endif\r\n\r\n\r\n#ifdef USE_SPECULARMAP\r\nuniform sampler2D specularMap;\r\n#endif\r\n\r\n#ifdef USE_ALPHAMAP\r\nuniform sampler2D alphaMap;\r\n#endif\r\n\r\n#include<hatch_pattern>\r\n\r\n#ifdef USE_LOGDEPTHBUF\r\nuniform float logDepthBufFC;\r\n#ifdef USE_LOGDEPTHBUF_EXT\r\n#extension GL_EXT_frag_depth : enable\r\nvarying highp float vFragDepth;\r\n#endif\r\n#endif\r\n\r\nvec3 Schlick_v3(vec3 v, float cosHV) {\r\n    float facing = max(1.0 - cosHV, 0.0);\r\n    return v + (1.0 - v) * pow(facing, 5.0);\r\n}\r\n\r\nfloat Schlick_f(float v, float cosHV) {\r\n    float facing = max(1.0 - cosHV, 0.0);\r\n    return v + ( 1.0 - v ) * pow(facing, 5.0);\r\n}\r\n\r\n#include<cutplanes>\r\n\r\nvoid main() {\r\n\r\n#if NUM_CUTPLANES > 0\r\n    checkCutPlanes(vWorldPosition);\r\n#endif\r\n\r\n    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );\r\n\r\n#ifdef USE_MAP\r\n    vec4 texelColor = GET_MAP(vUv);\r\n#ifdef MAP_INVERT\r\n    texelColor.xyz = 1.0-texelColor.xyz;\r\n#endif\r\n#ifdef GAMMA_INPUT\r\n    texelColor.xyz *= texelColor.xyz;\r\n#endif\r\n    gl_FragColor = gl_FragColor * texelColor;\r\n#endif\r\n\r\n#ifdef USE_ALPHAMAP\r\n    vec4 texelAlpha = GET_ALPHAMAP(vUvAlpha);\r\n    gl_FragColor.a *= texelAlpha.r;\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n    if ( gl_FragColor.a < ALPHATEST ) discard;\r\n#endif\r\n\r\n    float specularStrength;\r\n\r\n#ifdef USE_SPECULARMAP\r\n    vec4 texelSpecular = GET_SPECULARMAP(vUv);\r\n    specularStrength = texelSpecular.r;\r\n#else\r\n    specularStrength = 1.0;\r\n#endif\r\n\r\n#ifndef FLAT_SHADED\r\n    vec3 normal = normalize( vNormal );\r\n#ifdef DOUBLE_SIDED\r\n\r\n#endif\r\n#else\r\n    vec3 fdx = dFdx( vViewPosition );\r\n    vec3 fdy = dFdy( vViewPosition );\r\n    vec3 normal = normalize( cross( fdx, fdy ) );\r\n#endif\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    vec3 viewDirection;\r\n    if (projectionMatrix[3][3] == 0.0) {\r\n        viewDirection = normalize( vViewPosition );\r\n    } else {\r\n        viewDirection = vec3(0.0, 0.0, 1.0);\r\n    }\r\n    normal = faceforward(normal, -viewDirection, normal);\r\n\r\n    vec3 geomNormal = normal;\r\n\r\n#ifdef USE_NORMALMAP\r\n    normal = perturbNormal2Arb( -vViewPosition, normal );\r\n#elif defined( USE_BUMPMAP )\r\n    normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\r\n#endif\r\n\r\n    vec3 totalDiffuse = vec3( 0.0 );\r\n    vec3 totalSpecular = vec3( 0.0 );\r\n\r\n\r\n\r\n    float shininessB = shininess * 4.0;\r\n\r\n#if MAX_POINT_LIGHTS > 0\r\n\r\n    vec3 pointDiffuse  = vec3( 0.0 );\r\n    vec3 pointSpecular = vec3( 0.0 );\r\n\r\n    for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\r\n\r\n        vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\r\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\r\n\r\n        float lDistance = 1.0;\r\n        if ( pointLightDistance[ i ] > 0.0 )\r\n            lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\r\n\r\n        lVector = normalize( lVector );\r\n\r\n\r\n\r\n        float dotProduct = dot( normal, lVector );\r\n\r\n        float pointDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n\r\n        pointDiffuse  += InputToLinear(diffuse) * InputToLinear(pointLightColor[ i ]) * pointDiffuseWeight * lDistance;\r\n\r\n\r\n\r\n        vec3 pointHalfVector = normalize( lVector + viewDirection );\r\n        float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\r\n\r\n        float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininessB ), 0.0 );\r\n        float specularNormalization = shininessB * 0.125 + 0.25;\r\n        vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, pointHalfVector ) );\r\n        pointSpecular += schlick * InputToLinear(pointLightColor[ i ]) * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization ;\r\n\r\n    }\r\n\r\n    totalDiffuse += pointDiffuse;\r\n    totalSpecular += pointSpecular;\r\n\r\n#endif\r\n\r\n#if MAX_SPOT_LIGHTS > 0\r\n\r\n    vec3 spotDiffuse  = vec3( 0.0 );\r\n    vec3 spotSpecular = vec3( 0.0 );\r\n\r\n    for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\r\n\r\n        vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\r\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\r\n\r\n        float lDistance = 1.0;\r\n        if ( spotLightDistance[ i ] > 0.0 )\r\n            lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\r\n\r\n        lVector = normalize( lVector );\r\n\r\n        float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\r\n\r\n        if ( spotEffect > spotLightAngleCos[ i ] ) {\r\n\r\n            spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\r\n\r\n\r\n\r\n            float dotProduct = dot( normal, lVector );\r\n\r\n            float spotDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n            spotDiffuse += InputToLinear(diffuse) * InputToLinear(spotLightColor[ i ]) * spotDiffuseWeight * lDistance * spotEffect;\r\n\r\n\r\n\r\n            vec3 spotHalfVector = normalize( lVector + viewDirection );\r\n            float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\r\n            float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininessB ), 0.0 );\r\n\r\n            float specularNormalization = shininessB * 0.125 + 0.25;\r\n            vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, spotHalfVector ) );\r\n            spotSpecular += schlick * InputToLinear(spotLightColor[ i ]) * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\r\n        }\r\n\r\n    }\r\n\r\n    totalDiffuse += spotDiffuse;\r\n    totalSpecular += spotSpecular;\r\n\r\n#endif\r\n\r\n#if MAX_DIR_LIGHTS > 0\r\n\r\n    vec3 dirDiffuse  = vec3( 0.0 );\r\n    vec3 dirSpecular = vec3( 0.0 );\r\n\r\n    for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\r\n\r\n        vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\r\n        vec3 dirVector = normalize( lDirection.xyz );\r\n\r\n\r\n\r\n        float dotProduct = dot( normal, dirVector );\r\n\r\n        float dirDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n        dirDiffuse  += InputToLinear(diffuse) * InputToLinear(directionalLightColor[ i ]) * dirDiffuseWeight;\r\n\r\n\r\n\r\n        vec3 dirHalfVector = normalize( dirVector + viewDirection );\r\n        float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\r\n        float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininessB ), 0.0 );\r\n\r\n        float specularNormalization = shininessB * 0.125 + 0.25;\r\n        vec3 schlick = Schlick_v3(InputToLinear(specular), dot( dirVector, dirHalfVector ));\r\n\r\n        dirSpecular += schlick * InputToLinear(directionalLightColor[ i ]) * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\r\n\r\n    }\r\n\r\n    totalDiffuse += dirDiffuse;\r\n    totalSpecular += dirSpecular;\r\n\r\n#endif\r\n\r\n\r\n\r\n#ifdef USE_IRRADIANCEMAP\r\n    vec3 worldNormal = mat3(viewMatrixInverse) * normal;\r\n    vec3 indirectDiffuse = sampleIrradianceMap(worldNormal, irradianceMap, envMapExposure);\r\n\r\n    indirectDiffuse = applyEnvShadow(indirectDiffuse, worldNormal);\r\n\r\n    totalDiffuse += InputToLinear(diffuse) * indirectDiffuse;\r\n#endif\r\n\r\n\r\n#ifdef METAL\r\n    gl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) + totalSpecular );\r\n#else\r\n    gl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) ) + totalSpecular;\r\n#endif\r\n\r\n\r\n\r\n#ifdef USE_COLOR\r\n    gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\r\n#endif\r\n\r\n\r\n#if defined(USE_ENVMAP)\r\n\r\n    vec3 reflectVec;\r\n\r\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\n\r\n#ifdef ENVMAP_MODE_REFLECTION\r\n    reflectVec = reflect( -viewDirection, normal );\r\n#else \r\n    reflectVec = refract( -viewDirection, normal, refractionRatio );\r\n#endif\r\n\r\n#else\r\n\r\n    reflectVec = reflect( -viewDirection, normal );\r\n\r\n#endif\r\n\r\n    reflectVec = mat3(viewMatrixInverse) * reflectVec;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    float reflectScale = 1.0;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    vec3 cubeColor = sampleReflection(reflectVec, reflMipIndex);\r\n\r\n    cubeColor *= reflectScale;\r\n\r\n    float facing = dot( viewDirection, normal );\r\n\r\n\r\n\r\n\r\n\r\n    if (facing < -1e-2)\r\n        facing = 1.0;\r\n    else\r\n        facing = max(1e-6, facing);\r\n\r\n#ifdef USE_BUMPMAP\r\n\r\n\r\n\r\n    facing = min(1.0, facing + bumpScale * 7.0);\r\n\r\n#endif\r\n\r\n    vec3 schlickRefl;\r\n\r\n#ifdef METAL\r\n\r\n\r\n    schlickRefl = InputToLinear(specular);\r\n\r\n#else\r\n\r\n\r\n    schlickRefl = Schlick_v3(InputToLinear(specular), facing);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    gl_FragColor.a = mix(gl_FragColor.a, Schlick_f(gl_FragColor.a, facing), reflectivity);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    float invSchlick = pow(1.0 - facing * 0.5, 5.0);\r\n\r\n\r\n    float norm_factor = (28.0 / 23.0) * (1.0 - invSchlick) * (1.0 - invSchlick);\r\n\r\n    gl_FragColor.xyz *= norm_factor * (1.0 - InputToLinear(specular));\r\n\r\n#endif\r\n\r\n\r\n    gl_FragColor.xyz += cubeColor.xyz * specularStrength * schlickRefl.xyz;\r\n\r\n#ifdef CLEARCOAT\r\n\r\n    vec3 reflectVecClearcoat = reflect( -viewDirection, geomNormal );\r\n    reflectVecClearcoat = mat3(viewMatrixInverse) * reflectVecClearcoat;\r\n\r\n    vec3 cubeColorClearcoat = sampleReflection(reflectVecClearcoat, 0.0);\r\n\r\n\r\n    float schlickClearcoat = Schlick_f(InputToLinear(reflectivity), facing);\r\n\r\n\r\n\r\n    gl_FragColor.xyz = mix(gl_FragColor.xyz, cubeColorClearcoat * schlickClearcoat, 0.5);\r\n\r\n#endif\r\n\r\n\r\n\r\n\r\n#endif\r\n\r\n#if TONEMAP_OUTPUT == 1\r\n    gl_FragColor.xyz = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * gl_FragColor.xyz);\r\n#elif TONEMAP_OUTPUT == 2\r\n    gl_FragColor.xyz = toneMapCanonFilmic_WithGamma( exposureBias * gl_FragColor.xyz );\r\n#endif\r\n\r\n\r\n\r\n#ifdef USE_FOG\r\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\r\n    float fogFactor = smoothstep( fogNear, fogFar, depth );\r\n    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\r\n#endif\r\n#include<theming_frag>\r\n#include<final_frag>\r\n\r\n}\r\n"},function(e,t){e.exports="#include<id_decl_vert>\n#include<decl_point_size>\n#include<common>\n#include<map_pars_vertex>\n#include<lightmap_pars_vertex>\n#include<envmap_pars_vertex>\n#include<color_pars_vertex>\n#include<morphtarget_pars_vertex>\n#include<skinning_pars_vertex>\n#include<logdepthbuf_pars_vertex>\n#include<wide_lines_decl>\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvoid main() {\n#include<map_vertex>\n#include<lightmap_vertex>\n#include<color_vertex>\n#include<skinbase_vertex>\n#ifdef USE_ENVMAP\n#include<morphnormal_vertex>\n#include<skinnormal_vertex>\n#include<defaultnormal_vertex>\n#endif\n#include<morphtarget_vertex>\n#include<skinning_vertex>\n#include<default_vertex>\n#include<wide_lines_vert>\n#include<logdepthbuf_vertex>\n#include<worldpos_vertex>\n#if NUM_CUTPLANES > 0\n    vec4 _worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = _worldPosition.xyz;\n#endif\n#include<envmap_vertex>\n#include<id_vert>\n#include<point_size>\n}\n"},function(e,t){e.exports="uniform vec3 diffuse;\nuniform float opacity;\n#include<common>\n#include<color_pars_fragment>\n#include<map_pars_fragment>\n#include<alphamap_pars_fragment>\n#include<lightmap_pars_fragment>\n#include<envmap_pars_fragment>\n#include<fog_pars_fragment>\n#include<specularmap_pars_fragment>\n#include<logdepthbuf_pars_fragment>\n#if NUM_CUTPLANES > 0\nvarying highp vec3 vWorldPosition;\n#endif\n#include<cutplanes>\n#include<id_decl_frag>\n#include<theming_decl_frag>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 outgoingLight = vec3( 0.0 );\n    vec4 diffuseColor = vec4( diffuse, opacity );\n#include<logdepthbuf_fragment>\n#include<map_fragment>\n#include<color_fragment>\n#include<alphamap_fragment>\n#include<alphatest_fragment>\n#include<specularmap_fragment>\n    outgoingLight = diffuseColor.rgb;\n#include<lightmap_fragment>\n#include<envmap_fragment>\n#include<linear_to_gamma_fragment>\n#include<fog_fragment>\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include<theming_frag>\n#include<final_frag>\n}\n"},function(e,t){e.exports="\n#include <depth_texture>\n#define USE_MIPMAP 1\nuniform float cameraNear;\nuniform float cameraFar;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform float lumInfluence;\nvarying vec2 vUv;\n#define NUM_SAMPLES (17)\n#define LOG_MAX_OFFSET (3)\n#define MAX_MIP_LEVEL (5)\n#define NUM_SPIRAL_TURNS (5)\n#define MIN_RADIUS (3.0)\nuniform float           projScale;\n#ifdef USE_MIPMAP\nuniform sampler2D tDepth_mip1;\nuniform sampler2D tDepth_mip2;\nuniform sampler2D tDepth_mip3;\nuniform sampler2D tDepth_mip4;\nuniform sampler2D tDepth_mip5;\n#endif\nuniform float radius;\nuniform float bias;\nuniform float intensity;\nvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(float(sampleNumber) + 0.5) * (1.0 / float(NUM_SAMPLES));\n    float angle = alpha * (float(NUM_SPIRAL_TURNS) * 6.28) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nfloat CSZToKey(float z) {\n    return clamp( (z+cameraNear) / (cameraNear-cameraFar), 0.0, 1.0);\n}\nvoid packKey(float key, out vec2 p) {\n    float temp = floor(key * 255.0);\n    p.x = temp * (1.0 / 255.0);\n    p.y = key * 255.0 - temp;\n}\n#include <pack_depth>\nfloat unpackDepthNearFar( const in vec4 rgba_depth ) {\n    float depth = unpackDepth( rgba_depth );\n    if (depth == 0.0)\n        return -cameraFar * 1.0e10;\n    return depth * (cameraNear - cameraFar) - cameraNear;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 reconstructNonUnitCSFaceNormal(vec3 C) {\n    return cross(dFdy(C), dFdx(C));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nvec3 getOffsetPosition(ivec2 ssC, vec2 unitOffset, float ssR) {\n    ivec2 ssP = ivec2(ssR * unitOffset) + ssC;\n    vec3 P;\n    vec2 screenUV = (vec2(ssP) + vec2(0.5)) * resolution;\n#ifdef USE_MIPMAP\n    int mipLevel = int(max(0.0, min(floor(log2(ssR)) - float(LOG_MAX_OFFSET), float(MAX_MIP_LEVEL))));\n    if (mipLevel == 0) {\n        P.z = texture2D(tDepth, screenUV).z;\n        if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n    }\n    else if (mipLevel == 1)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip1, screenUV));\n    else if (mipLevel == 2)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip2, screenUV));\n    else if (mipLevel == 3)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip3, screenUV));\n    else if (mipLevel == 4)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip4, screenUV));\n    else if (mipLevel == 5)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip5, screenUV));\n#else\n    P.z = texture2D(tDepth, screenUV).z;\n    if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n#endif\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), P.z);\n    return P;\n}\nfloat sampleAO(in ivec2 ssC, in vec3 C, in vec3 n_C, in float ssDiskRadius, in int tapIndex, in float randomPatternRotationAngle) {\n    float ssR;\n    vec2 unitOffset = tapLocation(tapIndex, randomPatternRotationAngle, ssR);\n    ssR = max(0.75, ssR * ssDiskRadius);\n    vec3 Q = getOffsetPosition(ssC, unitOffset, ssR);\n    vec3 v = Q - C;\n    float vv = dot(v, v);\n    float vn = dot(v, n_C);\n    const float epsilon = 0.001;\n    float angAdjust = mix(1.0, max(0.0, 1.5 * n_C.z), 0.35);\n#define HIGH_QUALITY\n#ifdef HIGH_QUALITY\n    float f = max(1.0 - vv / (radius * radius), 0.0); return angAdjust * f * max((vn - bias) / sqrt(epsilon + vv), 0.0);\n#else\n    float f = max(radius * radius - vv, 0.0); return angAdjust * f * f * f * max((vn - bias) / (epsilon + vv), 0.0);\n#endif\n}\nconst bool useNoise = true;\nfloat getRandomAngle(vec2 pos) {\n    float dt= dot(pos ,vec2(12.9898,78.233));\n    return 6.28318 * fract(sin(mod(dt,3.14)) * 43758.5453);\n}\nvoid main() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 nrmz = texture2D(tDepth, vUv);\n    if (nrmz.z == 0.0) {\n        gl_FragColor.r = 1.0;\n        gl_FragColor.a = 0.0;\n        packKey(1.0, gl_FragColor.gb);\n        return;\n    }\n    vec3 C = getPosition(ssC, nrmz.z);\n    packKey(CSZToKey(C.z), gl_FragColor.gb);\n    float ssDiskRadius = -projScale * radius / mix(C.z, -1.0, isOrtho);\n    float A;\n    if (ssDiskRadius <= MIN_RADIUS) {\n        A = 1.0;\n    } else {\n        float sum = 0.0;\n        float randomPatternRotationAngle = getRandomAngle(vUv);\n        vec3 n_C = vec3(nrmz.x, nrmz.y, sqrt(1.0 - dot(nrmz.xy, nrmz.xy)));\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 0, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 1, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 2, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 3, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 4, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 5, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 6, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 7, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 8, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 9, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 10, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 11, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 12, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 13, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 14, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 15, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 16, randomPatternRotationAngle);\n        float intensityDivR6 = intensity / pow(radius, 6.0);\n#ifdef HIGH_QUALITY\n        A = pow(max(0.0, 1.0 - sqrt(sum * (3.0 / float(NUM_SAMPLES)))), intensity);\n#else\n        A = max(0.0, 1.0 - sum * intensityDivR6 * (5.0 / float(NUM_SAMPLES)));\n        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n#endif\n        if (abs(dFdx(C.z)) < 0.02) {\n            A -= dFdx(A) * (mod(float(ssC.x), 2.0) - 0.5);\n        }\n        if (abs(dFdy(C.z)) < 0.02) {\n            A -= dFdy(A) * (mod(float(ssC.y), 2.0) - 0.5);\n        }\n        A = mix(1.0, A, clamp(ssDiskRadius - MIN_RADIUS,0.0,1.0));\n    }\n    gl_FragColor.r = A;\n    gl_FragColor.a = 1.0;\n}\n"},function(e,t){e.exports="varying vec3 vViewPosition;\nvarying vec3 vNormal;\n#if defined(PRISMWOOD) && !defined(NO_UVW)\nvarying vec3 vUvw;\n#if defined(PRISMWOODBUMP)\nvarying vec3 vtNormal;\nvarying mat3 mNormalMatrix;\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#prism_check<USE_MAP>\n#if defined(USE_MAP) || defined(USE_TILING)\nvarying vec2 vUv;\n#endif\n#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#ifdef MRT_NORMALS\nvarying float depth;\n#endif\n#include<pack_normals>\n#include<instancing_decl_vert>\n#include<id_decl_vert>\n#include<shadowmap_decl_vert>\n#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0) || defined( PRISMWOODBUMP )\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\nvoid ComputeTangents(vec3 normal, out vec3 u, out vec3 v)\n{\n    float scale = normal.z < 0.0 ? -1.0 : 1.0;\n    vec3 temp = scale * normal;\n    float e    = temp.z;\n    float h    = 1.0/(1.0 + e);\n    float hvx  = h   *  temp.y;\n    float hvxy = hvx * -temp.x;\n    u = vec3(e + hvx * temp.y, hvxy,                -temp.x);\n    v = vec3(hvxy,             e + h * temp.x * temp.x, -temp.y);\n    u *= scale;\n    v *= scale;\n}\n#endif\nvoid main() {\n#if defined(USE_MAP) || defined(USE_TILING)\n    vUv = uv;\n#endif\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n#if defined(PRISMWOOD) && !defined(NO_UVW)\n#if defined(PRISMWOODBUMP)\n    vUvw = instPos;\n    vtNormal = normalize(objectNormal);\n    mNormalMatrix = normalMatrix;\n#else\n    vUvw = uvw;\n#endif\n#endif\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    vNormal = normalize( transformedNormal );\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n    vViewPosition = -mvPosition.xyz;\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0) || defined ( PRISMWOODBUMP )\n    vec3 Tu, Tv;\n#if defined(PRISMWOODBUMP)\n    ComputeTangents(vtNormal, Tu, Tv);\n#else\n    ComputeTangents(vNormal, Tu, Tv);\n#endif\n    vTangent = Tu;\n    vBitangent = Tv;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    if (projectionMatrix[3][3] == 0.0) {\n        gl_Position.z = log2(max(1.0e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + gl_Position.w;\n#else\n        gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n    } else {\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + vViewPosition.z;\n#else\n#endif\n    }\n#endif\n#ifdef MRT_NORMALS\n    depth = mvPosition.z;\n#endif\n#include<id_vert>\n#include<shadowmap_vert>\n}\n"},function(e,t){e.exports="\n#include<common>\n#define RECIPROCAL_PI 0.318309886\n#define ONE 0.00390625\nuniform float opacity;\nuniform vec3 surface_albedo;\nuniform float surface_roughness;\nuniform float surface_anisotropy;\nuniform float surface_rotation;\nuniform sampler2D importantSamplingRandomMap;\nuniform sampler2D importantSamplingSolidAngleMap;\n#if defined( PRISMOPAQUE )\nuniform vec3 opaque_albedo;\nuniform float opaque_f0;\nuniform vec3 opaque_luminance_modifier;\nuniform float opaque_luminance;\n#elif defined( PRISMMETAL )\nuniform vec3 metal_f0;\n#elif defined( PRISMLAYERED )\nuniform float layered_f0;\nuniform vec3 layered_diffuse;\nuniform float layered_fraction;\nuniform vec3 layered_bottom_f0;\nuniform float layered_roughness;\nuniform float layered_anisotropy;\nuniform float layered_rotation;\n#elif defined( PRISMTRANSPARENT )\nuniform float transparent_ior;\nuniform vec3 transparent_color;\nuniform float transparent_distance;\n#elif defined( PRISMGLAZING )\nuniform vec3 glazing_f0;\nuniform vec3 glazing_transmission_color;\nuniform float glazing_transmission_roughness;\n#elif defined( PRISMWOOD )\nuniform bool wood_fiber_cosine_enable;\nuniform int wood_fiber_cosine_bands;\nuniform vec4 wood_fiber_cosine_weights;\nuniform vec4 wood_fiber_cosine_frequencies;\nuniform bool wood_fiber_perlin_enable;\nuniform int wood_fiber_perlin_bands;\nuniform vec4 wood_fiber_perlin_weights;\nuniform vec4 wood_fiber_perlin_frequencies;\nuniform float wood_fiber_perlin_scale_z;\nuniform bool wood_growth_perlin_enable;\nuniform int wood_growth_perlin_bands;\nuniform vec4 wood_growth_perlin_weights;\nuniform vec4 wood_growth_perlin_frequencies;\nuniform float wood_latewood_ratio;\nuniform float wood_earlywood_sharpness;\nuniform float wood_latewood_sharpness;\nuniform float wood_ring_thickness;\nuniform bool wood_earlycolor_perlin_enable;\nuniform int wood_earlycolor_perlin_bands;\nuniform vec4 wood_earlycolor_perlin_weights;\nuniform vec4 wood_earlycolor_perlin_frequencies;\nuniform vec3 wood_early_color;\nuniform bool wood_use_manual_late_color;\nuniform vec3 wood_manual_late_color;\nuniform bool wood_latecolor_perlin_enable;\nuniform int wood_latecolor_perlin_bands;\nuniform vec4 wood_latecolor_perlin_weights;\nuniform vec4 wood_latecolor_perlin_frequencies;\nuniform float wood_late_color_power;\nuniform bool wood_diffuse_perlin_enable;\nuniform int wood_diffuse_perlin_bands;\nuniform vec4 wood_diffuse_perlin_weights;\nuniform vec4 wood_diffuse_perlin_frequencies;\nuniform float wood_diffuse_perlin_scale_z;\nuniform bool wood_use_pores;\nuniform int wood_pore_type;\nuniform float wood_pore_radius;\nuniform float wood_pore_cell_dim;\nuniform float wood_pore_color_power;\nuniform float wood_pore_depth;\nuniform bool wood_use_rays;\nuniform float wood_ray_color_power;\nuniform float wood_ray_seg_length_z;\nuniform float wood_ray_num_slices;\nuniform float wood_ray_ellipse_z2x;\nuniform float wood_ray_ellipse_radius_x;\nuniform bool wood_use_latewood_bump;\nuniform float wood_latewood_bump_depth;\nuniform bool wood_use_groove_roughness;\nuniform float wood_groove_roughness;\nuniform float wood_diffuse_lobe_weight;\nuniform sampler2D permutationMap;\nuniform sampler2D gradientMap;\nuniform sampler2D perm2DMap;\nuniform sampler2D permGradMap;\nuniform vec4 wood_ring_fraction;\nuniform vec2 wood_fall_rise;\n#endif\n#ifdef USE_TILING\nuniform mat4 tilingOverallTransform;\nuniform sampler2D TilingMap;\nuniform mat3 TilingMap_texMatrix;\nuniform vec4 uv2tile;\nuniform vec4 tile2uv;\nuniform vec2 tileAlignOffset;\nuniform mat4 tilingUVTransform;\n#ifdef USE_TILING_NORMAL\nuniform sampler2D TilingNormalMap;\nuniform mat3 TilingNormalMap_texMatrix;\n#endif\n#ifdef USE_TILING_RANDOM\nuniform sampler2D TilingRandomMap;\nuniform mat3 TilingRandomMap_texMatrix;\nuniform vec2 tilingRandomAxisS;\nuniform vec2 tilingRandomAxisT;\nuniform vec2 tilingRandomAlignmentOffset;\n#endif\n#endif\nuniform float envExponentMin;\nuniform float envExponentMax;\nuniform float envExponentCount;\n#include<env_sample>\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\n#include<tonemap>\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_LOGDEPTHBUF\nuniform float logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n#extension GL_EXT_frag_depth : enable\nvarying highp float vFragDepth;\n#endif\n#endif\n#include<id_decl_frag>\n#include<theming_decl_frag>\n#include<shadowmap_decl_frag>\n#ifdef USE_FOG\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#prism_check<USE_MAP>\n#if defined(USE_MAP) || defined(USE_TILING)\nvarying vec2 vUv;\n#endif\n#if defined(PRISMWOOD) && !defined(NO_UVW)\nvarying vec3 vUvw;\n#endif\n#prism_uniforms<surface_albedo_map>\n#prism_uniforms<surface_roughness_map>\n#prism_uniforms<surface_cutout_map>\n#prism_uniforms<surface_anisotropy_map>\n#prism_uniforms<surface_rotation_map>\n#prism_uniforms<opaque_albedo_map>\n#prism_uniforms<opaque_f0_map>\n#prism_uniforms<opaque_luminance_modifier_map>\n#prism_uniforms<layered_bottom_f0_map>\n#prism_uniforms<layered_f0_map>\n#prism_uniforms<layered_diffuse_map>\n#prism_uniforms<layered_fraction_map>\n#prism_uniforms<layered_roughness_map>\n#prism_uniforms<layered_anisotropy_map>\n#prism_uniforms<layered_rotation_map>\n#prism_uniforms<metal_f0_map>\n#prism_uniforms<glazing_f0_map>\n#prism_uniforms<glazing_transmission_roughness_map>\n#prism_uniforms<glazing_transmission_color_map>\n#prism_uniforms<wood_curly_distortion_map>\n#if defined( USE_WOOD_CURLY_DISTORTION_MAP )\nuniform bool wood_curly_distortion_enable;\nuniform float wood_curly_distortion_scale;\n#endif\n#prism_bump_uniforms<surface_normal_map>\n#prism_bump_uniforms<layered_normal_map>\nfloat SRGBToLinearComponent(float color) {\n    float result = color;\n    if (result<=0.04045)\n        result *= 0.07739938;\n    else\n        result = pow(abs((result+0.055)*0.947867298), 2.4);\n    return result;\n}\nvec3 SRGBToLinear(vec3 color) {\n    vec3 result = color;\n    result.x = SRGBToLinearComponent(result.x);\n    result.y = SRGBToLinearComponent(result.y);\n    result.z = SRGBToLinearComponent(result.z);\n    return result;\n}\n#if defined( USE_ENVMAP )\nuniform float envMapExposure;\nuniform samplerCube envMap;\n#endif\n#include<normal_map>\n#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0) || defined ( PRISMWOODBUMP )\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\n#if defined( PRISMWOODBUMP )\nvarying vec3 vtNormal;\nvarying mat3 mNormalMatrix;\n#endif\n#endif\n#if defined( USE_ENVMAP )\nvec3 sampleReflection(vec3 N, vec3 V, float mipIndex) {\n    vec3 dir = (2.0 * dot(V, N)) * N - V;\n    dir = adjustLookupVector(mat3(viewMatrixInverse) * dir);\n#ifdef ENV_GAMMA\n#ifdef HAVE_TEXTURE_LOD\n    vec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );\n#else\n    vec4 envTexColor = textureCube( envMap, dir, mipIndex );\n#endif\n    return GammaDecode(envTexColor, envMapExposure);\n#elif defined(ENV_RGBM)\n#ifdef HAVE_TEXTURE_LOD\n    vec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );\n#else\n    vec4 envTexColor = textureCube( envMap, dir, mipIndex );\n#endif\n    return RGBMDecode(envTexColor, envMapExposure);\n#else\n    vec4 envTexColor = textureCube( envMap, dir );\n    vec3 cubeColor = envTexColor.xyz;\n#ifdef GAMMA_INPUT\n    cubeColor *= cubeColor;\n#endif\n    return cubeColor;\n#endif\n}\n#endif\n#include<hatch_pattern>\n#if defined( USE_ENVMAP ) && defined( USE_IRRADIANCEMAP )\nuniform samplerCube irradianceMap;\nvec3 sampleNormal(vec3 normal) {\n    vec3 worldNormal = mat3(viewMatrixInverse) * normal;\n    vec3 irradiance = sampleIrradianceMap(worldNormal, irradianceMap, envMapExposure);\n    irradiance = applyEnvShadow(irradiance, worldNormal);\n    return irradiance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\nfloat sqr(float x) {return x*x;}\nfloat aSqrd(float maxAlphaSqr, float cosTheta)\n{\n    if (abs(cosTheta) < 1e-10)\n    {\n        return 1e10;\n    }\n    float tan2 = 1.0/sqr(cosTheta) - 1.0;\n    return maxAlphaSqr * tan2;\n}\nvec3 Fresnel_Schlick(vec3 f0, float cosAngle)\n{\n    float x = 1.0 - cosAngle;\n    float x2 = x * x;\n    float x5 = x * x2 * x2;\n    return f0 + (1.0 - f0) * x5;\n}\nvec3 Fresnel_Rough(vec3 f0, float cosAngle, float alpha)\n{\n    float x = 1.0 - cosAngle;\n    float x2 = x * x;\n    float x5 = x * x2 * x2;\n    vec3 maxReflectance = mix(vec3(1.0), f0, vec3(min(0.7, alpha)) / 0.7);\n    return f0 + (maxReflectance - f0) * x5;\n}\nfloat IORToReflectance(float ior)\n{\n    return sqr((1.0 - ior)/(1.0 + ior));\n}\nvec2 RoughnessToAlpha(float roughness, float anisotropy)\n{\n    vec2 alpha = roughness * vec2(1.0, 1.0 - anisotropy);\n    alpha = alpha * alpha;\n    alpha = clamp(alpha, 0.001, 1.0);\n    return alpha;\n}\nfloat AlphaToPhong(float alpha)\n{\n    return max(0.0, 2.56/alpha - 7.0);\n}\nfloat ExponentToReflMipIndex(float exponent)\n{\n    float targetLog = log2(exponent);\n    float minLog = log2(envExponentMin);\n    float maxLog = log2(envExponentMax);\n    float deltaLog = clamp(targetLog - minLog, 0.0, maxLog - minLog);\n    float level = clamp((1.0-(deltaLog + 0.5) / envExponentCount), 0.0, 1.0) * 6.0;\n    return level;\n}\n#include<prism_wood>\n#if defined( ENABLEIMPORTANTSAMPLING ) && (defined( USE_SURFACE_ROTATION_MAP ) || defined( USE_SURFACE_ANISOTROPY_MAP ) || defined( USE_LAYERED_ROTATION_MAP ) || defined( USE_LAYERED_ANISOTROPY_MAP ))\n#define IMPORTANTSAMPLING\n#endif\n#if defined( IMPORTANTSAMPLING )\n#define SAMPLECOUNT 32\nvec2 Hammersley(int index)\n{\n    float u = (float(index) + 0.5) / 32.0;\n    float v = 0.5;\n    float noise = texture2D(importantSamplingRandomMap, vec2(u, v), 0.0).r;\n   return vec2(2.0 * PI * float(index/SAMPLECOUNT), noise);\n}\nvec3 ImportanceSampleAnisotropicGGX(int index, vec2 alpha, vec3 N, vec3 Tu, vec3 Tv)\n{\n    vec2 uniformSample2D = Hammersley(index);\n    float coef = sqrt(uniformSample2D.y / (1.0 - uniformSample2D.y));\n    float sinSigma, cosSigma;\n    sinSigma = sin(uniformSample2D.x);\n    cosSigma = cos(uniformSample2D.x);\n    vec3 H = coef * ((alpha.x * cosSigma) * Tu + (alpha.y * sinSigma) * Tv) + N;\n    H = normalize(H);\n    return H;\n}\nfloat ComputePDF(vec2 alpha, float NdotH, float HdotTu, float HdotTv, float VdotH)\n{\n    float factor1 = HdotTu / alpha.x;\n    float factor2 = HdotTv / alpha.y;\n    float factor3 = factor1 * factor1 + factor2 * factor2 + NdotH * NdotH;\n    float factor = factor3 * factor3 * alpha.x * alpha.y * VdotH * 4.0 * PI;\n    if (factor > 0.0)\n    {\n        return (NdotH / factor);\n    }\n    else\n    {\n        return 0.0;\n    }\n}\n#define INVFACESIZE 0.0078125\nfloat DirectionToSolidAngle(vec3 dir)\n{\n    dir = abs(dir);\n    float first = min(dir.x, dir.y);\n    float temp = max(dir.x, dir.y);\n    float second = min(temp, dir.z);\n    float third = max(temp, dir.z);\n    first /= third;\n    second /= third;\n    float u = (first+1.0)/2.0;\n    float v = (second + 1.0) / 2.0;\n    float solidAngle = texture2D(importantSamplingSolidAngleMap, vec2(u, v), 0.0).r * 0.000255;\n    return solidAngle;\n}\nfloat Smith_GGX(float value)\n{\n    return 2.0 / (1.0 + sqrt(1.0 + value));\n}\nvec2 RoughnessAnisotropyToAlpha(float roughness, float anisotropy)\n{\n    float aspect = sqrt(1.0 - 0.9 * anisotropy);\n    vec2 alpha = vec2(roughness * roughness / aspect, roughness * roughness * aspect);\n    return alpha;\n}\nvec3 ImportanceSamplingSpecular(float angle, vec3 reflectance, float roughness, float anisotropy, vec3 V, vec3 N, vec3 Tu, vec3 Tv)\n{\n    vec3 specular = vec3(0.0);\n    float radAngle;\n    if (anisotropy < 1e-10)\n    {\n        radAngle = 0.0;\n    }\n    else\n    {\n        radAngle = -PI * angle;\n    }\n    vec2 alpha = RoughnessAnisotropyToAlpha(roughness, anisotropy);\n    float alpha2 = max(alpha.x * alpha.x, alpha.y * alpha.y);\n    float NdotV = dot(N, V);\n    float alpha2NV = aSqrd(alpha2, NdotV);\n    vec2 sincosTheta;\n    sincosTheta.x = sin(radAngle);\n    sincosTheta.y = cos(radAngle);\n    vec3 Tu1, Tv1;\n    Tu1 = sincosTheta.y * Tu - sincosTheta.x * Tv;\n    Tv1 = sincosTheta.x * Tu + sincosTheta.y * Tv;\n    vec3 H;\n    vec3 sampleLightIntensity;\n    vec3 L;\n    float effectiveSample = 0.0;\n    for (int i = 0; i < SAMPLECOUNT; i++)\n    {\n        H = ImportanceSampleAnisotropicGGX(i, alpha, N, Tu1, Tv1);\n        float VdotH = dot(V, H);\n        L = 2.0 * VdotH * H - V;\n        float NdotH = dot(N, H);\n        float NdotL = dot(N, L);\n        if (NdotL >= 0.0 && NdotV > 0.0 && NdotH > 0.0)\n        {\n            float alpha2NL = aSqrd(alpha2, NdotL);\n            float HdotTu = dot(H, Tu1);\n            float HdotTv = dot(H, Tv1);\n            float pdf = ComputePDF(alpha, NdotH, HdotTu, HdotTv, VdotH);\n            float mipmapLevel = 0.0;\n            if (pdf > 0.0)\n            {\n                mipmapLevel = 0.3 * log2(1.0 / (float(SAMPLECOUNT) * pdf * DirectionToSolidAngle(L)));\n            }\n            mipmapLevel = clamp(mipmapLevel, 0.0, 4.0);\n            L = normalize(L);\n            sampleLightIntensity = sampleReflection(L, L, mipmapLevel).rgb;\n            float G = Smith_GGX(alpha2NL) * Smith_GGX(alpha2NV);\n            vec3 F = Fresnel_Schlick(reflectance, VdotH);\n            float factor = G * VdotH / (NdotH * NdotV);\n            if (factor >= 0.0)\n            {\n                specular += abs(sampleLightIntensity * F * factor);\n                effectiveSample += 1.0;\n            }\n        }\n    }\n    if (effectiveSample > 0.0)\n    {\n        specular /= effectiveSample;\n    }\n    return specular;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0\nvec3 DiffuseLobe(vec3 diffuseColor)\n{\n    return diffuseColor * RECIPROCAL_PI;\n}\nvec3 Rotate(vec3 vec, float angle)\n{\n    float s = sin(angle);\n    float c = cos(angle);\n    return vec3(vec.x * c - vec.y * s, vec.x * s + vec.y * c, vec.z);\n}\nfloat NDF_GGX(float alphaU, float alphaV, vec3 normal)\n{\n    float nx2 = sqr(normal.x);\n    float ny2 = sqr(normal.y);\n    float nz2 = sqr(normal.z);\n    float scale = 1.0/(alphaU * alphaV * PI);\n    return scale/sqr(nx2/sqr(alphaU) + ny2/sqr(alphaV) + nz2);\n}\nfloat G1_GGX(float aSqrd)\n{\n    return 2.0 / (1.0 + sqrt(1.0 + aSqrd));\n}\nvec3 MicrofacetLobe(\n        vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        float roughness, float anisotropy, float rotation, vec3 reflectance)\n{\n    vec2 alpha = RoughnessToAlpha(roughness, anisotropy);\n    Hlocal = Rotate(Hlocal, rotation);\n    vec3 F = Fresnel_Schlick(reflectance, VdotH);\n    float D = NDF_GGX(alpha.x, alpha.y, Hlocal);\n    float alpha2 = max(sqr(alpha.x), sqr(alpha.y));\n    float alpha2NL = aSqrd(alpha2, NdotL);\n    float alpha2NV = aSqrd(alpha2, NdotV);\n    float G = G1_GGX(alpha2NL) * G1_GGX(alpha2NV);\n    return max(F * D * G / (4.0 * NdotL * NdotV), vec3(0.0));\n}\n#if defined( PRISMOPAQUE )\nvec3 BRDF_Opaque(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        float opaqueF0, vec3 opaqueAlbedo)\n{\n    vec3 diffuse = DiffuseLobe(opaqueAlbedo);\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, vec3(opaqueF0));\n    return (specular+diffuse)*NdotL;\n}\n#elif defined( PRISMMETAL )\nvec3 BRDF_Metal(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        vec3 metalF0)\n{\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, metalF0);\n    return specular*NdotL;\n}\n#elif defined( PRISMLAYERED )\nvec3 BRDF_Layered(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 Hlocal2, float N2dotL, float N2dotH, float N2dotV,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        float layeredF0, vec3 layeredDiffuse, float layeredRoughness, float layeredAnisotropy,\n        float layeredRotation, vec3 bottom_f0, float layeredFraction)\n{\n    vec3 Fl = Fresnel_Schlick(vec3(layeredF0), NdotL);\n    vec3 Fv = Fresnel_Schlick(vec3(layeredF0), NdotV);\n    vec3 amount = (1.0 - Fl) * (1.0 - Fv);\n    vec3 topSpecular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n            vec3(layeredF0));\n    vec3 topDiffuse = DiffuseLobe(layeredDiffuse);\n    vec3 botSpecular = MicrofacetLobe(\n            Hlocal2, N2dotL, N2dotH, N2dotV, VdotH,\n            layeredRoughness, layeredAnisotropy, layeredRotation,\n            bottom_f0);\n    return topSpecular*NdotL + amount * mix(topDiffuse*NdotL, botSpecular*N2dotL, layeredFraction);\n}\n#elif defined( PRISMTRANSPARENT )\nvec3 BRDF_Transparent(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation)\n{\n    vec3 reflectance = vec3(IORToReflectance(transparent_ior));\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, reflectance);\n    return specular*NdotL;\n}\n#elif defined( PRISMGLAZING )\nvec3 BRDF_Glazing(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        vec3 glazingF0, vec3 glazingTransmissionColor, float glazingIlluminance)\n{\n    vec3 diffuse = DiffuseLobe(glazingTransmissionColor - vec3(glazingIlluminance, glazingIlluminance, glazingIlluminance));\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, glazingF0);\n    return (specular+diffuse)*NdotL;\n}\n#elif defined( PRISMWOOD )\nvec3 BRDF_Wood(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, vec3 woodDiffuse)\n{\n    vec3 diffuse = DiffuseLobe(woodDiffuse);\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, 0.0, 0.0, vec3(0.04));\n    return (specular+diffuse)*NdotL;\n}\n#endif\n#endif\n#if defined( USE_ENVMAP )\n#if defined( PRISMOPAQUE )\nvec3 Environment_Opaque(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness,\n        float opaqueF0, vec3 opaqueAlbedo, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 T)\n{\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = Fresnel_Rough(vec3(opaqueF0), NdotV, alpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, vec3(opaqueF0), surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F* surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 diffuse = (1.0 - F) * opaqueAlbedo * envIrradiance;\n    return diffuse + specular;\n}\n#elif defined( PRISMMETAL )\nvec3 Environment_Metal(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, vec3 metalF0, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv)\n{\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, metalF0, surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 F = Fresnel_Rough(metalF0, NdotV, alpha);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n#endif\n    return specular;\n}\n#elif defined( PRISMLAYERED )\nvec3 Environment_Layered(vec3 N, vec3 V, float NdotV, vec3 N2, float N2dotV, vec3 surfaceAlbedo, float surfaceRoughness,\n        float layeredF0, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv, vec3 layeredDiffuse, float layeredRoughness,\n        float layeredAnisotropy, float layeredRotation, vec3 bottom_f0, float layeredFraction)\n{\n    vec3 F = Fresnel_Schlick(vec3(layeredF0), NdotV);\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n#if defined( IMPORTANTSAMPLING )\n    vec3 topSpecular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, vec3(layeredF0), surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 topSpecular = F * surfaceAlbedo * envSpecular;\n#endif\n    vec3 amount = (1.0 - F);\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 topDiffuse = layeredDiffuse * envIrradiance;\n#if defined( IMPORTANTSAMPLING )\n    vec3 botSpecular = ImportanceSamplingSpecular(layeredRotation, bottom_f0, layeredRoughness, layeredAnisotropy, V, N2, Tu, Tv);\n#else\n    alpha = RoughnessToAlpha(layeredRoughness, 0.0).x;\n    exponent = AlphaToPhong(alpha);\n    reflMipIndex = ExponentToReflMipIndex(exponent);\n    envSpecular = sampleReflection(N2, V, reflMipIndex);\n    F = Fresnel_Rough(bottom_f0, N2dotV, alpha);\n    vec3 botSpecular = F * envSpecular;\n#endif\n    return topSpecular + amount * mix(topDiffuse, botSpecular, layeredFraction);\n}\n#elif defined( PRISMTRANSPARENT )\nvec3 Environment_Transparent(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv)\n{\n    vec3 reflectance = vec3(IORToReflectance(transparent_ior));\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = Fresnel_Rough(reflectance, NdotV, alpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, reflectance, surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 color = F * surfaceRoughness * transparent_color * envIrradiance;\n    return specular + color;\n}\n#elif defined( PRISMGLAZING )\nvec3 Environment_Glazing(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv,\n                         vec3 glazing_f0, vec3 transmissionF, float transmissionAlpha, vec3 glazingAdjustedColor, float glazingIlluminace)\n{\n    float surfaceAlpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 surfaceF = Fresnel_Rough(glazing_f0, NdotV, surfaceAlpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, glazing_f0, surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(surfaceAlpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = surfaceF * surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 color = 0.5 * (1.0 - transmissionF) * (glazingAdjustedColor - vec3(glazingIlluminace, glazingIlluminace, glazingIlluminace)) * envIrradiance; \n    return specular + color;\n}\n#elif defined( PRISMWOOD )\nvec3 Environment_Wood(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, vec3 woodDiffuse, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv)\n{\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = Fresnel_Rough(vec3(0.04), NdotV, alpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, vec3(0.04), surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 diffuse = (1.0 - F) * woodDiffuse * envIrradiance;\n    return diffuse + specular;\n}\n#endif\n#endif\n#if defined( PRISMTRANSPARENT )\n#include <prism_transparency>\n#elif defined( PRISMGLAZING )\n#include <prism_glazing>\n#endif\n#ifdef USE_TILING\nvec3 tilingTransform(vec2 uv, mat4 transform)\n{\n\treturn (transform * vec4(uv, 0.0, 1.0)).xyz;\n}\nvec4 tilingMapTest(sampler2D tilingSampler, mat3 transf, vec3 uv, vec4 uv2tile, vec4 tile2uv)\n{\n\tvec2 tileCoord = vec2(dot(uv2tile.xz, uv.xy), dot(uv2tile.yw, uv.xy));\n\tvec2 ijBase = floor(tileCoord);\n    vec2 fracC = fract(tileCoord);\n\tvec2 st = vec2(dot(tile2uv.xz, fracC), dot(tile2uv.yw, fracC));\n\tvec4 tileInfo = vec4(0.0, 0.0, 2.0, 2.0);\n\tvec2 iOffset = float(TILE_RANGE_X_MIN) * tile2uv.xy;\n\tvec2 jBaseOffset = float(TILE_RANGE_Y_MIN) * tile2uv.zw;\n\tfor( int i = TILE_RANGE_X_MIN; i <= TILE_RANGE_X_MAX; i++)\n\t{\n\t\tvec2 jOffset = jBaseOffset;\n\t\tfor( int j = TILE_RANGE_Y_MIN; j <= TILE_RANGE_Y_MAX; j++)\n\t\t{\n\t\t\tvec2 sampleUV = st + iOffset + jOffset;\n\t\t\tjOffset += tile2uv.zw;\n\t\t\tsampleUV = (transf * vec3(sampleUV, 1.0)).xy;\n\t\t\tvec4 tex = texture2D(tilingSampler, sampleUV);\n\t\t\tfloat d = max( min(tex.r, tex.g), min( max(tex.r, tex.g), tex.b));\n            if (d < tileInfo.z) {\n\t\t\t\ttileInfo.xy = vec2(float(i),float(j));\n\t\t\t\ttileInfo.w = tileInfo.z;\n\t\t\t\ttileInfo.z = d;\n\t\t\t} else {\n\t\t\t\ttileInfo.w = min(tileInfo.w, d);\n\t\t\t}\n\t\t}\n\t\tiOffset += tile2uv.xy;\n\t}\n\ttileInfo.zw = tileInfo.zw - 0.5;\n\tfloat w = clamp(tileInfo.z/max(fwidth(tileInfo.z), 0.000001) + 0.5, 0.0, 1.0);\n\tif ( w == 1.0 )\n\t\tdiscard;\n \tif (abs(tileInfo.w)<=abs(tileInfo.z))\n\t\tw = 0.0;\n\ttileInfo.w = 1.0 - w;\n\ttileInfo.xy -= ijBase;\n\treturn tileInfo;\n}\nvec2 tilingSubMaterialRelocate(vec3 uv, vec4 tileInfo, vec4 tile2uv)\n{\n\tvec2 offset = vec2(dot(tile2uv.xz, tileInfo.xy), dot(tile2uv.yw, tileInfo.xy));\n\treturn (uv.xy + offset);\n}\n#ifdef USE_TILING_RANDOM\nvec2 tilingRandom(vec2 uv, vec4 tileInfo, sampler2D randomSampler, mat3 transf, vec2 tileTextureAxisS, vec2 tileTextureAxisT, vec2 tile2TextureOffset)\n{\n    vec2 xti = (vec3(tileInfo.xy, 1.0) * transf).xy;\n    vec4 random = texture2D(randomSampler, xti);\n    vec2 randomOffset = vec2(tileTextureAxisS.x*random.z + tileTextureAxisT.x*random.w,\n        tileTextureAxisS.y*random.z + tileTextureAxisT.y*random.w) + tile2TextureOffset;\n    return uv + randomOffset;\n}\n#endif\nvoid tilingNormalOffset(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (vec3(uv, 1.0) * transform).xy;\n    vec3 distort =  (2.0 * texture2D(bumpTexture, st).xyz - 1.0) - vec3(0.0,0.0,1.0);\n    mat3 mat = mat3(\n        T.x, B.x, N.x,\n        T.y, B.y, N.y,\n        T.z, B.z, N.z\n    );\n    N = normalize(N + (mat*distort));\n}\n#endif\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n#include<cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 N = normalize(vNormal);\n    vec3 Tu = vec3(0.0);\n    vec3 Tv = vec3(0.0);\n#if defined(USE_MAP) || defined(USE_TILING)\n    vec2 uv = vUv;\n#endif\n#ifdef USE_TILING\n    vec3 v_tilingOverallTransf = tilingTransform( vUv, tilingOverallTransform );\n    vec4 v_TilingMap = tilingMapTest( TilingMap, TilingMap_texMatrix, v_tilingOverallTransf, uv2tile, tile2uv );\n    uv = tilingSubMaterialRelocate( v_tilingOverallTransf, v_TilingMap, tile2uv ) + tileAlignOffset;\n#ifdef USE_TILING_NORMAL\n    vec2 uvNorm = uv;\n#endif\n#ifdef USE_TILING_RANDOM\n    uv = tilingRandom( uv, v_TilingMap, TilingRandomMap, TilingRandomMap_texMatrix, tilingRandomAxisS, tilingRandomAxisT, tilingRandomAlignmentOffset );\n#endif\n    uv = tilingTransform( uv, tilingUVTransform ).xy;\n#endif\n#if defined( USE_SURFACE_NORMAL_MAP ) || defined( USE_LAYERED_NORMAL_MAP ) || MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0 || defined( PRISMWOODBUMP ) || defined( IMPORTANTSAMPLING )\n#if !defined(USE_MAP) || defined( PRISMWOODBUMP )\n    Tu = normalize(vTangent);\n    Tv = normalize(vBitangent);\n#else\n    vec3 q0 = dFdx( -vViewPosition );\n    vec3 q1 = dFdy( -vViewPosition );\n    vec2 st0 = dFdx( uv );\n    vec2 st1 = dFdy( uv );\n    Tu = normalize(  q0 * st1.t - q1 * st0.t );\n    Tv = normalize( -q0 * st1.s + q1 * st0.s );\n#endif\n#endif\n    vec3 V;\n    if (projectionMatrix[3][3] == 0.0) {\n        V = normalize( vViewPosition );\n    } else {\n        V = vec3(0.0, 0.0, 1.0);\n    }\n    N = faceforward(N, -V, N);\n#if defined(PRISMLAYERED)\n    vec3 N2 = N;\n#endif\n#ifndef FLAT_SHADED\n    vec3 normal = normalize( vNormal );\n#ifdef DOUBLE_SIDED\n    normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#else\n    vec3 fdx = dFdx( vViewPosition );\n    vec3 fdy = dFdy( vViewPosition );\n    vec3 normal = normalize( cross( fdx, fdy ) );\n#endif\n    vec3 geomNormal = normal;\n#if defined( USE_SURFACE_NORMAL_MAP )\n    if (surface_normal_map_bumpmapType == 0)\n        heightMapTransform(surface_normal_map, uv, surface_normal_map_texMatrix, surface_normal_map_bumpScale, Tu, Tv, N);\n    else\n        normalMapTransform(surface_normal_map, uv, surface_normal_map_texMatrix, surface_normal_map_bumpScale, Tu, Tv, N);\n#endif\n#if defined( USE_LAYERED_NORMAL_MAP )\n    if (layered_normal_map_bumpmapType == 0)\n        heightMapTransform(layered_normal_map, uv, layered_normal_map_texMatrix, layered_normal_map_bumpScale, Tu, Tv, N2);\n    else\n        normalMapTransform(layered_normal_map, uv, layered_normal_map_texMatrix, layered_normal_map_bumpScale, Tu, Tv, N2);\n#endif\n#ifdef USE_TILING_NORMAL\n    tilingNormalOffset(TilingNormalMap, uvNorm, TilingNormalMap_texMatrix, Tu, Tv, N);\n#endif\n#if defined( PRISMWOOD )\n#ifdef NO_UVW\n    vec3 p = vec3(0.0);\n#elif defined( USE_WOOD_CURLY_DISTORTION_MAP )\n    vec3 p = DistortCurly(vUvw);\n#else\n    vec3 p = vUvw;\n#endif\n#if !defined( NO_UVW ) && defined( PRISMWOODBUMP )\n    getFinalWoodContext(\n        N, V, Tu, Tv, p,\n        normal, vtNormal, vNormalMatrix\n    );\n#endif\n#endif\n    float NdotV = clamp(dot(N, V), EPSILON, 1.0);\n#if defined(PRISMLAYERED)\n    float N2dotV = clamp(dot(N2, V), EPSILON, 1.0);\n#endif\n    vec3 surfaceAlbedo;\n#prism_sample_texture<surface_albedo, surfaceAlbedo, false, true>\n    float surfaceRoughness;\n#prism_sample_texture<surface_roughness, surfaceRoughness, true, false>\n    float surfaceAnisotropy;\n#prism_sample_texture<surface_anisotropy, surfaceAnisotropy, true, false>\n    float surfaceRotation;\n#prism_sample_texture<surface_rotation, surfaceRotation, true, false>\n#if defined(PRISMOPAQUE)\n    float opaqueF0;\n#prism_sample_texture<opaque_f0, opaqueF0, true, false>\n    vec3 opaqueAlbedo;\n#prism_sample_texture<opaque_albedo, opaqueAlbedo, false, true>\n#elif defined(PRISMMETAL)\n    vec3 metalF0;\n#prism_sample_texture<metal_f0, metalF0, false, true>\n#elif defined(PRISMLAYERED)\n    float layeredF0;\n#prism_sample_texture<layered_f0, layeredF0, true, false>\n    vec3 layeredDiffuse;\n#prism_sample_texture<layered_diffuse, layeredDiffuse, false, true>\n    float layeredRoughness;\n#prism_sample_texture<layered_roughness, layeredRoughness, true, false>\n    float layeredAnisotropy;\n#prism_sample_texture<layered_anisotropy, layeredAnisotropy, true, false>\n    float layeredRotation;\n#prism_sample_texture<layered_rotation, layeredRotation, true, false>\n    vec3 bottom_f0;\n#prism_sample_texture<layered_bottom_f0, bottom_f0, false, true>\n    float layeredFraction;\n#prism_sample_texture<layered_fraction, layeredFraction, true, false>\n#elif defined( PRISMGLAZING )\n    vec3 glazingTransmissionColor;\n#prism_sample_texture<glazing_transmission_color, glazingTransmissionColor, false, true>\n    vec3 glazingF0;\n#prism_sample_texture<glazing_f0, glazingF0, false, true>\n    float glazingTransmissionRoughness;\n#prism_sample_texture<glazing_transmission_roughness, glazingTransmissionRoughness, true, false>\n    vec3 glazingAdjustedColor = TransmitAdjust(glazingTransmissionColor, glazingF0);\n    float glazingIlluminace = ColorToIlluminance(glazingAdjustedColor);\n    float transmissionAlpha = RoughnessToAlpha(glazingTransmissionRoughness, 0.0).x;\n    vec3 transmissionF = Fresnel_Rough(glazingF0, NdotV, transmissionAlpha);\n#elif defined(PRISMWOOD)\n    vec3 woodDiffuse = NoiseWood(p, surfaceRoughness);\n#endif\n    vec3 outRadianceLight = vec3(0.0);\n#if MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0\n    vec3 lightDirection[ MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS ];\n    vec3 lightColor[ MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS ];\n#if MAX_DIR_LIGHTS > 0\n    for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n        vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n        lightDirection[i] = normalize( lDirection.xyz );\n        lightColor[i] = SRGBToLinear(directionalLightColor[ i ]);\n    }\n#endif\n#if MAX_POINT_LIGHTS > 0\n    for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n        vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n        lightDirection[MAX_DIR_LIGHTS + i] = normalize( lVector );\n        float lDistance = 1.0;\n        if ( pointLightDistance[ i ] > 0.0 )\n            lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n        lightColor[MAX_DIR_LIGHTS + i] = SRGBToLinear(pointLightColor[ i ]) * lDistance;\n    }\n#endif\n#if MAX_SPOT_LIGHTS > 0\n    for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n        vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n        lightDirection[MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + i] = normalize( lVector );\n        float lDistance = 1.0;\n        if ( spotLightDistance[ i ] > 0.0 )\n            lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n        float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n        if ( spotEffect > spotLightAngleCos[ i ] )\n            spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n        lightColor[MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + i] = SRGBToLinear(spotLightColor[ i ]) * lDistance * spotEffect;\n    }\n#endif\n    for( int i = 0; i < MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS; i ++ ) {\n        vec3 L = lightDirection[i];\n        float NdotL = max(EPSILON, dot(N, L));\n        vec3 H = normalize(L + V);\n        float NdotH = dot(N, H);\n        float VdotH = dot(V, H);\n        float Hu = dot(H, Tu);\n        float Hv = dot(H, Tv);\n        vec3 Hlocal = vec3(Hu, Hv, NdotH);\n#if defined(PRISMLAYERED)\n        float N2dotL = dot(N2, L);\n        float N2dotH = dot(N2, H);\n        vec3 Hlocal2 = vec3(Hu, Hv, N2dotH);\n#endif\n        vec3 brdf = lightColor[i] *\n#if defined(PRISMOPAQUE)\n            BRDF_Opaque(Hlocal, NdotL, NdotH, NdotV, VdotH,\n                    surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                    opaqueF0, opaqueAlbedo);\n#elif defined(PRISMMETAL)\n            BRDF_Metal(Hlocal, NdotL, NdotH, NdotV, VdotH,\n                surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                metalF0);\n#elif defined(PRISMLAYERED)\n            BRDF_Layered(Hlocal, NdotL, NdotH, NdotV, VdotH, Hlocal2, N2dotL, N2dotH, N2dotV,\n                surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                layeredF0, layeredDiffuse, layeredRoughness, layeredAnisotropy,\n                layeredRotation, bottom_f0, layeredFraction);\n#elif defined(PRISMTRANSPARENT)\n            BRDF_Transparent(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation);\n#elif defined(PRISMGLAZING)\n            BRDF_Glazing(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                         glazingF0, glazingTransmissionColor, glazingIlluminace);\n#elif defined(PRISMWOOD)\n            BRDF_Wood(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, woodDiffuse);\n#endif\n        outRadianceLight += max(vec3(0.0), brdf);\n    }\n#endif\n    vec3 outRadianceEnv = vec3(0.0);\n#if defined( USE_ENVMAP )\n    outRadianceEnv =\n#if defined(PRISMOPAQUE)\n        Environment_Opaque(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness,\n                opaqueF0, opaqueAlbedo, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#elif defined(PRISMMETAL)\n        Environment_Metal(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, metalF0, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#elif defined(PRISMLAYERED)\n        Environment_Layered(N, V, clamp(NdotV, 0.0, 1.0), N2, clamp(N2dotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness,\n            layeredF0, surfaceAnisotropy, surfaceRotation, Tu, Tv, layeredDiffuse, layeredRoughness, layeredAnisotropy,\n            layeredRotation, bottom_f0, layeredFraction);\n#elif defined(PRISMTRANSPARENT)\n        Environment_Transparent(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#elif defined(PRISMGLAZING)\n        Environment_Glazing(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, Tu, Tv,\n            glazingF0, transmissionF, transmissionAlpha, glazingAdjustedColor, glazingIlluminace);\n#elif defined(PRISMWOOD)\n        Environment_Wood(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, woodDiffuse, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#endif\n#endif\n#if defined(PRISMOPAQUE)\n    vec3 luminanceModifier;\n#prism_sample_texture<opaque_luminance_modifier, luminanceModifier, false, true>\n    outRadianceEnv += luminanceModifier * opaque_luminance;\n#endif\n    float surface_cutout = 1.0;\n#prism_sample_texture<surface_cutout, surface_cutout, true, false>\n#if defined( USE_SURFACE_CUTOUT_MAP )\n    if(surface_cutout < 0.01) discard;\n#endif\n    gl_FragColor = vec4( outRadianceLight + outRadianceEnv, opacity*surface_cutout );\n#if TONEMAP_OUTPUT == 1\n    gl_FragColor.xyz = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * gl_FragColor.xyz);\n#elif TONEMAP_OUTPUT == 2\n    gl_FragColor.xyz = toneMapCanonFilmic_WithGamma(exposureBias * gl_FragColor.xyz);\n#endif\n#ifdef USE_FOG\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = smoothstep( fogNear, fogFar, depth );\n    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif\n#if defined(PRISMTRANSPARENT)\n    applyPrismTransparency(gl_FragColor, transparent_color, transparent_ior);\n    gl_FragColor.a *= surface_cutout;\n#ifdef USE_TILING\n    gl_FragColor.a *= v_TilingMap.a;\n#endif\n#elif defined( PRISMGLAZING )\n    applyPrismGlazingOpacity(gl_FragColor, transmissionF, transmissionAlpha, NdotV, glazingIlluminace);\n#ifdef USE_TILING\n    gl_FragColor.a *= v_TilingMap.a;\n#endif\n#endif\n#include<theming_frag>\n#include<final_frag>\n}\n"},function(e,t){e.exports="#include<shadowmap_decl_common>\nvarying float depth;\n#ifdef USE_SURFACE_CUTOUT_MAP\nvarying vec2 vUv;\n#else\n#ifdef USE_MAP\nvarying vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#ifdef USE_ALPHAMAP\nvarying vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#endif\nvoid passCutoutUVCoords() {\n#ifdef USE_SURFACE_CUTOUT_MAP\n    vUv = uv;\n#else\n#ifdef USE_MAP\n    vUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_ALPHAMAP\n    vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#endif\n}\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n    depth = -mvPosition.z;\n    passCutoutUVCoords();\n}\n"},function(e,t){e.exports="#include<shadowmap_decl_common>\nvarying float depth;\n#ifdef USE_SURFACE_CUTOUT_MAP\n#include<float3_average>\n#prism_uniforms<surface_cutout_map>\nvarying vec2 vUv;\n#else\n#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\nvarying vec2 vUvAlpha;\nuniform sampler2D alphaMap;\n#endif\n#endif\nuniform float shadowMinOpacity;\nvoid applyCutoutMaps() {\n    float opacity = 1.0;\n#ifdef USE_SURFACE_CUTOUT_MAP\n#prism_sample_texture<surface_cutout, opacity, true, false>\n#else\n#ifdef USE_MAP\n    opacity *= GET_MAP(vUv).a;\n#endif\n#ifdef USE_ALPHAMAP\n    opacity *= GET_ALPHAMAP(vUvAlpha).r;\n#endif\n#endif\n#if defined(USE_SURFACE_CUTOUT_MAP) || defined(USE_MAP) || defined(USE_ALPHAMAP)\n    if (opacity < shadowMinOpacity) discard;\n#endif\n}\nvoid main() {\n    float normalizedLinearDepth = (depth - shadowMapRangeMin) / shadowMapRangeSize;\n    float val = exp(shadowESMConstant * normalizedLinearDepth);\n#ifdef USE_HARD_SHADOWS\n    val = normalizedLinearDepth;\n#endif\n    applyCutoutMaps();\n    gl_FragColor = vec4(val, 0, 0, 1);\n}\n"},function(e,t){e.exports="#include<shadowmap_decl_vert>\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n#include<shadowmap_vert>\n}\n"},function(e,t){e.exports="#include<shadowmap_decl_frag>\nvoid main() {\n    float shadowIntensity = 0.5 * (1.0 - getShadowValue());\n    gl_FragColor = vec4(0.0, 0.0, 0.0, shadowIntensity);\n}\n"},function(e,t){e.exports="\r\n\r\n#include<line_decl_common>\r\n\r\nattribute vec2 fields1;\r\nattribute vec4 fields2;\r\nattribute vec4 flags4b;\r\nattribute vec4 layerVp4b;\r\n\r\n#ifdef HAS_ELLIPTICALS\r\nattribute vec3 extraParams;\r\n#endif\r\n\r\n#ifdef USE_INSTANCING\r\nattribute vec4 instFlags4b;\r\n#endif\r\n\r\nuniform mat4 mvpMatrix;\r\n\r\nuniform float pixelsPerUnit;\r\nuniform float aaRange;\r\nuniform float viewportId;\r\nuniform float swap;\r\n\r\n\r\n\r\n\r\n\r\n#ifdef HAS_LAYERS\r\nuniform sampler2D tLayerMask;\r\n#endif\r\n\r\n#ifdef SELECTION_RENDERER\r\nuniform sampler2D tSelectionTexture;\r\nuniform vec2 vSelTexSize;\r\n#endif\r\n\r\n#ifdef SELECTION_RENDERER\r\nuniform vec4 selectionColor;\r\n#endif\r\n\r\n#if NUM_CUTPLANES > 0\r\nvarying vec3 vWorldPosition;\r\n#endif\r\n\r\n#ifdef UNPACK_POSITIONS\r\nuniform sampler2D tIdColor;\r\nuniform vec2 vIdColorTexSize;\r\nuniform vec4 unpackXform;\r\nattribute vec2 uvIdColor;\r\nfloat unpackLineWeight(float w) {\r\n    if (w > 0.5) {\r\n        return - (w - 0.5) * 1024.0;\r\n    } else {\r\n        return w * max(unpackXform.x, unpackXform.y) * 2.0;\r\n    }\r\n}\r\nvec4 getVertexColor() {\r\n    float u = (uvIdColor.x + 0.5) / vIdColorTexSize.x;\r\n    return texture2D(tIdColor, vec2(u, 0.5));\r\n}\r\nvec4 getDbId() {\r\n    float u = (uvIdColor.y + 0.5) / vIdColorTexSize.x;\r\n    vec4 normDbId = texture2D(tIdColor, vec2(u, 0.5));\r\n    return normDbId * 255.0;\r\n}\r\n#else\r\nattribute vec4 color4b;\r\nattribute vec4 dbId4b;\r\nvec4 unpackXform;\r\nfloat unpackLineWeight(float w) {\r\n    return w;\r\n}\r\nvec4 getVertexColor() {\r\n    return color4b;\r\n}\r\nvec4 getDbId() {\r\n    return dbId4b;\r\n}\r\n#endif\r\n\r\n\r\nvec2 centralVertex;\r\nvec2 offsetPosition;\r\n\r\nvec2 cos_sin(const float angle) { return vec2(cos(angle), sin(angle)); }\r\n\r\nvoid min_max(inout vec2 minPt, inout vec2 maxPt, const vec2 p) {\r\n    minPt = min(minPt, p);\r\n    maxPt = max(maxPt, p);\r\n}\r\n\r\n#if defined(USE_INSTANCING)\r\nfloat getVertexId() { return instFlags4b.x; }\r\n#else\r\nfloat getVertexId() { return flags4b.x; }\r\n#endif\r\n\r\nbool isStartVertex() { return (getVertexId() < VBB_SEG_END_RIGHT); }\r\nbool isLeftVertex()  { float id = getVertexId(); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }\r\n\r\nstruct SegmentData { float angle, distAlong, distTotal, lineWidthHalf, lineType; };\r\nvoid decodeSegmentData(out SegmentData seg) {\r\n    seg.angle         = fields2.x * TAU - PI;\r\n    seg.distAlong     = fields2.y * max(unpackXform.x, unpackXform.y);\r\n    seg.distTotal     = fields2.w;\r\n    seg.lineWidthHalf = unpackLineWeight(fields2.z);\r\n    seg.lineType      = flags4b.z;\r\n}\r\n\r\nvoid strokeLineSegment() {\r\n    SegmentData seg; decodeSegmentData(seg);\r\n\r\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\r\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\r\n\r\n\r\n    float angleTransverse = seg.angle + isLeftSide * HALF_PI;\r\n    float lwAdjustment = fsHalfWidth + aaRange;\r\n    vec2 transverseOffset = cos_sin(angleTransverse) * lwAdjustment;\r\n    offsetPosition.xy += transverseOffset;\r\n\r\n\r\n\r\n\r\n    float distanceFromStart = max(isStartCapVertex, 0.0) * seg.distAlong;\r\n    vec2 along = distanceFromStart * cos_sin(seg.angle);\r\n    offsetPosition.xy += along;\r\n    centralVertex.xy  += along;\r\n\r\n\r\n    vec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseOffset.y, transverseOffset.x);\r\n    offsetPosition.xy -= moveOffset;\r\n    centralVertex.xy  -= moveOffset;\r\n\r\n\r\n\r\n\r\n    fsMultipurpose.x = (isStartCapVertex * lwAdjustment) + distanceFromStart;\r\n    fsMultipurpose.y = seg.distAlong;\r\n    fsMultipurpose.z = seg.distTotal;\r\n    fsMultipurpose.w = seg.lineType;\r\n\r\n    if (seg.lineWidthHalf < 0.0)\r\n        fsHalfWidth = -fsHalfWidth;\r\n}\r\n\r\n\r\n#ifdef HAS_TRIANGLE_GEOMS\r\nstruct TriangleData { vec2 p0, p1, p2; };\r\nvoid decodeTriangleData(out TriangleData tri) {\r\n\r\n    tri.p1 = vec2(fields2.x, fields2.y) * unpackXform.xy + unpackXform.zw;\r\n    tri.p2 = fields2.zw * unpackXform.xy + unpackXform.zw;\r\n}\r\n\r\nvoid strokeOneTriangle() {\r\n    TriangleData tri; decodeTriangleData(tri);\r\n\r\n\r\n\r\n\r\n\r\n\r\n    fsHalfWidth = 0.0;\r\n    fsMultipurpose.z = 0.0;\r\n\r\n\r\n\r\n\r\n\r\n    float vertexId = getVertexId();\r\n    if (vertexId == VBB_SEG_END_RIGHT)\r\n        offsetPosition.xy = tri.p1;\r\n    else if (vertexId == VBB_SEG_END_LEFT)\r\n        offsetPosition.xy = tri.p2;\r\n}\r\n#endif\r\n\r\n\r\n\r\n\r\n#ifdef HAS_RASTER_QUADS\r\nstruct TexQuadData { float angle; vec2 size; };\r\nvoid decodeTexQuadData(out TexQuadData quad) {\r\n    quad.angle     = fields2.x * TAU;\r\n    quad.size   = fields2.yz * max(unpackXform.x, unpackXform.y);\r\n}\r\n\r\nvoid strokeTexQuad() {\r\n    TexQuadData quad; decodeTexQuadData(quad);\r\n\r\n    vec2 corner = vec2(isLeftVertex() ? -1.0 : 1.0, isStartVertex() ? -1.0 : 1.0);\r\n\r\n    vec2 p      = 0.5 * corner * quad.size;\r\n    vec2 rot    = cos_sin(quad.angle);\r\n    vec2 offset = vec2(p.x * rot.x - p.y * rot.y, p.x * rot.y + p.y * rot.x);\r\n\r\n    offsetPosition.xy += offset;\r\n\r\n    fsMultipurpose.xy = max(vec2(0.0), corner);\r\n\r\n\r\n    fsMultipurpose.z = 1.0;\r\n    fsHalfWidth = 0.0;\r\n}\r\n#endif\r\n\r\n#if defined(HAS_CIRCLES) || defined(HAS_ELLIPTICALS)\r\nstruct ArcData { vec2 c; float start, end, major, minor, tilt; };\r\nvoid decodeArcData(out ArcData arc) {\r\n    arc.c     = fields1.xy * unpackXform.xy + unpackXform.zw;\r\n    arc.start = fields2.x * TAU;\r\n    arc.end   = fields2.y * TAU;\r\n    arc.major = fields2.w * max(unpackXform.x, unpackXform.y);\r\n#if defined(HAS_ELLIPTICALS)\r\n    arc.minor = extraParams.x;\r\n    arc.tilt  = extraParams.y * TAU;\r\n#endif\r\n}\r\n\r\nvoid strokeArc(const ArcData arc) {\r\n\r\n\r\n    float isStart = isStartVertex() ? -1.0 : 1.0;\r\n    float isLeft  = isLeftVertex()  ? -1.0 : 1.0;\r\n\r\n\r\n\r\n\r\n    vec2 minPt;\r\n    vec2 maxPt;\r\n\r\n    vec2 angles = vec2(arc.start, arc.end);\r\n    vec2 endsX = vec2(arc.c.x) + arc.major * cos(angles);\r\n    vec2 endsY = vec2(arc.c.y) + arc.minor * sin(angles);\r\n    minPt = maxPt = vec2(endsX.x, endsY.x);\r\n    min_max(minPt, maxPt, vec2(endsX.y, endsY.y));\r\n\r\n    if (arc.end > arc.start) {\r\n        if (arc.start < PI_0_5 && arc.end > PI_0_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));\r\n        }\r\n        if (arc.start < PI && arc.end > PI) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));\r\n        }\r\n        if (arc.start < PI_1_5 && arc.end > PI_1_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));\r\n        }\r\n    } else {\r\n\r\n        min_max(minPt, maxPt, vec2(arc.c.x + arc.major, arc.c.y));\r\n\r\n\r\n\r\n        if (arc.start < PI_0_5 || arc.end > PI_0_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));\r\n        }\r\n        if (arc.start < PI || arc.end > PI) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));\r\n        }\r\n        if (arc.start < PI_1_5 || arc.end > PI_1_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));\r\n        }\r\n    }\r\n\r\n    minPt -= fsHalfWidth + aaRange;\r\n    maxPt += fsHalfWidth + aaRange;\r\n\r\n    offsetPosition.x = (isStart < 0.0) ? minPt.x : maxPt.x;\r\n    offsetPosition.y = (isLeft < 0.0)  ? minPt.y : maxPt.y;\r\n\r\n\r\n\r\n\r\n\r\n    fsMultipurpose.x = arc.start;\r\n    fsMultipurpose.y = -arc.major;\r\n    fsMultipurpose.z = arc.end;\r\n    fsMultipurpose.w = arc.minor;\r\n}\r\n#endif\r\n\r\n#if defined(HAS_CIRCLES)\r\n\r\nvoid strokeCircularArc() {\r\n    ArcData arc; decodeArcData(arc);\r\n\r\n    float r = arc.major;\r\n    if (r * pixelsPerUnit < 0.125)\r\n        r = 0.25 * aaRange;\r\n    arc.major = arc.minor = r;\r\n\r\n    strokeArc(arc);\r\n}\r\n\r\n#endif\r\n\r\n#if defined(HAS_ELLIPTICALS)\r\nvoid strokeEllipticalArc() {\r\n    ArcData arc; decodeArcData(arc);\r\n    strokeArc(arc);\r\n}\r\n#endif\r\n\r\nstruct CommonAttribs { vec2 pos; vec4 color; vec2 layerTC, vpTC; float lineWidthHalf, geomType, ghosting; };\r\nvoid decodeCommonAttribs(out CommonAttribs attribs) {\r\n    attribs.pos           = fields1.xy * unpackXform.xy + unpackXform.zw;\r\n    attribs.color         = getVertexColor();\r\n    attribs.geomType      = flags4b.y;\r\n    attribs.layerTC       = layerVp4b.xy / 255.0;\r\n    attribs.vpTC          = layerVp4b.zw / 255.0;\r\n    attribs.lineWidthHalf = unpackLineWeight(fields2.z);\r\n    attribs.ghosting      = flags4b.w;\r\n}\r\n\r\nvoid strokeIndexedTriangle() {\r\n\r\n    fsHalfWidth = 0.0;\r\n    fsMultipurpose.z = 0.0;\r\n}\r\n\r\n#ifdef SELECTION_RENDERER\r\nbool isSelected(const CommonAttribs attribs) {\r\n\r\n\r\n    vec3 oid = getDbId().rgb;\r\n\r\n\r\n    float id01 = oid.r + oid.g * 256.0;\r\n    float t = (id01 + 0.5) * (1.0 / 4096.0);\r\n    float flrt = floor(t);\r\n    float texU = t - flrt;\r\n\r\n\r\n    float id23 = oid.b * (65536.0 / 4096.0) + flrt;\r\n    t = (id23 + 0.5) / vSelTexSize.y;\r\n    float texV = fract(t);\r\n\r\n    vec4 selBit = texture2D(tSelectionTexture, vec2(texU, texV));\r\n    return selBit.r == 1.0;\r\n}\r\n#endif\r\n\r\nbool isLayerOff(const CommonAttribs attribs) {\r\n#ifdef HAS_LAYERS\r\n    vec4 layerBit = texture2D(tLayerMask, attribs.layerTC);\r\n    return (layerBit.r == 0.0);\r\n#else\r\n    return false;\r\n#endif\r\n}\r\n\r\nvec4 getColor(const CommonAttribs attribs) {\r\n\r\n    if (isLayerOff(attribs)) { return vec4(0.0); }\r\n\r\n#ifdef SELECTION_RENDERER\r\n    if (isSelected(attribs)) { return selectionColor; }\r\n    return vec4(0.0);\r\n#else\r\n    return attribs.color;\r\n#endif\r\n}\r\n\r\nvoid main() {\r\n\r\n#ifndef UNPACK_POSITIONS\r\n    unpackXform = vec4(1.0, 1.0, 0.0, 0.0);\r\n#endif\r\n\r\n    CommonAttribs attribs; decodeCommonAttribs(attribs);\r\n\r\n    fsColor = getColor(attribs);\r\n\r\n    if (swap != 0.0 ) {\r\n\r\n        if ( fsColor.r == 0.0 && fsColor.g == 0.0 && fsColor.b == 0.0 )\r\n            fsColor.rgb = vec3(1.0,1.0,1.0);\r\n\r\n        else if ( fsColor.r == 1.0 && fsColor.g == 1.0 && fsColor.b == 1.0 )\r\n            fsColor.rgb = vec3(0.0,0.0,0.0);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    centralVertex = offsetPosition = attribs.pos;\r\n\r\n    float lineWeight = attribs.lineWidthHalf;\r\n    if (lineWeight > 0.0) {\r\n\r\n\r\n        if(lineWeight < 0.5 / pixelsPerUnit) {\r\n            lineWeight = 0.5 / pixelsPerUnit;\r\n        }\r\n    }\r\n    else {\r\n\r\n\r\n        lineWeight = abs(lineWeight) / pixelsPerUnit;\r\n    }\r\n\r\n    fsHalfWidth = lineWeight;\r\n\r\n    dbId = getDbId() / 255.0;\r\n\r\n    fsVpTC     = attribs.vpTC;\r\n    fsGhosting = attribs.ghosting;\r\n\r\n    if      (attribs.geomType == VBB_GT_LINE_SEGMENT)     strokeLineSegment();\r\n#ifdef HAS_CIRCLES\r\n    else if (attribs.geomType == VBB_GT_ARC_CIRCULAR)     strokeCircularArc();\r\n#endif\r\n#ifdef HAS_ELLIPTICALS\r\n    else if (attribs.geomType == VBB_GT_ARC_ELLIPTICAL)   strokeEllipticalArc();\r\n#endif\r\n#ifdef HAS_RASTER_QUADS\r\n    else if (attribs.geomType == VBB_GT_TEX_QUAD)         strokeTexQuad();\r\n#endif\r\n#ifdef HAS_TRIANGLE_GEOMS\r\n    else if (attribs.geomType == VBB_GT_ONE_TRIANGLE)     strokeOneTriangle();\r\n#endif\r\n    else if (attribs.geomType == VBB_GT_TRIANGLE_INDEXED) strokeIndexedTriangle();\r\n\r\n\r\n\r\n    fsOffsetDirection = offsetPosition - centralVertex;\r\n\r\n\r\n    gl_Position = mvpMatrix * modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\r\n\r\n\r\n#if NUM_CUTPLANES > 0\r\n    vec4 worldPosition = modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\r\n    vWorldPosition = worldPosition.xyz;\r\n#endif\r\n}\r\n"},function(e,t){e.exports="\r\n\r\n\r\n#include<line_decl_common>\r\n\r\nuniform highp float pixelsPerUnit;\r\nuniform highp float aaRange;\r\n\r\nuniform float opacity;\r\nuniform highp float viewportId;\r\nuniform highp float swap;\r\nuniform highp float grayscale;\r\n\r\n#ifdef HAS_RASTER_QUADS\r\nuniform sampler2D tRaster;\r\n#endif\r\n\r\n#ifdef HAS_LINESTYLES\r\nuniform sampler2D tLineStyle;\r\nuniform vec2 vLineStyleTexSize;\r\n#endif\r\n\r\n#if defined(MRT_ID_BUFFER) || defined(MODEL_COLOR)\r\nuniform vec3 modelId;\r\n#endif\r\n\r\n\r\nfloat curveGaussian(float r, float invWidth) {\r\n    float amt = clamp(r * invWidth, 0.0, 1.0);\r\n\r\n    float exponent = amt * 2.0;\r\n\r\n    return exp(-exponent*exponent);\r\n\r\n\r\n\r\n}\r\n\r\n#ifdef HAS_LINESTYLES\r\nfloat getLinePatternPixel(int i, int j) {\r\n\r\n    return texture2D(tLineStyle, (vec2(i, j) + 0.5) / vLineStyleTexSize).x * 255.0;\r\n}\r\n\r\nfloat getPatternLength(int whichPattern) {\r\n    float p1 = getLinePatternPixel(0, whichPattern);\r\n    float p2 = getLinePatternPixel(1, whichPattern);\r\n    return (p2 * 256.0 + p1);\r\n}\r\n#endif\r\n\r\n\r\nvoid fillLineSegment() {\r\n\r\n    float radius = abs(fsHalfWidth);\r\n    float parametricDistance = fsMultipurpose.x;\r\n    float segmentLength      = fsMultipurpose.y;\r\n    float totalDistance      = fsMultipurpose.z;\r\n\r\n\r\n#ifdef HAS_LINESTYLES\r\n    int whichPattern         = int(fsMultipurpose.w);\r\n\r\n    if (whichPattern > 0) {\r\n        const float TEX_TO_UNIT = 1.0 / 96.0;\r\n\r\n\r\n\r\n\r\n        float LTSCALE = 1.0;\r\n        float patternScale;\r\n\r\n\r\n\r\n        if (fsHalfWidth < 0.0) {\r\n            patternScale = LTSCALE;\r\n        } else {\r\n            patternScale = LTSCALE * TEX_TO_UNIT * pixelsPerUnit;\r\n        }\r\n\r\n        float patLen = patternScale * getPatternLength(whichPattern);\r\n        float phase = mod((totalDistance + parametricDistance) * pixelsPerUnit, patLen);\r\n\r\n        bool onPixel = true;\r\n        float radiusPixels = radius * pixelsPerUnit;\r\n\r\n        for (int i=2; i<MAX_LINESTYLE_LENGTH; i+=2) {\r\n\r\n            float on = getLinePatternPixel(i, whichPattern);\r\n            if (on == 1.0) on = 0.0;\r\n            on *= patternScale;\r\n\r\n            onPixel = true;\r\n            phase -= on;\r\n            if (phase < 0.0) {\r\n                break;\r\n            }\r\n            else if (phase <= radiusPixels) {\r\n                onPixel = false;\r\n                break;\r\n            }\r\n\r\n            float off = getLinePatternPixel(i+1, whichPattern);\r\n            if (off <= 1.0) off = 0.0;\r\n            off *= patternScale;\r\n\r\n            onPixel = false;\r\n            phase -= off;\r\n            if (phase < -radiusPixels)\r\n                discard;\r\n            if (phase <= 0.0)\r\n                break;\r\n        }\r\n\r\n\r\n\r\n\r\n        if (!onPixel && (abs(phase) <= radiusPixels)) {\r\n            segmentLength = 0.0;\r\n            parametricDistance = phase / pixelsPerUnit;\r\n        }\r\n    }\r\n#endif\r\n\r\n\r\n\r\n\r\n    float dist;\r\n    float offsetLength2 = dot(fsOffsetDirection, fsOffsetDirection);\r\n\r\n\r\n\r\n\r\n    float ltz = max(0.0, sign(-parametricDistance));\r\n    float gtsl = max(0.0, sign(parametricDistance - segmentLength));\r\n    float d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\r\n    dist = sqrt(max(0.0, offsetLength2 + d*d));\r\n\r\n\r\n\r\n\r\n    float range =  dist - radius;\r\n\r\n    if (range > aaRange) {\r\n        discard;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    gl_FragColor = fsColor;\r\n    gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\r\n}\r\n\r\n#ifdef HAS_CIRCLES\r\nvoid fillCircularArc() {\r\n\r\n    float dist   = length(fsOffsetDirection);\r\n    vec2 angles  = fsMultipurpose.xz;\r\n    float radius = abs(fsMultipurpose.y);\r\n    float range  =  abs(dist - radius);\r\n    range -= fsHalfWidth;\r\n\r\n\r\n\r\n    if (range > aaRange) {\r\n        discard;\r\n    }\r\n\r\n    vec2 direction = fsOffsetDirection;\r\n    float angle = atan(direction.y, direction.x);\r\n\r\n\r\n\r\n\r\n    if (angles.x > angles.y) {\r\n\r\n        if (angle > angles.x && angle < PI) {\r\n                angle -= TAU;\r\n        }\r\n        angles.x -= TAU;\r\n\r\n\r\n\r\n        if (angle < angles.x ) {\r\n            angle += TAU;\r\n        }\r\n    }\r\n    else if (angle < 0.0)\r\n        angle += TAU;\r\n\r\n\r\n    if (angle > angles.x && angle < angles.y) {\r\n        gl_FragColor = fsColor;\r\n        gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\r\n    }\r\n    else {\r\n        discard;\r\n    }\r\n\r\n}\r\n#endif\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n#ifdef HAS_ELLIPTICALS\r\n\r\n\r\n\r\n\r\n\r\n\r\nfloat EllipticalApprox(\r\n        const int iters,\r\n        inout float t0, inout float t1,\r\n        const vec2 y,   out   vec2 x,\r\n        const vec2 e,   const vec2 ey, const vec2 esqr\r\n        ) {\r\n    vec2 r;\r\n    for (int i = 0; i < 10; ++i) {\r\n        if(i >= iters) break;\r\n\r\n        float t = mix(t0, t1, 0.5);\r\n        r = ey / (vec2(t) + esqr);\r\n\r\n        vec2 rsq = r * r;\r\n        float f = rsq.x + rsq.y - 1.0;\r\n\r\n        if(f > 0.0) { t0 = t; } else { t1 = t; }\r\n    }\r\n\r\n    x = e * r;\r\n    return distance(x, y);\r\n}\r\n\r\nfloat DistancePointEllipseSpecial (vec2 e, vec2 y, out vec2 x, float width, float aaRange) {\r\n    float dist;\r\n\r\n\r\n    vec2 esqr = e * e;\r\n    vec2 ey   = e * y;\r\n    float t0 = -esqr[1] + ey[1];\r\n    float t1 = -esqr[1] + length(ey);\r\n\r\n\r\n\r\n    dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);\r\n\r\n\r\n    if (dist > max(2.0 * (width + aaRange), e[0] * 0.05))\r\n        return dist;\r\n\r\n\r\n    dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);\r\n\r\n\r\n\r\n\r\n    float ecc = 1.0 +  0.1 * e[0] / e[1];\r\n\r\n    if (dist > max(ecc * (width + aaRange), e[0] * 0.001))\r\n        return dist;\r\n    if (dist < (width - aaRange) / ecc)\r\n        return dist;\r\n\r\n\r\n\r\n\r\n    dist = EllipticalApprox(10, t0, t1, y, x, e, ey, esqr);\r\n    return dist;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nfloat DistancePointEllipse(vec2 e, vec2 y, out vec2 locX, float width, float aaRange) {\r\n    vec2 locE, locY;\r\n\r\n\r\n\r\n\r\n    float diff = sign(e[0] - e[1]);\r\n    vec2 swizzle = vec2(max(diff, 0.0), -min(diff, 0.0));\r\n    locE.x = dot(e, swizzle.xy);\r\n    locE.y = dot(e, swizzle.yx);\r\n    locY.x = dot(y, swizzle.xy);\r\n    locY.y = dot(y, swizzle.yx);\r\n\r\n\r\n    vec2 refl = sign(locY);\r\n    locY *= refl;\r\n\r\n    vec2 x;\r\n    float distance = DistancePointEllipseSpecial(locE, locY, x, width, aaRange);\r\n\r\n    x *= refl;\r\n\r\n    locX.x = dot(x, swizzle.xy);\r\n    locX.y = dot(x, swizzle.yx);\r\n\r\n    return distance;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nvoid fillEllipticalArc() {\r\n    vec2 angles = fsMultipurpose.xz;\r\n    vec2 radii  = abs(fsMultipurpose.yw);\r\n    vec2 dir    = fsOffsetDirection;\r\n\r\n\r\n\r\n\r\n    vec2 pos;\r\n    float range = DistancePointEllipse(radii, dir, pos, fsHalfWidth, aaRange);\r\n    range -= fsHalfWidth;\r\n\r\n    if (range > aaRange)\r\n        discard;\r\n\r\n    float ar = radii[0] / radii[1];\r\n\r\n\r\n\r\n\r\n    float angle = atan(ar * pos.y, pos.x);\r\n\r\n\r\n\r\n\r\n    if (angles.x > angles.y) {\r\n\r\n        if (angle > angles.x && angle < PI) {\r\n            angle -= TAU;\r\n        }\r\n        angles.x -= TAU;\r\n\r\n\r\n\r\n        if (angle < angles.x ) {\r\n            angle += TAU;\r\n        }\r\n    }\r\n    else if (angle < 0.0)\r\n        angle += TAU;\r\n\r\n\r\n    if (angle > angles.x && angle < angles.y) {\r\n        gl_FragColor = fsColor;\r\n        gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\r\n    }\r\n    else {\r\n        discard;\r\n    }\r\n}\r\n#endif\r\n\r\n#ifdef HAS_RASTER_QUADS\r\nvoid fillTexQuad() { gl_FragColor = texture2D(tRaster, fsMultipurpose.xy); }\r\n#endif\r\n\r\nvoid fillTriangle() { gl_FragColor = fsColor; }\r\n\r\n#if NUM_CUTPLANES > 0\r\nvarying highp vec3 vWorldPosition;\r\n#endif\r\n\r\n#include<cutplanes>\r\n\r\nvoid main() {\r\n\r\n\r\n\r\n\r\n\r\n    if (fsColor == vec4(0.0)) {\r\n        discard;\r\n    }\r\n\r\n\r\n    if (fsHalfWidth == 0.0) {\r\n#ifdef HAS_RASTER_QUADS\r\n        if (fsMultipurpose.z != 0.0)\r\n            fillTexQuad();\r\n        else\r\n#endif\r\n            fillTriangle();\r\n    }\r\n    else if (fsMultipurpose.y < 0.0) {\r\n#ifdef HAS_CIRCLES\r\n#ifdef HAS_ELLIPTICALS\r\n        if (abs(fsMultipurpose.y) == fsMultipurpose.w)\r\n#endif\r\n            fillCircularArc();\r\n#endif\r\n#ifdef HAS_ELLIPTICALS\r\n#ifdef HAS_CIRCLES\r\n        else\r\n#endif\r\n            fillEllipticalArc();\r\n#endif\r\n    }\r\n    else\r\n        fillLineSegment();\r\n\r\n\r\n#ifdef MRT_NORMALS\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    gl_FragData[1] = vec4(0.0);\r\n#endif\r\n\r\n\r\n\r\n\r\n\r\n\r\n    float writeId = 1.0;\r\n\r\n\r\n\r\n\r\n    if (fsGhosting != 0.0 || \r\n            ((viewportId != 0.0) && (abs(fsVpTC.x * 255.0 + fsVpTC.y) >= 0.5 && abs(fsVpTC.x * 255.0 + fsVpTC.y - viewportId) >= 0.5))) {\r\n\r\n        writeId = 0.0;\r\n\r\n\r\n\r\n        gl_FragColor.a *= opacity * ((swap == 1.0) ? 0.21 : 0.1);\r\n    } else {\r\n\r\n        gl_FragColor.a *= opacity;\r\n    }\r\n\r\n#ifndef SELECTION_RENDERER\r\n\r\n    if (grayscale != 0.0) {\r\n        const vec3 rgb2grey = vec3(0.299, 0.587, 0.114);\r\n        float gray = dot(gl_FragColor.rgb, rgb2grey);\r\n        gl_FragColor.rgb = vec3(gray);\r\n    }\r\n#endif\r\n\r\n#if NUM_CUTPLANES > 0\r\n    checkCutPlanes(vWorldPosition);\r\n#endif\r\n\r\n#include<id_frag>\r\n}\r\n"},function(e,t){e.exports="\n#include<line_decl_common>\nattribute vec2 fields1;\nattribute vec4 fields2;\nattribute vec4 flags4b;\nattribute vec4 layerVp4b;\n#ifdef USE_INSTANCING\nattribute vec4 instFlags4b;\n#endif\nuniform mat4 mvpMatrix;\nuniform float pixelsPerUnit;\nuniform float aaRange;\nuniform vec2 size;\nuniform float viewportId;\nuniform float swap;\n#ifdef HAS_LAYERS\nuniform sampler2D tLayerMask;\n#endif\n#ifdef SELECTION_RENDERER\nuniform sampler2D tSelectionTexture;\nuniform vec2 vSelTexSize;\n#endif\n#ifdef SELECTION_RENDERER\nuniform vec4 selectionColor;\n#endif\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef UNPACK_POSITIONS\nuniform sampler2D tIdColor;\nuniform vec2 vIdColorTexSize;\nuniform vec4 unpackXform;\nattribute vec2 uvIdColor;\nfloat unpackLineWeight(float w) {\n    if (w > 0.5) {\n        return - (w - 0.5) * 1024.0;\n    } else {\n        return w * max(unpackXform.x, unpackXform.y) * 2.0;\n    }\n}\nvec4 getVertexColor() {\n    float u = (uvIdColor.x + 0.5) / vIdColorTexSize.x;\n    return texture2D(tIdColor, vec2(u, 0.5));\n}\nvec4 getDbId() {\n    float u = (uvIdColor.y + 0.5) / vIdColorTexSize.x;\n    vec4 normDbId = texture2D(tIdColor, vec2(u, 0.5));\n    return normDbId * 255.0;\n}\n#else\nattribute vec4 color4b;\nattribute vec4 dbId4b;\nvec4 unpackXform;\nfloat unpackLineWeight(float w) {\n    return w;\n}\nvec4 getVertexColor() {\n    return color4b;\n}\nvec4 getDbId() {\n    return dbId4b;\n}\n#endif\nvec2 centralVertex;\nvec2 offsetPosition;\nvec2 offsetPosDepth;\nvec2 cos_sin(const float angle) { return vec2(cos(angle), sin(angle)); }\nvoid min_max(inout vec2 minPt, inout vec2 maxPt, const vec2 p) {\n    minPt = min(minPt, p);\n    maxPt = max(maxPt, p);\n}\n#if defined(USE_INSTANCING)\nfloat getVertexId() { return instFlags4b.x; }\n#else\nfloat getVertexId() { return flags4b.x; }\n#endif\nbool isStartVertex() { return (getVertexId() < VBB_SEG_END_RIGHT); }\nbool isLeftVertex()  { float id = getVertexId(); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }\nstruct SegmentData { float angle, distAlong, distTotal, lineWidthHalf, lineType; };\nvoid decodeSegmentData(out SegmentData seg) {\n    seg.angle         = fields2.x * TAU - PI;\n    seg.distAlong     = fields2.y * max(unpackXform.x, unpackXform.y);\n    seg.distTotal     = fields2.w;\n    seg.lineWidthHalf = unpackLineWeight(fields2.z);\n    seg.lineType      = flags4b.z;\n}\nvoid strokeLineSegment() {\n    SegmentData seg; decodeSegmentData(seg);\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\n    vec4 startPosition = (mvpMatrix * modelMatrix * vec4(centralVertex.xy, 0.0, 1.0));\n    float distanceAlong = seg.distAlong;\n    vec2 along = distanceAlong * cos_sin(seg.angle);\n    vec4 endPosition = (mvpMatrix * modelMatrix * vec4(centralVertex.xy + along, 0.0, 1.0));\n    vec2 screenStart = startPosition.xy * 0.5 * size / startPosition.w;\n    vec2 screenEnd = endPosition.xy * 0.5 * size / endPosition.w;\n    if (isStartCapVertex < 0.0) {\n        offsetPosition = centralVertex = screenStart;\n        offsetPosDepth = startPosition.zw;\n    } else {\n        offsetPosition = centralVertex = screenEnd;\n        offsetPosDepth = endPosition.zw;\n    }\n    vec2 screenDelta = screenEnd - screenStart;\n    float screenAngle = atan(screenDelta.y, screenDelta.x);\n    float angleTransverse = screenAngle - isLeftSide * HALF_PI;\n    float lwAdjustment = fsHalfWidth + aaRange;\n    vec2 transverseOffset = cos_sin(angleTransverse) * lwAdjustment;\n    offsetPosition += transverseOffset;\n    vec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseOffset.y, transverseOffset.x);\n    offsetPosition += moveOffset;\n    centralVertex += moveOffset;\n    float distanceFromStart = max(0.0, isStartCapVertex) * length(screenDelta);\n    fsMultipurpose.x = (isStartCapVertex * lwAdjustment) + distanceFromStart;\n    fsMultipurpose.y = length(screenDelta);\n    fsMultipurpose.z = seg.distTotal;\n    fsMultipurpose.w = seg.lineType;\n    if (seg.lineWidthHalf < 0.0)\n        fsHalfWidth = -fsHalfWidth;\n    fsOffsetDirection = offsetPosition - centralVertex;\n    gl_Position = vec4(2.0 * offsetPosition / size * offsetPosDepth.y, offsetPosDepth.xy);\n}\nstruct CommonAttribs { vec2 pos; vec4 color; vec2 layerTC, vpTC; float lineWidthHalf, geomType, ghosting; };\nvoid decodeCommonAttribs(out CommonAttribs attribs) {\n    attribs.pos           = fields1.xy * unpackXform.xy + unpackXform.zw;\n    attribs.color         = getVertexColor();\n    attribs.geomType      = flags4b.y;\n    attribs.layerTC       = layerVp4b.xy / 255.0;\n    attribs.vpTC          = layerVp4b.zw / 255.0;\n    attribs.lineWidthHalf = unpackLineWeight(fields2.z);\n    attribs.ghosting      = flags4b.w;\n}\nvoid strokeIndexedTriangle() {\n    fsHalfWidth = 0.0;\n    fsMultipurpose.z = 0.0;\n    gl_Position = (mvpMatrix * modelMatrix * vec4(centralVertex.xy, 0.0, 1.0));\n}\n#ifdef SELECTION_RENDERER\nbool isSelected(const CommonAttribs attribs) {\n    vec3 oid = getDbId().rgb;\n    float id01 = oid.r + oid.g * 256.0;\n    float t = (id01 + 0.5) * (1.0 / 4096.0);\n    float flrt = floor(t);\n    float texU = t - flrt;\n    float id23 = oid.b * (65536.0 / 4096.0) + flrt;\n    t = (id23 + 0.5) / vSelTexSize.y;\n    float texV = fract(t);\n    vec4 selBit = texture2D(tSelectionTexture, vec2(texU, texV));\n    return selBit.r == 1.0;\n}\n#endif\nbool isLayerOff(const CommonAttribs attribs) {\n#ifdef HAS_LAYERS\n    vec4 layerBit = texture2D(tLayerMask, attribs.layerTC);\n    return (layerBit.r == 0.0);\n#else\n    return false;\n#endif\n}\nvec4 getColor(const CommonAttribs attribs) {\n    if (isLayerOff(attribs)) { return vec4(0.0); }\n#ifdef SELECTION_RENDERER\n    if (isSelected(attribs)) { return selectionColor; }\n    return vec4(0.0);\n#else\n    return attribs.color;\n#endif\n}\nvoid main() {\n#ifndef UNPACK_POSITIONS\n    unpackXform = vec4(1.0, 1.0, 0.0, 0.0);\n#endif\n    CommonAttribs attribs; decodeCommonAttribs(attribs);\n    fsColor = getColor(attribs);\n    if (swap != 0.0 ) {\n        if ( fsColor.r == 0.0 && fsColor.g == 0.0 && fsColor.b == 0.0 )\n            fsColor.rgb = vec3(1.0,1.0,1.0);\n        else if ( fsColor.r == 1.0 && fsColor.g == 1.0 && fsColor.b == 1.0 )\n            fsColor.rgb = vec3(0.0,0.0,0.0);\n    }\n    centralVertex = offsetPosition = attribs.pos;\n    float lineWeight = attribs.lineWidthHalf;\n    if (lineWeight > 0.0) {\n        lineWeight = max(0.5, lineWeight * pixelsPerUnit);\n    }\n    else {\n        lineWeight = max(0.5, abs(lineWeight));\n    }\n    fsHalfWidth = lineWeight;\n    dbId = dbId4b / 255.0;\n    fsVpTC     = attribs.vpTC;\n    fsGhosting = attribs.ghosting;\n    if      (attribs.geomType == VBB_GT_LINE_SEGMENT)     strokeLineSegment();\n    else strokeIndexedTriangle();\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n}\n"},function(e,t){e.exports="\n#include<line_decl_common>\nuniform highp float pixelsPerUnit;\nuniform highp float aaRange;\nuniform float opacity;\nuniform highp float viewportId;\nuniform highp float swap;\nuniform highp float grayscale;\n#ifdef HAS_LINESTYLES\nuniform sampler2D tLineStyle;\nuniform vec2 vLineStyleTexSize;\n#endif\n#if defined(MRT_ID_BUFFER) || defined(MODEL_COLOR)\nuniform vec3 modelId;\n#endif\nfloat curveGaussian(float r, float width) {\n    float amt = clamp(abs(r / (width * 1.0)), 0.0, 1.0);\n    amt = max(amt - 0.0, 0.0);\n    float exponent = amt * 2.0;\n    return clamp(exp(-exponent*exponent), 0.0, 1.0);\n}\n#ifdef HAS_LINESTYLES\nfloat getLinePatternPixel(int i, int j) {\n    return texture2D(tLineStyle, (vec2(i, j) + 0.5) / vLineStyleTexSize).x * 255.0;\n}\nfloat getPatternLength(int whichPattern) {\n    float p1 = getLinePatternPixel(0, whichPattern);\n    float p2 = getLinePatternPixel(1, whichPattern);\n    return (p2 * 256.0 + p1);\n}\n#endif\nvoid fillLineSegment() {\n    float radius = abs(fsHalfWidth);\n    float parametricDistance = fsMultipurpose.x;\n    float segmentLength      = fsMultipurpose.y;\n    float totalDistance      = fsMultipurpose.z;\n#ifdef HAS_LINESTYLES\n    int whichPattern         = int(fsMultipurpose.w);\n    if (whichPattern > 0) {\n        const float TEX_TO_UNIT = 1.0 / 96.0;\n        float LTSCALE = 1.0;\n        float patternScale;\n        if (fsHalfWidth < 0.0) {\n            patternScale = LTSCALE;\n        } else {\n            patternScale = LTSCALE * TEX_TO_UNIT * pixelsPerUnit;\n        }\n        float patLen = patternScale * getPatternLength(whichPattern);\n        float phase = mod((totalDistance + parametricDistance), patLen);\n        bool onPixel = true;\n        float radiusPixels = radius + aaRange;\n        for (int i=2; i<MAX_LINESTYLE_LENGTH; i+=2) {\n            float on = getLinePatternPixel(i, whichPattern);\n            if (on == 1.0) on = 0.0;\n            on *= patternScale;\n            onPixel = true;\n            phase -= on;\n            if (phase < 0.0) {\n                break;\n            }\n            else if (phase <= radiusPixels) {\n                onPixel = false;\n                break;\n            }\n            float off = getLinePatternPixel(i+1, whichPattern);\n            if (off <= 1.0) off = 0.0;\n            off *= patternScale;\n            onPixel = false;\n            phase -= off;\n            if (phase < -radiusPixels)\n                discard;\n            if (phase <= 0.0)\n                break;\n        }\n        if (!onPixel && (abs(phase) <= radiusPixels)) {\n            segmentLength = 0.0;\n            parametricDistance = phase;\n        }\n    }\n#endif\n    float dist;\n    float offsetLength2 = dot(fsOffsetDirection, fsOffsetDirection);\n    float ltz = max(0.0, sign(-parametricDistance));\n    float gtsl = max(0.0, sign(parametricDistance - segmentLength));\n    float d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\n    dist = sqrt(max(0.0, offsetLength2 + d*d));\n    float range =  dist - radius;\n    if (range > aaRange) {\n        discard;\n    }\n    gl_FragColor = fsColor;\n    if (range > -aaRange)\n        gl_FragColor.a *= curveGaussian(range+aaRange, aaRange * 2.0);\n}\nvoid fillTriangle() { gl_FragColor = fsColor; }\n#if NUM_CUTPLANES > 0\nvarying highp vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nvoid main() {\n    if (fsColor == vec4(0.0)) {\n        discard;\n    }\n    if (fsHalfWidth == 0.0) {\n        fillTriangle();\n    }\n    else\n        fillLineSegment();\n#ifdef MRT_NORMALS\n    gl_FragData[1] = vec4(0.0);\n#endif\n    float writeId = 1.0;\n    if (fsGhosting != 0.0 || \n            ((viewportId != 0.0) && (abs(fsVpTC.x * 255.0 + fsVpTC.y) >= 0.5 && abs(fsVpTC.x * 255.0 + fsVpTC.y - viewportId) >= 0.5))) {\n        writeId = 0.0;\n        gl_FragColor.a *= opacity * ((swap == 1.0) ? 0.21 : 0.1);\n    } else {\n        gl_FragColor.a *= opacity;\n    }\n#ifndef SELECTION_RENDERER\n    if (grayscale != 0.0) {\n        const vec3 rgb2grey = vec3(0.299, 0.587, 0.114);\n        float gray = dot(gl_FragColor.rgb, rgb2grey);\n        gl_FragColor.rgb = vec3(gray);\n    }\n#endif\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n#include<id_frag>\n}\n"},function(e,t){e.exports="varying vec3 vNormal;\nvarying float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<pack_normals>\n#include<instancing_decl_vert>\nvoid main() {\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    vNormal = normalize( transformedNormal );\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    depth = mvPosition.z;\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n}\n"},function(e,t){e.exports="varying highp vec3 vNormal;\nvarying highp float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 n = vNormal;\n    n = n * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n    n = normalize( n );\n    gl_FragColor = vec4(n.x, n.y, depth, 1.0);\n}\n"},function(e,t){e.exports="\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<instancing_decl_vert>\nvoid main() {\n    vec3 instPos = getInstancePos(position);\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n}"},function(e,t){e.exports="\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nuniform vec4 color;\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    gl_FragColor = color;\n}"},function(e,t){e.exports="\n#define EDGE_SHARPNESS     (3.0)\n#define SCALE               (2)\n#define R                   (4)\n#define VALUE_TYPE        float\n#define VALUE_COMPONENTS   r\n#define VALUE_IS_KEY       0\n#define KEY_COMPONENTS     gb\n#if __VERSION__ >= 330\nconst float gaussian[R + 1] =\nfloat[](0.153170, 0.144893, 0.122649, 0.092902, 0.062970);\n#endif\nuniform sampler2D   tDiffuse;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform vec2       axis;\nuniform float radius;\n#define  result         gl_FragColor.VALUE_COMPONENTS\n#define  keyPassThrough gl_FragColor.KEY_COMPONENTS\nfloat unpackKey(vec2 p) {\n    return p.x + p.y * (1.0 / 255.0);\n}\nvarying vec2 vUv;\nvoid main() {\n#   if __VERSION__ < 330\n    float gaussian[R + 1];\n#       if R == 3\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902;\n#       elif R == 4\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902; gaussian[4] = 0.062970;\n#       elif R == 6\n    gaussian[0] = 0.111220; gaussian[1] = 0.107798; gaussian[2] = 0.098151; gaussian[3] = 0.083953; gaussian[4] = 0.067458; gaussian[5] = 0.050920; gaussian[6] = 0.036108;\n#       endif\n#   endif\n    ivec2 axisi = ivec2(axis);\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 temp = texture2D(tDiffuse, vUv);\n    gl_FragColor.gb = temp.KEY_COMPONENTS;\n    gl_FragColor.a = temp.a;\n    VALUE_TYPE sum = temp.VALUE_COMPONENTS;\n    if (temp.a == 0.0) {\n        result = sum;\n        return;\n    }\n    float key = unpackKey(keyPassThrough);\n    float BASE = gaussian[0];\n    float totalWeight = BASE;\n    sum *= totalWeight;\n    float scale = 1.5 / radius;\n    int r = -4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r=-1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    const float epsilon = 0.0001;\n    result = sum / (totalWeight + epsilon);\n}\n"},function(e,t){e.exports="uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraInvNearFar;\n#include <pack_depth>\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    float depth = texture2D(tDiffuse, ssP).z;\n    if (depth != 0.0)\n        depth = (depth + cameraNear) * cameraInvNearFar;\n    gl_FragColor = packDepth(depth);\n}\n"},function(e,t){e.exports="uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    gl_FragColor = texture2D(tDiffuse, ssP);\n}\n"},function(e,t){e.exports="uniform vec2 uResolution;\nvarying vec2 vPos;\nvarying vec4 vPosPos;\nvoid main() {\n    vPos = uv;\n    vPosPos.xy = uv + vec2(-0.5, -0.5) * uResolution;\n    vPosPos.zw = uv + vec2( 0.5,  0.5) * uResolution;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},function(e,t){e.exports="#define FXAA_EDGE_SHARPNESS (8.0)\n#define FXAA_EDGE_THRESHOLD (0.125)\n#define FXAA_EDGE_THRESHOLD_MIN (0.05)\n#define FXAA_RCP_FRAME_OPT (0.50)\n#define FXAA_RCP_FRAME_OPT2 (2.0)\nuniform sampler2D tDiffuse;\nuniform highp vec2 uResolution;\nvarying vec2 vPos;\nvarying vec4 vPosPos;\nfloat FxaaLuma(vec3 rgb) {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nvoid main() {\n    float lumaNw = FxaaLuma(texture2D(tDiffuse, vPosPos.xy).rgb);\n    float lumaSw = FxaaLuma(texture2D(tDiffuse, vPosPos.xw).rgb);\n    float lumaNe = FxaaLuma(texture2D(tDiffuse, vPosPos.zy).rgb) + 1.0/384.0;\n    float lumaSe = FxaaLuma(texture2D(tDiffuse, vPosPos.zw).rgb);\n    vec4 rgbaM = texture2D(tDiffuse, vPos.xy);    \n    float lumaM = FxaaLuma(rgbaM.rgb);\n    float lumaMax = max(max(lumaNe, lumaSe), max(lumaNw, lumaSw));\n    float lumaMin = min(min(lumaNe, lumaSe), min(lumaNw, lumaSw));\n    float lumaMaxSubMinM = max(lumaMax, lumaM) - min(lumaMin, lumaM);\n    float lumaMaxScaledClamped = max(FXAA_EDGE_THRESHOLD_MIN, lumaMax * FXAA_EDGE_THRESHOLD);\n    if (lumaMaxSubMinM < lumaMaxScaledClamped) {\n        gl_FragColor = rgbaM;\n        return;\n    }\n    float dirSwMinusNe = lumaSw - lumaNe;\n    float dirSeMinusNw = lumaSe - lumaNw;\n    vec2 dir1 = normalize(vec2(dirSwMinusNe + dirSeMinusNw, dirSwMinusNe - dirSeMinusNw));\n    vec3 rgbN1 = texture2D(tDiffuse, vPos.xy - dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;\n    vec3 rgbP1 = texture2D(tDiffuse, vPos.xy + dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;\n    float dirAbsMinTimesC = min(abs(dir1.x), abs(dir1.y)) * FXAA_EDGE_SHARPNESS;\n    vec2 dir2 = clamp(dir1.xy / dirAbsMinTimesC, -2.0, 2.0);\n    vec3 rgbN2 = texture2D(tDiffuse, vPos.xy - dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;\n    vec3 rgbP2 = texture2D(tDiffuse, vPos.xy + dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;\n    vec3 rgbA = rgbN1 + rgbP1;\n    vec3 rgbB = ((rgbN2 + rgbP2) * 0.25) + (rgbA * 0.25);\n    float lumaB = FxaaLuma(rgbB);\n    float alpha = rgbaM.a;\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        gl_FragColor = vec4(rgbA * 0.5, rgbaM.a);\n    else\n        gl_FragColor = vec4(rgbB, rgbaM.a);\n}\n"},function(e,t){e.exports="#extension GL_OES_standard_derivatives : enable\n#include<depth_texture>\nuniform sampler2D tDiffuse;\nuniform sampler2D tID;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform sampler2D tFill;\nuniform sampler2D tPaper;\nuniform int style;\nuniform int idEdges;\nuniform int normalEdges;\nuniform int depthEdges;\nuniform float brightness;\nuniform float contrast;\nuniform int grayscale;\nuniform int preserveColor;\nuniform float levels;\nuniform float repeats;\nuniform float rotation;\nuniform sampler2D tGraphite1;\nuniform sampler2D tGraphite2;\nuniform sampler2D tGraphite3;\nuniform sampler2D tGraphite4;\nuniform sampler2D tGraphite5;\nuniform sampler2D tGraphite6;\nuniform sampler2D tGraphite7;\nuniform sampler2D tGraphite8;\nvarying vec2 vUv;\nvec4 recoverNZ(vec4 nrmz) {\n    float z = sqrt(1.0 - dot(nrmz.xy, nrmz.xy));\n    nrmz.w = -(nrmz.z + cameraNear) / (cameraFar - cameraNear);\n    nrmz.z = z;\n    return nrmz;\n}\n#include<tonemap>\n#include<hsv>\nvec3 quantize(vec3 c) {\n    float L = max(c.r, max(c.g, c.b));\n    c *= floor(L * (levels-1.0) + 0.5) / (L * (levels-1.0));\n    return c;\n}\nvec3 quantizeRGB(vec3 c) {\n    c *= c;\n    c *= floor(c * levels * 0.9999) / (levels-1.0);\n    return sqrt(c);\n}\nvec3 clampHue(vec3 c, float hues, float sats, float vals) {\n    vec3 hsv = rgb2hsv(c);\n    hsv.x = floor(hsv.x * hues + 0.5) / hues;\n    hsv.y = floor(hsv.y * sats + 0.5) / sats;\n    hsv.z = floor(hsv.z * vals + 0.5) / vals;\n    vec3 col = hsv2rgb(hsv);\n    return col;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nint isObjectEdge() {\n    vec4 MM = texture2D(tID, vUv);\n    vec4 LL = texture2D(tID, vUv + vec2(-1.0, -1.0) * resolution);\n    if (MM != LL) return 1;\n    vec4 LM = texture2D(tID, vUv + vec2( 0.0, -1.0) * resolution);\n    if (MM != LM) return 1;\n    vec4 LR = texture2D(tID, vUv + vec2( 1.0, -1.0) * resolution);\n    if (MM != LR) return 1;\n    vec4 ML = texture2D(tID, vUv + vec2(-1.0,  0.0) * resolution);\n    if (MM != ML) return 1;\n    vec4 MR = texture2D(tID, vUv + vec2( 1.0,  0.0) * resolution);\n    if (MM != MR) return 1;\n    vec4 UL = texture2D(tID, vUv + vec2(-1.0,  1.0) * resolution);\n    if (MM != UL) return 1;\n    vec4 UM = texture2D(tID, vUv + vec2( 0.0,  1.0) * resolution);\n    if (MM != UM) return 1;\n    vec4 UR = texture2D(tID, vUv + vec2( 1.0,  1.0) * resolution);\n    if (MM != UR) return 1;\n    return (MM.x + MM.y + MM.z + MM.w) >= 4.0 ? 0 : -1;\n}\nconst float r = 1.0;\nfloat normalDiff(vec3 n1, vec3 n2) {\n    float d = dot(n1.xyz, n2.xyz);\n    return acos(clamp(d, -1.0, 1.0));\n}\nint isNormalDepthEdge() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 MM = texture2D(tDepth, vUv);\n    vec4 LL = texture2D(tDepth, vUv + vec2(-r, -r) * resolution);\n    vec4 LM = texture2D(tDepth, vUv + vec2( 0.0, -r) * resolution);\n    vec4 LR = texture2D(tDepth, vUv + vec2( r, -r) * resolution);\n    vec4 ML = texture2D(tDepth, vUv + vec2(-r,  0.0) * resolution);\n    vec4 MR = texture2D(tDepth, vUv + vec2( r,  0.0) * resolution);\n    vec4 UL = texture2D(tDepth, vUv + vec2(-r, r) * resolution);\n    vec4 UM = texture2D(tDepth, vUv + vec2( 0.0,  r) * resolution);\n    vec4 UR = texture2D(tDepth, vUv + vec2( r,  r) * resolution);\n    LL = recoverNZ(LL);\n    LM = recoverNZ(LM);\n    LR = recoverNZ(LR);\n    ML = recoverNZ(ML);\n    MM = recoverNZ(MM);\n    MR = recoverNZ(MR);\n    UL = recoverNZ(UL);\n    UM = recoverNZ(UM);\n    UR = recoverNZ(UR);\n    float dd = 0.0;\n    if ( depthEdges == 1 ) {\n        float G = (abs(UL.w - MM.w) + 2.0 * abs(UM.w - MM.w) + abs(UR.w - MM.w) + 2.0 * abs(ML.w - MM.w) + 2.0 * abs(MR.w - MM.w) + abs(LL.w - MM.w) + 2.0 * abs(LM.w - MM.w) + abs(LR.w - MM.w));\n        dd = abs(dFdx(G)) + abs(dFdy(G));\n    }\n    float Gn = 0.0;\n    if ( normalEdges == 1 ) {\n        float pLL = normalDiff(LL.xyz, MM.xyz);\n        float pLM = normalDiff(LM.xyz, MM.xyz);\n        float pLR = normalDiff(LR.xyz, MM.xyz);\n        float pML = normalDiff(ML.xyz, MM.xyz);\n        float pMM = normalDiff(MM.xyz, MM.xyz);\n        float pMR = normalDiff(MR.xyz, MM.xyz);\n        float pUL = normalDiff(UL.xyz, MM.xyz);\n        float pUM = normalDiff(UM.xyz, MM.xyz);\n        float pUR = normalDiff(UR.xyz, MM.xyz);\n        Gn = (abs(pUL - pMM) + 2.0 * abs(pUM - pMM) + abs(pUR - pMM) + 2.0 * abs(pML - pMM) + 2.0 * abs(pMR - pMM) + abs(pLL - pMM) + 2.0 * abs(pLM - pMM) + abs(pLR - pMM));\n    }\n    \n    return (dd > 0.004 || Gn > 2.0) ? 1 : 0;\n}\nvec3 computeGraphite( vec3 color, vec2 loc ) {\n    float lum = 0.299 * color.r + 0.587 * color.g + 0.114 * color.b;\n    float offset;\n    vec3 col1, col2;\n    if ( lum > 6.0/7.0 ) {\n        col1 = texture2D(tGraphite1, loc ).xyz;\n        col2 = texture2D(tGraphite2, loc ).xyz;\n        offset = 6.0/7.0;\n    } else if ( lum > 5.0/7.0 ) {\n        col1 = texture2D(tGraphite2, loc ).xyz;\n        col2 = texture2D(tGraphite3, loc ).xyz;\n        offset = 5.0/7.0;\n    } else if ( lum > 4.0/7.0 ) {\n        col1 = texture2D(tGraphite3, loc ).xyz;\n        col2 = texture2D(tGraphite4, loc ).xyz;\n        offset = 4.0/7.0;\n    } else if ( lum > 3.0/7.0 ) {\n        col1 = texture2D(tGraphite4, loc ).xyz;\n        col2 = texture2D(tGraphite5, loc ).xyz;\n        offset = 3.0/7.0;\n    } else if ( lum > 2.0/7.0 ) {\n        col1 = texture2D(tGraphite5, loc ).xyz;\n        col2 = texture2D(tGraphite6, loc ).xyz;\n        offset = 2.0/7.0;\n    } else if ( lum > 1.0/7.0 ) {\n        col1 = texture2D(tGraphite6, loc ).xyz;\n        col2 = texture2D(tGraphite7, loc ).xyz;\n        offset = 1.0/7.0;\n    } else {\n        col1 = texture2D(tGraphite7, loc ).xyz;\n        col2 = texture2D(tGraphite8, loc ).xyz;\n        offset = 0.0;\n    }\n    if ( col1.r == 0.0 && col2.r == 0.0 ) {\n        return vec3(lum,lum,lum);\n    }\n    float t = (lum-offset)*7.0;\n    return (col1 * t + col2 * (1.0 - t));\n}\nvec3 colorWithAdjustments() {\n    vec3 sceneRGB = texture2D(tDiffuse, vUv).xyz;\n    if ( brightness != 0.0 || contrast != 0.0) {\n        if ( brightness < 0.0 )\n        {\n            sceneRGB = sceneRGB * (1.0 + brightness);\n        }\n        else\n        {\n            sceneRGB = sceneRGB + ((1.0 - sceneRGB) * brightness);\n        }\n        float slant = tan(( clamp(contrast,-1.0,1.0) + 1.0) * 3.141592/4.001);\n        sceneRGB = (sceneRGB - 0.5) * slant + 0.5;\n        if ( preserveColor == 1 )\n        {\n            float maxval = max( sceneRGB.r, sceneRGB.g );\n            maxval = max( maxval, sceneRGB.b );\n            if ( maxval > 1.0 )\n            {\n                sceneRGB /= maxval;\n            }\n        }\n        sceneRGB = clamp(sceneRGB,0.0,1.0);\n    }\n    if ( grayscale == 1 ) {\n        sceneRGB.rgb = vec3(luminance_post(sceneRGB.rgb));\n    }\n    return sceneRGB;\n}\nvoid main() {\n    int foundEdge = 0;\n    foundEdge = ( idEdges == 1 && isObjectEdge() == 1 ) ? 1 : 0;\n    if ( foundEdge == 0 && (normalEdges == 1 || depthEdges == 1) ) {\n        foundEdge = isNormalDepthEdge();\n    }\n    vec2 loc = vec2((vUv.x-0.5)*(resolution.y/resolution.x),vUv.y-0.5)*repeats;\n    if ( style > 2 && rotation != 0.0 ) {\n        float rot = 3.14159*rotation;\n        float sinr = sin(rot);\n        float cosr = cos(rot);\n        loc = vec2(loc.x*cosr + -loc.y*sinr, loc.x*sinr + loc.y*cosr);\n    }\n    loc += vec2(0.5,0.5);\n    vec3 color;\n    if ( style == 2 ) {\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            gl_FragColor = vec4(quantize(colorWithAdjustments()),1.0);\n        }\n    } else if ( style == 3 ) {\n        color = colorWithAdjustments();\n        vec3 graphColor = computeGraphite( color, loc );\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.16,0.16,0.16,1.0) + vec4(0.18 * graphColor,0.0);\n        } else {\n            gl_FragColor = vec4(graphColor,1.0);\n        }\n        return;\n    } else if ( style == 4 ) {\n        float fill = texture2D(tFill, loc ).r;\n        float paperStrength = 0.3;\n        vec3 paper = texture2D(tPaper, loc ).rgb;\n        paper = paperStrength * paper + (1.0-paperStrength)*vec3(1.0,1.0,1.0);\n        if ( foundEdge == 1 ) {\n            gl_FragColor = 0.75 * vec4(paper * fill, 1.0);\n        } else {\n            fill = pow(fill,1.6);\n            gl_FragColor = vec4(colorWithAdjustments() * (1.0 - fill) + paper * fill, 1.0);\n        }\n    } else {\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            gl_FragColor = vec4(colorWithAdjustments(),1.0);\n        }\n        return;        \n    }\n}\n"},function(e,t){e.exports="uniform sampler2D tDiffuse;\nuniform sampler2D tAO;\nuniform int useAO;\nuniform float aoOpacity;\nuniform sampler2D tOverlay;\nuniform int useOverlay;\nuniform vec2 resolution;\nuniform int objID;\nuniform vec4 objIDv4;\nuniform sampler2D tID;\n#if defined(USE_MODEL_ID)\nuniform vec2 modelIDv2;\nuniform sampler2D tID2;\n#endif\nuniform float highlightIntensity;\nuniform vec3 selectionColor;\nuniform int highlightRange;\nuniform int objIDStart;\nuniform int objIDEnd;\n#ifdef IS_2D\nuniform float expand2dSelection;\n#endif\nuniform sampler2D tCrossFadeTex0;\nuniform sampler2D tCrossFadeTex1;\nuniform float     crossFadeOpacity0;\nuniform float     crossFadeOpacity1;\nvarying vec2 vUv;\n#ifdef SPATIAL_FILTER\n#include<depth_texture>\n#endif\n#include<tonemap>\nbool isSelected(vec3 C) {\n    float minS = min(selectionColor.r, min(selectionColor.g, selectionColor.b));\n    float maxS = max(selectionColor.r, max(selectionColor.g, selectionColor.b));\n    float satS = maxS - minS;\n    float minC = min(C.r, min(C.g, C.b));\n    float maxC = max(C.r, max(C.g, C.b));\n    float satC = maxC - minC;\n    if (satC < .01 || satS < .01)\n        return false;\n    vec3 S = (selectionColor - minS) / satS;\n    vec3 H = (C - minC) / satC;\n    vec3 D = H - S;\n    float eps = .15;\n    return (abs(D.r) + abs(D.g) + abs(D.b) < eps)\n        || (maxC >= (1.0 - eps) && D.r >= -eps && D.g >= -eps && D.b >= -eps);\n}\nvec4 overlayEdgeDetect(vec2 vUv) {\n#define IS_SELECTION(C) isSelected((C).rgb)\n#ifdef IS_2D\n#define MAX_ALPHA(c)\n#define SUM_ALPHA(c, w) sumAlpha += c.a * w; sumWeight += w;\n#else\n#define MAX_ALPHA(c) maxAlpha = max(maxAlpha, c.a);\n#define SUM_ALPHA(c, w) \n#endif\n#define CHECK_EDGE_ALPHA(I, J, W)     { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a > 0.0 && IS_SELECTION(c)) { hasEdge++; SUM_ALPHA(c, W) selectionPixel = c; } }\n#ifndef IS_2D\n#define CHECK_EDGE_SELECTION(I, J) { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a <= 0.0) hasEdge++; }\n#endif\n    int hasEdge = 0;\n    vec4 center = texture2D(tOverlay, vUv);\n    vec4 selectionPixel = vec4(0.0);\n#ifdef IS_2D\n    float sumAlpha = 0.0, sumWeight = 0.0;\n#else\n    float maxAlpha = 0.0;\n    bool paintOutline = false;\n#endif\n    if (center.a <= 0.0) {\n        CHECK_EDGE_ALPHA(-1.0,-1.0, 1.0);\n        CHECK_EDGE_ALPHA( 0.0,-1.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0,-1.0, 1.0);\n        CHECK_EDGE_ALPHA(-1.0, 0.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0, 0.0, 2.0);\n        CHECK_EDGE_ALPHA(-1.0, 1.0, 1.0);\n        CHECK_EDGE_ALPHA( 0.0, 1.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0, 1.0, 1.0);\n        if (hasEdge != 0) {\n#ifdef IS_2D\n            center.a = -clamp(expand2dSelection - 1.0 + sumAlpha / sumWeight, 0.0, 1.0);\n            center.rgb = center.a < 0.0 ? selectionPixel.rgb : center.rgb;\n#else\n            center = selectionPixel;\n            paintOutline = true;\n#endif\n        }\n    }\n    else if (center.a > 0.0 && IS_SELECTION(center)) {\n#ifdef IS_2D\n        center.a = -clamp(center.a + expand2dSelection, 0.0, 1.0);\n#else\n        CHECK_EDGE_SELECTION(-1.0,-1.0);\n        CHECK_EDGE_SELECTION( 0.0,-1.0);\n        CHECK_EDGE_SELECTION( 1.0,-1.0);\n        CHECK_EDGE_SELECTION(-1.0, 0.0);\n        CHECK_EDGE_SELECTION( 1.0, 0.0);\n        CHECK_EDGE_SELECTION(-1.0, 1.0);\n        CHECK_EDGE_SELECTION( 0.0, 1.0);\n        CHECK_EDGE_SELECTION( 1.0, 1.0);\n        if (hasEdge != 0)\n            paintOutline = true;\n        else\n            center.a = -center.a;\n#endif\n    }\n#ifndef IS_2D\n    if (paintOutline) {\n        float maxComponent = max(center.r, max(center.g, center.b));\n        center.rgb /= maxComponent;\n        center.rgb = sqrt(center.rgb);\n        center.a = 0.5 + 0.5 * maxAlpha * 0.125 * float(hasEdge);\n    }\n#endif\n    return center;\n}\n#ifdef SPATIAL_FILTER\nSPATIAL_FILTER\n#endif\nvec4 sampleColor() {\n    return texture2D( tDiffuse, vUv );\n}\nfloat sampleAO() {\n    return (useAO != 0) ? sqrt(texture2D(tAO, vUv).r) : 1.0;\n}\nvec3 applyCrossFade(vec3 srcColor, sampler2D fadeTex, float opacity, vec2 vUv) {\n    vec4 blendCol = texture2D(fadeTex, vUv);\n    return mix(srcColor.rgb, blendCol.rgb, blendCol.a * opacity);\n}\nvoid applyHighlighting(inout vec3 rgb, float filterValue) {\n#ifdef IS_2D\n    rgb = mix(rgb, vec3(1.0,1.0,0.0), filterValue * highlightIntensity * 0.25);\n#else\n    rgb += filterValue * highlightIntensity * 0.20;\n#endif\n}\nvoid main() {\n    vec4 texel = sampleColor();\n    float ao = sampleAO();\n    #ifdef NUM_CROSSFADE_TARGETS\n        #if (NUM_CROSSFADE_TARGETS > 1)\n            #if (TARGET_FADE_MODE == 0)\n                texel.rgb = applyCrossFade(texel.rgb, tCrossFadeTex0, crossFadeOpacity0, vUv);\n                texel.rgb = applyCrossFade(texel.rgb, tCrossFadeTex1, crossFadeOpacity1, vUv);\n            #else\n                vec4 t0 = texture2D(tCrossFadeTex0, vUv);\n                vec4 t1 = texture2D(tCrossFadeTex1, vUv);\n                vec4 mixed = mix(t0, t1, crossFadeOpacity1);\n                texel.rgb = mix(texel.rgb, mixed.rgb, mixed.a);\n                float aoGamma = 1.0 + 3.0 * (1.0 - 2.0 * abs(crossFadeOpacity1 - 0.5));\n                if (aoGamma == 0.0)\n                    aoGamma = 1.0;\n                ao = pow(ao, 1.0 / aoGamma);\n            #endif\n        #else\n            vec4 mixed = texture2D(tCrossFadeTex0, vUv);\n            texel.rgb = mix(texel.rgb, mixed.rgb, mixed.a);\n        #endif\n    #else\n    #endif\n    ao = 1.0 - (1.0 - ao) * aoOpacity;\n    texel.rgb *= ao;\n    if (useOverlay != 0) {\n        vec4 overlay = overlayEdgeDetect(vUv);\n        if (overlay.a < 0.0) {\n            overlay.a = -overlay.a;\n#ifdef IS_2D\n            overlay.a *= 0.75;\n#else\n            if (overlay.a >= 0.99) {\n                overlay.a = 0.75;\n                texel.rgb = vec3(luminance_post(texel.rgb));\n            }\n#endif\n        }\n        texel.rgb = mix(texel.rgb, sqrt(overlay.rgb), overlay.a);\n    }\n    if (highlightRange == 0) {\n        if (objID != 0) {\n        vec4 idAtPixel = texture2D(tID, vUv);\n        #ifdef SPATIAL_FILTER\n            vec3 worldPos = reconstructWorldPosition(gl_FragCoord.xy, vUv);\n            float filterValue = (spatialFilter(worldPos) ? 1.0 : 0.0);\n            if (idAtPixel != vec4(1,1,1,1)) {\n                applyHighlighting(texel.rgb, filterValue);\n            }\n        #else\n#if defined(USE_MODEL_ID)\n            vec4 modelAtPixel = texture2D(tID2, vUv);\n            idAtPixel.a = modelAtPixel.b;\n            vec4 idDelta = abs(idAtPixel.rgba - objIDv4.rgba);\n            vec2 modelDelta = abs(modelAtPixel.rg - modelIDv2.rg);\n#else\n            vec4 idDelta = vec4(abs(idAtPixel.rgb - objIDv4.rgb), 0.0);\n            vec2 modelDelta = vec2(0.0, 0.0);\n#endif\n            if (max(max(modelDelta.r, modelDelta.g), max(max(idDelta.r, idDelta.g), max(idDelta.b, idDelta.a))) < 1e-3) {\n                applyHighlighting(texel.rgb, 1.0);\n            }\n        #endif\n        }\n    } else {\n        vec4 idAtPixel = texture2D(tID, vUv);\n        int dbId = int(idAtPixel.r * 255.0 + idAtPixel.g * 255.0 * 256.0 + idAtPixel.b * 255.0 * 256.0 * 256.0);\n        if (dbId >= objIDStart && dbId <= objIDEnd) {\n            applyHighlighting(texel.rgb, 1.0);\n        }\n    }\n    gl_FragColor = texel;\n}\n"},function(e,t){e.exports="uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n    gl_FragColor = texture2D(tDiffuse, vUv);\n}\n"},function(e,t){e.exports="uniform vec4 color;\nvoid main() {\n    gl_FragColor = color;\n}\n"},function(e,t){e.exports="\nuniform sampler2D tHighlight1;\nuniform sampler2D tHighlight0;\nuniform vec4 edgeColor;\nvarying vec2 vUv;\nvoid main() {\n    vec4 top = texture2D(tHighlight0, vUv);\n    vec4 base = texture2D(tHighlight1, vUv);\n    gl_FragColor = all(lessThan(abs(base - edgeColor), vec4(1.0e-2))) ?  base : (base * (1.0 - top.a) + top);\n}\n"},function(e,t){e.exports="\n#include<instancing_decl_vert>\nvarying vec4 finalColor;\nuniform vec3 color;\nuniform float opacity;\nvoid main() {\n    gl_Position = projectionMatrix * (viewMatrix * vec4(getInstancePos(position), 1.0));\n    finalColor = vec4(color, opacity);\n}\n"},function(e,t){e.exports="precision lowp float;\nvarying vec4 finalColor;\nvoid main() {\n    gl_FragColor = finalColor;\n}\n"},function(e,t){e.exports="#define HIGHLIGHT_NONE 0\n#define HIGHLIGHT_A 1\n#define HIGHLIGHT_B 2\n#define MIN_DIFF_VAL 0.5\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform float splitPosition;\nuniform int model;\nuniform int highlight;\nuniform vec2 resolution1;\nuniform vec2 resolution2;\nuniform float diff_threshold;\nvarying vec2 vUvA;\nvarying vec2 vUvB;\nconst int BIT_COUNT = 2;\nint modi(int x, int y) {\n    return x - y * (x / y);\n}\nint and(int a, int b) {\n    int result = 0;\n    int n = 1;\n    for(int i = 0; i < BIT_COUNT; i++) {\n        if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\n            result += n;\n        }\n        a = a / 2;\n        b = b / 2;\n        n = n * 2;\n        if(!(a > 0 && b > 0)) {\n            break;\n        }\n    }\n    return result;\n}\nfloat toGrayscale(vec4 v) {\n    return dot(v.rgb, vec3(0.299, 0.587, 0.114));\n}\nvoid main() {\n#ifdef SINGLE_MODEL\n    vec4 tex = texture2D(texture1, vUvA);\n    #ifdef SPLIT_VIEW\n    if (model == 1 && gl_FragCoord.x < splitPosition ||\n        model == 2 && gl_FragCoord.x >= splitPosition) {\n        gl_FragColor = tex;\n    } else {\n        discard;\n    }\n    #else\n    float gray = toGrayscale(tex);\n    gl_FragColor.rgb = vec3(gray);\n    #endif\n#else\n    vec4 tex1 = texture2D(texture1, vUvA);\n    vec4 tex2 = texture2D(texture2, vUvB);\n    #ifdef SPLIT_VIEW\n    gl_FragColor = gl_FragCoord.x < splitPosition ? tex1 : tex2;\n    #else\n    float gray1 = toGrayscale(tex1);\n    float gray2 = toGrayscale(tex2);\n    float maxGray = min(gray1, gray2);\n    float delta = gray1 - gray2;\n    gl_FragColor.rgb = vec3(maxGray);\n    if (abs(delta) > diff_threshold) {\n        if (delta < 0.0 && and(highlight, HIGHLIGHT_A) == HIGHLIGHT_A) {\n            gl_FragColor = vec4(max(gray2, MIN_DIFF_VAL), 0.0, 0.0, 1.0);\n        } else if (delta > 0.0 && and(highlight, HIGHLIGHT_B) == HIGHLIGHT_B) {\n            gl_FragColor = vec4(0.0, 0.0, max(gray1, MIN_DIFF_VAL), 1.0);\n        }\n    }\n        #ifdef ADD_THICKENING\n    else {\n        bool found = false;\n        for (int i = 0; i < 3; i++) {\n            for (int j = 0; j < 3; j++) {\n                if (i != 1 && j != 1) {\n                    vec4 nTex1 = texture2D(texture1, vUvA + resolution1*vec2(i - 1, j - 1));\n                    vec4 nTex2 = texture2D(texture2, vUvB + resolution2*vec2(i - 1, j - 1));\n                    float nGray1 = toGrayscale(nTex1);\n                    float nGray2 = toGrayscale(nTex2);\n                    delta = nGray1 - nGray2;\n                    if (abs(delta) > diff_threshold) {\n                        if (delta < 0.0 && and(highlight, HIGHLIGHT_A) == HIGHLIGHT_A) {\n                            gl_FragColor = vec4(1.25*max(nGray2, MIN_DIFF_VAL), 0.25, 0.25, 1.0);\n                        } else if (delta > 0.0 && and(highlight, HIGHLIGHT_B) == HIGHLIGHT_B) {\n                            gl_FragColor = vec4(0.25, 0.25, 1.25*max(nGray1, MIN_DIFF_VAL), 1.0);\n                        }\n                        found = true;\n                        break;\n                    }\n                }\n            }\n            if (found) break;\n        }\n    }\n        #endif\n    #endif\n#endif\n}"},function(e,t){e.exports="varying vec2 vUvA;\nvarying vec2 vUvB;\nuniform vec4 uvTFa;\nuniform vec4 uvTFb;\nuniform vec4 offsetRepeatA;\nuniform vec4 offsetRepeatB;\nvoid main() {\n    vUvA = uv*offsetRepeatA.zw + offsetRepeatA.xy;\n   \n#ifndef SINGLE_MODEL\n    float x = (uv.x - uvTFa.x) / uvTFa.z;\n    float y = (uv.y - uvTFa.y) / uvTFa.w;\n    vec2 uvB;\n    uvB.x = uvTFb.x + x*uvTFb.z;\n    uvB.y = uvTFb.y + y*uvTFb.w;\n    vUvB = uvB * offsetRepeatB.zw + offsetRepeatB.xy;\n#endif\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},function(e,t,n){function i(t,n){for(var i in t)t.hasOwnProperty(i)&&(e.exports[i]=t[i],n&&(e.exports[n][i]=t[i]))}e.exports.Autodesk=n(242).Autodesk;var r=Object.assign||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};e.exports.THREE=n(0),e.exports.av={},e.exports.avp={},e.exports.avu={},e.exports.ave={},i({Hammer:n(90)},"av"),i(n(3),"av"),i(n(3),"avp"),i(n(11),"avp"),i(n(11),"av"),i(n(48),"avp"),i(n(48),"av"),i(n(68),"avp"),i(n(9),"av"),i(n(93),"avp"),i(n(1),"avp"),i(n(14),"avp"),i(n(117),"avp"),i(n(84),"avp"),i(n(111),"avp"),i(n(253),"avp"),i(n(254),"avp"),i(n(94),"avp"),i(n(15),"avp"),i(n(85),"avp"),i(n(118),"avp"),i(n(104),"avp"),i(n(22),"avp"),i(n(73),"avp"),i(n(69),"avp"),i(n(43),"avp"),i(n(45),"avp"),i(n(72),"avp"),i(n(106),"avp"),i(n(124),"avp"),i(n(103),"avp"),i(n(21),"avp"),i(n(5),"avp"),i(n(13),"avp"),i(n(44),"avp"),i(n(10),"avp"),i(n(17),"avp"),i(n(37),"avp"),i(n(40),"avp"),i(n(74),"avp"),i(n(255),"avp"),i(n(70),"avp"),i(n(119),"avp"),i(n(29),"avp"),i(n(97),"avp"),i(n(112),"avp"),i(n(120),"avp"),i(n(121),"avp"),i(n(122),"avp"),i(n(51),"avp"),i(n(54),"avp"),i(n(125),"avp"),i(n(123),"avp"),i(n(108),"avp"),i(n(27),"avp"),i(n(95),"avp"),i(n(50),"avp"),i(n(71),"avp"),i(n(256),"avp"),i(n(75),"av"),i(n(98),"avp"),i(n(126),"avp"),i(n(87),"avp"),i(n(76),"avp"),i(n(96),"avp"),i(n(257),"avp"),i(n(317),"avp"),i(n(7),"av"),i(n(4),"av"),i(n(12),"avp"),i(n(92),"avp"),i(n(127),"avp"),i(n(86),"avp"),i(n(47),"av"),i(n(26),"av"),i(n(32),"av"),i(n(18),"av"),i(n(39),"av"),i(n(258),"av"),i(n(2),"av"),i(n(53),"av"),i(n(20),"avp"),i(n(128),"avp"),i(n(166),"avp"),i(n(52),"av"),i(n(77),"av"),i(n(130),"avp"),i(n(57),"av"),i(n(139),"avp"),i(n(99),"avp"),i(n(259),"av"),i(n(260),"av"),i(n(143),"av"),i(n(83),"avp"),i(n(261),"avp");var o=e.exports.av.MeasureCommon={};r(o,n(38)),o.MeasurementTypes=n(46).MeasurementTypes,o.SnapType=n(6).SnapType,o.Events=n(262).MeasureEvents,o.Measurement=n(263).Measurement,o.SnapResult=n(100).SnapResult,o.Snapper=n(318).Snapper,i(n(25),"avp"),i(n(156),"avp"),i(n(142),"avp"),i(n(60),"av"),i(n(105),"av"),i(n(140),"avp"),i(n(141),"avp"),i(n(30),"av"),i(n(132),"av"),i(n(131),"av"),i(n(134),"av"),i(n(133),"av"),i(n(61),"av"),i(n(264),"av"),i(n(135),"av"),i(n(144),"av"),i(n(145),"av"),i(n(146),"av"),i(n(138),"av"),i(n(137),"avp"),i(n(265),"avp"),i(n(136),"avp"),i(n(319),"avp"),i(n(266),"avp"),i(n(129),"avp"),i(n(58),"avp"),i(n(33),"avp"),i(n(316),"avp"),i(n(66),"avp"),i(n(267),"avp"),i(n(24),"avp"),i(n(34),"av"),i(n(268),"av"),n(269),i(n(148),"avu"),i(n(101),"avu"),i(n(62),"avu"),i(n(149),"avu"),i(n(16),"avp"),i(n(28),"avu"),i(n(150),"avp"),i(n(307),"avp"),i(n(63),"avp"),i(n(67),"avp"),i(n(64),"avu"),i(n(49),"avu"),i(n(114),"avu"),i(n(151),"avp"),i(n(59),"ave"),i(n(19),"avu"),i(n(35),"avu"),i(n(8),"avu"),i(n(55),"avu"),i(n(115),"avu"),i(n(102),"avu"),i(n(88),"avp"),i(n(56),"avu"),i(n(152),"avu"),i(n(78),"avu"),i(n(157),"avu"),i(n(153),"avp"),i(n(154),"ave"),i(n(155),"ave"),i(n(80),"ave"),i(n(89),"ave"),i(n(308),"ave"),i(n(23),"av"),i(n(309),"avp"),i(n(310),"av"),i(n(315),"av"),i(n(313),"avp"),i(n(147),"avp"),n(314).initializeLegacyNamespaces(e.exports)},function(e,t,n){(function(t){function n(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:t}function i(e){for(var t=n(),i=e.split("."),r=0;r<i.length;++r)t[i[r]]=t[i[r]]||{},t=t[i[r]];return t}i("Autodesk.Viewing.Private"),i("Autodesk.Viewing.Extensions"),i("Autodesk.Extensions"),i("Autodesk.Viewing.Shaders"),i("Autodesk.Viewing.UI"),i("Autodesk.LMVTK"),Autodesk.Viewing.getGlobal=n,Autodesk.Viewing.AutodeskNamespace=i,n().AutodeskNamespace=i;var r=n().Autodesk.Viewing.Private;r.LMV_WORKER_URL="lmvworker.min.js",r.ENABLE_DEBUG=r.ENABLE_DEBUG||!1,n().ENABLE_DEBUG=r.ENABLE_DEBUG,r.ENABLE_INLINE_WORKER=!0,e.exports.Autodesk=n().Autodesk}).call(this,n(159))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports="DELETED_WORKERNODE"},function(e,t,n){"use strict";var i=n(246),r=n(65),o=n(162),a=n(116),s=n(163),l=Object.prototype.toString,c=0,u=-1,h=0,d=8;function f(e){if(!(this instanceof f))return new f(e);this.options=r.assign({level:u,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==c)throw new Error(a[n]);if(t.header&&i.deflateSetHeader(this.strm,t.header),t.dictionary){var p;if(p="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=i.deflateSetDictionary(this.strm,p))!==c)throw new Error(a[n]);this._dict_set=!0}}function p(e,t){var n=new f(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}f.prototype.push=function(e,t){var n,a,s=this.strm,u=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=o.string2buf(e):"[object ArrayBuffer]"===l.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new r.Buf8(u),s.next_out=0,s.avail_out=u),1!==(n=i.deflate(s,a))&&n!==c)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(r.shrinkBuf(s.output,s.next_out))):this.onData(r.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===a?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c):2!==a||(this.onEnd(c),s.avail_out=0,!0)},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=f,t.deflate=p,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,p(e,t)}},function(e,t,n){"use strict";var i,r=n(65),o=n(247),a=n(160),s=n(161),l=n(116),c=0,u=1,h=3,d=4,f=5,p=0,m=1,g=-2,v=-3,y=-5,_=-1,b=1,x=2,w=3,A=4,E=0,T=2,M=8,S=9,C=15,P=8,L=286,R=30,D=19,I=2*L+1,O=15,N=3,k=258,V=k+N+1,F=32,B=42,U=69,z=73,G=91,H=103,W=113,j=666,X=1,q=2,Y=3,K=4,Q=3;function Z(e,t){return e.msg=l[t],t}function J(e){return(e<<1)-(e>4?9:0)}function $(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(r.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function te(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ne(e,t){e.pending_buf[e.pending++]=t}function ie(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function re(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-V?e.strstart-(e.w_size-V):0,c=e.window,u=e.w_mask,h=e.prev,d=e.strstart+k,f=c[o+a-1],p=c[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(n=t)+a]===p&&c[n+a-1]===f&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do{}while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<d);if(i=k-(d-o),o=d-k,i>a){if(e.match_start=t,a=i,i>=s)break;f=c[o+a-1],p=c[o+a]}}}while((t=h[t&u])>l&&0!=--r);return a<=e.lookahead?a:e.lookahead}function oe(e){var t,n,i,o,l,c,u,h,d,f,p=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-V)){r.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=p?i-p:0}while(--n);t=n=p;do{i=e.prev[--t],e.prev[t]=i>=p?i-p:0}while(--n);o+=p}if(0===e.strm.avail_in)break;if(c=e.strm,u=e.window,h=e.strstart+e.lookahead,d=o,f=void 0,(f=c.avail_in)>d&&(f=d),n=0===f?0:(c.avail_in-=f,r.arraySet(u,c.input,c.next_in,f,h),1===c.state.wrap?c.adler=a(c.adler,u,f,h):2===c.state.wrap&&(c.adler=s(c.adler,u,f,h)),c.next_in+=f,c.total_in+=f,f),e.lookahead+=n,e.lookahead+e.insert>=N)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+N-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<N)););}while(e.lookahead<V&&0!==e.strm.avail_in)}function ae(e,t){for(var n,i;;){if(e.lookahead<V){if(oe(e),e.lookahead<V&&t===c)return X;if(0===e.lookahead)break}if(n=0,e.lookahead>=N&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-V&&(e.match_length=re(e,n)),e.match_length>=N)if(i=o._tr_tally(e,e.strstart-e.match_start,e.match_length-N),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=N){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(te(e,!1),0===e.strm.avail_out))return X}return e.insert=e.strstart<N-1?e.strstart:N-1,t===d?(te(e,!0),0===e.strm.avail_out?Y:K):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?X:q}function se(e,t){for(var n,i,r;;){if(e.lookahead<V){if(oe(e),e.lookahead<V&&t===c)return X;if(0===e.lookahead)break}if(n=0,e.lookahead>=N&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=N-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-V&&(e.match_length=re(e,n),e.match_length<=5&&(e.strategy===b||e.match_length===N&&e.strstart-e.match_start>4096)&&(e.match_length=N-1)),e.prev_length>=N&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-N,i=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-N),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=N-1,e.strstart++,i&&(te(e,!1),0===e.strm.avail_out))return X}else if(e.match_available){if((i=o._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return X}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<N-1?e.strstart:N-1,t===d?(te(e,!0),0===e.strm.avail_out?Y:K):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?X:q}function le(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function ce(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*I),this.dyn_dtree=new r.Buf16(2*(2*R+1)),this.bl_tree=new r.Buf16(2*(2*D+1)),$(this.dyn_ltree),$(this.dyn_dtree),$(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(O+1),this.heap=new r.Buf16(2*L+1),$(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*L+1),$(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ue(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=T,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?B:W,e.adler=2===t.wrap?0:1,t.last_flush=c,o._tr_init(t),p):Z(e,g)}function he(e){var t,n=ue(e);return n===p&&((t=e.state).window_size=2*t.w_size,$(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=N-1,t.match_available=0,t.ins_h=0),n}function de(e,t,n,i,o,a){if(!e)return g;var s=1;if(t===_&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),o<1||o>S||n!==M||i<8||i>15||t<0||t>9||a<0||a>A)return Z(e,g);8===i&&(i=9);var l=new ce;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+N-1)/N),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=n,he(e)}i=[new le(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(oe(e),0===e.lookahead&&t===c)return X;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,te(e,!1),0===e.strm.avail_out))return X;if(e.strstart-e.block_start>=e.w_size-V&&(te(e,!1),0===e.strm.avail_out))return X}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Y:K):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),X)}),new le(4,4,8,4,ae),new le(4,5,16,8,ae),new le(4,6,32,32,ae),new le(4,4,16,16,se),new le(8,16,32,32,se),new le(8,16,128,128,se),new le(8,32,128,256,se),new le(32,128,258,1024,se),new le(32,258,258,4096,se)],t.deflateInit=function(e,t){return de(e,t,M,C,P,E)},t.deflateInit2=de,t.deflateReset=he,t.deflateResetKeep=ue,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?g:(e.state.gzhead=t,p):g},t.deflate=function(e,t){var n,r,a,l;if(!e||!e.state||t>f||t<0)return e?Z(e,g):g;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===j&&t!==d)return Z(e,0===e.avail_out?y:g);if(r.strm=e,n=r.last_flush,r.last_flush=t,r.status===B)if(2===r.wrap)e.adler=0,ne(r,31),ne(r,139),ne(r,8),r.gzhead?(ne(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ne(r,255&r.gzhead.time),ne(r,r.gzhead.time>>8&255),ne(r,r.gzhead.time>>16&255),ne(r,r.gzhead.time>>24&255),ne(r,9===r.level?2:r.strategy>=x||r.level<2?4:0),ne(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ne(r,255&r.gzhead.extra.length),ne(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=s(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=U):(ne(r,0),ne(r,0),ne(r,0),ne(r,0),ne(r,0),ne(r,9===r.level?2:r.strategy>=x||r.level<2?4:0),ne(r,Q),r.status=W);else{var v=M+(r.w_bits-8<<4)<<8;v|=(r.strategy>=x||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(v|=F),v+=31-v%31,r.status=W,ie(r,v),0!==r.strstart&&(ie(r,e.adler>>>16),ie(r,65535&e.adler)),e.adler=1}if(r.status===U)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),ee(e),a=r.pending,r.pending!==r.pending_buf_size));)ne(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=z)}else r.status=z;if(r.status===z)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),ee(e),a=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ne(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),0===l&&(r.gzindex=0,r.status=G)}else r.status=G;if(r.status===G)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),ee(e),a=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ne(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),0===l&&(r.status=H)}else r.status=H;if(r.status===H&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&ee(e),r.pending+2<=r.pending_buf_size&&(ne(r,255&e.adler),ne(r,e.adler>>8&255),e.adler=0,r.status=W)):r.status=W),0!==r.pending){if(ee(e),0===e.avail_out)return r.last_flush=-1,p}else if(0===e.avail_in&&J(t)<=J(n)&&t!==d)return Z(e,y);if(r.status===j&&0!==e.avail_in)return Z(e,y);if(0!==e.avail_in||0!==r.lookahead||t!==c&&r.status!==j){var _=r.strategy===x?function(e,t){for(var n;;){if(0===e.lookahead&&(oe(e),0===e.lookahead)){if(t===c)return X;break}if(e.match_length=0,n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return X}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Y:K):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?X:q}(r,t):r.strategy===w?function(e,t){for(var n,i,r,a,s=e.window;;){if(e.lookahead<=k){if(oe(e),e.lookahead<=k&&t===c)return X;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=N&&e.strstart>0&&(i=s[r=e.strstart-1])===s[++r]&&i===s[++r]&&i===s[++r]){a=e.strstart+k;do{}while(i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&r<a);e.match_length=k-(a-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=N?(n=o._tr_tally(e,1,e.match_length-N),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(te(e,!1),0===e.strm.avail_out))return X}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?Y:K):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?X:q}(r,t):i[r.level].func(r,t);if(_!==Y&&_!==K||(r.status=j),_===X||_===Y)return 0===e.avail_out&&(r.last_flush=-1),p;if(_===q&&(t===u?o._tr_align(r):t!==f&&(o._tr_stored_block(r,0,0,!1),t===h&&($(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),ee(e),0===e.avail_out))return r.last_flush=-1,p}return t!==d?p:r.wrap<=0?m:(2===r.wrap?(ne(r,255&e.adler),ne(r,e.adler>>8&255),ne(r,e.adler>>16&255),ne(r,e.adler>>24&255),ne(r,255&e.total_in),ne(r,e.total_in>>8&255),ne(r,e.total_in>>16&255),ne(r,e.total_in>>24&255)):(ie(r,e.adler>>>16),ie(r,65535&e.adler)),ee(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?p:m)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==B&&t!==U&&t!==z&&t!==G&&t!==H&&t!==W&&t!==j?Z(e,g):(e.state=null,t===W?Z(e,v):p):g},t.deflateSetDictionary=function(e,t){var n,i,o,s,l,c,u,h,d=t.length;if(!e||!e.state)return g;if(2===(s=(n=e.state).wrap)||1===s&&n.status!==B||n.lookahead)return g;for(1===s&&(e.adler=a(e.adler,t,d,0)),n.wrap=0,d>=n.w_size&&(0===s&&($(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new r.Buf8(n.w_size),r.arraySet(h,t,d-n.w_size,n.w_size,0),t=h,d=n.w_size),l=e.avail_in,c=e.next_in,u=e.input,e.avail_in=d,e.next_in=0,e.input=t,oe(n);n.lookahead>=N;){i=n.strstart,o=n.lookahead-(N-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+N-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++}while(--o);n.strstart=i,n.lookahead=N-1,oe(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=N-1,n.match_available=0,e.next_in=c,e.input=u,e.avail_in=l,n.wrap=s,p},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var i=n(65),r=4,o=0,a=1,s=2;function l(e){for(var t=e.length;--t>=0;)e[t]=0}var c=0,u=1,h=2,d=29,f=256,p=f+1+d,m=30,g=19,v=2*p+1,y=15,_=16,b=7,x=256,w=16,A=17,E=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],P=new Array(2*(p+2));l(P);var L=new Array(2*m);l(L);var R=new Array(512);l(R);var D=new Array(256);l(D);var I=new Array(d);l(I);var O,N,k,V=new Array(m);function F(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function B(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function U(e){return e<256?R[e]:R[256+(e>>>7)]}function z(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function G(e,t,n){e.bi_valid>_-n?(e.bi_buf|=t<<e.bi_valid&65535,z(e,e.bi_buf),e.bi_buf=t>>_-e.bi_valid,e.bi_valid+=n-_):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function H(e,t,n){G(e,n[2*t],n[2*t+1])}function W(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function j(e,t,n){var i,r,o=new Array(y+1),a=0;for(i=1;i<=y;i++)o[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=W(o[s]++,s))}}function X(e){var t;for(t=0;t<p;t++)e.dyn_ltree[2*t]=0;for(t=0;t<m;t++)e.dyn_dtree[2*t]=0;for(t=0;t<g;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*x]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function q(e){e.bi_valid>8?z(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Y(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function K(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&Y(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!Y(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function Q(e,t,n){var i,r,o,a,s=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],r=e.pending_buf[e.l_buf+s],s++,0===i?H(e,r,t):(H(e,(o=D[r])+f+1,t),0!==(a=T[o])&&G(e,r-=I[o],a),H(e,o=U(--i),n),0!==(a=M[o])&&G(e,i-=V[o],a))}while(s<e.last_lit);H(e,x,t)}function Z(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=v,n=0;n<l;n++)0!==o[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)K(e,o,n);r=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],K(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,K(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,o,a,s,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(o=0;o<=y;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<v;n++)(o=l[2*l[2*(i=e.heap[n])+1]+1]+1)>p&&(o=p,m++),l[2*i+1]=o,i>c||(e.bl_count[o]++,a=0,i>=f&&(a=d[i-f]),s=l[2*i],e.opt_len+=s*(o+a),h&&(e.static_len+=s*(u[2*i+1]+a)));if(0!==m){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(o=p;0!==o;o--)for(i=e.bl_count[o];0!==i;)(r=e.heap[--n])>c||(l[2*r+1]!==o&&(e.opt_len+=(o-l[2*r+1])*l[2*r],l[2*r+1]=o),i--)}}(e,t),j(o,c,e.bl_count)}function J(e,t,n){var i,r,o=-1,a=t[1],s=0,l=7,c=4;for(0===a&&(l=138,c=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++s<l&&r===a||(s<c?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[2*w]++):s<=10?e.bl_tree[2*A]++:e.bl_tree[2*E]++,s=0,o=r,0===a?(l=138,c=3):r===a?(l=6,c=3):(l=7,c=4))}function $(e,t,n){var i,r,o=-1,a=t[1],s=0,l=7,c=4;for(0===a&&(l=138,c=3),i=0;i<=n;i++)if(r=a,a=t[2*(i+1)+1],!(++s<l&&r===a)){if(s<c)do{H(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==o&&(H(e,r,e.bl_tree),s--),H(e,w,e.bl_tree),G(e,s-3,2)):s<=10?(H(e,A,e.bl_tree),G(e,s-3,3)):(H(e,E,e.bl_tree),G(e,s-11,7));s=0,o=r,0===a?(l=138,c=3):r===a?(l=6,c=3):(l=7,c=4)}}l(V);var ee=!1;function te(e,t,n,r){G(e,(c<<1)+(r?1:0),3),function(e,t,n,r){q(e),r&&(z(e,n),z(e,~n)),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){ee||(function(){var e,t,n,i,r,o=new Array(y+1);for(n=0,i=0;i<d-1;i++)for(I[i]=n,e=0;e<1<<T[i];e++)D[n++]=i;for(D[n-1]=i,r=0,i=0;i<16;i++)for(V[i]=r,e=0;e<1<<M[i];e++)R[r++]=i;for(r>>=7;i<m;i++)for(V[i]=r<<7,e=0;e<1<<M[i]-7;e++)R[256+r++]=i;for(t=0;t<=y;t++)o[t]=0;for(e=0;e<=143;)P[2*e+1]=8,e++,o[8]++;for(;e<=255;)P[2*e+1]=9,e++,o[9]++;for(;e<=279;)P[2*e+1]=7,e++,o[7]++;for(;e<=287;)P[2*e+1]=8,e++,o[8]++;for(j(P,p+1,o),e=0;e<m;e++)L[2*e+1]=5,L[2*e]=W(e,5);O=new F(P,T,f+1,p,y),N=new F(L,M,0,m,y),k=new F(new Array(0),S,0,g,b)}(),ee=!0),e.l_desc=new B(e.dyn_ltree,O),e.d_desc=new B(e.dyn_dtree,N),e.bl_desc=new B(e.bl_tree,k),e.bi_buf=0,e.bi_valid=0,X(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,n,i){var l,c,d=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return o;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return a;for(t=32;t<f;t++)if(0!==e.dyn_ltree[2*t])return a;return o}(e)),Z(e,e.l_desc),Z(e,e.d_desc),d=function(e){var t;for(J(e,e.dyn_ltree,e.l_desc.max_code),J(e,e.dyn_dtree,e.d_desc.max_code),Z(e,e.bl_desc),t=g-1;t>=3&&0===e.bl_tree[2*C[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),l=e.opt_len+3+7>>>3,(c=e.static_len+3+7>>>3)<=l&&(l=c)):l=c=n+5,n+4<=l&&-1!==t?te(e,t,n,i):e.strategy===r||c===l?(G(e,(u<<1)+(i?1:0),3),Q(e,P,L)):(G(e,(h<<1)+(i?1:0),3),function(e,t,n,i){var r;for(G(e,t-257,5),G(e,n-1,5),G(e,i-4,4),r=0;r<i;r++)G(e,e.bl_tree[2*C[r]+1],3);$(e,e.dyn_ltree,t-1),$(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),Q(e,e.dyn_ltree,e.dyn_dtree)),X(e),i&&q(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(D[n]+f+1)]++,e.dyn_dtree[2*U(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){G(e,u<<1,3),H(e,x,P),function(e){16===e.bi_valid?(z(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var i=n(249),r=n(65),o=n(162),a=n(164),s=n(116),l=n(163),c=n(252),u=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);if(this.header=new c,i.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=i.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(s[n])}function d(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}h.prototype.push=function(e,t){var n,s,l,c,h,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?d.input=o.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new r.Buf8(f),d.next_out=0,d.avail_out=f),(n=i.inflate(d,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&p&&(n=i.inflateSetDictionary(this.strm,p)),n===a.Z_BUF_ERROR&&!0===m&&(n=a.Z_OK,m=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==a.Z_STREAM_END&&(0!==d.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(l=o.utf8border(d.output,d.next_out),c=d.next_out-l,h=o.buf2string(d.output,l),d.next_out=c,d.avail_out=f-c,c&&r.arraySet(d.output,d.output,l,c,0),this.onData(h)):this.onData(r.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(m=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=h,t.inflate=d,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},t.ungzip=d},function(e,t,n){"use strict";var i=n(65),r=n(160),o=n(161),a=n(250),s=n(251),l=0,c=1,u=2,h=4,d=5,f=6,p=0,m=1,g=2,v=-2,y=-3,_=-4,b=-5,x=8,w=1,A=2,E=3,T=4,M=5,S=6,C=7,P=8,L=9,R=10,D=11,I=12,O=13,N=14,k=15,V=16,F=17,B=18,U=19,z=20,G=21,H=22,W=23,j=24,X=25,q=26,Y=27,K=28,Q=29,Z=30,J=31,$=32,ee=852,te=592,ne=15;function ie(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function re(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function oe(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=w,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(ee),t.distcode=t.distdyn=new i.Buf32(te),t.sane=1,t.back=-1,p):v}function ae(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,oe(e)):v}function se(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?v:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,ae(e))):v}function le(e,t){var n,i;return e?(i=new re,e.state=i,i.window=null,(n=se(e,t))!==p&&(e.state=null),n):v}var ce,ue,he=!0;function de(e){if(he){var t;for(ce=new i.Buf32(512),ue=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(c,e.lens,0,288,ce,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(u,e.lens,0,32,ue,0,e.work,{bits:5}),he=!1}e.lencode=ce,e.lenbits=9,e.distcode=ue,e.distbits=5}function fe(e,t,n,r){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new i.Buf8(a.wsize)),r>=a.wsize?(i.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>r&&(o=r),i.arraySet(a.window,t,n-r,o,a.wnext),(r-=o)?(i.arraySet(a.window,t,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}t.inflateReset=ae,t.inflateReset2=se,t.inflateResetKeep=oe,t.inflateInit=function(e){return le(e,ne)},t.inflateInit2=le,t.inflate=function(e,t){var n,ee,te,ne,re,oe,ae,se,le,ce,ue,he,pe,me,ge,ve,ye,_e,be,xe,we,Ae,Ee,Te,Me=0,Se=new i.Buf8(4),Ce=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return v;(n=e.state).mode===I&&(n.mode=O),re=e.next_out,te=e.output,ae=e.avail_out,ne=e.next_in,ee=e.input,oe=e.avail_in,se=n.hold,le=n.bits,ce=oe,ue=ae,Ae=p;e:for(;;)switch(n.mode){case w:if(0===n.wrap){n.mode=O;break}for(;le<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}if(2&n.wrap&&35615===se){n.check=0,Se[0]=255&se,Se[1]=se>>>8&255,n.check=o(n.check,Se,2,0),se=0,le=0,n.mode=A;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&se)<<8)+(se>>8))%31){e.msg="incorrect header check",n.mode=Z;break}if((15&se)!==x){e.msg="unknown compression method",n.mode=Z;break}if(le-=4,we=8+(15&(se>>>=4)),0===n.wbits)n.wbits=we;else if(we>n.wbits){e.msg="invalid window size",n.mode=Z;break}n.dmax=1<<we,e.adler=n.check=1,n.mode=512&se?R:I,se=0,le=0;break;case A:for(;le<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}if(n.flags=se,(255&n.flags)!==x){e.msg="unknown compression method",n.mode=Z;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Z;break}n.head&&(n.head.text=se>>8&1),512&n.flags&&(Se[0]=255&se,Se[1]=se>>>8&255,n.check=o(n.check,Se,2,0)),se=0,le=0,n.mode=E;case E:for(;le<32;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}n.head&&(n.head.time=se),512&n.flags&&(Se[0]=255&se,Se[1]=se>>>8&255,Se[2]=se>>>16&255,Se[3]=se>>>24&255,n.check=o(n.check,Se,4,0)),se=0,le=0,n.mode=T;case T:for(;le<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}n.head&&(n.head.xflags=255&se,n.head.os=se>>8),512&n.flags&&(Se[0]=255&se,Se[1]=se>>>8&255,n.check=o(n.check,Se,2,0)),se=0,le=0,n.mode=M;case M:if(1024&n.flags){for(;le<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}n.length=se,n.head&&(n.head.extra_len=se),512&n.flags&&(Se[0]=255&se,Se[1]=se>>>8&255,n.check=o(n.check,Se,2,0)),se=0,le=0}else n.head&&(n.head.extra=null);n.mode=S;case S:if(1024&n.flags&&((he=n.length)>oe&&(he=oe),he&&(n.head&&(we=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,ee,ne,he,we)),512&n.flags&&(n.check=o(n.check,ee,he,ne)),oe-=he,ne+=he,n.length-=he),n.length))break e;n.length=0,n.mode=C;case C:if(2048&n.flags){if(0===oe)break e;he=0;do{we=ee[ne+he++],n.head&&we&&n.length<65536&&(n.head.name+=String.fromCharCode(we))}while(we&&he<oe);if(512&n.flags&&(n.check=o(n.check,ee,he,ne)),oe-=he,ne+=he,we)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=P;case P:if(4096&n.flags){if(0===oe)break e;he=0;do{we=ee[ne+he++],n.head&&we&&n.length<65536&&(n.head.comment+=String.fromCharCode(we))}while(we&&he<oe);if(512&n.flags&&(n.check=o(n.check,ee,he,ne)),oe-=he,ne+=he,we)break e}else n.head&&(n.head.comment=null);n.mode=L;case L:if(512&n.flags){for(;le<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}if(se!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Z;break}se=0,le=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=I;break;case R:for(;le<32;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}e.adler=n.check=ie(se),se=0,le=0,n.mode=D;case D:if(0===n.havedict)return e.next_out=re,e.avail_out=ae,e.next_in=ne,e.avail_in=oe,n.hold=se,n.bits=le,g;e.adler=n.check=1,n.mode=I;case I:if(t===d||t===f)break e;case O:if(n.last){se>>>=7&le,le-=7&le,n.mode=Y;break}for(;le<3;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}switch(n.last=1&se,le-=1,3&(se>>>=1)){case 0:n.mode=N;break;case 1:if(de(n),n.mode=z,t===f){se>>>=2,le-=2;break e}break;case 2:n.mode=F;break;case 3:e.msg="invalid block type",n.mode=Z}se>>>=2,le-=2;break;case N:for(se>>>=7&le,le-=7&le;le<32;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}if((65535&se)!=(se>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Z;break}if(n.length=65535&se,se=0,le=0,n.mode=k,t===f)break e;case k:n.mode=V;case V:if(he=n.length){if(he>oe&&(he=oe),he>ae&&(he=ae),0===he)break e;i.arraySet(te,ee,ne,he,re),oe-=he,ne+=he,ae-=he,re+=he,n.length-=he;break}n.mode=I;break;case F:for(;le<14;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}if(n.nlen=257+(31&se),se>>>=5,le-=5,n.ndist=1+(31&se),se>>>=5,le-=5,n.ncode=4+(15&se),se>>>=4,le-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Z;break}n.have=0,n.mode=B;case B:for(;n.have<n.ncode;){for(;le<3;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}n.lens[Ce[n.have++]]=7&se,se>>>=3,le-=3}for(;n.have<19;)n.lens[Ce[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ee={bits:n.lenbits},Ae=s(l,n.lens,0,19,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,Ae){e.msg="invalid code lengths set",n.mode=Z;break}n.have=0,n.mode=U;case U:for(;n.have<n.nlen+n.ndist;){for(;ve=(Me=n.lencode[se&(1<<n.lenbits)-1])>>>16&255,ye=65535&Me,!((ge=Me>>>24)<=le);){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}if(ye<16)se>>>=ge,le-=ge,n.lens[n.have++]=ye;else{if(16===ye){for(Te=ge+2;le<Te;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}if(se>>>=ge,le-=ge,0===n.have){e.msg="invalid bit length repeat",n.mode=Z;break}we=n.lens[n.have-1],he=3+(3&se),se>>>=2,le-=2}else if(17===ye){for(Te=ge+3;le<Te;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}le-=ge,we=0,he=3+(7&(se>>>=ge)),se>>>=3,le-=3}else{for(Te=ge+7;le<Te;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}le-=ge,we=0,he=11+(127&(se>>>=ge)),se>>>=7,le-=7}if(n.have+he>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Z;break}for(;he--;)n.lens[n.have++]=we}}if(n.mode===Z)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Z;break}if(n.lenbits=9,Ee={bits:n.lenbits},Ae=s(c,n.lens,0,n.nlen,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,Ae){e.msg="invalid literal/lengths set",n.mode=Z;break}if(n.distbits=6,n.distcode=n.distdyn,Ee={bits:n.distbits},Ae=s(u,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ee),n.distbits=Ee.bits,Ae){e.msg="invalid distances set",n.mode=Z;break}if(n.mode=z,t===f)break e;case z:n.mode=G;case G:if(oe>=6&&ae>=258){e.next_out=re,e.avail_out=ae,e.next_in=ne,e.avail_in=oe,n.hold=se,n.bits=le,a(e,ue),re=e.next_out,te=e.output,ae=e.avail_out,ne=e.next_in,ee=e.input,oe=e.avail_in,se=n.hold,le=n.bits,n.mode===I&&(n.back=-1);break}for(n.back=0;ve=(Me=n.lencode[se&(1<<n.lenbits)-1])>>>16&255,ye=65535&Me,!((ge=Me>>>24)<=le);){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}if(ve&&0==(240&ve)){for(_e=ge,be=ve,xe=ye;ve=(Me=n.lencode[xe+((se&(1<<_e+be)-1)>>_e)])>>>16&255,ye=65535&Me,!(_e+(ge=Me>>>24)<=le);){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}se>>>=_e,le-=_e,n.back+=_e}if(se>>>=ge,le-=ge,n.back+=ge,n.length=ye,0===ve){n.mode=q;break}if(32&ve){n.back=-1,n.mode=I;break}if(64&ve){e.msg="invalid literal/length code",n.mode=Z;break}n.extra=15&ve,n.mode=H;case H:if(n.extra){for(Te=n.extra;le<Te;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}n.length+=se&(1<<n.extra)-1,se>>>=n.extra,le-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=W;case W:for(;ve=(Me=n.distcode[se&(1<<n.distbits)-1])>>>16&255,ye=65535&Me,!((ge=Me>>>24)<=le);){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}if(0==(240&ve)){for(_e=ge,be=ve,xe=ye;ve=(Me=n.distcode[xe+((se&(1<<_e+be)-1)>>_e)])>>>16&255,ye=65535&Me,!(_e+(ge=Me>>>24)<=le);){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}se>>>=_e,le-=_e,n.back+=_e}if(se>>>=ge,le-=ge,n.back+=ge,64&ve){e.msg="invalid distance code",n.mode=Z;break}n.offset=ye,n.extra=15&ve,n.mode=j;case j:if(n.extra){for(Te=n.extra;le<Te;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}n.offset+=se&(1<<n.extra)-1,se>>>=n.extra,le-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Z;break}n.mode=X;case X:if(0===ae)break e;if(he=ue-ae,n.offset>he){if((he=n.offset-he)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Z;break}he>n.wnext?(he-=n.wnext,pe=n.wsize-he):pe=n.wnext-he,he>n.length&&(he=n.length),me=n.window}else me=te,pe=re-n.offset,he=n.length;he>ae&&(he=ae),ae-=he,n.length-=he;do{te[re++]=me[pe++]}while(--he);0===n.length&&(n.mode=G);break;case q:if(0===ae)break e;te[re++]=n.length,ae--,n.mode=G;break;case Y:if(n.wrap){for(;le<32;){if(0===oe)break e;oe--,se|=ee[ne++]<<le,le+=8}if(ue-=ae,e.total_out+=ue,n.total+=ue,ue&&(e.adler=n.check=n.flags?o(n.check,te,ue,re-ue):r(n.check,te,ue,re-ue)),ue=ae,(n.flags?se:ie(se))!==n.check){e.msg="incorrect data check",n.mode=Z;break}se=0,le=0}n.mode=K;case K:if(n.wrap&&n.flags){for(;le<32;){if(0===oe)break e;oe--,se+=ee[ne++]<<le,le+=8}if(se!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Z;break}se=0,le=0}n.mode=Q;case Q:Ae=m;break e;case Z:Ae=y;break e;case J:return _;case $:default:return v}return e.next_out=re,e.avail_out=ae,e.next_in=ne,e.avail_in=oe,n.hold=se,n.bits=le,(n.wsize||ue!==e.avail_out&&n.mode<Z&&(n.mode<Y||t!==h))&&fe(e,e.output,e.next_out,ue-e.avail_out)?(n.mode=J,_):(ce-=e.avail_in,ue-=e.avail_out,e.total_in+=ce,e.total_out+=ue,n.total+=ue,n.wrap&&ue&&(e.adler=n.check=n.flags?o(n.check,te,ue,e.next_out-ue):r(n.check,te,ue,e.next_out-ue)),e.data_type=n.bits+(n.last?64:0)+(n.mode===I?128:0)+(n.mode===z||n.mode===k?256:0),(0===ce&&0===ue||t===h)&&Ae===p&&(Ae=b),Ae)},t.inflateEnd=function(e){if(!e||!e.state)return v;var t=e.state;return t.window&&(t.window=null),e.state=null,p},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?v:(n.head=t,t.done=!1,p):v},t.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==D?v:n.mode===D&&r(1,t,i,0)!==n.check?y:fe(e,t,i,i)?(n.mode=J,_):(n.havedict=1,p):v},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,i,r,o,a,s,l,c,u,h,d,f,p,m,g,v,y,_,b,x,w,A,E,T,M;n=e.state,i=e.next_in,T=e.input,r=i+(e.avail_in-5),o=e.next_out,M=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,h=n.wnext,d=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=T[i++]<<p,p+=8,f+=T[i++]<<p,p+=8),_=m[f&v];t:for(;;){if(f>>>=b=_>>>24,p-=b,0===(b=_>>>16&255))M[o++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue t}if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}x=65535&_,(b&=15)&&(p<b&&(f+=T[i++]<<p,p+=8),x+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=T[i++]<<p,p+=8,f+=T[i++]<<p,p+=8),_=g[f&y];n:for(;;){if(f>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=g[(65535&_)+(f&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(w=65535&_,p<(b&=15)&&(f+=T[i++]<<p,(p+=8)<b&&(f+=T[i++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=b,p-=b,w>(b=o-a)){if((b=w-b)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(A=0,E=d,0===h){if(A+=c-b,b<x){x-=b;do{M[o++]=d[A++]}while(--b);A=o-w,E=M}}else if(h<b){if(A+=c+h-b,(b-=h)<x){x-=b;do{M[o++]=d[A++]}while(--b);if(A=0,h<x){x-=b=h;do{M[o++]=d[A++]}while(--b);A=o-w,E=M}}}else if(A+=h-b,b<x){x-=b;do{M[o++]=d[A++]}while(--b);A=o-w,E=M}for(;x>2;)M[o++]=E[A++],M[o++]=E[A++],M[o++]=E[A++],x-=3;x&&(M[o++]=E[A++],x>1&&(M[o++]=E[A++]))}else{A=o-w;do{M[o++]=M[A++],M[o++]=M[A++],M[o++]=M[A++],x-=3}while(x>2);x&&(M[o++]=M[A++],x>1&&(M[o++]=M[A++]))}break}}break}}while(i<r&&o<s);i-=x=p>>3,f&=(1<<(p-=x<<3))-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var i=n(65),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,l,c,u,h,d){var f,p,m,g,v,y,_,b,x,w=d.bits,A=0,E=0,T=0,M=0,S=0,C=0,P=0,L=0,R=0,D=0,I=null,O=0,N=new i.Buf16(16),k=new i.Buf16(16),V=null,F=0;for(A=0;A<=15;A++)N[A]=0;for(E=0;E<l;E++)N[t[n+E]]++;for(S=w,M=15;M>=1&&0===N[M];M--);if(S>M&&(S=M),0===M)return c[u++]=20971520,c[u++]=20971520,d.bits=1,0;for(T=1;T<M&&0===N[T];T++);for(S<T&&(S=T),L=1,A=1;A<=15;A++)if(L<<=1,(L-=N[A])<0)return-1;if(L>0&&(0===e||1!==M))return-1;for(k[1]=0,A=1;A<15;A++)k[A+1]=k[A]+N[A];for(E=0;E<l;E++)0!==t[n+E]&&(h[k[t[n+E]]++]=E);if(0===e?(I=V=h,y=19):1===e?(I=r,O-=257,V=o,F-=257,y=256):(I=a,V=s,y=-1),D=0,E=0,A=T,v=u,C=S,P=0,m=-1,g=(R=1<<S)-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){_=A-P,h[E]<y?(b=0,x=h[E]):h[E]>y?(b=V[F+h[E]],x=I[O+h[E]]):(b=96,x=0),f=1<<A-P,T=p=1<<C;do{c[v+(D>>P)+(p-=f)]=_<<24|b<<16|x|0}while(0!==p);for(f=1<<A-1;D&f;)f>>=1;if(0!==f?(D&=f-1,D+=f):D=0,E++,0==--N[A]){if(A===M)break;A=t[n+h[E]]}if(A>S&&(D&g)!==m){for(0===P&&(P=S),v+=T,L=1<<(C=A-P);C+P<M&&!((L-=N[C+P])<=0);)C++,L<<=1;if(R+=1<<C,1===e&&R>852||2===e&&R>592)return 1;c[m=D&g]=S<<24|C<<16|v-u|0}}return 0!==D&&(c[v+D]=A-P<<24|64<<16|0),d.bits=S,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";n.r(t),n.d(t,"PhongShader",function(){return c});var i=n(0),r=n(15),o=n(208),a=n.n(o),s=n(209),l=n.n(s),c={uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.bump,i.UniformsLib.normalmap,i.UniformsLib.lights,i.UniformsLib.fog,r.ShaderChunks.CutPlanesUniforms,r.ShaderChunks.IdUniforms,r.ShaderChunks.ThemingUniform,r.ShaderChunks.ShadowMapUniforms,r.ShaderChunks.WideLinesUniforms,{emissive:{type:"c",value:new i.Color(0)},specular:{type:"c",value:new i.Color(1118481)},shininess:{type:"f",value:30},reflMipIndex:{type:"f",value:0},texMatrix:{type:"m3",value:new i.Matrix3},texMatrixBump:{type:"m3",value:new i.Matrix3},texMatrixAlpha:{type:"m3",value:new i.Matrix3},irradianceMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1}}]),vertexShader:a.a,fragmentShader:l.a};i.ShaderLib.firefly_phong=c},function(e,t,n){"use strict";n.r(t),n.d(t,"BasicShader",function(){return c});var i=n(0),r=n(15),o=n(210),a=n.n(o),s=n(211),l=n.n(s),c={uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.fog,i.UniformsLib.shadowmap,r.ShaderChunks.CutPlanesUniforms,r.ShaderChunks.IdUniforms,r.ShaderChunks.ThemingUniform,r.ShaderChunks.PointSizeUniforms,r.ShaderChunks.WideLinesUniforms]),vertexShader:a.a,fragmentShader:l.a};i.ShaderLib.firefly_basic=c},function(e,t,n){"use strict";n.r(t),n.d(t,"createWireframe",function(){return s});var i=n(40),r=n(10),o=n(37);function a(e,t){var n=[],r={},a=1;if(e.boundingBox||t){var s=(new o.LmvBox3).copy(e.boundingBox||t).size();a=Math.max(s.x,Math.max(s.y,s.z))}var l=65536/a;return Object(i.enumMeshVertices)(e,function(e,t){var i=function(e,t){var n=0|e.x*l,i=0|e.y*l,o=0|e.z*l,a=r[n];a||(r[n]=a={});var s=a[i];s||(a[i]=s={});var c=s[o];return void 0===c&&(s[o]=c=t),c}(e,t);n[t]=i}),n}function s(e,t,n,o){if(!e.isLines&&!e.iblines){var s=a(e,n),l=function(e,t){var n=new Float32Array(3*Object(i.getVertexCount)(e));return Object(i.enumMeshVertices)(e,function(e,t){n[3*t]=e.x,n[3*t+1]=e.y,n[3*t+2]=e.z},t),n}(e,t),c={},u=[],h=new r.LmvVector3,d=new r.LmvVector3,f=new r.LmvVector3,p=new r.LmvVector3,m=new r.LmvVector3;for(var g in Object(i.enumMeshTriangles)(e,function(e,t,n,i,r,o){b(i,r,o),b(r,o,i),b(o,i,r)}),c)for(var v in c[g])u.push(parseInt(g)),u.push(parseInt(v));u.length>1&&(e.iblines=new Uint16Array(u.length),e.iblines.set(u))}function y(e,t){t.x=l[3*e],t.y=l[3*e+1],t.z=l[3*e+2]}function _(e,t,n,i){y(e,h),y(t,d),y(n,f),d.sub(h),f.sub(h),d.cross(f),i.copy(d).normalize()}function b(e,t,n){var i=s[e],r=s[t],a=s[n];if(i!==r&&i!==a&&r!==a){var l=!1;if(i>r){var h=i;i=r,r=h,l=!0}var d=c[i];if(d){var f=d[r];if(void 0===f)d[r]=l?-n-1:n;else{if(o)u.push(e),u.push(t);else{_(e,t,n,p),f<0?_(r,i,s[-f-1],m):_(i,r,s[f],m);var g=p.dot(m);Math.abs(g)<.25&&(u.push(e),u.push(t))}delete d[r]}}else c[i]={},c[i][r]=n}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"LeafletDiffModes",function(){return c}),n.d(t,"LeafletDiffIterator",function(){return d});var i=n(239),r=n.n(i),o=n(240),a=n.n(o),s=n(82),l=n(0),c={NORMAL_DIFF:0,MODEL_A_ONLY:1,MODEL_B_ONLY:2,SPLIT_VIEW:3,HIGHLIGHT_A:4,HIGHLIGHT_B:5};function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1/0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;this.l=e,this.b=t,this.r=n,this.t=i}function h(){var e={},t={};this.acquireShaderMaterial=function(n,i){e[i]||function(n){e[n]=[],t[n]=0}(i);var o=e[i][t[i]];if(o)for(var s in o.defines={},n)o.uniforms[s].value=n[s].value;else o=new l.ShaderMaterial({uniforms:n,vertexShader:a.a,fragmentShader:r.a}),e[i][t[i]]=o;return t[i]++,o},this.reset=function(){for(var e in t)t[e]=0},this.setThreshold=function(t){for(var n in e)for(var i=0;i<e[n].length;i++)e[n][i].uniforms.diff_threshold.value=t,e[n][i].needsUpdate=!0},this.dispose=function(){for(var t in e)for(var n=0;n<e[t].length;n++)(i=e[t][n])&&(i.dispose(),i.needsUpdate=!0);var i}}function d(e,t){var n=e,i=t,r=new l.Scene,o=e.getDpiScale()<1||t.getDpiScale()<1?.25:.1,a=!0,d=!1,f=!0,p=new s.a,m=new h,g=new l.Vector3,v=.5,y=0,_=!1,b=0,x=3,w=window.devicePixelRatio||1,A=0,E=c.NORMAL_DIFF,T=0,M=1,S=2;function C(){return 0!==g.x||0!==g.y}function P(e,t,n){n.position[e](g),n.target[e](g),n.updateMatrixWorld(!0),n.matrixWorldInverse.getInverse(n.matrixWorld),t.reset(n)}function L(e,t,n){var i=e.clone();i.position.z=t;var a=e.material.map,s={diff_threshold:{type:"f",value:o},texture1:{type:"t",value:a},offsetRepeatA:{type:"v4",value:new l.Vector4(a.offset.x,a.offset.y,a.repeat.x,a.repeat.y)},model:{type:"i",value:n},splitPosition:{type:"f",value:v*y*w}},u=E===c.SPLIT_VIEW,h=m.acquireShaderMaterial(s,"nonintersect"+(u?"split":""));return h.defines.SINGLE_MODEL=1,u&&(h.defines.SPLIT_VIEW=1),i.material=h,r.add(i),i}function R(e,t,n,i){e.offsetX=t.offsetX+(i.l-n.l)/n.width()*t.scaleX,e.offsetY=t.offsetY+(i.b-n.b)/n.height()*t.scaleY,e.scaleX=t.scaleX*i.width()/n.width(),e.scaleY=t.scaleY*i.height()/n.height()}function D(e,t,n,i,a){var u=e.rect,h=n.getIntersection(u);if(h){e.intersecStatus=M,e.intersec.union(h);var d=e.material.map,f=t.clone(),g=new s.b,A=f.geometry.uvTransform;h.equals(n)?(A.copyTo(g),h.equals(u)&&(e.intersecStatus=S)):(R(g,A,n,h),f.geometry=p.acquireQuadGeom(g));var T=new s.b;R(T,e.geometry.uvTransform,u,h),f.position.set(h.l,h.b,0),f.scale.set(h.width(),h.height(),1);var C=new l.Vector2,P=new l.Vector2;_&&(C.x=1/(1|i.image.width*w),C.y=1/(1|i.image.height*w),P.x=1/(1|d.image.width*w),P.y=1/(1|d.image.height*w));var L={diff_threshold:{type:"f",value:o},texture1:{type:"t",value:i},texture2:{type:"t",value:d},offsetRepeatA:{type:"v4",value:new l.Vector4(i.offset.x,i.offset.y,i.repeat.x,i.repeat.y)},offsetRepeatB:{type:"v4",value:new l.Vector4(d.offset.x,d.offset.y,d.repeat.x,d.repeat.y)},uvTFa:{type:"v4",value:g.toVec4()},uvTFb:{type:"v4",value:T.toVec4()},highlight:{type:"i",value:a?b:x},splitPosition:{type:"f",value:v*y*w},resolution1:{type:"v2",value:C},resolution2:{type:"v2",value:P}},D=E===c.SPLIT_VIEW,I=m.acquireShaderMaterial(L,"intersection"+(D?"split":""));return D&&(I.defines.SPLIT_VIEW=1),_&&(I.defines.ADD_THICKENING=1),f.material=I,r.add(f),h}return null}function I(e,t){var r=C();A=.5*(t.far-t.near);var o=n.reset(e,t);r&&P("sub",e,t);var a=i.reset(e,t);return r&&P("add",e,t),function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=n.getScene(),r=i.getScene();!function(e){for(var t=0;t<e.children.length;t++){var n=e.children[t];n.intersecStatus=T,n.intersec=new u;var i=new l.Vector3;i.addVectors(n.position,g);var r=n.scale;n.rect=new u(i.x,i.y,i.x+r.x,i.y+r.y)}}(r);for(var o=0;o<t.children.length;o++){for(var a=T,s=t.children[o],c=s.tile,h=s.material.map,d=s.material.tile,f=s.position,p=s.scale,m=new u(f.x,f.y,f.x+p.x,f.y+p.y),v=new u,y=o<r.children.length?o:0,_=r.children.length,b=y;b<_;b++){var x=r.children[b],w=x.tile,E=x.material.tile,C=e&&(E.level!==d.level||c.level!==w.level||d.level<c.level||E.level<w.level),P=D(x,s,m,h,C);if(P&&(a=x.intersecStatus,v.union(P),a===S))break;y>0&&b===_-1&&(_=y,y=0,b=-1)}(a===T||a===M&&!m.equals(v))&&L(s,-.2*A,1)}for(var R=0;R<r.children.length;R++){var x=r.children[R];if(x.intersecStatus===T||x.intersecStatus===M&&!x.rect.equals(x.intersec)){var I=L(x,-.1*A,2);I.position.add(g)}}}(!o||!a),o&&a}this.setThreshold=function(e){o=e,m.setThreshold(e)},this.setDiffMode=function(e){E=e,d=!0},this.getDiffMode=function(){return E},this.getOffset=function(){return g},this.setOffset=function(e){g=e},this.setSplitPosition=function(e){v=e},this.rayCast=function(e,t){return null},this.getVisibleBounds=function(e,t){var r=new l.Box3,o=new l.Box3;n.getVisibleBounds(r,o),i.getVisibleBounds(e,t),e.union(r),t.union(o)};var O=0,N=0,k=!0;this.updateProgress=function(e){if(e)this.onProgress(100),O=0,k=!0;else{if(k)N=Date.now(),O=10,k=!1;else{var t=Date.now();O+=(O>60?10:5)*(t-N)/250,O=Math.min(95,O),N=t}this.onProgress(O)}},this.reset=function(e,t){a=!1;for(var o=0;o<r.children.length;o++){r.children[o].dispatchEvent({type:"removed"})}r.children.length=0,r.position.set(0,0,0),y=t.clientWidth,p.reset(),m.reset();var s=!0;switch(E){case c.NORMAL_DIFF:x=3,s=I(e,t);break;case c.MODEL_A_ONLY:!function(e,t){n.reset(e,t),r=n.getScene().clone()}(e,t);break;case c.MODEL_B_ONLY:!function(e,t){var n=C();n&&P("sub",e,t),i.reset(e,t),(r=i.getScene().clone()).position.copy(g),n&&P("add",e,t)}(e,t);break;case c.SPLIT_VIEW:!function(e,t){I(e,t)}(e,t);break;case c.HIGHLIGHT_A:x=1,s=I(e,t);break;case c.HIGHLIGHT_B:x=2,s=I(e,t)}f?s&&(this.onFirstSceneComplete&&this.onFirstSceneComplete(),f=!1):this.onProgress&&this.updateProgress(s)},this.nextBatch=function(){return a?null:(a=!0,r)},this.getScene=function(){return r},this.getSceneCount=function(){return 1},this.done=function(){return a},this.update=function(){return d?(d=!1,!0):n.update()||i.update()},this.dispose=function(){m.dispose(),p.dispose()},this.dtor=function(){this.dispose()}}u.prototype.width=function(){return this.r-this.l},u.prototype.height=function(){return this.t-this.b},u.prototype.getIntersection=function(e){var t=Math.max(this.l,e.l),n=Math.min(this.r,e.r),i=Math.max(this.b,e.b),r=Math.min(this.t,e.t);return n>t&&r>i?new u(t,i,n,r):null},u.prototype.equals=function(e){return this.l===e.l&&this.r===e.r&&this.t===e.t&&this.b===e.b},u.prototype.union=function(e){return this.l=Math.min(this.l,e.l),this.r=Math.max(this.r,e.r),this.b=Math.min(this.b,e.b),this.t=Math.max(this.t,e.t),this}},function(e,t,n){"use strict";n.r(t),n.d(t,"VertexBufferBuilder",function(){return o});var i=2*Math.PI,r=[0,1,3,0,3,2];function o(e,t,n,i){var r=t||65536;this.FULL_COUNT=0|(n||32767),this.useInstancing=e,this.useCompactBuffers=!1,this.stride=10,this.allocVcount=4*(this.useInstancing?r/4:r),this.vb=new ArrayBuffer(this.stride*this.allocVcount),this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.ib=this.useInstancing?null:new Uint16Array(r),this.reset(0)}o.prototype.reset=function(e){this.vcount=e,this.icount=0,this.minx=this.miny=1/0,this.maxx=this.maxy=-1/0,this.dbIds={},this.colors={},this.numEllipticals=0,this.numCirculars=0,this.numTriangleGeoms=0,this.changeTracking={},this.stride=10},o.prototype.expandStride=function(){var e=this.stride;if(!(e>=12)){for(var t=this.stride+2,n=new ArrayBuffer(t*this.allocVcount),i=new Uint8Array(this.vb),r=new Uint8Array(n),o=0,a=this.vcount;o<a;o++)for(var s=o*e*4,l=o*t*4,c=0;c<4*e;c++)r[l+c]=i[s+c];this.vb=n,this.vbf=new Float32Array(n),this.vbi=new Int32Array(n),this.stride=t}},o.prototype.addToBounds=function(e,t){e<this.minx&&(this.minx=e),e>this.maxx&&(this.maxx=e),t<this.miny&&(this.miny=t),t>this.maxy&&(this.maxy=t)};var a=new Int32Array(1);function s(e){return a[0]=e,a[0]}o.prototype.trackChanges=function(e,t,n,i,r,o){if(this.dbIds[s(n)]=1,this.useCompactBuffers){var a=this.changeTracking;l("geomType",e),l("color",t),l("dbId",n),l("layerId",i),l("viewportId",r),l("linePattern",o),this.colors[s(t)]=1}function l(t,n){void 0===a[t]?a[t]=e:a[t]===n&&(a[t+"Varies"]=!0)}},o.prototype.setCommonVertexAttribs=function(e,t,n,i,r,o,a,s){this.trackChanges(n,i,r,o,a,s),t&=255,n&=255,s&=255,o&=65535,a&=65535,this.vbi[e+8]=t|n<<8|s<<16,this.vbi[e+6]=i,this.vbi[e+7]=r,this.vbi[e+9]=o|a<<16},o.prototype.addVertexTriangleGeom=function(e,t,n,i,r,o,a,s,l,c){for(var u=this.vcount,h=this.vbf,d=this.useInstancing?1:4,f=0;f<d;f++){var p=(u+f)*this.stride;h[p]=e,h[p+1]=t,h[p+2]=n,h[p+3]=i,h[p+4]=r,h[p+5]=o,this.setCommonVertexAttribs(p,0+f,5,a,s,l,c,0),this.vcount++}return u},o.prototype.addVertexLine=function(e,t,n,r,o,a,s,l,c,u,h){for(var d=this.vcount,f=this.vbf,p=this.useInstancing?1:4,m=0;m<p;m++){var g=(d+m)*this.stride;f[g]=e,f[g+1]=t,f[g+2]=(n+Math.PI)/i,f[g+3]=r,f[g+4]=.5*a,f[g+5]=o,this.setCommonVertexAttribs(g,0+m,1,s,l,c,u,h),this.vcount++}return d},o.prototype.addVertexTexQuad=function(e,t,n,r,o,a,s,l,c){for(var u=this.vcount,h=this.vbf,d=this.useInstancing?1:4,f=0;f<d;f++){var p=(u+f)*this.stride;h[p]=e,h[p+1]=t,h[p+2]=o/i,h[p+3]=n,h[p+4]=r,this.setCommonVertexAttribs(p,0+f,4,a,s,l,c,0),this.vcount++}return u},o.prototype.addVertexArc=function(e,t,n,r,o,a,s,l,c,u,h,d){for(var f=this.vcount,p=this.vbf,m=o==a?2:3,g=this.useInstancing?1:4,v=0;v<g;v++){var y=(f+v)*this.stride;p[y]=e,p[y+1]=t,p[y+2]=n/i,p[y+3]=r/i,p[y+4]=.5*l,p[y+5]=o,3===m&&(p[y+10]=a,p[y+11]=s),this.setCommonVertexAttribs(y,0+v,m,c,u,h,d,0),this.vcount++}return f},o.prototype.addVertex=function(e,t,n,i,r,o){if(!this.useInstancing){var a=this.vcount,s=this.stride*a,l=this.vbf;return l[s]=e,l[s+1]=t,this.setCommonVertexAttribs(s,0,0,n,i,r,o,0),this.vcount++,a}},o.prototype.addVertexPolytriangle=function(e,t,n,i,r,o){this.useInstancing||(this.addVertex(e,t,n,i,r,o),this.addToBounds(e,t))},o.prototype.addIndices=function(e,t){if(!this.useInstancing){var n=this.ib,i=this.icount;if(i+e.length>=n.length){for(var r=new Uint16Array(2*Math.max(e.length,n.length)),o=0;o<i;++o)r[o]=n[o];this.ib=n=r}for(o=0;o<e.length;++o)n[i+o]=t+e[o];this.icount+=e.length}},o.prototype.finalizeQuad=function(e){this.useInstancing||this.addIndices(r,e)},o.prototype.addSegment=function(e,t,n,i,r,o,a,s,l,c,u){var h=n-e,d=i-t,f=h||d?Math.atan2(d,h):0,p=h||d?Math.sqrt(h*h+d*d):0,m=this.addVertexLine(e,t,f,p,r,o,a,s,l,c,u);this.finalizeQuad(m),this.addToBounds(e,t),this.addToBounds(n,i)},o.prototype.addTriangleGeom=function(e,t,n,i,r,o,a,s,l,c){this.numTriangleGeoms++;var u=this.addVertexTriangleGeom(e,t,n,i,r,o,a,s,l,c);this.finalizeQuad(u),this.addToBounds(e,t),this.addToBounds(n,i),this.addToBounds(r,o)},o.prototype.addArc=function(e,t,n,r,o,a,s,c,u,h,d,f){o==a?this.numCirculars++:(this.numEllipticals++,this.expandStride());var p=l(n,r);if(n=p.start,r=p.end,0==n&&0==r&&(r=i),(b=Math.abs(n-r))>1e-4&&Math.abs(b-i)>1e-4){var m=e+o*Math.cos(n),g=t+a*Math.sin(n);this.addSegment(m,g,m,g,0,c,u,h,d,f);var v=e+o*Math.cos(r),y=t+a*Math.sin(r);this.addSegment(v,y,v,y,0,c,u,h,d,f)}else this.addToBounds(e-o,t-a),this.addToBounds(e+o,t+a);var _=this.addVertexLine(e,t,0,1e-4,0,0,1,h,d,f);this.finalizeQuad(_);var b,x=this.addVertexArc(e,t,n,r,o,a,s,c,u,h,d,f);this.finalizeQuad(x)},o.prototype.addTexturedQuad=function(e,t,n,i,r,o,a,s,l){var c=this.addVertexTexQuad(e,t,n,i,r,o,a,s,l);this.finalizeQuad(c);var u=.5*Math.cos(r),h=.5*Math.sin(r),d=Math.abs(n*u)+Math.abs(i*h),f=Math.abs(n*h)+Math.abs(i*u);this.addToBounds(e-d,t-f),this.addToBounds(e+d,t+f)},o.prototype.isFull=function(e){e=e||3;var t=this.useInstancing?4:1;return this.vcount*t+e>this.FULL_COUNT},o.prototype.makeCompactVertexLayout=function(){console.log("---");var e=Object.keys(this.colors),t=Object.keys(this.dbIds);if(1!==this.changeTracking.geomType||this.changeTracking.geomTypeVaries||console.log("Vertex buffer only has lines"),1!==this.changeTracking.color||this.changeTracking.colorVaries?console.log("Num colors:",e.length):console.log("Vertex buffer has invariant color"),this.changeTracking.viewportIdVaries||console.log("Vertex buffer has invariant viewportId"),this.changeTracking.layerIdVaries||console.log("Vertex buffer has invariant layerId"),this.changeTracking.dbIdVaries?console.log("Num dbIds:",t.length):console.log("Vertex buffer has invariant dbId"),10!==this.stride)return null;var n=e.length+t.length;if(e.length+t.length>65536)return null;var i=new Int32Array(n+1);i[0]=0;for(var r=1,o=0;o<e.length;o++,r++)i[r]=parseInt(e[o]),this.colors[e[o]]=r;for(o=0;o<t.length;o++,r++)i[r]=parseInt(t[o]),this.dbIds[t[o]]=r;var a=new ArrayBuffer(24*this.vcount),s=new Int32Array(a),l=new Uint16Array(a),c=this.maxx-this.minx||1,u=this.maxy-this.miny||1,h=this.minx,d=this.miny,f=Math.max(c,u);function p(e){return 0|Math.round((e-h)/c*65535)}function m(e){return 0|Math.round((e-d)/u*65535)}function g(e){return 0|Math.round(e/f*65535)}function v(e){return 0|65535*e}function y(e){return e<0?32768+32767*Math.min(1,-e/1024):0|Math.round(e/f*32767)}for(o=0;o<this.vcount;o++){var _=this.stride*o,b=6*o,x=2*b;switch(this.vbi[_+8]>>8&255){case 0:l[x]=p(this.vbf[_]),l[x+1]=m(this.vbf[_+1]);break;case 1:l[x]=p(this.vbf[_]),l[x+1]=m(this.vbf[_+1]),l[x+2]=v(this.vbf[_+2]),l[x+3]=g(this.vbf[_+3]),l[x+4]=y(this.vbf[_+4]);break;case 2:l[x]=p(this.vbf[_]),l[x+1]=m(this.vbf[_+1]),l[x+2]=v(this.vbf[_+2]),l[x+3]=v(this.vbf[_+3]),l[x+4]=y(this.vbf[_+4]),l[x+5]=g(this.vbf[_+5]);break;case 3:break;case 4:l[x]=p(this.vbf[_]),l[x+1]=m(this.vbf[_+1]),l[x+2]=v(this.vbf[_+2]),l[x+3]=g(this.vbf[_+3]),l[x+4]=g(this.vbf[_+4]);break;case 5:l[x]=p(this.vbf[_]),l[x+1]=m(this.vbf[_+1]),l[x+2]=p(this.vbf[_+2]),l[x+3]=m(this.vbf[_+3]),l[x+4]=p(this.vbf[_+4]),l[x+5]=m(this.vbf[_+5]);break;default:console.error("Unknown geometry type")}l[x+6]=this.colors[this.vbi[_+6]]||0,l[x+7]=this.dbIds[this.vbi[_+7]]||0,s[b+4]=this.vbi[_+8],s[b+5]=this.vbi[_+9]}var w={};w.vb=new Float32Array(a),w.vbstride=6;var A=this.useInstancing?1:0;return w.vblayout={fields1:{offset:0,itemSize:2,bytesPerItem:2,divisor:A,normalize:!0},fields2:{offset:1,itemSize:4,bytesPerItem:2,divisor:A,normalize:!0},uvIdColor:{offset:3,itemSize:2,bytesPerItem:2,divisor:A,normalize:!1},flags4b:{offset:4,itemSize:4,bytesPerItem:1,divisor:A,normalize:!1},layerVp4b:{offset:5,itemSize:4,bytesPerItem:1,divisor:A,normalize:!1}},w.unpackXform={x:c,y:u,z:h,w:d},w.texData=i,w},o.prototype.makeWideVertexLayout=function(){var e={};e.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4)),e.vbstride=this.stride;var t=this.useInstancing?1:0;return e.vblayout={fields1:{offset:0,itemSize:2,bytesPerItem:4,divisor:t,normalize:!1},fields2:{offset:2,itemSize:4,bytesPerItem:4,divisor:t,normalize:!1},color4b:{offset:6,itemSize:4,bytesPerItem:1,divisor:t,normalize:!0},dbId4b:{offset:7,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1},flags4b:{offset:8,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1},layerVp4b:{offset:9,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1}},this.stride>10&&(e.vblayout.extraParams={offset:10,itemSize:2,bytesPerItem:4,divisor:t,normalize:!1}),e},o.prototype.toMesh=function(){var e=null;if(this.useCompactBuffers&&(e=this.makeCompactVertexLayout()),e||(e=this.makeWideVertexLayout()),this.useInstancing){e.numInstances=this.vcount;var t=new Int32Array([0,1,2,3]);e.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,divisor:0,normalize:!1},e.vblayout.instFlags4b.array=t.buffer;e.indices=new Uint16Array(r)}else e.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));e.dbIds=this.dbIds;var n=this.maxx-this.minx,i=this.maxy-this.miny,o=Math.max(n,i);e.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-o},max:{x:this.maxx,y:this.maxy,z:.001*o}};e.boundingSphere={center:{x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0},radius:.5*Math.sqrt(n*n+i*i)};return e};var l=function(e,t){function n(){function n(e,t){return Math.abs(e-t)<.001}n(e,0)&&(e=0),n(t,0)&&(t=0),n(e,i)&&(e=i),n(t,i)&&(t=i)}if(n(),e>t)for(;e>i;)e-=i,t-=i;else for(;t>i;)e-=i,t-=i;return n(),e<0&&t>0&&(e+=i),{start:e,end:t}}},function(e,t,n){"use strict";n.r(t),n.d(t,"FileLoader",function(){return i});var i=function(e){this.viewer=e};i.prototype.constructor=i,i.prototype.loadFile=function(e,t,n,i){return!1},i.prototype.is3d=function(){return!1}},function(e,t,n){"use strict";n.r(t),n.d(t,"ViewingApplication",function(){return l});var i=n(7),r=n(2),o=n(77),a=n(26),s=n(1),l=function(e,t){this.appContainerId=e,this.container=document.getElementById(e),this.options=t||{},this.myRegisteredViewers={},this.myDocument=null,this.bubble=null,this.myCurrentViewer=null,this.urn=null,this.selectedItem=null,this.extensionCache={};var n=this;this.onHyperlinkHit=function(e){var t=e.data.item;t&&n.selectItem(t)},this.onLoadGeometry=function(e){var t=e.data;n.selectItem(t.item,t.onSuccessCb,t.onErrorCb)}};function c(e,t){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n],r=Array.isArray(i),o=e[n],a=Array.isArray(o);r&&a?(i?r||(i=[i]):i=[],o?a||(o=[o]):o=[],e[n]=o.concat(i)):e[n]=i}}l.prototype.k3D="3D",l.prototype.finish=function(){this.myCurrentViewer&&(this.myCurrentViewer.finish(),this.myCurrentViewer=null)},l.prototype.registerViewer=function(e,t,n){e===this.k3D?(n=n||{},this.options&&this.options.hasOwnProperty("disableBrowserContextMenu")&&(n.hasOwnProperty("disableBrowserContextMenu")||(n.disableBrowserContextMenu=this.options.disableBrowserContextMenu)),this.myRegisteredViewers[e]={},this.myRegisteredViewers[e].class=t,this.myRegisteredViewers[e].config=n):s.logger.error("The only acceptable viewer type is k3D.",Object(i.errorCodeString)(i.ErrorCodes.VIEWER_INTERNAL_ERROR))},l.prototype.getViewerClass=function(e){return this.myRegisteredViewers.hasOwnProperty(e)?this.myRegisteredViewers[e].class:null},l.prototype.getViewerContainer=function(){return document.getElementById(this.appContainerId)},l.prototype.getViewer=function(e){var t=this.myRegisteredViewers[this.k3D];if(!t)return null;var n={};c(n,t.config),c(n,e);var i=t.class;if(this.myCurrentViewer&&this.myCurrentViewer.__proto__.constructor===i)return this.myCurrentViewer.tearDown(),this.myCurrentViewer.setUp(n),this.myCurrentViewer;this.setCurrentViewer(null);for(var r=this.getViewerContainer();r.hasChildNodes();)r.removeChild(r.lastChild);var o=new i(r,n);return this.setCurrentViewer(o),o},l.prototype.setCurrentViewer=function(e){this.myCurrentViewer&&(this.myCurrentViewer.removeEventListener(r.HYPERLINK_EVENT,this.onHyperlinkHit),this.myCurrentViewer.removeEventListener(r.LOAD_GEOMETRY_EVENT,this.onLoadGeometry),this.myCurrentViewer.finish()),this.myCurrentViewer=e,this.myCurrentViewer&&(e.addEventListener(r.HYPERLINK_EVENT,this.onHyperlinkHit),e.addEventListener(r.LOAD_GEOMETRY_EVENT,this.onLoadGeometry),e.extensionCache=this.extensionCache)},l.prototype.getCurrentViewer=function(){return this.myCurrentViewer},l.prototype.setDocument=function(e){if(!e.urn||"$file$"===e.urn)return s.logger.error("Unsupported Manifest urn: "+e.urn),!1;var t=o.Document.getDocumentPath(e.urn);return this.myDocument=new o.Document(e,t),this.bubble=this.myDocument.getRoot(),this.onDocumentLoaded(this.myDocument),!0},l.prototype.loadDocument=function(e,t,n,i){s.logger.track({category:"load_document",urn:0==e.indexOf("urn:")?e.substring(4):e}),o.Document.load(e,function(e,n){this.myDocument=e,this.bubble=e.getRoot(),this.onDocumentLoaded(e,n),t&&t(e,n)}.bind(this),function(e,t,i,r,o){this.onDocumentFailedToLoad(e,t,o),n&&n(e,t,i,r,o)}.bind(this),i)},l.prototype.onDocumentLoaded=function(e,t){s.logger.log(e,t)},l.prototype.onDocumentFailedToLoad=function(e,t,n){s.logger.error(Object(i.errorCodeString)(e),t,n)},l.prototype.getDefaultGeometry=function(e){for(var t=0,n=e.length;t<n;++t){var i=e[t];i instanceof a.BubbleNode&&(i=i._raw());var r=i.useAsDefault;if(!0===r||"true"===r)return e[t]}return e[0]},l.prototype.selectItem=function(e,t,n){var i={};e instanceof a.BubbleNode||(console.warn("Deprecated use of ViewingApplication.selectItem. Pass BubbleNode instead of raw manifest JSON"),e=this.bubble.findByGuid(e.guid));var r=this.myDocument.getViewablePath(e,i);if(!r&&e.isViewPreset()&&(r=this.urn),!r)return!1;var o,l,c,u=!1;if(e.isGeometry()&&e.is3D())u=!0,l=e.name(),c=e;else if(e.isViewPreset()&&e.is3D())o=e,u=!0,(c=this.myDocument.getViewGeometry(e,!0))&&(l=c.name());else if(e.isGeometry()&&e.is2D()){var h=e.search(a.BubbleNode.GEOMETRY_F2D_NODE),d=e.search(a.BubbleNode.LEAFLET_NODE),f=e.search(a.BubbleNode.IMAGE_NODE);(h.length>0||d.length>0||f.length>0)&&(u=!0),l=e.name(),c=e}else e.isViewPreset()&&e.is2D()&&(o=e,u=!0,(c=this.myDocument.getViewGeometry(e,!0))&&(l=c.name()));if(!u)return!1;var p=r.indexOf("urn:");s.logger.track({category:"load_viewable",role:e._raw().role,type:e._raw().type,urn:-1!==p?r.substring(p+4):r});var m=this.myDocument.getMessages(e,!0),g=this,v=this.myCurrentViewer&&this.urn===r,y=function(n){var i=g.myCurrentViewer;i.setView(o)||v&&i.setViewFromFile(n),t&&t(g.myCurrentViewer,e,m)},_=function(e,t,i,r){n&&n(e,t,i,r,m)},b=!1;if(v)y&&y(),b=!0;else{this.urn=null;var x={defaultModelStructureTitle:l,viewableName:l},w=e.extensions();w&&(x.extensions=w);var A=this.getViewer(x);if(A){var E={ids:null,acmSessionId:this.myDocument.acmSessionId,loadOptions:i,useConsolidation:this.options.useConsolidation,skipPropertyDb:this.options.skipPropertyDb,consolidationMemoryLimit:this.options.consolidationMemoryLimit||104857600};this.options.hasOwnProperty("isAEC")&&(E.isAEC=this.options.isAEC),A.started?(A.loadDocumentNode(this.myDocument,e,E).then(y).catch(_),b=!0):(A.startWithDocumentNode(this.myDocument,e,E).then(y).catch(_),b=!0),this.urn=r}}return!!b&&(this.selectedItem=e,this.onItemSelected(e,c),!0)},l.prototype.onItemSelected=function(e,t){if(s.logger.log("Selected URL: http://"+location.host+location.pathname+"?document=urn:"+this.myDocument.getRoot().guid()+"&item="+encodeURIComponent(e.guid())),this.itemSelectedObservers)for(var n=this.getCurrentViewer(),i=0;i<this.itemSelectedObservers.length;++i){var r=this.itemSelectedObservers[i];r.onItemSelected&&r.onItemSelected(n,e,t)}},l.prototype.addItemSelectedObserver=function(e){this.itemSelectedObservers||(this.itemSelectedObservers=[]),this.itemSelectedObservers.push(e)},l.prototype.selectItemById=function(e,t,n){var i=this.myDocument.getRoot().findByGuid(e);return!!i&&this.selectItem(i,t,n)},l.prototype.getSelectedItem=function(){return this.selectedItem},l.prototype.getNamedViews=function(e){return(e=e||this.selectedItem)&&e.guid?(t=e instanceof a.BubbleNode?e:this.bubble.findByGuid(e.guid),e===this.selectedItem&&(t=t.findParentGeom2Dor3D()),t.getNamedViews()):[];var t}},function(e,t,n){"use strict";n.r(t),n.d(t,"estimateMemUsage",function(){return u}),n.d(t,"ModelMemoryTracker",function(){return h});var i=1048576e3;function r(e){return e?e.byteLength:0}function o(e){return r(e.boxes)+r(e.transforms)+r(e.fragId2dbId)+r(e.geomDataIndexes)+r(e.materials)}function a(e){return r(e.geomids)+r(e.materialids)+r(e.vizflags)+(e.boxes!==e.fragments.boxes?r(e.boxes):0)+(e.transforms!==e.fragments.transforms?r(e.transforms):0)}function s(e){return r(e.nodes.nodesRaw?e.nodes.nodesRaw:e.nodes)+r(e.primitives)}var l=!1;function c(e){for(var t,n=Autodesk.Viewing.Private,i=0,c=0;c<e.length;c++){var u=e[c],h=u.getData(),d=u.getConsolidation();if(d&&(i+=d.byteSize),h.isLeaflet)l||(console.warn("Memory tracking not implemented for leaflets."),l=!0);else{if(!h.isOTG)i+=u.getGeometryList().geomMemory;var f=h.fragments;f&&(i+=o(f));var p=u.getFragmentList();p&&(i+=a(p));var m=h.bvh;m&&(i+=s(m));var g=h.instanceTree;g&&(i+=(t=void 0,r((t=g.nodeAccess).children)+r(t.nameSuffixes)+r(t.names)+r(t.nodeBoxes)+r(t.nodes)))}}return isFinite(i)||n.logger.warn("Memory estimate result was not a number"),i}function u(e){var t=e.impl.geomCache(),n=t?t.byteSize:0,i=e.impl.modelQueue(),r=i.getModels(),o=i.getHiddenModels();return n+c(r)+c(o)}function h(e,t){var n=e,r=0,o=t||i;function a(e){return e.lruTimestamp===r}this.updateModelTimestamps=function(e){r++;for(var t=0;t<e.length;t++){e[t].lruTimestamp=r}},this.memoryExceeded=function(){return u(n)>=o},this.getMemLimit=function(){return o},this.cleanup=function(e){var t=e||n.impl.unloadModel.bind(n.impl);if(this.memoryExceeded()){for(var i=function(){for(var e=n.impl.modelQueue().getHiddenModels(),t=[],i=0;i<e.length;i++){var r=e[i];a(r)||t.push(r)}return t.sort(function(e,t){return e.lurTimestamp-t.lruTimestamp}),t}(),r=0;r<i.length;r++){var o=i[r];if(o.isConsolidated&&(o.unconsolidate(),!this.memoryExceeded()))return}var s=n.impl.geomCache();for(r=0;r<i.length;r++)if(t(o=i[r]),s&&s.cleanup(),!this.memoryExceeded())return}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"UnitParser",function(){return i});var i={};function r(e,t,n,i){if(!e)return NaN;var r,o=(e=e.toString()).trim();if(0==o.length)return NaN;var a=n.join("| *"),s=i.join("| *");if(r=o.match(new RegExp("^([+-]?\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+s+") *$")))return parseFloat(r[1])/parseFloat(r[2])/t;if(r=o.match(new RegExp("^([+-]?\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+")? *$")))return parseFloat(r[1])/parseFloat(r[2]);var l;if(!(r=o.match(/^[+-]? *(?:\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?/i)))return NaN;if(l=parseFloat(r[0].replace(/ */g,"")),0==(o=(o=o.slice(r[0].length)).replace("-"," ")).length||isNaN(l))return l;var c=Math.sign(l);return 0===c&&(c=1),o.match(new RegExp("^(?: *)(?:"+s+") *$","i"))?l/t:(r=o.match(new RegExp("^ +(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+s+") *$","i")))?(l+c*parseFloat(r[1])/parseFloat(r[2]))/t:(r=o.match(new RegExp("^(?: *)(?:"+a+"|-| +-?) *","i")))?0==(o=o.slice(r[0].length).trim()).length?r[0].match(/-/)?NaN:l:(r=o.match(new RegExp("^(\\d+(?:\\.\\d*)?)(?: *)(?:"+s+")? *$")))?l+c*parseFloat(r[1])/t:(r=o.match(new RegExp("^(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+s+")? *$")))?l+c*(parseFloat(r[1])/parseFloat(r[2]))/t:(r=o.match(new RegExp("^(\\d+) +(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+s+")? *$")))?l+c*(parseFloat(r[1])+parseFloat(r[2])/parseFloat(r[3]))/t:NaN:NaN}i.parseFeet=function(e){return r(e,12,["ft","feet","'","`","â€˜","â€™"],["in","inch",'\\"',"''","``","â€˜â€˜","â€™â€™"])},i.parseMeter=function(e){return r(e,100,["m","meter"],["cm","centimeter"])},i.parseNumber=function(e,t){switch(t){case"ft":case"decimal-ft":case"ft-and-fractional-in":case"ft-and-decimal-in":case"decimal-in":case"fractional-in":return i.parseFeet(e);case"":case"m":case"cm":case"mm":case"m-and-cm":default:return i.parseMeter(e)}},i.parsePositiveNumber=function(e,t){var n=i.parseNumber(e,t);return n>=0?n:NaN}},function(e,t,n){"use strict";n.r(t),n.d(t,"MeasureEvents",function(){return i});var i={MEASUREMENT_CHANGED_EVENT:"measurement-changed",UNITS_CALIBRATION_STARTS_EVENT:"units_calibration_starts_event",FINISHED_CALIBRATION_FOR_DIMENSION_EVENT:"finished_calibration_for_dimension_event",CALIBRATION_REQUIRED_EVENT:"calibration-required",OPEN_CALIBRATION_PANEL_EVENT:"open-calibration-panel",CLOSE_CALIBRATION_PANEL_EVENT:"close-calibration-panel",CLEAR_CALIBRATION_SIZE_EVENT:"clear-calibration-size"}},function(e,t,n){"use strict";n.r(t),n.d(t,"Measurement",function(){return a});var i=n(100),r=n(46),o=n(38);function a(e,t){this.measurementType=e,this.id=t,this.picks=[],this.closedArea=!1,this.resetMeasureValues()}a.prototype.resetMeasureValues=function(){this.angle=0,this.distanceX=0,this.distanceY=0,this.distanceZ=0,this.distanceXYZ=0,this.result=null},a.prototype.setPick=function(e,t){var n=this.picks[e]=t;return n.id=parseInt(e),n},a.prototype.getPick=function(e){var t=this.picks[e];return t||(t=this.setPick(e,new i.SnapResult)),t},a.prototype.countPicks=function(){return Object.keys(this.picks).length},a.prototype.getMaxNumberOfPicks=function(){switch(this.measurementType){case r.MeasurementTypes.MEASUREMENT_DISTANCE:return 2;case r.MeasurementTypes.MEASUREMENT_ANGLE:return 3;case r.MeasurementTypes.MEASUREMENT_AREA:return this.closedArea?this.countPicks():Number.MAX_VALUE-1}},a.prototype.hasPick=function(e){return this.picks[e]&&!this.picks[e].isEmpty()},a.prototype.isComplete=function(){var e=this.countPicks()===this.getMaxNumberOfPicks();for(var t in this.picks)if(this.picks.hasOwnProperty(t)&&!(e=e&&this.hasPick(t)))break;return e},a.prototype.isEmpty=function(){var e=!0;for(var t in this.picks)if(this.picks.hasOwnProperty(t)&&!(e=e&&!this.hasPick(t)))break;return e},a.prototype.clearPick=function(e){this.picks[e]&&this.picks[e].clear(),this.resetMeasureValues()},a.prototype.clearAllPicks=function(){for(var e in this.picks)this.picks.hasOwnProperty(e)&&this.clearPick(e)},a.prototype.hasEqualPicks=function(e,t){if(!e||!t)return!1;if(e.geomType===t.geomType){var n=Object(o.getSnapResultPosition)(e),i=Object(o.getSnapResultPosition)(t);return Object(o.isEqualVectors)(n,i,o.EPSILON)}return!1},a.prototype.computeResult=function(e,t){if(this.resetMeasureValues(),!t.model)return this.result=null,!1;var n=this.result=Object(o.computeResult)(e,this.measurementType,t);if(null===n)return!this.isComplete();switch(n.type){case r.MeasurementTypes.MEASUREMENT_DISTANCE:return this.distanceXYZ=n.distanceXYZ,this.distanceX=n.distanceX,this.distanceY=n.distanceY,this.distanceZ=n.distanceZ,!0;case r.MeasurementTypes.MEASUREMENT_ANGLE:return this.angle=isNaN(n.angle)?0:n.angle,!0;case r.MeasurementTypes.MEASUREMENT_AREA:return this.area=n.area,!0;default:return!1}},a.prototype.getGeometry=function(e){return{type:this.picks[e].geomType,geometry:this.picks[e].getGeometry()}},a.prototype.attachIndicator=function(e,t,n){this.indicator=new n(e,this,t),this.indicator.init()}},function(e,t,n){"use strict";function i(){this.names=["unnamed"],this.getNames=function(){return this.names},this.getName=function(){return this.names[0]},this.getPriority=function(){return 0},this.register=function(){},this.deregister=function(){},this.activate=function(e,t){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){return!1},this.handleGesture=function(e){return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}}n.r(t),n.d(t,"ToolInterface",function(){return i})},function(e,t,n){"use strict";function i(){this.stop=null,this.isRunning=!0}function r(e,t,n,r,o){var a=performance.now(),s=1e3*n,l=0,c=new i;c.stop=function(){l&&window.cancelAnimationFrame(l),c.isRunning=!1},c.skip=function(){c.isRunning&&(r(1),c.stop(),o&&o())};return function n(i){var u=(i-a)/s;u=Math.max(u,0),u=Math.min(u,1),r(e+u*(t-e)),u<1?l=window.requestAnimationFrame(n):(c.isRunning=!1,o&&o())}(a),c}function o(e,t,n){return(1-n)*e+n*t}function a(e){return THREE.Math.smootherstep(e,0,1)}function s(e){var t=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=0,u=0,h=new THREE.Vector3,d=new THREE.Quaternion,f=new THREE.Quaternion,p=new THREE.Vector3,m=new THREE.Quaternion,g=new THREE.Object3D;new THREE.Matrix4;function v(e,t,n,i){Autodesk.Viewing.Navigation.prototype.orient(g,n,t,i),e.copy(g.quaternion)}this.init=function(e,o,a,p){t.copy(e.position),n.copy(e.target),i.copy(e.up),r.copy(o),s.copy(a),l.copy(p),h.copy(e.worldup),c=t.distanceTo(n),u=r.distanceTo(s),v(d,t,n,h),v(f,r,s,h)},this.updateCamera=function(e,n){var i=a(e);n.position.lerpVectors(t,r,i),THREE.Quaternion.slerp(d,f,m,i),m.normalize();var s=o(c,u,i);!function(e,t,n){p.set(0,0,-n).applyQuaternion(t),e.target.addVectors(e.position,p),p.set(0,1,0).applyQuaternion(t),e.up.copy(p)}(n,m,s),n.dirty=!0},this.updateViewerCamera=function(e,t){this.updateCamera(e,t.impl.camera),t.impl.syncCamera(),t.impl.invalidate(!0,!0)}}var l;e.exports={flyToView:function(e,t,n,i){l||(l=new s),n=n||2;var o=e.impl.camera;return l.init(o,t.position,t.target,t.up),r(0,1,n,function(t){l.updateViewerCamera(t,e)},i)},ShadowFader:function(e,t,n){var i=1,o=null,a=t,s=void 0,l=n;function c(t){i=t,e.impl.setGroundShadowAlpha(t)}function u(){o=null,l&&l(s)}this.shadowOn=function(){o&&s||(o&&!s&&(o.stop(),o=null),i>=1||(o=r(i,1,a*(1-i),c,u),s=!0))},this.shadowOff=function(){o&&!s||(o&&s&&(o.stop(),o=null),i<=0||(o=r(i,0,a*i,c,u),s=!1))},this.isFading=function(){return o&&o.isRunning}},lerp:o,smootherStep:a,fadeValue:r}},function(e,t,n){"use strict";n.r(t),n.d(t,"F2DLoader",function(){return _});var i=n(1),r=n(51),o=n(7),a=n(34),s=n(47),l=n(12),c=n(24),u=n(14),h=n(58),d=n(3),f=n(2),p=n(33),m=n(4),g=n(52),v=n(147),y=n(0);function _(e,t){this.viewer3DImpl=e,this.loading=!1,this.tmpMatrix=new y.Matrix4,this.overrideModelConstructor=t&&t.overrideModelConstructor,this.logger=i.logger,this.loadTime=0,this.useInstancing=this.viewer3DImpl.use2dInstancing}_.prototype.dtor=function(){this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,i.logger.debug("F2D loader dtor: on init worker script.")),this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null,i.logger.debug("F2D loader dtor: on streaming worker.")),this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null,i.logger.debug("F2D loader dtor: on parsing worker.")),this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.viewer3DImpl=null,this.loading=!1,this.tmpMatrix=null,this.logger=null,this.loadTime=0,this.svf=null,this.model=null,this.options=null,this.pagingProxy=null},_.prototype.isValid=function(){return!!this.viewer3DImpl},_.prototype.loadFile=function(e,t,n,r){if(!this.viewer3DImpl)return i.logger.log("F2D loader was already destructed. So no longer usable."),!1;if(this.loading)return i.logger.log("Loading of F2D already in progress. Ignoring new request."),!1;this.loading=!0,this.viewer3DImpl._addLoadingFile(this);var o=e.indexOf("urn:");if(-1!=o){var a=(e=decodeURIComponent(e)).substr(o,e.substr(o).indexOf("/"));i.logger.log("Extracted URN: "+a);var s=a.lastIndexOf(":");this.svfUrn=a.substr(s+1)}else this.svfUrn=e;this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e,this.acmSessionId=t.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=t,this.options.placementTransform?this.modelScale=this.options.modelScale||this.options.placementTransform.getMaxScaleOnAxis():this.modelScale=this.options.modelScale||1,this.isf2d=!0;var l=this,u=this.viewer3DImpl.api.config&&this.viewer3DImpl.api.config.memory,h=this.memoryOpts={onDemandLoading:!1,debug:{}};return u&&(u.hasOwnProperty("limit")&&(h.limit=u.limit,h.onDemandLoading=!0,h.pageOutGeometryEnabled=!0),h.debug=u.debug||{}),this.initWorkerScriptToken=Object(c.initWorkerScript)(function(){l.loadFydoCB(e,t,n,r)}),!0};_.prototype.loadFydoCB=function(e,t,n,r){this.t0=Date.now();var s=Object(l.pathToURL)(e);this.streamingWorker=Object(c.createWorker)(),this.parsingWorker=Object(c.createWorker)();var h=this,p=!0,g=function(){h.memoryOpts.onDemandLoading||(h.parsingWorker.terminate(),h.parsingWorker=null)};this.streamingWorker.addEventListener("message",function(e){if(h.isValid()){var l,c=function(e){if(e){var t,n=e.geom_metrics,i=3*(n.arcs+n.circ_arcs);i+=n.circles,i+=n.pline_points-(n.plines||0),i+=n.rasters,i+=n.ptri_indices/3*3;var r=Object(d.isMobileDevice)()?16383:32767;h.useInstancing?(i+=n.ptri_indices/3,t=0,r/=4):(t=6*i+n.ptri_indices,i*=4,i+=n.ptri_points);var o=(i*(48+u.GEOMETRY_OVERHEAD/r)+2*t)/1048576+h.fileMemorySize,a=h.memoryOpts;a.onDemandLoading&&!a.debug.force&&o<a.limit&&(a.onDemandLoading=!1,a.pageOutGeometryEnabled=!1),h.totalGeomSize=o}return h.memoryOpts.onDemandLoading};p&&r&&(p=!1,r()),e.data&&"F2DBLOB"==e.data.type?(e.data.hasOwnProperty("f2dSize")&&(h.fileMemorySize=e.data.f2dSize/1048576),c(e.data.metadata),l={operation:"PARSE_F2D",data:e.data.buffer,metadata:e.data.metadata,manifest:e.data.manifest,basePath:e.data.basePath,f2dLoadOptions:{modelSpace:t.modelSpace,bgColor:t.bgColor,isMobile:Object(d.isMobileDevice)(),useInstancing:h.useInstancing,onDemandLoading:h.memoryOpts.onDemandLoading},url:s},h.parsingWorker.doOperation(l,[l.data]),h.streamingWorker.terminate(),h.streamingWorker=null):e.data&&"F2DSTREAM"==e.data.type?(e.data.hasOwnProperty("f2dSize")&&(h.fileMemorySize=2*e.data.f2dSize/1048576),c(e.data.metadata),l={operation:"PARSE_F2D_FRAME",data:e.data.frames,url:s,f2dLoadOptions:{modelSpace:t.modelSpace,bgColor:t.bgColor,isMobile:Object(d.isMobileDevice)(),useInstancing:h.useInstancing,onDemandLoading:h.memoryOpts.onDemandLoading}},e.data.metadata&&(l.metadata=e.data.metadata,l.manifest=e.data.manifest),e.data.finalFrame&&(l.finalFrame=!0,h.streamingWorker.terminate(),h.streamingWorker=null,h.fileMemorySize/=2),e.data.progress&&h.viewer3DImpl.signalProgress(100*e.data.progress,a.ProgressState.LOADING),h.parsingWorker.doOperation(l,l.data?[l.data]:void 0)):e.data&&"F2DAssetURL"==e.data.type||e.data&&e.data.assetRequest||e.data&&e.data.progress||(e.data&&e.data.debug?i.logger.debug(e.data.message):e.data&&e.data.error?(h.loading=!1,h.streamingWorker.terminate(),h.streamingWorker=null,n&&n.call(this,e.data.error)):(i.logger.error("F2D download failed.",Object(o.errorCodeString)(o.ErrorCodes.NETWORK_FAILURE)),h.loading=!1,h.streamingWorker.terminate(),h.streamingWorker=null))}},!1),this.parsingWorker.addEventListener("message",function(e){var t,a,s,l;if(h.isValid())if(p&&r&&(p=!1,r()),e.data&&e.data.f2d){for(t=h.svf=e.data.f2d,g(),i.logger.info("Num polylines: "+t.numPolylines),i.logger.info("Line segments: "+t.numLineSegs),i.logger.info("Circular arcs: "+t.numCircles),i.logger.info("Ellipitcal arcs:"+t.numEllipses),i.logger.info("Plain triangles:"+t.numTriangles),i.logger.info("Total # of op codes generated by fydo.parse: "+t.opCount),h.onModelRootLoadDone(h.svf),n&&n(null,h.model),h.viewer3DImpl.api.dispatchEvent({type:f.MODEL_ROOT_LOADED_EVENT,svf:h.svf,model:h.model}),a=0;a<t.meshes.length;a++)h.processReceivedMesh2D(t.meshes[a],a);t.meshes=null,h.onGeomLoadDone(),h.loading=!1}else if(e.data&&e.data.f2dframe){var c=0;if(e.data.meshes){var u=e.data.bbox;h.svf.bbox=new y.Box3(u.min,u.max),c=e.data.baseIndex}else h.svf=e.data.f2dframe,c=e.data.baseIndex;if((t=h.svf).fragments&&t.fragments.initialized||(h.onModelRootLoadDone(t),n&&n(null,h.model),h.viewer3DImpl.api.dispatchEvent({type:f.MODEL_ROOT_LOADED_EVENT,svf:t,model:h.model})),e.data.meshes&&e.data.meshes.length){for(a=0;a<e.data.meshes.length;a++)h.processReceivedMesh2D(e.data.meshes[a],c+a);h.pagingProxy&&h.pagingProxy.onDemandLoadingEnabled()&&(s=h,l=e.data,s.viewer3DImpl.api.dispatchEvent({type:f.FRAGMENTS_LOADED_EVENT,model:s.model,getFragIds:function(){if(this.fragIds)return e;if(!this.model||!this.data||!this.data.meshes)return null;for(var e=this.fragIds=[],t=0|this.data.baseIndex,n=0;n<this.data.meshes.length;++n)e.push(t++);return e},data:l}))}if(e.data.finalFrame){var d=e.data.cumulativeProps;for(var m in d)t[m]=d[m];g(),h.onGeomLoadDone(),h.loading=!1,h.pagingProxy&&h.pagingProxy.onFinalFrame()}}else e.data&&e.data.progress||(e.data&&e.data.debug?i.logger.debug(e.data.message):e.data&&e.data.canceled&&h.pagingProxy?h.pagingProxy.cancelAcknowledged():e.data&&e.data.error?(h.loading=!1,g(),i.logger.error("Error while processing F2d: "+JSON.stringify(e.data.error.args)),n&&n.call(this,e.data.error)):(i.logger.error("F2D download failed.",Object(o.errorCodeString)(o.ErrorCodes.NETWORK_FAILURE)),h.loading=!1,g()))},!1);var v={operation:"STREAM_F2D",url:s,objectIds:t.ids,queryParams:this.queryParams};return this.streamingWorker.doOperation(m.endpoint.initLoadContext(v)),!0},_.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,n=this.svf.fragments,o=n.mesh2frag[t];if(void 0!==o){Array.isArray(o)||(o=[o]);var a=e.mesh;if(r.BufferGeometryUtils.meshToGeometry(e),e.geometry.unpackXform=a.unpackXform,a.texData){var s=new y.DataTexture(new Uint8Array(a.texData.buffer),a.texData.length,1,y.RGBAFormat,y.UnsignedByteType,y.UVMapping,y.ClampToEdgeWrapping,y.ClampToEdgeWrapping,y.NearestFilter,y.NearestFilter,0);s.generateMipmaps=!1,s.flipY=!1,s.needsUpdate=!0,e.geometry.tIdColor=s,e.geometry.vIdColorTexSize=new y.Vector2(a.texData.length,1)}var l=o.length,c=this.model;c.getGeometryList().addGeometry(e.geometry,l,e.meshIndex+1);for(var u=(e.geometry.attributes.index.array||e.geometry.ib).length/3,h=0;h<o.length;h++){var d=0|o[h];c.getFragmentList().getOriginalWorldMatrix(d,this.tmpMatrix),this.options.placementTransform&&(this.tmpMatrix=(new y.Matrix4).multiplyMatrices(this.options.placementTransform,this.tmpMatrix));var f=n.materials[d].toString();n.polygonCounts&&(n.polygonCounts[d]=u);var p=this.viewer3DImpl.setupMesh(this.model,e.geometry,f,this.tmpMatrix);c.activateFragment(d,p)}n.mesh2frag[t]=null,n.numLoaded+=o.length}else i.logger.warn("Mesh "+t+" was not referenced by any fragments.")},_.prototype.processReceivedMesh2D=function(e,t){if(!this.pagingProxy||this.pagingProxy.onMeshReceived(e,t)){var n={mesh:e,is2d:!0,packId:"0",meshIndex:t},i="0:"+t,r=this.svf.fragments;if(!r.fragId2dbId[t]){var o=Object.keys(n.mesh.dbIds).map(function(e){return parseInt(e)});r.fragId2dbId[t]=o;for(var a=0;a<o.length;a++){var s=o[a],l=r.dbId2fragId[s];Array.isArray(l)?l.push(t):r.dbId2fragId[s]=void 0!==l?[l,t]:t}e.material.modelScale=this.modelScale;var c=this.viewer3DImpl;r.materials[t]=this.viewer3DImpl.matman().create2DMaterial(this.model,e.material,!1,!1,function(e,t){var n=t.getData();p.TextureLoader.requestsInProgress()||!n.loadDone||n.texLoadDone||(n.texLoadDone=!0,c.onTextureLoadComplete(t)),c.invalidate(!1,!0,!1)}),r.length++}r.mesh2frag[i]=t,this.processReceivedMesh(n)}},_.prototype.onModelRootLoadDone=function(e){e.fragments={},e.fragments.mesh2frag={},e.fragments.materials=[],e.fragments.fragId2dbId=[],e.fragments.dbId2fragId={},e.fragments.length=0,e.fragments.initialized=!0,e.geomMemory=0,e.fragments.numLoaded=0,e.gpuNumMeshes=0,e.gpuMeshMemory=0,e.nextRepaintPolys=1e4,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath="";var t=this.currentLoadPath.lastIndexOf("/");-1!=t&&(e.basePath=this.currentLoadPath.substr(0,t+1)),e.loadOptions=this.options;var n=Date.now();this.loadTime+=n-this.t0,i.logger.log("SVF load: "+(n-this.t0)),this.t0=n,e.bbox=(new y.Box3).copy(e.bbox);var r=this.model=this.overrideModelConstructor?new this.overrideModelConstructor(e):new g.Model(e);r.loader=this;var o=this.memoryOpts;this.viewer3DImpl.modelQueue().getModels().length>0&&(o.pageOutGeometryEnabled=!1),o.onDemandLoading&&(this.pagingProxy=new v.F2DPagingProxy(this,o)),r.initialize(this.pagingProxy);var s=!(this.model.getFragmentList().onDemandLoadingEnabled()&&Object(d.isMobileDevice)());(void 0===this.options.skipPropertyDb?s:!this.options.skipPropertyDb)&&(this.svf.propDbLoader=new h.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api)),i.logger.log("scene bounds: "+JSON.stringify(e.bbox));var l={category:"metadata_load_stats",urn:e.urn,layers:e.layerCount};i.logger.track(l),this.viewer3DImpl.signalProgress(5,a.ProgressState.ROOT_LOADED),this.viewer3DImpl.invalidate(!1,!1)},_.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,this.svf.fragments.entityIndexes=null,this.memoryOpts.onDemandLoading||(this.svf.fragments.mesh2frag=null);var e=Date.now(),t="Fragments load time: "+(e-this.t0);this.loadTime+=e-this.t0,p.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.options.skipPropertyDb||this.loadPropertyDb(),i.logger.log(t);var n={category:"model_load_stats",is_f2d:!0,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,urn:this.svfUrn};i.logger.track(n,!0),this.currentLoadPath=null,this.isf2d=void 0,this.memoryOpts.onDemandLoading?this.viewer3DImpl.onDemandLoadComplete(this.model):this.viewer3DImpl.onLoadComplete(this.model)},_.prototype.loadPropertyDb=function(){this.svf.propDbLoader&&this.svf.propDbLoader.load()},_.prototype.is3d=function(){return!1},s.FileLoaderManager.registerFileLoader("f2d",["f2d"],_)},function(e,t,n){"use strict";n.r(t),n.d(t,"ScalarisLoader",function(){return v});var i=n(1),r=n(47),o=n(87),a=n(98),s=n(7),l=n(34),c=n(0),u=n(12),h=n(24),d=n(2),f=n(4),p=n(11),m=n(52),g=function(e){this.viewer3DImpl=e,this.loading=!1};g.prototype.dtor=function(){this.viewer3DImpl=null,this.model=null,this.svf=null,this.logger=null,this.loading=!1},g.prototype.isValid=function(){return null!=this.viewer3DImpl},g.prototype.loadFile=function(e,t,n,r){if(!this.viewer3DImpl)return i.logger.log("Scalaris loader was already destructed. So no longer usable."),!1;if(this.loading)return i.logger.log("Loading of Scalaris already in progress. Ignoring new request."),!1;this.loading=!0,this.viewer3DImpl._addLoadingFile(this),this.currentLoadPath=e;var o="",a=this.currentLoadPath.lastIndexOf("/");-1!=a&&(o=this.currentLoadPath.substr(0,a+1)),this.basePath=o,this.options=t,this.options.debug={},this.options.preserveView=!0;var s=this;return this.initWorkerScriptToken=Object(h.initWorkerScript)(function(){s.loadScalarisCB(e,s.options,n,r)}),!0},g.prototype.loadScalarisCB=function(e,t,n,r){var o=!0,a=this,c=this.svfWorker=Object(h.createWorkerWithIntercept)();c.addEventListenerWithIntercept(function(e){var t=function(){c&&(c.clearAllEventListenerWithIntercept(),c.terminate(),a.svfWorker=null,c=null)};if(o&&r&&(o=!1,r()),e.data&&e.data.geometry){var u=a.svf=e.data.geometry;a.onModelRootLoadDone(u),n&&n(null,a.model),a.viewer3DImpl.api.dispatchEvent({type:d.MODEL_ROOT_LOADED_EVENT,svf:u,model:a.model}),a.svf.loadDone=!1}else e.data&&e.data.progress?(a.viewer3DImpl&&a.viewer3DImpl.signalProgress(100*e.data.progress,l.ProgressState.LOADING),1==e.data.progress&&setTimeout(function(){a.onGeomLoadDone(),a.loading=!1,t()},0)):e.data&&e.data.error?(a.loading=!1,console.error(e.data),t(),n&&n(e.data.error,null)):e.data&&e.data.debug?i.logger.debug(e.data.message):(i.logger.error("Scalaris load failed.",Object(s.errorCodeString)(s.ErrorCodes.NETWORK_FAILURE)),a.loading=!1,t())});var m={url:Object(u.pathToURL)(e),basePath:this.currentLoadPath,scalarisProtoPath:Object(p.getResourceUrl)("res/protobuf/scalaris.proto"),operation:"LOAD_SCALARIS"};return c.doOperation(Object(f.initLoadContext)(m)),!0},g.prototype.onModelRootLoadDone=function(e){this.viewer3DImpl._removeLoadingFile(this),e.basePath=this.basePath,e.disableStreaming=!0,e.geomPolyCount=0,e.gpuNumMeshes=0,e.gpuMeshMemory=0,e.fragments={length:e.meshCount,numLoaded:0,boxes:null,transforms:null,materials:null,fragId2dbId:null,entityIndexes:null,mesh2frag:null},e.animations=null,e.nodeToDbId={},e.loadOptions=this.options,e.bbox=new c.Box3(e.min,e.max);var t=this.model=new m.Model(e);e.urn&&t.setUUID(e.urn),t.initialize(),t.loader=this,t.isScalaris=!0,this.viewer3DImpl.signalProgress(5,l.ProgressState.ROOT_LOADED),this.viewer3DImpl.invalidate(!1,!1)},g.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0;var e=this.svf.fragments.length;this.svf.numGeoms=e,this.svf.fragments.numLoaded=e,this.svf.fragments.boxes=new Float32Array(6*e),this.svf.fragments.transforms=new Float32Array(12*e),this.svf.fragments.materials=new Int32Array(e),this.svf.fragments.fragId2dbId=new Int32Array(e),this.svf.fragments.mesh2frag=new Int32Array(e);var t=this.svf,n=function(e){var t=new c.BufferGeometry;if(t.byteSize=0,t.addAttribute("index",new c.BufferAttribute(new Uint32Array(e.indices),1)),t.addAttribute("position",new c.BufferAttribute(new Float32Array(e.vertices),3)),t.addAttribute("normal",new c.BufferAttribute(new Float32Array(e.normals),3)),e.hasOwnProperty("uvs")&&e.uvs.byteLength>0&&(t.byteSize+=e.uvs.byteLength,t.addAttribute("uv",new c.BufferAttribute(new Float32Array(e.uvs),2))),t.hasColors=!1,e.hasOwnProperty("colors")&&e.colors.byteLength>0&&(t.byteSize+=e.colors.byteLength,t.addAttribute("color",new c.BufferAttribute(new Float32Array(e.colors),3)),t.hasColors=!0,t.colorsNeedUpdate=!0),t.attributes.index.array.length>0&&t.attributes.position.array.length>0){if(e.hasOwnProperty("offsets")&&e.offsets.byteLength>0){t.byteSize+=e.offsets.byteLength;for(var n=e.offsets.length,i=0;i<n;i++){var r=e.offsets[i];t.addDrawCall(r.start,r.count)}}return e.min?t.boundingBox=new c.Box3(new c.Vector3(e.min.x,e.min.y,e.min.z),new c.Vector3(e.max.x,e.max.y,e.max.z)):t.computeBoundingBox(),e.bbox.min=e.min=t.boundingBox.min,e.bbox.max=e.max=t.boundingBox.max,function(e){if(0===e.offsets.length)for(var t=e.attributes.index.array.length/3,n=t/21845,i=0;i<n;i++){var r={start:21845*i*3,count:3*Math.min(t-21845*i,21845)};e.addDrawCall(r.start,r.count)}}(t),function(e){0==e.attributes.normal.array.length&&(e.attributes.normal.array=new Float32Array(e.attributes.position.array.length),e.computeVertexNormals())}(t),t.byteSize+=e.indices.byteLength+e.vertices.byteLength+e.normals.byteLength,t.polyCount=t.attributes.index.array.length/3,t}return null}(t);t.geomPolyCount+=n.polyCount;this.createInstanceTree(0);this.model.getGeometryList().addGeometry(n,1,0);var i=new c.Matrix4,r=this.viewer3DImpl.setupMesh(this.model,n,null,i);r.material=this.viewer3DImpl.getMaterials().defaultMaterial,t.fragments.materials[0]=null,t.fragments.fragId2dbId[0]=2,t.fragments.mesh2frag[0]=0;var o=t.fragments.boxes;o[0]=t.min.x,o[1]=t.min.y,o[2]=t.min.z,o[3]=t.max.x,o[4]=t.max.y,o[5]=t.max.z;for(var a=t.fragments.transforms,s=0;s<12;s++)a[s]=0;if(a[0]=a[4]=a[8]=1,this.model.activateFragment(0,r,!!t.placementTransform),this.currentLoadPath=null,this.viewer3DImpl.api.setModelUnits("meter"),n.hasColors&&t.colors.byteLength){var l=this.viewer3DImpl.getMaterials().defaultMaterial;l.vertexColors=c.NoColors,l.needsUpdate=!0,this.viewer3DImpl.invalidate(!0,!0,!1)}this.options.skipFitToView||this.viewer3DImpl.api.fitToView(null,null,!0),this.viewer3DImpl.onLoadComplete(this.model)},g.prototype.createInstanceTree=function(e){var t=new o.InstanceTreeStorage(2,1),n=[2];t.setNode(1,0,"RootNode",0,n,[]),t.setNode(2,1,"Geometry",0,[],[e]);var i=new o.InstanceTreeAccess(t,0);i.computeBoxes(this.svf.fragments.boxes),this.svf.instanceTree=new a.InstanceTree(i,1,1)},g.prototype.is3d=function(){return!0},r.FileLoaderManager.registerFileLoader("scalaris",["scalaris"],g);var v=g},function(e,t,n){"use strict";function i(){this.ios=window.webkit,this.android=window.JSINTERFACE,this.iosSend=function(e,t){return window.webkit.messageHandlers.callbackHandler.postMessage({command:e,data:t})},this.androidSend=window.JSINTERFACE}n.r(t),n.d(t,"MobileCallbacks",function(){return i});var r=i.prototype;r.animationReady=function(){this.ios?this.iosSend("animationReady"):this.android&&this.androidSend.animationReady()},r.onSelectionChanged=function(e){this.ios?this.iosSend("selectionChanged",e):this.android&&this.androidSend.onSelectionChanged(e)},r.onLongTap=function(e,t){this.ios?this.iosSend("onLongTap",[e,t]):this.android&&this.androidSend.onLongTap(e,t)},r.onSingleTap=function(e,t){this.ios?this.iosSend("onSingleTap",[e,t]):this.android&&this.androidSend.onSingleTap(e,t)},r.onDoubleTap=function(e,t){this.ios?this.iosSend("onDoubleTap",[e,t]):this.android&&this.androidSend.onDoubleTap(e,t)},r.setRTCSession=function(e){this.ios?this.iosSend("setRTCSession",{id:e}):this.android&&this.androidSend.setRTCSessionID(e)},r.putProperties=function(e,t){this.ios?this.iosSend("putProperties",{name:e,value:t}):this.android&&this.androidSend.putProperties(e,t)},r.onPropertyRetrievedSuccess=function(){this.ios?this.iosSend("onPropertyRetrievedSuccess"):this.android&&this.androidSend.onPropertyRetrievedSuccess()},r.onPropertyRetrievedFailOrEmptyProperties=function(){this.ios?this.iosSend("onPropertyRetrievedFailOrEmptyProperties"):this.android&&this.androidSend.onPropertyRetrievedFailOrEmptyProperties()},r.resetAnimationStatus=function(){this.ios?this.iosSend("resetAnimationStatus"):this.android&&this.androidSend.resetAnimationStatus()},r.setPauseUI=function(){this.ios?this.iosSend("setPauseUI"):this.android&&this.androidSend.setToPaused()},r.getDeviceAvailableMemory=function(){return this.ios?this.iosSend("getDeviceAvailableMemory"):this.android?this.androidSend.getDeviceAvailableMemory():void 0},r.onDeviceMemoryInsufficient=function(){return this.ios?this.iosSend("onDeviceMemoryInsufficient"):this.android?this.androidSend.onDeviceMemoryInsufficient():void 0},r.updateAnimationTime=function(e){this.ios?this.iosSend("updateAnimationTime",e):this.android&&this.androidSend.updateAnimationTime(e)},r.setLoadingProgress=function(e,t){this.ios?this.iosSend("setLoadingProgress",{state:e,progress:t}):this.android&&this.androidSend.setLoadingProgress(e,t)},r.objectTreeCreated=function(){this.ios?this.iosSend("objectTreeCreated"):this.android&&this.androidSend.objectTreeCreated()},r.geometryLoaded=function(){this.ios?this.iosSend("geometryLoaded"):this.android&&this.androidSend.geometryLoaded()},r.putSheets=function(e,t){this.ios?this.iosSend("putSheets",[e,t]):this.android&&this.androidSend.putSheets(e,t)},r.putAllSheets=function(e){this.ios?this.iosSend("putAllSheets",e):this.android&&this.androidSend.putAllSheets(e)},r.hideLoadingView=function(){this.android&&this.androidSend.hideLoadingView()},r.instanceTree=function(e){this.ios?this.iosSend("instanceTree",e):this.android&&this.androidSend.instanceTree(e)},r.loadSheetFailed=function(){this.ios?this.iosSend("loadSheetFailed"):this.android&&this.androidSend.loadSheetFailed()},r.sheetSelected=function(e){this.ios?this.iosSend("sheetSelected",e):this.android&&this.androidSend.sheetSelected(e)},"undefined"!=typeof window&&(window.MobileCallbacks=i)},function(e,t,n){"use strict";n.r(t);n(270),n(271),n(272),n(273),n(274),n(275),n(276),n(277),n(278),n(279),n(280),n(281),n(282),n(283),n(284),n(285),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(306)},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t),n.d(t,"BrowserDelegate",function(){return a}),n.d(t,"Browser",function(){return s});var i=n(77),r=n(7),o=n(1);function a(){}function s(e,t,n){this.myDelegate=e,this.mySelectedIds=[];this.myRootContainerId=n+"-browserview",this.idToElement={},this.myRootContainer=document.createElement("div"),this.myRootContainer.id=this.myRootContainerId,this.myRootContainer.classList.add("browserview"),document.getElementById(n).appendChild(this.myRootContainer),this.createElements(t,this.myRootContainer)}a.prototype.constructor=a,a.prototype.getNodeId=function(e){throw"getId is not implemented."},a.prototype.getNodeLabel=function(e){return e.name},a.prototype.getNodeClass=function(e){return""},a.prototype.hasThumbnail=function(e){return!1},a.prototype.getThumbnailOptions=function(e){return null},a.prototype.getThumbnail=function(e){return null},a.prototype.onNodeClick=function(e,t,n){},a.prototype.onNodeHover=function(e,t,n){},a.prototype.selectItem=function(e){},a.prototype.deselectItem=function(e){},a.prototype.hasContent=function(e){return!1},a.prototype.addContent=function(e,t){},s.prototype.constructor=s,s.prototype.show=function(e){e?(this.myRootContainer.classList.remove("browserHidden"),this.myRootContainer.classList.add("browserVisible"),this.myRootContainer.style.display="block"):(this.myRootContainer.classList.remove("browserVisible"),this.myRootContainer.classList.add("browserHidden"),this.myRootContainer.style.display="none")},s.prototype.getRootContainer=function(){return this.myRootContainer},s.prototype.delegate=function(){return this.myDelegate},s.prototype.addToSelection=function(e){var t=this;function n(e){return-1==t.mySelectedIds.indexOf(e)&&(t.mySelectedIds.push(e),!0)}for(var i=0,r=e.length;i<r;++i){var o=e[i];if(n(o)){var a=t.idToElement[o];void 0===a?t.myDelegate.selectItem(o):a.classList.add("selected")}}},s.prototype.removeFromSelection=function(e){var t=this;function n(e){var n=t.mySelectedIds.indexOf(e);return-1!=n&&(t.mySelectedIds.splice(n,1),!0)}for(var i=e.length-1;i>=0;--i){var r=e[i];if(n(r)){var o=this.idToElement[r];void 0===o?t.myDelegate.deselectItem(r):o.classList.remove("selected")}}},s.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedIds),this.addToSelection(e),this.mySelectedIds},s.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedIds)},s.prototype.createElements=function(e,t){if(e)for(var n=0;n<e.length;n++){var i=e[n];this.createElement(i,t)}},s.prototype.createElement=function(e,t){var n=this,a=n.myDelegate.getNodeId(e),s=document.createElement("item");t.appendChild(s),this.idToElement[a]=s,s.onmouseover=function(){n.myDelegate.onNodeHover(n,e)},s.onclick=function(t){n.myRootContainer.querySelector(".flipped").removeClass("flipped"),n.myDelegate.onNodeClick(n,e,t)};var l=document.createElement("div");l.classList.add("card"),s.appendChild(l);var c=document.createElement("div");c.classList.add("browserElement"),l.appendChild(c);var u=n.myDelegate.getNodeLabel(e),h=document.createElement("label");h.innerHTML=u,c.appendChild(h),h.onclick=function(t){n.myDelegate.onNodeClick(n,e,t)};var d=n.myDelegate.getThumbnail(e);if(d){var f=document.createElement("img");f.classList.add("thumb");var p=n.myDelegate.getThumbnailOptions(e);i.Document.requestThumbnailWithSecurity(p,function(e,t){e?o.logger.error("Failed to load thumbnail: "+d,Object(r.errorCodeString)(r.ErrorCodes.NETWORK_FAILURE)):(f.src=window.URL.createObjectURL(t),f.onload=function(){window.URL.revokeObjectURL(f.src)})}),c.appendChild(f),f.onclick=function(t){n.myDelegate.onNodeClick(n,e,t)}}n.myDelegate.hasContent(e)&&n.myDelegate.addContent(e,l),s.classList.add(n.myDelegate.getNodeClass(e))}},function(e,t,n){"use strict";n.r(t),n.d(t,"ViewerObjectContextMenu",function(){return o});var i=n(114),r=n(1);function o(e){i.ObjectContextMenu.call(this,e)}o.prototype=Object.create(i.ObjectContextMenu.prototype),o.prototype.constructor=o,o.prototype.buildMenu=function(e,t){var n=this;if(this.viewer.model){var i=this,o=[],a=this.viewer.navigation,s=this.viewer.model.is2d();t.hasSelected&&(o.push({title:"Isolate",target:function(){var e=i.viewer.getAggregateSelection();i.viewer.impl.visibilityManager.aggregateIsolate(e),i.viewer.clearSelection(),r.logger.track({name:"isolate_count",aggregate:"count"})}}),t.hasVisible&&o.push({title:"Hide Selected",target:function(){var e=i.viewer.impl.visibilityManager;i.viewer.getAggregateSelection(function(t,n){e.hide(n,t)}),i.viewer.clearSelection()}}),t.hasHidden&&o.push({title:"Show Selected",target:function(){var e=i.viewer.getSelection();i.viewer.clearSelection(),i.viewer.show(e)}})),s&&o.push({title:"Show All Layers",target:function(){i.viewer.setLayerVisible(null,!0)}}),o.push({title:"Show All Objects",target:function(){i.viewer.showAll(),r.logger.track({name:"showall",aggregate:"count"})}});var l=i.viewer.getAggregateSelection();if(!s&&1===l.length&&a.isActionEnabled("gotoview")&&o.push({title:"Focus",target:function(){if((l=i.viewer.getAggregateSelection()).length>0){var e=l[0];i.viewer.fitToView(e.selection,e.model)}else 0===l.length&&i.viewer.fitToView();r.logger.track({name:"fittoview",aggregate:"count"})}}),!s){var c=this.viewer.impl.getCanvasBoundingClientRect(),u=e.clientX-c.left,h=e.clientY-c.top,d=this.viewer.clientToWorld(u,h,!1);d&&o.push({title:"Pivot",target:function(){n.viewer.navigation.setPivotPoint(d.point)}})}return t.hasSelected&&o.push({title:"Clear Selection",target:function(){i.viewer.clearSelection(),r.logger.track({name:"clearselection",aggregate:"count"})}}),o}}},function(e,t,n){"use strict";n.r(t),n.d(t,"GuiViewer3D",function(){return D});var i=n(57),r=n(144),o=n(2),a=n(3),s=n(80),l=n(53),c=n(9),u=n(8),h=n(35),d=n(102),f=n(55),p=n(67),m=n(151),g=n(1),v=n(11),y=n(153),_=n(93),b=n(68),x=n(88),w=n(63),A=n(155),E=n(56),T=n(89),M=n(154),S=n(7),C=n(78),P=n(49),L=n(23),R=n(30);function D(e,t){t||(t={}),t.startOnInitialize=!1,i.Viewer3D.call(this,e,t),this.toolbar=null,this.dockingPanels=[],this.modelstructure=null,this.layersPanel=null,this.onFullScreenModeEvent=this.onFullScreenModeEvent.bind(this)}D.prototype=Object.create(i.Viewer3D.prototype),D.prototype.constructor=D,D.prototype.initialize=function(){var e=i.Viewer3D.prototype.initialize.call(this);if(e>0)return p.ErrorHandler.reportError(this.container,e),e;var t=this;if(this.toolController){var n=new r.HotGestureTool(this);this.toolController.registerTool(n),this.toolController.activateTool(n.getName())}return this.getToolbar(!0),this.addEventListener(o.FULLSCREEN_MODE_EVENT,this.onFullScreenModeEvent),this.contextMenu||this.setDefaultContextMenu(),this.progressbar=new m.ProgressBar(this.container),this.addEventListener(o.PROGRESS_UPDATE_EVENT,function(e){void 0!==e.percent&&t.progressbar.setPercent(e.percent)},!1),this.selectionActive=!1,this.addEventListener(o.SELECTION_CHANGED_EVENT,function(e){(t.selectionActive=e.dbIdArray.length>0,t.prefs.openPropertiesOnSelect)&&t.getPropertyPanel(!0).setVisible(t.selectionActive)}),this.addEventListener(o.ISOLATE_EVENT,function(e){(t.prefs.openPropertiesOnSelect||e.nodeIdArray[0]===e.model.getRootId())&&t.propertygrid&&t.propertygrid.setVisible(e.nodeIdArray.length>0||t.selectionActive)}),this.addEventListener(o.VIEWER_STATE_RESTORED_EVENT,function(e){t.renderoptions&&t.renderoptions.syncUI()}),this.addEventListener(o.VIEWER_RESIZE_EVENT,function(e){t.resizePanels(),t.viewCubeUi&&t.viewCubeUi.cube&&t.viewCubeUi.cube.refreshCube(),t.updateToolbarButtons(e.width,e.height)}),this.addEventListener(o.NAVIGATION_MODE_CHANGED_EVENT,function(e){t.updateToolbarButtons(t.container.clientWidth,t.container.clientHeight)}),this.addEventListener(o.MODEL_UNLOADED_EVENT,function(e){t._onUnloadModel(e.model)}),this.initEscapeHandlers(),this.localize(),this.addEventListener(o.WEBGL_CONTEXT_LOST_EVENT,function(e){this.impl.stop();for(var t=this.container,n=t.childElementCount,i=0;i<n;++i)t.children[i].style.display="none";p.ErrorHandler.reportError(this.container,S.ErrorCodes.WEBGL_LOST_CONTEXT)}.bind(this)),this.run(),0},D.prototype.uninitialize=function(){this.viewerSettingsPanel&&(this.viewerSettingsPanel.uninitialize(),this.viewerSettingsPanel=null),this.modelstructure&&(this.modelstructure.uninitialize(),this.modelstructure=null),this.layersPanel&&(this.layersPanel.uninitialize(),this.layersPanel=null),this.propertygrid&&(this.propertygrid.uninitialize(),this.propertygrid=null),this.renderoptions&&(this.renderoptions.uninitialize(),this.renderoptions=null),this.viewerOptionButton&&(this.viewerOptionButton=null),this.getHotkeyManager().popHotkeys("Autodesk.ROLL"),this.getHotkeyManager().popHotkeys("Autodesk.FOV"),this.removeEventListener(o.FULLSCREEN_MODE_EVENT,this.onFullScreenModeEvent),this.progressbar=null,this.modelTools=null,this.navTools=null,this.settingsTools=null,this.debugMenu=null,this.modelStats=null,this.explodeSlider=null,this.explodeSubmenu=null,this.toolbar=null,i.Viewer3D.prototype.uninitialize.call(this)},D.prototype.setUp=function(e){e||(e={}),e.startOnInitialize=!1,this.getToolbar(!0),i.Viewer3D.prototype.setUp.call(this,e)},D.prototype.tearDown=function(){i.Viewer3D.prototype.tearDown.call(this),this.toolbar&&(this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.modelstructure&&this.setModelStructurePanel(null),this.propertygrid&&this.setPropertyPanel(null),this.viewerSettingsPanel&&this.setSettingsPanel(null),this.layersPanel&&this.setLayersPanel(null),this.renderoptions&&(this.removePanel(this.renderoptions),this.renderoptions.uninitialize(),this.renderoptions=null),this.debugMenu=null,this.removeEventListener(o.GEOMETRY_LOADED_EVENT,this.initViewCube)},D.prototype.loadModel=function(e,t,n,r,o){var a=this;return i.Viewer3D.prototype.loadModel.call(this,e,t,function(e){setTimeout(function(){t&&t.loadAsHidden||function(e){a.running?a.createUI(e):g.logger.error("createUI expects the viewer to be running.",Object(S.errorCodeString)(S.ErrorCodes.VIEWER_INTERNAL_ERROR))}(e),a._onLoadModel(e),n&&n.call(n,e)},1)},function(e){p.ErrorHandler.reportError(a.container,e),r&&r.apply(r,arguments)},o)},D.prototype.createUI=function(e){if(this.model===e){var t=this;this.initViewCube=function(){setTimeout(function(){if(!t.impl.is2d&&(t.displayViewCube(t.prefs.viewCube),!t.model.hasGeometry())){var e=S.ErrorCodes.BAD_DATA_MODEL_IS_EMPTY;p.ErrorHandler.reportError(t.container,e,"Model is empty"),t._loadingSpinner.hide()}},1)};var n=this.config.disabledExtensions||{};this.initHotkeys(e);var i=this.getExtension("Autodesk.DefaultTools.NavTools");i?i.updateUI(e.is3d()):this.loadExtension("Autodesk.DefaultTools.NavTools",t.config),this.initModelTools(e),Object(a.getGlobal)().ENABLE_DEBUG&&this.initDebugTools(),"true"===Object(v.getParameterByName)("lmv_viewer_debug")&&this.loadExtension("Autodesk.Debug",this.config),this.toolbar.container.style.display="block",this.dispatchEvent({type:L.TOOLBAR_CREATED_EVENT}),this.createViewCube(),this.dispatchEvent({type:L.VIEW_CUBE_CREATED_EVENT}),this.initModality(),this.resize(),e.is2d()?(this.unloadExtension("Autodesk.BimWalk"),this.unloadExtension("Autodesk.Section"),this.unloadExtension("Autodesk.Viewing.FusionOrbit"),this.setDefaultNavigationTool("pan"),this.setClickToSetCOI(!1,!1),this.displayViewCube(!1,!1),setTimeout(function(){n.measure||t.loadExtension("Autodesk.Measure",t.config),n.hyperlink||t.loadExtension("Autodesk.Hyperlink",t.config)},1)):(-1===this.getDefaultNavigationToolName().indexOf("orbit")&&this.setDefaultNavigationTool("orbit"),setTimeout(function(){n.bimwalk||t.loadExtension("Autodesk.BimWalk",t.config),t.prefs.fusionOrbit&&t.loadExtension("Autodesk.Viewing.FusionOrbit",t.config),n.measure||t.loadExtension("Autodesk.Measure",t.config),n.section||t.loadExtension("Autodesk.Section",t.config),n.hyperlink||t.loadExtension("Autodesk.Hyperlink",t.config),n.scalarisSimulation||t.model.isScalaris&&t.loadExtension("Autodesk.Viewing.ScalarisSimulation",t.config)},1),e.isLoadDone()?this.initViewCube():this.addEventListener(o.GEOMETRY_LOADED_EVENT,this.initViewCube,{once:!0}))}},D.prototype.onFullScreenModeEvent=function(e){this.resizePanels(),this.updateFullscreenButton(e.mode)},D.prototype._onLoadModel=function(e){this.modelstructure&&this.modelstructure.addModel(e)},D.prototype._onUnloadModel=function(e){this.modelstructure&&this.modelstructure.unloadModel(e)},D.prototype.addOptionToggle=function(e,t,n,i,r){var o=r?this.prefs[r]:null;n="boolean"==typeof o?o:n;var s=document.createElement("li");s.className="toolbar-submenu-listitem";var l=document.createElement("input");l.className="toolbar-submenu-checkbox",l.type="checkbox",l.id=t,s.appendChild(l);var u=document.createElement("label");return u.setAttribute("for",t),u.setAttribute("data-i18n",t),u.textContent=c.i18n.translate(t),s.appendChild(u),e.appendChild(s),l.checked=n,l.addEventListener("touchstart",a.touchStartToClick),u.addEventListener("touchstart",a.touchStartToClick),s.addEventListener("touchstart",a.touchStartToClick),l.addEventListener("click",function(e){i(l.checked),e.stopPropagation()}),u.addEventListener("click",function(e){e.stopPropagation()}),s.addEventListener("click",function(e){i(!l.checked),e.stopPropagation()}),r&&this.prefs.addListeners(r,function(e){l.checked=e},function(e){l.checked=e,i(e)}),l},D.prototype.addOptionList=function(e,t,n,i,r,o){var a=this.prefs[o];i="number"==typeof a?a:i;var s=document.createElement("select");s.className="option-drop-down",s.id="selectMenu_"+t;for(var l=0;l<n.length;l++){var u=document.createElement("option");u.value=l,u.setAttribute("data-i18n",n[l]),u.textContent=c.i18n.translate(n[l]),s.add(u)}var h=document.createElement("li");h.className="toolbar-submenu-select";var d=document.createElement("div");return d.className="toolbar-submenu-selectlabel",d.setAttribute("for",t),d.setAttribute("data-i18n",t),d.textContent=c.i18n.translate(t),h.appendChild(d),h.appendChild(s),e.appendChild(h),s.selectedIndex=i,s.onchange=function(e){var t=e.target.selectedIndex;r(t),e.stopPropagation()},s.addEventListener("touchstart",function(e){e.stopPropagation()}),s.addEventListener("click",function(e){e.stopPropagation()}),o&&this.prefs.addListeners(o,function(e){s.selectedIndex=e},function(e){s.selectedIndex=e,r(e)}),s},D.prototype.showViewer3dOptions=function(e){var t=this.getSettingsPanel(!0);e&&t.isVisible()&&t.setVisible(!1),t.setVisible(e)},D.prototype.showRenderingOptions=function(e){this.renderoptions.setVisible(e)},D.prototype.showLayerManager=function(e){this.layersPanel.setVisible(e)},D.prototype.initHotkeys=function(e){var t,n,i,r,o=this,a=R.KeyCode;e.is2d()||(t=function(){return!(o.toolController.getIsLocked()||!o.navigation.isActionEnabled("fov"))&&(i=o.getActiveNavigationTool(),o.setActiveNavigationTool("fov"),!0)},n=function(){return!(o.toolController.getIsLocked()||!o.navigation.isActionEnabled("fov"))&&(o.setActiveNavigationTool(i),!0)},o.getHotkeyManager().pushHotkeys("Autodesk.FOV",[{keycodes:[a.CONTROL,a.SHIFT],onPress:t,onRelease:n}],{tryUntilSuccess:!0}));t=function(){return!(o.toolController.getIsLocked()||!o.navigation.isActionEnabled("roll"))&&(r=o.getActiveNavigationTool(),o.setActiveNavigationTool("worldup"),!0)},n=function(){return!(o.toolController.getIsLocked()||!o.navigation.isActionEnabled("roll"))&&(o.setActiveNavigationTool(r),!0)},o.getHotkeyManager().pushHotkeys("Autodesk.ROLL",[{keycodes:[a.ALT,a.SHIFT],onPress:t,onRelease:n}],{tryUntilSuccess:!0})},D.prototype.setModelStructurePanel=function(e){if(e===this.modelstructure)return!1;var t=!1;if(this.modelstructure&&(t=!0,this.modelstructure.setVisible(!1),this.removePanel(this.modelstructure),this.modelstructure.uninitialize()),this.modelstructure=e,!e)return!0;if(this.addPanel(this.modelstructure),t)for(var n=this.impl.modelQueue().getModels(),i=0;i<n.length;++i)this.modelstructure.addModel(n[i]);var r=this;return e.addVisibilityListener(function(t){t&&r.onPanelVisible(e,r),r.settingsTools.structurebutton.setState(t?u.Button.State.ACTIVE:u.Button.State.INACTIVE)}),!0},D.prototype.setLayersPanel=function(e){var t=this;return!(this.model&&!this.impl.getLayersRoot())&&((e instanceof C.LayersPanel||!e)&&(this.layersPanel&&(this.layersPanel.setVisible(!1),this.removePanel(this.layersPanel),this.layersPanel.uninitialize()),this.layersPanel=e,e&&(this.addPanel(e),e.addVisibilityListener(function(n){n&&t.onPanelVisible(e,t),t.settingsTools.layerButton.setState(n?u.Button.State.ACTIVE:u.Button.State.INACTIVE)})),!0))},D.prototype.setPropertyPanel=function(e){var t=this;return(e instanceof P.PropertyPanel||!e)&&(this.propertygrid&&(this.propertygrid.setVisible(!1),this.removePanel(this.propertygrid),this.propertygrid.uninitialize()),this.propertygrid=e,e&&(this.addPanel(e),e.addVisibilityListener(function(n){n&&t.onPanelVisible(e,t),t.settingsTools.propertiesbutton.setState(n?u.Button.State.ACTIVE:u.Button.State.INACTIVE)})),!0)},D.prototype.getPropertyPanel=function(e){return!this.propertygrid&&e&&this.setPropertyPanel(new A.ViewerPropertyPanel(this)),this.propertygrid},D.prototype.setSettingsPanel=function(e){var t=this;return(e instanceof E.SettingsPanel||!e)&&(this.viewerSettingsPanel&&(this.viewerSettingsPanel.setVisible(!1),this.removePanel(this.viewerSettingsPanel),this.viewerSettingsPanel.uninitialize()),this.viewerSettingsPanel=e,e&&(this.addPanel(e),e.addVisibilityListener(function(n){n&&t.onPanelVisible(e,t),t.viewerOptionButton.setState(n?u.Button.State.ACTIVE:u.Button.State.INACTIVE)})),!0)},D.prototype.getSettingsPanel=function(e){return!this.viewerSettingsPanel&&e&&this.setSettingsPanel(new T.ViewerSettingsPanel(this,this.model)),this.viewerSettingsPanel},D.prototype.createSettingsPanel=function(e){var t=new T.ViewerSettingsPanel(this,e);this.setSettingsPanel(t),t.syncUI();var n=new u.Button("toolbar-settingsTool");this.viewerOptionButton=n,n.setIcon("adsk-icon-settings"),n.setToolTip("Settings"),this.settingsTools.addControl(n),this.createViewerOptionsMenu(e)},D.prototype.initModelTools=function(e){var t=this;if(!e.is2d()){if(!t.modelstructure){var n={docStructureConfig:t.config.docStructureConfig,hideSearch:Object(a.isMobileDevice)(),excludeRoot:t.config.modelBrowserExcludeRoot,startCollapsed:t.config.modelBrowserStartCollapsed},i=this.config.defaultModelStructureTitle?this.config.defaultModelStructureTitle:"Browser";t.setModelStructurePanel(new M.ViewerModelStructurePanel(t,i,n))}var r=new u.Button("toolbar-modelStructureTool");r.setToolTip("Model browser"),r.setIcon("adsk-icon-structure"),r.onClick=function(e){t.showModelStructurePanel(!t.modelstructure.isVisible())},this.settingsTools.addControl(r),this.settingsTools.structurebutton=r,this.initExplodeSlider()}var l=function(){var e=t.impl.layers.getRoot();if(e&&e.childCount>0){var n=new s.ViewerLayersPanel(this);this.setLayersPanel(n);var i=new u.Button("toolbar-layers-tool");i.setToolTip("Layer Manager"),i.setIcon("adsk-icon-layers"),i.onClick=function(e){t.layersPanel||t.setLayersPanel(new s.ViewerLayersPanel(t)),t.showLayerManager(!t.layersPanel.isVisible())};var r=this.settingsTools.indexOf("toolbar-modelStructureTool");r=-1!==r?r:0,this.settingsTools.addControl(i,{index:r+1}),this.settingsTools.layerButton=i}t.removeEventListener(o.MODEL_LAYERS_LOADED_EVENT,l)}.bind(this);t.impl.layers&&t.impl.layers.initialized?l():this.addEventListener(o.MODEL_LAYERS_LOADED_EVENT,l),t.addEventListener(o.RESET_EVENT,function(){t.model&&!t.model.is2d()&&(t.explode(0),t.explodeSlider.value=0),t.showAll()});var c=new u.Button("toolbar-propertiesTool");if(c.setToolTip("Properties"),c.setIcon("adsk-icon-properties"),c.onClick=function(e){var n=t.getPropertyPanel(!0);n.setVisible(!n.isVisible())},c.setVisible(!t.prefs.openPropertiesOnSelect),this.settingsTools.addControl(c),this.settingsTools.propertiesbutton=c,this.createSettingsPanel(e),Object(a.getGlobal)().ENABLE_DEBUG&&!e.is2d()){this.renderoptions=new y.RenderOptionsPanel(this),this.addPanel(this.renderoptions);var h=new u.Button("toolbar-renderOptionsTool");h.setToolTip("Rendering options"),h.setIcon("adsk-icon-settings-render"),h.onClick=function(e){t.showRenderingOptions(!t.renderoptions.isVisible())},this.settingsTools.addControl(h)}if(this.canChangeScreenMode()){var d=new u.Button("toolbar-fullscreenTool",{collapsible:!1});d.setToolTip("Full screen"),d.setIcon("adsk-icon-fullscreen"),d.onClick=function(e){t.nextScreenMode()},this.settingsTools.addControl(d),this.settingsTools.fullscreenbutton=d,this.updateFullscreenButton(this.getScreenMode())}},D.prototype.setPropertiesOnSelect=function(e){this.prefs.set("openPropertiesOnSelect",e),this.settingsTools.propertiesbutton.setVisible(!e)},D.prototype.addDivider=function(e){var t=document.createElement("li");return t.className="toolbar-submenu-horizontal-divider",e.appendChild(t),t},D.prototype.createViewerOptionsMenu=function(e){var t=this;this.viewerOptionButton.onClick=function(){t.getSettingsPanel(!0).isVisible()?t.showViewer3dOptions(!1):t.showViewer3dOptions(!0)}},D.prototype.initDebugTools=function(){if(this.debugMenu)return!1;var e=new h.ControlGroup("debugTools");this.debugMenu=e;var t=new u.Button("toolbar-debugTool");return t.setIcon("adsk-icon-bug"),e.addControl(t),this.debugMenu.debugSubMenuButton=t,this.createDebugSubmenu(this.debugMenu.debugSubMenuButton),this.toolbar.addControl(e),!0},D.prototype.removeDebugTools=function(){this.debugMenu&&(this.toolbar.removeControl(this.debugMenu),this.debugMenu=null)},D.prototype.createDebugSubmenu=function(e){var t=this,n=document.createElement("div");n.id="toolbar-debugToolSubmenu",n.classList.add("toolbar-submenu"),n.classList.add("toolbar-settings-sub-menu"),n.classList.add("adsk-hidden"),this.debugMenu.subMenu=n,this.debugMenu.subMenu.style.minWidth="180px",this.container.appendChild(n),this.initModelStats(),this.addDivider(n),this.addDivider(n);var i=_.Lang.getLanguages(),r=i.map(function(e){return e.label}),o=i.map(function(e){return e.symbol});function s(){t.localize()}var l=t.selectedLanguage?t.selectedLanguage:0;this.addOptionList(n,"Language",r,l,function(e){var n=o[e];t.selectedLanguage=e,Object(b.setLanguage)(n,s)},null).parentNode.style.paddingBottom="15px",this.addDivider(this.debugMenu.subMenu);this.addOptionList(n,"Error",["UNKNOWN FAILURE","BAD DATA","NETWORK ERROR","NETWORK ACCESS DENIED","NETWORK FILE NOT FOUND","NETWORK SERVER ERROR","NETWORK UNHANDLED RESPONSE CODE","BROWSER WEBGL NOT SUPPORTED","BAD DATA NO VIEWABLE CONTENT"],0,function(e){var n=e+1;p.ErrorHandler.reportError(t.container,n,"")},null).parentNode.style.paddingBottom="15px";var c=n.getBoundingClientRect();this.debugMenu.subMenu.style.width=c.width+"px",this.container.removeChild(n),e.container.appendChild(n);var u=c.left+c.width,h=this.container.getBoundingClientRect().right;if(u>h){var d=-(u-h+10)+"px";this.debugMenu.subMenu.style.left=d}e.onMouseOver=function(e){n.classList.remove("adsk-hidden")},e.onMouseOut=function(e){n.classList.add("adsk-hidden")},Object(a.isTouchDevice)()&&(e.onClick=function(e){n.classList.toggle("adsk-hidden")})},D.prototype.initModelStats=function(){var e=this;function t(t){var n=e.impl,i="";e.model&&(i+="Geom&nbsp;polys:&nbsp;"+n.modelQueue().getGeometryList().geomPolyCount+"<br>",i+="Instance&nbsp;polys:&nbsp;"+n.modelQueue().getGeometryList().instancePolyCount+"<br>",i+="Fragments:&nbsp;"+n.modelQueue().getFragmentList().getCount()+"<br>",i+="Geoms:&nbsp;"+n.modelQueue().getGeometryList().geoms.length+"<br>",i+="Loading&nbsp;time:&nbsp;"+(n.model.loader.loadTime/1e3).toFixed(2)+" s<br>"),i+="# "+(t||""),e.modelStats.innerHTML=i}this.addOptionToggle(this.debugMenu.subMenu,"Model statistics",!1,function(n){n&&!e.modelStats&&(e.modelStats=document.createElement("div"),e.modelStats.className="statspanel",e.container.appendChild(e.modelStats),e.addEventListener(o.PROGRESS_UPDATE_EVENT,function(e){e.message&&t(e.message)}),e.fpsDisplay=document.createElement("div"),e.fpsDisplay.className="fps",e.container.appendChild(e.fpsDisplay),t("")),e.modelStats.style.visibility=n?"visible":"hidden",e.fpsDisplay.style.visibility=n?"visible":"hidden",e.impl.fpsCallback=n?function(t){e.fpsDisplay.textContent=""+(0|t)}:null})},D.prototype.initEscapeHandlers=function(){var e=this;this.addEventListener(o.ESCAPE_EVENT,function(t){if(!e.contextMenu||!e.contextMenu.hide())if(e.renderoptions&&e.renderoptions.isVisible())e.renderoptions.setVisible(!1);else{if(e.getActiveNavigationTool()!==e.getDefaultNavigationToolName())return e.toolController&&e.toolController.setIsLocked(!1),e.setActiveNavigationTool(),void x.HudMessage.dismiss();if(e.selectionActive)e.clearSelection();else if(e.areAllVisible()){if(!w.AlertBox.dismiss()){for(var n=0;n<e.dockingPanels.length;++n){var i=e.dockingPanels[n];if("none"!==i.container.style.display&&""!==i.container.style.display)return void(i.container===e.modelstructure?e.showModelStructurePanel(!1):i.setVisible(!1))}e.escapeScreenMode()}}else e.showAll()}})},D.prototype.showViewCubeUI=function(e){this.viewCubeUi.setVisible(e)},D.prototype.showViewCubeTriad=function(e){this.viewCubeUi.showTriad(e)},D.prototype.displayViewCube=function(e,t){this.viewCubeUi.displayViewCube(e,t)},D.prototype.displayHomeandInfoButton=function(e){g.logger.info("viewer.displayHomeandInfoButton() is deprecated. Use viewer.displayHomeButton() instead."),this.displayHomeButton(e)},D.prototype.displayHomeButton=function(e){var t=this.container.querySelector(".homeViewWrapper");t&&(t.style.display=e?"":"none")},D.prototype.getToolbar=function(e){return this.toolbar||e&&(this.toolbar=new d.ToolBar("guiviewer3d-toolbar"),this.navTools=new f.RadioButtonGroup(L.TOOLBAR.NAVTOOLSID),this.modelTools=new h.ControlGroup(L.TOOLBAR.MODELTOOLSID),this.settingsTools=new h.ControlGroup(L.TOOLBAR.SETTINGSTOOLSID),this.toolbar.addControl(this.navTools),this.toolbar.addControl(this.modelTools),this.toolbar.addControl(this.settingsTools),this.container.appendChild(this.toolbar.container),this.toolbar.container.style.display="none"),this.toolbar},D.prototype.showModelStructurePanel=function(e){this.modelstructure.setVisible(e)},D.prototype.onPanelVisible=function(e){this.dockingPanels.splice(this.dockingPanels.indexOf(e),1),this.dockingPanels.splice(0,0,e)},D.prototype.updateFullscreenButton=function(e){var t="adsk-icon-fullscreen";switch(e){case l.ScreenMode.kNormal:this.isScreenModeSupported(l.ScreenMode.kFullBrowser)||(t="adsk-icon-fullscreen");break;case l.ScreenMode.kFullBrowser:t=this.isScreenModeSupported(l.ScreenMode.kFullScreen)?"adsk-icon-fullscreen":"adsk-icon-fullscreen-exit";break;case l.ScreenMode.kFullScreen:t="adsk-icon-fullscreen-exit"}this.settingsTools.fullscreenbutton.setIcon(t)},D.prototype.localize=function(){i.Viewer3D.prototype.localize.call(this),this.debugMenu&&this.debugMenu.debugSubMenuButton&&(this.debugMenu.debugSubMenuButton.container.removeChild(this.debugMenu.subMenu),this.createDebugSubmenu(this.debugMenu.debugSubMenuButton)),p.ErrorHandler.localize()},D.prototype.addPanel=function(e){return-1===this.dockingPanels.indexOf(e)&&(this.dockingPanels.push(e),!0)},D.prototype.removePanel=function(e){var t=this.dockingPanels.indexOf(e);return t>-1&&(this.dockingPanels.splice(t,1),!0)},D.prototype.resizePanels=function(e){e=e||{};var t=this.toolbar?this.toolbar.getDimensions().height:0,n=this.getDimensions(),i=n.height;e.dimensions&&e.dimensions.height?i=e.dimensions.height:e.dimensions={height:n.height,width:n.width},e.dimensions.height=i-t;var r=e?e.dockingPanels:null;r||(r=this.dockingPanels);var o,a,s=this.container.getBoundingClientRect(),l=s.top,c=s.bottom,u=s.left,h=s.right;e&&e.dimensions?(o=e.dimensions.width,a=e.dimensions.height,c=e.dimensions.height):(o=s.width,a=s.height);for(var d=0;d<r.length;++d)r[d].onViewerResize(l,c,u,h,o,a)},D.prototype.initExplodeSlider=function(){var e=this,t=new u.Button("toolbar-explodeTool");t.setIcon("adsk-icon-explode"),t.setToolTip("Explode model"),e.modelTools.addControl(t,{index:0});var n;this.explodeSubmenu=Object(v.stringToDOM)('<div class="docking-panel docking-panel-container-solid-color-b explode-submenu" style="display:none"><input class="explode-slider" type="range" min="0" max="1" step="0.01" value="0"/></div>'),Object(a.isIOSDevice)()?(n=document.querySelector("#toolbar-explodeTool").parentNode,this.explodeSubmenu.classList.add("ios")):n=t.container,n.appendChild(this.explodeSubmenu);var i=this.explodeSubmenu.querySelector(".explode-slider");e.explodeSlider=i,i.oninput=function(t){e.explode(i.value)},i.onchange=function(t){e.explode(i.value)},this.explodeSubmenu.onclick=function(e){e.stopPropagation()};var r=t.container.querySelector(".adsk-control-tooltip");t.onClick=function(n){var o=t.getState();o===u.Button.State.INACTIVE?(t.setState(u.Button.State.ACTIVE),r.style.display="none",e.explodeSubmenu.style.display="",g.logger.track({category:"tool_changed",name:"explode"})):o===u.Button.State.ACTIVE&&(t.setState(u.Button.State.INACTIVE),r.style.display="",i.parentNode.style.display="none",e.explode(0),e.explodeSlider.value=0)}},D.prototype.initInspectTools=function(){var e=new u.Button("toolbar-inspectTools");e.setToolTip("Inspect"),e.setIcon("measure"),e.setVisible(!1),this.modelTools.addControl(e);var t=new f.RadioButtonGroup("toolbar-inspectSubMenu");t.addClass("toolbar-vertical-group"),t.setVisible(!1),this.modelTools.addControl(t),e.container.insertBefore(t.container,e.container.firstChild),e.onMouseOver=function(){t.setVisible(!0)},e.onMouseOut=function(){t.setVisible(!1)},Object(a.isTouchDevice)()&&(e.onClick=function(e){t.setVisible(!t.isVisible())})},D.prototype.initModality=function(){function e(e){return e.id.substring(8,e.id.length)}function t(e){var t=document.createEvent("Event");t.initEvent("click",!0,!0),e.dispatchEvent(t)}var n={orbitTools:{explodeTool:1},panTool:{explodeTool:1},zoomTool:{explodeTool:1},beelineTool:{},sectionTool:{measureTool:0,calibrateTool:0},explodeTool:{measureTool:0,calibrateTool:0,firstPersonTool:1,bimWalkTool:1},measureTool:{section:0},firstPersonTool:{explodeTool:1},bimWalkTool:{explodeTool:1}},i={};function r(e,t,n){i[e]=n?t:void 0}this.toolbar.container.addEventListener("click",function(o){var a=(o.target.getAttribute("class")||"").split(/\s+/);if(-1===a.indexOf("clickoff")){var s=function e(t){for(var n=0;n<2&&t.parentElement;){var i=t.id;if(0===i.indexOf("toolbar-")){if(i.indexOf("arrow")===i.length-5)return;return e(t.parentElement)||t}t=t.parentElement,n++}}(o.target);if(s){var l=e(s);if(n[l]&&("sectionTool"!==l||-1===a.indexOf("adsk-icon-section-analysis")&&!o.target.querySelector(".adsk-icon-section-analysis"))&&("measureTool"!==l||-1===a.indexOf("adsk-icon-measure-menu")&&!o.target.querySelector(".adsk-icon-measure-menu"))){for(var c in i[l]&&r(l,s,!1),i){var u=i[c];if(u){var h=e(u);u.classList.contains("active")?n[l][h]||t(u):r(h,u,!1)}}r(l,s,!0)}}}},!0)},D.prototype.updateToolbarButtons=function(e,t){if(this.getToolbar(!1)){var n,i;i=e>310?"block":"none",(n=this.modelTools.getControl("toolbar-explodeTool"))&&n.setDisplay(i),i=e>380?"block":"none",(n=this.modelTools.getControl("toolbar-collaborateTool"))&&n.setDisplay(i),i=e>515?"block":"none";var r=this.navTools.getControl("toolbar-cameraSubmenuTool");r&&(r.setDisplay(i),(n=r.subMenu.getControl("toolbar-homeTool"))&&n.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),(n=r.subMenu.getControl("toolbar-fitToViewTool"))&&n.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),(n=r.subMenu.getControl("toolbar-focalLengthTool"))&&n.setDisplay(this.navigation.isActionEnabled("fov")?"block":"none"),(n=r.subMenu.getControl("toolbar-rollTool"))&&n.setDisplay(this.navigation.isActionEnabled("roll")?"block":"none")),i=e>700?"block":"none",(n=this.modelTools.getControl("toolbar-measureTool"))&&n.setDisplay(i),(n=this.modelTools.getControl("toolbar-sectionTool"))&&n.setDisplay(i),i=e>740?"block":"none",(n=this.navTools.getControl("toolbar-beelineTool"))&&n.setDisplay(this.navigation.isActionEnabled("walk")?i:"none"),(n=this.navTools.getControl("toolbar-firstPersonTool"))&&n.setDisplay(this.navigation.isActionEnabled("walk")?i:"none"),(n=this.navTools.getControl("toolbar-zoomTool"))&&n.setDisplay(this.navigation.isActionEnabled("zoom")?i:"none"),(n=this.navTools.getControl("toolbar-panTool"))&&n.setDisplay(this.navigation.isActionEnabled("pan")?i:"none"),(n=this.navTools.getControl("toolbar-orbitTools"))&&n.setDisplay(this.navigation.isActionEnabled("orbit")?i:"none")}}},function(e,t,n){"use strict";n.r(t);var i=n(39);function r(e,t){i.theExtensionManager.registerExternalExtension(e,t)}r("Autodesk.Viewing.Wireframes","extensions/Wireframes/Wireframes.min.js"),r("Autodesk.Viewing.ZoomWindow","extensions/ZoomWindow/ZoomWindow.min.js"),r("Autodesk.AEC.LevelsExtension","extensions/AEC/AEC.min.js"),r("Autodesk.AEC.HyperlinkExtension","extensions/AEC/AEC.min.js"),r("Autodesk.AEC.DropMeExtension","extensions/AEC/AEC.min.js"),r("Autodesk.AEC.CanvasBookmarkExtension","extensions/AEC/AEC.min.js"),r("Autodesk.AEC.Minimap3DExtension","extensions/AEC/AEC.min.js"),r("Autodesk.BIM360.Extension.PushPin","extensions/Pushpins/Pushpins.min.js"),r("Autodesk.Hyperlink","extensions/Hyperlink/Hyperlink.min.js"),r("Autodesk.Debug","extensions/Debug/Debug.min.js"),r("Autodesk.BimWalk","extensions/BimWalk/BimWalk.min.js"),r("Autodesk.Section","extensions/Section/Section.min.js"),r("Autodesk.CompGeom","extensions/CompGeom/CompGeom.min.js"),r("Autodesk.Viewing.MemoryManager","extensions/MemoryManager/MemoryManager.min.js"),r("Autodesk.Beeline","extensions/Beeline/Beeline.min.js"),r("Autodesk.FirstPerson","extensions/FirstPerson/FirstPerson.min.js"),r("Autodesk.Viewing.WebVR","extensions/webVR/webVR.min.js"),r("Autodesk.CAM360","extensions/CAM360/CAM360.min.js"),r("Autodesk.Viewing.Collaboration","extensions/Collaboration/Collaboration.min.js"),r("Autodesk.Fusion360.Simulation","extensions/FusionSim/FusionSim.min.js"),r("Autodesk.OMV","extensions/OMV/OMV.min.js"),r("Autodesk.SplitScreen","extensions/SplitScreen/SplitScreen.min.js"),r("Autodesk.CrossFadeEffects","extensions/CrossFadeEffects/CrossFadeEffects.min.js"),r("Autodesk.Moldflow","extensions/Moldflow/Moldflow.min.js"),r("Autodesk.Viewing.PixelCompare","extensions/PixelCompare/PixelCompare.min.js"),r("Autodesk.Viewing.ScalarisSimulation","extensions/ScalarisSimulation/ScalarisSimulation.min.js"),r("Autodesk.Measure","extensions/Measure/Measure.min.js"),r("Autodesk.Viewing.MarkupsCore","extensions/Markup/Markup.min.js"),r("Autodesk.Viewing.MarkupsGui","extensions/Markup/Markup.min.js"),r("Autodesk.PDF","extensions/PDF/PDF.min.js"),r("Autodesk.DocumentBrowser","extensions/DocumentBrowser/DocumentBrowser.min.js"),r("Autodesk.Geolocation","extensions/Geolocation/Geolocation.min.js")},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t),n.d(t,"InputStreamLess",function(){return r});var i=n(107);function r(e,t){this.offset=0,this.byteLength=t,this.range=0,this.compressedBuffer=e,this.compressedByteLength=e.length,this.compressedOffset=0,this.decompressEnd=!1,this.resetCount=0,this.convBuf=new ArrayBuffer(8),this.convUint8=new Uint8Array(this.convBuf),this.convUint16=new Uint16Array(this.convBuf),this.convInt32=new Int32Array(this.convBuf),this.convUint32=new Uint32Array(this.convBuf),this.convFloat32=new Float32Array(this.convBuf),this.convFloat64=new Float64Array(this.convBuf),this.COMPRESSED_chunk_SIZE=524288,this.DECOMPRESSED_chunk_SIZE=262144,this.chunks=[],this.chunksByteLengthMax=0,this.chunksByteLengthMin=0,this.chunkPointer=null,this.chunkOffset=0,this.tempchunk={startIdx:0,endIdx:0,buffer:null},this.inflate=this.getInflate(),this.prepare(0,1024)}r.prototype.getInflate=function(){if(!this.inflate){this.inflate=new i.Inflate({level:3,chunkSize:this.DECOMPRESSED_chunk_SIZE});var e=this;this.inflate.onData=function(t){e.chunksByteLengthMax+=t.byteLength,e.chunksByteLengthMax<e.offset&&(t=null,e.chunksByteLengthMin=e.chunksByteLengthMax),e.chunks.push(t)},this.inflate.onEnd=function(){if(e.decompressEnd=!0,e.inflate=null,e.chunksByteLengthMax!=e.byteLength)throw"Decompress error, unexpected size."}}return this.inflate},r.prototype.prepare=function(e,t,n){if(this.chunksByteLengthMin>e&&(this.reset(),this.offset=e,this.range=t),!n){for(var i=Math.floor(e/this.DECOMPRESSED_chunk_SIZE),r=Math.floor(this.chunksByteLengthMin/this.DECOMPRESSED_chunk_SIZE),o=this.chunks.length<i?this.chunks.length:i,a=r;a<o;a++)this.chunks[a]=null;this.chunksByteLengthMin=o*this.DECOMPRESSED_chunk_SIZE}var s=e+(t=t||1);s=s>this.byteLength?this.byteLength:s;for(var l=!1;s>this.chunksByteLengthMax;){var c=this.COMPRESSED_chunk_SIZE;this.compressedOffset+c>=this.compressedByteLength&&(c=this.compressedByteLength-this.compressedOffset,l=!0);var u=new Uint8Array(this.compressedBuffer.buffer,this.compressedOffset,c);if(this.getInflate().push(u,l),this.compressedOffset+=c,l)break}},r.prototype.ensurechunkData=function(e){e=e||1;var t=this.chunks.length,n=Math.floor(this.offset/this.DECOMPRESSED_chunk_SIZE),i=Math.floor((this.offset+e-1)/this.DECOMPRESSED_chunk_SIZE);if(i>=t){var r=(i-t+1)*this.DECOMPRESSED_chunk_SIZE;this.prepare(this.DECOMPRESSED_chunk_SIZE*t,r,!0)}if(n<i){if(this.tempchunk.startIdx>n||this.tempchunk.endIdx<i){var o=(i-n+1)*this.DECOMPRESSED_chunk_SIZE;this.tempchunk.buffer=new Uint8Array(o);for(var a=0,s=n;s<=i;s++)this.tempchunk.buffer.set(this.chunks[s],a),a+=this.DECOMPRESSED_chunk_SIZE;this.tempchunk.startIdx=n,this.tempchunk.endIdx=i}this.chunkPointer=this.tempchunk.buffer}else this.chunkPointer=this.chunks[n];this.chunkOffset=this.offset-n*this.DECOMPRESSED_chunk_SIZE,this.offset+=e},r.prototype.seek=function(e,t,n){this.offset=e,this.range=t,this.prepare(e,t,n)},r.prototype.getBytes=function(e){return this.ensurechunkData(e),new Uint8Array(this.chunkPointer.buffer,this.chunkOffset,e)},r.prototype.getVarints=function(){var e,t=0,n=0;do{this.ensurechunkData(),t|=(127&(e=this.chunkPointer[this.chunkOffset]))<<n,n+=7}while(128&e);return t},r.prototype.getUint8=function(){return this.ensurechunkData(),this.chunkPointer[this.chunkOffset]},r.prototype.getUint16=function(){return this.ensurechunkData(),this.convUint8[0]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),this.convUint8[1]=this.chunkPointer[this.chunkOffset],this.convUint16[0]},r.prototype.getInt16=function(){var e=this.getUint16();return e>32767&&(e|=4294901760),e},r.prototype.getInt32=function(){var e=this.convUint8;return this.ensurechunkData(),e[0]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),e[1]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),e[2]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),e[3]=this.chunkPointer[this.chunkOffset],this.convInt32[0]},r.prototype.getUint32=function(){var e=this.convUint8;return this.ensurechunkData(),e[0]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),e[1]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),e[2]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),e[3]=this.chunkPointer[this.chunkOffset],this.convUint32[0]},r.prototype.getFloat32=function(){var e=this.convUint8;return this.ensurechunkData(),e[0]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),e[1]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),e[2]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),e[3]=this.chunkPointer[this.chunkOffset],this.convFloat32[0]},r.prototype.getFloat64=function(){for(var e=this.convUint8,t=0;t<8;t++)this.ensurechunkData(),e[t]=this.chunkPointer[this.chunkOffset];return this.convFloat64[0]},r.prototype.getString=function(e){var t="";this.ensurechunkData(e);for(var n,i=this.chunkPointer,r=this.chunkOffset,o=this.chunkOffset+e;r<o;r++)t+=String.fromCharCode(i[r]);try{n=decodeURIComponent(escape(t))}catch(e){n=t,debug("Failed to decode string "+n)}return n},r.prototype.reset=function(e){this.resetCount++,debug("InputStream Less Reset: "+this.resetCount),e&&(this.compressedBuffer=e,this.compressedByteLength=e.length),this.offset=0,this.chunks=[],this.chunksByteLengthMax=0,this.chunksByteLengthMin=0,this.compressedOffset=0,this.decompressEnd=!1,this.chunkPointer=null,this.chunkOffset=0,this.inflate=null,this.tempchunk.startIdx=0,this.tempchunk.endIdx=0,this.tempchunk.buffer=null}},function(e,t,n){"use strict";function i(e){var t=Autodesk.Viewing,i=t.Private,r=t.UI,o=t.Extensions;for(var a in e.av)t[a]=e.av[a];for(var s in e.avp)i[s]=e.avp[s];for(var l in e.avu)r[l]=e.avu[l];for(var c in e.ave)o[c]=e.ave[c];t.getGlobal().THREE=e.THREE,t.getGlobal().LMV=e,i.isRightClick=t.isRightClick,i.isMiddleClick=t.isMiddleClick,t.getGlobal().pako=n(107)}n.r(t),n.d(t,"initializeLegacyNamespaces",function(){return i})},function(e,t,n){"use strict";n.r(t);var i=n(39),r=n(18);function o(e,t){r.Extension.call(this,e,t),this.viewer=e,this.options=t,this.propertyPanel=this.viewer.getPropertyPanel(!0),this.name="propertiesmanager"}o.prototype=Object.create(r.Extension.prototype),o.prototype.constructor=o;var a=o.prototype;a.activate=function(){return this.activeStatus||(this.propertyPanel.setVisible(!0),this.activeStatus=!0),!0},a.deactivate=function(){return this.activeStatus&&(this.propertyPanel.setVisible(!1),this.activeStatus=!1),!0};var s=n(89);function l(e,t){r.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="viewersettings"}l.prototype=Object.create(r.Extension.prototype),l.prototype.constructor=l;var c=l.prototype;c.activate=function(){this.activeStatus||(this.viewer.showViewer3dOptions(!0),this.viewer.getSettingsPanel(!0).selectTab(s.ViewerSettingTab.Performance),this.activeStatus=!0);return!0},c.deactivate=function(){return this.activeStatus&&(this.viewer.showViewer3dOptions(!1),this.activeStatus=!1),!0};var u=n(80);function h(e,t){r.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="layermanager"}h.prototype=Object.create(r.Extension.prototype),h.prototype.constructor=h;var d=h.prototype;function f(e,t){r.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="modelstructure"}d.activate=function(){return this.activeStatus||(this.viewer.layersPanel||this.viewer.setLayersPanel(new u.ViewerLayersPanel(this.viewer)),this.viewer.showLayerManager(!0),this.activeStatus=!0),!0},d.deactivate=function(){return this.activeStatus&&(this.viewer.layersPanel||this.viewer.setLayersPanel(new u.ViewerLayersPanel(this.viewer)),this.viewer.showLayerManager(!1),this.activeStatus=!1),!0},f.prototype=Object.create(r.Extension.prototype),f.prototype.constructor=f;var p=f.prototype;p.activate=function(){return this.activeStatus||(this.viewer.showModelStructurePanel(!0),this.activeStatus=!0),!0},p.deactivate=function(){return this.activeStatus&&(this.viewer.showModelStructurePanel(!1),this.activeStatus=!1),!0};var m=n(2),g=n(23),v=n(115),y=n(8),_=n(145),b=n(146),x=n(9),w=n(55),A=n(3),E=n(88),T="pan",M="dolly",S="freeorbit",C="orbit",P="fov",L="worldup",R="fittoview";function D(e,t){r.Extension.call(this,e,t),this.name="navtools",this.modes=[T,M,S,C,P,L,R],this.onToolChanged=this.onToolChanged.bind(this),this.onNavigationModeChanged=this.onNavigationModeChanged.bind(this)}D.prototype=Object.create(r.Extension.prototype),D.prototype.constructor=D;var I=D.prototype;function O(e,t,n){return function(){e.isActive(n)?e.deactivate():e.activate(n)}}function N(e,t){r.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="explode",this.slider=e.explodeSubmenu.querySelector(".explode-slider"),this.explodeButton=e.modelTools.getControl("toolbar-explodeTool")}I.load=function(){var e=this.viewer,t=new _.FovTool(e),n=new b.WorldUpTool(e.impl,e);return e.toolController.registerTool(t),e.toolController.registerTool(n),this.createUI(this.viewer.model.is3d()),this.initFocalLengthOverlay(),e.addEventListener(m.TOOL_CHANGE_EVENT,this.onToolChanged),e.addEventListener(m.NAVIGATION_MODE_CHANGED_EVENT,this.onNavigationModeChanged),!0},I.updateUI=function(e){e!==this.is3d&&(this.destroyUI(),this.createUI(e))},I.createUI=function(e){var t=this.viewer,n=t.getToolbar(!0).getControl(g.TOOLBAR.NAVTOOLSID),i=function(e){return t.navigation.isActionEnabled(e)?"block":"none"};if(e){var r=new v.ComboButton("toolbar-orbitTools");r.setToolTip("Orbit"),r.setIcon("adsk-icon-orbit-constrained"),r.setDisplay(i("orbit")),this.createOrbitSubmenu(r),n.addControl(r),n.orbittoolsbutton=r,r.setState(y.Button.State.ACTIVE),n.returnToDefault=function(){r.setState(y.Button.State.ACTIVE)}}var o=new y.Button("toolbar-panTool");o.setToolTip("Pan"),o.setIcon("adsk-icon-pan"),o.onClick=O(this,0,T),o.setDisplay(i("pan")),n.addControl(o),n.panbutton=o,e||(n.returnToDefault=function(){o.setState(y.Button.State.ACTIVE)},n.returnToDefault());var a=new y.Button("toolbar-zoomTool");a.setToolTip("Zoom"),a.setIcon("adsk-icon-zoom"),a.onClick=O(this,0,M),a.setDisplay(i("zoom")),n.addControl(a),n.dollybutton=a;var s=new v.ComboButton("toolbar-cameraSubmenuTool");s.setToolTip("Camera interactions"),s.setIcon("adsk-icon-camera"),s.saveAsDefault(),this.createCameraSubmenu(s,e),n.addControl(s),n.camerabutton=s,this.is3d=e},I.createOrbitSubmenu=function(e){var t=this.viewer.getToolbar(!0).getControl(g.TOOLBAR.NAVTOOLSID),n=new y.Button("toolbar-freeOrbitTool");n.setToolTip("Free orbit"),n.setIcon("adsk-icon-orbit-free"),n.onClick=O(this,0,S),e.addControl(n),t.freeorbitbutton=n;var i=new y.Button("toolbar-orbitTool");i.setToolTip("Orbit"),i.setIcon("adsk-icon-orbit-constrained"),i.onClick=O(this,0,C),e.addControl(i),t.orbitbutton=i,e.onClick=i.onClick},I.createCameraSubmenu=function(e,t){var n=this,i=this.viewer,r=i.getToolbar(!0).getControl(g.TOOLBAR.NAVTOOLSID),o=function(e){return i.navigation.isActionEnabled(e)?"block":"none"};if(Object(A.isTouchDevice)()){var a=new y.Button("toolbar-homeTool");a.setToolTip("Home"),a.setIcon("adsk-icon-home"),a.onClick=function(){i.navigation.setRequestHomeView(!0);var t=i.getDefaultNavigationToolName();n.activate(t),e.restoreDefault()},a.setDisplay(o("gotoview")),e.addControl(a),r.homebutton=a}var s=new y.Button("toolbar-fitToViewTool");if(s.setToolTip("Fit to view"),s.setIcon("adsk-icon-fit-to-view"),s.onClick=function(t){i.impl.fitToView(i.impl.selector.getAggregateSelection());var n=i.getDefaultNavigationToolName();i.setActiveNavigationTool(n),e.restoreDefault()},s.setDisplay(o("gotoview")),e.addControl(s),r.fittoviewbutton=s,t){var l=new y.Button("toolbar-focalLengthTool");l.setToolTip("Focal length"),l.setIcon("adsk-icon-fov"),l.onClick=O(this,0,P),l.setDisplay(o("fov")),e.addControl(l),r.fovbutton=l}var c=new y.Button("toolbar-rollTool");c.setToolTip("Roll"),c.setIcon("adsk-icon-roll"),c.onClick=O(this,0,L),c.setDisplay(o("roll")),e.addControl(c),r.rollbutton=c},I.onToolChanged=function(e){if("fov"===e.toolName&&this.showFocalLengthOverlay(e.active),e.active)switch(e.toolName){case"dolly":this.handleAltRelease("dollybutton");break;case"pan":this.handleAltRelease("panbutton");break;case"worldup":this.handleAltRelease("rollbutton");break;case"fov":this.handleAltRelease("fovbutton")}},I.onNavigationModeChanged=function(e){if(this.viewer.getDefaultNavigationToolName()===e.id){var t=this.viewer.getToolbar();if(!t)return;var n=t.getControl(g.TOOLBAR.NAVTOOLSID);if(!n)return;n.returnToDefault&&n.returnToDefault()}},I.handleAltRelease=function(e){var t=this.viewer.getToolbar();if(t){var n=t.getControl(g.TOOLBAR.NAVTOOLSID),i=n&&n[e];i&&i.setState(y.Button.State.ACTIVE)}},I.initFocalLengthOverlay=function(){var e=this.focallength=document.createElement("div");e.classList.add("message-panel"),e.classList.add("docking-panel"),e.classList.add("focal-length"),e.classList.add("docking-panel-container-solid-color-b");var t=document.createElement("table"),n=document.createElement("tbody");t.appendChild(n),e.appendChild(t),this.viewer.container.appendChild(e);var i=n.insertRow(-1),r=i.insertCell(0);r.classList.add("name"),r.setAttribute("data-i18n","Focal Length"),r.textContent=x.i18n.translate("Focal Length"),(r=i.insertCell(1)).classList.add("value"),r.textContent="",this.fovCell=r,e.style.visibility="hidden"},I.showFocalLengthOverlay=function(e){var t=this,n=this.viewer,i=0;function r(e){if(e){E.HudMessage.displayMessage(n.container,{msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."})}else E.HudMessage.dismiss()}function o(e){e&&a(),t.focallength&&(t.focallength.style.visibility=e?"visible":"hidden")}function a(){var e=n.getFocalLength();i!==e&&(i=e,t.fovCell.textContent=e.toString()+" mm")}function s(e){if(a(),"fov"===n.toolController.getActiveToolName()){var t=n.navigation.getCamera(),i=t&&!t.isPerspective;o(!i),r(i)}}var l=n.navigation.getCamera(),c=l&&!l.isPerspective;o(e&&!c),r(e&&c),e?n.addEventListener(m.CAMERA_CHANGE_EVENT,s):n.removeEventListener(m.CAMERA_CHANGE_EVENT,s)},I.unload=function(){return this.destroyUI(),!0},I.destroyUI=function(){var e=this.viewer,t=e.getToolbar(!1);if(!t)return!0;var n=t.getControl(g.TOOLBAR.NAVTOOLSID);return!n||(this.is3d&&(n.orbittoolsbutton.subMenu.removeEventListener(w.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,n.orbittoolsbutton.subMenuActiveButtonChangedHandler(n)),n.removeControl(n.orbittoolsbutton.getId()),n.orbittoolsbutton=null,n.orbitbutton.onClick=null,n.orbitbutton=null,n.freeorbitbutton.onClick=null,n.freeorbitbutton=null,n.fovbutton.onClick=null,n.fovbutton=null),n.removeControl(n.panbutton.getId()),n.panbutton.onClick=null,n.panbutton=null,n.removeControl(n.dollybutton.getId()),n.dollybutton.onClick=null,n.dollybutton=null,n.camerabutton.subMenu.removeEventListener(w.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,n.camerabutton.subMenuActiveButtonChangedHandler(n)),n.removeControl(n.camerabutton.getId()),n.camerabutton.onClick=null,n.camerabutton=null,n.rollbutton.onClick=null,n.rollbutton=null,n.removeControl(n.fittoviewbutton.getId()),n.fittoviewbutton.onClick=null,n.fittoviewbutton=null,this.focallength&&(e.container.removeChild(this.focallength),this.focallength=null),e.removeEventListener(m.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.toolChangedHandler=null,e.removeEventListener(m.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler),this.navChangedHandler=null,!0)},I.activate=function(e){return!this.isActive(e)&&(e===R?(this.viewer.impl.fitToView(this.viewer.impl.selector.getAggregateSelection()),!0):-1!=this.modes.indexOf(e)&&(this.viewer.setActiveNavigationTool(e),!0))},I.deactivate=function(){return this.viewer.setActiveNavigationTool(),!0},I.isActive=function(e){return this.viewer.getActiveNavigationTool()===e},N.prototype=Object.create(r.Extension.prototype),N.prototype.constructor=N;var k=N.prototype;function V(e,t){r.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="fullscreen"}k.activate=function(){return this.activeStatus||(this.viewer.explodeSubmenu.style.display="",this.activeStatus=!0),!0},k.deactivate=function(){return this.activeStatus&&(this.slider.parentNode.style.display="none",this.viewer.explode(0),this.viewer.explodeSlider.value=0,this.activeStatus=!1),!0},V.prototype=Object.create(r.Extension.prototype),V.prototype.constructor=V;var F=V.prototype;function B(e,t){r.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="gohome"}F.activate=function(){return this.activeStatus||(this.viewer.nextScreenMode(),this.activeStatus=!0),!0},F.deactivate=function(){return this.activeStatus&&(this.viewer.escapeScreenMode(),this.activeStatus=!1),!0},B.prototype=Object.create(r.Extension.prototype),B.prototype.constructor=B;var U=B.prototype;U.activate=function(){return this.viewer.navigation.setRequestHomeView(!0),!0},U.deactivate=function(){return!1};var z=n(102),G=n(35),H=n(19),W=(n(311),Autodesk.Viewing);function j(e,t){r.Extension.call(this,e,t),this.viewer=e,this.animTools=null,this.animToolsId="animationTools",this.playButton=null,this.playButtonIsPaused=!0,this.prevAnimationTime=-1,this.name="fusionanimation"}function X(e){var t="";e<0&&(t="-",e=-e);var n=~~(e/3600),i=~~(e%3600/60),r=e%60,o=t;return n>0&&(o+=n+":"+(i<10?"0":"")),o+=i+":"+(r<10?"0":""),o+=r.toFixed(2)}W.ANIMATION_PLAY_EVENT="animationPlayEvent",W.ANIMATION_PAUSE_EVENT="animationPauseEvent",W.ANIMATION_SEEK_EVENT="animationSeekEvent",W.ANIMATION_PREVIOUS_FRAME_EVENT="animationPreviousFrameEvent",W.ANIMATION_NEXT_FRAME_EVENT="animationNextFrameEvent",W.ANIMATION_TRACK_UPDATE_EVENT="animationTrackUpdateEvent",W.ANIMATION_TOOLBAR_CLOSE_EVENT="animationToolbarCloseEvent",j.prototype=Object.create(r.Extension.prototype),j.prototype.constructor=j,j.prototype.load=function(){var e=this.viewer;return this.onPlayCallbackBinded=this.onPlayCallback.bind(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onExplodeBinded=this.onExplode.bind(this),this.onResizeBinded=this.onResize.bind(this),this.onEscapeBinded=this.onEscape.bind(this),e.addEventListener(m.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),e.addEventListener(m.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),e.addEventListener(m.VIEWER_RESIZE_EVENT,this.onResizeBinded),e.addEventListener(m.ESCAPE_EVENT,this.onEscapeBinded),e.model&&e.model.isObjectTreeCreated()?this.onAnimationReady():(this.onAnimationReadyBinded=this.onAnimationReady.bind(this),e.addEventListener(m.ANIMATION_READY_EVENT,this.onAnimationReadyBinded)),!0},j.prototype.unload=function(){var e=this.viewer;if(this.onAnimationReadyBinded&&(e.removeEventListener(m.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),this.rewind(),e.impl.invalidate(!0,!0,!0),this.onPlayCallbackBinded=null,this.animTools&&(this.animTools.removeControl(this.animTools.timeText.getId()),this.animTools.removeControl(this.animTools.timeline.getId()),this.animTools.removeControl(this.animTools.timeLeftText.getId()),this.animTools.removeControl(this.animTools.forwardButton.getId()),this.animTools.removeControl(this.animTools.backwardButton.getId()),this.animTools.removeControl(this.animTools.closeButton.getId())),this.toolbar&&(this.toolbar.removeControl(this.animTools),this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.playButton){var t=e.getToolbar(!1);t&&t.getControl(g.TOOLBAR.MODELTOOLSID).removeControl(this.playButton.getId())}return e.removeEventListener(m.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),e.removeEventListener(m.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),e.removeEventListener(m.VIEWER_RESIZE_EVENT,this.onResizeBinded),e.removeEventListener(m.ESCAPE_EVENT,this.onEscapeBinded),this.onToolbarCreatedBinded&&(e.removeEventListener(g.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),!0},j.prototype.play=function(){if(!this.isPlaying()){this.resetExplode(0,!0);var e=this.viewer.impl.keyFrameAnimator;e&&(this.prevAnimationTime>0&&(e.goto(this.prevAnimationTime),this.prevAnimationTime=-1),e.play(0,this.onPlayCallbackBinded),this.updatePlayButton(e.isPaused),this.animTools&&(this.animTools.setVisible(!0),this.animTools.isPositionAdjusted||(this.adjustToolbarPosition(),this.animTools.isPositionAdjusted=!0)))}},j.prototype.pause=function(){if(!this.isPaused()){var e=this.viewer.impl.keyFrameAnimator;e&&(e.pause(),this.updatePlayButton(e.isPaused))}},j.prototype.isPlaying=function(){var e=this.viewer.impl.keyFrameAnimator;return!!e&&(e.isPlaying&&!e.isPaused)},j.prototype.isPaused=function(){var e=this.viewer.impl.keyFrameAnimator;return!!e&&e.isPaused},j.prototype.rewind=function(){this.setTimelineValue(0)},j.prototype.setTimelineValue=function(e){var t=this.viewer.impl.keyFrameAnimator;if(t){var n=(e=Math.min(Math.max(0,e),1))*t.duration;t.goto(n),this.updateUI()}},j.prototype.prevKeyframe=function(){var e=this.viewer.impl.keyFrameAnimator;e&&(e.prev(),this.updateUI())},j.prototype.nextKeyframe=function(){var e=this.viewer.impl.keyFrameAnimator;e&&(e.next(),this.updateUI())},j.prototype.getDuration=function(){var e=this.viewer.impl.keyFrameAnimator;return e?e.duration:0},j.prototype.getDurationLabel=function(){return X(this.getDuration())},j.prototype.getCurrentTime=function(){var e=this.viewer.impl.keyFrameAnimator;return e?e.currentTime:0},j.prototype.getCurrentTimeLabel=function(){return X(this.getCurrentTime())},j.prototype.onAnimationReady=function(){var e=this.viewer;this.onAnimationReadyBinded&&(e.removeEventListener(m.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),e.impl.keyFrameAnimator&&(e.toolbar&&e.modelTools?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),e.addEventListener(g.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)))},j.prototype.updateUI=function(){var e=this.viewer.impl.keyFrameAnimator;this.animTools&&e&&(this.animTools.input.value=e.duration>0?e.currentTime/e.duration*100:0,this.animTools.lapse.value=X(e.currentTime),this.animTools.lapseLeft.value=X(e.duration),this.updatePlayButton(e.isPaused),this.updateToolbarBackground())},j.prototype.onPlayCallback=function(e){if(this.animTools){var t=this.viewer.impl.keyFrameAnimator;this.viewer.dispatchEvent({type:"animationTrackUpdateEvent",data:{time:t.currentTime,duration:t.duration}}),this.animTools.input.value=e,this.animTools.lapse.value=X(t.currentTime),this.animTools.lapseLeft.value=X(t.duration),e>=100&&this.updatePlayButton(!0),this.updateToolbarBackground()}},j.prototype.updatePlayButton=function(e){if(this.playButton&&e!==this.playButtonIsPaused){this.playButtonIsPaused=e;var t=this.viewer.impl.keyFrameAnimator;e?(this.playButton.setIcon("toolbar-animation-play-icon"),this.playButton.setToolTip("Play"),this.viewer.dispatchEvent({type:"animationPauseEvent",data:{time:t.currentTime,duration:t.duration}})):(this.playButton.setIcon("toolbar-animation-pause-icon"),this.playButton.setToolTip("Pause"),this.viewer.dispatchEvent({type:"animationPlayEvent",data:{time:t.currentTime,duration:t.duration}}))}},j.prototype.resetExplode=function(e,t){var n=this.viewer;n.model.is2d()||0===n.getExplodeScale()||(t&&n.explodeSlider&&(n.explodeSlider.value=e),n.explode(e))},j.prototype.adjustToolbarPosition=function(){var e=this.viewer;if(e.toolbar){var t=e.toolbar.getDimensions().width;t>e.container.getBoundingClientRect().width&&(t=e.modelTools.getDimensions().width);var n=t-(2*this.animTools.backwardButton.getDimensions().width+3*this.animTools.timeText.getDimensions().width+this.animTools.closeButton.getDimensions().width+20);this.animTools.input.style.width=n+"px"}},j.prototype.hideAnimateToolbar=function(){this.animTools&&this.animTools.setVisible(!1)},j.prototype.updateToolbarBackground=function(){if(this.animTools){var e=this.animTools.input,t=e.value,n="#393939";e.style.background="-webkit-linear-gradient(left,#ffffff "+t+"%, "+n+" "+t+"%)",e.style.background="-moz-linear-gradient(left,#ffffff "+t+"%, "+n+" "+t+"%)",e.style.background="-ms-linear-gradient(left,#ffffff "+t+"%, "+n+" "+t+"%)",e.style.background="-o-linear-gradient(left,#ffffff "+t+"%, "+n+" "+t+"%)",e.style.background="linear-gradient(to right,#ffffff "+t+"%, "+n+" "+t+"%)"}},j.prototype.onCameraChange=function(){if(this.viewer.toolController.cameraUpdated){var e=this.viewer.impl.keyFrameAnimator;if(!e)return;e.isPlaying&&!e.isPaused&&(e.pause(),this.updatePlayButton(e.isPaused))}},j.prototype.onResize=function(){this.toolbar&&(this.viewer.container.clientWidth<(Object(A.isTouchDevice)()?560:600)?this.toolbar.setCollapsed(!0):(this.toolbar.setCollapsed(!1),this.adjustToolbarPosition()))},j.prototype.onEscape=function(){this.isPlaying()?this.pause():this.hideAnimateToolbar()},j.prototype.onExplode=function(){var e=this.viewer.impl.keyFrameAnimator;e&&(0!==e.currentTime&&(this.prevAnimationTime=e.currentTime,e.goto(0)),this.updatePlayButton(!0)),this.hideAnimateToolbar()},j.prototype.onToolbarCreated=function(){var e=this.viewer,t=this;this.onToolbarCreatedBinded&&(e.removeEventListener(g.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.toolbar=new z.ToolBar("animation-toolbar"),this.toolbar.addClass("toolbar-animation-subtoolbar"),e.container.appendChild(this.toolbar.container),this.animTools=new G.ControlGroup(this.animToolsId),this.animTools.setVisible(!1),this.toolbar.addControl(this.animTools),this.playButton=new y.Button("toolbar-animationPlay"),this.playButton.setIcon("toolbar-animation-play-icon"),this.playButton.setToolTip("Play"),this.playButton.onClick=function(){t.isPaused()?t.activate():t.deactivate()},e.modelTools.addControl(this.playButton),e.modelTools.resetModelButton&&(e.modelTools.resetModelButton.onClick=function(r){e.showAll();var a=e.impl.keyFrameAnimator;a&&(a.goto(0),i.value=0,n.value=X(0),o.value=X(a.duration),t.updatePlayButton(!0)),t.resetExplode(0,!0),t.updateToolbarBackground()}),this.animTools.backwardButton=new y.Button("toolbar-animationBackward"),this.animTools.backwardButton.setToolTip("Previous keyframe"),this.animTools.backwardButton.onClick=function(n){var i=e.impl.keyFrameAnimator;void 0!==i&&i&&(i.prev(),e.dispatchEvent({type:"animationPreviousFrameEvent",data:{time:i.currentTime,duration:i.duration}}),t.updateUI())},this.animTools.backwardButton.addClass("toolbar-animation-button"),this.animTools.backwardButton.setIcon("toolbar-animation-backward-icon"),this.animTools.addControl(this.animTools.backwardButton),this.animTools.forwardButton=new y.Button("toolbar-animationForward"),this.animTools.forwardButton.setToolTip("Next keyframe"),this.animTools.forwardButton.onClick=function(n){var i=e.impl.keyFrameAnimator;void 0!==i&&i&&(i.next(),e.dispatchEvent({type:"animationNextFrameEvent",data:{time:i.currentTime,duration:i.duration}}),t.updateUI())},this.animTools.forwardButton.addClass("toolbar-animation-button"),this.animTools.forwardButton.setIcon("toolbar-animation-forward-icon"),this.animTools.addControl(this.animTools.forwardButton),this.animTools.timeText=new H.Control("toolbar-animation-time-lapse");var n=this.animTools.lapse=document.createElement("input");n.type="text",n.value="0",n.className="animation-time-lapse",n.disabled=!0,this.animTools.timeText.container.appendChild(n),this.animTools.timeText.addClass("toolbar-animation-button"),this.animTools.addControl(this.animTools.timeText),this.animTools.timeline=new H.Control("toolbar-animation-timeline");var i=this.animTools.input=document.createElement("input");i.type="range",i.value="0",i.className="animation-timeline",A.isIE11&&(i.style["padding-top"]="0",i.style["padding-bottom"]="0",i.style["margin-top"]="10px"),this.animTools.timeline.container.appendChild(i),i.addEventListener(A.isIE11?"change":"input",function(r){var a=e.impl.keyFrameAnimator;if(void 0!==a&&a){var s=i.value*a.duration/100;n.value=X(s),o.value=X(a.duration),a.goto(s),e.dispatchEvent({type:"animationSeekEvent",data:{time:s,duration:a.duration}}),t.updatePlayButton(a.isPaused),t.updateToolbarBackground()}});var r=document.createElement("div");r.className="adsk-control-tooltip",r.textContent=x.i18n.translate("Click-drag to scrub"),this.animTools.timeline.container.appendChild(r),i.addEventListener("mouseover",function(e){e.target===i&&(r.style.visibility="visible")}),i.addEventListener("mouseout",function(e){e.target===i&&(r.style.visibility="hidden")}),this.animTools.timeline.addClass("toolbar-animation-button"),this.animTools.timeline.addClass("toolbar-animation-timeline"),this.animTools.addControl(this.animTools.timeline),this.animTools.timeLeftText=new H.Control("toolbar-animationRemainingTime");var o=this.animTools.lapseLeft=document.createElement("input");o.type="text",o.value="0",o.className="animation-time-lapse",o.disabled=!0,this.animTools.timeLeftText.container.appendChild(o),this.animTools.timeLeftText.addClass("toolbar-animation-button"),this.animTools.addControl(this.animTools.timeLeftText),this.animTools.closeButton=new y.Button("toolbar-animation-Close"),this.animTools.closeButton.addClass("docking-panel-close"),this.animTools.closeButton.addClass("toolbar-animation-button"),this.animTools.closeButton.addClass("toolbar-animation-close-button"),this.animTools.closeButton.onClick=function(){t.hideAnimateToolbar(),e.dispatchEvent({type:"animationToolbarCloseEvent"})},this.animTools.addControl(this.animTools.closeButton)},j.prototype.activate=function(){return this.play(),!0},j.prototype.deactivate=function(){return this.pause(),!0},j.prototype.isActive=function(){return this.isPlaying()};var q=n(11),Y=n(60),K=['<div class="orbit-gizmo noselect">','<div class="outside"></div>','<div class="ring"></div>','<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="layout-mid">','<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="circle">','<div class="crosshair-area">','<div class="crosshair-v"></div>','<div class="crosshair-h"></div>',"</div>","</div>",'<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>",'<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>"].join("\n");function Q(){var e,t,n,i,r,o=["fusion orbit","fusion orbit constrained"],a=0,s=1,l=2,c=.005,u=.005,h=1,d={},f=Object(A.isTouchDevice)(),p=!1,m={buttons:[],src:void 0,x:0,y:0,dx:0,dy:0,firstMove:!0,mode:void 0},g=this;this.setViewer=function(e){this.viewer=e,this.navapi=e?e.navigation:null};var v=function(e){m.buttons[e.touches?0:e.button]=!0,m.src=e.target.className,m.x=0,m.y=0,m.dx=0,m.dy=0,m.firstMove=!0,m.mode=void 0,"ring"===m.src?m.mode=l:"edgemark-area"===m.src&&("layout-ver"===e.target.parentNode.className?m.mode=a:"layout-hor"===e.target.parentNode.className&&(m.mode=s)),E(),e.stopPropagation()},y=function(e){m.buttons[e.touches?0:e.button]=!1,m.src=void 0},_=function(e){m.buttons[0]&&(b(e),x(),m.firstMove=!1)},b=function(e){var t=e.touches?e.touches[0].pageX:e.pageX,n=e.touches?e.touches[0].pageY:e.pageY;m.firstMove||(m.dx=t-m.x,m.dy=n-m.y),m.x=t,m.y=n},x=function(){switch(m.mode){case l:if(!g.navapi.isActionEnabled("roll"))return;break;case a:case s:if(!g.navapi.isActionEnabled("orbit"))return}var e=r.target.clone().sub(r.position).normalize(),t=e.clone().cross(r.up).normalize(),n=t.clone().cross(e).normalize();if(r.up.copy(n),m.mode===l){var o=new THREE.Vector3(m.x-d.center.x,m.y-d.center.y,0),f=new THREE.Vector3(m.dx,m.dy,0).add(o);o.normalize(),f.normalize();var p=o.clone().cross(f),v=Math.asin(p.z);r.up.applyAxisAngle(e,-v*h)}else{var y,_;m.mode===a?(_=-m.dx*c,i&&(r.up=Y.Navigation.snapToAxis(r.up.clone())),y=r.up):m.mode===s&&(_=-m.dy*u,i?(m.firstMove&&(r.up=Y.Navigation.snapToAxis(r.up.clone())),y=e.clone().cross(r.up).normalize()):y=t,r.up.applyAxisAngle(y,_));var b=g.navapi.getPivotPoint(),x=r.position.clone().sub(b);x.applyAxisAngle(y,_),r.position.addVectors(b,x);var w=r.target.clone().sub(b);w.applyAxisAngle(y,_),r.target.addVectors(b,w)}r.dirty=!0},w=function(e,t){var n=t||e.clone().sub(r.position).normalize();return new THREE.Plane(n,-n.x*e.x-n.y*e.y-n.z*e.z)},E=function(){var e=r.target.clone().sub(r.position).normalize(),t=w(r.position,e).distanceToPoint(r.pivot);r.pivot.copy(e).multiplyScalar(t).add(r.position)},T=function(e){e.touches||0!==e.button||E()},M=function(e){p&&g.viewer.setActiveNavigationTool()},S=function(e,t){var n,i=g.viewer.impl.hitTest(e,t);i&&i.intersectPoint?n=i.intersectPoint:n=g.viewer.impl.viewportToRay(g.viewer.impl.clientToViewport(e,t)).intersectPlane(w(r.target));var o=r.position.clone().sub(function(){var e=r.target.clone().sub(r.position).normalize(),t=g.viewer.impl.rayIntersect(new THREE.Ray(r.position,e));return t&&t.intersectPoint?t.intersectPoint:r.target}()).add(n);g.navapi.setRequestTransition(!0,o,n,r.fov)};this.register=function(){(e=Object(q.stringToDOM)(K)).style.display="none",this.viewer.canvasWrap.insertBefore(e,this.viewer.canvasWrap.firstChild),(t=e.querySelector(".ring")).addEventListener("mousedown",v),Array.prototype.forEach.call(e.querySelectorAll(".edgemark-area"),function(e,t){e.addEventListener("mousedown",v),f&&e.addEventListener("touchstart",v)}),window.addEventListener("mouseup",y),window.addEventListener("mousemove",_),(n=e.querySelector(".outside")).addEventListener("mousedown",M);var i=e.querySelector(".circle");i.addEventListener("mousedown",T),f&&(t.addEventListener("touchstart",v),window.addEventListener("touchend",y),window.addEventListener("touchmove",_),n.addEventListener("touchstart",M),i.addEventListener("touchstart",T)),r=this.viewer.impl.camera},this.deregister=function(){window.removeEventListener("mouseup",y),window.removeEventListener("mousemove",_),n.removeEventListener("mousedown",M),f&&(window.removeEventListener("touchend",y),window.removeEventListener("touchmove",_),n.removeEventListener("touchstart",M)),this.viewer.canvasWrap.removeChild(e),e=void 0,t=void 0,n=void 0},this.activate=function(t){e.style.display="",this.handleResize(),i="fusion orbit constrained"===t;var n=this.viewer.toolController.isToolActivated("hyperlink");n&&this.viewer.toolController.deactivateTool("hyperlink"),i?(this.viewer.setDefaultNavigationTool("orbit"),this.viewer.prefs.set("fusionOrbitConstrained",!0)):(this.viewer.setDefaultNavigationTool("freeorbit"),this.viewer.prefs.set("fusionOrbitConstrained",!1)),n&&this.viewer.toolController.activateTool("hyperlink"),this.viewer.navigation.setZoomTowardsPivot(!0)},this.deactivate=function(t){e.style.display="none",this.viewer.navigation.setZoomTowardsPivot(this.viewer.prefs.zoomTowardsPivot)},this.getNames=function(){return o},this.getName=function(){return o[0]},this.update=function(){return!1},this.handleSingleClick=function(e,t){return S(e.canvasX,e.canvasY),!0},this.handleDoubleClick=function(e,t){return!0},this.handleSingleTap=function(e){return S(e.canvasX,e.canvasY),!0},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){var t=this.viewer.impl.getCanvasBoundingClientRect(),i=(t.width>t.height?new THREE.Vector2(((e.canvasX+.5)/t.width*2-1)*t.width/t.height,-(e.canvasY+.5)/t.height*2+1):new THREE.Vector2((e.canvasX+.5)/t.width*2-1,(-(e.canvasY+.5)/t.height*2+1)*t.height/t.width)).length()>1.2;return p!==i&&(n.style.cursor=i?"":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto",p=i),!1},this.handleGesture=function(e){return E(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){var n=e.getBoundingClientRect();d.left=n.left+window.pageXOffset,d.top=n.top+window.pageYOffset,d.width=n.width,d.height=n.height,d.center={},d.center.x=d.left+d.width/2,d.center.y=d.top+d.height/2;var i=.8*(window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth);e.style.width=e.style.height=i+"px",e.style.top=e.style.left="calc(50% - "+i/2+"px)",t.style.borderWidth=.1*i+"px"}}n(312);function Z(e,t){r.Extension.call(this,e,t),this.name="fusionorbit",this.modes=["fusionorbit","fusionfreeorbit"]}Z.prototype=Object.create(r.Extension.prototype),Z.prototype.constructor=Z;var J=Z.prototype;J.load=function(){var e=this,t=this.viewer,n=t.getToolbar?t.getToolbar(!0):void 0;function i(){t.removeEventListener(g.TOOLBAR_CREATED_EVENT,i),e.createUI()}if(this.tool=new Q,this.tool.setViewer(t),t.toolController.registerTool(this.tool),n){var r=n.getControl(g.TOOLBAR.NAVTOOLSID);r&&r.getNumberOfControls()>0?i():t.addEventListener(g.TOOLBAR_CREATED_EVENT,i)}else t.addEventListener(g.TOOLBAR_CREATED_EVENT,i);return!0},J.createUI=function(){var e=this,t=this.viewer,n=t.getToolbar(!1).getControl(g.TOOLBAR.NAVTOOLSID);this.classicBehavior={},this.classicBehavior.orbitOnClick=n.orbitbutton.onClick,this.classicBehavior.freeorbitOnClick=n.freeorbitbutton.onClick,this.classicBehavior.returnToDefault=n.returnToDefault,n.freeorbitbutton.onClick=function(t){var i=n.freeorbitbutton.getState();i===y.Button.State.INACTIVE?(e.activate("fusionfreeorbit"),n.freeorbitbutton.setState(y.Button.State.ACTIVE)):i===y.Button.State.ACTIVE&&(e.deactivate(),n.freeorbitbutton.setState(y.Button.State.INACTIVE))},n.orbitbutton.onClick=function(t){var i=n.orbitbutton.getState();i===y.Button.State.INACTIVE?(e.activate("fusionorbit"),n.orbitbutton.setState(y.Button.State.ACTIVE)):i===y.Button.State.ACTIVE&&e.deactivate()},n.returnToDefault=function(){n.orbittoolsbutton&&n.orbittoolsbutton.setState(y.Button.State.ACTIVE)},n.orbittoolsbutton.setState(y.Button.State.INACTIVE),t.prefs.fusionOrbitConstrained?(n.orbittoolsbutton.onClick=n.orbitbutton.onClick,n.orbittoolsbutton.setIcon(n.orbitbutton.iconClass),t.setDefaultNavigationTool("orbit")):(n.orbittoolsbutton.onClick=n.freeorbitbutton.onClick,n.orbittoolsbutton.setIcon(n.freeorbitbutton.iconClass),t.setDefaultNavigationTool("freeorbit")),t.setActiveNavigationTool(),n.returnToDefault&&n.returnToDefault()},J.unload=function(){var e=this.viewer,t=e.getToolbar(!1).getControl(g.TOOLBAR.NAVTOOLSID);return t&&(t.orbitbutton&&(t.orbitbutton.onClick=this.classicBehavior.orbitOnClick),t.freeorbitbutton&&(t.freeorbitbutton.onClick=this.classicBehavior.freeorbitOnClick),t.returnToDefault=this.classicBehavior.returnToDefault,t.orbittoolsbutton&&(t.orbitbutton?t.orbittoolsbutton.onClick=t.orbitbutton.onClick:t.orbittoolsbutton.onClick=null,t.orbittoolsbutton.setIcon("adsk-icon-orbit-constrained"),t.orbittoolsbutton.setState(y.Button.State.ACTIVE))),e.setActiveNavigationTool("orbit"),e.setDefaultNavigationTool("orbit"),e.toolController.deregisterTool(this.tool),this.tool.setViewer(null),this.tool=null,!0},J.activate=function(e){if(!this.activeStatus||this.mode!==e){switch(e){default:case"fusionorbit":this.viewer.setActiveNavigationTool("fusion orbit constrained"),this.mode="fusionorbit";break;case"fusionfreeorbit":this.viewer.setActiveNavigationTool("fusion orbit"),this.mode="fusionfreeorbit"}return this.activeStatus=!0,!0}},J.deactivate=function(){return this.activeStatus&&(this.viewer.setActiveNavigationTool(),this.activeStatus=!1),!0},i.theExtensionManager.registerExtension("Autodesk.PropertiesManager",o),i.theExtensionManager.registerExtension("Autodesk.ViewerSettings",l),i.theExtensionManager.registerExtension("Autodesk.LayerManager",h),i.theExtensionManager.registerExtension("Autodesk.ModelStructure",f),i.theExtensionManager.registerExtension("Autodesk.DefaultTools.NavTools",D),i.theExtensionManager.registerExtension("Autodesk.Explode",N),i.theExtensionManager.registerExtension("Autodesk.FullScreen",V),i.theExtensionManager.registerExtension("Autodesk.GoHome",B),i.theExtensionManager.registerExtension("Autodesk.Fusion360.Animation",j),i.theExtensionManager.registerExtension("Autodesk.Viewing.FusionOrbit",Z)},function(e,t,n){"use strict";n.r(t);var i=n(17),r=n(37),o=n(10),a=n(1),s=n(33),l=n(76),c=n(5),u=n(58),h=n(24),d=n(4),f=n(12);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e){switch(e){case"meter":case"meters":case"m":return 1;case"feet and inches":case"foot":case"feet":case"ft":return.3048;case"inch":case"inches":case"in":return.0254;case"centimeter":case"centimeters":case"cm":return.01;case"millimeter":case"millimeters":case"mm":return.001;default:return 1}}function g(e,t){if(e.metadata){var n=e.metadata["world bounding box"],a=new o.LmvVector3(n.minXYZ[0],n.minXYZ[1],n.minXYZ[2]),s=new o.LmvVector3(n.maxXYZ[0],n.maxXYZ[1],n.maxXYZ[2]);e.bbox=new r.LmvBox3(a,s),e.globalOffset=t.globalOffset||{x:.5*(a.x+s.x),y:.5*(a.y+s.y),z:.5*(a.z+s.z)};var l=function(e,t){if(e.placementTransform=t.placementTransform,t.applyScaling){var n="m";e.metadata["distance units"]&&(n=e.metadata["distance units"].value),e.scalingUnit=n,"object"===p(t.applyScaling)?(t.applyScaling.from&&(n=t.applyScaling.from),t.applyScaling.to&&(e.scalingUnit=t.applyScaling.to)):e.scalingUnit=t.applyScaling;var r=m(n)/m(e.scalingUnit);if(1!=r){var o=new i.LmvMatrix4(!0),a=new i.LmvMatrix4(!0);a.elements[0]=r,a.elements[5]=r,a.elements[10]=r,t.placementTransform&&o.copy(t.placementTransform),e.placementTransform=t.placementTransform=o.multiply(a)}}var s=e.metadata["custom values"];if(s&&s.refPointTransform){e.refPointTransform=new i.LmvMatrix4(!0);var l=e.refPointTransform.elements,c=s.refPointTransform;l[0]=c[0],l[1]=c[1],l[2]=c[2],l[4]=c[3],l[5]=c[4],l[6]=c[5],l[8]=c[6],l[9]=c[7],l[10]=c[8],l[12]=c[9],l[13]=c[10],l[14]=c[11]}else{var u=e.metadata.georeference,h=u&&u.refPointLMV,d=0;if(s&&s.hasOwnProperty("angleToTrueNorth")&&(d=Math.PI/180*s.angleToTrueNorth),h||d){var f=new i.LmvMatrix4(!0),g=f.elements;g[0]=g[5]=Math.cos(d),g[1]=-Math.sin(d),g[4]=Math.sin(d);var v=new i.LmvMatrix4(!0);g=v.elements,h&&(g[12]=-h[0],g[13]=-h[1],g[14]=-h[2]),e.refPointTransform=f.multiply(v)}}if(t.applyRefPoint&&e.refPointTransform){var y=new i.LmvMatrix4(!0);t.placementTransform&&y.copy(t.placementTransform),y.multiply(e.refPointTransform),e.placementTransform=t.placementTransform=y}else!t.applyRefPoint&&t.placementTransform&&(e.placementTransform=new i.LmvMatrix4(!0).copy(t.placementTransform));return e.placementTransform&&function(e){for(var t=e.elements,n=0;n<4;n++)for(var i=0;i<4;i++)if(n===i){if(1!==t[4*n+i])return!1}else if(0!==t[4*n+i])return!1;return!0}(e.placementTransform)&&(e.placementTransform=null),e.placementTransform}(e,t),c=e.globalOffset;if(c.x||c.y||c.z){if(l){var u=new i.LmvMatrix4(!0);u.copy(l),(l=u).elements[12]-=c.x,l.elements[13]-=c.y,l.elements[14]-=c.z}else(l=new i.LmvMatrix4(!0)).makeTranslation(-c.x,-c.y,-c.z);e.placementWithOffset=l}else e.placementWithOffset=l;l&&!e.bbox.empty()&&e.bbox.applyMatrix4(l),e.metadata.hasOwnProperty("double sided geometry")&&e.metadata["double sided geometry"].value&&(e.doubleSided=!0)}}function v(e,t){e[0]-=t.x,e[1]-=t.y,e[2]-=t.z}var y=n(42),_=n(3);function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var x=n(107),w="otg-content",A="otg-lru",E=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.db=null,this.readTransaction=null,this.loaded=!1,this.storeName=w,this.storeNameTimestamp=A,this.bothStoreNames=[this.storeName,this.storeNameTimestamp],this.useCompression=!0,this.pendingTimestampUpdates={},this.pendingTimestampCount=0,this.pendingStores=[]}var t,n,i;return t=e,(n=[{key:"open",value:function(e,t){var n=this;if(t||Object(_.isSafari)()||Object(_.isMobileDevice)()||Object(_.isNodeJS)()||"undefined"==typeof indexedDB)return Object(_.isNodeJS)()||console.log("IndexedDb disabled"),void(e&&e());var i=indexedDB.open("otg",1);i.onerror=function(t){console.error("Failed to open or create cache database."),e&&e(t)},i.onsuccess=function(t){n.db=t.target.result,n.db.onerror=function(e){console.error("Database error",e)},n.loaded=!0,e&&e(null,n.db)},i.onupgradeneeded=function(e){console.log("Db upgrade",n.storeName);var t=e.target.result;t.createObjectStore(w),t.createObjectStore(A).createIndex(A+"-index","t",{unique:!1})}}},{key:"deleteOld",value:function(e){var t=this;if(this.db){if(!this.deleteInProgress){this.deleteInProgress=!0;var n=IDBKeyRange.upperBound(Date.now()-3e5,!0),i=[];this.db.transaction([this.storeNameTimestamp]).objectStore(this.storeNameTimestamp).index(this.storeNameTimestamp+"-index").openCursor(n).onsuccess=function(n){var r=n.target.result;if(r&&i.length<200)return i.push(r.primaryKey),void r.continue();if(i.length){console.log("Deleting old objects.",i.length);var o=t.db.transaction(t.bothStoreNames,"readwrite");o.oncomplete=function(n){t.deleteInProgress=!1,console.log("Delete done"),e&&e()},o.onerror=function(e){t.deleteInProgress=!1,console.error("Transaction error.",e)},o.onabort=function(e){t.deleteInProgress=!1;var n=e.target.error;console.log("Failed to delete cached objects",n)};for(var a=o.objectStore(t.storeName),s=o.objectStore(t.storeNameTimestamp),l=0;l<i.length;l++)a.delete(i[l]),s.delete(i[l])}}}}else e()}},{key:"flush",value:function(e){var t=this;if(this.pendingStores.length){if(!this.writeTransaction){var n=this.db.transaction(this.bothStoreNames,"readwrite");e&&(n.oncomplete=function(t){e()}),n.onerror=function(t){console.error("Transaction error.",t),e&&e(t.target.error)},n.onabort=function(n){"QuotaExceededError"===n.target.error.name&&t.deleteOld(function(){}),e&&e(n.target.error)},this.writeTransaction=n}for(var i=0;i<this.pendingStores.length;i+=2){var r=this.pendingStores[i],o=this.pendingStores[i+1];if(o instanceof Uint8Array&&this.useCompression)if(31===o[0]&&139===o[1]);else try{o=x.gzip(o)}catch(e){console.error("Compression failed.")}this.writeTransaction.objectStore(this.storeName).put(o,r).onerror=function(e){console.error("Object store error.",e)},this.writeTransaction.objectStore(this.storeNameTimestamp).put({t:Date.now()},r)}this.pendingStores=[],this.writeTransaction=null}else e&&e()}},{key:"store",value:function(e,t,n){this.db?(this.pendingStores.push(e),this.pendingStores.push(t),this.pendingStores.length<200?n&&n():this.flush(n)):n&&n()}},{key:"flushTimestamps",value:function(e){var t=this,n=this.db.transaction([this.storeNameTimestamp],"readwrite");e&&(n.oncomplete=function(t){e()}),n.onerror=function(t){console.error("Transaction error.",t),e&&e(t.target.error)},n.onabort=function(n){"QuotaExceededError"===n.target.error.name&&(console.log("Quota exceeded"),t.deleteOld(function(){})),e&&e(n.target.error)};var i=n.objectStore(this.storeNameTimestamp);for(var r in this.pendingTimestampUpdates)i.put({t:this.pendingTimestampUpdates[r]},r);this.pendingTimestampUpdates={},this.pendingTimestampCount=0}},{key:"_createReadTransaction",value:function(){var e=this,t=this.readTransaction=this.db.transaction(this.storeName);t.oncomplete=function(t){e.readTransaction=null},t.onerror=function(t){console.error("Transaction error.",comment,t),e.readTransaction=null},t.onabort=function(t){console.warn("Transaction abort",comment,t),e.readTransaction=null}}},{key:"get",value:function(e,t){var n=this;if(this.db){var i;this.readTransaction||this._createReadTransaction();try{i=this.readTransaction.objectStore(this.storeName).get(e)}catch(t){this._createReadTransaction(),i=this.readTransaction.objectStore(this.storeName).get(e)}i.onsuccess=function(i){if(i.target.result){var r=i.target.result;if(31===r[0]&&139===r[1])try{r=x.ungzip(r)}catch(e){return console.error("Failed to decompress.",e),void t(e,null)}t(null,r),n.pendingTimestampUpdates[e]=Date.now(),n.pendingTimestampCount++}else t(-1,null)},i.onerror=function(e){t(e.target.errorCode)}}else t(-1,null)}},{key:"updatePendingTimestamps",value:function(){var e=this;this.db&&this.flush(function(t){t||e.flushTimestamps()})}},{key:"size",value:function(e){if(this.db){var t=0,n=0,i=this.db.transaction([this.storeName]).objectStore(this.storeName).openCursor();i.onsuccess=function(i){var r=i.target.result;if(r){var o=r.value;t+=o.length,n++,r.continue()}else e(null,{size:t,items:n})},i.onerror=function(t){e(t)}}else e()}}])&&b(t.prototype,n),i&&b(t,i),e}(),T=n(81);function M(e,t){var n,i,r,o,s,l=0;function c(e){var l=new Uint8Array(4);if("string"==typeof e)for(var c=0;c<4;c++)l[c]=e.charCodeAt(c);else for(var u=0;u<4;u++)l[u]=e[u];(n=l[1]<<8|l[0])||(n=t||0),n||a.logger.error("Unknwon byte stride."),n%4&&a.logger.error("Expected byte size to be multiple of 4, but got "+n),i=l[3]<<8|l[2],n/4,r=new Uint8Array(n),o=new Float32Array(r.buffer),s=new Uint32Array(r.buffer)}this.onData=function(t,i,o){void 0===i&&(i=t.length);for(var a="string"==typeof t;;){if(!l&&i>=4)c(t),l++;else if(i<4)return!1;var s=l*n;if(i<s+n)return o;if(a)for(var u=0;u<n;u++)r[u]=255&t.charCodeAt(u+s);else for(var h=0;h<n;h++)r[h]=t[h+s];if(!e(this,l))return!1;l++}},this.onEnd=function(e,t){this.onData(e,t,!0)||(this.rawData=e,this.rawLength=t)},this.flush=function(){this.rawData&&(this.onData(this.rawData,this.rawLength,!0)&&(this.rawData=null))},this.idata=function(){return s},this.fdata=function(){return o},this.bdata=function(){return r},this.version=function(){return i},this.byteStride=function(){return n}}var S="urn:adsk.fluent:fs.file:";function C(){this.materials=null,this.fragments=null,this.geompacks=[],this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[]},this.bbox=null,this.animations=null,this.pendingRequests=0,this.globalOffset={x:0,y:0,z:0},this.pendingRequests=0,this.initialLoadProgress=0,this.materialIdToHash=[],this.aborted=!1,this.materialCache=new E,this.materialCache.open()}C.prototype.getMaterialHash=function(e){var t=this.materialIdToHash[e];if(t)return t;var n=this.materialHashes.byteStride,i=Object(y.b)(this.materialHashes.hashes,e*n,n);return this.materialIdToHash[e]=i,i},C.prototype.getGeometryHash=function(e){var t=this.geomMetadata.byteStride;return Object(y.b)(this.geomMetadata.hashes,e*t,t)},C.prototype.initEmptyLists=function(e){var t=this.fragments={};t.length=this.metadata.stats.num_fragments,t.numLoaded=0,t.boxes=e.fragmentTransformsDouble?new Float64Array(6*t.length):new Float32Array(6*t.length),t.transforms=e.fragmentTransformsDouble?new Float64Array(12*t.length):new Float32Array(12*t.length),t.materials=Object(T.a)(t.length,this.metadata.stats.num_materials),t.geomDataIndexes=Object(T.a)(t.length,this.metadata.stats.num_geoms),t.fragId2dbId=new Int32Array(t.length),t.visibilityFlags=new Uint8Array(t.length),t.mesh2frag={},t.topoIndexes=null,this.geomMetadata={hashes:null,byteStride:0,version:0,numLoaded:0,hashToIndex:{}},this.materialHashes={hashes:null,byteStride:0,version:0,numLoaded:0},this.materials={name:"LMVTK Simple Materials",version:"1.0",scene:{SceneUnit:8215,YIsUp:0},materials:{}}},C.prototype.loadAsyncResource=function(e,t,n,i){var r=this;this.pendingRequests++,t=Object(f.pathToURL)(t,e.basePath),f.ViewingService.getItem(e,t,function(e){r.pendingRequests--,i(e)},e.onFailureCallback,{responseType:n||"arraybuffer"})},C.prototype.loadAsyncProgressive=function(e,t,n,i,r){var o=this;t=Object(f.pathToURL)(t,e.basePath),f.ViewingService.getItem(e,t,function(t,r){n.onEnd(t,r),o.postLoad(e,i,n,t)},r||e.onFailureCallback,{responseType:"text",onprogress:function(e,t){if(o.aborted)return!0;n.onData(e,t,!1)}})},C.prototype.loadMetadata=function(e,t){var n=this;this.loadAsyncResource(e,t,"json",function(r){n.metadata=r,n.manifest=n.metadata.manifest,n.processMetadata(e),n.initEmptyLists(e);var o=n.metadata.manifest,a=o.shared_assets.pdb;for(var s in a)n.propertydb[s]&&n.propertydb[s].push(a[s]);var l=o.assets.pdb;for(var s in l)n.propertydb[s]&&n.propertydb[s].push(l[s]);o.assets.animations&&n.loadAsyncResource(e,o.assets.animations,"json",function(e){n.animations=e,function(e){if(e.animations){var t=e.animations.animations;if(t)for(var n=e.globalOffset,r=(new i.LmvMatrix4).makeTranslation(n.x,n.y,n.z),o=(new i.LmvMatrix4).makeTranslation(-n.x,-n.y,-n.z),a=new i.LmvMatrix4,s=new i.LmvMatrix4,l=0;l<t.length;l++){var c=t[l];if(c.hierarchy)for(var u=0;u<c.hierarchy.length;u++){var h=c.hierarchy[u].keys;if(h)for(var d=0;d<h.length;d++){var f=h[d].pos;if(f){var p=n,m=h[d].rot;m&&(a.makeRotationFromQuaternion({x:m[0],y:m[1],z:m[2],w:m[3]}),s.multiplyMatrices(r,a).multiply(o),p={x:s.elements[12],y:s.elements[13],z:s.elements[14]}),v(f,p)}var g=h[d].target;g&&v(g,n);var y=h[d].points;if(y)for(var _=0;_<y.length;_++)v(y[_],n)}}}}}(n)}),o.assets.topology&&n.loadAsyncResource(e,t,"json",function(e){n.topology=e}),e.onLoaderEvent("otg_root"),n.postLoad(e,"metadata")})},C.prototype.loadFragmentList=function(e,t){var n=this,a=new o.LmvVector3,s=new o.LmvVector3,l={x:0,y:0,z:0,w:1},u=new i.LmvMatrix4(!0),h=new r.LmvBox3,d={x:0,y:0,z:0};var f=new M(function(t,i){if(i-=1,!n.metadata)return!1;var r=t.idata(),o=t.fdata(),f=n.fragments,p=f.geomDataIndexes[i]=r[0],m=f.materials[i]=r[1],g=f.fragId2dbId[i]=r[2],v=r[3];if(p>n.geomMetadata.numLoaded||m>n.materialHashes.numLoaded)return!1;var y=f.mesh2frag[p];void 0===y?f.mesh2frag[p]=i:Array.isArray(y)?y.push(i):f.mesh2frag[p]=[y,i];var _=n.dbIdFilter&&!n.dbIdFilter[g]||1&v?c.MeshFlags.MESH_NOTLOADED:0;f.visibilityFlags[i]=_;var b=n.metadata.fragmentTransformsOffset||d;a.set(o[4]+b.x,o[5]+b.y,o[6]+b.z),l.x=o[7],l.y=o[8],l.z=o[9],l.w=o[10],s.set(o[11],o[12],o[13]),u.compose(a,l,s),n.placementWithOffset&&u.multiplyMatrices(n.placementWithOffset,u);var x=u.elements,w=f.transforms,A=12*i;return w[A+0]=x[0],w[A+1]=x[1],w[A+2]=x[2],w[A+3]=x[4],w[A+4]=x[5],w[A+5]=x[6],w[A+6]=x[8],w[A+7]=x[9],w[A+8]=x[10],w[A+9]=x[12],w[A+10]=x[13],w[A+11]=x[14],h.min.x=-.5,h.min.y=-.5,h.min.z=-.5,h.max.x=.5,h.max.y=.5,h.max.z=.5,h.applyMatrix4(u),(w=f.boxes)[0+(A=6*i)]=h.min.x,w[A+1]=h.min.y,w[A+2]=h.min.z,w[A+3]=h.max.x,w[A+4]=h.max.y,w[A+5]=h.max.z,f.numLoaded=i+1,e.onLoaderEvent("fragment",i),!0},52);return this.loadAsyncProgressive(e,t,f,"all_fragments"),f},C.prototype.handleHashListRequestFailures=function(e){this.metadata&&(this.geomHashListFailure&&this.metadata.stats.num_geoms>0&&e.onFailureCallback.apply(e,this.geomHashListFailure),this.matHashListFailure&&this.metadata.stats.num_materials>0&&e.onFailureCallback.apply(e,this.matHashListFailure),this.geomHashListFailure=null,this.matHashListFailure=null)},C.prototype.loadGeometryHashList=function(e,t){var n=this;var i=new M(function(e,t){return!!n.metadata&&(n.geomMetadata.hashes||(n.numGeoms=n.metadata.stats.num_geoms,n.geomMetadata.hashes=new Uint8Array(e.byteStride()*(n.numGeoms+1)),n.geomMetadata.byteStride=e.byteStride(),n.geomMetadata.version=e.version()),n.geomMetadata.hashes.set(e.bdata(),t*e.byteStride()),n.geomMetadata.numLoaded=t,!0)},20);return this.loadAsyncProgressive(e,t,i,"geometry_ptrs",function(){n.geomHashListFailure=arguments,n.handleHashListRequestFailures(e),n.postLoad(e,"geometry_ptrs",i)}),i},C.prototype.loadMaterialHashList=function(e,t){var n=this;var i=new M(function(e,t){return!!n.metadata&&(n.materialHashes.hashes||(n.numMaterials=n.metadata.stats.num_materials,n.materialHashes.hashes=new Uint8Array(e.byteStride()*(n.numMaterials+1)),n.materialHashes.byteStride=e.byteStride(),n.materialHashes.version=e.version()),n.materialHashes.hashes.set(e.bdata(),t*e.byteStride()),n.materialHashes.numLoaded=t,!0)},20);return this.loadAsyncProgressive(e,t,i,"material_ptrs",function(){n.matHashListFailure=arguments,n.handleHashListRequestFailures(e),n.postLoad(e,"material_ptrs",i)}),i},C.prototype.processMetadata=function(e){var t=this.metadata;g(this,e);var n=this.placementWithOffset;if(t.cameras&&(this.cameras=t.cameras,n))for(var i=0;i<this.cameras.length;i++){var r=this.cameras[i];r.position=new o.LmvVector3(r.position.x,r.position.y,r.position.z),r.position.applyMatrix4(n),r.target=new o.LmvVector3(r.target.x,r.target.y,r.target.z),r.target.applyMatrix4(n),r.up=new o.LmvVector3(r.up.x,r.up.y,r.up.z),r.up.transformDirection(n)}},C.prototype.beginLoad=function(e,t){this.loadMetadata(e,t);var n=e.objectIds;if(n){this.dbIdFilter={};for(var i=0,r=n.length;i<r;i++)this.dbIdFilter[n[i]]=1}this.materialsCtx=this.loadMaterialHashList(e,"materials_ptrs.hl"),this.geometryCtx=this.loadGeometryHashList(e,"geometry_ptrs.hl"),this.fragmentsCtx=this.loadFragmentList(e,"fragments.fl")},C.prototype.makeSharedResourcePath=function(e,t,n){if(10===n.length&&(n=Object(y.c)(n)),e){var i=n,r="";(s=this.manifest.shared_assets.global_sharding||0)&&(r="/"+n.slice(0,s),i=n.slice(s));var o=this.manifest.shared_assets[t];if(0!==o.indexOf(S)){var a=o.split("/");o="/"+(a[a.length-1]||a[a.length-2])+"/"}else o=o.slice(o.indexOf("/"));return e+r+o+i}var s;i=n,r="";return(s=this.manifest.shared_assets.global_sharding||2)&&(r="/"+n.slice(0,s)+"/",i=n.slice(s)),Object(f.pathToURL)(this.basePath)+this.manifest.shared_assets[t]+r+i},C.prototype.getFromLocalDb=function(e,t,n){if(this.materialCache)return this.materialCache.get(t,n);var i=this.materialCache=new E;this.materialCache.open(function(){i.get(t,n)},e.disableIndexedDb)},C.prototype.loadMaterial=function(e,t,n,i){var r=this,o=this;this.getFromLocalDb(e,t,function(s,l){if(l)l instanceof Uint8Array?l=Object(y.a)(l):"string"==typeof l&&(l=JSON.parse(l)),n(l);else{var c;0!==(c=r.makeSharedResourcePath(e.otg_cdn,"materials",t)).indexOf("https://")&&0!==c.indexOf("http://")&&0!==c.indexOf("file://")&&(c=e.basePath+c);var u=e.otg_cdn_with_credentials;f.ViewingService.getItem(e.otg_cdn&&!u?{}:e,c,function(e){o.materialCache.store(t,e),e=Object(y.a)(e),n(e)},function(e){a.logger.error("Failed to load material "+t),a.logger.error(JSON.stringify(e)),i&&i(t,e)},{responseType:"arraybuffer",withCredentials:u})}})},C.prototype.postLoad=function(e,t,n,i){t&&this.initialLoadProgress++,4===this.initialLoadProgress?(this.materialsCtx.flush(),this.geometryCtx.flush(),this.fragmentsCtx.flush(),this.materialsCtx=null,this.geometryCtx=null,this.fragmentsCtx=null,this.fragments.numLoaded<this.metadata.stats.num_fragments&&a.logger.warn("Fragments actually loaded fewer than expected."),e.onLoaderEvent("all_fragments")):"metadata"===t&&(this.materialsCtx.flush(),this.geometryCtx.flush(),this.fragmentsCtx.flush())},C.prototype.abort=function(){this.aborted=!0};var P=n(47),L=n(52),R=n(2),D=n(34),I=n(66);n.d(t,"OtgLoader",function(){return O});function O(e){this.viewer3DImpl=e,this.loading=!1,this.tmpMatrix=new i.LmvMatrix4,this.tmpBox=new r.LmvBox3,this.logger=a.logger,this.loadTime=0,this.pendingMaterials={},this.pendingMaterialsCount=0,this.pendingMeshes={},this.pendingMeshesCount=0,this.operationsDone=0}function N(e){return Math.floor(100*e.fragsLoaded/e.metadata.stats.num_fragments)}O.prototype.dtor=function(){this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,a.logger.debug("SVF loader dtor: on init worker script.")),this.bvhWorker&&(this.bvhWorker.clearAllEventListenerWithIntercept(),this.bvhWorker.terminate(),this.bvhWorker=null,a.logger.debug("SVF loader dtor: on svf worker.")),this.svf&&(this.svf.loadDone||console.log("stopping load before it was complete"),this.svf.abort(),this.svf.propWorker&&(this.svf.propWorker.dtor(),this.svf.propWorker=null)),this.viewer3DImpl.geomCache()&&this.model&&(this.loading&&this.viewer3DImpl.geomCache().cancelRequests(this.svf.geomMetadata.hashToIndex),this.removeMeshReceiveListener()),this.viewer3DImpl=null,this.model=null,this.svf=null,this.logger=null,this.tmpMatrix=null,this.loading=!1,this.loadTime=0},O.prototype.isValid=function(){return null!=this.viewer3DImpl},O.prototype.removeMeshReceiveListener=function(){this.meshReceiveListener&&(this.viewer3DImpl.geomCache().updateMruTimestamps(),this.viewer3DImpl.geomCache().removeEventListener(I.MESH_RECEIVE_EVENT,this.meshReceiveListener),this.viewer3DImpl.geomCache().removeEventListener(I.MESH_FAILED_EVENT,this.meshReceiveListener),this.meshReceiveListener=null)},O.prototype.loadFile=function(e,t,n,i){if(!this.viewer3DImpl)return a.logger.log("SVF loader was already destructed. So no longer usable."),!1;if(this.loading)return a.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;if(this.loading=!0,this.viewer3DImpl._addLoadingFile(this),t.acmSessionId)this.svfUrn=t.acmSessionId.split(",")[0];else{var r=e.indexOf(S);if(-1!==r){var o=e.slice(r+S.length).split("/"),s=o[1],l=o[2],c=btoa(s+"?version="+l).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");this.svfUrn=c}}this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e;var u="",h=this.currentLoadPath.lastIndexOf("/");-1!=h&&(u=this.currentLoadPath.substr(0,h+1)),this.basePath=u,this.acmSessionId=t.acmSessionId,this.options=t;var p={basePath:u,objectIds:t.ids,globalOffset:t.globalOffset,fragmentTransformsDouble:t.fragmentTransformsDouble,placementTransform:t.placementTransform,applyRefPoint:t.applyRefPoint,queryParams:t.acmSessionId?"acmsession="+t.acmSessionId:"",bvhOptions:t.bvhOptions||{isWeakDevice:Object(_.isMobileDevice)()},applyScaling:t.applyScaling,loadInstanceTree:t.loadInstanceTree};return this.loadContext=Object(d.initLoadContext)(p),p.raiseError=function(e,t,i){n&&n({code:e,msg:t,args:i})},p.onFailureCallback=f.ViewingService.defaultFailureCallback.bind(p),this.loadModelRoot(p,n),i&&i(),!0},O.prototype.loadModelRoot=function(e,t){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null;var n=this,i=this.svf=new C;return i.basePath=e.basePath,e.onLoaderEvent=function(e,r){if(n.svf){if("otg_root"===e){n.onModelRootLoadDone(i),t&&t(null,n.model),n.makeBVHInWorker();var o=n.viewer3DImpl.geomCache();o||a.logger.error("geomCache is required for loading OTG models."),o.initWorker(n.options.acmSessionId),n.meshReceiveListener=function(e){e.error&&e.error.args?n.onMeshError(e):n.onMeshReceived(e.geom)},o.addEventListener(I.MESH_RECEIVE_EVENT,n.meshReceiveListener),o.addEventListener(I.MESH_FAILED_EVENT,n.meshReceiveListener),n.svf.loadDone=!1}else if("fragment"===e)n.options.skipMeshLoad||n.tryToActivateFragment(r,"fragment"),n.options.onFragmentListLoadProgress&&n.trackFragmentListLoadProgress();else if("all_fragments"===e)n.options.skipPropertyDb||n.loadPropertyDb(),n.viewer3DImpl.api.fireEvent({type:R.MODEL_ROOT_LOADED_EVENT,svf:i,model:n.model}),n.options.skipMeshLoad||!n.svf.fragments.length?n.onGeomLoadDone():n.onOperationComplete();else if("bvh"===e){var s=r;n.model&&(n.model.setBVH(s.nodes,s.primitives,n.options.bvhOptions),n.viewer3DImpl&&n.viewer3DImpl.modelVisible(n.model.id)&&n.viewer3DImpl.invalidate(!1,!0)),n.onOperationComplete()}}else console.error("load callback called after load was aborted")},i.beginLoad(e,Object(f.pathToURL)(this.currentLoadPath)),!0},O.prototype.makeBVHInWorker=function(){var e=this;this.initWorkerScriptToken=Object(h.initWorkerScript)(function(){e.bvhWorker=Object(h.createWorkerWithIntercept)();e.bvhWorker.addEventListenerWithIntercept(function(t){if(t.data.bvh){console.log("Received BVH from worker");var n=t.data.bvh;e.model&&(e.svf.bvh=n,e.model.setBVH(new l.NodeArray(n.nodes,n.useLeanNodes),n.primitives,e.options.bvhOptions),e.viewer3DImpl&&e.viewer3DImpl.modelVisible(e.model.id)&&e.viewer3DImpl.invalidate(!1,!0)),e.bvhWorker.clearAllEventListenerWithIntercept(),e.bvhWorker.terminate(),e.bvhWorker=null,e.onOperationComplete()}if(t.data.boxes&&e.model){for(var i=e.model.getFragmentList(),r=t.data.boxes.length/t.data.boxStride,o=0;o<r;o++)for(var a=o*t.data.boxStride,s=6*o,c=0;c<6;c++)i.boxes[s+c]=t.data.boxes[a+c];i.boxesLoaded=!0,e.model.visibleBoundsDirty=!0}});var t=Object.assign({},e.loadContext);t.operation="LOAD_OTG_BVH",t.raiseError=null,t.onFailureCallback=null,t.onLoaderEvent=null,t.fragments_extra=Object(f.pathToURL)(e.basePath)+e.svf.manifest.assets.fragments_extra,t.placementTransform=e.svf.placementTransform,t.placementWithOffset=e.svf.placementWithOffset,t.fragmentTransformsOffset=e.svf.metadata.fragmentTransformsOffset,t.globalOffset=e.svf.globalOffset,t.fragments_extra?e.bvhWorker.doOperation(t):e.onOperationComplete()})},O.prototype.tryToActivateFragment=function(e,t){var n=this.svf,i=this.model;if(i){if(n.fragments.visibilityFlags[e]&c.MeshFlags.MESH_NOTLOADED)return i.getFragmentList().setFlagFragment(e,c.MeshFlags.MESH_NOTLOADED,!0),void this.trackGeomLoadProgress(n,e,!1);var r=!1,o=n.fragments.materials[e],a=n.getMaterialHash(o),s=this.findOrLoadMaterial(i,a,o);s||("fragment"===t&&this.pendingMaterials[a].push(e),"material"!==t&&(r=!0));var l=n.fragments.geomDataIndexes[e];if(0!==l){i.getFragmentList().getOriginalWorldMatrix(e,this.tmpMatrix);var u=i.getGeometryList().getGeometry(l);if(u||("fragment"===t&&this.loadGeometry(l,this.options.createWireframe?this.tmpMatrix:null,e),r=!0),!r){var h=this.viewer3DImpl.setupMesh(i,u,a,this.tmpMatrix);h.geomId=l,i.activateFragment(e,h,!!n.placementTransform),this.viewer3DImpl.geomCache().updateGeomImportance(i,e),this.trackGeomLoadProgress(n,e,!1)}}else(s||"material"===t)&&this.trackGeomLoadProgress(n,e,!1)}},O.prototype.onModelRootLoadDone=function(e){this.viewer3DImpl._removeLoadingFile(this),e.isOTG=!0,e.geomMetadata.hashToIndex={},e.failedFrags={},e.failedMeshes={},e.failedMaterials={},e.geomMemory=0,e.gpuNumMeshes=0,e.gpuMeshMemory=0,e.fragsLoaded=0,e.fragsLoadedNoGeom=0,e.nextRepaintPolys=0,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath=this.basePath,e.loadOptions=this.options;var t=Date.now();this.loadTime+=t-this.t0,a.logger.log("SVF load: "+(t-this.t0));var n=this.model=new L.Model(e);if(n.loader=this,n.initialize(),this.t0=t,e.bbox=(new r.LmvBox3).copy(e.bbox),e.refPointTransform&&(e.refPointTransform=new i.LmvMatrix4(!0).copy(e.refPointTransform)),e.placementTransform&&(e.placementTransform=new i.LmvMatrix4(!0).copy(e.placementTransform)),e.cameras)for(var s=0;s<e.cameras.length;s++){var l=e.cameras[s];l.position=(new o.LmvVector3).copy(l.position),l.target=(new o.LmvVector3).copy(l.target),l.up=(new o.LmvVector3).copy(l.up)}a.logger.log("scene bounds: "+JSON.stringify(e.bbox));var c={category:"metadata_load_stats",urn:e.urn,has_topology:!!e.topology,has_animations:!!e.animations,materials:e.metadata.stats.num_materials,is_mobile:Object(_.isMobileDevice)()};a.logger.track(c),this.viewer3DImpl.signalProgress(5,D.ProgressState.ROOT_LOADED,this.model),e.handleHashListRequestFailures(this.loadContext)},O.prototype.trackGeomLoadProgress=function(e,t,n){if(n){if(e.failedFrags[t])return void console.log("Double fail",t);e.failedFrags[t]=1}var i=N(e);e.fragsLoaded++;var r=N(e);r>i&&this.viewer3DImpl.signalProgress(r,D.ProgressState.LOADING,this.model),this.model.getGeometryList().geomPolyCount>e.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),e.numRepaints++,e.nextRepaintPolys+=1e5*Math.pow(1.5,e.numRepaints),this.viewer3DImpl.modelVisible(this.model.id)&&this.viewer3DImpl.invalidate(!1,!0)),e.fragsLoaded===e.metadata.stats.num_fragments&&this.onOperationComplete()},O.prototype.trackFragmentListLoadProgress=function(){var e=this.svf;function t(e){return Math.floor(100*e.fragsLoadedNoGeom/e.metadata.stats.num_fragments)}var n=t(e);e.fragsLoadedNoGeom++;var i=t(e);i>n&&this.options.onFragmentListLoadProgress(this.model,i)},O.prototype.onOperationComplete=function(){this.operationsDone++,3===this.operationsDone&&this.onGeomLoadDone()},O.prototype.onMaterialLoaded=function(e,t,n){var i=this.viewer3DImpl.matman();if(e){e.hash=t;var r=i.convertSharedMaterial(this.model,e,t);s.TextureLoader.loadMaterialTextures(this.model,r,this.viewer3DImpl),i.hasTwoSidedMaterials()&&this.viewer3DImpl.renderer().toggleTwoSided(!0)}else this.svf.failedMaterials[t]=1;for(var o=this.pendingMaterials[t],a=0;a<o.length;a++)this.tryToActivateFragment(o[a],"material");this.pendingMaterialsCount--,delete this.pendingMaterials[t]},O.prototype.findOrLoadMaterial=function(e,t,n){if(this.pendingMaterials[t])return!1;if(this.viewer3DImpl.matman().findMaterial(e,t))return!0;this.pendingMaterialsCount++,this.pendingMaterials[t]=[];var i=this;return this.svf.loadMaterial(this.loadContext,t,function(e){i.onMaterialLoaded(e,t,n)},function(e,t){i.onMaterialLoaded(null,e,n)}),!1},O.prototype.loadGeometry=function(e,t,n){var i=this.svf,r=i.getGeometryHash(e);if(this.pendingMeshes[r])return this.pendingMeshes[r].push(n),!1;this.pendingMeshesCount++,this.pendingMeshes[r]=[n];var o=!!this.loadContext.otg_cdn;i.geomMetadata.hashToIndex[r]=e;var a=i.makeSharedResourcePath(this.loadContext.otg_cdn,"geometry",r);this.viewer3DImpl.geomCache().requestGeometry(a,o,r,e,o?"":this.queryParam,t)},O.prototype.onMeshError=function(e){var t=e.error.args.hash;this.svf.failedMeshes[t]=1;var n=this.pendingMeshes[t];if(n){for(var i=0;i<n.length;i++)this.trackGeomLoadProgress(this.svf,n[i],!0);delete this.svf.geomMetadata.hashToIndex[t],delete this.pendingMeshes[t],this.pendingMeshesCount--}},O.prototype.onMeshReceived=function(e){var t=this.model;if(t){var n=t.getGeometryList(),i=this.svf.geomMetadata.hashToIndex[e.hash];if(void 0!==i){var r=n.getGeometry(i),o=this.pendingMeshes[e.hash];if(!r){n.addGeometry(e,o&&o.length||1,i),this.svf.loadDone&&console.error("Geometry received after load was done");for(var a=0;a<o.length;a++)this.tryToActivateFragment(o[a],"geom");delete this.svf.geomMetadata.hashToIndex[e.hash],delete this.pendingMeshes[e.hash],this.pendingMeshesCount--}}}else console.warn("Received geometry after loader was done. Possibly leaked event listener?",e.hash)},O.prototype.onGeomLoadDone=function(){if(this.svf.loadDone=!0,this.removeMeshReceiveListener(),s.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.options.skipMeshLoad)return this.currentLoadPath=null,void this.viewer3DImpl.onLoadComplete(this.model);this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null,this.svf.geomMetadata.hashes=null;var e=Date.now(),t="Fragments load time: "+(e-this.t0);this.loadTime+=e-this.t0;var n=this.firstPixelTimestamp-this.t0;if(t+=" (first pixel time: "+n+")",a.logger.log(t),this.options.useConsolidation){var i=this.viewer3DImpl.glrenderer();this.model.consolidate(this.viewer3DImpl.getMaterials(),this.options.consolidationMemoryLimit,i)}var r={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.svf.metadata.stats.num_geoms,fragments_count:this.svf.metadata.stats.num_fragments,urn:this.svfUrn};n>0&&(r.first_pixel_time=n),a.logger.track(r,!0),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},O.prototype.loadPropertyDb=function(){this.svf.propDbLoader=new u.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propDbLoader.load()},O.prototype.is3d=function(){return!0},P.FileLoaderManager.registerFileLoader("json",["json"],O)},function(e,t,n){"use strict";n.r(t);var i=n(3),r=n(42),o=new ArrayBuffer(8),a=new Uint8Array(o),s=new Uint16Array(o),l=new Int32Array(o),c=new Uint32Array(o),u=new Float32Array(o),h=new Float64Array(o);function d(e){this.buffer=e,this.offset=0,this.byteLength=e.length}d.prototype.seek=function(e){this.offset=e},d.prototype.getBytes=function(e){var t=new Uint8Array(this.buffer.buffer,this.offset,e);return this.offset+=e,t},d.prototype.getVarints=function(){var e,t=0,n=0;do{t|=(127&(e=this.buffer[this.offset++]))<<n,n+=7}while(128&e);return t},d.prototype.getUint8=function(){return this.buffer[this.offset++]},d.prototype.getUint16=function(){return a[0]=this.buffer[this.offset++],a[1]=this.buffer[this.offset++],s[0]},d.prototype.getInt16=function(){var e=this.getUint16();return e>32767&&(e|=4294901760),e},d.prototype.getInt32=function(){var e=this.buffer,t=a,n=this.offset;return t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3],this.offset+=4,l[0]},d.prototype.getUint32=function(){var e=this.buffer,t=a,n=this.offset;return t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3],this.offset+=4,c[0]},d.prototype.getFloat32=function(){var e=this.buffer,t=a,n=this.offset;return t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3],this.offset+=4,u[0]},d.prototype.getIndicesArray=function(e,t,n){for(var i=this.buffer,r=new Uint8Array(e,t,2*n),o=this.offset,a=0,s=2*n;a<s;a+=2)r[a]=i[o],r[a+1]=i[o+1],o+=4;this.offset=o},d.prototype.getVector3Array=function(e,t,n,i){var r=this.buffer,o=this.offset,a=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);if(3===i&&0===n){var s=12*t;a.set(r.subarray(o,o+s)),this.offset+=s}else{i*=4;for(var l=4*n,c=0;c<t;c++){for(var u=0;u<12;u++)a[l+u]=r[o++];l+=i}this.offset=o}},d.prototype.getVector2Array=function(e,t,n,i){var r=this.buffer,o=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a=this.offset;i*=4;for(var s=4*n,l=0;l<t;l++){for(var c=0;c<8;c++)o[s+c]=r[a++];s+=i}this.offset=a},d.prototype.getVector4=function(e,t){for(var n=this.buffer,i=a,r=this.offset,o=u,s=0;s<4;s++)i[0]=n[r],i[1]=n[r+1],i[2]=n[r+2],i[3]=n[r+3],e[t+s]=o[0],r+=4;this.offset=r},d.prototype.getFloat64=function(){for(var e=this.buffer,t=a,n=this.offset,i=0;i<8;i++)t[i]=e[n+i];return this.offset+=8,h[0]},d.prototype.getString=function(e){var t=Object(r.e)(this.buffer,this.offset,e);return this.offset+=e,t},d.prototype.reset=function(e){this.buffer=e,this.offset=0,this.byteLength=e.length};var f=n(37);n.d(t,"serializeLmvBufferGeom",function(){return M}),n.d(t,"readLmvBufferGeom",function(){return P});var p={Index:0,IndexEdges:1,Position:2,Normal:3,TextureUV:4,Color:5},m={BYTE:0,SHORT:1,UBYTE:2,USHORT:3,BYTE_NORM:4,SHORT_NORM:5,UBYTE_NORM:6,USHORT_NORM:7,FLOAT:8,INT:9,UINT:10},g={TRIANGLES:0,LINES:1,POINTS:2,WIDE_LINES:3},v={position:p.Position,normal:p.Normal,index:p.Index,indexlines:p.IndexEdges,color:p.Color},y={};y[p.Position]="position",y[p.Normal]="normal",y[p.Index]="index",y[p.IndexEdges]="indexlines",y[p.Color]="color",y[p.TextureUV]="uv";var _={};function b(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);for(n=0;n<t.length;n++){if((r=t[n])[0]>r[1]){var i=r[0];r[0]=r[1],r[1]=i}}t.sort(function(e,t){return e[0]-t[0]});var r=t[0],o=0;e[o]=r[0],e[o+1]=r[1]-r[0],o+=2;for(n=1;n<t.length;n++,o+=2)r=t[n],e[o]=r[0]-t[n-1][0],e[o+1]=r[1]-r[0]}function x(e){if(e.length){e[1]+=e[0],e[2]+=e[0];for(var t=3;t<e.length;t+=3)e[t]+=e[t-3],e[t+1]+=e[t],e[t+2]+=e[t]}}function w(e){if(e.length){e[1]+=e[0];for(var t=2;t<e.length;t+=2)e[t]+=e[t-2],e[t+1]+=e[t]}}function A(e){var t=y[e];return t||(console.error("Unknown vertex attribute"),p.TextureUV)}function E(){}function T(e){this.buffer=e,this.readOffset=0,this.meshFlag=0,this.numBuffers=0,this.numAttributes=0,this.bufferOffsets=[],this.attributes=[],this.buffers=[]}function M(e){var t=new E,n=[];if(!e.vb)return console.error("Unexpected non-interleaved vertex buffer"),null;n=[e.vb.byteLength,e.ib.byteLength],e.iblines&&n.push(e.iblines.byteLength);var i,r,o=Object.keys(e.attributes),a=0;e.isLines&&(a|=g.LINES),e.isWideLines&&(a|=g.WIDE_LINES),e.isPoints&&(a|=g.POINTS),t.beginHeader(a,o.length,n);for(var s=0;s<o.length;s++){var l=e.attributes[o[s]],c=(i=o[s],r=void 0,void 0!==(r=v[i])?r:0===i.indexOf("uv")?p.TextureUV:(console.warn("Unknown attribute name"),p.TextureUV));"index"===o[s]?t.addAttribute(c,l,0,1):"indexlines"===o[s]?t.addAttribute(c,l,0,2):t.addAttribute(c,l,e.vbstride,0)}t.endHeader();var u=Buffer.from(e.vb.buffer,e.vb.byteOffset,e.vb.byteLength);return t.addBuffer(u),e.isLines?b(e.ib):function(e){for(var t,n,i=[],r=0;r<e.length;r+=3)i.push([e[r],e[r+1],e[r+2]]);for(r=0;r<i.length;r++)for(var o=i[r];o[0]>o[1]||o[0]>o[2];)n=void 0,n=(t=o)[0],t[0]=t[1],t[1]=t[2],t[2]=n;i.sort(function(e,t){return e[0]-t[0]}),o=i[0];var a=0;for(e[a]=o[0],e[a+1]=o[1]-o[0],e[a+2]=o[2]-o[0],a+=3,r=1;r<i.length;r++,a+=3)o=i[r],e[a]=o[0]-i[r-1][0],e[a+1]=o[1]-o[0],e[a+2]=o[2]-o[0]}(e.ib),u=Buffer.from(e.ib.buffer,e.ib.byteOffset,e.ib.byteLength),t.addBuffer(u),e.iblines&&(b(e.iblines),u=Buffer.from(e.iblines.buffer,e.iblines.byteOffset,e.iblines.byteLength),t.addBuffer(u)),t.end()}_[m.BYTE]=1,_[m.SHORT]=2,_[m.UBYTE]=1,_[m.USHORT]=2,_[m.BYTE_NORM]=1,_[m.SHORT_NORM]=2,_[m.UBYTE_NORM]=1,_[m.USHORT_NORM]=2,_[m.FLOAT]=4,_[m.INT]=4,_[m.UINT]=4,E.prototype.beginHeader=function(e,t,n){var i=8,r=n.length;for(i+=4*(r-1),i+=5*t;i%4!=0;)i++;for(var o=0,a=0;a<n.length;a++)o+=n[a];this.buffer=new Buffer(i+o),this.writeOffset=0;for(a=0;a<4;a++)this.writeOffset=this.buffer.writeUInt8("OTG0".charCodeAt(a),this.writeOffset);this.writeOffset=this.buffer.writeUInt16LE(e,this.writeOffset),this.writeOffset=this.buffer.writeUInt8(r,this.writeOffset),this.writeOffset=this.buffer.writeUInt8(t,this.writeOffset);var s=n[0];for(a=1;a<n.length;a++)this.writeOffset=this.buffer.writeUInt32LE(s,this.writeOffset),s+=n[a]},E.prototype.addAttribute=function(e,t,n,i){this.writeOffset=this.buffer.writeUInt8(e,this.writeOffset),e===p.Index||e===p.IndexEdges?(this.writeOffset=this.buffer.writeUInt8(function(e){var t=m.USHORT,n=e.bytesPerItem||2;return 1===n?t=m.UBYTE:2===n?t=m.USHORT:4===n&&(t=m.UINT),t<<4|15&e.itemSize}(t),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(t.itemOffset||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(n||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(i,this.writeOffset)):(this.writeOffset=this.buffer.writeUInt8(function(e){var t=m.FLOAT,n=e.bytesPerItem||4;return 1===n?t=e.normalize?m.UBYTE_NORM:m.UBYTE:2===n&&(t=e.normalize?m.USHORT_NORM:m.USHORT),t<<4|15&e.itemSize}(t),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(t.itemOffset||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(n||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(i,this.writeOffset))},E.prototype.endHeader=function(){for(;this.writeOffset%4!=0;)this.writeOffset=this.buffer.writeUInt8(0,this.writeOffset)},E.prototype.addBuffer=function(e){e.copy(this.buffer,this.writeOffset),this.writeOffset+=e.length},E.prototype.end=function(){return this.writeOffset!==this.buffer.length&&console.error("Incorrect encoding buffer size"),this.buffer},T.prototype.readNodeJS=function(){if("OTG0"!==this.buffer.toString("ascii",0,4))return console.error("Invalid OTG header"),!1;if(this.readOffset=4,this.meshFlag=this.buffer.readUInt16LE(this.readOffset),this.readOffset+=2,this.numBuffers=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.numAttributes=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.numBuffers){this.bufferOffsets.push(0);for(var e=1;e<this.numBuffers;e++){var t=this.buffer.readUInt32LE(this.readOffset);this.readOffset+=4,this.bufferOffsets.push(t)}}for(e=0;e<this.numAttributes;e++){var n={};n.name=this.buffer.readUInt8(this.readOffset),this.readOffset++;var i=this.buffer.readUInt8(this.readOffset);this.readOffset++,n.itemSize=15&i,n.type=i>>4,n.bytesPerItem=_[n.type],n.normalize=n.type===m.BYTE_NORM||n.type===m.SHORT_NORM||n.type===m.UBYTE_NORM||n.type===m.USHORT_NORM,n.itemOffset=this.buffer.readUInt8(this.readOffset)/4,this.readOffset++,n.itemStride=this.buffer.readUInt8(this.readOffset)/4,this.readOffset++,n.bufferIndex=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.attributes.push(n)}for(;this.readOffset%4!=0;)this.readOffset++;for(e=0;e<this.bufferOffsets.length;e++){var r,o=this.readOffset+this.bufferOffsets[e];r=e<this.bufferOffsets.length-1?this.readOffset+this.bufferOffsets[e+1]:this.buffer.length,this.buffers.push(this.buffer.slice(o,r))}return!0},T.prototype.readWeb=function(){var e=new d(this.buffer);if("OTG0"!==e.getString(4))return console.error("Invalid OTG header"),!1;if(this.meshFlag=e.getUint16(),this.numBuffers=e.getUint8(),this.numAttributes=e.getUint8(),this.numBuffers){this.bufferOffsets.push(0);for(var t=1;t<this.numBuffers;t++){var n=e.getUint32();this.bufferOffsets.push(n)}}for(t=0;t<this.numAttributes;t++){var i={};i.name=e.getUint8();var r=e.getUint8();i.itemSize=15&r,i.type=r>>4,i.bytesPerItem=_[i.type],i.normalize=i.type===m.BYTE_NORM||i.type===m.SHORT_NORM||i.type===m.UBYTE_NORM||i.type===m.USHORT_NORM,i.itemOffset=e.getUint8()/4,i.itemStride=e.getUint8()/4,i.bufferIndex=e.getUint8(),this.attributes.push(i)}for(;e.offset%4!=0;)e.offset++;for(t=0;t<this.bufferOffsets.length;t++){var o,a=e.offset+this.bufferOffsets[t];o=t<this.bufferOffsets.length-1?e.offset+this.bufferOffsets[t+1]:e.byteLength,this.buffers.push(this.buffer.subarray(a,o))}return!0},T.prototype.read=function(){return Object(i.isNodeJS)()&&this.buffer instanceof Buffer?this.readNodeJS():this.readWeb()};var S=new f.LmvBox3;S.min.x=-.5,S.min.y=-.5,S.min.z=-.5,S.max.x=.5,S.max.y=.5,S.max.z=.5;var C={center:{x:0,y:0,z:0},radius:Math.sqrt(.75)};function P(e,t){var n=new T(e);if(!n.read())return console.error("Failed to parse OTG geometry"),null;for(var i={vblayout:{},vb:new Float32Array(n.buffers[0].buffer,n.buffers[0].byteOffset,n.buffers[0].byteLength/4),isLines:(3&n.meshFlag)===g.LINES,isWideLines:(3&n.meshFlag)===g.WIDE_LINES,isPoints:(3&n.meshFlag)===g.POINTS,boundingBox:S,boundingSphere:C},r=0;r<n.attributes.length;r++){var o=n.attributes[r];if(o.name===p.Index){var a=n.buffers[1];1===o.bytesPerItem?i.indices=a:2===o.bytesPerItem?i.indices=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/o.bytesPerItem):4===o.bytesPerItem&&(i.indices=new Uint32Array(a.buffer,a.byteOffset,a.byteLength/o.bytesPerItem)),i.isLines?w(i.indices):x(i.indices)}else if(o.name===p.IndexEdges){if(!t){var s=n.buffers[2];1===o.bytesPerItem?i.iblines=s:2===o.bytesPerItem?i.iblines=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/o.bytesPerItem):4===o.bytesPerItem&&(i.iblines=new Uint32Array(s.buffer,s.byteOffset,s.byteLength/o.bytesPerItem)),w(i.iblines)}}else{var l=A(o.name);i.vbstride?i.vbstride!==o.itemStride&&console.error("Unexpected vertex buffer stride mismatch."):i.vbstride=o.itemStride,i.vblayout[l]={bytesPerItem:o.bytesPerItem,offset:o.itemOffset,normalize:o.normalize,itemSize:o.itemSize}}}return{mesh:i,packId:0,meshIndex:0}}},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(100),o=n(38),a=n(6),s=0,l="MeasureTool-snapper-geometries",c="MeasureTool-snapper-indicator",u=null,h=16742144,d=52224;function f(e,t){this.viewer=e,this.snapper=t,this.overlayType=s,this.previewsIntersectPoint=null,this.viewer.impl.createOverlayScene(l),this.viewer.impl.createOverlayScene(c),this.geometryMaterial=new i.MeshPhongMaterial({color:d,ambient:d,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:i.DoubleSide}),this.indicatorMaterial=new i.MeshBasicMaterial({color:h,ambient:h,opacity:1,transparent:!1,depthTest:!1,depthWrite:!1,side:i.DoubleSide})}f.prototype.constructor=f;var p=f.prototype;p.render=function(){var e=this.snapper.getSnapResult();Object(o.isEqualVectors)(this.previewsIntersectPoint,e.intersectPoint,o.EPSILON)||this.clearOverlay(l),this.clearOverlay(c),e.isEmpty()||((this.snapper.renderSnappedGeometry||e.hasTopology&&this.snapper.renderSnappedTopology)&&this.renderGeometry(e),this.renderIndicator(e),this.previewsIntersectPoint=e.intersectPoint.clone())},p.removeOverlay=function(e){this.viewer.impl.clearOverlay(e),this.viewer.impl.removeOverlayScene(e)},p.clearOverlay=function(e){this.removeOverlay(e),this.viewer.impl.createOverlayScene(e)},p.clearOverlays=function(){this.removeOverlay(l),this.viewer.impl.createOverlayScene(l),this.removeOverlay(c),this.viewer.impl.createOverlayScene(c),this.previewsIntersectPoint=null},p.addOverlay=function(e,t){this.viewer.impl.addOverlay(e,t)},p.drawFace=function(e,t,n){var r=new i.Mesh(e,t,!0);n===l&&(this.overlayType=1),this.addOverlay(n,r)},p.cylinderMesh=function(e,t,n,r){var o=(new i.Vector3).subVectors(t,e),a=new i.Matrix4;a.lookAt(e,t,(new i.Object3D).up),a.multiply((new i.Matrix4).set(1,0,0,0,0,0,1,0,0,-o.length(),0,0,0,0,0,1)),r=r||.5;var s=new i.CylinderGeometry(r,r,1,8,1,!0),l=new i.Mesh(s,n);return s=null,l.applyMatrix(a),l.position.x=(t.x+e.x)/2,l.position.y=(t.y+e.y)/2,l.position.z=(t.z+e.z)/2,l},p.renderGeometry=function(e){if(!Object(o.isEqualVectors)(this.previewsIntersectPoint,e.intersectPoint,o.EPSILON))switch(e.geomType){case a.SnapType.SNAP_VERTEX:this.drawPoint(e.geomVertex,this.geometryMaterial,l);break;case a.SnapType.SNAP_EDGE:case a.SnapType.SNAP_CURVEDEDGE:case a.SnapType.SNAP_CIRCULARARC:case a.SnapType.SNAP_MIDPOINT:this.drawLine(e.geomEdge,this.geometryMaterial,.3,l);break;case a.SnapType.SNAP_FACE:case a.SnapType.SNAP_CURVEDFACE:this.drawFace(e.geomFace,this.geometryMaterial,l)}},p.renderVertexIndicator=function(e){var t=Object(o.getSnapResultPosition)(e,this.viewer),n=1.2*this.setScale(t),r=this.viewer.navigation.getCameraRightVector().multiplyScalar(n),a=this.viewer.navigation.getCameraUpVector().multiplyScalar(n),s=new i.Geometry,l=new i.Vector3;l.addVectors(t,r),l.addVectors(l,a),s.vertices[0]=l.clone(),l.subVectors(t,r),l.addVectors(l,a),s.vertices[1]=l.clone(),this.drawLine(s,this.indicatorMaterial,.2,c),l.addVectors(t,r),l.subVectors(l,a),s.vertices[0]=l.clone(),l.subVectors(t,r),l.subVectors(l,a),s.vertices[1]=l.clone(),this.drawLine(s,this.indicatorMaterial,.2,c),l.subVectors(t,r),l.subVectors(l,a),s.vertices[0]=l.clone(),l.subVectors(t,r),l.addVectors(l,a),s.vertices[1]=l.clone(),this.drawLine(s,this.indicatorMaterial,.2,c),l.addVectors(t,r),l.subVectors(l,a),s.vertices[0]=l.clone(),l.addVectors(t,r),l.addVectors(l,a),s.vertices[1]=l.clone(),this.drawLine(s,this.indicatorMaterial,.2,c)},p.renderMidpointIndicator=function(e){var t=e.geomVertex,n=1.2*this.setScale(t),r=this.viewer.navigation.getCameraRightVector().multiplyScalar(n),o=this.viewer.navigation.getCameraUpVector().multiplyScalar(n),a=new i.Geometry,s=new i.Vector3;s.addVectors(t,r),s.subVectors(s,o),a.vertices[0]=s.clone(),s.subVectors(t,r),s.subVectors(s,o),a.vertices[1]=s.clone(),this.drawLine(a,this.indicatorMaterial,.2,c),s.subVectors(t,r),s.subVectors(s,o),a.vertices[0]=s.clone(),s.addVectors(t,o),a.vertices[1]=s.clone(),this.drawLine(a,this.indicatorMaterial,.2,c),s.addVectors(t,r),s.subVectors(s,o),a.vertices[0]=s.clone(),s.addVectors(t,o),a.vertices[1]=s.clone(),this.drawLine(a,this.indicatorMaterial,.2,c)},p.renderEdgeIndicator=function(e){var t=Object(o.getSnapResultPosition)(e,this.viewer),n=1.2*this.setScale(t),r=this.viewer.navigation.getCameraRightVector().multiplyScalar(n),a=this.viewer.navigation.getCameraUpVector().multiplyScalar(n),s=new i.Geometry,l=new i.Vector3;l.addVectors(t,r),l.subVectors(l,a),s.vertices[0]=l.clone(),s.vertices[1]=t.clone(),this.drawLine(s,this.indicatorMaterial,.2,c),l.subVectors(t,r),l.subVectors(l,a),s.vertices[0]=l.clone(),s.vertices[1]=t.clone(),this.drawLine(s,this.indicatorMaterial,.2,c),l.addVectors(t,a),s.vertices[0]=l.clone(),s.vertices[1]=t.clone(),this.drawLine(s,this.indicatorMaterial,.2,c)},p.renderCircleIndicator=function(e){var t=Object(o.getSnapResultPosition)(e,this.viewer);this.drawCircle(t,this.indicatorMaterial,c)},p.renderPerpendicular=function(e){var t=Object(o.getSnapResultPosition)(e,this.viewer),n=1.2*this.setScale(t),r=this.viewer.navigation.getCameraRightVector().multiplyScalar(n),a=this.viewer.navigation.getCameraUpVector().multiplyScalar(n),s=new i.Geometry,l=new i.Vector3;s.vertices[0]=t.clone(),l.subVectors(t,r),s.vertices[1]=l.clone(),this.drawLine(s,this.indicatorMaterial,.2,c),l.addVectors(t,r),l.subVectors(l,a),s.vertices[0]=l.clone(),l.subVectors(t,r),l.subVectors(l,a),s.vertices[1]=l.clone(),this.drawLine(s,this.indicatorMaterial,.2,c),l.subVectors(t,r),l.subVectors(l,a),s.vertices[0]=l.clone(),l.subVectors(t,r),l.addVectors(l,a),s.vertices[1]=l.clone(),this.drawLine(s,this.indicatorMaterial,.2,c),s.vertices[0]=t.clone(),l.subVectors(t,a),s.vertices[1]=l.clone(),this.drawLine(s,this.indicatorMaterial,.2,c)},p.renderIndicator=function(e){if(e.isPerpendicular)this.renderPerpendicular(e);else switch(e.geomType){case a.SnapType.SNAP_VERTEX:this.renderVertexIndicator(e);break;case a.SnapType.SNAP_MIDPOINT:this.renderMidpointIndicator(e);break;case a.SnapType.SNAP_CIRCLE_CENTER:this.renderCircleIndicator(e);break;case a.SnapType.SNAP_EDGE:case a.SnapType.SNAP_CURVEDEDGE:this.renderEdgeIndicator(e);break;case a.SnapType.SNAP_CIRCULARARC:this.viewer.model.is2d()?this.renderVertexIndicator(e):this.renderCircleIndicator(e);break;case a.SnapType.SNAP_FACE:case a.SnapType.SNAP_CURVEDFACE:this.renderVertexIndicator(e)}},p.drawLine=function(e,t,n,i){i===l&&(this.overlayType=2);for(var r=0;r<e.vertices.length;r+=2){var o=this.cylinderMesh(e.vertices[r],e.vertices[r+1],t,n);this.setEdgeScale(o),this.addOverlay(i,o)}},p.drawPoint=function(e,t,n){if(!this.viewer.model.getData().isLeaflet){u||(u=new i.SphereGeometry(1));var r=new i.Mesh(u,t);r.position.set(e.x,e.y,e.z),this.setPointScale(r),n===l&&(this.overlayType=3),this.addOverlay(n,r)}},p.drawCircle=function(e,t,n){var r=new i.TorusGeometry(1.2,.2,2,20),o=new i.Mesh(r,t);o.lookAt(this.viewer.navigation.getEyeVector().normalize()),r=null,o.position.set(e.x,e.y,e.z),this.setCircleScale(o),this.addOverlay(n,o)},p.setScale=function(e){var t=this.viewer.navigation,n=t.getCamera(),r=t.getPosition(),o=e.clone(),a=n.isPerspective?o.sub(r).length():t.getEyeVector().length(),s=t.getVerticalFov();return 5*(2*a*Math.tan(i.Math.degToRad(.5*s)))/t.getScreenViewport().height},p.setPointScale=function(e){var t=this.setScale(e.position);e.scale.x=t,e.scale.y=t,e.scale.z=t},p.setCircleScale=function(e){var t=this.setScale(e.position);e.scale.x=t,e.scale.y=t},p.setEdgeScale=function(e){var t=this.setScale(e.position);e.scale.x=t,e.scale.z=t},p.updatePointScale=function(e){if(3==this.overlayType){var t=this.viewer.impl.overlayScenes[e];if(t)for(var n=t.scene,i=0;i<n.children.length;i++){var r=n.children[i];r&&this.setPointScale(r)}}},p.updateEdgeScale=function(e){if(2==this.overlayType){var t=this.viewer.impl.overlayScenes[e];if(t)for(var n=t.scene,i=0;i<n.children.length;i++){var r=n.children[i];r&&this.setEdgeScale(r)}}},p.onCameraChange=function(){this.updatePointScale(l),this.updateEdgeScale(l),this.render()},p.destroy=function(){this.removeOverlay(l),this.removeOverlay(c),u&&(u.dispose(),u=null)};var m=n(3),g=n(74);n.d(t,"Snapper",function(){return x});var v=.001;function y(e,t){return Math.abs(e-t)<=v}function _(e,t){return Math.abs(e.x-t.x)<=v&&Math.abs(e.y-t.y)<=v&&Math.abs(e.z-t.z)<=v}function b(e,t,n){var r,o,a=new i.Vector3,s=new i.Vector3;return a.subVectors(t,e),s.subVectors(n,t),o=a.dot(s),a.subVectors(n,t),(o=-o/a.dot(a))<0?r=e.distanceTo(t):o>1?r=e.distanceTo(n):(a.subVectors(e,t),s.subVectors(e,n),a.cross(s),s.subVectors(n,t),r=Math.sqrt(a.dot(a))/Math.sqrt(s.dot(s))),r}function x(e,t){var n,s=new r.SnapResult,l=e,c=t||{};n=c.markupMode?["snapper-markup"]:["snapper"];var u=!1,h=Number.MAX_VALUE,d=null,p=!1,x=!1,w=!1,A=null;function E(e,t,n){this.viewer=e,this.snapper=t,this.lineGeom=new i.Geometry,this.circularArc=null,this.circularArcCenter,this.circularArcRadius,this.ellipticalArc=null,this.ellipticalArcCenter,this.minDist=Number.MAX_VALUE,this.vpIdLine=null,this.vpIdCircular=null,this.vpIdElliptical=null,this.detectRadius=n}this.indicator=new f(e,this),this.markupMode=c.markupMode,this.renderSnappedGeometry=c.renderSnappedGeometry,this.renderSnappedTopology=c.renderSnappedTopology,this.isActive=function(){return u},this.getNames=function(){return n},this.getName=function(){return n[0]},this.getPriority=function(){return 60},this.activate=function(){u=!0,this.indicator||(this.indicator=new f(e,this))},this.deactivate=function(){u=!1,this.indicator&&(this.indicator.destroy(),this.indicator=null)},this.copyResults=function(e){s.copyTo(e)},this.getEdge=function(){return s.geomEdge},this.getVertex=function(){return s.geomVertex},this.getGeometry=function(){return s.getGeometry()},this.getGeometryType=function(){return s.geomType},this.getIntersectPoint=function(){return s.intersectPoint},this.getSnapResult=function(){return s},this.isSnapped=function(){return w},this.clearSnapped=function(){s.clear(),w=!1},this.setViewportId=function(e){A=e},this.snapping3D=function(e){if(s.snapNode=e.dbId,s.intersectPoint=e.intersectPoint,e.model){var t,n=e.face;t=e.fragId&&void 0!==e.fragId.length?e.fragId:[e.fragId],s.hasTopology=e.model.hasTopology(),s.hasTopology?this.snapping3DwithTopology(n,t,e.model):this.snapping3DtoMesh(n,t,e.model)}},this.snapping3DwithTopology=function(e,t,n){s.snapNode&&(t=[],n.getData().instanceTree.enumNodeFragments(s.snapNode,function(e){t.push(e)},!0)),s.geomFace=s.geomEdge=s.geomVertex=null,h=Number.MAX_VALUE;for(var r=0;r<t.length;++r){var o=t[r],u=l.impl.getRenderProxy(n,o),f=u.geometry,p=n.getTopoIndex(o),m=n.getTopology(p),g=m.faces,v=m.edges;if(!s.geomFace){s.geomFace=this.faceSnappingWithTopology(e,f,g,u),s.geomFace&&(s.geomFace.fragId=o);var y=(new i.Matrix3).getNormalMatrix(u.matrixWorld);s.faceNormal=e.normal.applyMatrix3(y).normalize()}this.edgeSnappingWithTopology(s.intersectPoint,f,v,u)}if(s.geomVertex=this.vertexSnappingWithTopology(s.geomEdge,s.intersectPoint),s.geomFace){if(s.radius=this.setDetectRadius(s.intersectPoint),(c.forceSnapVertices||d<s.radius)&&s.geomVertex)s.geomType=a.SnapType.SNAP_VERTEX;else if((c.forceSnapEdges||h<s.radius)&&s.geomEdge){var _=this.edgeIsCircle(s.geomEdge);_?(s.circularArcCenter=_,s.circularArcRadius=_.distanceTo(s.geomEdge.vertices[0]),s.geomEdge.center=s.circularArcCenter,s.geomEdge.radius=s.circularArcRadius,s.geomType=a.SnapType.SNAP_CIRCULARARC):this.edgeIsCurved(s.geomEdge)?s.geomType=a.SnapType.SNAP_CURVEDEDGE:s.geomType=a.SnapType.SNAP_EDGE}else this.faceIsCurved(s.geomFace)?s.geomType=a.SnapType.SNAP_CURVEDFACE:s.geomType=a.SnapType.SNAP_FACE;w=!0}},this.snapping3DtoMesh=function(e,t,n){for(var r=0;r<t.length;++r){var o=t[r],u=l.impl.getRenderProxy(n,o),f=u.geometry;if(s.geomFace=this.faceSnapping(e,f),s.geomFace){s.geomFace.applyMatrix(u.matrixWorld),s.geomEdge=this.edgeSnapping(s.geomFace,s.intersectPoint),s.geomVertex=this.vertexSnapping(s.geomEdge,s.intersectPoint);var p=(new i.Matrix3).getNormalMatrix(u.matrixWorld);s.faceNormal=e.normal.applyMatrix3(p).normalize(),s.radius=this.setDetectRadius(s.intersectPoint),c.forceSnapVertices||d<s.radius?s.geomType=a.SnapType.SNAP_VERTEX:c.forceSnapEdges||h<s.radius?s.geomType=a.SnapType.SNAP_EDGE:s.geomType=a.SnapType.SNAP_FACE,w=!0;break}}},this.faceSnappingWithTopology=function(e,t,n,r){var o=new i.Vector3,a=new i.Vector3,s=new i.Vector3,l=new i.Geometry,c=t.attributes;if(void 0!==c.index){for(var u=t.vb?t.vb:c.position.array,h=t.vb?t.vbstride:3,d=0;d<n.length;d++){for(var f=n[d].indexList,p=n[d].id,m=0;m<f.length;m+=3)if(e.a===f[m]){if(e.b===f[m+1]&&e.c===f[m+2]||e.b===f[m+2]&&e.c===f[m+1])break}else if(e.a===f[m+1]){if(e.b===f[m]&&e.c===f[m+2]||e.b===f[m+2]&&e.c===f[m])break}else if(e.a===f[m+2]&&(e.b===f[m]&&e.c===f[m+1]||e.b===f[m+1]&&e.c===f[m]))break;if(m<f.length)break}if(d<n.length)for(m=0;m<f.length;m+=3){o.set(u[f[m]*h],u[f[m]*h+1],u[f[m]*h+2]),a.set(u[f[m+1]*h],u[f[m+1]*h+1],u[f[m+1]*h+2]),s.set(u[f[m+2]*h],u[f[m+2]*h+1],u[f[m+2]*h+2]);var g=l.vertices.length;l.vertices.push(o.clone()),l.vertices.push(a.clone()),l.vertices.push(s.clone()),l.faces.push(new i.Face3(g,g+1,g+2))}}return l.vertices.length>0?(l.faceId=p,l.applyMatrix(r.matrixWorld),l):null},this.faceSnapping=function(e,t){var n=new i.Vector3,r=new i.Vector3,o=new i.Vector3,a=new i.Geometry,s=t.attributes;if(void 0!==s.index){var l=s.index.array||t.ib,c=t.vb?t.vb:s.position.array,u=t.vb?t.vbstride:3,h=t.offsets;h&&0!==h.length||(h=[{start:0,count:l.length,index:0}]);for(var d=0;d<h.length;++d)for(var f=h[d].start,p=h[d].count,m=h[d].index,g=f;g<f+p;g+=3){var v=m+l[g],b=m+l[g+1],x=m+l[g+2];n.set(c[v*u],c[v*u+1],c[v*u+2]),r.set(c[b*u],c[b*u+1],c[b*u+2]),o.set(c[x*u],c[x*u+1],c[x*u+2]);var w=i.Triangle.normal(n,r,o),A=new i.Vector3;if(A.set(c[e.a*u],c[e.a*u+1],c[e.a*u+2]),_(w,e.normal)&&y(w.dot(n),e.normal.dot(A))){var E=a.vertices.length;a.vertices.push(n.clone()),a.vertices.push(r.clone()),a.vertices.push(o.clone()),a.faces.push(new i.Face3(E,E+1,E+2))}}}return a.vertices.length>0?this.getTrianglesOnSameFace(a,e,c,u):null},this.getTrianglesOnSameFace=function(e,t,n,r){var o=!1,a=e.vertices.slice(),s=new i.Vector3;s.set(n[t.a*r],n[t.a*r+1],n[t.a*r+2]);var l=new i.Vector3;l.set(n[t.b*r],n[t.b*r+1],n[t.b*r+2]);var c=new i.Vector3;c.set(n[t.c*r],n[t.c*r+1],n[t.c*r+2]);var u=new i.Geometry;u.vertices.push(s),u.vertices.push(l),u.vertices.push(c),u.faces.push(new i.Face3(0,1,2));var h=[];do{h=[];for(var d=0;d<a.length;d+=3)if(a[d].equals(s)&&a[d+1].equals(l)&&a[d+2].equals(c))o=!0,h.push(d);else for(var f=0;f<u.vertices.length;f+=3)if(this.trianglesSharedEdge(a[d],a[d+1],a[d+2],u.vertices[f],u.vertices[f+1],u.vertices[f+2])){var p=u.vertices.length;u.vertices.push(a[d].clone()),u.vertices.push(a[d+1].clone()),u.vertices.push(a[d+2].clone()),u.faces.push(new i.Face3(p,p+1,p+2)),h.push(d);break}for(var m=h.length-1;m>=0;--m)a.splice(h[m],3)}while(h.length>0);return o?u:null},this.trianglesSharedEdge=function(e,t,n,i,r,o){var a=!1,s=!1,l=!1;return(e.equals(i)||e.equals(r)||e.equals(o))&&(a=!0),(t.equals(i)||t.equals(r)||t.equals(o))&&(s=!0),(n.equals(i)||n.equals(r)||n.equals(o))&&(l=!0),!!(a&s||a&l||s&l)},this.edgeSnappingWithTopology=function(e,t,n,r){var o,a=new i.Geometry,l=Number.MAX_VALUE,c=new i.Vector3,u=new i.Vector3,d=t.attributes;if(void 0!==d.index&&null!=n){for(var f=t.vb?t.vb:d.position.array,p=t.vb?t.vbstride:3,m=0;m<n.length;m++)for(var g=n[m].indexList,v=0;v<g.length-1;v++){c.set(f[g[v]*p],f[g[v]*p+1],f[g[v]*p+2]),u.set(f[g[v+1]*p],f[g[v+1]*p+1],f[g[v+1]*p+2]),c.applyMatrix4(r.matrixWorld),u.applyMatrix4(r.matrixWorld);var y=b(e,c,u);y<l&&(l=y,o=m)}if(o){g=n[o].indexList;for(var _=0;_<g.length-1;_++)a.vertices.push(new i.Vector3(f[g[_]*p],f[g[_]*p+1],f[g[_]*p+2])),a.vertices.push(new i.Vector3(f[g[_+1]*p],f[g[_+1]*p+1],f[g[_+1]*p+2]))}}h>=l&&a.vertices.length>0&&(h=l,a.applyMatrix(r.matrixWorld),s.geomEdge=a)},this.edgeSnapping=function(e,t){for(var n=new i.Geometry,r=!0,o=!0,a=!0,s=0;s<e.vertices.length;s+=3){for(var l=0;l<e.vertices.length;l+=3)s!==l&&((e.vertices[s].equals(e.vertices[l])||e.vertices[s].equals(e.vertices[l+1])||e.vertices[s].equals(e.vertices[l+2]))&&(e.vertices[s+1].equals(e.vertices[l])||e.vertices[s+1].equals(e.vertices[l+1])||e.vertices[s+1].equals(e.vertices[l+2]))&&(r=!1),(e.vertices[s].equals(e.vertices[l])||e.vertices[s].equals(e.vertices[l+1])||e.vertices[s].equals(e.vertices[l+2]))&&(e.vertices[s+2].equals(e.vertices[l])||e.vertices[s+2].equals(e.vertices[l+1])||e.vertices[s+2].equals(e.vertices[l+2]))&&(o=!1),(e.vertices[s+1].equals(e.vertices[l])||e.vertices[s+1].equals(e.vertices[l+1])||e.vertices[s+1].equals(e.vertices[l+2]))&&(e.vertices[s+2].equals(e.vertices[l])||e.vertices[s+2].equals(e.vertices[l+1])||e.vertices[s+2].equals(e.vertices[l+2]))&&(a=!1));r&&(n.vertices.push(e.vertices[s].clone()),n.vertices.push(e.vertices[s+1].clone())),o&&(n.vertices.push(e.vertices[s].clone()),n.vertices.push(e.vertices[s+2].clone())),a&&(n.vertices.push(e.vertices[s+1].clone()),n.vertices.push(e.vertices[s+2].clone())),r=!0,o=!0,a=!0}for(var c,u=new i.Geometry,d=Number.MAX_VALUE,f=0;f<n.vertices.length;f+=2){var p=b(t,n.vertices[f],n.vertices[f+1]);p<d&&(d=p,c=f)}return u.vertices.push(n.vertices[c].clone()),u.vertices.push(n.vertices[c+1].clone()),u.vertices=this.getConnectedLineSegmentsOnSameLine(n,u.vertices),h=d,u},this.getConnectedLineSegmentsOnSameLine=function(e,t){var n,r,o=e.vertices.slice(),a=t[0],s=t[1],l=[];do{l=[];for(var c=0;c<o.length;c+=2)if(!o[c].equals(a)||!o[c+1].equals(s))for(var u=0;u<t.length;u+=2)if(o[c].equals(t[u])||o[c+1].equals(t[u])||o[c].equals(t[u+1])||o[c+1].equals(t[u+1])){var h=new i.Vector3,d=new i.Vector3;if(h.subVectors(t[u],t[u+1]),h.normalize(),d.subVectors(o[c],o[c+1]),d.normalize(),_(h,d)||(n=h,r=d,Math.abs(n.x+r.x)<=v&&Math.abs(n.y+r.y)<=v&&Math.abs(n.z+r.z)<=v)){l.push(c);break}}for(var f=l.length-1;f>=0;--f)t.push(o[l[f]]),t.push(o[l[f]+1]),o.splice(l[f],2)}while(l.length>0);return t},this.vertexSnappingWithTopology=function(e,t){var n=Number.MAX_VALUE,r=new i.Vector3;if(e&&e.vertices.length>1){var o=t.distanceTo(e.vertices[0]),a=t.distanceTo(e.vertices[e.vertices.length-1]);o<=a?(n=o,r=e.vertices[0].clone()):(n=a,r=e.vertices[e.vertices.length-1].clone())}return d=n,r},this.vertexSnapping=function(e,t){for(var n=Number.MAX_VALUE,r=new i.Vector3,o=0;o<e.vertices.length;++o){var a=t.distanceTo(e.vertices[o]);a<n-v&&(n=a,r=e.vertices[o].clone())}return d=n,r},this.edgeIsCircle=function(e){var t=e.vertices;if(t.length<8)return!1;if(t[0].equals(t[t.length-1])){for(var n=new i.Vector3(0,0,0),r=0;r<t.length;r+=2)n.add(t[r]);n.divideScalar(t.length/2);var o=n.distanceTo(t[0]);for(r=0;r<t.length;r+=2)if(!(Math.abs(n.distanceTo(t[r])-o)<=v))return!1;return n}return!1},this.edgeIsCurved=function(e){var t=e.vertices;if(t.length<=2)return!1;if(t[0].equals(t[t.length-1]))return!0;var n=new i.Vector3;n.subVectors(t[0],t[1]);for(var r=new i.Vector3,o=2;o<t.length;o+=2)if(r.subVectors(t[o],t[o+1]),!_(n,r))return!0;return!1},this.faceIsCurved=function(e){var t=e.vertices,n=e.faces;if(n.length<=1)return!1;for(var r=i.Triangle.normal(t[n[0].a],t[n[0].b],t[n[0].c]),o=t[n[0].a],a=1;a<n.length;a++){var s=i.Triangle.normal(t[n[a].a],t[n[a].b],t[n[a].c]),l=t[n[a].a];if(!_(r,s)||!y(r.dot(o),s.dot(l)))return!0}return!1},this.angleVector2=function(e){return e.x>0&&e.y>=0?Math.atan(e.y/e.x):e.x>=0&&e.y<0?Math.atan(e.y/e.x)+2*Math.PI:e.x<0&&e.y<=0?Math.atan(e.y/e.x)+Math.PI:e.x<=0&&e.y>0?Math.atan(e.y/e.x)+Math.PI:null},E.prototype.onLineSegment=function(e,t,n,r,o){var a=this.snapper.getIntersectPoint(),s=this.lineGeom.vertices,l=new i.Vector3(e,t,a.z),c=new i.Vector3(n,r,a.z),u=b(a,l,c);u<=this.detectRadius&&u<this.minDist&&(s.splice(0,2,l,c),this.minDist=u,this.vpIdLine=o)},E.prototype.onCircularArc=function(e,t,n,r,o,a){var s=this.snapper.getIntersectPoint(),l=new i.Vector2(s.x,s.y),c=new i.Vector2(e,t),u=l.distanceTo(c);l.sub(c);var h=this.snapper.angleVector2(l);if(Math.abs(u-o)<=this.detectRadius){if(r>n&&h>=n&&h<=r)var d=new i.CircleGeometry(o,100,n,r-n);else{if(!(r<n&&(h>=n||h<=r)))return;d=new i.CircleGeometry(o,100,n,2*Math.PI-n+r)}d.vertices.splice(0,1),d.applyMatrix((new i.Matrix4).makeTranslation(e,t,s.z)),this.circularArc=d,this.circularArcCenter=new i.Vector3(e,t,s.z),this.circularArcRadius=o,this.vpIdCircular=a}},E.prototype.onEllipticalArc=function(e,t,n,r,o,a,s,l){var c=this.snapper.getIntersectPoint(),u=new i.Vector2(c.x,c.y),h=o-this.detectRadius,d=a-this.detectRadius,f=o+this.detectRadius,p=a+this.detectRadius,m=(u.x-e)*(u.x-e)/(h*h)+(u.y-t)*(u.y-t)/(d*d),g=(u.x-e)*(u.x-e)/(f*f)+(u.y-t)*(u.y-t)/(p*p),v=new i.Vector2(e,t);u.sub(v),u.x*=a,u.y*=o;var _=this.snapper.angleVector2(u);if(r>2*Math.PI&&(r=2*Math.PI),m>=1&&g<=1&&(r>n&&_>=n&&_<=r||r<n&&(_>=n||_<=r))){var b=new i.EllipseCurve(e,t,o,a,n,r,!1),x=new i.Path(b.getPoints(50)).createPointsGeometry(50);y(r-n,2*Math.PI)||x.vertices.pop(),x.applyMatrix((new i.Matrix4).makeTranslation(0,0,c.z)),this.ellipticalArc=x,this.ellipticalArcCenter=new i.Vector3(e,t,c.z),this.vpIdElliptical=l}},this.snapping2D=function(e){if(e){var t=e.intersectPoint,n=e.fragId;if(void 0!==n){if(Array.isArray(n)||(n=[n]),s.hasTopology=!1,s.intersectPoint=t,s.radius=this.setDetectRadius(t),!(null!=l.model.getFragmentList()))return w=!0,s.geomType=a.SnapType.SNAP_VERTEX,void(s.geomVertex=t);for(var r=new E(l,this,s.radius),u=0;u<n.length;++u){var h=l.impl.getRenderProxy(l.model,n[u]);if(h&&h.geometry)new g.VertexBufferReader(h.geometry,l.impl.use2dInstancing).enumGeomsForObject(e.dbId,r)}if(r.circularArc){if(s.viewportIndex2d=r.vpIdCircular,null!==A&&A!==s.viewportIndex2d)return;t.distanceTo(r.circularArc.vertices[0])<s.radius?(s.geomVertex=r.circularArc.vertices[0],s.geomType=a.SnapType.SNAP_VERTEX):t.distanceTo(r.circularArc.vertices[r.circularArc.vertices.length-1])<s.radius?(s.geomVertex=r.circularArc.vertices[r.circularArc.vertices.length-1],s.geomType=a.SnapType.SNAP_VERTEX):(this.lineStripToPieces(r.circularArc),s.geomEdge=r.circularArc,s.circularArcCenter=r.circularArcCenter,s.circularArcRadius=r.circularArcRadius,s.geomType=a.SnapType.SNAP_CIRCULARARC),w=!0}else if(r.ellipticalArc){if(s.viewportIndex2d=r.vpIdElliptical,null!==A&&A!==s.viewportIndex2d)return;t.distanceTo(r.ellipticalArc.vertices[0])<s.radius?(s.geomVertex=r.ellipticalArc.vertices[0],s.geomType=a.SnapType.SNAP_VERTEX):t.distanceTo(r.ellipticalArc.vertices[r.ellipticalArc.vertices.length-1])<s.radius?(s.geomVertex=r.ellipticalArc.vertices[r.ellipticalArc.vertices.length-1],s.geomType=a.SnapType.SNAP_VERTEX):(this.lineStripToPieces(r.ellipticalArc),s.geomEdge=r.ellipticalArc,s.circularArcCenter=r.ellipticalArcCenter,s.circularArcRadius=null,s.geomType=a.SnapType.SNAP_CIRCULARARC),w=!0}else if(r.lineGeom.vertices.length){if(s.viewportIndex2d=r.vpIdLine,null!==A&&A!==s.viewportIndex2d)return;if(this.markupMode){var d=r.lineGeom.vertices[0],f=r.lineGeom.vertices[1],p=new i.Vector3;p.addVectors(d,f),p.divideScalar(2);var m=t.distanceTo(p),v=t.distanceTo(d),y=t.distanceTo(f);s.geomEdge=r.lineGeom,m<s.radius?(s.geomVertex=p,s.geomType=a.SnapType.SNAP_VERTEX):v<s.radius?(s.geomVertex=d,s.geomType=a.SnapType.SNAP_VERTEX):y<s.radius?(s.geomVertex=f,s.geomType=a.SnapType.SNAP_VERTEX):s.geomType=a.SnapType.SNAP_EDGE,r.lineGeom.vertices[0].distanceTo(r.lineGeom.vertices[1])<o.EPSILON&&(s.geomType=a.SnapType.SNAP_CIRCLE_CENTER)}else t.distanceTo(r.lineGeom.vertices[0])<s.radius?(r.lineGeom.vertices[0].distanceTo(r.lineGeom.vertices[1])<o.EPSILON?s.geomType=a.SnapType.SNAP_CIRCLE_CENTER:s.geomType=a.SnapType.SNAP_VERTEX,s.geomVertex=r.lineGeom.vertices[0]):c.forceSnapVertices||t.distanceTo(r.lineGeom.vertices[1])<s.radius?(s.geomVertex=r.lineGeom.vertices[1],s.geomType=a.SnapType.SNAP_VERTEX):(s.geomEdge=r.lineGeom,s.geomType=a.SnapType.SNAP_EDGE);w=!0}}}},this.snappingLeaflet=function(e){if(e){var t=e.intersectPoint;s.intersectPoint=t,s.hasTopology=!1,s.radius=this.setDetectRadius(t),s.geomType=a.SnapType.SNAP_VERTEX,s.geomVertex=t,w=!0}},this.snapMidpoint=function(){if(s.isMidpoint=!1,w&&s.geomType===a.SnapType.SNAP_EDGE){var e=s.geomEdge,t=e.vertices[0],n=e.vertices[1],r=new i.Vector3((t.x+n.x)/2,(t.y+n.y)/2,(t.z+n.z)/2);s.intersectPoint.distanceTo(r)<2*s.radius&&(s.geomVertex=r,s.geomType=a.SnapType.SNAP_MIDPOINT)}},this.setPerpendicular=function(e){s.isPerpendicular=e},this.lineStripToPieces=function(e){for(var t=e.vertices,n=t.length-2;n>0;n--)t.splice(n,0,t[n])},this.setDetectRadius=function(e){var t=Object(m.isMobileDevice)()?50:10,n=l.navigation,r=n.getCamera(),o=n.getPosition(),a=e.clone(),s=r.isPerspective?a.sub(o).length():n.getEyeVector().length(),c=n.getVerticalFov(),u=2*s*Math.tan(i.Math.degToRad(.5*c)),h=n.getScreenViewport(),d=window.devicePixelRatio||1;return t*u/(h.height*d)},this.handleButtonDown=function(e,t){return p=!0,!1},this.handleButtonUp=function(e,t){return p=!1,!1},this.handleMouseMove=function(e){return!p&&(this.onMouseMove({x:e.canvasX,y:e.canvasY}),!1)},this.handleSingleTap=function(e){return this.handleMouseMove(e)},this.handlePressHold=function(e){if(Object(m.isMobileDevice)())switch(e.type){case"press":x=!0,this.onMouseMove({x:e.canvasX,y:e.canvasY});break;case"pressup":this.onMouseMove({x:e.canvasX,y:e.canvasY}),x=!1}return!1},this.handleGesture=function(e){if(Object(m.isMobileDevice)()&&x)switch(e.type){case"dragstart":case"dragmove":this.onMouseMove({x:e.canvasX,y:e.canvasY});break;case"dragend":this.onMouseMove({x:e.canvasX,y:e.canvasY}),x=!1}return!1},this.onMouseDown=function(e){return this.onMouseMove(e)},this.onMouseMove=function(e){this.clearSnapped();var t=l.impl.snappingHitTest(e.x,e.y,!1);return!(!t||!t.intersectPoint)&&(t.face?this.snapping3D(t):t.dbId||0===t.dbId?this.snapping2D(t):this.snappingLeaflet(t),this.snapMidpoint(),!0)}}},function(e,t,n){"use strict";n.r(t);var i=n(14),r=n(3),o=n(1),a=n(2),s=2,l=1048576,c=function(e,t){var n=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r=e;this.options={onDemandLoading:!1,pageOutGeometryEnabled:!1},n(this.options,t),this.options.debug={maxPageOutSize:195,pixelCullingEnable:this.options.onDemandLoading,pixelCullingThreshold:i.PIXEL_CULLING_THRESHOLD,occlusionThreshold:1,occlusionTestThreshold:1,startOcclusionTestingPackCount:8,testPackfileCount:4,useOcclusionInstancing:!0,automaticRefresh:!0,boxProxyMaxCount:0,boxProxyMinScreen:.4},n(this.options.debug,t.debug),this.reachLimit=!1,this.geomidsmap={},this.geomTravCount=[],this.loadedPacks={},this.loadedPackfileCount=0,this.memoryOverhead=0,this.loadingPacks={},this.loadingPacksSize=0,this.queuedPacks=[],this.packQueuedMap={},this.queuedPacksSize=0,this.occludedPacks=[],this.occlusionCulledCount=0,this.packsPagedOut=0,this.traversedCounter=0,this.transparentCounter=0,this.resetCount=0,this.invalidateCount=-1,this.geompacks=r.svf.geompacks,this.geommap=r.geommap,this.totalGeomSize=this.options.totalGeomSize,this.overheadSize=this.options.overheadSize,this.minMemoryLimit=Math.min(Math.max(.1*this.totalGeomSize,10),50)+this.overheadSize,this.lastPageOut=-1,this.pageOutResetCounter=-1;var c,u=!1,h=0,d=0,f=0,p=[],m=-1,g=[],v=!0,y=null,_=0,b=!0,x=!1,w=function(e){this.resetCanPageOut(!!e.debug.unloadPackFiles,0!=e.delay,!1)}.bind(this);r.viewer3DImpl&&r.viewer3DImpl.api.addEventListener(a.LOAD_MISSING_GEOMETRY,w),this.dtor=function(){r.viewer3DImpl&&r.viewer3DImpl.api.removeEventListener(a.LOAD_MISSING_GEOMETRY,w)},this.onDemandLoadingEnabled=function(){return this.options.onDemandLoading},this.pageOutGeometryEnabled=function(){return this.options.pageOutGeometryEnabled&&this.onDemandLoadingEnabled()},this.pixelCullingEnable=function(){return this.options.debug.pixelCullingEnable},this.pixelCullingThreshold=function(){return this.options.debug.pixelCullingThreshold},this.getMemoryLimit=function(){return Math.max(this.minMemoryLimit,this.options.limit)},this.getMemoryInfo=function(){return this.onDemandLoadingEnabled()?{limit:this.options.limit,effectiveLimit:this.getMemoryLimit(),loaded:this.preparedPackFilesSize()}:null},this.getLoadedMeshes=function(e){var t=this.loadedPacks[e];return t&&t.inMemory},this.loadPackFile=function(){return!0},this.doLoadPackFile=function(e){return!!this.onDemandLoadingEnabled()&&(!!this.loadingPacks[e]||!0!==this.occludedPacks[e]&&(this.queuedPacks.length>0||this.occlusionTesting>=1?!!this.addGeomPackMissingLastFrame(e)&&(this.loadGeometryMissingLastFrame(),!0):r.loadGeometryPackOnDemand(e,this.getLoadedMeshes(e))))},this.unloadPackFile=function(e,t,n){if(!this.onDemandLoadingEnabled())return!1;var i=r.model.getFragmentList(),o=this.loadedPacks[e];return!!(i&&o&&i.geoms)&&(function(e,t,n,i,o,a){var s,c,u=0,h=0,d=[],f=a.inMemory,p=!1,m=0,g=t.geoms;if(!n&&a.travsed>=a.currentCount)return 0;function v(a){if(f[a>>5]&1<<(31&a)){var l=t.fragments.mesh2frag[e+":"+a];Array.isArray(l)&&(l=l[0]);var c=g.geoms[t.getGeometryId(l)];if(c&&c.packId==e){var v=c.vb.buffer===c.ib.buffer?c.vb.buffer.byteLength>c.vb.byteLength+c.ib.byteLength:c.vb.buffer.byteLength>c.vb.byteLength||c.ib.buffer.byteLength>c.ib.byteLength;(n||c.traversed!=i&&c.transparent!=o)&&(s=g.removeGeometry(c.svfid,r.viewer3DImpl.glrenderer()))>0?(h+=s,f[c.meshIndex>>5]&=~(1<<(31&c.meshIndex)),p=p||v):(++m,v&&(u+=c.vb.byteLength,u+=c.ib.byteLength+3&-4,d.push(c)))}else console.error("Mismapped or missing geometry %d:%d",e,a)}}for(c=0;c<a.totalCount;++c)v(c);if(a.currentCount=m,a.culled=0,0==h)return 0;if(h/=l,0==d.length||!p)return h;var y=new ArrayBuffer(u),_=0;function b(e,t,n){var i=null;if(t){var r=n-1;_=_+r&~r;var o=t.length;(i=new e(y,_,o)).set(t),_+=o*n}return i}d.forEach(function(e){e.vb=b(Float32Array,e.vb,4),e.ib=b(Uint16Array,e.ib,2)})}(e,i,t,this.traversedCounter,this.transparentCounter,o),0==o.currentCount&&(delete this.loadedPacks[e],--this.loadedPackfileCount,n&&++this.packsPagedOut),!0)};var A=function(){if(this.resetCount!=this.pageOutResetCounter)return!1;r.viewer3DImpl.invalidate(!1,!0)}.bind(this);this.onPackFileLoaded=function(e,t,n){var i=this.geommap[e];if(x=!1,this.loadingPacks.hasOwnProperty(e)&&(delete this.loadingPacks[e],this.loadingPacksSize-=i.geomSize+i.usize),t){var r=this.loadedPacks[e];if(!r){var a=t.meshes.length;r=this.loadedPacks[e]={totalCount:a,travsed:0,culled:0,resetCounter:this.resetCount,geomSize:0,inMemory:new Array((a+31)/32|0)},++this.loadedPackfileCount,this.options.debug.occlusionTestThreshold>0&&0==this.occlusionTesting&&this.loadedPackfileCount>=this.options.debug.startOcclusionTestingPackCount&&(this.occlusionTesting=1)}r.geomSize+=n,r.currentCount=r.totalCount,r.inMemory.fill(-1),this.totalGeomSize+=r.geomSize-i.geomSize,this.packQueuedMap[e]&&(this.queuedPacksSize+=r.geomSize-i.geomSize),i.geomSize=r.geomSize,A()}this.loadedGeometrySize()>this.getMemoryLimit()&&o.logger.warn("More pack files being loaded than the max count: "+this.loadedGeometrySize())},this.checkLoadFinished=function(){if(!x){var e=r.pack_workers;if(e)for(var t=0;t<e.length;t++)if(0!=e[t].queued)return;(0!=this.geomPacksMissingLastFrame().length||h<p.length)&&(this.loadedGeometrySize()<this.getMemoryLimit()||b)||(x=!0,r.onDemandGeomLoadDone())}},this.doOnDemandLoadFinished=function(){this.loadGeometryMissingLastFrame(),this.checkLoadFinished()},this.onPackFileLoading=function(e){if(!this.loadingPacks.hasOwnProperty(e)){this.loadingPacks[e]=!0;var t=this.geommap[e];this.loadingPacksSize+=t.geomSize+t.usize}},this.onProcessReceivedMesh=function(e,t){var n=e.svfid;this.onDemandLoadingEnabled()&&t>1&&null==this.geomidsmap[n]&&(this.geomidsmap[n]=this.geomTravCount.length,this.geomTravCount.push(0))},this.loadedGeometrySize=function(){return r.model.getGeometryList().geomMemory/l+this.overheadSize},this.preparedPackFilesSize=function(){return this.loadingPacksSize+this.loadedGeometrySize()},this.cancelPending=function(){this.loadingPacksSize>1/l&&(r.cancelGeometryPackLoading(),this.loadingPacks={},this.loadingPacksSize=0),this.queuedPacks.length=0,this.queuedPacksSize=0,this.packQueuedMap={},this.occlusionTesting=this.onDemandLoadingEnabled()&&this.options.debug.occlusionTestThreshold>0&&this.loadedPackfileCount>=this.options.debug.startOcclusionTestingPackCount?1:0,this.occludedPacks.length=0},this.resetIterator=function(e){this.lastCamera=e,++this.resetCount},this.reset=function(){var e=this.loadedPacks;for(var t in e)e[t].travsed=0,e[t].culled=0;this.geomTravCount.fill(0),this.resetCount>this.invalidateCount&&(this.cancelPending(),this.resetCanPageOut(!1,!0,!0))},this.geomPacksMissingLastFrame=function(){return this.queuedPacks},this.addGeomPackMissingLastFrame=function(e){if(!this.onDemandLoadingEnabled())return!0;if(this.pageOutGeometryEnabled()&&this.loadedGeometrySize()>=this.getMemoryLimit()&&(this.reachLimit=!0),!this.packQueuedMap[e]){var t=this.geommap[e];t&&(this.queuedPacks.push(e),this.queuedPacksSize+=t.geomSize,this.packQueuedMap[e]=!0)}return!0},this.loadGeometryMissingLastFrame=function(){var e,t=this.queuedPacks;for(e=0;e<t.length;++e){var n=t[e];if(this.occlusionTesting>=1&&void 0===this.occludedPacks[n])break;if(!this.geommap[n].loading&&!this.occludedPacks[n]&&!r.loadGeometryPackOnDemand(n,this.getLoadedMeshes(n)))break}0!=e||x||A();var i=this;t.splice(0,e).forEach(function(e){i.queuedPacksSize-=i.geommap[e].geomSize,delete i.packQueuedMap[e]})},this.needResumeNextFrame=function(){return u};var E=function(e,t){var n=e>=g.length?1e10:g[e];return(t>=g.length?1e10:g[t])-n}.bind(this.loadedPacks);this.markVisibleGeoms=function(e){var t,n=r.model.getData().instanceTree||r.model.getData().fragmentMap;if(n&&e.visibleIdCB&&(t=e.visibleIdCB())){var i,o,a=++this.traversedCounter,s={},l=t.length,c=this.loadedPacks;for(o in c)c[o].travsed=0;for(var u=0;u<l;u+=4)(i=(i=t[u]|t[u+1]<<8|t[u+2]<<16)<<8>>8)>0&&(s[i]=1+(0|s[i]));var h=r.model.getFragmentList(),d=0|this.options.debug.occlusionThreshold;for(o in s)s[i=Number(o)]>=d&&n.enumNodeFragments(i,function(e){var t=h.getGeometry(e);if(t){var n=c[t.packId];n&&t.traversed!=a&&++n.travsed,t.traversed=a}})}},this.pageOut=function(e,t,n){u=!1;var r=i.PAGEOUT_SUCCESS;if(e&&this.options.debug.occlusionTestThreshold>0&&this.loadedPackfileCount>=this.options.debug.startOcclusionTestingPackCount&&(this.occlusionTesting=s),this.occlusionTest(n),!e)return r;this.pageOutResetCounter=this.resetCount;var a=this.loadedGeometrySize();if(b=!0,a&&(this.reachLimit||a>this.getMemoryLimit())){this.markVisibleGeoms(n);var l=this.loadedPacks,c=Object.keys(l),h=!1;c.sort(E);var d=a-Math.min(a,this.options.debug.maxPageOutSize);return c.every(function(e){return l[e].resetCounter<this.resetCount?this.unloadPackFile(e,!1,!0):h=!0,this.loadedGeometrySize()>d}.bind(this)),t&&this.loadedGeometrySize()==a&&l[c[0]].resetCounter<this.resetCount&&(this.unloadPackFile(c[0],!1,!0),o.logger.log("A force page out occur.")),this.loadedGeometrySize()==a?(r=i.PAGEOUT_SUCCESS,this.reachLimit=!0):(this.reachLimit=!1,this.loadGeometryMissingLastFrame(),u=!0),this.lastPageOut=a-this.loadedGeometrySize(),o.logger.log("[On Demand Loading] Unload pack files size: "+this.lastPageOut),window&&window.gc&&window.gc(),0==this.lastPageOut&&(b=h,this.checkLoadFinished()),r}return u=u||this.queuedPacks.length>0,this.loadFragsFromLoadOrder(),r},this.occlusionTest=function(e){var t=null,n=null,i=!1,a=null,l=null,c=0,u=0,h=3;function d(t){a=null;for(var n=0;n<l.length;++n)e.occludedPacks[l[n]]=!t[n],t[n]||(o.logger.debug("[On Demand Loading] Occluded Geometry Pack file: "+l[n]),++e.occlusionCulledCount);e.doOnDemandLoadFinished(),f()}function f(){c||a||x||(a=null,t&&!i&&(l=function(t){var n=null;u=0;var i=e.queuedPacks,r=e.occludedPacks;t=Math.min(4,t||4);for(var o=i.length,a=0;a<o&&t>0;++a){var s=i[a];void 0===r[s]?((n=n||[]).push(s),--t):r[s]||++u}return n}(e.options.debug.testPackfileCount))&&(c=setTimeout(function(){c=0;var i=function(e){var t=n.fragments.packIds;if(!t)return null;var i=[];return e.forEach(function(e){for(var n=[],r=t.lastIndexOf(e);r>=0;)t[r]==e?n.push(r--):r=t.lastIndexOf(e,r-1);i.push(n)}),i}(l);(a=t(n.boxes,e.options.debug.occlusionTestThreshold,i,e.options.debug.useOcclusionInstancing,l)).then(d,function(){d([!0,!0,!0,!0])})},u*h)))}return function(e){a||this.occlusionTesting<s||(e&&(t=e.occlusionTestCB,i=e.moved),(n=r.model.getFragmentList())&&t&&!i&&f())}}(this),this.loadFragsFromLoadOrder=function(){for(var e=r.model.getFragmentList();h<p.length;){for(var t=p[h],n=t.length;d<n;){var i=t[d];if(!e.getGeometry(i)){var o=e.fragments.packIds?e.fragments.packIds[i]:i,a=this.queuedPacks.length;if(!this.doLoadPackFile(o)&&a==this.queuedPacks.length)return}++d}++h,d=0}},this.pfOrder=function(){return c},this.getNumVisiblePFs=function(){return c?m:-1},this.onLoadOrderCalculated=function(e){if(e.error)y=null;else if(e.fragOrder&&e.packOrder&&(y=e),e.id==f&&y){this.lastPageOut=-1,b=!0,x=!1,p.length=0,p.push(y.fragOrder),c=y.packOrder,m=y.pfVisible;var t,n=c.length;for(g.length=this.geompacks.length,g.fill(1e10),t=0;t<n;++t)g[c[t]]=t;var i,o=r.model.getFragmentList(),a=this.overheadSize,s=this.getMemoryLimit();for(i=0;i<p.length&&a<s;++i){var l=p[i];n=l.length;var u=[];u.length=g.length,u.fill(0);var v=this.geompacks;for(t=0;t<n&&a<s;++t){var _=l[t],w=o.fragments.packIds?o.fragments.packIds[_]:_,A=v[w];if(A){var E=o.getGeometry(_)?A.geomSize:A.totalGeomSize;E>u[w]&&(a+=E-u[w],u[w]=E)}}}var T=this.loadedPacks;for(var M in T)T.hasOwnProperty(M)&&(u[M]||this.unloadPackFile(M,!0));++this.traversedCounter,++this.transparentCounter,this.reachLimit=this.loadedGeometrySize()>=this.getMemoryLimit(),this.cancelPending(),h=0,d=0,this.loadFragsFromLoadOrder(),r.viewer3DImpl.invalidate(!0),this.invalidateCount=this.resetCount+1}},this.resetCanPageOut=function(e,t,n){_&&(clearTimeout(_),_=0);var i=this;function o(){if(_=0,v||!n||i.options.debug.automaticRefresh){i.occlusionCulledCount=0,i.packsPagedOut=0;var t,o=i.lastCamera,a=i.loadedPacks;if(e)for(t in a)a.hasOwnProperty(t)&&i.unloadPackFile(t,!0);r.calculateLoadOrder(++f,o,i.options.debug.pixelCullingEnable?i.options.debug.pixelCullingThreshold:-1),v=!1}}t?_=setTimeout(o,100):o()},this.onGeomTraversed=function(e,t){var n=e.packId,i=e.svfid;e.traversed=this.traversedCounter,t&&(e.transparent=this.transparentCounter);var r=!0,o=this.geomidsmap[i];null!=o&&(this.geomTravCount[o]+=2,this.geomTravCount[o]|=1,r=e.instanceCount==this.geomTravCount[o]>>1);var a=this.loadedPacks[n];a&&r&&a.travsed++},this.onGeomCulled=function(e){if(e){var t=e.packId,n=e.svfid,i=this.geomidsmap[n],r=!i;null!=i&&(1&this.geomTravCount[i]?this.onGeomTraversed(e):(this.geomTravCount[i]+=2,r=e.instanceCount==this.geomTravCount[i]>>1));var o=this.loadedPacks[t];o&&r&&o.culled++}}},u=n(17),h=n(7),d=n(76),f=n(5),p=n(51),m=n(126),g=n(45),v=n(12),y=n(58),_=n(33),b=n(24),x=n(52),w=n(0),A=n(47),E=n(4);n.d(t,"SvfLoader",function(){return C});var T=Autodesk.Viewing,M=Object(r.isNodeJS)()?10:Object(r.isMobileDevice)()?2:6,S={type:a.FRAGMENTS_LOADED_EVENT,model:null,data:null,getFragIds:function(){if(this.fragIds)return this.fragIds;var e=this.model;if(!e||!this.data||!this.data.meshes)return null;var t=this.fragIds=[],n=this.data.packId,i=0,r=e.getData().fragments,o=this.data.meshes.length;for(i=0;i<o;++i){var a=n+":"+i++,s=r.mesh2frag[a];if(void 0===s)return;Array.isArray(s)?s.forEach(function(e){t.push(e)}):t.push(s)}return t}},C=function(e,t){this.viewer3DImpl=e,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.tmpMatrix=new w.Matrix4,this.tmpBox=new w.Box3,this.fetchingTopology=!1,this.loadTime=0,this.notifiesFirstPixel=!0;var n=t&&t.memory,i=this.memoryOpts={debug:{}};if(!Object(r.isNodeJS)()&&(i.limit=Object(r.isAndroidDevice)()?195:Object(r.isIOSDevice)()?150:600,i.onDemandLoading=!0,i.pageOutGeometryEnabled=!0,n)){i.debug=n.debug||{};var a=n.hasOwnProperty("limit")?n.limit:0;(0|a)>0?i.limit=0|a:0==a?(i.onDemandLoading=!1,i.pageOutGeometryEnabled=!1,i.debug.force=!1):o.logger.warn("Memory limit, "+a+", is invalid - ignored")}};C.prototype.dtor=function(){if(this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,o.logger.debug("SVF loader dtor: on init worker script.")),this.svfWorker&&(this.svfWorker.clearAllEventListenerWithIntercept(),this.svfWorker.terminate(),this.svfWorker=null,o.logger.debug("SVF loader dtor: on svf worker.")),this.svfLoadOrderWorker&&(this.svfLoadOrderWorker.terminate(),this.svfLoadOrderWorker=null,o.logger.debug("SVF loader dtor: on load order worker.")),this.pack_workers){for(var e=0;e<this.pack_workers.length;e++)this.pack_workers[e].clearAllEventListenerWithIntercept(),this.pack_workers[e].terminate();this.pack_workers=null,o.logger.debug("SVF loader dtor: on geom worker.")}this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.pagingProxy&&(this.pagingProxy.dtor(),this.pagingProxy=null),this.tmpMatrix=null,this.tmpBox=null,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadTime=0,this.viewer3DImpl=null},C.prototype.isValid=function(){return this.viewer3DImpl},C.prototype.loadFile=function(e,t,n,i){if(!this.viewer3DImpl)return o.logger.log("SVF loader was already destructed. So no longer usable."),!1;if(this.loading)return o.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;this.loading=!0,this.viewer3DImpl._addLoadingFile(this);var r=e.indexOf("urn:");if(-1!=r){var a=(e=decodeURIComponent(e)).substr(r,e.substr(r).indexOf("/"));o.logger.log("Extracted URN: "+a);var s=a.lastIndexOf(":");this.svfUrn=a.substr(s+1)}else this.svfUrn=e;this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e;var l=this.currentLoadPath.lastIndexOf("/");-1!=l&&(this.basePath=this.currentLoadPath.substr(0,l+1)),this.acmSessionId=t.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=t;var c=this;return this.initWorkerScriptToken=Object(b.initWorkerScript)(function(){c.loadSvfCB(e,t,n,i)}),!0},C.prototype.loadSvfCB=function(e,t,n,i){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null,this.failedToLoadSomeGeometryPacks=null,this.failedToLoadPacksCount=0;var s=!0;t.doneWhenDownloaded&&(this.onDone=n);var l=this,c={url:Object(v.pathToURL)(e),basePath:this.currentLoadPath,objectIds:t.ids,globalOffset:t.globalOffset,fragmentTransformsDouble:t.fragmentTransformsDouble,placementTransform:t.placementTransform,applyRefPoint:t.applyRefPoint,queryParams:this.queryParams,bvhOptions:t.bvhOptions||{isWeakDevice:Object(r.isMobileDevice)()},applyScaling:t.applyScaling,loadInstanceTree:t.loadInstanceTree,max_pf_files:0},u=this.memoryOpts.onDemandLoading||!!this.memoryOpts.debug.memoryOptimizedSvfLoading;u&&(c.perfOpt={memoryOptimizedSvfLoading:u,forceMemoryOptimizedMode:!!this.memoryOpts.debug.forceMemoryOptimizedModeOnSvfLoading}),this.viewer3DImpl._signalNoMeshes();var f=this.svfWorker=Object(b.createWorkerWithIntercept)();return f.addEventListenerWithIntercept(function(e){var u=function(){f&&(f.clearAllEventListenerWithIntercept(),f.terminate(),l.svfWorker=null,f=null)};if(s&&i&&(s=!1,i()),e.data&&e.data.manifest)C.interceptManifest.call(l,e.data.manifest),c.operation="LOAD_SVF_CONTD",c.manifest=e.data.manifest,f.doOperation(c);else if(e.data&&e.data.svf){var p=l.svf=e.data.svf;l.failedToLoadSomeGeometryPacks&&(n&&(n(l.failedToLoadSomeGeometryPacks,null),delete l.onDone),l.failedToLoadSomeGeometryPacks=null),l.onModelRootLoadDone(p),n&&!t.doneWhenDownloaded&&n(null,l.model),l.viewer3DImpl.dispatchEvent({type:a.MODEL_ROOT_LOADED_EVENT,svf:p,model:l.model}),l.svf.loadDone=!1;var m=!1;if(l.svf.metadata&&l.svf.metadata.gltf&&(m=!0),!m){var g=p.geompacks.length;if(0==g)l.onGeomLoadDone();else if(l.model.getFragmentList().onDemandLoadingEnabled())o.logger.debug("[On Demand Loading]: Enabled."),l.loadedPacksCount=0;else if(g)for(var v=Math.min(g,T.NUM_WORKER_THREADS||M),y=0;y<v;y++){var _=p.geompacks[l.next_pack++];_.loading=!0,Object(r.isNodeJS)()?l.loadGeometryPack(_.id,_.uri):function(e){setTimeout(function(){l.loadGeometryPack(e.id,e.uri)},200*y)}(_)}}1==e.data.progress&&(l.loading=!1,u()),p.fragments.polygonCounts||(p.fragments.polygonCounts=new Int32Array(p.fragments.length)),e.data.bvh&&(l.svf.bvh=e.data.bvh,l.model.setBVH(new d.NodeArray(l.svf.bvh.nodes,l.svf.bvh.useLeanNodes),l.svf.bvh.primitives,l.options.bvhOptions),l.viewer3DImpl.invalidate(!1,!0))}else e.data&&e.data.bvh?(l.svf&&!l.svf.bvh&&(l.svf.bvh=e.data.bvh,l.model.setBVH(new d.NodeArray(l.svf.bvh.nodes,l.svf.bvh.useLeanNodes),l.svf.bvh.primitives,l.options.bvhOptions),l.viewer3DImpl.invalidate(!1,!0)),l.loading=!1,u()):e.data&&e.data.mesh?(l.processReceivedMesh(e.data),1===e.data.progress&&(l.onGeomLoadDone(),l.loading=!1,u())):e.data&&e.data.progress?1==e.data.progress&&(l.loading=!1,u()):e.data&&e.data.error?(l.loading=!1,u(),o.logger.error("Error while processing SVF: "+JSON.stringify(e.data.error.args)),n&&(n(e.data.error,null),delete l.onDone)):e.data&&e.data.debug?o.logger.debug(e.data.message):(o.logger.error("SVF download failed.",Object(h.errorCodeString)(h.ErrorCodes.NETWORK_FAILURE)),l.loading=!1,u())}),c.operation="LOAD_SVF",c.interceptManifest=!!C.interceptManifest,f.doOperation(Object(E.initLoadContext)(c)),!0},C.prototype.cancelGeometryPackLoading=function(){if(this.pack_workers&&this.isValid()){for(var e=0;e<this.pack_workers.length;e++){if(this.svf){var t=this.geommap[this.pack_workers[e].packId];t&&(t.loading=!1)}this.pack_workers[e].queued=0,this.pack_workers[e].clearAllEventListenerWithIntercept(),this.pack_workers[e].terminate()}this.pack_workers=null}},C.prototype.loadGeometryPackOnDemand=function(e,t){if(!this.svf||!this.isValid())return!0;var n=this.geommap[e];if(!n||n.loading)return!0;this.t0||(this.t0=(new Date).getTime());var r,a=this.pagingProxy,s=this;function l(e,t){e.queued=0,s.geommap[t].loading=!1,a.doOnDemandLoadFinished()}var c=function(e){if(e.data&&e.data.meshes){for(var t=e.data.meshes,n={packId:e.data.packId,meshIndex:0,mesh:null},r=0,c=0;c<t.length;c++){var u=t[c];u&&(n.meshIndex=c,n.mesh=u,s.processReceivedMesh(n),n.geometry&&(r+=n.geometry.byteSize+i.GEOMETRY_OVERHEAD,n.geometry=null))}a.onPackFileLoaded(e.data.packId,e.data,r/1048576),h=s,d=e.data,S.model=h.model,S.data=d,h.viewer3DImpl.dispatchEvent(S),e.data.progress>=1&&(s.loadedPacksCount++,l(s.pack_workers[e.data.workerId],e.data.packId))}else e.data&&e.data.progress?(s.pack_workers[e.data.workerId].queued-=1,s.viewer3DImpl.signalProgress(100*s.loadedPacksCount/s.svf.geompacks.length)):e.data&&e.data.debug?o.logger.debug(e.data.message):e.data&&e.data.error?(a.onPackFileLoaded(e.target.packId,null,0),l(e.target,e.target.packId),++s.failedToLoadPacksCount,s.failedToLoadSomeGeometryPacks={code:e.data.error.code,msg:e.data.error.msg}):(a.onPackFileLoaded(e.target.packId,null,0),l(e.target,e.target.packId));var h,d};if(!this.pack_workers){this.pack_workers=[];var u=M;for(r=0;r<u;r++){var h=Object(b.createWorkerWithIntercept)();h.addEventListenerWithIntercept(c),h.queued=0,this.pack_workers.push(h)}}var d,f,p=0,m=this.pack_workers[0].queued;for(r=1;r<this.pack_workers.length;r++)this.pack_workers[r].queued<m&&(p=r,m=this.pack_workers[r].queued);if(m>1||a.preparedPackFilesSize()>=a.getMemoryLimit())return this.model.addGeomPackMissingLastFrame(e)||this.viewer3DImpl.invalidate(!1,!0),!1;var g=n.uri;(d=this.pack_workers[p]).queued+=2,d.packId=e,f=p,a.onPackFileLoading(e),n.loading=!0,this.svf.partPacksLoadDone=!1,o.logger.debug("[On Demand Loading] Loading Geometry Pack file: "+e);var y={operation:"LOAD_GEOMETRY",url:Object(v.pathToURL)(this.svf.basePath+g),packId:e,workerId:f,packNormals:this.options.packNormals,createWireframe:this.options.createWireframe||this.model.getMetadata("renderEnvironmentDisplayEdges","value",!1),skipAssetCallback:!0,queryParams:this.queryParams,inMemory:t};return d.doOperation(Object(E.initLoadContext)(y)),!0},C.prototype.loadGeometryPack=function(e,t){var n,i,r,a,s=this;if(this.svf&&this.isValid()){var l=this.pack_workers;if(l||(l=this.pack_workers=[]),l.length<(T.NUM_WORKER_THREADS||M)){var c=!0;for(r=0;r<l.length;r++)if(0===l[r].queued){c=!1;break}if(c){var u=Object(b.createWorkerWithIntercept)();u.addEventListenerWithIntercept(function(e){if(e.data&&e.data.meshes){for(var t=e.data.meshes,n={packId:e.data.packId,meshIndex:0,mesh:null},i=0;i<t.length;i++){var r=t[i];r&&(n.meshIndex=i,n.mesh=r,s.processReceivedMesh(n))}if(e.data.progress>=1){s.pack_workers[e.data.workerId].queued-=1,s.loadedPacksCount++,s.viewer3DImpl.signalProgress(100*s.loadedPacksCount/s.svf.geompacks.length);var l=!0;for(a=0;a<s.pack_workers.length;a++)if(0!=s.pack_workers[a].queued){l=!1;break}if(l){for(a=0;a<s.pack_workers.length;a++)s.pack_workers[a].clearAllEventListenerWithIntercept(),s.pack_workers[a].terminate();s.pack_workers=null}s.loadedPacksCount+s.failedToLoadPacksCount==s.svf.geompacks.length&&s.onGeomLoadDone()}}else if(e.data&&e.data.progress){if(s.pack_workers[e.data.workerId].queued-=1,s.next_pack<s.svf.geompacks.length){for(var c=null;s.next_pack<s.svf.geompacks.length&&(c=s.svf.geompacks[s.next_pack++]).loading;);c&&!c.loading?(c.loading=!0,s.loadGeometryPack(c.id,c.uri)):s.svf.fragments.packIds=null}}else e.data&&e.data.debug?o.logger.debug(e.data.message):e.data&&e.data.error?(++s.failedToLoadPacksCount,s.failedToLoadSomeGeometryPacks={code:e.data.error.code,msg:e.data.error.msg}):s.pack_workers[e.data.workerId].queued-=2}),u.queued=0,l.push(u)}}var h=0,d=l[0].queued;for(r=1;r<l.length;r++)l[r].queued<d&&(h=r,d=l[r].queued);(n=l[h]).queued+=2,i=h;var f={operation:"LOAD_GEOMETRY",url:Object(v.pathToURL)(this.svf.basePath+t),packId:parseInt(e),workerId:i,createWireframe:this.options.createWireframe||this.model.getMetadata("renderEnvironmentDisplayEdges","value",!1),packNormals:this.options.packNormals,queryParams:this.queryParams};n.doOperation(Object(E.initLoadContext)(f))}},C.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,n=this.svf,i=n.fragments,r=this.model,a=i.mesh2frag[t];if(void 0!==a){Array.isArray(a)||(a=[a]),p.BufferGeometryUtils.meshToGeometry(e),e.geometry.packId=e.packId,e.geometry.meshIndex=e.meshIndex;var s=a.length,l=r.getFragmentList().getGeometryId(a[0]),c=r.getGeometryList().addGeometry(e.geometry,s,l);this.pagingProxy&&this.pagingProxy.onProcessReceivedMesh(e.geometry,s);for(var u=(e.geometry.attributes.index.array||e.geometry.ib).length/3,h=0;h<a.length;h++){var d=0|a[h];if(n.loadOptions.skipHiddenFragments)if(!(i.visibilityFlags[d]&f.MeshFlags.MESH_VISIBLE))continue;r.getFragmentList().getOriginalWorldMatrix(d,this.tmpMatrix);var m=i.materials[d].toString();i.polygonCounts&&(i.polygonCounts[d]=u);var g=this.viewer3DImpl.setupMesh(this.model,e.geometry,m,this.tmpMatrix);r.activateFragment(d,g,!!n.placementTransform)}this.options.onMeshReceived&&this.options.onMeshReceived(this.model,c,a),this.model.getFragmentList().onDemandLoadingEnabled()||(i.mesh2frag[t]=null),i.numLoaded+=a.length,this.viewer3DImpl._signalMeshAvailable(),r.getGeometryList().geomPolyCount>n.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),n.numRepaints++,n.nextRepaintPolys+=1e4*Math.pow(1.5,n.numRepaints),this.viewer3DImpl.invalidate(!1,!0))}else o.logger.warn("Mesh "+t+" was not referenced by any fragments.")},C.prototype.onModelRootLoadDone=function(e){e.geomMemory=0,e.fragments.numLoaded=0,e.gpuNumMeshes=0,e.gpuMeshMemory=0,e.nextRepaintPolys=0,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath=this.basePath,e.loadOptions=this.options;var t=Date.now();this.loadTime+=t-this.t0,o.logger.log("SVF load: "+(t-this.t0));var n=this.model=new x.Model(e);n.loader=this;var a=this.memoryOpts;this.viewer3DImpl.modelQueue()&&this.viewer3DImpl.modelQueue().length>0&&(a.pageOutGeometryEnabled=!1);var s=this.geommap={},l=(224*Object.keys(e.fragments.mesh2frag).length+134*e.fragments.length)/1048576,h=0;e.geompacks.forEach(function(e){e.hasOwnProperty("geomSize")||(e.geomSize=.7*e.usize),e.usize/=1048576,e.geomSize/=1048576,h+=e.geomSize,s[parseInt(e.id)]=e});var d=Object(r.isMobileDevice)()?Math.min(h,i.GPU_MEMORY_LIMIT/1048576):0;h+=l,a.totalGeomSize=h,a.overheadSize=l,a.onDemandLoading&&(h+d<a.limit&&!a.debug.force?a.onDemandLoading=!1:this.pagingProxy=new c(this,a)),n.initialize(this.pagingProxy);var f=this;this.model.getFragmentList().onDemandLoadingEnabled()&&e.fragments.boxes&&e.fragments.packIds&&(this.svfLoadOrderWorker=Object(b.createWorker)(),this.svfLoadOrderWorker.addEventListener("message",function(e){f.isValid()&&f.pagingProxy&&f.pagingProxy.onLoadOrderCalculated(e.data)},!1),this.svfLoadOrderWorker.doOperation({operation:"CALCULATE_LOAD_ORDER",fragments:{boxes:e.fragments.boxes,packIds:e.fragments.packIds}}),this.model.setUUID(e.urn));var p=!(this.model.getFragmentList().onDemandLoadingEnabled()&&Object(r.isMobileDevice)());(void 0===this.options.skipPropertyDb?p:!this.options.skipPropertyDb)?this.loadPropertyDb():this.svf.fragmentMap=new m.DbidFragmentMap(this.svf.fragments.fragId2dbId);var g=this.convertMaterials(n);if(this.t1=t,e.bbox=(new w.Box3).copy(e.bbox),e.refPointTransform&&(e.refPointTransform=new u.LmvMatrix4(!0).copy(e.refPointTransform)),e.placementTransform&&(e.placementTransform=new u.LmvMatrix4(!0).copy(e.placementTransform)),e.cameras)for(var v=0;v<e.cameras.length;v++){var y=e.cameras[v];y.position=(new w.Vector3).copy(y.position),y.target=(new w.Vector3).copy(y.target),y.up=(new w.Vector3).copy(y.up),isFinite(y.position.x+y.position.y+y.position.z+y.target.x+y.target.y+y.target.z+y.up.x+y.up.y+y.up.z)||(y.target=e.bbox.center(),y.position.copy(y.target),y.position.z+=e.bbox.max.z-e.bbox.min.z,y.up={x:0,y:1,z:0}),isFinite(y.aspect)||(y.aspect=1),isFinite(y.fov)||(y.fov=90),isFinite(y.orthoScale)||(y.orthoScale=1)}o.logger.log("scene bounds: "+JSON.stringify(e.bbox));var _={category:"metadata_load_stats",urn:e.urn,has_topology:!!e.topologyPath,has_animations:!!e.animations,cameras:e.cameras?e.cameras.length:0,lights:e.lights?e.lights.length:0,materials:g,is_mobile:Object(r.isMobileDevice)()};o.logger.track(_),this.viewer3DImpl.signalProgress(5),this.viewer3DImpl.invalidate(!1,!0)},C.prototype.calculateLoadOrder=function(e,t,n){if(!this.svfLoadOrderWorker)return!1;var i={operation:"CALCULATE_LOAD_ORDER",id:e,camera:{projectionMatrix:{elements:t.projectionMatrix.elements},matrixWorldInverse:{elements:t.matrixWorldInverse.elements},aspect:t.aspect,position:{x:t.position.x,y:t.position.y,z:t.position.z},clientWidth:t.clientWidth,clientHeight:t.clientHeight},pixelCullingThreshold:n};return this.svfLoadOrderWorker.doOperation(i),!0},C.prototype.convertMaterials=function(e){var t,n=this.viewer3DImpl.matman(),i=e.getData(),r=0;if(!i.materials)return r;if(i.gltfMaterials){var o=i.materials.materials;for(t in o){var a=o[t],s=g.MaterialConverter.convertMaterialGltf(a,i),l=n._getMaterialHash(e,t);n.addMaterial(l,s,!1),r++}return r}var c=i.materials.materials,u=i.proteinMaterials?i.proteinMaterials.materials:null;for(t in c){var h=u&&u[t]&&g.MaterialConverter.isPrismMaterial(u[t])?u[t]:c[t];n.convertOneMaterial(e,h,n._getMaterialHash(e,t)),r++}return r},C.prototype.makeBVH=function(e){var t=performance.now(),n=e.materials?e.materials.materials:null;e.bvh=new d.BVHBuilder(e.fragments,n),e.bvh.build(this.options.bvhOptions||{isWeakDevice:Object(r.isMobileDevice)()});var i=performance.now();o.logger.log("BVH build time: "+(i-t))},C.prototype.onDemandGeomLoadDone=function(){if(!this.svf.loadDone)if(Object(r.isMobileDevice)()){var e=this.viewer3DImpl.modelQueue()?this.viewer3DImpl.modelQueue().getMemoryInfo():this.model.getMemoryInfo();if(e&&e.effectiveLimit<=e.limit&&e.limit-e.loaded>50){var t=function(e){this.viewer3DImpl.api.removeEventListener(a.TEXTURES_LOADED_EVENT,t);var n=0;this.viewer3DImpl.matman().enumTextures(this.model,function(e){e&&(n+=_.TextureLoader.calculateTextureSize(e))}),n/=1048576,this.pagingProxy.options.limit-=n}.bind(this);this.viewer3DImpl.api.addEventListener(a.TEXTURES_LOADED_EVENT,t),_.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl)}}else _.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl);this.svf.loadDone=!0;var n=Date.now(),i="[On Demand Loading] On demand requested geometries load time: "+(n-this.t0);o.logger.log(i);var s={category:"on_demand_geom_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:n-this.t0,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),load_pack_count:this.loadedPacksCount,urn:this.svfUrn};o.logger.track(s),this.t0=null,this.loadedPacksCount=0,this.svf.partPacksLoadDone=!0,this.viewer3DImpl.dispatchEvent({type:a.GEOMETRY_DOWNLOAD_COMPLETE_EVENT,model:this.model,memoryLimited:!0}),this.onDone&&(this.onDone(null,this.model),delete this.onDone)},C.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,_.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null,this.svf.fragments.visibilityFlags=null;var e=Date.now(),t="Fragments load time: "+(e-this.t1);this.loadTime+=e-this.t0;var n=this.firstPixelTimestamp-this.t0;t+=" (first pixel time: "+n+")",this.svf.bvh&&!this.svf.placementTransform||(this.makeBVH(this.svf),this.model.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives,this.options.bvhOptions),this.viewer3DImpl.invalidate(!1,!0)),o.logger.log(t),this.options.useConsolidation&&this.viewer3DImpl.glrenderer()&&this.model.consolidate(this.viewer3DImpl.matman(),this.options.consolidationMemoryLimit,this.viewer3DImpl.glrenderer());var i={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),urn:this.svfUrn};n>0&&(i.first_pixel_time=n),o.logger.track(i),this.currentLoadPath=null,this.viewer3DImpl.dispatchEvent({type:a.GEOMETRY_DOWNLOAD_COMPLETE_EVENT,model:this.model,memoryLimited:!1}),this.onDone&&(this.onDone(null,this.model),delete this.onDone)},C.prototype.loadPropertyDb=function(){this.svf.propDbLoader=new y.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propDbLoader.load()},C.prototype.fetchTopologyFile=function(e,t){if(!this.fetchingTopology){this.fetchingTopology=!0;var n=Object(b.createWorkerWithIntercept)();n.addEventListenerWithIntercept(function(e){if(e.data["status-topology"])return i=(new Date).getTime(),a=Math.round((i-l)/1e3),void o.logger.log("Topology file downloaded. ("+a+" seconds). Processing...");var s=e.data["fetch-topology"];s&&(r=(new Date).getTime(),a=Math.round((r-i)/1e3),s.topology?o.logger.log("Topology file processed successfully! ("+a+" seconds)."):o.logger.log("Topology file processed, but an error ocurred. ("+a+" seconds)."),t(s),c.fetchingTopology=!1,n.clearAllEventListenerWithIntercept(),n.terminate(),n=null)});var i,r,a,s={path:e,queryParams:this.queryParams},l=(new Date).getTime();o.logger.log("Fetching topology file..."),s.operation="FETCH_TOPOLOGY",n.doOperation(Object(E.initLoadContext)(s));var c=this}},C.prototype.is3d=function(){return!0},A.FileLoaderManager.registerFileLoader("svf",["svf","gltf","glb"],C)}]);
//# sourceMappingURL=viewer3D.min.js.map
